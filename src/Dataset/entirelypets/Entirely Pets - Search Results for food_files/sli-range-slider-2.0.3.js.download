(function(){window.SLI=window.SLI||{};var please,keyboard,loader;please={addEventListener:function(element,event,listener){return element.addEventListener?element.addEventListener(event,listener,false):element.attachEvent("on"+event,listener)},removeEventListener:function(element,event,listener){return element.removeEventListener?element.removeEventListener(event,listener,false):element.detachEvent("on"+event,listener)},cancelEvent:function(event){return event.preventDefault?event.preventDefault():event.returnValue=false
},addClass:function(element,className){var i,j,classes,added=false;if(element.classList){for(i=1;i<arguments.length;i++){element.classList.add(arguments[i])}}else{classes=element.className?element.className.split(/\s+/):[];for(i=1;i<arguments.length;i++){for(j=0,added=false;j<classes.length;j++){if(classes[j]===arguments[i]){added=true;break}}if(!added){classes.push(arguments[i])}}element.className=classes.join(" ")}return element},createElement:function(tag,attributes,events){var element=document.createElement(tag),attr,styles,event,k;
if(attributes){for(attr in attributes){if(attributes.hasOwnProperty(attr)){if(attr==="class"){please.addClass.apply(element,[element].concat(attributes[attr].split(/\s+/)))}else{if(attr==="styles"){styles=attributes[attr];for(k in styles){if(styles.hasOwnProperty(k)){element.style[k]=styles[k]}}}else{if(attr==="innerHTML"){element.innerHTML=attributes[attr]}else{element.setAttribute(attr,attributes[attr])}}}}}}if(events){for(event in events){if(events.hasOwnProperty(event)){please.addEventListener(element,event,events[event])
}}}return element},getPosition:function(element){var position={x:0,y:0};if(element.offsetParent){do{position.x+=element.offsetLeft-element.scrollLeft;position.y+=element.offsetTop-element.scrollTop}while((element=element.offsetParent))}return position},parseFloat:function(string){return parseFloat((string||"0").toString().replace(/[^0-9\.].*$/,""))},getFirstElementByTagName:function(tags){var el,i;for(i=0;i<arguments.length;i++){if((el=document.getElementsByTagName(arguments[i])).length){return el[0]}}}};function touchToMouse(event){var touch,type="",simulatedEvent;
if(event.touches.length>1){return}touch=event.changedTouches[0];switch(event.type){case"touchstart":type="mousedown";break;case"touchmove":type="mousemove";break;case"touchend":type="mouseup";break;default:return}simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);touch.target.dispatchEvent(simulatedEvent);event.preventDefault()}function proxy(fn,context){return function(){fn.apply(context,Array.prototype.slice.call(arguments,0))
}}function curry(fn,args){if(!args.length){args=Array.prototype.slice.call(arguments,1)}return function(){fn.apply(this,args.concat(Array.prototype.slice.call(arguments,0)))}}keyboard={LEFT:37,RIGHT:39,UP:38,DOWN:40,HOME:36,END:35};window.SLI.Slider=function(element_or_id,options){this.element=typeof(element_or_id)==="string"?document.getElementById(element_or_id):element_or_id;if(!this.element){return}this.options=options||{};this.config=window.SLI.Slider.config[this.options.orientation=this.options.orientation||"horizontal"];
this.options.selection=this.options.selection||[this.options.rangeStarts,this.options.rangeEnds];this.render()};window.SLI.Slider.VERSION="2.0.0";window.SLI.Slider.config={vertical:{KEY_LEFT:keyboard.DOWN,KEY_RIGHT:keyboard.UP,STYLE_LEFT:"bottom",STYLE_RIGHT:"top",STYLE_WIDTH:"height",X:"y",WIDTH:"clientHeight",MOVE:"clientY",SCROLL:"scrollTop",START:100,DIRECTION:-1},horizontal:{KEY_LEFT:keyboard.LEFT,KEY_RIGHT:keyboard.RIGHT,STYLE_LEFT:"left",STYLE_RIGHT:"right",STYLE_WIDTH:"width",X:"x",WIDTH:"clientWidth",MOVE:"clientX",SCROLL:"scrollLeft",START:0,DIRECTION:1}};
window.SLI.Slider.prototype={render:function(){var cancelEvent=function(e){please.cancelEvent(e);return false},emptyEvent=function(e){return false},i,thumb,styles,tick;please.addClass(this.element,"sli-range-slider","sli-range-slider-"+(this.options.orientation||"horizontal"));this.element.appendChild(this.track=please.createElement("div",{"class":"sli-range-slider-track"}));this.track.appendChild(please.createElement("span",{"class":"sli-range-slider-track-start"}));this.track.appendChild(please.createElement("span",{"class":"sli-range-slider-track-end"}));
this.thumbs=[];this.ranges=[];this.values=[];this.thumbDown=proxy(this.thumbDown,this);for(i=0;i<this.options.selection.length;i++){if(i>0){this.ranges.push(this.track.appendChild(please.createElement("span",{"class":"sli-range-slider-selection",innerHTML:"<span></span>"})))}thumb=this.track.appendChild(please.createElement("a",{"class":"sli-range-slider-thumb",href:"#","data-index":i},{click:cancelEvent,mousedown:this.thumbDown,dragstart:emptyEvent}));thumb.appendChild(please.createElement("span",{"class":"sli-range-slider-thumb-label"}));
thumb.ontouchstart=touchToMouse;thumb.ontouchmove=touchToMouse;thumb.ontouchend=touchToMouse;this.thumbs.push(thumb)}please.addEventListener(this.element,"keydown",proxy(this.keyPress,this));this.element.appendChild(this.ticks=please.createElement("div"));this.update()},update:function(options){var i,key,styles,tick;if(options){for(key in options){if(options.hasOwnProperty(key)){this.options[key]=options[key]}}}for(i=0;i<this.options.selection.length;i++){this.values.push(this.selection(i));this.snap(this.moveThumb(this.thumbs[i],(this.selection(i)-this.options.rangeStarts)*100/(this.options.rangeEnds-this.options.rangeStarts)))
}this.ticks.innerHTML="";for(i=0;i<this.options.positions.length;i++){styles={};styles[this.config.STYLE_LEFT]=this.positionToX(this.options.positions[i])+"%";tick=this.ticks.appendChild(please.createElement("div",{"class":"sli-range-slider-tick",styles:styles,"data-value":this.format(this.options.positions[i])}));if(i===0||i===this.options.positions.length-1){please.addClass(tick,i?"last":"first");tick.innerHTML="<span><i></i>"+this.format(this.options.positions[i])+"</span>"}}},thumbDown:function(event){event=event||window.event;
var target=event.target||event.srcElement;if(target.tagName.toLowerCase()==="a"){target.focus();please.cancelEvent(event);please.addEventListener(document,"mousemove",this.thumbMoveListener=proxy(curry(this.thumbMove,[target]),this));please.addEventListener(document,"mouseup",this.thumbUpListener=proxy(curry(this.thumbUp,[target]),this))}},thumbMove:function(thumb,event){event=event||window.event;var w=this.element[this.config.WIDTH],x=(event[this.config.MOVE]-please.getPosition(this.element)[this.config.X])*100/w;
x=Math.max(Math.min(x*this.config.DIRECTION+this.config.START,100),0);this.moveThumb(thumb,x,true)},thumbUp:function(thumb,event){this.snap(thumb,true);please.removeEventListener(document,"mousemove",this.thumbMoveListener);please.removeEventListener(document,"mouseup",this.thumbUpListener)},keyPress:function(event){var target,index,thumb,p;event=event||window.event;target=event.target||event.srcElement;index=target.getAttribute("data-index");if(index||(index===0)){if(typeof index!=="number"){index=parseInt(index,10)
}thumb=target;p=this.positionToIndex(this.selection(index),true);switch(event.keyCode){case this.config.KEY_LEFT:if(p>0){this.snap(this.moveThumb(thumb,this.positionToX(this.options.positions[p-1])),true)}please.cancelEvent(event);break;case this.config.KEY_RIGHT:if(p<this.options.positions.length-1){this.snap(this.moveThumb(thumb,this.positionToX(this.options.positions[p+1])),true)}please.cancelEvent(event);break;case keyboard.HOME:this.snap(this.moveThumb(thumb,this.positionToX(this.options.positions[0])),true);
please.cancelEvent(event);break;case keyboard.END:this.snap(this.moveThumb(thumb,this.positionToX(this.options.positions[this.options.positions.length-1])),true);please.cancelEvent(event);break}}},moveThumb:function(thumb,x,fireEvent){var index=parseInt(thumb.getAttribute("data-index"),10),value,data;if(index>0){x=Math.max(x,this.positionToX(this.options.positions[this.positionToIndex(this.selection(index-1))+1]))}if(index<this.selection().length-1){x=Math.min(x,this.positionToX(this.options.positions[this.positionToIndex(this.selection(index+1))-1]))
}thumb.style[this.config.STYLE_LEFT]=x+"%";value=this.xToPosition(x);data={selection:this.selection(),counts:this.count()};data.selection[index]=value;if(index>0){this.ranges[index-1].style[this.config.STYLE_WIDTH]=(x-parseFloat(this.ranges[index-1].style[this.config.STYLE_LEFT]))+"%";data.counts[index-1]=this.count(data.selection[index-1],value)[0];this.ranges[index-1].setAttribute("data-count",this.formatCount(data.counts[index-1]));this.ranges[index-1].getElementsByTagName("span")[0].innerHTML="<i></i>"+this.formatCount(data.counts[index-1])
}if(index<this.selection().length-1){this.ranges[index].style[this.config.STYLE_LEFT]=x+"%";this.ranges[index].style[this.config.STYLE_WIDTH]=(this.positionToX(this.selection(index+1))-x)+"%";data.counts[index]=this.count(value,data.selection[index+1])[0];this.ranges[index].setAttribute("data-count",this.formatCount(data.counts[index]));this.ranges[index].getElementsByTagName("span")[0].innerHTML="<i></i>"+this.formatCount(data.counts[index])}if(fireEvent&&(value!==this.values[index])){this.trigger("move",index,value,data);
thumb.getElementsByTagName("span")[0].innerHTML="<i></i>"+this.format(value);thumb.setAttribute("data-value",this.format(value));this.values[index]=value}return thumb},selection:function(index,value){if(typeof(index)!=="undefined"){if(typeof(value)!=="undefined"){this.options.selection[index]=value}return this.options.selection[index]}else{return this.options.selection.slice(0)}},round:function(position,returnIndexInstead){var min,max,i,p;if(position<=this.options.rangeStarts){return returnIndexInstead?0:this.options.rangeStarts
}if(position>=this.options.rangeEnds){return returnIndexInstead?this.options.positions.length-1:this.options.rangeEnds}for(i=1;i<this.options.positions.length;i++){if(position<this.options.positions[i]){min=this.options.positions[i-1];max=this.options.positions[i];p=(position-min)*1/(max-min);if(returnIndexInstead){return Math.round(p)+i-1}return Math.round(p)*(max-min)+min}}},positionToIndex:function(position){return this.round(position,true)},positionToX:function(position){if(position<=this.options.rangeStarts){return 0
}if(position>=this.options.rangeEnds){return 100}var index=this.round(position,true);return 100*index/(this.options.positions.length-1)},xToPosition:function(x){if(x<=0){return this.options.positions[0]}if(x>=100){return this.options.positions[this.options.positions.length-1]}return this.options.positions[Math.round(x*(this.options.positions.length-1)/100)]},count:function(min,max){var positions=arguments.length?arguments:this.selection().slice(0),counts=[],fromIndex,toIndex,i,count,loop;for(loop=0;loop<positions.length-1;
loop++){fromIndex=this.round(positions[loop],true);toIndex=this.round(positions[loop+1],true);for(i=fromIndex,count=0;i<toIndex;i++){count+=this.options.counts[i]}counts.push(count+this.options.boundaryCounts[toIndex-1])}return counts},snap:function(thumb,fireEvent){var position=this.xToPosition(parseFloat(thumb.style[this.config.STYLE_LEFT])),index=parseInt(thumb.getAttribute("data-index"),10);thumb.getElementsByTagName("span")[0].innerHTML="<i></i>"+this.format(position);thumb.setAttribute("data-value",this.format(position));
this.selection(index,position);this.moveThumb(thumb,this.positionToX(position));if(fireEvent){this.changed()}},changed:function(){var selection=this.selection().join(","),eventData;if(this.previousSelection!==selection){this.previousSelection=selection;eventData={selection:this.selection()};if(eventData.selection.length>1){eventData.counts=this.count.apply(this,eventData.selection)}this.delayed("change",eventData)}},delayed:function(event,data){var args=Array.prototype.slice.call(arguments,0);if(!this.eventTimers){this.eventTimers={}
}if(this.eventTimers[event]){clearTimeout(this.eventTimers[event])}this.eventTimers[event]=setTimeout(proxy(function(){this.trigger.apply(this,args);this.eventTimers[event]=null},this),350)},trigger:function(event,data){if(typeof(this.options[event])==="function"){this.options[event].apply(this,Array.prototype.slice.apply(arguments,[1]))}},format:function(value){return this.options.format?this.options.format(value):this.defaultFormat(value)},defaultFormat:function(value){if(this.options.divisor>1){var decimals=this.options.hasOwnProperty("decimals")?this.options.decimals:Math.floor(Math.log(this.options.divisor)/Math.LN10),decmul=Math.pow(10,decimals),sgn=value<0?"-":"",divided=Math.round(Math.abs(value)*decmul*1/this.options.divisor)/decmul,whole=Math.floor(divided),fraction=(divided-whole).toString();
while(fraction.length<decimals){fraction+="0"}return sgn+(this.options.prefix||"")+whole+(decimals>0?"."+fraction:"")+(this.options.suffix||"")}else{return(value<0?"-":"")+(this.options.prefix||"")+Math.abs(value)+(this.options.suffix||"")}},formatCount:function(count){return this.options.formatCount?this.options.formatCount(count):count}}}());