"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor){descriptor.writable=true}Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps){_defineProperties(Constructor.prototype,protoProps)
}if(staticProps){_defineProperties(Constructor,staticProps)}return Constructor}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o){return}if(typeof o==="string"){return _arrayLikeToArray(o,minLen)
}var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor){n=o.constructor.name}if(n==="Map"||n==="Set"){return Array.from(o)}if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)){return _arrayLikeToArray(o,minLen)}}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter)){return Array.from(iter)}}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){return _arrayLikeToArray(arr)}}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length){len=arr.length
}for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}var wrapperFunction=function wrapperFunction(){var replacementTags={source_ip:"123__SI__321",id:"123__I__321",country_code:"123_CC_321",country_name:"123_CN_321",city:"123_C_321",latitude:1235845367,longitude:123578136};Object.freeze(replacementTags);var waitInterval="5000"||5000;var requiredStringKeys=["name","entryType","initiatorType","nextHopProtocol","destination_host","source_url","customer","requestType"].concat(_toConsumableArray(Object.keys(replacementTags)));
var requiredNumericKeys=["startTime","duration","workerStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","transferSize","id","timestamp"];function isProduction(){return"PROD".toLocaleLowerCase()==="prod"}function getStaticData(){var staticData=window.SLI&&window.SLI.performanceMetricsData;if(!staticData){logErrorIfNotProduction("window.SLI.performanceMetricsData is not populated");
staticData={destination_host:"UNKNOWN",customer:"UNKNOWN"}}return staticData}function logErrorIfNotProduction(err){if(!isProduction()){console.error(err)}}var MetricSender=function(){function MetricSender(){_classCallCheck(this,MetricSender);this.endIndex={};this.runningTimeout=null;this.waitInterval=waitInterval}_createClass(MetricSender,[{key:"urlHasBeaconFile",value:function urlHasBeaconFile(url){var urlLower=url.toLocaleLowerCase();return urlLower.indexOf("/b.png")>=0||urlLower.indexOf("/s.png")>=0||urlLower.indexOf("/s.js")>=0
}},{key:"setEntryTypeAndFilterUnneded",value:function setEntryTypeAndFilterUnneded(entries){var _this=this;return entries.filter(function(entry){if(!"https://d1sli6mdgqv6ph.cloudfront.net/performance-entry"){return true}var nameLower=entry.name.toLocaleLowerCase();var entryTypeLower=entry.entryType.toLocaleLowerCase();if(nameLower==="https://d1sli6mdgqv6ph.cloudfront.net/performance-entry".toLocaleLowerCase()){return false}else{if(nameLower.indexOf("rt=rac")>=0){entry.requestType="rac";return true}else{if(nameLower.indexOf("search?")>=0||nameLower.indexOf("search/go")>=0){entry.requestType="fullsearch";
return true}else{if(_this.urlHasBeaconFile(nameLower)){entry.requestType="beacon";return true}else{if(entryTypeLower==="navigation"&&window.location.href.split("/").length<=4){entry.requestType="root-page";return true}}}}}return false})}},{key:"getUniqueId",value:function getUniqueId(){return Math.random().toString().replace("0.","")+new Date().getTime().toString()}},{key:"addDatapointsToEntries",value:function addDatapointsToEntries(entries){var staticData=getStaticData();return entries.map(function(entry){var objectToAssignTo={};
for(var key in replacementTags){objectToAssignTo[key]=replacementTags[key]}for(var _key in staticData){objectToAssignTo[_key]=staticData[_key]}objectToAssignTo.source_url=window.location.href;objectToAssignTo.timestamp=Math.floor(new Date().getTime()/1000);for(var entryKey in entry){objectToAssignTo[entryKey]=entry[entryKey]}return objectToAssignTo})}},{key:"getNewData",value:function getNewData(){var resourceData=this.getNewDataByType("resource");var navigationData=this.getNewDataByType("navigation");return resourceData.concat(navigationData)
}},{key:"getNewDataByType",value:function getNewDataByType(type){this.endIndex[type]=this.endIndex[type]||0;var entries=window.performance.getEntriesByType(type);if(entries.length<this.endIndex[type]){logErrorIfNotProduction("Resource entries were cleared by another process. Data may have been missed");this.endIndex[type]=0}var newEntries=entries.slice(this.endIndex[type]);var entriesJson=newEntries.map(function(entry){var outputEntry={};for(var key in entry){outputEntry[key]=entry[key]}return outputEntry});
this.endIndex[type]=entries.length;var filteredEntries=this.setEntryTypeAndFilterUnneded(entriesJson);var wholeEntries=this.addDatapointsToEntries(filteredEntries);return wholeEntries}},{key:"supportsGetEntriesByType",value:function supportsGetEntriesByType(){return window.performance&&window.performance.getEntriesByType}},{key:"startContinuousRun",value:function startContinuousRun(){if(!this.supportsGetEntriesByType()){logErrorIfNotProduction("browser does not support performance.getEntries")}var newThis=this;
this.queueRun(function(err){if(err){logErrorIfNotProduction(err)}newThis.startContinuousRun()})}},{key:"queueRun",value:function queueRun(done){var _this2=this;this.runningTimeout=setTimeout(function(){try{_this2.run();done()}catch(err){logErrorIfNotProduction(err);done(err)}},this.waitInterval)}},{key:"sendDataWithBeacon",value:function sendDataWithBeacon(body){if("sendBeacon" in navigator){return navigator.sendBeacon("https://d1sli6mdgqv6ph.cloudfront.net/performance-entry",body)}else{return false}}},{key:"formatBody",value:function formatBody(data){var outputArr=[];
data.forEach(function(entry){var outputEntry={};requiredNumericKeys.forEach(function(key){outputEntry[key]=entry[key];if(typeof outputEntry[key]==="undefined"||outputEntry[key]==null){outputEntry[key]=-1}});requiredStringKeys.forEach(function(key){outputEntry[key]=entry[key];if(!outputEntry[key]){outputEntry[key]=""}});outputArr.push(outputEntry)});return JSON.stringify(outputArr)}},{key:"run",value:function run(){var data=this.getNewData();var body=this.formatBody(data);if(!data.length){return}if(!this.sendDataWithBeacon(body)){logErrorIfNotProduction("no beacon to send body: "+body)
}}}]);return MetricSender}();var metricSender=new MetricSender();if(!undefined){metricSender.startContinuousRun()}else{global.MetricSender=MetricSender}};try{wrapperFunction()}catch(err){};