// Fanplayr Adaptor (entirelypets) v1.0.2
!function t(e,a,r){function o(i,s){if(!a[i]){if(!e[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(n)return n(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var p=a[i]={exports:{}};e[i][0].call(p.exports,function(t){var a=e[i][1][t];return o(a?a:t)},p,p.exports,t,e,a,r)}return a[i].exports}for(var n="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(t,e,a){var r,o=t("__hodor/adaptor.js"),n=(t("__hodor/config.js"),t("__hodor/platform.js")),i=n.config,s=t("__hodor/state.js"),c=t("__hodor/stash.js"),l=t("__hodor/utils.js"),p=t("__hodor/capabilities.js"),d=t("__hodor/jquery.js"),u=t("__hodor/json.js"),f=s.user,y=s.page,m=s.cart,h=s.order,_=o.log,v=document.location.pathname.toLowerCase(),g=document.location.search.toLowerCase(),x=document.location.host,b=window;m.cartAction="repeat",h.cartAction="repeat",y.type="page";var w=!1,j=!1;if(i.storeDomain=x,x.indexOf("yahoo.net")>-1&&v.indexOf("/natural-pets/")>-1&&(i.storeDomain="naturalpets.com",w=!0),x.indexOf("entirelypets")>-1?p.applyToCartUrl="https://secure.entirelypets.com/entirelypets/ymix/MetaController.html?ysco_key_event_id=1&ysco_key_store_id=entirelypets&sectionId=ysco.ship-bill#coupon=%c":p.applyToCartUrl="https://secure.healthypets.com/healthypetscom/ymix/MetaController.html?ysco_key_event_id=1&ysco_key_store_id=healthypetscom&sectionId=ysco.ship-bill#coupon=%c",w&&(p.applyToCartUrl="https://us-dc1-order.store.yahoo.net/natural-pets/ymix/MetaController.html?ysco_key_event_id=1&ysco_key_store_id=natural-pets&sectionId=ysco.ship-bill#coupon=%c"),"/"===v&&(y.type="home"),b.csell_page_data&&"prod"===b.csell_page_data.bt&&(y.type="cat",(d(".order-form").length>0||d("#producto-detalles").length>0)&&(y.type="prod")),("CART"===b.currentPage||d("#ys_cartInfo").length>0||b.csell_page_data&&"c1"===b.csell_page_data.bt)&&(y.type="cart"),(d("#ys_buyerInfo").length&&(d("#vwcf-entirelypets-Promo-Code").length||d("#vwcf-healthypetscom-Promo-Code").length)||"CHECKOUT"===b.currentPage)&&(y.type="checkout"),d("#gc-redemption-code").length&&d("#ys_shipBillShippingInfo").length&&(y.type="checkout"),w&&d("#ys_review").length&&(j=!0),g.indexOf("sectionid=ysco.confirm")>-1&&(y.type="order"),"cat"===y.type&&y.categories.add(window.csell_page_data.ii,d(".section-title").text()||window.csell_page_data.ii),"prod"===y.type){var C=d(".breadcrumbs a:last").attr("href")||d(".yst-breadcrumbs a:last").attr("href");r=C.match(/([^\/]+).html/);var k=r&&r[1],F=d(".breadcrumbs a:last").text()||d(".yst-breadcrumbs a:last").text();y.categories.add(k,F);var E=y.product;E.categories.add(k,F),E.id=window.csell_page_data.ii,E.sku=window.csell_page_data.ii,E.name=d.trim(d("h1.item-title").text())||d.trim(d("h1#item-title").text()),E.price=l.parseFloat(d(".sale-price").text()),E.url=b.location.href,E.image=d(".main-image").attr("src")||d(".etalage_magnifier img").attr("src")||d("#producto-foto img").attr("src")}if("cart"===y.type){if(m.cartAction="override",!d(".ys_cartEmpty").length){var q=!1;d("#ys_cart tbody tr").each(function(){if(!q){var t=d(this);if(t.hasClass("ys_updateQty"))return void(q=!0);var e=t.find(".ys_itemInfo a:first"),a=e.attr("href");r=a.match(/\/([^\/]+).html$/);var o=r&&r[1],n=d.trim(e.text()),i=l.parseFloat(t.find(".ys_unitPrice").text()),s=t.find(".ys_quantity input").val(),p=t.find("img:first").attr("src");m.products.add({id:o,sku:o,name:n,price:i,quantity:s,image:p,url:a}),w&&d("#cart-coupon-savings").length&&(m.discount=l.parseFloat(d("#cart-coupon-savings").text()),m.discountCode=c.get("discountCode"))}})}m.updateTotals(),c.set("cart",u.stringify(m)),c.save()}if("checkout"===y.type){var T=d(x.indexOf("entirelypets")>-1?"#vwcf-entirelypets-Promo-Code":"#vwcf-healthypetscom-Promo-Code");w&&(T=d("#gc-redemption-code"));var A=d("#new-promo-apply-button");T.length&&A.length&&setInterval(function(){r=document.location.hash.match(/coupon=([^&]+)/),r&&(c.set("discountCode",r[1]),c.save(),document.location.hash="",T.val(r[1]),A.trigger("click"))},100);var I=c.get("cart"),M=null;try{M=u.parse(I)}catch(O){_("Error getting cart details")}if(M){m.cartAction="override";for(var P=0;P<M.products.length;P++)m.products.add(M.products[P]);m.updateTotals()}else m.gross=l.parseFloat(d(".ys_basket tbody tr:eq(1) td:last").text());w?(T.on("keydown keyup change",function(){c.set("discountCode",T.val()),c.save()}),d("#cart-coupon-savings").length?(m.discount=l.parseFloat(d("#cart-coupon-savings").text()),m.discountCode=c.get("discountCode")):(c.set("discountCode",""),c.save())):(m.discount=l.parseFloat(d("#pm-discount-value").text())||l.parseFloat(d("#side-cart-promos td:last").text())||0,r=d("#side-cart-promos .ys_items").text().match(/\(([^\)]+)\)$/),m.discountCode=r&&r[1]||"")}if("order"===y.type||j||n.trackPage(),"order"===y.type){r=g.match(/ysco_key_order_id=([^&]+)/),h.id=r&&r[1]||d("input[name=ysco_key_order_id]").val(),h.number=h.id,h.shipping=l.parseFloat(d("#cart-ship-rate").text()),h.tax=l.parseFloat(d("#cart-tax-rate").text()),h.email=d.trim(d("#ys_billToEmail").text());var H=d.trim(d(".ys_name:last").text());if(H){var N=H.split(" ");f.firstName=N.shift(),f.lastName=N.join(" "),f.email=h.email}n.trackOrder()}},{"__hodor/adaptor.js":2,"__hodor/capabilities.js":4,"__hodor/config.js":5,"__hodor/jquery.js":8,"__hodor/json.js":9,"__hodor/platform.js":11,"__hodor/stash.js":12,"__hodor/state.js":13,"__hodor/utils.js":14}],2:[function(t,e,a){"use strict";function r(e){if(!d){d=!0,c.accountKey&&(e.platform.config.accountKey=c.accountKey);var a=e.require("platform/utils");for(var r in a)l[r]=a[r];n.createStash=e.require("platform/stash").create;var o=n.stash=n.createStash(l.merge({name:"adaptor",scope:"domain"},c.stash||{}));n.fanplayr=e,n.$=e.$,n._=l,o.load(function(){var a=t("__project/main.js");e.adaptor=l.merge({},n,a||{}),n.emit("ready",e,e.$,l)})}}var o=t("./emitter"),n=e.exports={},i=window.fanplayr=window.fanplayr||{};n.api=window.fanplayr_api=window.fanplayr_api||[],o.mixin(n);var s=n.log=t("./log"),c=n.config=t("./config"),l=n.utils=t("./utils");n.isInFrame=function(){var t=!0;try{var e=window;t=e.top===e||e.top===e.self||!e.frameElement}catch(a){}return!t};var p=c.collector;c.version&&(n.version=c.version);var d;if(!i.adaptor||p){i.adaptor=n;var u=function(){t("./fanplayr-init")(r,n.environment)},f=t("__hodor/boot.js");"function"==typeof f?f(u):setTimeout(u,0)}else{s("Adaptor already loaded. Skip.");var y=i.adaptor&&i.adaptor.onReload;"function"==typeof y&&y()}},{"./config":5,"./emitter":6,"./fanplayr-init":7,"./log":10,"./utils":14,"__project/main.js":1,"__hodor/boot.js":3}],3:[function(t,e,a){"use strict"},{}],4:[function(t,e,a){"use strict";e.exports=t("./adaptor").fanplayr.platform.capabilities},{"./adaptor":2}],5:[function(t,e,a){"use strict";e.exports={type:"adaptor",name:"entirelypets",version:"1.0.2",accountKey:"b5b3069429853099d809f6108f13e262",adaptorVersion:1}},{}],6:[function(t,e,a){"use strict";function r(){this.events={},this.emitCache={}}var o=Array.prototype.slice;r.mixin=function(t){var e=new r;return t.on=function(){return e.on.apply(e,o.call(arguments))},t.emit=function(){return e.emit.apply(e,o.call(arguments))},t.$emitter=e,t},r.prototype={on:function(t,e,a){var r=this;if("function"==typeof e){var o=a;a=e,e=o}e||(e={});var n=r.events[t];n||(n=r.events[t]=[]);var i={options:e,cb:a};if(e.init){var s=r.emitCache[t];s&&r.invoke(i,s)}n.push(i)},emit:function(t){var e=this,a=o.call(arguments,1);e.emitCache[t]=a;var r=e.events[t];if(r)for(var n=0,i=r.length;n<i;n++)e.invoke(r[n],a)},invoke:function(t,e){t.cb.apply(t.options.context||t.cb,e)}},e.exports=r},{}],7:[function(t,e,a){"use strict";t("./log");e.exports=function(t,e){!function(a,r){var o=a.fanplayr,n="fanplayr_ready";if(o){var i=o._loadState;2===i&&t(o);var s=a[n];if(a[n]=function(e,a){s&&s(e,a),t(e)},!i){var c=r.createElement("script");c.async=!0,c.src="//d38nbbai6u794i.cloudfront.net/client/"+(e||"production")+"/loader.js";var l=r.getElementsByTagName("script")[0];l?l.parentNode.insertBefore(c,l):r.body.appendChild(c)}}}(window,document)}},{"./log":10}],8:[function(t,e,a){"use strict";e.exports=t("./adaptor").fanplayr.$},{"./adaptor":2}],9:[function(t,e,a){"use strict";e.exports=t("./adaptor").fanplayr.require("platform/json")},{"./adaptor":2}],10:[function(t,e,a){"use strict";function r(t){var e=s;return n&&(e="function"==typeof n.bind?n.bind(o,"["+t+"]"):function(){var e=Array.prototype.slice.call(arguments);e.unshift("["+t+"]"),n(e.join(""))}),e.create=r,e.info=e,e.error=e,e}var o,n;try{o=window.console||window.top.console,n=o&&o.log}catch(i){}var s=function(){};e.exports=r("adaptor")},{}],11:[function(t,e,a){"use strict";e.exports=t("./adaptor").fanplayr.platform},{"./adaptor":2}],12:[function(t,e,a){"use strict";e.exports=t("./adaptor").stash},{"./adaptor":2}],13:[function(t,e,a){"use strict";e.exports=t("./adaptor").fanplayr.platform.state},{"./adaptor":2}],14:[function(require,module,exports){"use strict";function _parseFloat(t,e,a){"undefined"==typeof e&&(e=_parseFloat.defaultValue),a=a||_parseFloat.chars,t=String(t);var r=e;if(t){var o=new RegExp("(-?["+a.substr(0,2)+"]?\\d+[0-9"+a+"]*)"),n=t.match(o);if(n){var i=a.charAt(0);if(a.length>2&&(i+=a.substr(2)),o=new RegExp("["+i+"]","g"),t=n[1].replace(o,""),r=parseFloat(t.replace(a.charAt(1),".")),isNaN(r))return e}}return r}var _=module.exports={},log=require("./log");_.parseInt=function(t,e){var a=_parseFloat(t,e);return"number"==typeof a?Math.floor(a):a},_.parseFloat=_parseFloat,_parseFloat.defaultValue=0,_parseFloat.chars=",.";var decodeHtmlEl;_.decodeHtml=function(t){return t?(decodeHtmlEl||(decodeHtmlEl=document.createElement("div")),decodeHtmlEl.innerHTML=t,decodeHtmlEl.firstChild.nodeValue):t},_.waitUntil=function(evaluate,intervalMs,callback){if(2===arguments.length&&(callback=intervalMs,intervalMs=500),"string"==typeof evaluate){var evalPath=evaluate;evaluate=function evaluate(){return eval(evalPath)}}var iterator=function t(){var e=evaluate();e?callback(e):setTimeout(t,intervalMs)};iterator()}},{"./log":10}]},{},[2]);
//# sourceMappingURL=adaptor.js.map
