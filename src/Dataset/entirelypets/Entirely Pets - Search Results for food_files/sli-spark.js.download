(function(){var undef=false,clientId=1876,siteId=1,defaultCookieExpiry=63072000,configCookieDomain=undef,beaconUserIdCookieName="SLIBeacon",configSession1CookieName="SLI1",configSession2CookieName="SLI2",configLastSearchCookieName="SLI4",configDataStoreCookieName="SLI5",configSyncCookieName="SLISYNC",configCookieLifeSync=604800,beaconUrl="b.sli-spark.com/b.png?",beacon3pScriptUrl="b.sli-spark.com/"+clientId+"/"+siteId+"/s.js?",beacon3pImageUrl="b.sli-spark.com/"+clientId+"/"+siteId+"/s.png?",write3p=false,eventCount=0,beaconUserIdCallbacks=[],beaconUserIdCallTimeout=undef,currentAction=undef,skus=[],products=[],refinements=[],extraFields={},customFields=[],pageTypeInferences=[],pageTypeOverride=undef,debugCallback,banners=[],inflightRequests={},idleCallbacks=[],pageId=new Date().getTime(),takeSiteSpeedSample=1&&1>=(Math.floor(Math.random()*100)+1),privacyCookieName="SLIData",privacy=false,privacyValue=undef,recentlyViewedCookieName="sli-rv",recentlyViewedCookieExpiry=365*24*60*60,maxRecentlyViewed=10,recentRefinementsCookieName="sli-rr",recentRefinementsCookieExpiry=365*24*60*60,maxRecentRefinements=10,mvtCookieName="_mvt_"+clientId+"-1",mvtCookieExpiry=365*24*60*60*2,mvtCustomFieldName="slimvt",totalCookiePayloadLimit=4093,conversionTrackerCompatMode=true,version="21.2";
var cookiesToHash={};if(conversionTrackerCompatMode){cookiesToHash[beaconUserIdCookieName]=1;cookiesToHash[configSession1CookieName]=1;cookiesToHash[configSession2CookieName]=1;cookiesToHash[configLastSearchCookieName]=1}Date.now=Date.now||function(){return +new Date};function toJson(value){if(window.Prototype&&value instanceof Array){var json=JSON.stringify(value);if(typeof Array.prototype.toJSON==="function"){var arrayToJson=Array.prototype.toJSON;delete Array.prototype.toJSON;json=JSON.stringify(value);Array.prototype.toJSON=arrayToJson
}return json}else{return JSON.stringify(value)}}function euc(value){return encodeURIComponent(value)}function duc(value){return decodeURIComponent(value)}var cookie=new function(){var identifier=undef,fletcher32=function(str){var sum1=65535,sum2=65535;for(var i=0,iTop=str.length;i<iTop;i++){sum2+=sum1+=str.charCodeAt(i)}sum1=(sum1&65535)+(sum1>>16);sum2=(sum2&65535)+(sum2>>16);return"_"+Math.abs(sum2<<16|sum1)},getCookieDomain=function(){if(configCookieDomain){if(identifier==undef){identifier=fletcher32(configCookieDomain)
}return configCookieDomain}var parts=document.domain.split(".");var subDomain=parts[parts.length-1];var cookie="sli_domain_locator";for(var i=parts.length-2;i>=0;i--){subDomain=parts[i]+"."+subDomain;setInner(cookie,"s",-1,subDomain);if(getInner(cookie)!==undef){setInner(cookie,"s",0,subDomain);configCookieDomain=subDomain;identifier=fletcher32(subDomain);break}}return configCookieDomain},setInner=function(name,value,expiry_delta,domain){var d=new Date(),cookie_str=undef,exp_str=";";if(expiry_delta>=0){d=new Date();
d.setSeconds(expiry_delta);exp_str="; expires="+d.toGMTString()}cookie_str=name+"="+value+exp_str+"; path=/; domain="+domain+"; SameSite=None; Secure;";document.cookie=cookie_str;return cookie_str},getInner=function(cookieName){var value=undef;var reg=new RegExp(cookieName+"\\s*=\\s*([^\\s;$]*)\\s*(?:;|$)","g");var returned=reg.exec(document.cookie);if(returned===null){return value}value=returned[1];return value};this.del=function(name){var domain=getCookieDomain();setInner(name+identifier,"",0,domain);setInner(name,"",0,domain)
};this.set=function(name,value,expiry_delta){var domain=getCookieDomain();if(!expiry_delta){expiry_delta=defaultCookieExpiry}if(privacy){value="";expiry_delta=0}setInner(name,value,expiry_delta,domain);if(conversionTrackerCompatMode&&cookiesToHash[name]){setInner(name+identifier,value,expiry_delta,domain)}};this.get=function(cookieName){var cookie=getInner(cookieName);if(cookie===undef){getCookieDomain();cookieName+=identifier;cookie=getInner(cookieName)}return cookie}}();var recentRefinementsStore=new function(){this.add=function(refinements){if(maxRecentRefinements==0){return
}var recentRefinements=this.get();for(var i=0;i<refinements.length;i++){var refinement=refinements[i];if(refinement.selected!==true){continue}var entry=Math.round(Date.now()/1000)+","+refinement.id+":"+refinement.value;recentRefinements.unshift(entry)}while(recentRefinements.length>maxRecentRefinements){recentRefinements.pop()}cookie.set(recentRefinementsCookieName,euc(toJson(recentRefinements)),recentRefinementsCookieExpiry)};this.get=function(){var recentRefinements=cookie.get(recentRefinementsCookieName);
if(recentRefinements){try{recentRefinements=JSON.parse(duc(recentRefinements));if(!(recentRefinements instanceof Array)){console.warn("Recent refinements data got corrupted - discarding");recentRefinements=[]}}catch(err){console.warn("Recent refinements data got corrupted - discarding"+err);recentRefinements=[]}}else{recentRefinements=[]}return recentRefinements}}();var recentlyViewedStore=new function(){this.add=function(products){if(maxRecentlyViewed==0){return}var recentlyViewed=this.get();for(var i=0;i<products.length;
i++){var sku=euc(products[i].id);for(var j=0;j<recentlyViewed.length;j++){var recentViewParts=recentlyViewed[j].split(",");if(recentViewParts.length<2||recentViewParts[1]==sku){recentlyViewed.splice(j,1)}}var entry=Math.round(Date.now()/1000)+","+sku;recentlyViewed.unshift(entry)}while(recentlyViewed.length>maxRecentlyViewed){recentlyViewed.pop()}cookie.set(recentlyViewedCookieName,euc(toJson(recentlyViewed),recentlyViewedCookieExpiry))};this.get=function(){var recentlyViewed=cookie.get(recentlyViewedCookieName);
if(recentlyViewed){try{recentlyViewed=JSON.parse(duc(recentlyViewed));if(!(recentlyViewed instanceof Array)){console.warn("Recently viewed data got corrupted - discarding");recentlyViewed=[]}}catch(err){console.warn("Recently viewed data got corrupted - discarding"+err);recentlyViewed=[]}}else{recentlyViewed=[]}return recentlyViewed}}();privacyValue=cookie.get(privacyCookieName);if(privacyValue==="0"){privacy=true;cookie.set(beaconUserIdCookieName,"",0);cookie.set(configSession1CookieName,"",0);cookie.set(configSession2CookieName,"",0);
cookie.set(configLastSearchCookieName,"",0);cookie.set(configDataStoreCookieName,"",0);cookie.set(configSyncCookieName,"",0);cookie.set(recentlyViewedCookieName,"",0);cookie.set(recentRefinementsCookieName,"",0)}function mimicLegacySession(beaconUserId){cookie.del(configSession1CookieName);cookie.del(configSession2CookieName);cookie.del(configLastSearchCookieName);return beaconUserId+"."+pageId+".0.0"}function inferPageType(gaType){if(pageTypeOverride){return pageTypeOverride}else{switch(gaType){case"purchase":return"transaction";
case"detail":return"product";default:for(var i=0;i<pageTypeInferences.length;i++){if(document.location.href.match(pageTypeInferences[i].regex)){return pageTypeInferences[i].pageType}}}}return"unknown"}function beaconUserIdCall(){var beaconUserId=cookie.get(beaconUserIdCookieName);if(Object.keys(inflightRequests).length>0){return}if(!beaconUserId){var q="custCode="+euc(clientId);q+="&siteId="+euc(siteId);q+="&errorType="+euc("track_call_timeout");callScript(q)}else{processBeaconCallBacks(beaconUserId)}}function generateID(){var id="";
for(var i=0;i<9;i++){id+=String.fromCharCode(65+Math.round(Math.random()*25))}id+=(new Date().getTime());for(i=0;i<9;i++){id+=String.fromCharCode(65+Math.round(Math.random()*25))}return id}function track(){if(beaconUserIdCallTimeout){clearTimeout(beaconUserIdCallTimeout);beaconUserIdCallTimeout=undef}eventCount+=1;var q="custCode="+euc(clientId);q+="&siteId="+euc(siteId);q+="&env="+euc("prod");var beaconUserId;if(privacy){beaconUserId="p"+generateID();window.sliSpark("sli:setBeaconUserId",beaconUserId,true)}else{beaconUserId=cookie.get(beaconUserIdCookieName)
}if(extraFields.pageType=="unknown"){if(!beaconUserId){q+="&v="+euc(version);callScript(q)}else{if(write3p&&!privacy){var session=mimicLegacySession(beaconUserId);q+="&sessionId="+euc(session);q+="&logtype=set3p";q+="&pageType="+euc(extraFields.pageType);q+="&v="+euc(version);callImage(q);beaconUserId="f"+generateID();setBeaconUserId(beaconUserId,true)}}return}if(beaconUserId){cookie.set(beaconUserIdCookieName,beaconUserId);var session=mimicLegacySession(beaconUserId);q+="&sessionId="+euc(session)}q+="&eventCount="+euc(eventCount);
if(top&&top.document&&top.document.referrer){q+="&referrer="+euc(top.document.referrer)}else{if(document&&document.referrer){q+="&referrer="+euc(document.referrer)}}var productList=[];for(var i=0,j=products.length;i<j;i++){var product=products[i];productList.push("("+euc(product.id)+"|"+euc(product.quantity)+"|"+euc(product.price)+")")}if(productList.length>0){extraFields.items="u"+productList.join(";")}for(var property in extraFields){if(extraFields.hasOwnProperty(property)&&extraFields[property]){q+="&"+property+"="+euc(extraFields[property])
}}var mvtData=cookie.get(mvtCookieName);if(mvtData){removeCustomField(mvtCustomFieldName);addCustomField(mvtCustomFieldName,duc(mvtData))}if(customFields.length){var cf="";for(var i=0;i<customFields.length;i++){cf+="("+euc(customFields[i].name)+":"+euc(customFields[i].value)+")";if(i<customFields.length-1){cf+=";"}}q+="&customFields=u"+euc(cf)}var perf=window.performance;perf=perf&&perf.timing;if(perf&&perf.navigationStart&&extraFields.logtype=="pageview"){q+="&ttfb="+(perf.responseStart-perf.domainLookupStart);
if(takeSiteSpeedSample){var pageType=extraFields.pageType;var numRetries=5;var initialBackoff=500;var multiplier=2;var writeTimingLog=function(retries,backoff){var tti=(window.performance.timing.domInteractive-window.performance.timing.navigationStart);if(tti>0||retries<=0){window.sliSpark("sli:onBeaconUserId",function(beaconUserId,pageId,extra){var timingQuery="custCode="+euc(clientId);timingQuery+="&siteId="+euc(siteId);timingQuery+="&env="+euc("prod");timingQuery+="&pageType="+euc(pageType);timingQuery+="&logtype=timing";
timingQuery+="&sessionId="+euc(beaconUserId+"."+pageId+"."+extra);timingQuery+="&tti="+tti;timingQuery+="&v="+euc(version);callImage(timingQuery)})}else{setTimeout(function(){writeTimingLog(--retries,backoff*multiplier)},backoff)}};if(perf.domInteractive){setTimeout(function(){writeTimingLog(numRetries,initialBackoff)},1)}else{window.addEventListener("load",writeTimingLog(numRetries,initialBackoff))}takeSiteSpeedSample=false}}if(skus.length>0){var sku=euc(skus.join(";"));var qLong=q+"&sku="+sku;if(qLong.length>1930){q+="&sku=";
for(var i=0,j=skus.length;i<j;i++){var append="";if(i!=0){append=";"}append+=skus[i];append=euc(append);if(append.length+q.length<=1900){q+=append}else{var remaining=j-i;q+="&errorType=url_too_long&lost="+remaining;break}}}else{q=qLong}}if(privacyValue!==undef){q+="&p="+euc(privacyValue)}q+="&v="+euc(version);if(beaconUserId){callImage(q);skus=[];products=[];var bannersLocal=banners;banners=[];for(var i=0;i<bannersLocal.length;i++){var banner=bannersLocal[i];extraFields.logtype="event";extraFields.pageType="bannerview";
delete extraFields.sku;removeCustomFields(["bannerId","bannerName","bannerLocation","creativeId"]);for(var property in banner){if(banner.hasOwnProperty(property)&&banner[property]){customFields.push({name:property,value:banner[property]})}}track()}}else{callScript(q)}processBeaconCallBacks(beaconUserId);products=[];skus=[]}function drainCookieStore(){var dataStoreCookie=cookie.get(configDataStoreCookieName);if(dataStoreCookie){var events=dataStoreCookie.split("?");for(var i=0;i<events.length;i++){if(events[i]&&!inflightRequests[events[i]]){callImage(events[i],true)
}}}}function addStoreRequest(path){var dataStoreCookie=cookie.get(configDataStoreCookieName);if(!dataStoreCookie){dataStoreCookie=""}if(dataStoreCookie.indexOf(path)==-1&&(document.cookie.length+path.length)<totalCookiePayloadLimit){dataStoreCookie+=path+"?";cookie.set(configDataStoreCookieName,dataStoreCookie)}inflightRequests[path]=1}function removeStoreRequest(path){var dataStoreCookie=cookie.get(configDataStoreCookieName);delete inflightRequests[path];if(dataStoreCookie){dataStoreCookie=dataStoreCookie.replace(path+"?","")
}if(dataStoreCookie){cookie.set(configDataStoreCookieName,dataStoreCookie)}else{cookie.del(configDataStoreCookieName);idleCallbacks.reverse();while(idleCallbacks.length){try{idleCallbacks.pop()()}catch(e){console.error(e)}}}drainCookieStore()}function callImage(path,drain){var image;if(debugCallback){image=debugCallback}else{image=new Image(1,1)}write3p|=cookie.get(configSyncCookieName)==undef;if(privacy){write3p=false}if(write3p){cookie.set(configSyncCookieName,"1",configCookieLifeSync)}var imageUrl=write3p?beacon3pImageUrl:beaconUrl;
write3p=false;image.src="https://"+imageUrl+path+(drain?"&drain=true":"");addStoreRequest(path);image.onload=function(){removeStoreRequest(path)};image.onerror=function(){delete inflightRequests[path]}}function callScript(path){path+="&pageId="+euc(pageId);var head=document.head||document.getElementsByTagName("head")[0];var s=document.createElement("script");s.type="text/javascript";s.src="https://"+beacon3pScriptUrl+path;addStoreRequest(path);s.onload=function(){head.removeChild(s);removeStoreRequest(path)};
s.onerror=function(){delete inflightRequests[path]};head.appendChild(s)}function removeCustomField(toRemove){removeCustomFields([toRemove])}function removeCustomFields(toRemove){var toKeep=[];for(var i=0;i<customFields.length;i++){var remove=false;for(var j=0;j<toRemove.length;j++){if(toRemove[j]==customFields[i].name){remove=true;break}}if(!remove){toKeep.push(customFields[i])}}customFields=toKeep}function identifyImpressions(model){for(var i=1;;i++){var key="&il"+i+"nm";var impression=model.get(key);if(impression){for(var j=1;
;j++){var productKey="&il"+i+"pi"+j;var productId=model.get(productKey+"id");if(productId){addSku(productId)}else{break}}}else{break}}}function identifyPromos(model){for(var i=1;;i++){var key="&promo"+i+"id";var bannerId=model.get(key);if(!bannerId){break}banners.push({bannerId:bannerId,bannerName:model.get("&promo"+i+"nm"),bannerLocation:model.get("&promo"+i+"ps"),creativeId:model.get("&promo"+i+"cr")})}}function addTransaction(id,revenue,shipping,tax,currency){extraFields.logtype="transaction";pageTypeOverride="transaction";
if(id){extraFields.transactionId=id}if(revenue){extraFields.orderTotal=revenue}if(shipping){extraFields.shippingTotal=shipping}if(tax){extraFields.taxTotal=tax}if(currency){extraFields.currency=currency}}function cart(action,currency){extraFields.logtype="event";pageTypeOverride=action;if(currency){extraFields.currency=currency}}function addProduct(id,name,price,quantity,category,currency){if(!quantity){quantity=0}products.push({id:id,name:name,price:price,quantity:quantity,category:category,currency:currency})
}function addSku(id){skus.push(id)}function identifyProductsAndTransactions(model){var key="&pa";var eventType=model.get(key);var currency=model.get("&cu");if(eventType=="purchase"){addTransaction(model.get("&ti"),model.get("&tr"),model.get("&ts"),model.get("&tt"),currency)}else{if(eventType=="add"){cart("addcart",currency)}else{if(eventType=="remove"){cart("removecart",currency)}}}for(var j=1;;j++){var productKey="&pr"+j;var productId=model.get(productKey+"id");if(productId){var productQty=model.get(productKey+"qt");
var productPrice=model.get(productKey+"pr");addProduct(productId,"",productPrice,productQty)}else{break}}return eventType}function processHitType(type,model){switch(type){case"transaction":var id=model.get("&ti");addTransaction(id,model.get("&tr"),model.get("&ts"),model.get("&tt"),model.get("currencyCode"));if(id){setTimeout(stitchMultiPart,1);return false}break;case"item":addProduct(model.get("&ic"),model.get("&in"),model.get("&ip"),model.get("&iq"),model.get("&iv"),model.get("currencyCode"));if(model.get("&ti")){setTimeout(stitchMultiPart,1);
return false}break}return true}function stitchMultiPart(){if(products.length>0){extraFields.logtype="transaction";extraFields.pageType=inferPageType("purchase");track();customFields=[];extraFields={};products=[]}}function processBeaconCallBacks(beaconUserId){if(beaconUserId){beaconUserIdCallbacks.reverse();while(beaconUserIdCallbacks.length){try{beaconUserIdCallbacks.pop()(beaconUserId,pageId,"0.0")}catch(e){console.error(e)}}}}var trackerFunction=function(tracker,config,useDirect){if(tracker){useDirect=false
}this.pageType=function(pageType){pageTypeOverride=pageType};this.setBeaconUserId=function(userId,skipWrite3p){write3p=!skipWrite3p;var currentBeaconUserId=cookie.get(beaconUserIdCookieName);if(skipWrite3p){cookie.set(configSyncCookieName,"1",configCookieLifeSync)}if(write3p&&userId==currentBeaconUserId){write3p=false}if(currentBeaconUserId!=undef&&userId!=currentBeaconUserId){extraFields.replaces=currentBeaconUserId;extraFields.errorType="uid_not_visible";write3p=true}cookie.set(beaconUserIdCookieName,userId);
processBeaconCallBacks(userId)};this.setPageId=function(id){if(pageId!=id){eventCount=0}pageId=id};this.setMvt=function(mvt){cookie.set(mvtCookieName,euc(mvt.data),mvtCookieExpiry);removeCustomField(mvtCustomFieldName);addCustomField(mvtCustomFieldName,mvt.data)};this.onBeaconUserId=function(callback){var beaconUserId=cookie.get(beaconUserIdCookieName);if(beaconUserId){callback(beaconUserId,pageId,"0.0");return}else{if(!beaconUserIdCallTimeout){beaconUserIdCallTimeout=setTimeout(beaconUserIdCall,1000)}}beaconUserIdCallbacks.push(callback)
};this.onIdle=function(callback){if(Object.keys(inflightRequests).length==0&&!cookie.get(configDataStoreCookieName)){callback();return}idleCallbacks.push(callback)};this.version=function(callback){callback(version)};this.debug=function(callback,stub3pScriptUrl){debugCallback=callback;if(stub3pScriptUrl){beacon3pScriptUrl=stub3pScriptUrl}};this.addSearch=function(fields){extraFields.searchTerm=fields.keyword;extraFields.numberSearchResults=fields.totalRecords;extraFields.searchPageNumber=fields.pageNumber;extraFields.sort=fields.sort;
if(fields.refinements&&fields.refinements.length){var refinements="";for(var i=0;i<fields.refinements.length;i++){if(i>0){refinements+=" "}refinements+=fields.refinements[i].name+":"+fields.refinements[i].value}extraFields.searchRefinements=refinements}};this.addProduct=function(product){addProduct(product.id,product.name,product.price,product.quantity,product.category,product.currency)};this.addImpression=function(product){if(product.list){addSku(product.id)}};this.addRefinement=function(refinement){refinements.push(refinement)
};this.setAction=function(action,options){currentAction=action;var currency=options?options.currency:undef;switch(action){case"purchase":addTransaction(options.id,options.revenue,options.shipping,options.tax,options.currency);break;case"add":cart("addcart",currency);break;case"remove":cart("removecart",currency);break}extraFields.pageType=inferPageType(action)};this.addPromo=function(promo){banners.push({bannerId:promo.id,bannerName:promo.name,bannerLocation:promo.position,creativeId:promo.creative})};this.send=function(type){try{switch(currentAction){case"refinement_click":recentRefinementsStore.add(refinements);
break;case"detail":recentlyViewedStore.add(products);break;default:if(!extraFields.logtype){extraFields.logtype="pageview"}if(!extraFields.pageType){extraFields.pageType=inferPageType("pageview")}track()}}finally{customFields=[];extraFields={};products=[];refinements=[];currentAction=undef}};this.getQueryParams=function(callback){onBeaconUserId(function(userId){var query="";query+=beaconUserIdCookieName+"="+userId;if(cookie.get(recentRefinementsCookieName)){query+="&"+recentRefinementsCookieName+"="+euc(toJson(recentRefinementsStore.get()))
}if(cookie.get(recentlyViewedCookieName)){query+="&"+recentlyViewedCookieName+"="+euc(toJson(recentlyViewedStore.get()))}if(cookie.get(mvtCookieName)){query+="&"+mvtCookieName+"="+euc(cookie.get(mvtCookieName))}callback(query)})};this.getUserData=function(callback){getQueryParams(callback)};this.addCustomField=function(name,value){customFields.push({name:name,value:value})};function removeCustomFields(toRemove){var toKeep=[];for(var i=0;i<customFields.length;i++){var remove=false;for(var j=0;j<toRemove.length;
j++){if(toRemove[j]==customFields[i].name){remove=true;break}}if(!remove){toKeep.push(customFields[i])}}customFields=toKeep}this.set=function(name,value){if("&cu"==name){extraFields.currency=value}};var old=window.sliSpark;if(old.p){pageId=old.p}var _this=this;this.useDirect=function(){if(window.sliSpark.d){return}window.sliSpark=function(){var a=arguments;var method=a[0];if(typeof method==="function"){method()}else{method=method.replace(/^.+:/,"");Array.prototype.shift.call(a);if(_this[method]){_this[method].apply(_this,a)
}}};window.sliSpark.d=1};var initDirect=function(){this.useDirect();window.sliSpark.t=1;if(old.a){for(var i=0;i<old.a.length;i++){window.sliSpark.apply(this,old.a[i])}}};initDirect()};trackerFunction();drainCookieStore()})();