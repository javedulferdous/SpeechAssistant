_MetricalDeployment={version:"af3371948411775d79e5f4691132ca62a82f18d2",lastUpdated:"2020-10-07 20:43:57 UTC"},_MetricalHosts={legacy:{apiendpointhost:"api.getmetrical.com",staticendpointhost:"content.getmetrical.com",probabilityenginehost:"probability.getmetrical.com",probabilityenginetesthost:!1,surveyanswerendpoint:"https://hfcqk5kiya.execute-api.us-east-1.amazonaws.com/prod/postanswer",cxinteractionendpoint:"https://hfcqk5kiya.execute-api.us-east-1.amazonaws.com/prod/postcxinteraction"},endpoints:{previousVisitor:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/visit/{surveyId}/{uuid}/{sessionId}/previousVisitor",previousCustomer:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/visit/{surveyId}/{uuid}/{sessionId}/previousCustomer",coupon:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/coupon",provision:"https://g4ipuvvgf7.execute-api.us-east-1.amazonaws.com/prod/site/provision",interaction:"https://api-v2.getmetrical.com/interaction",offerFlow:"https://api-v2.getmetrical.com/offerflow",singleUseCoupon:"https://api-v2.getmetrical.com/singleusecoupon",pe:"https://api-v2.getmetrical.com/pe",offerFlowStore:"https://api-v2.getmetrical.com/offerflowstore"}};var _Metrical={startingBehavior:null,shouldDisplay:!1,showWidget:function(){return"Not active yet. Please wait."},makeVisible:function(){},addLoadEvent:function(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t&&t(),e()}},waitAdditionalJS:!1,clearCookies:function(){var e=_Metrical.app.getCookieObject();return jQuery.each(e,function(e,t){_Metrical.app.removeCookieByKey(e)}),"All Metrical cookies are cleared."},init:function(jQuery,_MetricalObject){var rootMetricalObj=this;_MetricalStorage.Cookie.addSameSiteSupport(),function(e){window.XDomainRequest&&!e.support.cors&&e.ajaxTransport(function(t){var i;if(t.crossDomain&&t.async)return t.timeout&&(t.xdrTimeout=t.timeout,delete t.timeout),{send:function(o,r){function n(t,o,n,a){i.onload=i.onerror=i.ontimeout=i.onprogress=e.noop,i=void 0,e.event.trigger("ajaxStop"),r(t,o,n,a)}(i=new XDomainRequest).open(t.type,t.url),i.onload=function(){var e=200,t=i.responseText,o=null!=i.responseText&&""!=i.responseText?JSON.parse(i.responseText):"";o.StatusCode&&o.Message&&(e=o.StatusCode,t=o.Message),n(e,t,{text:t},"Content-Type: "+i.contentType)},i.onerror=function(){n(500,"Unable to Process Data")},i.onprogress=function(){},t.xdrTimeout&&(i.ontimeout=function(){n(0,"timeout")},i.timeout=t.xdrTimeout),i.send(t.hasContent&&t.data||null)},abort:function(){i&&(i.onerror=e.noop(),i.abort())}}})}(jQuery),function($){var Logging=function(){this.logs=new Array},Metrical_options;function log(e){window.console&&MetricalApp.logging.logInfo(e)}function url_protocol(){return"https:"===document.location.protocol?"https://":"http://"}function detectmob(){return window.innerWidth<=800&&window.innerHeight<=600}function are_cookies_enabled(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(document.cookie="testcookie=1",(e=-1!=document.cookie.indexOf("testcookie"))&&(document.cookie="testcookie=1; expires=Thu, 01-Jan-1970 00:00:01 GMT")),e}function makeUUID(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)})}function _MetricalObject_did_cookie(){docCookies.hasItem("_MetricalObject_did")||(uuid=makeUUID(),date=new Date,date.setTime(date.getTime()+15768e7),docCookies.setItem("_MetricalObject_did",uuid,date,"/",docCookies.rootDomain()))}function _MetricalObject_sessionid(){docCookies.hasItem("_MetricalObject_sessionid")||(uuid=makeUUID(),docCookies.setItem("_MetricalObject_sessionid",uuid,"","/",docCookies.rootDomain()))}if(Logging.prototype.logInfo=function(e,t){this.logs.push({level:"info",message:e,object:t})},Logging.prototype.logError=function(e){this.logs.push({level:"error",object:e})},rootMetricalObj.echoLog=function(e){if(window.console){var t=0;jQuery.each(MetricalApp.logging.logs,function(i,o){if("info"==o.level?null!=o.object?console.info(o.message,o.object):console.info(o.message):"error"==o.level&&(void 0!==o.object&&o.object instanceof Error?console.error(o.object.name+" - "+o.object.message,o.object.stack):console.error("Error - ",o.object)),t++,void 0!==e&&t>=e)return!1})}return"End of logs"},rootMetricalObj.flushLog=function(){return MetricalApp.logging.logs.splice(0,MetricalApp.logging.logs.length),"Log flushed out"},Metrical_options=void 0===_MetricalObject?{}:_MetricalObject,null==Metrical_options.survey)for(var property in Metrical_options)if(Metrical_options.hasOwnProperty(property)&&"metricalid"==property.toLowerCase()){Metrical_options.survey=Metrical_options[property];break}var defaultStarsForScale=5,MetricalApp={logging:new Logging,defaultProperties:{usermeta:{},surveyanswerendpoint:_MetricalHosts.legacy.surveyanswerendpoint,cxinteractionendpoint:_MetricalHosts.legacy.cxinteractionendpoint,apiendpointhost:_MetricalHosts.legacy.apiendpointhost,staticendpointhost:_MetricalHosts.legacy.staticendpointhost,positiontype:"fixed",position:"right-top",mobilecss:null,mobilejs:null,postCallback:function(){},preInitHook:function(){},postInitHook:function(){},makeVisibleHook:function(){},afterDelayOpenedHook:function(){},preShowHook:function(){},postWidgetRender:function(){},echolog:!1,defaultstylesheet:"/css/styles.css",rendertype:null},properties:{},el:null,elTab:null,sa_container:null,tabOpenerTimer:null,tabCloserTimer:null,timedQuestionDelay:null,timedQuestionButtonAction:null,cookieName:["_MetricalObject_QA","_MetricalObject_did","_MetricalObject_transitial","_Metrical_PageViewCount","_MetricalObject_sample","_MetricalObject_tracking","_MetricalObject_sessionid","_Metrical_TimeOnSite"],transitialCookeName:"_MetricalObject_transitial",operationsTracking:{randomSample:null,metricalInitializationCount:1},instanceId:null,sampleValue:null,initTimestamp:null,pageLoadTimeOnSite:0,timeOnSiteTimer:null,generateInstanceId:function(){var e=Date.now(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)});return this.instanceId=t,MetricalApp.logging.logInfo("generated instanceId with the value "+this.instanceId),this.instanceId},generateSampleValue:function(){this.sampleValue=Math.floor(100*Math.random())},setSampleCookie:function(){docCookies.hasItem("_MetricalObject_sample")||docCookies.setItem("_MetricalObject_sample",this.sampleValue,"","/",docCookies.rootDomain())},setupTrackingObject:function(){docCookies.hasItem("_MetricalObject_tracking")&&null!=docCookies.getItem("_MetricalObject_tracking")&&""!=docCookies.getItem("_MetricalObject_tracking")?(cookieValue=docCookies.getItem("_MetricalObject_tracking"),this.operationsTracking=JSON.parse(cookieValue),this.operationsTracking.randomSample=this.sampleValue,this.operationsTracking.metricalInitializationCount++,docCookies.setItem("_MetricalObject_tracking",JSON.stringify(this.operationsTracking),"","/",docCookies.rootDomain())):(this.operationsTracking.randomSample=this.sampleValue,docCookies.setItem("_MetricalObject_tracking",JSON.stringify(this.operationsTracking),"","/",docCookies.rootDomain())),rootMetricalObj.operationsTracking=this.operationsTracking},init:function(e){this.generateInstanceId(),this.generateSampleValue(),this.setSampleCookie(),_MetricalBrowserHistory.init(),this.setupTrackingObject(),this.properties=$.extend(this.defaultProperties,e),this.properties.apiendpointhost=url_protocol()+this.properties.apiendpointhost,this.properties.staticendpointhost=url_protocol()+this.properties.staticendpointhost,MetricalApp.logging.logInfo("configured properties",this.properties),MetricalApp.logging.logInfo("metrical version",rootMetricalObj.version);if(docCookies.hasItem("_Metrical_TimeOnSite")){var t=parseInt(docCookies.getItem("_Metrical_TimeOnSite"));MetricalApp.pageLoadTimeOnSite=t}"function"==typeof this.properties.preInitHook&&this.properties.preInitHook(this),this.setCSS(),this.setInnerCss(),this.setExternalCSS(),this.setIOSSpecificCSSJS(),"function"==typeof this.properties.postInitHook&&this.properties.postInitHook(this),_MetricalTestMode.init(docCookies)},postSurveyInit:function(){this.configureDomMountPoint(),Validator.properties(this.properties),this.properties.iframe&&this.resizeParent(),this.updatePageLoads(),this.setupInteractions(),MetricalApp.timeOnSiteTimer=setInterval(function(){var e=MetricalApp.updateTimeOnSite();MetricalApp.handleTimeOnSiteEvent(e)},1e3)},identifierIsIOS:function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},determineIdentifier:function(){var e="desktop";/Touch|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=window.matchMedia("(max-width: 730px)").matches?"mobile":window.matchMedia("screen and (orientation: portrait)").matches?screen.width<=480?"mobile":"tabletvertical":screen.height<=480?"mobile":"tablethorizontal");return e},setCSS:function(){MetricalApp.logging.logInfo("Loading the base CSS files");var e=this.properties.staticendpointhost;null!=this.properties.cssendpointhost&&(e=url_protocol()+this.properties.cssendpointhost),0==$("head link[rel='stylesheet']").length?$("head").append("<link rel='stylesheet' href='"+e+"/css/reset.css' type='text/css' >"):$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+e+"/css/reset.css' type='text/css' >"),$("head link[rel='stylesheet']").last().after("\x3c!--[if lt IE 9]><link rel='stylesheet' href='"+e+"/css/styles-ie8.css' type='text/css' ><![endif]--\x3e"),$("head link[rel='stylesheet']").last().after("\x3c!--[if gte IE 9]><link rel='stylesheet' href='"+e+"/css/styles-noie8.css' type='text/css' ><![endif]--\x3e"),$("head link[rel='stylesheet']").last().after("\x3c!--[if !IE]> --\x3e<link rel='stylesheet' href='"+e+"/css/styles-noie8.css' type='text/css' ><![endif]--\x3e"),MetricalApp.properties.iframe&&$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+e+"/css/iframe.css' type='text/css' >")},setExternalCSS:function(){void 0!==MetricalApp.properties.css&&($.isArray(MetricalApp.properties.css)?$.each(MetricalApp.properties.css,function(e,t){$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+t+"' type='text/css' >")}):$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+MetricalApp.properties.css+"' type='text/css' >"))},setJS:function(){additionalJS=ClientWidget.widgetObj.js,void 0!==additionalJS&&(rootMetricalObj.waitAdditionalJS=!0,$.isArray(additionalJS)?$.each(additionalJS,function(e,t){$.getScript(t).done(function(t,i){e==additionalJS.length-1&&(rootMetricalObj.waitAdditionalJS=!1)}).fail(function(t,i,o){e==additionalJS.length-1&&(rootMetricalObj.waitAdditionalJS=!1),console.log("Triggered ajaxError handler.")})}):$.getScript(additionalJS).done(function(e,t){rootMetricalObj.waitAdditionalJS=!1}).fail(function(e,t,i){rootMetricalObj.waitAdditionalJS=!1,console.log("Triggered ajaxError handler.")}))},setInnerCss:function(){if(void 0!==this.properties.style){var e=this.properties.style,t="<style>";if(void 0!==e.buttoncolour&&(t+=".Metrical .form-list input[type='submit'] {background-color: "+e.buttoncolour+";}"),void 0!==e.buttoncolourhover&&(t+=".Metrical .form-list input[type='submit']:hover {background-color: "+e.buttoncolourhover+";}"),void 0!==e.topbordercolour&&(t+=".Metrical .lb-wrapper  {border-top: 5px solid "+e.topbordercolour+" ;}"),void 0!==e.starhovercolour&&(t+=".Metrical .form-list .ratings .star:hover {background-color: "+e.starhovercolour+";}",t+="#metrical-widget-form input[type='radio']  + label:hover {background-color: "+e.starhovercolour+";}"),void 0!==e.staractivecolour&&(t+=".Metrical .form-list .ratings .star.active {background-color: "+e.staractivecolour+";}",t+=".#metrical-widget-form input[type='radio']:checked  + label {background-color: "+e.staractivecolour+";}",t+="#metrical-widget-form .active-labe{background-color: "+e.staractivecolour+" !important;}"),void 0!==e.tablinecolour)t+="left"===this.properties.position?".MetricalContainer  .elTab-left {border-top: 0.14em solid "+e.tablinecolour+";}":".MetricalContainer  .elTab-right {border-top: 0.14em solid "+e.tablinecolour+";}";MetricalApp.properties.iframe&&(t+=".container-left{padding-right: 0px;}"),t+="</style>",$("head").append(t)}},setSliderCSSJS:function(){var e=!1,t=ClientWidget.widgetObj.questions;if($.each(t,function(t,i){"slider"==i.questiontype&&(e=!0)}),e){var i=MetricalApp.properties.staticendpointhost;null!=MetricalApp.properties.cssendpointhost&&(i=url_protocol()+MetricalApp.properties.cssendpointhost),$("head").append("<link rel='stylesheet' href='"+i+"/css/jslider/jslider.css' type='text/css' >"),$("head").append("<link rel='stylesheet' href='"+i+"/css/jslider/jslider.metrical.css' type='text/css' >");var o=MetricalApp.properties.staticendpointhost;null!=MetricalApp.properties.jsendpointhost&&(o=url_protocol()+MetricalApp.properties.jsendpointhost),$.getScript(o+"/js/jslider/jshashtable-2.1_src.js").done(function(e,i){$.getScript(o+"/js/jslider/jquery.numberformatter-1.2.3.js").done(function(e,i){$.getScript(o+"/js/jslider/tmpl.js").done(function(e,i){$.getScript(o+"/js/jslider/jquery.dependClass-0.1.js").done(function(e,i){$.getScript(o+"/js/jslider/draggable-0.1.js").done(function(e,i){$.getScript(o+"/js/jslider/jquery.slider.js").done(function(e,i){$.each(t,function(e,t){if("slider"==t.questiontype){setTimeout(function e(){$("#"+t.id).length>0?$("#"+t.id).slider({from:t.slider.from,to:t.slider.to,step:t.slider.step,smooth:t.slider.smooth,round:t.slider.round,scale:t.slider.scale,dimension:t.slider.dimension,onstatechange:function(e){var i=t.id;e=e,SurveyAnswersMdl.questionsAnswers[i]=e,passValidator=Widget.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible")}}):setTimeout(e,200)},200)}})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}).fail(function(e,t,i){console.log("Triggered ajaxError handler.")})}},setIOSSpecificCSSJS:function(){if(MetricalApp.logging.logInfo("Checking if is an iOS device to set specific CSS and JS"),/iPhone|iPad|iPod/i.test(navigator.userAgent)){css=".MetricalContainer input, .MetricalContainer select, .MetricalContainer textarea {font-size: 14px !important;}";var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=css:t.appendChild(document.createTextNode(css)),e.appendChild(t),$(".MetricalContainer input, .MetricalContainer select, .MetricalContainer textarea").bind("focus",function(e){$("html, body").animate({scrollTop:0,scrollLeft:0},"slow")}),MetricalApp.logging.logInfo("Added specific CSS and JS for an iOS device")}else MetricalApp.logging.logInfo("Not an iOS device")},setCookie:function(){},postSize:function(e,t){var i=parent.postMessage?parent:parent.document.postMessage?parent.document:void 0;void 0!==i&&i.postMessage(e+":"+t,"*")},resizeParent:function(){var e=this;newHeight=$(".Metrical").height(),newWidth=$(".Metrical").width(),e.postSize(newHeight,newWidth),$(".Metrical").resize(function(){newHeight=$(".Metrical").height(),newWidth=$(".Metrical").width(),e.postSize(newHeight,newWidth)})},getCookieKeys:function(){return docCookies.keys()},getCookies:function(){var e=this,t=docCookies.keys(),i=[];return $.each(t,function(t,o){$.inArray(o,e.cookieName)>-1&&i.push({"cookie-key":o,value:docCookies.getItem(o)})}),i},getCookieObject:function(){for(var e=this.getCookies(),t={},i=0;i<e.length;i++){var o=e[i],r=o["cookie-key"],n=o.value;t[r]=n}return t},removeCookieByKey:function(e){var t=document.domain;"_MetricalObject_QA"==e&&(t=null);return docCookies.removeItem(e,"/",t),!0},removeCookieByName:function(e){var t=document.domain;document.cookie=e+"=; expires="+ +new Date+"; domain="+t+"; path=/"},showContainer:function(){$(".MetricalContainer").removeClass("not-visible")},configureDomMountPoint:function(){if(MetricalApp.properties.iframe)MetricalApp.el=$("div.Metrical");else{var e="#"+this.properties.el,t="#"+this.properties.eltab,i=this.properties.rendertype?this.properties.rendertype:"slideout";this.properties.rendertype||"desktop"==MetricalApp.determineIdentifier()||(i="lightbox");var o=this.properties.position?this.properties.position:"left-middle";if(-1==["left-top","left-middle","left-bottom","bottom-left","bottom-middle","bottom-right","right-bottom","right-middle","right-top"].indexOf(o))o="left-middle";"lightbox"==i&&$("body").append('<div class="Metrical_lightbox"><div class="Metrical_lightbox_center"><div class="Metrical_lightbox_content"></div></div></div>');var r=o.split("-"),n=r[0],a=r[1],s=this.properties.positiontype?this.properties.positiontype:"absolute",l="container-middle",c="container-right",d="el-right",u="elTab-right";"left"===n&&(c="container-left",d="el-left",u="elTab-left"),"top"===a?l="container-top":"bottom"===a&&(l="container-bottom"),"bottom"===n&&(s=null,d="el-left",u="elTab-top",c="","left"===a?l="bottom-container-left":"middle"===a?l="bottom-container-middle":"right"===a&&(l="bottom-container-right")),position_type=s?"fixed"===s?"position-fixed":"position-absolute":"";var p=document.createElement("div");if(p=$(p).addClass("MetricalContainer").css("visibility","hidden").addClass(position_type).addClass(c).addClass(l),$("body").append(p),this.container=p,$(e).length>0)$(e).hasClass("Metrical")||$(e).addClass("Metrical"),$(e).addClass(d),this.el=$(e);else{p=document.createElement("div");p=$(p).addClass("Metrical").addClass(d),$("body").append(p),this.el=p}if($(t).length>0)$(t).html(),$(t).hasClass("MetricalTab")||$(t).addClass("MetricalTab"),$(t).addClass(u),this.elTab=$(t);else{p=document.createElement("div");p=$(p).addClass("MetricalTab").addClass(u).addClass("hidden"),$("body").append(p),this.elTab=p}this.el.appendTo(this.container),this.elTab.appendTo(this.container),"mobile"==MetricalApp.determineIdentifier()&&(SurveyMdl.widgetObj.avoidviewportformobile||$("body").append('<meta name="viewport" content="width=device-width, initial-scale=1">'))}},setTransitionalCookie:function(e){var t=MetricalApp.transitialCookeName,i=null;if(docCookies.hasItem(t)&&(i=docCookies.getItem(t)),"answered"!=i){var o,r=!1;void 0!==SurveyMdl.widgetObj.returningbehaviorclosetimeframe&&"dismissed"==e?r=SurveyMdl.widgetObj.returningbehaviorclosetimeframe:void 0!==SurveyMdl.widgetObj.returningbehaviorsubmittimeframe&&"answered"==e?r=SurveyMdl.widgetObj.returningbehaviorsubmittimeframe:"nointeraction"==e&&(r=void 0!==SurveyMdl.widgetObj.returningbehaviornointeractiontimeout?SurveyMdl.widgetObj.returningbehaviornointeractiontimeout:2592e3),r?(o=new Date).setTime(o.getTime()+1e3*r):o="",docCookies.setItem(t,e,o,"/",docCookies.rootDomain())}},getFullDateUTC:function(e){return year=""+e.getUTCFullYear(),month=""+(e.getUTCMonth()+1),1==month.length&&(month="0"+month),day=""+e.getUTCDate(),1==day.length&&(day="0"+day),hour=""+e.getUTCHours(),1==hour.length&&(hour="0"+hour),minute=""+e.getUTCMinutes(),1==minute.length&&(minute="0"+minute),second=""+e.getUTCSeconds(),1==second.length&&(second="0"+second),date=year+"-"+month+"-"+day+" "+hour+":"+minute+":"+second,date},updatePageLoads:function(){if(null!=SurveyMdl.widgetObj.openafterxloads)if(docCookies.hasItem("_Metrical_PageViewCount")){var e=parseInt(docCookies.getItem("_Metrical_PageViewCount"));docCookies.setItem("_Metrical_PageViewCount",e+1,"","/",docCookies.rootDomain())}else docCookies.setItem("_Metrical_PageViewCount",1,"","/",docCookies.rootDomain())},getInteractionData:function(){var e="";return void 0!==SurveyMdl.widgetObj.sitedelaybeforedisplay&&(e=SurveyMdl.widgetObj.sitedelaybeforedisplay),MetricalApp.initTimestamp?timeOnPage=Date.now()-MetricalApp.initTimestamp:timeOnPage=0,uuid=docCookies.hasItem("_MetricalObject_did")?docCookies.getItem("_MetricalObject_did"):"",sessionid=docCookies.hasItem("_MetricalObject_sessionid")?docCookies.getItem("_MetricalObject_sessionid"):"",selectedStartingBehavior=SurveyMdl.widgetObj.startingbehavior,ClientWidget.widgetObj.isReturningBehaviorAnswered()?selectedStartingBehavior=SurveyMdl.widgetObj.returningbehaviorsubmit:ClientWidget.widgetObj.isReturningBehaviorDismissed()?selectedStartingBehavior=SurveyMdl.widgetObj.returningbehaviorclose:ClientWidget.widgetObj.isReturningBehaviorNoInteraction()&&(selectedStartingBehavior=SurveyMdl.widgetObj.returningbehaviornointeraction),interactionData={uuid:uuid,usermeta:MetricalApp.properties.usermeta,survey_id:Metrical_options.survey,cookies:MetricalApp.getCookies(),url:window.location.href,device:MetricalApp.determineIdentifier(),instance_id:MetricalApp.instanceId,session_id:sessionid,timestamp:MetricalApp.getFullDateUTC(new Date),widget_init_timestamp:MetricalApp.properties.widgetinitializationtimestamp,isactive:SurveyMdl.widgetObj.isactive,survey_revision:SurveyMdl.widgetObj.revision,selected_starting_behavior:selectedStartingBehavior,is_returning_behavior:SurveyMdl.widgetObj.isReturningBehavior(),positiontype:MetricalApp.properties.positiontype,position:MetricalApp.properties.position,totalactivequestions:MetricalApp.properties.randomdisplaycount+MetricalApp.properties.nonrandomdisplaycount,randomdisplaycount:MetricalApp.properties.randomdisplaycount,nonrandomdisplaycount:MetricalApp.properties.nonrandomdisplaycount,emailisactivestatus:MetricalApp.properties.emailisactivestatus,"startingbehavior-nodisplay":SurveyMdl.widgetObj["startingbehavior-nodisplay"],"startingbehavior-closedonstart":SurveyMdl.widgetObj["startingbehavior-closedonstart"],"startingbehavior-openedonstart":SurveyMdl.widgetObj["startingbehavior-openedonstart"],sitedelaybeforedisplay:e,timeonpage:timeOnPage},interactionData},setupInteractions:function(){null!=MetricalApp.properties.captureinteractions&&(SurveyMdl.widgetObj.captureinteractions=MetricalApp.properties.captureinteractions),null!=MetricalApp.properties.captureallinteractions&&(SurveyMdl.widgetObj.captureallinteractions=MetricalApp.properties.captureallinteractions),SurveyMdl.widgetObj.ipblacklist_enabled&&(SurveyMdl.widgetObj.captureinteractions=!0),properties={apiendpoint:MetricalApp.properties.cxinteractionendpoint,captureinteractions:SurveyMdl.widgetObj.captureinteractions,captureallinteractions:SurveyMdl.widgetObj.captureallinteractions,capturescrollinteractions:SurveyMdl.widgetObj.capturescrollinteractions,norecordonsubmitifempty:SurveyMdl.widgetObj.norecordonsubmitifempty,heartbeatisactive:SurveyMdl.widgetObj.heartbeatisactive,interactions:[]},null!=SurveyMdl.widgetObj.custominteractions&&(properties.interactions=properties.interactions.concat(SurveyMdl.widgetObj.custominteractions)),_MetricalInteractions.init($,properties,this.getInteractionData,this.setTransitionalCookie)},updateTimeOnSite:function(){var e=0;return MetricalApp.initTimestamp&&(timeOnPage=Date.now()-MetricalApp.initTimestamp,e=MetricalApp.pageLoadTimeOnSite+timeOnPage,docCookies.setItem("_Metrical_TimeOnSite",e,"","/",docCookies.rootDomain())),e},handleTimeOnSiteEvent:function(timeOnSite){null!=SurveyMdl.widgetObj.timeonsiteevent&&timeOnSite>SurveyMdl.widgetObj.timeonsiteevent.timespentonsite&&(MetricalApp.logging.logInfo("Triggering the time on site event"),null!=SurveyMdl.widgetObj.timeonsiteevent.filter?(MetricalApp.logging.logInfo("filter present, evaluating the filter "+SurveyMdl.widgetObj.timeonsiteevent.filter),result=eval(SurveyMdl.widgetObj.timeonsiteevent.filter)):result=!0,result?(openWidget=null==SurveyMdl.widgetObj.timeonsiteevent.openwidget||SurveyMdl.widgetObj.timeonsiteevent.openwidget,_Metrical.showWidget(),!jQuery(".MetricalContainer").hasClass("is-popped")&&openWidget&&jQuery(".MetricalTab").click()):MetricalApp.logging.logInfo("the filter configured filter for the time on site event didn't passed"),clearInterval(MetricalApp.timeOnSiteTimer))},startupTimedQuestion:function(){var e=MetricalApp.timedQuestionDelay,t=SurveyMdl.widgetObj.titletext,i=$(".form-list .ratings")[0].innerHTML;null==MetricalApp.tabCloserTimer&&($(".lb-wrapper div.MetricalHeader")[0].innerHTML=t.replace("{{timer}}",e),$(".form-list .ratings")[0].innerHTML=i.replace(/\{{timer}}/g,e),e--,MetricalApp.tabCloserTimer=setInterval(function(){$(".lb-wrapper div.MetricalHeader")[0].innerHTML=t.replace("{{timer}}",e),$(".form-list .ratings")[0].innerHTML=i.replace(/\{{timer}}/g,e),-1==--e&&(clearInterval(MetricalApp.tabCloserTimer),jQuery(".close-widget").click(),setTimeout(function(){jQuery(".MetricalContainer").hide()},200))},1e3))}};rootMetricalObj.app=MetricalApp;var docCookies={rootDomain:function(){var e=location.hostname.split(".").reverse();return e.length>1?"."+e[1]+"."+e[0]:"."+e[0]},getItem:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,i,o,r,n,a){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(i)switch(i.constructor){case Number:s=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:s="; expires="+i;break;case Date:s="; expires="+i.toUTCString()}var l=location.protocol;return n||"https:"!=l||(n="secure"),a||(a="Lax"),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(o?"; path="+o:"")+(n?"; secure":"")+"; SameSite="+a,!0},removeItem:function(e,t,i){return!(!e||!this.hasItem(e))&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=decodeURIComponent(e[t]);return e}},WidgetExceptions={exception:function(e){log(e)}},Widget={el:null,containerTextboxActivated:new Array,bottomValue:-20,defaultBottomValue:-20,tabBottomValue:$.support.leadingWhitespace?143:208,defaultTabBottomValue:$.support.leadingWhitespace?143:208,shouldDisplay:!0,initiWasCalled:!1,init:function(e,t,i){var o=this;if(this.el=e,MetricalApp.logging.logInfo("widget.init el: ",this.el),o.initiWasCalled=!0,null!==o.el)if(i){if(Widget.isThankYouImageView())r=setTimeout(function(){$(".close-widget-thank").click()},Widget.getThankYouImageCloseTimeout());else var r=setTimeout(function(){o.resetForm()},2e3);$(".Metrical").data("closeTimeout",r),MetricalApp.properties.iframe?setTimeout(function(){o.renderWidgedAfterReset()},3500):$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose)}else this.questionEvent(),this.submit(),this.slider(),o.renderWidget();now=new Date;var n=MetricalApp.getFullDateUTC(now);MetricalApp.initTimestamp=now,MetricalApp.properties.widgetinitializationtimestamp=n,MetricalApp.logging.logInfo("Registered the widget initialization timestamp",MetricalApp.properties.widgetinitializationtimestamp),$(document).trigger("setWidthAfterLoad")},renderElTab:function(){if(additionaParams=location.search,additionaParams=additionaParams.substr(1),widgetUrl=MetricalApp.properties.apiendpointhost+"/display/"+SurveyMdl.widgetObj.surveyid+"?mobile=1&customersite="+encodeURIComponent(document.URL)+"&"+additionaParams,additionaParams&&(widgetUrl+="&"),MetricalApp.properties.mobilecss){var e="css="+MetricalApp.properties.mobilecss+"&";widgetUrl+=e}if(MetricalApp.properties.mobilejs){var t="js="+MetricalApp.properties.mobilejs+"&";widgetUrl+=t}$(".MetricalTab").html('<a style="text-align:center" class = "mobile-tab mobile-link"  href = "'+widgetUrl+'" target="_blank">'+SurveyMdl.widgetObj.tabtext+"</a>"),!SurveyMdl.widgetObj.visibleonmobile||null==SurveyMdl.widgetObj.getReturningBehavior()&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.noDisplayBehavior||SurveyMdl.widgetObj.getReturningBehavior()==StartingBehavior.noDisplayBehavior||($(".MetricalTab").removeClass("hidden"),$(".MetricalTab a.mobile-link").click(function(e){_MetricalInteractions.recordInteraction("dismissed")}))},renderWidget:function(){if(MetricalApp.properties.iframe)void 0!==SurveyMdl.widgetObj.surveyid&&(this.el.html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement());else{cookieName=MetricalApp.transitialCookeName,startingbehavior=SurveyMdl.widgetObj.startingbehavior;if(docCookies.hasItem(cookieName)&&(cookie=docCookies.getItem(cookieName),void 0!==SurveyMdl.widgetObj.returningbehaviorclose&&"dismissed"==cookie&&(startingbehavior=SurveyMdl.widgetObj.returningbehaviorclose,!0),void 0!==SurveyMdl.widgetObj.returningbehaviorsubmit&&"answered"==cookie&&(startingbehavior=SurveyMdl.widgetObj.returningbehaviorsubmit,!0),void 0!==SurveyMdl.widgetObj.returningbehaviornointeraction&&"nointeraction"==cookie&&(startingbehavior=SurveyMdl.widgetObj.returningbehaviornointeraction,!0)),MetricalApp.logging.logInfo("computed startingbehavior in renderWidget: ",startingbehavior),void 0!==SurveyMdl.widgetObj.surveyid){for(MetricalApp.logging.logInfo("starting domain check"),domainCheck=!1,i=0;i<SurveyMdl.widgetObj.domains.length;i++){if(document.domain.toLowerCase()==SurveyMdl.widgetObj.domains[i].toLowerCase()){domainCheck=!0;break}if("*"==SurveyMdl.widgetObj.domains[i]){domainCheck=!0;break}if("*."==SurveyMdl.widgetObj.domains[i].substring(0,2)&&(realDomainSplited=document.domain.toLowerCase().split("."),definedDomainSplited=SurveyMdl.widgetObj.domains[i].toLowerCase().split("."),realDomainSplited.length==definedDomainSplited.length)){for(arrayEquals=!0,j=1;j<realDomainSplited.length;j++)realDomainSplited[j]!=definedDomainSplited[j]&&(arrayEquals=!1);if(arrayEquals){domainCheck=!0;break}}}MetricalApp.logging.logInfo("document domain",document.domain),MetricalApp.logging.logInfo("comparison domains",SurveyMdl.widgetObj.domains),1==domainCheck?MetricalApp.logging.logInfo("domain check PASSED"):MetricalApp.logging.logInfo("domain check FAILED"),startingbehaviorDisplayCheck=!0,startingbehavior==SurveyMdl.startingbehaviorNoDisplay&&(startingbehaviorDisplayCheck=!1),tabletCheck=!0,device=MetricalApp.determineIdentifier(),"tabletvertical"!=device&&"tablethorizontal"!=device||(SurveyMdl.widgetObj.visibleontablet?tabletCheck=!0:tabletCheck=!1),mobileCheck=!0,"mobile"==device&&(!SurveyMdl.widgetObj.visibleonmobile||null==SurveyMdl.widgetObj.getReturningBehavior()&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.noDisplayBehavior||SurveyMdl.widgetObj.getReturningBehavior()==StartingBehavior.noDisplayBehavior)&&(mobileCheck=!1),mobileCheck&&tabletCheck&&domainCheck&&startingbehaviorDisplayCheck?this.show():this.shouldDisplay=!1,Widget.checkActivateSubmit()}}"lightbox"===MetricalApp.properties.rendertype&&$(".lb-wrapper").each(function(){this.style.setProperty("box-shadow","none","important")})},show:function(){$(".Metrical").html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement(),SurveyMdl.widgetObj.offerimage||null==MetricalApp.timedQuestionDelay||(MetricalApp.logging.logInfo("Starting up the timed question timer"),MetricalApp.startupTimedQuestion());$(".Metrical form").outerHeight(),MetricalApp.determineIdentifier();$(".MetricalTab").html('<div style="text-align:center">'+SurveyMdl.widgetObj.tabtext+"</div>"),null!=SurveyMdl.widgetObj.wiggleeffect&&(1==SurveyMdl.widgetObj.wiggleeffect.enableonstart&&0==isReturningBehavior||1==SurveyMdl.widgetObj.wiggleeffect.enableonreturn&&1==isReturningBehavior)&&WiggleTab(4e3,SurveyMdl.widgetObj.wiggleeffect.effect),SurveyMdl.widgetObj.returningbehaviornointeraction&&MetricalApp.setTransitionalCookie("nointeraction"),SurveyMdl.widgetObj.displayfeedbacktab?$(".MetricalTab").hasClass("hidden")&&$(".MetricalTab").removeClass("hidden"):$(".MetricalTab").addClass("hidden"),"undefined"!=typeof startingbehavior&&startingbehavior==SurveyMdl.startingbehaviorOpen?("lightbox"===MetricalApp.properties.rendertype&&$(".MetricalTab").addClass("hidden"),"slideout"===MetricalApp.properties.rendertype&&$(".MetricalContainer").addClass("metrical-widths"),"bottom-right"!=MetricalApp.properties.position&&"bottom-middle"!=MetricalApp.properties.position&&"bottom-left"!=MetricalApp.properties.position||$(".MetricalContainer").hasClass("widget-size-no-autoheight")||($(".MetricalContainer").height("auto"),$(".MetricalContainer").hasClass("is-popped")||$(".MetricalContainer").height("0")),setTimeout(function(){$(".MetricalTab").click()},100)):"bottom-right"!=MetricalApp.properties.position&&"bottom-middle"!=MetricalApp.properties.position&&"bottom-left"!=MetricalApp.properties.position?"lightbox"!=MetricalApp.properties.rendertype&&($(".MetricalContainer").css("width","0px"),$(document).on("setWidthAfterLoad",{},function(e){$(".MetricalContainer").css("width","0px"),MetricalApp.logging.logInfo("Setting the width of MetricalContainer to 0 after the widget is completely loaded")})):$(".MetricalContainer").addClass("metrical-widths")},submit:function(){$(document).on("click","input#metrical-confirm-button.enabled, input#metrical-timedquestion-button",function(e){e.stopImmediatePropagation(),e.preventDefault();try{if(_MetricalCoupon.couponDriver&&(_Metrical.ClientWidget.widgetObj.displaythankyou||($(".Metrical_lightbox").hide(),$(".MetricalContainer").hide())),Validator.form(void 0),SurveyAnswersMdl.postQuestionAnswer($(this).hasClass("mobile-submit-button"),"metrical-timedquestion-button"==e.target.id),void 0!==MetricalApp.properties.clicktrack&&""!=MetricalApp.properties.clicktrack)(new Image).src=MetricalApp.properties.clicktrack}catch(e){WidgetExceptions.exception(e.toString()),MetricalApp.logging.logError(e)}}),$(document).on("click","input#metrical-confirm-button.disabled",function(e){e.preventDefault()})},checkToggleConditionalQuestions:function(){for(var e in SurveyAnswersMdl.qaToggleQuestions)if(SurveyAnswersMdl.qaToggleQuestions.hasOwnProperty(e)){var t=SurveyAnswersMdl.qaToggleQuestions[e],i=!1;for(let n=0;n<t.answers.length;n++){const a=t.answers[n];var o=SurveyAnswersMdl.questionsAnswers[e],r=a;if("object"==typeof a&&(o=SurveyAnswersMdl.questionsAnswers[e+"-"+r.id],r=a.value),r==o){i=!0;break}}i?$("#question_"+t.questionToToggle).removeClass("metrical-hidden-question"):$("#question_"+t.questionToToggle).addClass("metrical-hidden-question")}},checkActivateSubmit:function(){for(key in this.checkToggleConditionalQuestions(),passRequired=!0,0==SurveyAnswersMdl.hasAnswers()&&SurveyMdl.requiredList.length>0&&(passRequired=!1),$.each(SurveyMdl.requiredList,function(e,t){SurveyAnswersMdl.questionsAnswers[t]?$.each(SurveyMdl.widgetObj.questions,function(e,i){i.id==t&&void 0!==i.valuesarray&&(""==i.valuesarray[SurveyAnswersMdl.questionsAnswers[t]]?passRequired=!1:null!=i.customvaluesarray&&$.each(i.customvaluesarray,function(e,i){optionsWithRequiredCustomValues=SurveyMdl.customValuesRequiredList[i.customvalueid],optionsWithRequiredCustomValues instanceof Array&&optionsWithRequiredCustomValues.indexOf(parseInt(SurveyAnswersMdl.questionsAnswers[t]))>-1&&(null!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]&&""!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]||(passRequired=!1))}))}):passRequired=!1}),passValidator=!0,SurveyMdl.validatorList)value=SurveyMdl.validatorList[key],SurveyAnswersMdl.questionsAnswers[key]&&""!=SurveyAnswersMdl.questionsAnswers[key]&&(eval(value),"function"==typeof checkValidity&&(checkValidity(SurveyAnswersMdl.questionsAnswers[key])||(passValidator=!1)));return passRequired&&passValidator?this.activateSubmit():this.deactivateSubmit(),passValidator},fixFocusLightboxMobile:function(){setTimeout(function(){container=$(".Metrical_lightbox"),o=$(":focus").offset(),null!=o&&container.animate({scrollTop:o.top-container.offset().top+container.scrollTop()-100}),$(":focus").click()},.01)},oneClickSubmit:function(e){totalActiveQuestions=MetricalApp.properties.randomdisplaycount+MetricalApp.properties.nonrandomdisplaycount,null!=SurveyMdl.widgetObj.oneclicksubmit&&1==SurveyMdl.widgetObj.oneclicksubmit&&(1==totalActiveQuestions?setTimeout(function(){MetricalApp.logging.logInfo("oneclicksubmit enabled. There is only one question. Submitting the survey..."),e&&(e.parent("div").find("input").attr("disabled"),e.parent("div").append('<div class="overlay"><div class="loader"></div></div>')),$("#metrical-confirm-button").click()},400):MetricalApp.logging.logInfo("oneclicksubmit is enabled, but there are more than one question. The survey will not be submitted"))},questionEvent:function(){var e=this;$(document).on("click","a.star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).attr("value");$(this).parents().children("a.star").removeClass("active");for(var r=0;r<=o;r++)$(this).parents().children('a.star[value="'+r+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=o,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.large-star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).attr("value");$(this).parents().children("a.large-star").removeClass("active");for(var r=0;r<=o;r++)$(this).parents().children('a.large-star[value="'+r+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=o,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.medium-star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).attr("value");$(this).parents().children("a.medium-star").removeClass("active");for(var r=0;r<=o;r++)$(this).parents().children('a.medium-star[value="'+r+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=o,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.small-star",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).attr("value");$(this).parents().children("a.small-star").removeClass("active");for(var r=0;r<=o;r++)$(this).parents().children('a.small-star[value="'+r+'"]').addClass("active");SurveyAnswersMdl.questionsAnswers[i]=o,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","a.face",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).attr("value");$(this).parents().children("a.face").removeClass("active"),$(this).parents().children('a.face[value="'+o+'"]').addClass("active"),SurveyAnswersMdl.questionsAnswers[i]=o,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("change","select.widget-select",function(t){t.preventDefault();var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).val();""!=o?SurveyAnswersMdl.questionsAnswers[i]=o:delete SurveyAnswersMdl.questionsAnswers[i],passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible"),e.oneClickSubmit($(this))}),$(document).on("click","input[type=radio]",function(t){if($(this).hasClass("disable-click"))t.preventDefault();else{$(this).parents().children("label").removeClass("active-label");var i="#label-"+$(this).attr("id");$(this).hasClass("radio-buttons-input")||$(i).addClass("active-label");var o=$(this).parents().children(".metrical-question-quid").val(),r=$(this).attr("value");SurveyAnswersMdl.questionsAnswers[o]=r,passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible")}e.oneClickSubmit($(this))}),$(document).on("mouseover","a.star",function(e){var t=$(this).attr("value");$(this).parents().children("a.star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.star",function(e){$(this).parents().children("a.star").removeClass("star-hover")}),$(document).on("mouseover","a.large-star",function(e){var t=$(this).attr("value");$(this).parents().children("a.large-star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.large-star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.large-star",function(e){$(this).parents().children("a.large-star").removeClass("star-hover")}),$(document).on("mouseover","a.medium-star",function(e){var t=$(this).attr("value");$(this).parents().children("a.medium-star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.medium-star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.medium-star",function(e){$(this).parents().children("a.medium-star").removeClass("star-hover")}),$(document).on("mouseover","a.small-star",function(e){var t=$(this).attr("value");$(this).parents().children("a.small-star").removeClass("star-hover");for(var i=0;i<=t;i++)$(this).parents().children('a.small-star[value="'+i+'"]').addClass("star-hover")}),$(document).on("mouseout","a.small-star",function(e){$(this).parents().children("a.small-star").removeClass("star-hover")}),$(document).on("keyup",".metrical-question-answer",function(t){var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).val();if(!$(this).hasClass("resized")){var r=Widget.getMaxWidgetStretch($(".container-bottom").length>0),n=$(this).height();n+r>150?n=150:n+=r,$(this).height(n+"px");var a=-1;$.each(Widget.containerTextboxActivated,function(e,t){t==i&&(a=1)}),-1==a&&(Widget.containerTextboxActivated.push(i),$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").height("auto"),Widget.tabBottomValue=parseInt(Widget.tabBottomValue),Widget.tabBottomValue=parseInt(Widget.tabBottomValue)+120,$(".container-bottom .MetricalTab").css("bottom",Widget.tabBottomValue+"px"),Widget.bottomValue<0?Widget.bottomValue=parseInt(Widget.bottomValue):Widget.bottomValue=parseInt(Widget.bottomValue)-120,$(".container-bottom ").css("bottom",Widget.bottomValue+"px")),$(".metrical-question-answer").addClass("resized")}""!=o?SurveyAnswersMdl.questionsAnswers[i]=o:delete SurveyAnswersMdl.questionsAnswers[i];passValidator=e.checkActivateSubmit(),passValidator&&$("#metrical-confirm-button").is(":visible")}),$(document).on("blur",".mqa-textbox",function(t){var i=$(this).parents().children(".metrical-question-quid").val(),o=$(this).val();""!=o?SurveyAnswersMdl.questionsAnswers[i]=o:delete SurveyAnswersMdl.questionsAnswers[i];(passValidator=e.checkActivateSubmit())?($(this).removeClass("field-error"),$(this).prev("span.error").hide(),$("#metrical-confirm-button").is(":visible")):($(this).addClass("field-error"),$(this).prev("span.error").show())}),$(document).on("click",".close-widget",function(e){"lightbox"==MetricalApp.properties.rendertype?($(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),$(".MetricalTab").hasClass("hidden")&&$(".MetricalTab").removeClass("hidden"),Widget.isThankYouImageView()||$(".MetricalContainer").append($(".Metrical_lightbox_center .Metrical")[0]),$(".Metrical_lightbox_center .Metrical").replaceWith('<div class="Metrical_lightbox_content">'),$(".Metrical_lightbox").fadeOut("100"),$(".MetricalTab").fadeIn("100"),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),MetricalApp.setTransitionalCookie("dismissed"),$("body").css("overflow-y",""),"mobile"==MetricalApp.determineIdentifier()&&$("html, body").removeClass("ios-fix")):($(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),$(".MetricalTab").click(),_MetricalInteractions.recordInteraction("dismissed"),MetricalApp.setTransitionalCookie("dismissed")),SurveyMdl.widgetObj.hidetabafterclose&&$(".MetricalTab").hide()}),$(window).on("resize",function(e){Widget.setWidgetPosition()}),$(document).on("click","#metrical-confirm-button.enabled",function(t){e.buttonSubmited()}),$(document).on("click","#metrical-confirm-button.disabled",function(e){e.preventDefault()}),$(document).on("click",".mqa-checkbox",function(e){var t=$(this).parents().children(".metrical-question-quid").val(),i=$(".mqa-checkbox-default").val();1==$(this).prop("checked")?""!=i?$(this).val(i):$(this).val("1"):$(this).val("0"),SurveyAnswersMdl.questionsAnswers[t]=$(this).val(),Widget.checkActivateSubmit()}),$(document).on("click",".multi-checkbox",function(e){var t=$(this).parents().children(".metrical-question-quid").val(),i=$(e.currentTarget),o=t+"-"+i.val();i.prop("checked")?SurveyAnswersMdl.questionsAnswers[o]=1:SurveyAnswersMdl.questionsAnswers[o]=0,Widget.checkToggleConditionalQuestions()}),$(document).on("click",".multi-checkbox.exclusive-option",function(e){if(e.target.checked){var t=$("#"+e.target.id).parent().parent().find(".multi-checkbox");$.each(t,function(t,i){i.id!=e.target.id&&i.checked&&i.click()})}}),$(document).on("click",".multi-checkbox",function(e){if(e.target.checked){var t=$("#"+e.target.id).parent().parent().find(".multi-checkbox.exclusive-option");$.each(t,function(t,i){i.id!=e.target.id&&i.checked&&i.click()})}})},recordInteractionAsDisplayed:function(e){void 0!==e.originalEvent?_MetricalInteractions.recordInteraction("opened",null,!0,!1):_MetricalInteractions.recordInteraction("visible",null,!0,!1)},slider:function(){$(document).on("click",".MetricalTab",function(e){void 0!==e.originalEvent&&($(this).parent().hasClass("is-popped")||(CustomerEvents.userClickedTab=!0))}),$(document).on("click",".MetricalTab.elTab-left",function(e){$(".Metrical").data("closeTimeout")&&(clearTimeout($(".Metrical").data("closeTimeout")),$(".Metrical").data("closeTimeout",null));var t=$(this).parent(),i={width:"0px",maxWidth:n};if($(".Metrical").data("closeBehavior",null),"lightbox"==MetricalApp.properties.rendertype){var o=$(".Metrical");$(".MetricalTab").hide(),$(".Metrical_lightbox_content").replaceWith(o),$(".Metrical_lightbox").fadeIn("100"),$(".Metrical_lightbox").css("display","block"),$("body").css("overflow-y","hidden"),$(".close-widget").show(),$(".close-widget").css("display","block"),Widget.recordInteractionAsDisplayed(e),"mobile"==MetricalApp.determineIdentifier()&&($("html, body").addClass("ios-fix"),$("textarea").blur(function(e){Widget.fixFocusLightboxMobile()}))}else if($(this).parent().hasClass("is-popped")){var r="270px";t.css("width")&&(r=t.css("width"));var n="270px";t.css("maxWidth")&&(n=t.css("maxWidth")),$(".MetricalContainer").width(r),$(".MetricalContainer").css("maxWidth",n),$(this).parent().removeClass("metrical-widths"),$(this).parent().animate(i,{queue:!1,duration:500,complete:function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),$(this).removeClass("is-popped"),$(this).removeClass("metrical-widths")}}),MetricalApp.setTransitionalCookie("dismissed")}else{t.addClass("metrical-widths");r="270px";"0px"!=t.css("width")&&(r=t.css("width"));n="270px";t.css("maxWidth")&&(n=t.css("maxWidth")),t.removeClass("metrical-widths"),$(this).parent().animate({width:r,maxWidth:n},{queue:!1,duration:500,complete:function(){$(this).addClass("is-popped"),$(this).addClass("metrical-widths"),Widget.recordInteractionAsDisplayed(e)},start:function(){$(".MetricalTab").removeClass("MetricalTabWiggle")}})}}),$(document).on("click",".MetricalTab.elTab-right",function(e){$(".Metrical").data("closeTimeout")&&(clearTimeout($(".Metrical").data("closeTimeout")),$(".Metrical").data("closeTimeout",null));var t=$(this).parent(),i={width:"0px",maxWidth:n};if($(".Metrical").data("closeBehavior",null),"lightbox"==MetricalApp.properties.rendertype){var o=$(".Metrical");$(".MetricalTab").hide(),$(".Metrical_lightbox_content").replaceWith(o),$(".Metrical_lightbox").fadeIn("100"),$(".Metrical_lightbox").css("display","block"),$("body").css("overflow-y","hidden"),$(".close-widget").show(),$(".close-widget").css("display","block"),Widget.recordInteractionAsDisplayed(e),"mobile"==MetricalApp.determineIdentifier()&&($("html, body").addClass("ios-fix"),$("textarea").blur(function(e){Widget.fixFocusLightboxMobile()}))}else if($(this).parent().hasClass("is-popped")){var r="270px";t.css("width")&&(r=t.css("width"));var n="270px";t.css("maxWidth")&&(n=t.css("maxWidth")),$(".MetricalContainer").width(r),$(".MetricalContainer").css("maxWidth",n),$(this).parent().removeClass("metrical-widths"),$(this).parent().animate(i,{queue:!1,duration:500,complete:function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),$(this).removeClass("is-popped"),$(this).removeClass("metrical-widths")}}),MetricalApp.setTransitionalCookie("dismissed")}else{t.addClass("metrical-widths");r="270px";"0px"!=t.css("width")&&(r=t.css("width"));n="270px";t.css("maxWidth")&&(n=t.css("maxWidth")),t.removeClass("metrical-widths"),$(this).parent().animate({width:r,maxWidth:n},{queue:!1,duration:500,complete:function(){$(this).addClass("is-popped"),$(this).addClass("metrical-widths"),Widget.recordInteractionAsDisplayed(e)},start:function(){$(".MetricalTab").removeClass("MetricalTabWiggle")}})}}),$(document).on("click",".MetricalTab.elTab-top",function(e){$(".Metrical").data("closeTimeout")&&(clearTimeout($(".Metrical").data("closeTimeout")),$(".Metrical").data("closeTimeout",null));if($(".Metrical").data("closeBehavior",null),"lightbox"==MetricalApp.properties.rendertype){var t=$(".Metrical");$(".MetricalTab").hide(),$(".Metrical_lightbox_content").replaceWith(t),$(".Metrical_lightbox").fadeIn("100"),$(".Metrical_lightbox").css("display","block"),$("body").css("overflow-y","hidden"),$(".close-widget").show(),$(".close-widget").css("display","block"),Widget.recordInteractionAsDisplayed(e),"mobile"==MetricalApp.determineIdentifier()&&($("html, body").addClass("ios-fix"),$("textarea").blur(function(e){Widget.fixFocusLightboxMobile()}))}else if($(this).parent().hasClass("is-popped"))$(this).parent().animate({height:"80px"},{queue:!1,duration:500,complete:function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorclose),void 0!==e.originalEvent&&_MetricalInteractions.recordInteraction("dismissed"),$(this).removeClass("is-popped")}}),MetricalApp.setTransitionalCookie("dismissed");else{var i=$(".lb-wrapper").offset().top,o=$("#check-offset").offset().top-i+80;$(this).parent().animate({height:o+"px"},{queue:!1,duration:500,complete:function(){$(this).addClass("is-popped"),$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").height("auto"),Widget.recordInteractionAsDisplayed(e)},start:function(){$(".MetricalTab").removeClass("MetricalTabWiggle")}})}}),$(document).on("mouseover","#metrical-confirm-button.disabled",function(e){$("#metrical-confirm-button.disabled").focus()}),$(document).on("click","#metrical-confirm-button.disabled",function(e){$("div.required").hide(),requiredElements=Validator.formValidation(),$.each(requiredElements,function(e,t){elId="#span-"+t+"-message",$(elId).show()})})},setupLastElement:function(){$(".MetricalContainer .field").last().addClass("last")},activateSubmit:function(){$(".MetricalContainer input[type=radio]").removeClass("disable-click"),$("#metrical-confirm-button").removeClass("disabled"),$("#metrical-confirm-button").addClass("enabled")},deactivateSubmit:function(){$("#metrical-confirm-button").removeClass("enabled"),$("#metrical-confirm-button").addClass("disabled")},buttonSubmited:function(){$(".MetricalContainer input[type=radio]").addClass("disable-click"),$("#metrical-confirm-button").removeClass("enabled"),$("#metrical-confirm-button").addClass("disabled"),$("#metrical-confirm-button").attr("disabled","disabled")},resetForm:function(){that=this,MetricalApp.properties.iframe||("lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click(),Widget.containerTextboxActivated=new Array)},renderWidgedAfterReset:function(){void 0!==SurveyMdl.widgetObj.surveyid&&(MetricalApp.properties.iframe?($(".Metrical").html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement(),Widget.setWidgetPosition(),Widget.checkActivateSubmit()):(MetricalApp.el.html(WidgetView.widgetMarkup(SurveyMdl.widgetObj)),Widget.setupLastElement(),Widget.setWidgetPosition(),Widget.checkActivateSubmit()),that.tabBottomValue=that.defaultTabBottomValue,$(".container-bottom .MetricalTab").css("bottom",that.defaultTabBottomValue+"px"),$(".container-bottom ").css("bottom",Widget.defaultBottomValue+"px"),$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").css("height","auto"),$(".MetricalContainer.bottom-container-right, .MetricalContainer.bottom-container-left, .MetricalContainer.bottom-container-middle ").css("height","80px"))},setWidgetPosition:function(){MetricalApp.logging.logInfo("setting widget position"),$(".Metrical_lightbox_center").removeClass("MetricalContainer");var e=window.innerHeight,t=$(".MetricalContainer").length?$(".MetricalContainer").position().top:null,i=$("#check-offset").length?$("#check-offset").position().top:null,o=!!$(".container-bottom").length;if("mobile"==MetricalApp.determineIdentifier())return $("div.MetricalContainer").hasClass("position-fixed")&&$(".MetricalContainer").css("height",window.innerHeight+"px"),$(".Metrical_lightbox_center").addClass("MetricalContainer"),$(".Metrical_lightbox_center").addClass("mobile"),1==MetricalApp.identifierIsIOS()&&$(".Metrical_lightbox_center").addClass("ios"),void $(".Metrical_lightbox_center").addClass("display-widget-page");i>e||o&&t<0?($("div.MetricalContainer").hasClass("position-fixed")&&($("div.MetricalContainer").removeClass("position-fixed"),$("div.MetricalContainer").addClass("position-absolute")),o&&t<0&&($("div.MetricalContainer").removeClass("container-bottom"),$("div.MetricalContainer").addClass("container-top"))):("fixed"===MetricalApp.properties.positiontype||"lightbox"===MetricalApp.properties.rendertype&&"fixed"===MetricalApp.properties.positiontype)&&($("div.MetricalContainer").hasClass("position-absolute")&&($("div.MetricalContainer").removeClass("position-absolute"),$("div.MetricalContainer").addClass("position-fixed")),MetricalApp.properties.position.indexOf("bottom")>-1&&$("div.MetricalContainer").hasClass("container-top")&&($("div.MetricalContainer").removeClass("container-top"),$("div.MetricalContainer").addClass("container-bottom"))),$(".Metrical_lightbox_center").addClass("MetricalContainer")},getMaxWidgetStretch:function(e){var t=window.innerHeight,i=$("#check-offset").offset(),o=$(".lb-wrapper .close-widget").offset();return null!=i&&(i=i.top),null!=o&&(o=o.top),o-10>0&&e?o-10:i<t-10?t-i-10:0},isThankYouImageView:function(){return res=!1,null!=SurveyMdl.widgetObj.offerimage&&SurveyMdl.widgetObj.offerimage&&null!=SurveyMdl.widgetObj.couponconfig&&null!=SurveyMdl.widgetObj.couponconfig.thankyouimageurl&&("desktop"==MetricalApp.determineIdentifier()&&null!=SurveyMdl.widgetObj.couponconfig.thankyouimageurl.desktop?res=!0:"desktop"!=MetricalApp.determineIdentifier()&&null!=SurveyMdl.widgetObj.couponconfig.thankyouimageurl.mobile&&(res=!0)),res},getThankYouImageCloseTimeout:function(){return res=3e3,null!=SurveyMdl.widgetObj.offerimage&&SurveyMdl.widgetObj.offerimage&&null!=SurveyMdl.widgetObj.couponconfig&&null!=SurveyMdl.widgetObj.couponconfig.thankyouclosetimeout&&(res=SurveyMdl.widgetObj.couponconfig.thankyouclosetimeout),res}},Validator={blacklist:[],widgetAllowed:function(e){return survey=void 0!==e.survey&&e.survey,!!survey&&(!!$.inArray(e.survey,this.blacklist)||void 0)},userdata:function(e){var t={name:"Client error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(e==={})throw t.message="Client data are missing",t;if(!e.survey)throw t.message="Error found. SurveyID is missing.",t;return!0},properties:function(e){var t={name:"Property error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(!e.staticendpointhost)throw t.message="Server URL not defined.",t;return!0},widget:function(e){var t={name:"Widget error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(!e.surveyid)throw t.message="Widget not found.",t;if(!e.offerimage&&!e.titletext)throw t.message="Widget title is missing.",t;if(!e.offerimage&&!e.buttontext&&!e.submitbuttontext)throw t.message="Widget buttontext or submitbuttontext is missing.",t;if(!e.offerimage&&!e.questions)throw t.message="Widget questions not exist.",t;return e.questions&&$.each(e.questions,function(e,t){Validator.question(t)}),!0},question:function(e){var t={name:"Question error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};if(!e.id)throw t.message="Question not found",t;if("scale"===!e.questiontype||"openended"===!e.questiontype||"customlist"===!e.questiontype||"customarray"===!e.questiontype)throw t.message="Wrong question type: "+e.questiontype,t;return!0},form:function(e){var t={name:"Form error",level:"Show Stopper",message:"",toString:function(){return this.name+": "+this.message}};return $.each(SurveyMdl.questionGuids,function(e,i){if("scale"===SurveyMdl.questionType[i]){var o=SurveyMdl.widgetObj.questions[e].numberofstars||defaultStarsForScale;if(SurveyAnswersMdl.questionsAnswers[i]<1||SurveyAnswersMdl.questionsAnswers[i]>o)throw t.message="Scaled question value must be between 1 and "+o,t}}),!0},formValidation:function(){var e=[],t={};$.each(SurveyMdl.questionGuids,function(i,o){valueNotEmpty=!0,$.each(SurveyMdl.widgetObj.questions,function(e,i){i.id==o&&void 0!==i.valuesarray&&(""==i.valuesarray[SurveyAnswersMdl.questionsAnswers[o]]?valueNotEmpty=!1:null!=i.customvaluesarray&&$.each(i.customvaluesarray,function(e,i){optionsWithRequiredCustomValues=SurveyMdl.customValuesRequiredList[i.customvalueid],optionsWithRequiredCustomValues instanceof Array&&optionsWithRequiredCustomValues.indexOf(parseInt(SurveyAnswersMdl.questionsAnswers[o]))>-1&&(null!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]&&""!=SurveyAnswersMdl.questionsAnswers[i.customvalueid]||(valueNotEmpty=!1,t[o]=i.customvalueid))}))}),valueNotEmpty&&null!=SurveyAnswersMdl.questionsAnswers[o]&&e.push(o)});var i=[];return $.grep(SurveyMdl.requiredList,function(o){-1==$.inArray(o,e)&&(null!=t[o]?i.push(t[o]):i.push(o))}),i}},Misc={urlParamsToJSON:function(e){for(var t=e.split("&"),i=0,o="{";i<t.length;i++){var r=t[i].split("=");i<t.length-1?o+='"'+r[0]+'":"'+r[1]+'",':o+='"'+r[0]+'":"'+r[1]+'"'}return o+="}"},urldecode:function(e){return decodeURIComponent(e.replace(/\+/g," "))},union_arrays:function(e,t){for(var i={},o=e.length-1;o>=0;--o)i[e[o]]=e[o];for(o=t.length-1;o>=0;--o)i[t[o]]=t[o];var r=[];for(var n in i)i.hasOwnProperty(n)&&r.push(i[n]);return r.sort()}},ClientWidget={surveyId:null,configLocation:null,json:null,surveyKeys:["surveyid","domains","esid","name","titletext","cancelbutton","cancelbuttontext","submitbuttontext","buttontext","thankyoumessages","tabtext","questions","footer","css","js","iframesubmitredirect","returningbehaviorclose","returningbehaviorclosetimeframe","returningbehaviorsubmit","returningbehaviorsubmittimeframe","wiggleeffect","isactive","numberofstars","widgetreloaded","sitedelaybeforedisplay","delaybeforedisplaythreshold","position","positiontype","rendertype","specificexperience","delaybeforeopeningclosedtab","filter","answercountisactive","revision","openafterxloads","leadboxerisactive","thankyouviewclass","oneclicksubmit","custominteractions","timeonsiteevent","returningbehaviornointeraction","returningbehaviornointeractiontimeout","hidesubmitbutton","couponconfig","offerimage","heartbeatisactive"],questionKeys:["id","questiontext","questiontype","leadertext","valueslist","valuesarray","customvaluesarray","scalestyle","isrequired","validationroutine","viewtype","validationerrormsg","defaultvalue","filter","answerquota","requiredmsg","viewtypecssclass","customhtmlbeforelabel","customhtmlafterlabel","customhtmlbeforecontrols","customhtmlaftercontrols","customhtmlbetweencontrols"],widgetObj:{},init:function(e,t){this.surveyId=e,this.configLocation=t,this.json=this.configLocation+this.surveyId+".json",MetricalApp.logging.logInfo("SurveyID "+this.surveyId),MetricalApp.logging.logInfo("JSON location "+this.json)},getWidget:function(e){var t=this;this.widgetObj={isReturningBehavior:function(){return!(!this.isReturningBehaviorDismissed()&&!this.isReturningBehaviorAnswered())},isReturningBehaviorDismissed:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviorclose&&"dismissed"==t&&(e=!0),e},isReturningBehaviorAnswered:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviorsubmit&&"answered"==t&&(e=!0),e},isReturningBehaviorNoInteraction:function(){var e=!1,t=this.getTransitionalValue();return void 0!==SurveyMdl.widgetObj.returningbehaviornointeraction&&"nointeraction"==t&&(e=!0),e},getTransitionalValue:function(){var e=!1;return cookieName=MetricalApp.transitialCookeName,docCookies.hasItem(cookieName)&&(e=docCookies.getItem(cookieName)),e},getReturningBehavior:function(){var e=null;return this.isReturningBehaviorAnswered()&&(e=this.returningbehaviorsubmit),this.isReturningBehaviorDismissed()&&(e=this.returningbehaviorclose),this.isReturningBehaviorNoInteraction()&&(e=this.returningbehaviornointeraction),e}},MetricalApp.logging.logInfo("making call for JSON survey"),$.ajax({crossDomain:!0,url:this.json,dataType:"json",ContentType:"application/json;charset=utf-8",success:function(i){try{if(MetricalApp.logging.logInfo("successfully received JSON survey, here is raw data: ",i),MetricalApp.logging.logInfo("setting up widget keys"),t.setupWidgetKeys(i),MetricalApp.logging.logInfo("setting up questions"),null!=i.questions&&t.setupQuestions(i),MetricalApp.setJS(),null!=i.questions&&MetricalApp.setSliderCSSJS(),null!=i.ipblacklist&&null!=i.ipblacklist.enabled&&1==i.ipblacklist.enabled&&t.widgetObj.startingbehavior!=StartingBehavior.noDisplayBehavior){MetricalApp.logging.logInfo("ipblacklist is enabled and executing"),t.widgetObj.ipblacklist_enabled=!0;var o=t.determineBlacklistMatchingKeys(i.ipblacklist.matchingkeys,MetricalApp.properties.usermeta);MetricalApp.logging.logInfo("blacklist object ",o),t.isBlacklisted(i.surveyid,o,i.ipblacklist.timeframe,function(i){0==i?(MetricalApp.logging.logInfo("request was not blacklisted, running callback"),e(t.widgetObj)):(MetricalApp.setTransitionalCookie("answered"),setTimeout(function(){"lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click()},2e3))})}else MetricalApp.logging.logInfo("ipblacklist is not enabled and running the callback"),t.widgetObj.ipblacklist_enabled=!1,e(t.widgetObj)}catch(e){MetricalApp.logging.logError(e),WidgetExceptions.exception(e.toString())}},error:function(e,t,i){log(i+" : "+e.statusText)}})},determineBlacklistMatchingKeys:function(e,t){for(var i={},o=0;o<e.length;o++){var r=e[o];null!=t[r]&&(i[r]=t[r])}return i},isBlacklisted:function(e,t,i,o){var r=[];r.push("surveyid="+encodeURI(e)),r.push("timeframe="+encodeURI(i)),r.push("data="+encodeURI(JSON.stringify(t)));var n=r.join("&"),a=MetricalApp.properties.apiendpointhost+"/index.php/blacklist/check?"+n;MetricalApp.logging.logInfo("calling blacklist url "+a),$.ajax({crossDomain:!0,url:a,dataType:"json",ContentType:"application/json;charset=utf-8",success:function(e){try{MetricalApp.logging.logInfo("successful response to blacklist check ",e),"function"==typeof o&&o(e.isblacklisted)}catch(e){MetricalApp.logging.logError(e),WidgetExceptions.exception(e.toString())}}})},setupWidgetKeys:function(e){for(MetricalApp.logging.logInfo("trying to process specific experiences"),this.processSpecificExperience(e),i=0;i<this.surveyKeys.length;i++){var t=this.surveyKeys[i];this.widgetObj[t]=e[t],MetricalApp.logging.logInfo("adding key "+t+" to this.widgetObj")}null==this.widgetObj.answercountisactive&&(this.widgetObj.answercountisactive=!1),null==this.widgetObj.leadboxerisactive&&(this.widgetObj.leadboxerisactive=!1),MetricalApp.logging.logInfo("this.widgetObj after processing keys ",this.widgetObj),this.widgetObj.visibleonmobile=!0,null!=e.visibleonmobile&&(e.visibleonmobile?this.widgetObj.visibleonmobile=!0:this.widgetObj.visibleonmobile=!1),MetricalApp.logging.logInfo("visibleonmobile value ",this.widgetObj.visibleonmobile),e.avoidviewportformobile?this.widgetObj.avoidviewportformobile=!0:this.widgetObj.avoidviewportformobile=!1,MetricalApp.logging.logInfo("avoidviewportformobile value ",this.widgetObj.avoidviewportformobile),null!=e.displayfeedbacktab?this.widgetObj.displayfeedbacktab=e.displayfeedbacktab:this.widgetObj.displayfeedbacktab=!0,MetricalApp.logging.logInfo("displayfeedbacktab value ",this.widgetObj.displayfeedbacktab),this.widgetObj.visibleontablet=!0,null!=e.visibleontablet&&(e.visibleontablet?this.widgetObj.visibleontablet=!0:this.widgetObj.visibleontablet=!1),MetricalApp.logging.logInfo("visibleontablet value ",this.widgetObj.visibleontablet),this.widgetObj["startingbehavior-nodisplay"]="",this.widgetObj["startingbehavior-closedonstart"]="",this.widgetObj["startingbehavior-openedonstart"]="",e.startingbehavior?(MetricalApp.logging.logInfo("determining starting behavior"),this.widgetObj.startingbehavior=StartingBehavior.getStartingBehavior(e.startingbehavior),MetricalApp.logging.logInfo("calculated starting behavior ",this.widgetObj.startingbehavior),void 0!==e.startingbehavior.closed_on_start&&(this.widgetObj["startingbehavior-closedonstart"]=e.startingbehavior.closed_on_start),void 0!==e.startingbehavior.opened_on_start&&(this.widgetObj["startingbehavior-openedonstart"]=e.startingbehavior.opened_on_start),void 0!==e.startingbehavior.nodisplay&&(this.widgetObj["startingbehavior-nodisplay"]=e.startingbehavior.nodisplay)):(MetricalApp.logging.logInfo("using default starting behavior"),this.widgetObj.startingbehavior=StartingBehavior.defaultStartingBehavior),e.position&&(MetricalApp.properties.position=e.position,MetricalApp.logging.logInfo("setting position from JSON survey ",MetricalApp.properties.position)),e.positiontype&&(MetricalApp.properties.positiontype=e.positiontype,MetricalApp.logging.logInfo("setting positiontype from JSON survey ",MetricalApp.properties.positiontype)),e.rendertype&&(MetricalApp.properties.rendertype=e.rendertype,MetricalApp.logging.logInfo("setting rendertype from JSON survey ",MetricalApp.properties.rendertype)),null==MetricalApp.properties.rendertype&&("desktop"!=MetricalApp.determineIdentifier()?MetricalApp.properties.rendertype="lightbox":MetricalApp.properties.rendertype="slideout",MetricalApp.logging.logInfo("setting the default value for rendertype",MetricalApp.properties.rendertype)),null!=e.questions&&$.each(e.questions,function(e,t){if("timedquestion"==t.questiontype)return MetricalApp.properties.rendertype="lightbox",MetricalApp.timedQuestionDelay=t.timetoclose,null!=t.buttonaction&&(MetricalApp.timedQuestionButtonAction=t.buttonaction),MetricalApp.logging.logInfo("For timedquestion questions only the lightbox rendertype is admitted. Setting the value for rendertype ",MetricalApp.properties.rendertype),!1}),1==e.offerimage&&(MetricalApp.properties.rendertype="lightbox"),null!=e.captureinteractions?this.widgetObj.captureinteractions=e.captureinteractions:this.widgetObj.captureinteractions=!1,MetricalApp.logging.logInfo("captureinteractions value ",this.widgetObj.captureinteractions),null!=e.captureallinteractions?this.widgetObj.captureallinteractions=e.captureallinteractions:this.widgetObj.captureallinteractions=!1,MetricalApp.logging.logInfo("captureallinteractions value ",this.widgetObj.captureallinteractions),null!=e.capturescrollinteractions?this.widgetObj.capturescrollinteractions=e.capturescrollinteractions:this.widgetObj.capturescrollinteractions=!1,MetricalApp.logging.logInfo("capturescrollinteractions value ",this.widgetObj.capturescrollinteractions),null!=e.norecordonsubmitifempty?this.widgetObj.norecordonsubmitifempty=e.norecordonsubmitifempty:this.widgetObj.norecordonsubmitifempty=!1,MetricalApp.logging.logInfo("norecordonsubmitifempty value ",this.widgetObj.norecordonsubmitifempty),null!=e.custominteractions&&(this.widgetObj.custominteractions=e.custominteractions),null!=e.displaythankyou?this.widgetObj.displaythankyou=e.displaythankyou:this.widgetObj.displaythankyou=!1,null!=e.hidetabaftersubmit?this.widgetObj.hidetabaftersubmit=e.hidetabaftersubmit:this.widgetObj.hidetabaftersubmit=!1,null!=e.hidetabafterclose?this.widgetObj.hidetabafterclose=e.hidetabafterclose:this.widgetObj.hidetabafterclose=!1,e.defaultstylesheet&&(MetricalApp.properties.defaultstylesheet=e.defaultstylesheet,MetricalApp.logging.logInfo("setting defaultstylesheet from JSON survey ",MetricalApp.properties.defaultstylesheet)),e.email&&(MetricalApp.properties.emailisactivestatus=e.email.isactive,MetricalApp.logging.logInfo("setting emailisactivestatus from JSON survey ",MetricalApp.properties.emailisactivestatus)),e.couponconfig?(MetricalApp.logging.logInfo("Initializing the _MetricalCoupon module"),_MetricalCoupon.init($,MetricalApp.logging,e.couponconfig,function(){_Metrical.ClientWidget.widgetObj.displaythankyou||($(".Metrical_lightbox").hide(),$(".MetricalContainer").hide())})):MetricalApp.logging.logInfo("skipping the init of the _MetricalCoupon module, no couponconfig present"),null!=e.postanswerisactive?this.widgetObj.postanswerisactive=e.postanswerisactive:this.widgetObj.postanswerisactive=!0,this.widgetObj.heartbeatisactive=e.heartbeatisactive||!1,MetricalApp.logging.logInfo("hidetabaftersubmit value ",this.widgetObj.hidetabaftersubmit),MetricalApp.logging.logInfo("hidetabafterclose value ",this.widgetObj.hidetabafterclose),MetricalApp.logging.logInfo("displaythankyou value ",this.widgetObj.displaythankyou),MetricalApp.logging.logInfo("getReturningBehavior ",this.widgetObj.getReturningBehavior()),MetricalApp.logging.logInfo("getTransitionalValue ",this.widgetObj.getTransitionalValue()),MetricalApp.logging.logInfo("isReturningBehavior ",this.widgetObj.isReturningBehavior()),MetricalApp.logging.logInfo("isReturningBehaviorAnswered ",this.widgetObj.isReturningBehaviorAnswered()),MetricalApp.logging.logInfo("isReturningBehaviorDismissed ",this.widgetObj.isReturningBehaviorDismissed())},processSpecificExperience:function(surveyObj){var that=this;null!=surveyObj.specificexperience&&"[object Array]"===Object.prototype.toString.call(surveyObj.specificexperience)&&(MetricalApp.logging.logInfo("specificexperience config detected ",surveyObj.specificexperience),$.each(surveyObj.specificexperience,function(key,value){if(null!=value.filter){MetricalApp.logging.logInfo("evaluating the filter "+value.filter);var result=eval(value.filter);if(MetricalApp.logging.logInfo("the filter result is "+result),result)return null!=value.replacements&&(MetricalApp.logging.logInfo("processing the replacements",value.replacements),$.each(value.replacements,function(e,t){"questions"==e?(MetricalApp.logging.logInfo("replacing values on these questions",t),that.replaceQuestionsValues(surveyObj,t)):(MetricalApp.logging.logInfo("replacing the value for the key "+e+" with this one: "+t),surveyObj[e]=t)})),!1}}))},replaceQuestionsValues:function(e,t){var i=this;$.each(t,function(t,o){var r=i.getQuestionById(e,o.id);null!=r&&$.each(o,function(e,t){r[e]=t})})},getQuestionById:function(e,t){var i;return $.each(e.questions,function(e,o){if(t==o.id)return i=o,!1}),i},setupQuestions:function(survey){var shuffle=function(e){for(var t,i,o=e.length;0!==o;)i=Math.floor(Math.random()*o),t=e[o-=1],e[o]=e[i],e[i]=t;return e},randomDisplayCount=survey.randomdisplaycount,questions=survey.questions,randomQuestionIds=[];questions.sort(function(e,t){return parseInt(e.order)-parseInt(t.order)});var idLookup={};MetricalApp.properties.nonrandomdisplaycount=0,MetricalApp.properties.randomdisplaycount=0;for(var newQuestions=[],i=0;i<questions.length;i++){var question=questions[i];if(1==question.isactive){var filterResult=!0;if(null!=question.filter&&(filterResult=eval(question.filter),MetricalApp.logging.logInfo("filter result for question "+question.id,filterResult)),1==filterResult)MetricalApp.logging.logInfo("question in loop: ",question),0==question.israndom?(newQuestions.push(question),MetricalApp.logging.logInfo("adding non-random question to newQuestions ",question),"statictext"!=question.questiontype&&MetricalApp.properties.nonrandomdisplaycount++):(randomQuestionIds.push(question.id),MetricalApp.logging.logInfo("adding random question to randomQuestionId array",question));else{var filterText=null!=question.filter?question.filter:"empty";MetricalApp.logging.logInfo("skipping question because it failed the filter "+filterText,question)}question.customhtmlbeforelabel=question.customhtmlbeforelabel||void 0,question.customhtmlafterlabel=question.customhtmlafterlabel||void 0,question.customhtmlbeforecontrols=question.customhtmlbeforecontrols||void 0,question.customhtmlaftercontrols=question.customhtmlaftercontrols||void 0,question.customhtmlbetweencontrols=question.customhtmlbetweencontrols||void 0}else MetricalApp.logging.logInfo("question is not active",question);idLookup[question.id]=i}randomQuestionIds.length<randomDisplayCount&&(randomDisplayCount=randomQuestionIds.length),MetricalApp.logging.logInfo("randomDisplayCount value ",randomDisplayCount);var selectedRandomQuestionIds=shuffle(randomQuestionIds).slice(0,randomDisplayCount);MetricalApp.logging.logInfo("randomly selected question ids ",selectedRandomQuestionIds),MetricalApp.properties.randomdisplaycount=selectedRandomQuestionIds.length;for(var i=0;i<selectedRandomQuestionIds.length;i++){var randomQuestionId=selectedRandomQuestionIds[i];MetricalApp.logging.logInfo("random question ID value: ",randomQuestionId);var questionIndex=idLookup[randomQuestionId];MetricalApp.logging.logInfo("random question index value: ",questionIndex);var question=questions[questionIndex];newQuestions.push(question),MetricalApp.logging.logInfo("adding random question to tempQuestions ",question)}questions=newQuestions,questions.sort(function(e,t){return parseInt(e.order)-parseInt(t.order)}),this.widgetObj.questions=questions,MetricalApp.logging.logInfo("questions ",questions)}};rootMetricalObj.ClientWidget=ClientWidget;var StartingBehavior={openBehavior:"opened_on_start",closeBehavior:"closed_on_start",noDisplayBehavior:"nodisplay",defaultStartingBehavior:"nodisplay",getStartingBehavior:function(e){if("object"==typeof e){var t=[],i=[];for(var o in e)t.push(e[o]),i.push(o);return MetricalApp.logging.logInfo("starting behavior weights ",t),MetricalApp.logging.logInfo("starting behavior keys ",i),this.getRandomItem(i,t)}return this.defaultStartingBehavior},getRandomItem:function(e,t){for(var i,o,r=t.reduce(function(e,t,i,o){return e+t}),n=(i=0,o=r,Math.random()*(o-i)+i),a=0,s=0;s<e.length;s++)if(n<=(a=+(a+=t[s]).toFixed(4)))return e[s]}};rootMetricalObj.StartingBehavior=StartingBehavior;var SurveyMdl={questionGuids:[],questionType:[],requiredList:[],customValuesRequiredList:{},validatorList:[],defaultValuesList:[],widgetObj:{},startingbehaviorOpen:"opened_on_start",startingbehaviorNoDisplay:"nodisplay",setWidget:function(e){void 0===e.thankyoumessages&&(e.thankyoumessages="Thank you for your feedback."),void 0===e.thankyouviewclass&&(e.thankyouviewclass="default"),this.widgetObj=e,null!=MetricalApp.properties.iframesubmitredirect&&""!=MetricalApp.properties.iframesubmitredirect&&(this.widgetObj.iframesubmitredirect=MetricalApp.properties.iframesubmitredirect)},setCSS:function(e){MetricalApp.logging.logInfo("Loading additional CSS",e.css),that=this,MetricalApp.properties.defaultstylesheet?(MetricalApp.logging.logInfo("Loading the default stylesheet",MetricalApp.properties.staticendpointhost+MetricalApp.properties.defaultstylesheet),$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+MetricalApp.properties.staticendpointhost+MetricalApp.properties.defaultstylesheet+"' type='text/css' >")):MetricalApp.logging.logInfo("Skipping the default stylesheet"),void 0!==e.css&&($.isArray(e.css)?$.each(e.css,function(e,t){$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+t+"' type='text/css' >")}):$("head link[rel='stylesheet']").last().after("<link rel='stylesheet' href='"+e.css+"' type='text/css' >"))},init:function(e){this.getSurvey(e)},getSurvey:function(render_callback){var that=this;MetricalApp.logging.logInfo("running getSurvey in SurveyMdl"),uuid=docCookies.hasItem("_MetricalObject_did")?docCookies.getItem("_MetricalObject_did"):"",usermeta=encodeURIComponent(JSON.stringify(MetricalApp.properties.usermeta));var configLocation=null;configLocation=null!=MetricalApp.properties.configendpoint?url_protocol()+MetricalApp.properties.configendpoint:MetricalApp.properties.staticendpointhost+"/survey_files/",ClientWidget.init(Metrical_options.survey,configLocation),ClientWidget.getWidget(function(data){if(MetricalApp.logging.logInfo("running ClientWidget.getWidget() callback",data),void 0===data.isactive||null===data.isactive||1==data.isactive){MetricalApp.logging.logInfo("isactive is true, continuing execution",data);var filterResult=!0,filterText=void 0!==data.filter?data.filter:"empty";void 0!==data.filter&&(filterResult=eval(data.filter),MetricalApp.logging.logInfo("checking survey filter "+filterText,data)),1==filterResult?(Validator.widget(data),that.setCSS(data),that.setWidget(data),that.setParams(),render_callback()):MetricalApp.logging.logInfo("survey filter "+filterText+" did not match, stopping execution",data)}else MetricalApp.logging.logInfo("isactive is false, stopping execution",data);if(0==data.isactive&&0==data.succeed)var closeTimeout=setTimeout(function(){$(".Metrical").data("closeBehavior",SurveyMdl.widgetObj.returningbehaviorsubmit),"lightbox"==MetricalApp.properties.rendertype?$(".close-widget").click():$(".MetricalTab").click()},2e3)})},setParams:function(){for(var e in properties=[],MetricalApp.properties.usermeta)properties[e]=MetricalApp.properties.usermeta[e];this.widgetObj.questions&&$.each(this.widgetObj.questions,function(e,t){SurveyMdl.questionGuids.push(t.id),SurveyMdl.questionType[t.id]=t.questiontype,t.isrequired&&SurveyMdl.requiredList.push(t.id),t.validationroutine&&(SurveyMdl.validatorList[t.id]=t.validationroutine),t.defaultvalue&&(SurveyMdl.defaultValuesList[t.id]=t.defaultvalue),properties[t.id]&&(SurveyMdl.defaultValuesList[t.id]=properties[t.id]),t.customvaluesarray&&$.each(t.customvaluesarray,function(e,t){SurveyMdl.questionGuids.push(t.customvalueid),t.isrequired&&(SurveyMdl.customValuesRequiredList[t.customvalueid]=t.optionswithcustomvalue),t.validationroutine&&(SurveyMdl.validatorList[t.customvalueid]=t.validationroutine)})})},getQuestionType:function(e){var t=void 0;return $.each(this.widgetObj.questions,function(i,o){o.id==e&&(t=o.questiontype)}),t}};rootMetricalObj.isVisibleOnStart=function(){return null!=SurveyMdl.widgetObj.startingbehavior&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.openBehavior};var SurveyAnswersMdl={questionsAnswers:[],qaToggleQuestions:[],hasAnswers:function(){var e=!1;return $.each(SurveyMdl.questionGuids,function(t,i){void 0!==SurveyAnswersMdl.questionsAnswers[i]&&(e=!0)}),e},getMultiCheckboxGuids:function(e){for(var t=[],i=Object.keys(this.questionsAnswers),o=0;o<i.length;o++){var r=i[o];-1!==r.indexOf(e)&&t.push(r)}return t},postQuestionAnswer:function(e,t){var i=this;time=$.now();var o=new Object;o.survey_guid=Metrical_options.survey,o.esid=SurveyMdl.widgetObj.esid,o.timestamp=time,o.referrer_ip="ip",o.cors=$.support.cors?1:0;var r=[];$.each(SurveyMdl.questionGuids,function(e,t){if("multicheckbox"==SurveyMdl.getQuestionType(t)){var o=i.getMultiCheckboxGuids(t);$.each(o,function(e,t){r.push({question_guid:t,value:SurveyAnswersMdl.questionsAnswers[t]})})}else null!=SurveyAnswersMdl.questionsAnswers[t]&&r.push({question_guid:t,value:SurveyAnswersMdl.questionsAnswers[t]})}),0==r.length&&0==SurveyMdl.requiredList.length&&null!=SurveyMdl.questionGuids[0]&&(first_guid=SurveyMdl.questionGuids[0],r.push({question_guid:first_guid,value:""})),o.score=r,$device=MetricalApp.determineIdentifier(),"desktop"==$device?$deviceObj={desktopsubmit:!0}:"tabletvertical"==$device||"tablethorizontal"==$device?$deviceObj={tabletsubmit:!0}:"mobile"==$device&&($deviceObj={mobilesubmit:!0}),o.usermeta=this.properties=$.extend({},Metrical_options.usermeta,$deviceObj),i.setCookie(),o.usermeta.cookies=MetricalApp.getCookies(),void 0!==MetricalApp.properties.customersite?o.usermeta.url=MetricalApp.properties.customersite:o.usermeta.url=document.URL,o.opening_state=SurveyMdl.widgetObj.startingbehavior,ClientWidget.widgetObj.isReturningBehaviorAnswered()?o.opening_state=SurveyMdl.widgetObj.returningbehaviorsubmit:ClientWidget.widgetObj.isReturningBehaviorDismissed()?o.opening_state=SurveyMdl.widgetObj.returningbehaviorclose:ClientWidget.widgetObj.isReturningBehaviorNoInteraction()&&(o.opening_state=SurveyMdl.widgetObj.returningbehaviornointeraction),o.events=CustomerEvents,o.survey_revision=SurveyMdl.widgetObj.revision,o.instance_id=MetricalApp.instanceId,sessionid=docCookies.hasItem("_MetricalObject_sessionid")?docCookies.getItem("_MetricalObject_sessionid"):"",o.session_id=sessionid,containerHeight=$("div.lb-wrapper div#form-container").height(),MetricalApp.logging.logInfo("posting answer submission",o);var n=!0;if(1==SurveyMdl.widgetObj.norecordonsubmitifempty){console.log(SurveyMdl.questionGuids);var a=SurveyMdl.questionGuids;$.each(a,function(e,t){"statictext"==SurveyMdl.getQuestionType(t)&&a.splice(e,1)}),console.log(a),console.log(r);for(var s=!1,l=0;l<r.length;l++){var c=r[l];if(a.indexOf(c.question_guid)>-1){s=!0;break}}0==s&&(n=!1)}i=this;if(0==n){var d=ThankYouView;null!=SurveyMdl.widgetObj.thankyouviewclass&&"default"!=SurveyMdl.widgetObj.thankyouviewclass&&"altthankyou"!=SurveyMdl.widgetObj.thankyouviewclass&&(d=window[SurveyMdl.widgetObj.thankyouviewclass]),AnswersDictionary.init(SurveyMdl.widgetObj.questions,SurveyAnswersMdl.questionsAnswers),SurveyMdl.widgetObj.displaythankyou?MetricalApp.properties.iframe?($("div.lb-wrapper div#form-container").height(containerHeight),$(".Metrical form").replaceWith(d.thankYouMarkup(AnswersDictionary))):($("div.lb-wrapper div#form-container").height(containerHeight),MetricalApp.el.find("form").replaceWith(d.thankYouMarkup(AnswersDictionary))):MetricalApp.logging.logInfo("displaythankyou property is false, so the ThankYou page will not be displayed"),SurveyAnswersMdl.questionsAnswers=[],SurveyMdl.questionGuids=[]}else _MetricalInteractions.recordInteraction("answered"),SurveyMdl.widgetObj.postanswerisactive?$.ajax({type:"POST",dataType:"json",data:o,traditional:!1,url:MetricalApp.properties.surveyanswerendpoint,success:function(e){MetricalApp.logging.logInfo("posting succeeded",e),i.doAfterPostActions(t)},error:function(e,t,i){SurveyMdl.getSurvey(function(){Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!0)}),log(i+" : "+e.statusText)}}):i.doAfterPostActions(o,t)},doAfterPostActions:function(dataQA,timedQuestion){"lightbox"==MetricalApp.properties.rendertype&&$(".MetricalTab").hasClass("hidden")&&$(".MetricalTab").removeClass("hidden"),SurveyMdl.widgetObj.hidetabaftersubmit&&setInterval(function(){$(".MetricalTab").hide()},2e3),"function"==typeof MetricalApp.properties.postCallback&&(MetricalApp.logging.logInfo("executing post callback"),MetricalApp.properties.postCallback(dataQA));var thankYouViewClass=ThankYouView;null!=SurveyMdl.widgetObj.thankyouviewclass&&"default"!=SurveyMdl.widgetObj.thankyouviewclass&&"altthankyou"!=SurveyMdl.widgetObj.thankyouviewclass&&(thankYouViewClass=window[SurveyMdl.widgetObj.thankyouviewclass]),AnswersDictionary.init(SurveyMdl.widgetObj.questions,SurveyAnswersMdl.questionsAnswers),SurveyMdl.widgetObj.displaythankyou?MetricalApp.properties.iframe?($("div.lb-wrapper div#form-container").height(containerHeight),$(".Metrical form").replaceWith(thankYouViewClass.thankYouMarkup(AnswersDictionary))):($("div.lb-wrapper div#form-container").height(containerHeight),MetricalApp.el.find("form").replaceWith(thankYouViewClass.thankYouMarkup(AnswersDictionary))):MetricalApp.logging.logInfo("displaythankyou property is false, so the ThankYou page will not be displayed"),SurveyAnswersMdl.questionsAnswers=[],SurveyMdl.questionGuids=[],$(".MetricalContainer").hasClass("widget-size-no-autoheight")||$(".MetricalContainer").css("height","auto"),$(".container-bottom .MetricalTab").css("bottom",Widget.defaultTabBottomValue+"px"),$(".container-bottom ").css("bottom",Widget.defaultBottomValue+"px"),MetricalApp.properties.iframe&&null!=SurveyMdl.widgetObj.iframesubmitredirect&&""!=SurveyMdl.widgetObj.iframesubmitredirect&&(window.location.href=SurveyMdl.widgetObj.iframesubmitredirect),void 0!==SurveyMdl.widgetObj.widgetreloaded&&1!=SurveyMdl.widgetObj.widgetreloaded||(SurveyMdl.widgetObj={},SurveyMdl.getSurvey(function(){Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!0)})),timedQuestion&&(null!=MetricalApp.timedQuestionButtonAction&&eval(MetricalApp.timedQuestionButtonAction),clearInterval(MetricalApp.tabCloserTimer),setTimeout(function(){jQuery(".MetricalContainer").hide()},2e3))},setCookie:function(){var e=this,t=MetricalApp.cookieName[0],i=[],o=[];if(docCookies.hasItem(t)){var r=docCookies.getItem(t);if(r){var n=r.split("; ");$.each(n,function(e,t){var r=t.split("=");o.push(r[0]),i[r[0]]=r[1]})}}var a=Misc.union_arrays(SurveyMdl.questionGuids,o),s="";$.each(a,function(t,o){addToCookie=!0,o in SurveyMdl.questionType&&"openended"==SurveyMdl.questionType[o]&&(addToCookie=!1);var r=void 0!==e.questionsAnswers[o]?e.questionsAnswers[o]:i[o];void 0===r&&(addToCookie=!1),"undefined"==r&&(addToCookie=!1),addToCookie&&(s+=o+"="+r+"; ")}),s=s.substring(0,s.length-1);var l=new Date;l.setTime(l.getTime()+15768e7),docCookies.setItem(t,s,l)}},WidgetView={questionMarkup:function(e,t,i){var o,r=t.questiontext,n="",a=!1,s="";if(null!=t.displayconditions&&t.displayconditions.length>0){s="metrical-hidden-question";for(let e=0;e<t.displayconditions.length;e++){const i=t.displayconditions[e];SurveyAnswersMdl.qaToggleQuestions[i.questionid]={answers:i.answers,questionToToggle:t.id}}}if(null==r||""==r)n="noQuestionText";var l="";null!=t.viewtypecssclass&&(l=t.viewtypecssclass);var c="";if("dropdown"==t.viewtype&&(c="select-item"),"statictext"===t.questiontype)return html='<li class="field statictext '+n+" "+l+" "+s+'" id="question_'+t.id+'">',t.customhtmlbeforelabel&&(html+=t.customhtmlbeforelabel),null!=r&&""!=r&&(html+="<label>"+r+"</label>"),t.customhtmlafterlabel&&(html+=t.customhtmlafterlabel),html+='<div class = "clear-float"></div>',html+="</li>",html;if("slider"===t.questiontype)return html='<li class="field '+n+" "+l+" "+s+'" id="question_'+t.id+'">',html+='<input type = "hidden" class = "metrical-question-quid" value = "'+t.id+'" name = "metrical-question-guid-'+e+'"/>',t.customhtmlbeforelabel&&(html+=t.customhtmlbeforelabel),null!=r&&""!=r&&(html+="<label>"+r+"</label>"),t.customhtmlafterlabel&&(html+=t.customhtmlafterlabel),t.customhtmlbeforecontrols&&(html+=t.customhtmlbeforecontrols),html+='<div style="text-align: center;">',html+='<span class="slider-container" style="display: inline-block; width: 80%; padding: 30px 5px 30px 5px;">',html+='<input id = "'+t.id+'" type="slider" value="0"/>',html+="</span>",html+="</div>",t.customhtmlaftercontrols&&(html+=t.customhtmlaftercontrols),html+='<div class = "clear-float"></div>',html+="</li>",html;var d="";void 0===t.leftsidedescription&&void 0===t.rightsidedescription||(void 0!==t.leftsidedescription&&null==t.rightsidedescription?chars=t.leftsidedescription.length:null==t.leftsidedescription&&null!=t.rightsidedescription?chars=t.rightsidedescription.length:chars=t.leftsidedescription.length>t.rightsidedescription.length?t.leftsidedescription.length:t.rightsidedescription.length,paddingRows=Math.floor(chars/8),d="field-with-legend-"+paddingRows),html='<li class="field '+n+" "+d+" "+l+" "+s+" "+c+'" id="question_'+t.id+'">',html+='<input type = "hidden" class = "metrical-question-quid" value = "'+t.id+'" name = "metrical-question-guid-'+e+'"/>',t.customhtmlbeforelabel&&(html+=t.customhtmlbeforelabel),null!=r&&""!=r&&(html+="<label>"+r+"</label>"),t.customhtmlafterlabel&&(html+=t.customhtmlafterlabel);var u="";if("checkbox"===t.questiontype?u="container-checkbox-left":"radiobuttons"==t.viewtype?u="container-options-left":"box"==t.viewtype&&(u="container-options-boxed"),t.customhtmlbeforecontrols&&(html+=t.customhtmlbeforecontrols),html+='<div class="ratings '+u+'">',null==t.requiredmsg&&(t.requiredmsg="*This field is required"),t.isrequired&&(html+='<div class = "required error" style="display:none" id = "span-'+t.id+'-message">'+t.requiredmsg+"</div>"),"openended"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",html+='<textarea name="message" rows="10" wrap="soft" placeholder="'+t.leadertext+'" class = "metrical-question-answer" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'" >'+defaultVal+"</textarea>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);else if("textbox"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",null==t.validationerrormsg&&(t.validationerrormsg="Wrong format"),html+='<span class = "error">'+t.validationerrormsg+'</span><input type = "text" name="textbox"  placeholder="'+t.leadertext+'"  class = "mqa-textbox" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'"  value = "'+defaultVal+'" />',t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);else if("checkbox"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]&&(defaultVal=SurveyMdl.defaultValuesList[t.id]),1!=t.isrequired&&(SurveyAnswersMdl.questionsAnswers[t.id]="0"),html+='<input type="checkbox" name="checkbox" class="mqa-checkbox" id = "metrical-question-'+e+'" name = "metrical-question-'+e+'"  /><label for="metrical-question-'+e+'">'+t.leadertext+"</label>",html+='<input type = "hidden" class = "mqa-checkbox-default" value = "'+defaultVal+'"/>',t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);else if("multicheckbox"===t.questiontype){a=!0,f="",v="",null!=t.valuesorder?valueskeys=t.valuesorder:valueskeys=Object.keys(t.valueslist);for(var p=0;p<valueskeys.length;p++)if(key=valueskeys[p],val=t.valueslist[key],-1!==key.indexOf("randomize"))WidgetView.getOptionsRandomOrder(val,function(i,o){var r="";null!=t.exclusiveoptions&&-1!==t.exclusiveoptions.indexOf(o)&&(r="exclusive-option");var n="metrical-question-"+e+"-"+o;html+='<div class="checkbox-row container-checkbox-left"><input type="checkbox" name="checkbox" class="multi-checkbox '+r+'" id="'+n+'" name="'+n+'" value="'+o+'" /><label for="'+n+'">'+val[o]+"</label></div>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);var a=t.id+"-"+o;SurveyAnswersMdl.questionsAnswers[a]=0});else{var h="";null!=t.exclusiveoptions&&-1!==t.exclusiveoptions.indexOf(key)&&(h="exclusive-option");var g="metrical-question-"+e+"-"+key;html+='<div class="checkbox-row container-checkbox-left"><input type="checkbox" name="checkbox" class="multi-checkbox '+h+'" id="'+g+'" name="'+g+'" value="'+key+'" /><label for="'+g+'">'+val+"</label></div>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols);var m=t.id+"-"+key;SurveyAnswersMdl.questionsAnswers[m]=0}}else if("customlist"===t.questiontype){a=!0,SurveyAnswersMdl.questionsAnswers[t.id]=void 0,void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="","dropdown"==t.viewtype&&(html+='<select name = "metrical-question-'+e+'" class="widget-select">'),null!=t.valuesorder?valueskeys=t.valuesorder:valueskeys=Object.keys(t.valueslist);for(p=0;p<valueskeys.length;p++)if(key=valueskeys[p],val=t.valueslist[key],"dropdown"==t.viewtype)defaultVal===key?chkd=" selected = 'SELECTED'":chkd="",-1!==key.indexOf("randomize")?WidgetView.getOptionsRandomOrder(val,function(e,t){html+='<option value="'+t+'"  '+chkd+">"+val[t]+"</options>"}):html+='<option value="'+key+'"  '+chkd+">"+val+"</options>";else{defaultVal===key?chkd=" checked = 'CHECKED'":chkd="";var f="",v="";f="";"boxstacked"==t.viewtype?(f="box-stacked",v="radio-box-stacked"):"box"==t.viewtype?(f="box",v="radio-box"):"radiobuttons"==t.viewtype&&(f="radio-buttons",v="radio-buttons-input"),-1!==key.indexOf("randomize")?WidgetView.getOptionsRandomOrder(val,function(t,i){html+="<input "+chkd+' type="radio" class = "'+v+'" id = "radio'+e+i+'" name = "metrical-question-'+e+'" value="'+i+'"><label class = "'+f+'" id = "label-radio'+e+i+'" for="radio'+e+i+'">'+val[i]+"</label>"}):html+="<input "+chkd+' type="radio" class = "'+v+'" id = "radio'+e+key+'" name = "metrical-question-'+e+'" value="'+key+'"><label class = "'+f+'" id = "label-radio'+e+key+'" for="radio'+e+key+'">'+val+"</label>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols)}"dropdown"==t.viewtype&&(html+="</select>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols))}else if("customarray"===t.questiontype)a=!0,SurveyAnswersMdl.questionsAnswers[t.id]=void 0,void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="","dropdown"==t.viewtype&&(html+='<select name = "metrical-question-'+e+'" class="widget-select">'),null!=t.valuesarray&&$.each(t.valuesarray,function(i,o){if("dropdown"==t.viewtype)defaultVal===o?chkd=" selected = 'SELECTED'":chkd="",html+='<option value="'+i+'"  '+chkd+">"+o+"</options>";else{defaultVal===o?chkd=" checked = 'CHECKED'":chkd="";var r="",n="";"boxstacked"==t.viewtype?(r="box-stacked",n="radio-box-stacked"):"box"==t.viewtype?(r="box",n="radio-box"):"radiobuttons"==t.viewtype&&(r="radio-buttons",n="radio-buttons-input"),"radiobuttons"==t.viewtype&&(html+='<div class="radiolabelrow">'),html+="<input "+chkd+'  type="radio" class = "'+n+'" id = "radio'+e+i+'" name = "metrical-question-'+e+'" value="'+i+'"><label class = "'+r+'" id = "label-radio'+e+i+'" for="radio'+e+i+'">'+o+"</label>","radiobuttons"==t.viewtype&&(html+="</div>"),t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols)}}),"dropdown"==t.viewtype&&(html+="</select>",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols));else if("scalestyle"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",numElements=t.valuesarray.length,first="first",last="",$.each(t.valuesarray,function(e,i){e==numElements-1&&(last="last"),i<=defaultVal?active=" active ":active="",leftLegend="",rightLegend="",""!=first&&void 0!==t.leftsidedescription&&(leftLegend='<div class="scale-legend left '+t.scalestyle.replace("-star","")+'">'+t.leftsidedescription+"</div>"),""!=last&&void 0!==t.rightsidedescription&&(rightLegend='<div class="scale-legend right '+t.scalestyle.replace("-star","")+'">'+t.rightsidedescription+"</div>"),html+='<a href="#"  class="'+t.scalestyle+" "+first+" "+last+" "+active+' " value = "'+i+'">'+leftLegend+rightLegend+"</a>",first="",t.customhtmlbetweencontrols&&(html+=t.customhtmlbetweencontrols)});else if("faces2"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",faces={1:"face_fair",2:"face_great"},html+=this.getFacesQuestionMarkup(faces,2);else if("faces3"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",faces={1:"face_fair",2:"face_good",3:"face_great"},html+=this.getFacesQuestionMarkup(faces,3);else if("faces5"===t.questiontype)void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="",faces={1:"face_poor",2:"face_fair",3:"face_good",4:"face_great",5:"face_excellent"},html+=this.getFacesQuestionMarkup(faces,5);else if("timedquestion"===t.questiontype){void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="yes",lineCounter=1,$.each(t.questioncontentlines,function(e,i){null!=t.linessurroundedbyclock&&1==lineCounter&&(html+='<div class="clock">'),lineStyles="",null!=i.styles&&(lineStyles='style="'+i.styles+'"'),lineClasses="",null!=i.classes&&(lineClasses='class="'+i.classes+'"'),html+="<p "+lineStyles+" "+lineClasses+">"+i.text+"</p>",null!=t.linessurroundedbyclock&&parseInt(t.linessurroundedbyclock)==lineCounter&&(html+="</div>"),lineCounter++}),html+='</div><div class="ratings">';var b="";if(null!=t.cancelbutton&&1==t.cancelbutton){var y="Cancel";null!=t.cancelbuttontext&&(y=t.cancelbuttontext),html+='<input type="button" id="metrical-cancel-button" name = "'+y+'" value = "'+y+'"   class = "cancel-button col-half enabled">',b="col-half"}if(null!=t.buttontext)var M=t.buttontext;if(null!=t.submitbuttontext)M=t.submitbuttontext;html+='<input type="submit" id="metrical-timedquestion-button" name = "'+M+'" value = "'+M+'"   class = "enabled '+b+'">'}else{void 0!==SurveyMdl.defaultValuesList[t.id]?(defaultVal=SurveyMdl.defaultValuesList[t.id],SurveyAnswersMdl.questionsAnswers[t.id]=defaultVal):defaultVal="";var w=1,k=i.numberofstars||defaultStarsForScale;for(htmlArray=[];w<=k;)first=1==w?"first":"",last=w==k?"last":"",active=w<=defaultVal?"active":"",leftLegend="",rightLegend="",""!=first&&void 0!==t.leftsidedescription&&(leftLegend='<div class="scale-legend left">'+t.leftsidedescription+"</div>"),""!=last&&void 0!==t.rightsidedescription&&(rightLegend='<div class="scale-legend right">'+t.rightsidedescription+"</div>"),htmlArray.push('<a href="#"  class="star '+first+" "+last+" "+active+' " value = "'+w+'">'+leftLegend+rightLegend+"</a>"),t.customhtmlbetweencontrols&&htmlArray.push(t.customhtmlbetweencontrols),w++;html+=htmlArray.join("")}if(html+="</div>",t.customhtmlaftercontrols&&(html+=t.customhtmlaftercontrols),html+='<div class = "clear-float"></div>',a&&(null!=t.valuesarray||null!=t.valueslist)&&null!=t.customvaluesarray){var I={};$.each(t.customvaluesarray,function(i,o){1==o.isactive&&(html+='<div class="metrical-question-customvalue" id="customvalue-'+o.customvalueid+'">',html+='<input type = "hidden" class = "metrical-question-quid" value = "'+o.customvalueid+'" name = "metrical-question-guid-'+e+"-"+i+'" id="customvalue-'+o.customvalueid+'-input"/>',o.isrequired&&(html+='<div class = "required error" style="display:none" id = "span-'+o.customvalueid+'-message">'+t.requiredmsg+"</div>"),o.customhtmlbeforelabel&&(html+=o.customhtmlbeforelabel),null!=o.questiontext&&""!=o.questiontext&&(html+="<label>"+o.questiontext+"</label>"),o.customhtmlafterlabel&&(html+=o.customhtmlafterlabel),o.customhtmlbeforecontrols&&(html+=o.customhtmlbeforecontrols),html+='<div class="ratings">',placeHolder="",o.leadertext&&(placeHolder=o.leadertext),o.validationerrormsg&&(html+='<span class = "error">'+o.validationerrormsg+"</span>"),"openended"==o.optioncustomvaluetype?(html+='<textarea name="message" rows="5" wrap="soft" placeholder="'+placeHolder+'" class="metrical-question-answer" id="customvalue-'+o.customvalueid+"-"+e+'" name="metrical-question-'+e+"-"+i+'" ></textarea>',o.customhtmlbetweencontrols&&(html+=o.customhtmlbetweencontrols)):"textbox"==o.optioncustomvaluetype?(html+='<input type="text" name="textbox"  placeholder="'+placeHolder+'"  class="mqa-textbox" id="customvalue-'+o.customvalueid+"-"+e+'" name="metrical-question-'+e+"-"+i+'"  value="" />',o.customhtmlbetweencontrols&&(html+=o.customhtmlbetweencontrols)):"dropdown"==o.optioncustomvaluetype&&(html+='<select name = "metrical-question-'+e+'" class="widget-select" id="customvalue-'+o.customvalueid+"-"+e+'" name="metrical-question-'+e+"-"+i+'" >',$.each(o.valuesarray,function(e,t){chkd="",html+='<option value="'+e+'"  '+chkd+">"+t+"</options>"}),html+="</select>",o.customhtmlbetweencontrols&&(html+=o.customhtmlbetweencontrols)),html+="</div>",o.customhtmlaftercontrols&&(html+=o.customhtmlaftercontrols),html+='<div class = "clear-float"></div>',html+="</div>",$.each(o.optionswithcustomvalue,function(e,t){I[t.toString()]=o.customvalueid}))}),o=I;var C="[name=metrical-question-"+e+"]";"multicheckbox"==t.questiontype?(C="input[id^=metrical-question-"+e+"-]",$(document).on("change",C,function(t){""!=this.id&&$(this).is("select")||($("#customvalue-"+o[this.value]).fadeIn("slow"),t.target.checked||($("#customvalue-"+o[this.value]).fadeOut("fast"),delete SurveyAnswersMdl.questionsAnswers[o[this.value]],customValueElement=$("#customvalue-"+o[this.value]+"-"+e),customValueElement.val(""),customValueElement.is("select")&&customValueElement.val(0)),Widget.setWidgetPosition())})):$(document).on("change",C,function(t){if(""==this.id||!$(this).is("select")){for(var i in $("#customvalue-"+o[this.value]).fadeIn("slow"),o)o[i]!=o[this.value]&&(delete SurveyAnswersMdl.questionsAnswers[o[i]],$("#customvalue-"+o[i]).fadeOut("fast"),customValueElement=$("#customvalue-"+o[i]+"-"+e),customValueElement.val(""),customValueElement.is("select")&&customValueElement.val(0));Widget.setWidgetPosition()}})}return html+="</li>",$(document).on("click","#metrical-cancel-button",function(){$(".close-widget").trigger("click")}),html},getOptionsRandomOrder:function(e,t){var i=Object.keys(e);i.sort(function(){return.5-Math.random()}),$.each(i,t)},getFacesQuestionMarkup:function(e,t){htmlArray=[];for(var i=1;i<=t;)face=e[i],first=1==i?"first":"",last=i==t?"last":"",active=i==defaultVal?"active":"",htmlArray.push('<a href="#"  class="face '+face+" "+first+" "+last+" "+active+' " value = "'+i+'"></a>'),i++;return htmlArray.join("")},widgetMarkup:function(e){var t=this;if(html="",null!=e.offerimage&&e.offerimage){var i=MetricalApp.determineIdentifier(),o=e.couponconfig.closemap,r=e.couponconfig.submitmap,n=e.couponconfig.imageurl;if("mobile"==i&&null!=n.mobile){n=n.mobile;var a=o.mobile.shape,s=o.mobile.coordinates,l=r.mobile.shape,c=r.mobile.coordinates}else{n=n.desktop;a=o.desktop.shape,s=o.desktop.coordinates,l=r.desktop.shape,c=r.desktop.coordinates}var d=$(window).width(),u=$(window).height(),p=new Image;if(p.src=n,html+='<div style="background-color: transparent;" class="lb-wrapper">',html+='<div class="close-widget hidden"></div>',html+='<div id="form-container">',html+='<form id="metrical-widget-form" novalidate>',html+='<input id="metrical-surveyid" type = "hidden" value = "'+e.surveyid+'" />',html+='<img usemap="#promomap" src="'+n+'">',null!=e.couponconfig.additionalinfotextmap){var h=null!=e.couponconfig.additionalinfotextmap.css?e.couponconfig.additionalinfotextmap.css:"additionalTextBox",g=null!=e.couponconfig.additionalinfotextmap.style?e.couponconfig.additionalinfotextmap.style:"",m=e.couponconfig.additionalinfotextmap;if("mobile"==i&&null!=m.mobile)var f=m.mobile.shape,v=m.mobile.coordinates;else f=m.desktop.shape,v=m.desktop.coordinates;html+='<div id="met_promo_additional_text" class="'+h+'" style="display: none; '+g+'" ><div><span class="metrical_chevron"></span></div>'+e.couponconfig.additionalinfotextmap.text+"</div>"}html+='<map name="promomap"><area shape="'+a+'" coords="'+s+'" id="close-widget" alt="Close" style="display: block; cursor: pointer;">',html+='<area id="submit-widget" shape="'+l+'" coords="'+c+'" alt="Submit" style="display: block; cursor: pointer;">',html+=null!=f&&null!=v?'<area id="metrical-display-additional-text" shape="'+f+'" coords="'+v+'" alt="Show Additional Text" style="display: block; cursor: pointer;"></map>':"</map>",html+='<ul class="form-list">',html+='<li class="actions"><input type="submit" id="metrical-confirm-button" name ="" value="" class="enable hidden"></li>',html+="</ul>",html+="</form>",html+="</div>",p.onload=function(){var t=(u-p.height)/3,i=(d-p.width)/2;$("#metrical-widget-form img").css({position:"fixed",top:t,left:i}),null!=e.couponconfig.additionalinfotextmap&&($("#met_promo_additional_text").css({position:"fixed",top:t+p.height,left:i}),-1===$("#met_promo_additional_text").attr("style").indexOf("width")&&$("#met_promo_additional_text").css({width:p.width}),$("#metrical-widget-form div>div").css({"text-align":"center",width:p.width-20}),$(document).on("click","#metrical-display-additional-text",function(e){$("#metrical-widget-form div").fadeIn()}),$(document).on("click","#met_promo_additional_text .metrical_chevron",function(e){$("#metrical-widget-form div").slideUp()}))},$(document).on("click","#close-widget",function(e){$(".MetricalTab").css("visibility","hidden"),$(".close-widget").click(),$("#metrical-widget-form img").hide(),$("#metrical-widget-form div").hide()}),$(document).on("click","#submit-widget",function(e){$("#metrical-confirm-button").click(),$("#metrical-widget-form div").hide()})}else{if(html+='<div class="lb-wrapper">',MetricalApp.properties.iframe||(html+='<div class = "close-widget"></div>'),null!=MetricalApp.timedQuestionDelay?html+='<div class="MetricalHeader">'+e.titletext.replace("{{timer}}",MetricalApp.timedQuestionDelay)+"</div>":html+='<div class="MetricalHeader">'+e.titletext+"</div>",html+='<div id = "form-container">',html+='<form id = "metrical-widget-form" novalidate>',html+='<input id="metrical-surveyid" type = "hidden" value = "'+e.surveyid+'" />',html+='<ul class="form-list">',$.each(e.questions,function(i,o){html+=t.questionMarkup(i,o,e)}),additionalSubmitClass="mobile"==MetricalApp.determineIdentifier()?"mobile-submit-button":"",hideSubmitButton="",null!=e.hidesubmitbutton&&1==e.hidesubmitbutton&&(hideSubmitButton="hidden"),null!=e.cancelbutton&&1==e.cancelbutton){html+='<li class="actions relative">';var b="Cancel";null!=e.cancelbuttontext&&(b=e.cancelbuttontext),html+='<input type="button" id="metrical-cancel-button" name = "'+b+'" value = "'+b+'" class = "cancel-button col-half">',additionalSubmitClass+=" col-half"}else html+='<li class="actions">';if(null!=e.buttontext)var y=e.buttontext;if(null!=e.submitbuttontext)y=e.submitbuttontext;if(html+='<input type="submit" id="metrical-confirm-button" name = "'+y+'" value = "'+y+'"   class = "disabled '+additionalSubmitClass+" "+hideSubmitButton+'">',html+="</li></ul>",html+="</form>",html+="</div>",html+='<div class="lb-footer">',html+="<ul>",void 0!==e.footer){var M=1;$.each(e.footer,function(t,i){var o=i.targetblank?' target="_blank" ':"";if(void 0!==i.link)var r='<a href="'+i.link+'"'+o+">"+i.text+"</a>";else r="<span>"+i.text+"</span>";M<e.footer.length?html+="<li>"+r+'<span class="separator">|</span></li>':html+="<li>"+r+"</li>",M++})}html+="</ul>"}return html+="</div>",html+='<div id = "check-offset"><div>',html}},WidgetExceptionView={render:function(e){return"<div>"+e+"</div>"}},AnswersDictionary={questions:{},answers:{},questionHash:{},init:function(e,t){this.questions=e,this.answers=t,this.buildQuestionHash()},buildQuestionHash:function(){if(this.questions)for(var e=0;e<this.questions.length;e++){var t=this.questions[e];this.questionHash[t.id]=t}},hasAnswer:function(e){return e in this.answers},getRaw:function(e){return this.answers[e]},get:function(e){var t=this.getRaw(e);if(e in this.questionHash){var i=this.questionHash[e];if("valuesarray"in i){var o=i.valuesarray[t];void 0!==o&&(t=o)}}return t},keys:function(){var e=[];for(var t in this.answers)e.push(t);return e}},ThankYouView={thankYouMarkup:function(e){if(Widget.isThankYouImageView())$("div.lb-wrapper div#form-container").removeAttr("style"),html=this.thankYouImageMarkup();else{var t=SurveyMdl.widgetObj.thankyouviewclass;"default"==t?html='<div class = "thank-you-message">'+SurveyMdl.widgetObj.thankyoumessages+"</div>":"altthankyou"==t&&($(".MetricalContainer div.MetricalHeader").replaceWith('<div class="MetricalHeader"></div><div class="thank-you-message">Thank You!</div>'),"lightbox"==MetricalApp.properties.rendertype?$("#form-container").css("height","auto"):$("#form-container").css("height","500px"),$(".Metrical_lightbox").animate({scrollTop:"0px"},300),html='<div class="ty-content">',html+='\t<div class="ty-set">',html+='\t\t<div class="ty-type">',html+='\t\t\t<div class="ty-item">',html+=SurveyMdl.widgetObj.thankyoumessages,html+="\t\t\t</div>",html+="\t\t</div>",html+="\t</div>",html+='\t<div class="ty-footer">',html+='\t\t<div class="ty-button-bar"></div>',html+="\t</div>",html+="</div>")}return html},thankYouImageMarkup:function(){var e=MetricalApp.determineIdentifier(),t=SurveyMdl.widgetObj.couponconfig.closemap;null!=SurveyMdl.widgetObj.couponconfig.thankyouclosemap&&(t=SurveyMdl.widgetObj.couponconfig.thankyouclosemap);var i=SurveyMdl.widgetObj.couponconfig.thankyouimageurl;if("mobile"==e&&null!=i.mobile){i=i.mobile;var o=t.mobile.shape,r=t.mobile.coordinates}else{i=i.desktop;o=t.desktop.shape,r=t.desktop.coordinates}var n=$(window).width()-15,a=$(window).height(),s=new Image;return s.src=i,html='<form id="metrical-widget-form" novalidate>',html='<div class="close-widget-thank hidden"></div>',html+='<div id="thankyou-container">',html+='<img usemap="#thankyoumap" src="'+i+'">',html+='<map name="thankyoumap"><area shape="'+o+'" coords="'+r+'" id="close-widget" alt="Close" style="display: block; cursor: pointer;">',html+="</map>",html+="</div>",html+="</form>",s.onload=function(){$("#thankyou-container img").css({position:"fixed",top:(a-s.height)/3,left:(n-s.width)/2})},$(document).on("click",".close-widget-thank",function(e){$(".MetricalTab").css("visibility","hidden"),$(".close-widget").click(),$("#thankyou-container img").hide()}),html}},ErrorView={errorMarkup:function(){return html='<div class = "error-message">An error occurred. Please try again later</div>',html}},WiggleTab=function(e,t){var i=$;setTimeout(function(){var e=i(".MetricalTab");i(".MetricalContainer").hasClass("is-popped")?WiggleTab(4e3,t):1==e.hasClass(t)?(e.removeClass(t),WiggleTab(5e3,t)):(e.addClass(t),WiggleTab(2e3,t))},e)},WidgetDelayer={timeToSurveyDisplays:0,delayBeforeDisplay:0,sitedelaybeforedisplay:0,thresholdValue:null,delaytick:0,delaytickCookieName:"_Metrical_delaytick",metricalApp:null,widgetObj:null,overrideKey:"overridesitedelaybeforedisplay",callback:function(){},init:function(e,t,i,o){this.widgetObj=t,WidgetDelayer.setCookies(i),MetricalApp.logging.logInfo("delay: ",this.delayBeforeDisplay),null!=this.timeToSurveyDisplays&&(this.delayBeforeDisplay=1e3*this.timeToSurveyDisplays),MetricalApp.logging.logInfo("delay: ",this.delayBeforeDisplay),MetricalApp.logging.logInfo("resume key present: ",docCookies.hasItem("_Metrical_resumetick")),MetricalApp.logging.logInfo("delay key present: ",docCookies.hasItem("_Metrical_delaytick")),this.metricalApp=o,1==this.isSiteDelayOverridden()&&(this.delayBeforeDisplay=0),MetricalApp.logging.logInfo("resume key present: ",docCookies.hasItem("_Metrical_resumetick")),MetricalApp.logging.logInfo("delay key present: ",docCookies.hasItem("_Metrical_delaytick")),MetricalApp.logging.logInfo("delay: ",this.delayBeforeDisplay),this.callback=e;var r=this.delayBeforeDisplay;this.startDelayTimerForCallback(r)},startDelayTimerForCallback:function(e){var t=this;setTimeout(function(){t.callback()},e)},isSiteDelayOverridden:function(){return null!=this.metricalApp.properties[this.overrideKey]&&1==this.metricalApp.properties[this.overrideKey]||(1==this.widgetObj.isReturningBehavior()||!(!docCookies.hasItem("_Metrical_resumetick")||!docCookies.hasItem("_Metrical_thresholdreached"))&&(MetricalApp.logging.logInfo("Cookie override to delay metrical running"),!0))},setCookies:function(e){var t,i,o,r,n,a=this,s=!1;void 0!==e.delaybeforedisplaythreshold&&(n=parseInt(e.delaybeforedisplaythreshold),isNaN(n)&&(n=0),n&&(s=!0),docCookies.hasItem("_Metrical_resumetick")||(s=!0,(i=new Date).setTime(i.getTime()+1e3*n),docCookies.setItem("_Metrical_resumetick",n,i,"/",docCookies.rootDomain())),a.thresholdValue=n),void 0!==e.sitedelaybeforedisplay&&(this.sitedelaybeforedisplay=parseInt(e.sitedelaybeforedisplay),isNaN(this.sitedelaybeforedisplay)&&(this.sitedelaybeforedisplay=0),this.timeToSurveyDisplays=this.sitedelaybeforedisplay,s&&(t=void 0!==n?n:this.sitedelaybeforedisplay,docCookies.hasItem("_Metrical_delaytick")?(o=parseInt(docCookies.getItem("_Metrical_delaytick")),this.delaytick=o,this.timeToSurveyDisplays-=o):((i=new Date).setTime(i.getTime()+1e3*t),docCookies.setItem("_Metrical_delaytick",0,i,"/",docCookies.rootDomain()),this.delaytick=0),r=setInterval(function(){a.updateDelaytickCookie(t,r)},1e3)))},updateDelaytickCookie:function(e,t){var i;this.delaytick<this.sitedelaybeforedisplay-1?(this.delaytick=docCookies.getItem("_Metrical_delaytick"),this.delaytick++,(i=new Date).setTime(i.getTime()+1e3*(e-this.delaytick)),docCookies.setItem("_Metrical_delaytick",this.delaytick,i,"/",docCookies.rootDomain())):(clearInterval(t),(i=new Date).setTime(i.getTime()-1e3),docCookies.setItem("_Metrical_delaytick",this.delaytick,i,"/",docCookies.rootDomain()),(i=new Date).setTime(i.getTime()+1e3*this.thresholdValue),docCookies.setItem("_Metrical_thresholdreached",1,i,"/",docCookies.rootDomain()))}};rootMetricalObj.delay=WidgetDelayer;var CustomerEvents={userClickedTab:!1};$(document).ready(function(){try{_MetricalObject_did_cookie(),_MetricalObject_sessionid(),are_cookies_enabled()?Validator.widgetAllowed(Metrical_options)&&(Validator.userdata(Metrical_options),MetricalApp.logging.logInfo("initializing MetricalApp"),MetricalApp.init(Metrical_options),MetricalApp.logging.logInfo("initializing SurveyMdl"),SurveyMdl.init(function(){var e;MetricalApp.logging.logInfo("running postSurveyInit()"),MetricalApp.postSurveyInit(),rootMetricalObj.showWidget=function(){0==Widget.initiWasCalled?Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1):null!=MetricalApp.timedQuestionDelay&&Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1),Widget.show(),jQuery(".MetricalContainer").css("visibility","visible")},rootMetricalObj.makeVisible=function(){Widget.shouldDisplay&&(MetricalApp.properties.makeVisibleHook(MetricalApp),jQuery(".MetricalContainer").css("visibility","visible"),Widget.setWidgetPosition()),1==MetricalApp.properties.echolog&&rootMetricalObj.echoLog()},null!=SurveyMdl.widgetObj.openafterxloads&&docCookies.hasItem("_Metrical_PageViewCount")&&(e=parseInt(docCookies.getItem("_Metrical_PageViewCount"))),(null==e||e>=SurveyMdl.widgetObj.openafterxloads)&&(MetricalApp.logging.logInfo("initializing WidgetDisplayer"),WidgetDelayer.init(function(){if(MetricalApp.logging.logInfo("WidgetDisplayer callback fired"),MetricalApp.logging.logInfo("initializing Widget",SurveyMdl.widgetObj),0==Widget.initiWasCalled&&(Widget.init(MetricalApp.el,SurveyMdl.widgetObj,!1),"function"==typeof MetricalApp.properties.postWidgetRender&&MetricalApp.properties.postWidgetRender(MetricalApp)),rootMetricalObj.shouldDisplay=!0,null!=SurveyMdl.widgetObj.delaybeforeopeningclosedtab&&SurveyMdl.widgetObj.startingbehavior==StartingBehavior.closeBehavior&&0==SurveyMdl.widgetObj.isReturningBehavior()&&"mobile"!=MetricalApp.determineIdentifier()){var e=1e3*parseInt(SurveyMdl.widgetObj.delaybeforeopeningclosedtab);MetricalApp.logging.logInfo("delaying opening the closed tab for "+e+" seconds"),MetricalApp.tabOpenerTimer=setTimeout(function(){jQuery(".MetricalContainer").hasClass("is-popped")||(MetricalApp.logging.logInfo("clicking open the widget"),jQuery(".MetricalTab").click(),MetricalApp.properties.afterDelayOpenedHook(MetricalApp))},e),jQuery(".MetricalTab").on("click",function(){null!=MetricalApp.tabOpenerTimer&&(clearTimeout(MetricalApp.tabOpenerTimer),MetricalApp.tabOpenerTimer=null)}),jQuery(".close-widget").on("click",function(){"lightbox"==MetricalApp.properties.rendertype&&null!=MetricalApp.tabOpenerTimer&&(clearTimeout(MetricalApp.tabOpenerTimer),MetricalApp.tabOpenerTimer=null)})}else MetricalApp.logging.logInfo("skipping the startup of delaybeforeopeningclosedtab");Widget.setWidgetPosition(),setTimeout(function(){Widget.setWidgetPosition()},500)},SurveyMdl.widgetObj,ClientWidget.widgetObj,MetricalApp))})):log("Cookies are disabled")}catch(e){MetricalApp.logging.logError(e)}}),jQuery(window).on("load",function(){MetricalApp.logging.logInfo("window load event called"),MetricalApp.logging.logInfo("starting polling timer to make widget visible"),setTimeout(function e(){1==rootMetricalObj.shouldDisplay&&0==rootMetricalObj.waitAdditionalJS?rootMetricalObj.makeVisible():(MetricalApp.logging.logInfo("setting up another polling run"),setTimeout(e,100))},100)})}(jQuery)}};_MetricalUtils={evaluateRule:function(rule,conditions,tags){var keys=Object.keys(conditions);keys.sort(function(e,t){return t.length-e.length});var tagKeys=Object.keys(tags||[]);tagKeys.sort(function(e,t){return t.length-e.length});for(var i=0;i<tagKeys.length;i++){var tagKey=tagKeys[i],searchKey="#"+tagKey,tagValue="object"==typeof tags[tagKey]&&null!==tags[tagKey]&&void 0!==tags[tagKey]&&"result"in tags[tagKey]?tags[tagKey].result:tags[tagKey];rule=rule.replace(searchKey,String(tagValue))}for(var i=0;i<keys.length;i++){var conditionKey=keys[i],conditionValue="object"==typeof conditions[conditionKey]&&"result"in conditions[conditionKey]?conditions[conditionKey].result:conditions[conditionKey];rule=rule.replace(conditionKey,String(conditionValue))}var result=!1;try{result=eval(rule)}catch(e){console.log("Rule parsing failed: %s",rule),console.error(e)}return result},ruleCriteriaString:function(e,t,i){i=i||{};var o=Object.keys(t);o.sort(function(e,t){return t.length-e.length});var r=Object.keys(i||[]);r.sort(function(e,t){return t.length-e.length});for(var n=0;n<r.length;n++){var a=r[n],s=i[a],l="#"+a,c=l+" ("+String(s)+") ",d=new RegExp(l+"\\s{1}|"+l+"$","g");e=e.replace(d,c).trim()}for(n=0;n<o.length;n++){var u=o[n],p="object"==typeof t[u]&&"result"in t[u]?t[u].result:t[u];c=u+" ("+String(p)+")";e=e.replace(u,c)}return e},chooseRandomItem:function(e){for(var t,i,o=e.reduce(function(e,t){return e+t.weight},0),r=(t=0,i=o,Math.random()*(i-t)+t),n=0,a=0;a<e.length;a++)if(r<=(n=+(n+=e[a].weight).toFixed(4)))return e[a].item},testRegex:function(e,t){return new RegExp(e).test(t)},determineDevice:function(){var e="desktop";/Touch|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(e=window.matchMedia("(max-width: 730px)").matches?"mobile":window.matchMedia("screen and (orientation: portrait)").matches?screen.width<=480?"mobile":"tabletvertical":screen.height<=480?"mobile":"tablethorizontal");return e},isPlusDelimitedFormat:function(e){return/^\[(.*?\+)+[^\+]+?\]$/.test(e)},plusDelimitedParts:function(e){return 1==this.isPlusDelimitedFormat(e)?e.slice(1).slice(0,-1).split("+"):(newInput=e.replace("[","").replace("]",""),newInput.length>0?[newInput]:[])},round:function(e,t){var i=Math.pow(10,t),o=e*i;return Math.round(o)/i},cleanMoney:function(e){var t=0;if("number"==typeof e&&(t=e),"string"==typeof e){var i=e.replace("$","").replace(",","").match(/[\d]+(\.\d+)?/g);null!==i&&(t=parseFloat(i[0]))}return t},getIEVersion:function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return e?parseInt(e[1]):void 0},makeUUID:function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)})},getFullDateUTC:function(e){return year=""+e.getUTCFullYear(),month=""+(e.getUTCMonth()+1),1==month.length&&(month="0"+month),day=""+e.getUTCDate(),1==day.length&&(day="0"+day),hour=""+e.getUTCHours(),1==hour.length&&(hour="0"+hour),minute=""+e.getUTCMinutes(),1==minute.length&&(minute="0"+minute),second=""+e.getUTCSeconds(),1==second.length&&(second="0"+second),date=year+"-"+month+"-"+day+" "+hour+":"+minute+":"+second,date},identifierIsIOS:function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},PubSub:function(){var e={subscriptions:{},subscriptionKeys:{},topicPublishCount:{},subscribers:function(e){var t=this;return(e in this.subscriptions?Object.keys(this.subscriptions[e]):[]).map(function(i){return e in t.subscriptions?t.subscriptions[e][i]:function(){}})},subscribe:function(e,t){e in this.subscriptions||(this.subscriptions[e]={},this.subscriptionKeys[e]=0);var i=e+"-"+this.subscriptionKeys[e];return this.subscriptions[e][i]=t,this.subscriptionKeys[e]++,i},unsubscribe:function(e,t){var i=e in this.subscriptions?this.subscriptions[e]:{};t in i&&delete i[t]},publish:function(e,t,i){var o=e in this.subscriptions?this.subscriptions[e]:{};if(this.topicPublishCount[e]=e in this.topicPublishCount?this.topicPublishCount[e]+1:1,void 0===i||this.topicPublishCount[e]<=i)for(var r in o){(0,o[r])(t)}}};return e},jsonPath:function(obj,expr,arg){var P={resultType:arg&&arg.resultType||"VALUE",result:[],normalize:function(e){var t=[];return e.replace(/[\['](\??\(.*?\))[\]']/g,function(e,i){return"[#"+(t.push(i)-1)+"]"}).replace(/'?\.'?|\['?/g,";").replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,"").replace(/#([0-9]+)/g,function(e,i){return t[i]})},asPath:function(e){for(var t=e.split(";"),i="$",o=1,r=t.length;o<r;o++)i+=/^[0-9*]+$/.test(t[o])?"["+t[o]+"]":"['"+t[o]+"']";return i},store:function(e,t){return e&&(P.result[P.result.length]="PATH"==P.resultType?P.asPath(e):t),!!e},trace:function(e,t,i){if(e){var o=e.split(";"),r=o.shift();if(o=o.join(";"),t&&t.hasOwnProperty(r))P.trace(o,t[r],i+";"+r);else if("*"===r)P.walk(r,o,t,i,function(e,t,i,o,r){P.trace(e+";"+i,o,r)});else if(".."===r)P.trace(o,t,i),P.walk(r,o,t,i,function(e,t,i,o,r){"object"==typeof o[e]&&P.trace("..;"+i,o[e],r+";"+e)});else if(/,/.test(r))for(var n=r.split(/'?,'?/),a=0,s=n.length;a<s;a++)P.trace(n[a]+";"+o,t,i);else/^\(.*?\)$/.test(r)?P.trace(P.eval(r,t,i.substr(i.lastIndexOf(";")+1))+";"+o,t,i):/^\?\(.*?\)$/.test(r)?P.walk(r,o,t,i,function(e,t,i,o,r){P.eval(t.replace(/^\?\((.*?)\)$/,"$1"),o[e],e)&&P.trace(e+";"+i,o,r)}):/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(r)&&P.slice(r,o,t,i)}else P.store(i,t)},walk:function(e,t,i,o,r){if(i instanceof Array)for(var n=0,a=i.length;n<a;n++)n in i&&r(n,e,t,i,o);else if("object"==typeof i)for(var s in i)i.hasOwnProperty(s)&&r(s,e,t,i,o)},slice:function(e,t,i,o){if(i instanceof Array){var r=i.length,n=0,a=r,s=1;e.replace(/^(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)$/g,function(e,t,i,o){n=parseInt(t||n),a=parseInt(i||a),s=parseInt(o||s)}),n=n<0?Math.max(0,n+r):Math.min(r,n),a=a<0?Math.max(0,a+r):Math.min(r,a);for(var l=n;l<a;l+=s)P.trace(l+";"+t,i,o)}},eval:function(x,_v,_vname){try{return $&&_v&&eval(x.replace(/@/g,"_v"))}catch(e){throw new SyntaxError("jsonPath: "+e.message+": "+x.replace(/@/g,"_v").replace(/\^/g,"_a"))}}},$=obj;if(expr&&obj&&("VALUE"==P.resultType||"PATH"==P.resultType))return P.trace(P.normalize(expr).replace(/^\$;/,""),obj,"$"),!!P.result.length&&P.result},get:function(e,t,i){i=void 0!==i?i:null,t=0!==t.indexOf("$.")?"$."+t:t;var o=this.jsonPath(e,t);return Array.isArray(o)&&o.length>0?o[0]:i},isJson:function(e){try{JSON.parse(e);return!0}catch(e){return!1}},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},waitForIdToAppear:function(e,t){if(document.getElementById(e))t();else{var i=new MutationObserver(function(o){document.getElementById(e)&&(i.disconnect(),t())});i.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0})}},parseUserMetaArray:function(e){if(/^\[(.*?)\]$/.test(e)){return e.slice(1).slice(0,-1).split("+")}return[e]},querySelector:function(e){return document.querySelector(e)},querySelectorAll:function(e){return document.querySelectorAll(e)},isEqual:function(){var e=200,t="__lodash_hash_undefined__",i=1,o=2,r=9007199254740991,n="[object Arguments]",a="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",d="[object Function]",u="[object GeneratorFunction]",p="[object Map]",h="[object Number]",g="[object Object]",m="[object RegExp]",f="[object Set]",v="[object String]",b="[object Symbol]",y="[object ArrayBuffer]",M="[object DataView]",w=/^\[object .+?Constructor\]$/,k=/^(?:0|[1-9]\d*)$/,I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I[n]=I[a]=I[y]=I[s]=I[M]=I[l]=I[c]=I[d]=I[p]=I[h]=I[g]=I[m]=I[f]=I[v]=I["[object WeakMap]"]=!1;var C="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,A=C||S||Function("return this")(),_="object"==typeof exports&&exports&&!exports.nodeType&&exports,x=_&&"object"==typeof module&&module&&!module.nodeType&&module,j=x&&x.exports===_&&C.process,$=function(){try{return j&&j.binding("util")}catch(e){}}(),O=$&&$.isTypedArray;function q(e,t){for(var i=-1,o=e?e.length:0;++i<o;)if(t(e[i],i,e))return!0;return!1}function T(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function D(e){var t=-1,i=Array(e.size);return e.forEach(function(e,o){i[++t]=[o,e]}),i}function R(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}var V,P,E,W=Array.prototype,L=Function.prototype,U=Object.prototype,B=A["__core-js_shared__"],N=(V=/[^.]+$/.exec(B&&B.keys&&B.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"",H=L.toString,Q=U.hasOwnProperty,K=U.toString,F=RegExp("^"+H.call(Q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),J=A.Symbol,z=A.Uint8Array,G=U.propertyIsEnumerable,Y=W.splice,X=(P=Object.keys,E=Object,function(e){return P(E(e))}),Z=Ce(A,"DataView"),ee=Ce(A,"Map"),te=Ce(A,"Promise"),ie=Ce(A,"Set"),oe=Ce(A,"WeakMap"),re=Ce(Object,"create"),ne=_e(Z),ae=_e(ee),se=_e(te),le=_e(ie),ce=_e(oe),de=J?J.prototype:void 0,ue=de?de.valueOf:void 0;function pe(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var o=e[t];this.set(o[0],o[1])}}function he(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var o=e[t];this.set(o[0],o[1])}}function ge(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var o=e[t];this.set(o[0],o[1])}}function me(e){var t=-1,i=e?e.length:0;for(this.__data__=new ge;++t<i;)this.add(e[t])}function fe(e){this.__data__=new he(e)}function ve(e,t){var i=je(e)||function(e){return function(e){return De(e)&&$e(e)}(e)&&Q.call(e,"callee")&&(!G.call(e,"callee")||K.call(e)==n)}(e)?function(e,t){for(var i=-1,o=Array(e);++i<e;)o[i]=t(i);return o}(e.length,String):[],o=i.length,r=!!o;for(var a in e)!t&&!Q.call(e,a)||r&&("length"==a||Ae(a,o))||i.push(a);return i}function be(e,t){for(var i=e.length;i--;)if(xe(e[i][0],t))return i;return-1}function ye(e,t,r,d,u){return e===t||(null==e||null==t||!Te(e)&&!De(t)?e!=e&&t!=t:function(e,t,r,d,u,w){var k=je(e),I=je(t),C=a,S=a;k||(C=(C=Se(e))==n?g:C);I||(S=(S=Se(t))==n?g:S);var A=C==g&&!T(e),_=S==g&&!T(t),x=C==S;if(x&&!A)return w||(w=new fe),k||Re(e)?ke(e,t,r,d,u,w):function(e,t,r,n,a,d,u){switch(r){case M:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!n(new z(e),new z(t)));case s:case l:case h:return xe(+e,+t);case c:return e.name==t.name&&e.message==t.message;case m:case v:return e==t+"";case p:var g=D;case f:var w=d&o;if(g||(g=R),e.size!=t.size&&!w)return!1;var k=u.get(e);if(k)return k==t;d|=i,u.set(e,t);var I=ke(g(e),g(t),n,a,d,u);return u.delete(e),I;case b:if(ue)return ue.call(e)==ue.call(t)}return!1}(e,t,C,r,d,u,w);if(!(u&o)){var j=A&&Q.call(e,"__wrapped__"),$=_&&Q.call(t,"__wrapped__");if(j||$){var O=j?e.value():e,q=$?t.value():t;return w||(w=new fe),r(O,q,d,u,w)}}if(!x)return!1;return w||(w=new fe),function(e,t,i,r,n,a){var s=n&o,l=Ve(e),c=l.length,d=Ve(t).length;if(c!=d&&!s)return!1;for(var u=c;u--;){var p=l[u];if(!(s?p in t:Q.call(t,p)))return!1}var h=a.get(e);if(h&&a.get(t))return h==t;var g=!0;a.set(e,t),a.set(t,e);for(var m=s;++u<c;){p=l[u];var f=e[p],v=t[p];if(r)var b=s?r(v,f,p,t,e,a):r(f,v,p,e,t,a);if(!(void 0===b?f===v||i(f,v,r,n,a):b)){g=!1;break}m||(m="constructor"==p)}if(g&&!m){var y=e.constructor,M=t.constructor;y!=M&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof M&&M instanceof M)&&(g=!1)}return a.delete(e),a.delete(t),g}(e,t,r,d,u,w)}(e,t,ye,r,d,u))}function Me(e){return!(!Te(e)||(t=e,N&&N in t))&&(Oe(e)||T(e)?F:w).test(_e(e));var t}function we(e){if(i=(t=e)&&t.constructor,o="function"==typeof i&&i.prototype||U,t!==o)return X(e);var t,i,o,r=[];for(var n in Object(e))Q.call(e,n)&&"constructor"!=n&&r.push(n);return r}function ke(e,t,r,n,a,s){var l=a&o,c=e.length,d=t.length;if(c!=d&&!(l&&d>c))return!1;var u=s.get(e);if(u&&s.get(t))return u==t;var p=-1,h=!0,g=a&i?new me:void 0;for(s.set(e,t),s.set(t,e);++p<c;){var m=e[p],f=t[p];if(n)var v=l?n(f,m,p,t,e,s):n(m,f,p,e,t,s);if(void 0!==v){if(v)continue;h=!1;break}if(g){if(!q(t,function(e,t){if(!g.has(t)&&(m===e||r(m,e,n,a,s)))return g.add(t)})){h=!1;break}}else if(m!==f&&!r(m,f,n,a,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function Ie(e,t){var i,o,r=e.__data__;return("string"==(o=typeof(i=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function Ce(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Me(i)?i:void 0}pe.prototype.clear=function(){this.__data__=re?re(null):{}},pe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},pe.prototype.get=function(e){var i=this.__data__;if(re){var o=i[e];return o===t?void 0:o}return Q.call(i,e)?i[e]:void 0},pe.prototype.has=function(e){var t=this.__data__;return re?void 0!==t[e]:Q.call(t,e)},pe.prototype.set=function(e,i){return this.__data__[e]=re&&void 0===i?t:i,this},he.prototype.clear=function(){this.__data__=[]},he.prototype.delete=function(e){var t=this.__data__,i=be(t,e);return!(i<0||(i==t.length-1?t.pop():Y.call(t,i,1),0))},he.prototype.get=function(e){var t=this.__data__,i=be(t,e);return i<0?void 0:t[i][1]},he.prototype.has=function(e){return be(this.__data__,e)>-1},he.prototype.set=function(e,t){var i=this.__data__,o=be(i,e);return o<0?i.push([e,t]):i[o][1]=t,this},ge.prototype.clear=function(){this.__data__={hash:new pe,map:new(ee||he),string:new pe}},ge.prototype.delete=function(e){return Ie(this,e).delete(e)},ge.prototype.get=function(e){return Ie(this,e).get(e)},ge.prototype.has=function(e){return Ie(this,e).has(e)},ge.prototype.set=function(e,t){return Ie(this,e).set(e,t),this},me.prototype.add=me.prototype.push=function(e){return this.__data__.set(e,t),this},me.prototype.has=function(e){return this.__data__.has(e)},fe.prototype.clear=function(){this.__data__=new he},fe.prototype.delete=function(e){return this.__data__.delete(e)},fe.prototype.get=function(e){return this.__data__.get(e)},fe.prototype.has=function(e){return this.__data__.has(e)},fe.prototype.set=function(t,i){var o=this.__data__;if(o instanceof he){var r=o.__data__;if(!ee||r.length<e-1)return r.push([t,i]),this;o=this.__data__=new ge(r)}return o.set(t,i),this};var Se=function(e){return K.call(e)};function Ae(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||k.test(e))&&e>-1&&e%1==0&&e<t}function _e(e){if(null!=e){try{return H.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function xe(e,t){return e===t||e!=e&&t!=t}(Z&&Se(new Z(new ArrayBuffer(1)))!=M||ee&&Se(new ee)!=p||te&&"[object Promise]"!=Se(te.resolve())||ie&&Se(new ie)!=f||oe&&"[object WeakMap]"!=Se(new oe))&&(Se=function(e){var t=K.call(e),i=t==g?e.constructor:void 0,o=i?_e(i):void 0;if(o)switch(o){case ne:return M;case ae:return p;case se:return"[object Promise]";case le:return f;case ce:return"[object WeakMap]"}return t});var je=Array.isArray;function $e(e){return null!=e&&qe(e.length)&&!Oe(e)}function Oe(e){var t=Te(e)?K.call(e):"";return t==d||t==u}function qe(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}function Te(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function De(e){return!!e&&"object"==typeof e}var Re=O?function(e){return function(t){return e(t)}}(O):function(e){return De(e)&&qe(e.length)&&!!I[K.call(e)]};function Ve(e){return $e(e)?ve(e):we(e)}return function(e,t){return ye(e,t)}}(),throttle:function(e,t){let i,o;return function(){const r=this,n=arguments;o?(clearTimeout(i),i=setTimeout(function(){Date.now()-o>=t&&(e.apply(r,n),o=Date.now())},t-(Date.now()-o))):(e.apply(r,n),o=Date.now())}},debounce:function(e,t){let i;return function(){const o=this,r=arguments;clearTimeout(i),i=setTimeout(()=>e.apply(o,r),t)}},intersection:function(e,t){var i;return t.length>e.length&&(i=t,t=e,e=i),e.filter(function(e){return t.indexOf(e)>-1}).filter(function(e,t,i){return i.indexOf(e)===t})}},_MetricalDateUtils={getLocalUtcTimestamp:function(){return(new Date).getTime()},isValidTimestamp:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getTimestamp:function(e){if(null!=e)return this.isValidTimestamp(e)?e:Date.parse(e)},isTimestampBetweenDates:function(e,t,i){return(void 0===t||!isNaN(t))&&((void 0===i||!isNaN(i))&&(t&&i?t<=e&&e<=i:t&&!i?t<=e:!(t||!i)&&e<=i))},dbFormat:function(e){var t=e||(new Date).getTime();return new Date(t).toISOString()}},_MetricalStorage={Storage:{storagePrefix:"_Metrical_",getItem:function(e){e=0===e.indexOf(this.storagePrefix)?e:this.storagePrefix+e;var t=localStorage.getItem(e);return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},setItem:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),localStorage.setItem(this.storagePrefix+e,t)},removeItem:function(e){return localStorage.removeItem(this.storagePrefix+e),!0},clear:function(){for(var e=this.keys(),t=0;t<e.length;t++){var i=e[t];0===i.indexOf(this.storagePrefix)&&this.removeItem(i.replace(this.storagePrefix,""))}},keys:function(){for(var e=[],t=0,i=localStorage.length;t<i;++t){var o=localStorage.key(t);0===o.indexOf(this.storagePrefix)&&e.push(o)}return e},metricalObject:function(){for(var e={},t=this.keys(),i=0;i<t.length;i++){var o=t[i],r=this.getItem(o);e[o]=r}return e}},SessionStorage:{storagePrefix:"_Metrical_",getItem:function(e){e=0===e.indexOf(this.storagePrefix)?e:this.storagePrefix+e;var t=sessionStorage.getItem(e);return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},setItem:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),sessionStorage.setItem(this.storagePrefix+e,t)},removeItem:function(e){return sessionStorage.removeItem(this.storagePrefix+e),!0},clear:function(){for(var e=this.keys(),t=0;t<e.length;t++){var i=e[t];0===i.indexOf(this.storagePrefix)&&this.removeItem(i.replace(this.storagePrefix,""))}},keys:function(){for(var e=[],t=0,i=sessionStorage.length;t<i;++t){var o=sessionStorage.key(t);0===o.indexOf(this.storagePrefix)&&e.push(o)}return e},metricalObject:function(){for(var e={},t=this.keys(),i=0;i<t.length;i++){var o=t[i],r=this.getItem(o);e[o]=r}return e}},Cookie:{path:"/",domain:document.domain,prefix:"_Metrical_",altPrefix:"_MetricalObject_",rootDomain:function(){var e=location.hostname.split(".").reverse();return e.length>1?"uk"==e[0]&&"co"==e[1]&&e.length>2?"."+e[2]+"."+e[1]+"."+e[0]:"."+e[1]+"."+e[0]:"."+e[0]},prefixKey:function(e){return e=0===e.indexOf(this.prefix)||0===e.indexOf(this.altPrefix)?e:this.prefix+e},getItem:function(e){e=this.prefixKey(e);var t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},getItemWithoutPrefix:function(e){var t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;return _MetricalUtils.isJson(t)&&(t=JSON.parse(t)),t},sessionQuickSet:function(e,t){return this.quickSet(e,t,0)},quickSet:function(e,t,i){return void 0===i&&(i=1/0),this.setItem(e,t,i,this.path,this.rootDomain(),!1)},setItem:function(e,t,i,o,r,n,a){if(o||(o=this.path),r||(r=this.rootDomain()),!e||/^(?:expires|max\-age|path|domain|secure|SameSite)$/i.test(e))return!1;e=this.prefixKey(e);var s="";if(i)switch(i.constructor){case Number:s=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:s="; expires="+i;break;case Date:s="; expires="+i.toUTCString()}"object"==typeof t&&(t=JSON.stringify(t));var l=location.protocol;return n||"https:"!=l||(n="secure"),a||(a="Lax"),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(o?"; path="+o:"")+(n?"; secure":"")+"; SameSite="+a,!0},removeItem:function(e,t,i){return!(!e||!this.hasItem(e))&&(e=this.prefixKey(e),t=t||this.path,i=i||this.rootDomain(),document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return e=this.prefixKey(e),new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=decodeURIComponent(e[t]);return e},getAllCookies:function(){return this.getCookies(!1)},getCookies:function(e){null==e&&(e=!0);for(var t=this.keys(),i=[],o=0;o<t.length;o++){var r=t[o],n=this.getItem(r);1==e&&-1==r.indexOf(this.metricalCookieNamePrefix)||i.push({"cookie-key":r,value:n})}return i},getAllCookieObject:function(){return this.getCookieObject(!1)},getCookieObject:function(e){for(var t=this.getCookies(e),i={},o=0;o<t.length;o++){var r=t[o],n=r["cookie-key"],a=r.value;i[n]=a}return i},makeExpires:function(e){var t=new Date;return t.setTime(t.getTime()+1e3*e),t},metricalObject:function(){for(var e={},t=this.keys(),i=0;i<t.length;i++){var o=t[i];if(0===o.indexOf(this.prefix)||0===o.indexOf(this.altPrefix)){var r=this.getItem(o);e[o]=r}}return e},addSameSiteSupport:function(){var e=this,t=["_Metrical_ACStatusOutputCounter","_Metrical_UserAbandonCount","_Metrical_ConditionsObserver_enabled","_Metrical_promoopened_general","_Metrical_PageViewCount","_Metrical_TimeOnSite","_Metrical_offers_disabled","_MetricalObject_QA","_MetricalObject_did","_MetricalObject_sample","_MetricalObject_tracking","_Metrical_clickregistered_","_MetricalAbandonCart_","_treatmenttag","_testgroup","_localtime_override"];if(!this.hasItem("CookiesUpdated")){var i=[];this.keys().forEach(function(e){-1!==e.indexOf("Metrical")&&t.forEach(function(t){-1!==e.indexOf(t)&&i.push(e)})}),i.forEach(function(t){var i=e.getItem(t);i&&e.setItem(t,i,1/0,"/",e.rootDomain())}),e.setItem("CookiesUpdated",!0,1/0,"/",e.rootDomain())}}},ServerStore:{store:{},objKey:null,init:function(e,t){if(this.objKey=t,console.log("Key: ",e),0!=!!e){var i=this,o=_MetricalHosts.endpoints.offerFlowStore+"/"+e;jQuery.ajax({type:"GET",url:o,dataType:"json",async:!1,success:function(e){i.store[i.objKey]=e,console.log("data"),console.log(e)},error:function(e,t,i){console.log(e),console.log(t),console.log(i)}})}},getItem:function(e){return this.store[e]?this.store[e]:null},setItem:function(e,t){this.store[e]=t},_post:function(e){var t=_MetricalHosts.endpoints.offerFlowStore;navigator.sendBeacon(t,JSON.stringify(e))}}};var _MetricalInteractions={apiendpoint:_MetricalHosts.endpoints.interaction,interactionsSourceID:"InteractionsModule",captureinteractions:!1,captureallinteractions:!1,capturescrollinteractions:!1,norecordonsubmitifempty:!1,capturescrollinteractionsthreshold:0,interactions:[],interactionsHandlers:[],interactionsObserver:null,interactionsIframeHandlers:[],interactionsIframeObservers:{},postRecordAction:null,scrollThresholdReachedTimes:0,scrollInteractionsRecordingLimit:2,originalDocumentHeight:0,intProcessedTimestamps:{},limitInteractionsProcessingRate:!0,recordInteractionCallback:null,recordInteractionObservers:[],observersCalled:[],interactionModificationCallback:void 0,customEventsList:["element closed","element opened","text changed","attribute changed","elements added","elements removed"],getBasicInteractionData:function(){return uuid=this.Util.makeUUID(),{uuid:uuid,survey_id:this.interactionsSourceID}},getInteractionData:function(){return{}},init:function(e,t,i,o,r){if(jqInt=e,_MetricalInteractions.Log.info("Initializing the _MetricalInteractions module"),null!=t.apiendpoint&&(this.apiendpoint=t.apiendpoint),null!=t.captureinteractions&&(this.captureinteractions=t.captureinteractions),null!=t.captureallinteractions&&(this.captureallinteractions=t.captureallinteractions),null!=t.capturescrollinteractions&&(this.capturescrollinteractions=t.capturescrollinteractions),null!=t.limitinteractionsprocessingrate&&(this.limitInteractionsProcessingRate=t.limitinteractionsprocessingrate),null!=t.norecordonsubmitifempty&&(this.norecordonsubmitifempty=t.norecordonsubmitifempty),null!=t.interactionModificationCallback&&(this.interactionModificationCallback=t.interactionModificationCallback),null!=t.capturescrollinteractionsthreshold&&(this.capturescrollinteractionsthreshold=t.capturescrollinteractionsthreshold,Array.isArray(this.capturescrollinteractionsthreshold))){this.scrollThresholdReachedTimes={};for(var n=0;n<this.capturescrollinteractionsthreshold.length;n++)this.scrollThresholdReachedTimes[100*this.capturescrollinteractionsthreshold[n]+"%"]=0}if(null!=t.interactions&&(this.interactions=this.interactions.concat(t.interactions)),i&&"function"==typeof i&&(this.getInteractionData=i),o&&"function"==typeof o&&(this.postRecordAction=o),1==_MetricalInteractions.captureinteractions&&1==_MetricalInteractions.captureallinteractions){null!=r&&"function"==typeof r&&(this.recordInteractionCallback=r);try{this.setupInteractions(),this.setupIframeInteractions(),this.setupLoadUnloadInteractions(),this.setupScrollInteractions(),this.processURLInteractions()}catch(e){console.log("Skipping custom interactions, due to error %s",e)}}else _MetricalInteractions.Log.info("Did not set up the interactions capture, since captureinteractions or captureallinteractions is/are set to false");_MetricalInteractions.Log.info("Finished the initialization of the _MetricalInteractions module",this)},setupLoadUnloadInteractions:function(){this.recordInteraction("",null,!0,!1)},relinkBasicInteractions:function(){jqInt.each(_MetricalInteractions.interactions,function(e,t){if(jqInt(t.selector).length>0&&!_MetricalInteractions.isCustomEvent(t.event)){var i=t.event+".Metrical";jqInt(t.selector).off(i),customHandler=jqInt(t.selector).on(i,null,null,function(e){void 0!==e.originalEvent&&_MetricalInteractions.processInteraction(t,e)})}})},setupInteractions:function(){jqInt.each(_MetricalInteractions.interactions,function(key,interaction){if(!_MetricalInteractions.isInteractionAlreadyRegistered(interaction)){var interactionEventHandler=function(e){void 0!==e.originalEvent&&_MetricalInteractions.processInteraction(interaction,e)},customEventInteractionEventHandler=function(event){switch(interaction.event){case"element closed":recordInteraction=_MetricalInteractions.isElementClosedInteraction(event),fieldKey=interaction.fieldkey,fieldVal=eval(interaction.fieldeval);break;case"element opened":recordInteraction=_MetricalInteractions.isElementOpenedInteraction(event),fieldKey=interaction.fieldkey,fieldVal=eval(interaction.fieldeval);break;case"text changed":recordInteraction=!0,fieldKey=interaction.fieldkey?interaction.fieldkey:"text_changed",fieldValString=interaction.fieldeval?interaction.fieldeval:"event[0].target.textContent",fieldVal=eval(fieldValString);break;case"attribute changed":recordInteraction=_MetricalInteractions.isAttributeChangedInteraction(event,interaction.observedattributes),fieldKey=interaction.fieldkey?interaction.fieldkey:"attribute_changed",fieldValString=interaction.fieldeval?interaction.fieldeval:"event[0].attributeName",fieldVal=eval(fieldValString);break;case"elements added":recordInteraction=_MetricalInteractions.isElementsAddedInteraction(event),fieldKey=interaction.fieldkey?interaction.fieldkey:"elements_added",fieldValString=interaction.fieldeval?interaction.fieldeval:"JSON.stringify(event[0].addedNodes)",fieldVal=eval(fieldValString);break;case"elements removed":recordInteraction=_MetricalInteractions.isElementsRemovedInteraction(event),fieldKey=interaction.fieldkey?interaction.fieldkey:"elements_removed",fieldValString=interaction.fieldeval?interaction.fieldeval:"JSON.stringify(event[0].removedNodes)",fieldVal=eval(fieldValString);break;default:recordInteraction=!1,fieldKey=interaction.fieldkey,fieldVal=eval(interaction.fieldeval)}recordInteraction&&_MetricalInteractions.processInteraction(interaction,event,fieldKey,fieldVal)};if(jqInt(interaction.selector).length>0)if(_MetricalInteractions.Log.info("Registering the event handler for the custom interaction",interaction),_MetricalInteractions.isCustomEvent(interaction.event))jqInt.each(jqInt(interaction.selector),function(e,t){_MetricalInteractions.Log.info("Registering an observer for '"+interaction.event+"' interactions on the element",t),elementObserver=new MutationObserver(customEventInteractionEventHandler),elementObserver.observe(t,_MetricalInteractions.getObserverConfigForCustomEvent(interaction.event))}),_MetricalInteractions.interactionsHandlers.push({selector:interaction.selector,event:interaction.event,handlerFunction:customEventInteractionEventHandler});else{var eventNamespace=interaction.event+".Metrical";jqInt(interaction.selector).off(eventNamespace,null,null,interactionEventHandler),customHandler=jqInt(interaction.selector).on(eventNamespace,null,null,interactionEventHandler),_MetricalInteractions.interactionsHandlers.push({selector:interaction.selector,event:interaction.event,handlerFunction:interactionEventHandler})}}}),null==_MetricalInteractions.interactionsObserver&&(_MetricalInteractions.Log.info("Setting up an observer for the elements with interactions"),_MetricalInteractions.interactionsObserver=new MutationObserver(_MetricalInteractions.setupInteractions),_MetricalInteractions.interactionsObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},checkInteractionProcessingLimit:function(e){var t=!1;if(this.limitInteractionsProcessingRate){var i=e.selector.replace(/ /g,"_")+"_"+e.event.replace(/ /g,"_"),o=+new Date;null==_MetricalInteractions.intProcessedTimestamps[i]&&(_MetricalInteractions.intProcessedTimestamps[i]=o);var r=o-_MetricalInteractions.intProcessedTimestamps[i],n=!0;if("element opened"==e.event||"element closed"==e.event){var a="element opened"==e.event?"element_closed":"element_opened",s=e.selector.replace(/ /g,"_")+"_"+a;if(null!=_MetricalInteractions.intProcessedTimestamps[s])o-_MetricalInteractions.intProcessedTimestamps[s]<1e3&&(n=!1);else _MetricalInteractions.intProcessedTimestamps[s]=o;_MetricalInteractions.intProcessedTimestamps[i]>_MetricalInteractions.intProcessedTimestamps[s]&&(n=!1)}(0==r||r>=1e3)&&n&&(_MetricalInteractions.intProcessedTimestamps[i]=+new Date,t=!0)}else t=!0;return t},processInteraction:function(interaction,event,fieldKey,fieldVal){if(_MetricalInteractions.checkInteractionProcessingLimit(interaction)){targetToRecord=null,null!=interaction.recordtarget&&1==interaction.recordtarget&&(null==fieldKey&&(fieldKey=interaction.fieldkey),null==fieldVal&&(fieldVal=eval(interaction.fieldeval)),targetToRecord={field_key:fieldKey,target:fieldVal}),null!=interaction.chainedinteraction&&"before"==interaction.chainedinteraction.chainorder&&_MetricalInteractions.processInteraction(_MetricalInteractions.interactions[interaction.chainedinteraction.interactionindex],event);var isAsync="isasync"in interaction?interaction.isasync:void 0;_MetricalInteractions.recordInteraction(interaction.action,targetToRecord,isAsync),null!=interaction.chainedinteraction&&"after"==interaction.chainedinteraction.chainorder&&_MetricalInteractions.processInteraction(_MetricalInteractions.interactions[interaction.chainedinteraction.interactionindex],event)}},indicatorNotPresent:function(e){return 1!=jqInt(e).data("_MetricalInteractionIsSet")},isCustomEvent:function(e){return this.customEventsList.indexOf(e)>-1},getObserverConfigForCustomEvent:function(e){switch(e){case"element closed":case"element opened":config={attributes:!0,subtree:!1,childList:!1,characterData:!1};break;case"text changed":config={attributes:!1,subtree:!0,childList:!1,characterData:!0};break;case"attribute changed":config={attributes:!0,subtree:!1,childList:!1,characterData:!1};break;case"elements added":case"elements removed":config={attributes:!1,subtree:!1,childList:!0,characterData:!1};break;default:config={subtree:!0,childList:!0}}return config},isElementClosedInteraction:function(e){return elementClosedInteractionPerformed=!1,element=e[0].target,"none"!=element.style.display&&"0px"!=element.style.width&&"hidden"!=element.style.visibility||(elementClosedInteractionPerformed=!0),elementClosedInteractionPerformed},isElementOpenedInteraction:function(e){return elementOpenedInteractionPerformed=!1,element=e[0].target,"none"!=element.style.display&&"0px"!=element.style.width&&"hidden"!=element.style.visibility&&(elementOpenedInteractionPerformed=!0),elementOpenedInteractionPerformed},isAttributeChangedInteraction:function(e,t){return attributeChangedInteractionPerformed=!1,t.indexOf(e[0].attributeName)>-1&&(attributeChangedInteractionPerformed=!0),attributeChangedInteractionPerformed},isElementsAddedInteraction:function(e){elementsAddedInteractionPerformed=!1;for(var t=0;t<e.length;t++)if(e[t].addedNodes.length>0){elementsAddedInteractionPerformed=!0;break}return elementsAddedInteractionPerformed},isElementsRemovedInteraction:function(e){elementsRemovedInteractionPerformed=!1;for(var t=0;t<e.length;t++)if(e[t].removedNodes.length>0){elementsRemovedInteractionPerformed=!0;break}return elementsRemovedInteractionPerformed},processURLInteractions:function(){jqInt.each(_MetricalInteractions.interactions,function(e,t){"url"==t.event&&(patt=new RegExp(t.urlmatch),urlMatches=patt.test(window.location.href),urlMatches&&_MetricalInteractions.processInteraction(t,null,null!=t.fieldkey?t.fieldkey:"",_MetricalInteractions.Util.getURLParameterByName(t.urlparameter,window.location.href)))})},isInteractionAlreadyRegistered:function(e){for(var t=0;t<_MetricalInteractions.interactionsHandlers.length;t++)if(rInteraction=_MetricalInteractions.interactionsHandlers[t],e.selector==rInteraction.selector&&e.event==rInteraction.event)return!0;return!1},setupIframeInteractions:function(){null!=jqInt("iframe")&&jqInt("iframe").on("load",null,null,function(){_MetricalInteractions.Log.info("Iframe loaded. Configuring the custom interactions...",this);var e=this.src;if(_MetricalInteractions.isSameOrigin(e)){var t=this.contentWindow.document,i=this.contentWindow;null!=_MetricalInteractions.interactionsIframeObservers[e]&&_MetricalInteractions.interactionsIframeObservers[e].disconnect(),observer=new MutationObserver(function(){jqInt.each(_MetricalInteractions.interactions,function(o,r){var n=function(e){void 0!==e.originalEvent&&_MetricalInteractions.processInteraction(r,e,r.fieldkey,i.eval(r.fieldeval))},a=function(e){switch(r.event){case"element closed":recordInteraction=_MetricalInteractions.isElementClosedInteraction(e),fieldKey=r.fieldkey,fieldVal=i.eval(r.fieldeval);break;case"element opened":recordInteraction=_MetricalInteractions.isElementOpenedInteraction(e),fieldKey=r.fieldkey,fieldVal=i.eval(r.fieldeval);break;case"text changed":recordInteraction=!0,fieldKey=r.fieldkey?r.fieldkey:"text_changed",fieldValString=r.fieldeval?r.fieldeval:"event[0].target.textContent",fieldVal=i.eval(fieldValString);break;case"attribute changed":recordInteraction=_MetricalInteractions.isAttributeChangedInteraction(e,r.observedattributes),fieldKey=r.fieldkey?r.fieldkey:"attribute_changed",fieldValString=r.fieldeval?r.fieldeval:"event[0].attributeName",fieldVal=i.eval(fieldValString);break;case"elements added":recordInteraction=_MetricalInteractions.isElementsAddedInteraction(e),fieldKey=r.fieldkey?r.fieldkey:"elements_added",fieldValString=r.fieldeval?r.fieldeval:"JSON.stringify(event[0].addedNodes)",fieldVal=i.eval(fieldValString);break;case"elements removed":recordInteraction=_MetricalInteractions.isElementsRemovedInteraction(e),fieldKey=r.fieldkey?r.fieldkey:"elements_removed",fieldValString=r.fieldeval?r.fieldeval:"JSON.stringify(event[0].removedNodes)",fieldVal=i.eval(fieldValString);break;default:recordInteraction=!1,fieldKeyValue=r.fieldkey,fieldVal=i.eval(r.fieldeval)}recordInteraction&&_MetricalInteractions.processInteraction(r,e,fieldKey,fieldVal)};_MetricalInteractions.isCustomInteractionIframeAlreadyRegistered(e,r)&&jqInt(r.selector,t).unbind(r.event),jqInt(r.selector,t).length>0&&(_MetricalInteractions.Log.info("Registering the event handler for the custom interaction on the iframe",r),_MetricalInteractions.isCustomEvent(r.event)?(jqInt.each(jqInt(r.selector),function(e,t){_MetricalInteractions.Log.info("Registering an observer for '"+r.event+"' interactions on the iframe on the element",t),elementObserver=new MutationObserver(a),elementObserver.observe(t,_MetricalInteractions.getObserverConfigForCustomEvent(r.event))}),_MetricalInteractions.interactionsIframeHandlers.push({ifrSrc:e,selector:r.selector,event:r.event,handlerFunction:a})):(jqInt(r.selector,t).off(r.event,null,null,n),customHandler=jqInt(r.selector,t).on(r.event,null,null,n),_MetricalInteractions.interactionsIframeHandlers.push({ifrSrc:e,selector:r.selector,event:r.event,handlerFunction:n})))}),_MetricalInteractions.Log.info("Ending custom interactions iframe setup")}),observer.observe(t.documentElement,{childList:!0,subtree:!0}),_MetricalInteractions.interactionsIframeObservers[e]=observer}})},isCustomInteractionIframeAlreadyRegistered:function(e,t){for(var i=0;i<_MetricalInteractions.interactionsIframeHandlers.length;i++)if(rInteraction=_MetricalInteractions.interactionsIframeHandlers[i],t.selector==rInteraction.selector&&t.event==rInteraction.event&&e==rInteraction.ifrSrc)return!0;return!1},setupScrollInteractions:function(){this.originalDocumentHeight=jqInt(document).height();var e,t=jqInt(window),i=(t.scrollTop(),this);1==this.capturescrollinteractions?(scrollHandler=function(){i.originalDocumentHeight==t.height()&&(i.originalDocumentHeight=jqInt(document).height());var o=100*t.scrollTop()/(i.originalDocumentHeight-t.height());if(!isNaN(o)&&isFinite(o)&&(scrollThresholdData=i.getScrollThresholdReached(o),(null==scrollThresholdData.thresholdReached||scrollThresholdData.thresholdReached)&&scrollThresholdData.recordInteraction)){o=o.toFixed()+"%";var r=t.scrollTop();e&&clearTimeout(e),e=setTimeout(function(){i.shouldScrollInteractionBeRecorded(scrollThresholdData)&&(percent=null!=scrollThresholdData.thresholdReached?scrollThresholdData.thresholdReached:o,_MetricalInteractions.recordInteraction("scroll to "+percent,null,!0))},1e3),r}},t.off("scroll",scrollHandler),t.on("scroll",scrollHandler)):_MetricalInteractions.Log.info("Did not set up the scroll interactions capture, since capturescrollinteractions is set to false")},getScrollThresholdReached:function(e){if(thresholdData={recordInteraction:!1,thresholdReached:null},Array.isArray(this.capturescrollinteractionsthreshold))for(var t=0;t<this.capturescrollinteractionsthreshold.length;t++){if(null!=this.capturescrollinteractionsthreshold[t+1]&&e>100*this.capturescrollinteractionsthreshold[t]&&e<=100*this.capturescrollinteractionsthreshold[t+1]){thresholdData.thresholdReached=100*this.capturescrollinteractionsthreshold[t]+"%",thresholdData.recordInteraction=!0;break}if(null==this.capturescrollinteractionsthreshold[t+1]&&e>100*this.capturescrollinteractionsthreshold[t]){thresholdData.thresholdReached=100*this.capturescrollinteractionsthreshold[t]+"%",thresholdData.recordInteraction=!0;break}}else 0==this.capturescrollinteractionsthreshold?thresholdData.recordInteraction=!0:e>=100*this.capturescrollinteractionsthreshold&&(thresholdData.thresholdReached=100*this.capturescrollinteractionsthreshold+"%",thresholdData.recordInteraction=!0);return thresholdData},shouldScrollInteractionBeRecorded:function(e){return shouldBeRecorded=!1,e.recordInteraction&&(thresholdReached=e.thresholdReached,null==thresholdReached&&(shouldBeRecorded=!0),null!=thresholdReached&&Number.isInteger(this.scrollThresholdReachedTimes)&&this.scrollThresholdReachedTimes<this.scrollInteractionsRecordingLimit&&(shouldBeRecorded=!0,this.scrollThresholdReachedTimes++),null!=thresholdReached&&"object"==typeof this.scrollThresholdReachedTimes&&this.scrollThresholdReachedTimes[thresholdReached]<this.scrollInteractionsRecordingLimit&&(shouldBeRecorded=!0,this.scrollThresholdReachedTimes[thresholdReached]++)),shouldBeRecorded},isIframeOnSameDomain:function(e){return ifrDomain=this.extractHostname(e),currentDomain=this.extractHostname(window.location.href),ifrDomain==currentDomain},isSameOrigin:function(e){var t=window.location.protocol+"//"+window.location.hostname;return 0==e.split("?")[0].indexOf(t)},extractHostname:function(e){return(e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},extractRootDomain:function(e){var t=this.extractHostname(e),i=t.split("."),o=i.length;return o>2&&(t=i[o-2]+"."+i[o-1],2==i[o-1].length&&2==i[o-1].length&&(t=i[o-3]+"."+t)),t},registerRecordInteractionObserver:function(e,t){0==this.recordInteractionObservers.map(function(e){return e.key}).includes(e)&&this.recordInteractionObservers.push({key:e,callback:t})},recordInteraction:function(e,t,i,o){if(this.captureinteractions){var r=this;r.observersCalled=[],i=void 0===i||i,o=void 0===o||o;var n=function(t){for(var n in t.usermeta)void 0===t.usermeta[n]&&(t.usermeta[n]=null);if("heartbeat"==t.action){var a=_MetricalStorage.SessionStorage.getItem("lastUserMeta");if(_MetricalUtils.isEqual(t.usermeta,a))return}_MetricalStorage.SessionStorage.setItem("lastUserMeta",t.usermeta),jqInt.ajax({type:"POST",dataType:"json",data:t,traditional:!1,async:i,url:r.apiendpoint,success:function(t){jqInt("body")&&(jqInt("#metrical_interaction").remove(),jqInt("body").append("<input type='hidden' id='metrical_interaction' name='metrical_interaction_"+e.split(" ").join("_")+"' value='succeed'>"))},error:function(e,t,i){console.log(e),console.log(t),console.log(i)}});for(var s=0;s<r.recordInteractionObservers.length;s++){var l=r.recordInteractionObservers[s];"function"==typeof l.callback&&l.callback(t)}null!=r.postRecordAction&&o&&r.postRecordAction(e),"function"==typeof r.recordInteractionCallback&&r.recordInteractionCallback(t)};if("assign"in Object==0?interactionData=jqInt.extend(this.getBasicInteractionData(),this.getInteractionData()):interactionData=Object.assign(this.getBasicInteractionData(),this.getInteractionData()),interactionData.action=e,null!=t&&(interactionData[t.field_key]=t.target),"function"==typeof this.interactionModificationCallback)this.interactionModificationCallback(jqInt,interactionData,n,i);else n(interactionData)}else _MetricalInteractions.Log.info("Interactions capture disabled")},Log:{logs:new Array,buffer:!0,info:function(){var e=Array.prototype.slice.call(arguments);jqInt.each(e,function(e,t){});var t={type:"info",timestamp:this.timeStamp(),echoed:!1,data:e};this.logs.push(t),this.buffer||this.echo()},error:function(){var e=Array.prototype.slice.call(arguments);jqInt.each(e,function(e,t){});var t={type:"error",timestamp:this.timeStamp(),echoed:!1,data:e};this.logs.push(t),this.buffer||this.echo()},echo:function(){var e=this;return window.console&&jqInt.each(this.logs,function(t,i){i.echoed||(e.printOutData(i),i.echoed=!0)}),"End of logs"},echoAll:function(){var e=this;return window.console&&jqInt.each(this.logs,function(t,i){e.printOutData(i)}),"End of logs"},printOutData:function(e){"info"==e.type?console.info(e.timestamp+": ",e.data):"error"==e.type&&jqInt.each(e.data,function(t,i){i instanceof Error?console.error(e.timestamp+" - "+i.name+" - "+i.message+": ",i.stack):console.error(e.timestamp+": ",i)})},timeStamp:function(){var e=new Date,t=[e.getMonth()+1,e.getDate(),e.getFullYear()],i=[e.getHours(),e.getMinutes(),e.getSeconds()],o=i[0]<12?"AM":"PM";i[0]=i[0]<12?i[0]:i[0]-12,i[0]=i[0]||12;for(var r=1;r<3;r++)i[r]<10&&(i[r]="0"+i[r]);return t.join("/")+" "+i.join(":")+" "+o}},Util:{makeUUID:function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:7&i|8).toString(16)})},identifierIsIOS:function(){return!!/iPhone|iPad|iPod/i.test(navigator.userAgent)},getURLParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}}},jqInt=null,_MetricalIdentity={pubsub:new _MetricalUtils.PubSub,pubsubTopics:{"reset-session-id":"reset-session-id"},Cookie:null,Storage:null,Util:null,instanceId:null,init:function(e,t,i){this.Cookie=e,this.Storage=t,this.Util=i,this.initializeInstanceId(),this.initializeDeviceId(),this.initializeSessionId()},initializeInstanceId:function(){this.instanceId=this.Util.makeUUID()},initializeDeviceId:function(){if(this.Cookie.hasItem(this.Cookie.cookieNameDid))null==this.Storage.getItem(this.Cookie.cookieNameDid)&&this.Storage.setItem(this.Cookie.cookieNameDid,this.Cookie.getItem(this.Cookie.cookieNameDid));else{var e=new Date;if(e.setTime(e.getTime()+15768e7),null!=this.Storage.getItem(this.Cookie.cookieNameDid))this.Cookie.setItem(this.Cookie.cookieNameDid,this.Storage.getItem(this.Cookie.cookieNameDid),e,this.Cookie.path,this.Cookie.rootDomain());else{var t=this.Util.makeUUID();this.Cookie.setItem(this.Cookie.cookieNameDid,t,e,this.Cookie.path,this.Cookie.rootDomain()),this.Storage.setItem(this.Cookie.cookieNameDid,t)}}},initializeSessionId:function(){this.Cookie.hasItem(this.Cookie.cookieNameSession)||this.resetSessionId()},resetSessionId:function(){var e=this.Util.makeUUID();this.Cookie.setItem(this.Cookie.cookieNameSession,e,"",this.Cookie.path,this.Cookie.rootDomain()),this.pubsub.publish(this.pubsubTopics["reset-session-id"],{sessionId:e})},getSessionId:function(){return this.Cookie.getItem(this.Cookie.cookieNameSession)},getDeviceId:function(){return this.Cookie.getItem(this.Cookie.cookieNameDid)},getInstanceId:function(){return this.instanceId},getLastTimestamp:function(){return this.Cookie.getItem("_Metrical_lastTimestamp")},setLastTimestamp:function(){this.Cookie.setItem("_Metrical_lastTimestamp",Date.now(),"",this.Cookie.path,this.Cookie.rootDomain())}},_MetricalBrowserHistory={key:"urlHistory",history:[],init:function(){var e=window.location.href;this.history=this.getHistoryFromStorage(),this.history.unshift(e),this.saveHistoryToStorage()},storageHasKey:function(){for(var e=!1,t=this.key,i=0;i<window.sessionStorage.length;i++)window.sessionStorage.key(i)==t&&(e=!0);return e},getHistoryFromStorage:function(){var e=[];return this.storageHasKey()&&(e=JSON.parse(window.sessionStorage.getItem(this.key))),e},saveHistoryToStorage:function(){window.sessionStorage.setItem(this.key,JSON.stringify(this.history))},getCurrentUrl:function(){return this.history.length>0?this.history[0]:null},getLastUrl:function(){return this.history.length>1?this.history[1]:null}},_MetricalTestMode={Cookie:null,init:function(e){this.Cookie=e},enable:function(){return this.Cookie.setItem("_Metrical_TestMode",1,"",this.Cookie.path,this.Cookie.rootDomain()),"Test Mode is enabled"},disable:function(){return this.Cookie.setItem("_Metrical_TestMode",0,"",this.Cookie.path,this.Cookie.rootDomain()),"Test Mode is disabled"},isInTestMode:function(){return"1"==this.Cookie.getItem("_Metrical_TestMode")}};_MetricalCoupon={jqCoupon:null,couponDriver:null,logger:null,init:function(e,t,i,o){t&&"function"==typeof t.logError&&(this.logger=t);try{this.jqCoupon=e}catch(e){this.logger?this.logger.logError(e):console.log(e)}o&&(this.prePostCouponHandler=o);this.properties=Object.assign({},{},i||{});try{couponDriverName="RedirectCouponDriver",this.properties.coupondriver?(couponDriverName=this.properties.coupondriver,"JavascriptDoEventCouponDriver"==couponDriverName?this.couponDriver=new this[couponDriverName](this.properties.couponeventstatement):"FetchDriver"==couponDriverName?this.couponDriver=new this[couponDriverName](this.properties):"iFrameCouponDriver"==couponDriverName?this.couponDriver=new this[couponDriverName](this.properties.iframeSrc,this.properties.couponFieldSelector,this.properties.submitButtonSelector,this.properties.couponCode,this.properties.postbackURL):"RedirectRunApplierCouponDriver"==couponDriverName?this.couponDriver=new this[couponDriverName](this.properties.couponurlpost,this.properties.couponcode,this.properties.applier,this.properties.urlfilter,this.properties.params||void 0):"JcpCouponDriver"==couponDriverName?this.couponDriver=new this[couponDriverName](this.properties):"AjaxGETDriverOptionalRedirect"==couponDriverName?this.couponDriver=new this[couponDriverName](this.properties):this.couponDriver=new this[couponDriverName](this.properties.couponurlpost,this.properties.couponcode,this.properties.postbackurl)):this.couponDriver=new this[couponDriverName](this.properties.couponurlpost,this.properties.couponcode,this.properties.postbackurl),this.logger&&this.logger.logInfo("setting up the coupon driver "+couponDriverName,this.couponDriver)}catch(e){this.logger&&this.logger.logError("an error occurred setting up the coupon driver "+couponDriverName+" : "+e.message,e)}},couponConfig:function(){return this.properties||{}},postCoupon:function(){var e=this.properties;this.couponDriver?e.singleusecoupon?(surveyid=_MetricalAbandonCart.Config.surveyid?_MetricalAbandonCart.Config.surveyid:_Metrical.app.properties.survey,uuid=_MetricalStorage.Cookie.hasItem("_MetricalObject_did")?_MetricalStorage.Cookie.getItem("_MetricalObject_did"):"",sessionid=_MetricalStorage.Cookie.hasItem("_MetricalObject_sessionid")?_MetricalStorage.Cookie.getItem("_MetricalObject_sessionid"):"",this.fetchSingleUseCouponCode(surveyid,e.couponcode,uuid,sessionid,function(e){e.success&&(_MetricalCoupon.couponDriver.couponCode=e.coupon,_MetricalCoupon.prePostCouponHandler&&_MetricalCoupon.prePostCouponHandler(),_MetricalCoupon.couponDriver.postCoupon())})):(this.prePostCouponHandler&&this.prePostCouponHandler(),this.couponDriver.postCoupon()):this.logger&&this.logger.logInfo("There is no coupon driver set to post the coupon")},fetchSingleUseCouponCode:function(e,t,i,o,r,n){var a={surveyId:e,couponId:t,uuid:i,sessionId:o};this.jqCoupon.ajax({type:"POST",dataType:"json",data:JSON.stringify(a),contentType:"text/plain",traditional:!1,async:!1,url:_MetricalHosts.endpoints.singleUseCoupon,success:function(e){r(e)},error:function(e,t,i){console.log(e),console.log(t),console.log(i),n&&n()}})},couponRedirect:function(){"redirect"in this.couponDriver&&this.couponDriver.redirect()},FetchDriver:function(e){if(this.localProperties=e,0==!!this.localProperties.couponoperations)throw new Error("FetchDriver expects a couponoperations parameter");if(0==Array.isArray(this.localProperties.couponoperations))throw new Error("FetchDriver expects couponoperations to be an array");this.redirect=function(e){window.location.href=e},this.postCoupon=function(){var e=this;return new Promise(function(t,i){var o=Promise.resolve(null);e.localProperties.couponoperations.reduce(function(e,t){var i=t.url,o=t.params||{method:"get"},r=t.data||null;return r&&(o.body=JSON.stringify(r)),e.then(function(){return fetch(i,o)})},o).then(function(){e.localProperties.redirecturl?(e.redirect(e.localProperties.redirecturl),t(!0)):t(!0)}).catch(function(e){console.error(e),i(e)})})}},RedirectCouponDriver:function(e){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the couponurlpost attribute needs to be defined for this coupon driver"};this.postURL=e,this.postCoupon=function(){window.location.href=this.postURL}},EvalRedirectCouponDriver:function(postURL){this.postURL=postURL,this.postCoupon=function(){var tempUrl=eval(this.postURL);window.location.href=tempUrl}},JavascriptDoEventCouponDriver:function(couponEventStatement){if(void 0===couponEventStatement)throw{name:"RequiredParameterMissing",message:"the couponeventstatement attribute needs to be defined for this coupon driver"};this.couponEventStatement=couponEventStatement,this.postCoupon=function(){eval(this.couponEventStatement)}},MagentoCouponDriver:function(e,t,i){if(void 0===t)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};this.couponCode=t,this.postCoupon=function(){_MetricalCoupon.jqCoupon("#coupon_code").val(this.couponCode),discountForm.submit(!1)}},MagentoCouponDriverAlternative:function(e,t,i){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the couponurlpost attribute needs to be defined for this coupon driver"};if(this.postURL=e,void 0===t)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};if(this.couponCode=t,void 0===i)throw{name:"RequiredParameterMissing",message:"the postbackurl attribute needs to be defined for this coupon driver"};this.postbackURL=i,this.postCoupon=function(){var e=this;_MetricalCoupon.jqCoupon.post(this.postURL,{coupon_code:this.couponCode},function(t){window.location.href=e.postbackURL})}},MonsterProductsCouponDriver:function(e,t,i){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the couponurlpost attribute needs to be defined for this coupon driver"};if(this.postURL=e,void 0===t)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};if(this.couponCode=t,void 0===i)throw{name:"RequiredParameterMissing",message:"the postbackurl attribute needs to be defined for this coupon driver"};this.postbackURL=i,this.postCoupon=function(){var e=this;expSKU=_MetricalCoupon.jqCoupon("input[name='ExpSKU']").val(),postData={scriptManager:"ctl13$orderSummary$updatePanel|ctl13$orderSummary$coupon$applyCoupon2",__EVENTTARGET:"ctl13$orderSummary$coupon$applyCoupon2",__EVENTARGUMENT:"",w:"",ExpSKU:expSKU,ctl13$orderSummary$coupon$couponCode:this.couponCode,ctl13$HF_AccessToken:"",__VIEWSTATEGENERATOR:_MetricalCoupon.jqCoupon("#__VIEWSTATEGENERATOR").val(),__VIEWSTATE:_MetricalCoupon.jqCoupon("#__VIEWSTATE").val(),__ASYNCPOST:!0},postData[expSKU]=_MetricalCoupon.jqCoupon("input[name='"+expSKU+"']").val(),this.jqCoupon.post(this.postURL,postData,function(t){window.location.href=e.postbackURL})}},AjaxGETDriver:function(e,t,i){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the couponurlpost attribute needs to be defined for this coupon driver"};if(this.postURL=e,void 0===t)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};if(this.couponCode=t,void 0===i)throw{name:"RequiredParameterMissing",message:"the postbackurl attribute needs to be defined for this coupon driver"};this.postbackURL=i,this.postCoupon=function(){var e=this;this.postURL=this.postURL.replace("{{couponCode}}",this.couponCode),_MetricalCoupon.jqCoupon.get(this.postURL,{},function(t){_MetricalCouponDataAccess.setC(e.couponCode),window.location.href=e.postbackURL})}},AjaxGETDriverOptionalRedirect:function(e){if(this.params=e,!("couponurlpost"in e)||"string"!=typeof e.couponurlpost)throw{name:"RequiredParameterMissing",message:"the couponurlpost attribute needs to be defined for this coupon driver"};if(!("couponcode"in e)||"string"!=typeof e.couponcode)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};if(!("postbackurl"in e)||"string"!=typeof e.postbackurl)throw{name:"RequiredParameterMissing",message:"the postbackurl attribute needs to be defined for this coupon driver"};this.forceRedirect=1==!!e.forceredirect,this.postCoupon=function(){var e=this,t=e.params.couponurlpost.replace("{{couponCode}}",e.params.couponcode);_MetricalCoupon.jqCoupon.get(t,{},function(t){_MetricalCouponDataAccess.setC(e.params.couponcode),(e.params.postbackurl!=window.location.href||e.forceRedirect)&&(window.location.href=e.params.postbackurl)})}},iFrameCouponDriver:function(e,t,i,o,r){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the iframeSrc attribute needs to be defined for this coupon driver"};if(this.iframeSrc=e,void 0===t)throw{name:"RequiredParameterMissing",message:"the couponFieldSelector attribute needs to be defined for this coupon driver"};if(this.couponFieldSelector=t,void 0===i)throw{name:"RequiredParameterMissing",message:"the submitButtonSelector attribute needs to be defined for this coupon driver"};if(this.submitButtonSelector=i,void 0===o)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};if(this.couponCode=o,void 0===r)throw{name:"RequiredParameterMissing",message:"the postbackurl attribute needs to be defined for this coupon driver"};this.postbackURL=r,this.postCoupon=function(){var e=this,t=document.createElement("iframe");t.id="metrical_coupon_frame",t.onload=function(){var t=window.parent._MetricalCoupon.jqCoupon("#metrical_coupon_frame")[0].contentDocument;_MetricalCoupon.jqCoupon(e.couponFieldSelector,t).val(e.couponCode),_MetricalCoupon.jqCoupon(e.submitButtonSelector,t).click(),window.location.replace(e.postbackURL)},t.src=this.iframeSrc,t.style="display: none;",document.body.append(t)}},iFrameAjaxGetDriver:function(e,t,i){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the iframeSrc attribute needs to be defined for this coupon driver"};if(this.iframeSrc=e,void 0===t)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};this.couponCode=t,this.postbackURL=i||!1,this.postCoupon=function(){this.iframeSrc=this.iframeSrc.replace("{{couponCode}}",this.couponCode);var e=document.createElement("iframe");e.id="metrical_coupon_frame",e.onload=function(){},e.src=this.iframeSrc,e.style="display: none;",document.body.append(e)},this.redirect=function(){this.postbackURL&&window.location.replace(this.postbackURL)}},RedirectRunApplierCouponDriver:function(e,t,i,o,r){if(void 0===e)throw{name:"RequiredParameterMissing",message:"the couponurlpost attribute needs to be defined for this coupon driver"};if(this.postURL=e,void 0===t)throw{name:"RequiredParameterMissing",message:"the couponcode attribute needs to be defined for this coupon driver"};if(this.couponCode=t,void 0===i)throw{name:"RequiredParameterMissing",message:"the applier attribute needs to be defined for this coupon driver"};if(this.applier=i,void 0===o)throw{name:"RequiredParameterMissing",message:"the urlFilter attribute needs to be defined for this coupon driver"};this.urlFilter=o,this.additionalParams=void 0!==r?r:{},this.postCoupon=function(){var e=Object.assign({},{applier:this.applier,code:this.couponCode,filter:this.urlFilter},this.additionalParams),t=encodeURIComponent(btoa(JSON.stringify(e)));_MetricalStorage.Cookie.sessionQuickSet("payload",t),window.location.href==this.postURL?_MetricalAppliers.init({jq:jQuery,log:_MetricalAbandonCart.Log}):window.location.replace(this.postURL)}},JcpCouponDriver:function(e){if(0==!!e.postbackurl)throw new Error("the postbackurl attribute needs to be defined for this coupon driver");if(0==!!e.couponcode)throw new Error("the couponcode attribute needs to be defined for this coupon driver");this.forceRedirect=1==!!e.forceredirect,this.properties=e,this.singleUse=!(!e.singleuse||!e.singleuse),this.postCoupon=function(){var e=this,t=function(e,t){window.handleVendorAction("apply_coupon",e,function(e){t("error"!=e&&0!=e)})},i=function(t,i,o){1==t.includes(!1)?e.renderOfferError({couponcode:i.join(", "),killcode:o.join(", ")}):e.doRedirect()};try{var o=Array.isArray(e.properties.couponcode)?e.properties.couponcode:[e.properties.couponcode],r=e.singleUse?r=e.singleUseCode:e.normalCode;r(o,function(e){var r=Array.isArray(e.coupon)?e.coupon:[e.coupon],n=[],a=o[0],s=r[0]||null;t({couponCode:a,serialCode:s},function(e){if(n.push(e),o.length>1){var a=o[1],s=r[1]||null;t({couponCode:a,serialCode:s},function(e){n.push(e),i(n,o,r)})}else i(n,o,r)})})}catch(e){throw console.error(e),e}},this.normalCode=function(e,t){t({success:!0,coupon:null})},this.singleUseCode=function(e,t){_MetricalCouponDataAccess.fetchSingleUseCouponCode(_MetricalAbandonCart.Config.surveyid,e,_MetricalIdentity.getDeviceId(),_MetricalIdentity.getSessionId(),function(e){t(e)},function(){throw new Error("singleUseCoupon failed")})},this.doRedirect=function(){(this.properties.postbackurl!=window.location.href||this.forceRedirect)&&(window.location.href=this.properties.postbackurl),this.properties.postbackurl==window.location.href&&window.location.reload()},this.renderOfferError=function(e){var t=_MetricalAbandonCart.Config.views.couponerror;t.viewconfig.textblocks[0].tagreplacements.COUPON=e.couponcode,t.viewconfig.textblocks[0].tagreplacements.SERIAL=e.killcode,new _MetricalOfferViewV2({view:t,config:_MetricalAbandonCart.Config}).render(),_MetricalACInteractions.recordInteraction("couponerror")}}};