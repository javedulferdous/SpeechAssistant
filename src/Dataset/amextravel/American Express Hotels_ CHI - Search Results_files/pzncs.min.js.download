var ClickStreamService=(function(){if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}return{killCSCall:false,jsonStringData:"",pubGuidId:"NO_GUID",pubGuidPattern:/^[0-9a-f]{32}$/,clickStreamURL:"",clickStreamServiceURLS:["https://pegetoffers-dev.americanexpress.com/offerservice/updatecustvisit/updateCustomerVisit/","pegetoffers-qa.americanexpress.com/offerservice/updatecustvisit/updateCustomerVisit/","pegetoffers.americanexpress.com/offerservice/updatecustvisit/updateCustomerVisit/"],jqueryURL:"",jqueryURLS:["https://dicm.intra.aexp.com/Internet/PZN/js/jquery/v1821/jquery.src.js","https://qicm.americanexpress.com/Internet/PZN/js/jquery/v1821/jquery.min.js","https://icm.aexp-static.com/Internet/PZN/js/jquery/v1821/jquery.min.js"],hierarchy:"",pageName:"",pmc:"",env:"E1",products:"",conversionType:"",callTimeout:1000,pageScheme:"",defScheme:"https",csTimeInterval:undefined,blockedValues:[["US|AMEX|Ser|SOA","CardAccountSummary"],["US|AMEX|Ser|Payments","PayBill:TY"],["US|AMEX|Home","USHomepage-Cardmember"],["US|AMEX|Ser","EnterpriseLogin"],["US|AMEX|Ser","EnterpriseLogout"],["US|AMEX|Ser|SOA","AccountHub"]],omnActionTypes:["US:Ser:eStatement:MainPage:Expand>ETDPosted","US:AMEX:Ser:SOA:AccountHub:Click>AddToCard","US:AMEX:Ser:SOA:AccountHub:Click>OffersViewDetails","US:Ser:Interstitial:Impression>UpdateIncome","US:Ser:Interstitial:Impression>UpdateIncomeConfirmation"],jQuery:undefined,init:function(){this.jQuery=window.jQuery;if(this.killCSCall){return}this.pubGuidId=this.getCookie("blueboxpublic");if(typeof window.omn_hierarchy!=="undefined"||typeof window.omn_pagename!=="undefined"){this.pageName=window.omn_pagename;this.hierarchy=window.omn_hierarchy;this.products=(typeof window.omn_products!=="undefined")?window.omn_products:"";this.pmc=(typeof window.omn_pmc!=="undefined")?window.omn_pmc:"";this.conversionType=(typeof window.omn_conversionType!=="undefined")?window.omn_conversionType:""}else{if(typeof window.omn!=="undefined"){this.pageName=(typeof window.omn.pagename!=="undefined")?window.omn.pagename:"";this.hierarchy=(typeof window.omn.hierarchy!=="undefined")?window.omn.hierarchy:"";this.products=(typeof window.omn.products!=="undefined")?window.omn.products:"";this.pmc=(typeof window.omn.pmc!=="undefined")?window.omn.pmc:"";this.conversionType=(typeof window.omn.conversionType!=="undefined")?window.omn.conversionType:""}else{return}}if(!this.hierarchy){return}this.checkPageScheme();this.setEnvVariables();jsonData={publicGuid:this.pubGuidId,hierarchy:this.hierarchy,pagename:this.pageName,pmc:this.pmc,products:this.products,conversionType:this.conversionType};this.jsonStringData=this.stringify(jsonData);if(!this.isBlocked()){this.submitRequest()}this.setCSInterval()},submitRequest:function(){if(!this.pubGuidPattern.test(this.pubGuidId)||this.pageScheme=="http"||!(this.jsonStringData&&this.jsonStringData.trim().length>0)){return}var c=this;if(typeof this.jQuery!=="undefined"){this.callBackFn(this.clickStreamURL,this.jsonStringData)}else{var a=this.clickStreamURL;var b=this.jsonStringData;element=document.createElement("script");element.src=this.jqueryURL;element.setAttribute("type","text/javascript");if(typeof element.onreadystatechange=="undefined"){element.onload=function(){c.callBackFn(a,b)}}else{element.onreadystatechange=function(){var d=false;if((this.readyState=="complete"||this.readyState=="loaded")&&!d){d=true;c.callBackFn(a,b)}}}document.getElementsByTagName("head")[0].appendChild(element)}},callBackFn:function(b,c){var e=this;if(window.XDomainRequest){if(this.env=="E1"){this.clickStreamURL=this.getEnvServiceUrl(this.clickStreamServiceURLS[1]);b=this.clickStreamURL}var a=new XDomainRequest();a.open("POST",b);a.onload=function(){};a.onprogress=function(){};a.ontimeout=function(){};a.onerror=function(){};setTimeout(function(){a.send("requestData="+c)},100)}else{if(this.jQuery.support){this.jQuery.support.cors=true}var d=this.jQuery.ajax({type:"POST",url:b,crossDomain:true,data:{requestData:c}})}},getCookie:function(b){var a=document.cookie.split(";");var d="";var f="";var e="NO_GUID";for(var c=0;c<a.length;c++){d=a[c].split("=");f=d[0].replace(/^\s+|\s+$/g,"");if(f==b){if(d.length>1){e=unescape(d[1].replace(/^\s+|\s+$/g,""))}return e}d=null;f=""}return e},setEnvVariables:function(){var a=window.location.href;if(a.indexOf(".com:")>-1){a=a.substring(a.indexOf("://")+3,a.indexOf(".com:")+9)}else{a=a.substring(a.indexOf("://")+3,a.indexOf(".com/")+4)}if(!((a.substr(0,1)=="q")||(a.substr(0,2)=="e2")||(a.substr(0,4)=="ssoq")||(a.substr(0,2)=="e1"))&&(a.indexOf(".americanexpress")>-1)){this.env="E3";this.clickStreamURL=this.getEnvServiceUrl(this.clickStreamServiceURLS[2]);this.jqueryURL=this.jqueryURLS[2]}else{if((a.indexOf(".aexp")>-1)){this.env="E1";this.callTimeout=2000;this.clickStreamURL=this.clickStreamServiceURLS[0];this.jqueryURL=this.jqueryURLS[0]}else{this.env="E2";this.callTimeout=2000;this.clickStreamURL=this.getEnvServiceUrl(this.clickStreamServiceURLS[1]);this.jqueryURL=this.jqueryURLS[1]}}},getEnvServiceUrl:function(b){var a="";if(this.pageScheme!==""){a=this.pageScheme+"://"+b}else{a=this.defScheme+"://"+b}return a},checkPageScheme:function(){var a=window.location.href;var b=a.substring(0,a.indexOf("://"));if(b=="http"||b=="https"){this.pageScheme=b}},setCSInterval:function(){var d={},a={};d.pagename=(window.omn?window.omn.pagename:undefined);d.hierarchy=(window.omn?window.omn.hierarchy:undefined);d.omnActionValue=(window.s_rmact?window.s_rmact:undefined);a.pagename=undefined;a.hierarchy=undefined;var e=window.omn_pagename,h=window.omn_hierarchy,i=undefined,f=undefined,g=this,j=false;var c=false;var b=false;this.csTimeInterval=setInterval(function(){a.pagename=(window.omn?window.omn.pagename:undefined);a.hierarchy=(window.omn?window.omn.hierarchy:undefined);a.conversionType=(window.omn?window.omn.conversionType:undefined);a.omnActionValue=(window.s_rmact?window.s_rmact:undefined);i=window.omn_pagename;f=window.omn_hierarchy;if(g.pubGuidId=="NO_GUID"){g.pubGuidId=g.getCookie("blueboxpublic")}if(e!=i||h!=f){j=true;e=i;h=f;g.pageName=e;g.hierarchy=h}else{if(d.pagename!=a.pagename||d.hierarchy!=a.hierarchy){j=true;d.pagename=a.pagename;d.hierarchy=a.hierarchy;d.conversionType=a.conversionType;if(d.pagename==e&&d.hierarchy==h){j=false;return}g.pageName=d.pagename;g.hierarchy=d.hierarchy;g.conversionType=d.conversionType}}c=g.isOmnActionTypes(a.omnActionValue);if(c){if(d.omnActionValue!=a.omnActionValue){b=true;d.omnActionValue=a.omnActionValue;g.actionValue=d.omnActionValue}}if(j||b){j=false;b=false;if(!g.hierarchy){return}if(g.isBlocked()){return}jsonData={publicGuid:g.pubGuidId,hierarchy:g.hierarchy,pagename:g.pageName,pmc:g.pmc,products:g.products,conversionType:g.conversionType,omnActionValue:g.actionValue};g.jsonStringData=g.stringify(jsonData);g.submitRequest()}},1000)},isBlocked:function(){for(var a=0;a!=this.blockedValues.length;a++){if(this.hierarchy==this.blockedValues[a][0]&&this.pageName==this.blockedValues[a][1]){return true}}return false},isPubGuidMatched:function(){if(this.pubGuidPattern.test(this.pubGuidId)){return true}return false},isOmnActionTypes:function(a){for(var b=0;b!=this.omnActionTypes.length;b++){if(a==this.omnActionTypes[b]){return true}}return false},stringify:(function(){var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,a,e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},d;function c(i){h.lastIndex=0;return h.test(i)?'"'+i.replace(h,function(j){var k=e[j];return typeof k==="string"?k:"\\u"+("0000"+j.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+i+'"'}function f(r,o){var m,l,s,j,p=g,n,q=o[r];if(q&&typeof q==="object"&&typeof q.toJSON==="function"){q=q.toJSON(r)}if(typeof d==="function"){q=d.call(o,r,q)}switch(typeof q){case"string":return c(q);case"number":return isFinite(q)?String(q):"null";case"boolean":case"null":return String(q);case"object":if(!q){return"null"}g+=a;n=[];if(Object.prototype.toString.apply(q)==="[object Array]"){j=q.length;for(m=0;m<j;m+=1){n[m]=f(m,q)||"null"}s=n.length===0?"[]":g?"[\n"+g+n.join(",\n"+g)+"\n"+p+"]":"["+n.join(",")+"]";g=p;return s}if(d&&typeof d==="object"){j=d.length;for(m=0;m<j;m+=1){if(typeof d[m]==="string"){l=d[m];s=f(l,q);if(s){n.push(c(l)+(g?": ":":")+s)}}}}else{for(l in q){if(Object.prototype.hasOwnProperty.call(q,l)){s=f(l,q);if(s){n.push(c(l)+(g?": ":":")+s)}}}}s=n.length===0?"{}":g?"{\n"+g+n.join(",\n"+g)+"\n"+p+"}":"{"+n.join(",")+"}";g=p;return s}}return function(m,k,l){if(typeof JSON!=="undefined"&&typeof JSON.stringify!=="undefined"){return JSON.stringify(m,k,l)}var j;g="";a="";if(typeof l==="number"){for(j=0;j<l;j+=1){a+=" "}}else{if(typeof l==="string"){a=l}}d=k;if(k&&typeof k!=="function"&&(typeof k!=="object"||typeof k.length!=="number")){throw new Error("JSON.stringify")}return f("",{"":m})}})()}})();window.ClickStreamService=ClickStreamService;ClickStreamService.init();