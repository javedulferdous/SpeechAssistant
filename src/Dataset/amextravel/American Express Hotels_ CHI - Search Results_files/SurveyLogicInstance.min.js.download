window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag.taglets.SurveyLogic=lpTag.taglets.SurveyLogic||function(a){if(!a.survey||typeof a.survey!=="object"||this===window){return false;}else{this.survey=a.survey.survey||a.survey;this.createQuestionsMap();}this.defaultSelectValue=a.defaultSelectValue||"";this.header=this.survey.header||"";};(function(a){var b="prototype";a[b].questionTypes={TEXTF:"Text Field",TEXT:"Text Area",SELECT:"Dropdown Box",RADIO:"Radio Button",RADIOH:"Radio Button (side by side)",CHECKBOX:"Checkbox"};a[b].validationTypes={EMAIL:"email",NUMBER:"numeric",STRING:"alpha_numeric"};a[b].errorTypes={EMAIL:"email",NUMBER:"numeric",ILLEGAL_CHARS:"illegal_chars",REQUIRED:"required"};a[b].getAllQuestions=function(){return this.survey&&this.survey.questions&&this.survey.questions.question&&this.survey.questions.question.constructor===Array?this.survey.questions.question:[];};a[b].createQuestionsMap=function(){this.questionLogicMap={};this.questionIdMap={};this.mandatoryQuestions=[];var d=this.getAllQuestions();for(var c=0;c<d.length;c++){d[c].id=d[c].id===0?c+1000:d[c].id;if(d[c].logicId!==undefined){this.questionLogicMap[d[c].logicId]={arrayLocation:(""+c)};}if(d[c].id!==undefined){this.questionIdMap[d[c].id]={arrayLocation:(""+c)};}if(d[c].mandatory&&d[c].mandatory===true){this.mandatoryQuestions.push(c);}}};a[b].getQuestionByLogicId=function(c){return this.getQuestionByMap(c,this.questionLogicMap);};a[b].getQuestionById=function(c){return this.getQuestionByMap(c,this.questionIdMap);};a[b].getQuestionByIndex=function(c){var d={};d[c]={arrayLocation:c};return this.getQuestionByMap(c,d);};a[b].getQuestionAnswersById=function(c){var d=this.getQuestionById(c);return this.getQuestionAnswers(d);};a[b].getQuestionAnswersByLogicId=function(d){var c=this.getQuestionByLogicId(d);return this.getQuestionAnswers(c);};a[b].getQuestionAnswersByIndex=function(d){var c=this.getQuestionByIndex(d);return this.getQuestionAnswers(c);};a[b].getQuestionAnswers=function(c){var e=[];if(c.entry){for(var d=0;d<c.entry.length;d++){if(c.entry[d].checked){e.push(c.entry[d].value);}}}else{if(c.lastKnownValue){e.push(c.lastKnownValue);}}return e;};a[b].getQuestionByMap=function(g,f){var d=this.getAllQuestions(),c=-1;try{c=Number(f[g].arrayLocation);}catch(e){}if(c>-1&&d.length>c){return d[c];}else{return{};}};a[b].submitAnswerGetNextQuestions=function(c,d){this.submitAnswer(c,d);return this.getActiveQuestions({getExcluded:true});};a[b].getActiveQuestions=function(e){var h=this.getAllQuestions(),l={},m=[],f=[],j=false;var c=e&&e.getExcluded?e.getExcluded:false;var k=e&&e.mandatoryOnly?e.mandatoryOnly:false;for(var g=0;g<h.length;g++){if(l[g]!==true){var d=!k||(k&&h[g].mandatory===true)?true:false;if(d){m.push(h[g]);}j=false;}else{f.push(h[g]);j=true;}switch(h[g].type){case this.questionTypes.CHECKBOX:case this.questionTypes.SELECT:case this.questionTypes.RADIO:case this.questionTypes.RADIOH:l=this.getExcludedIndexes(h[g],l,j);break;}}if(!!c){m={questionsToShow:m,questionIdsToHide:f};}return m;};a[b].getActiveQuestionsIds=function(){var e=this.getActiveQuestions(),d=[];for(var c=0;c<e.length;c++){d.push(e[c].id);}return d;};a[b].getExcludedIndexes=function(c,g,k){if(!c.entry){return false;}for(var e=0;e<c.entry.length;e++){if(typeof c.entry[e].checked==="boolean"&&(!c.entry[e].checked||k)){if(c.entry[e].logic&&c.entry[e].logic.showLogicId){var h=c.entry[e].logic.showLogicId.constructor===Array?c.entry[e].logic.showLogicId:[c.entry[e].logic.showLogicId];for(var d=0;d<h.length;d++){if(this.questionLogicMap[h[d]]){var f=this.questionLogicMap[h[d]].arrayLocation;g[f]=true;}}}}}return g;};a[b].submitAnswer=function(c,g){var d=this.getQuestionById(c);if(!d.entry){this.submitTextAnswer(d,g);}else{g=g.constructor===Array?g:[g];for(var f=0;f<d.entry.length;f++){d.entry[f].checked=false;for(var e=0;e<g.length;e++){if(g[e]===d.entry[f].value){d.entry[f].checked=true;}}}}};a[b].submitTextAnswer=function(c,e){var d=typeof c==="object"?c:this.getQuestionById(c);if((d.type===this.questionTypes.TEXTF||d.type===this.questionTypes.TEXT)){e=e.replace(/\s\s*$/,"");d.lastKnownValue=String(e);}};a[b].getJSONSurvey=function(){var d={survey:{id:this.survey.id||"",question:[]}};var h=this.getActiveQuestions();try{for(var g=0;g<h.length;g++){var c=this.createQuestionJSON(h[g]);var f=(typeof c.answer==="string")||(c.answer.length>0);if(f){d.survey.question.push(c);}}}catch(j){}return d;};a[b].createQuestionJSON=function(d){var c={id:d.id,answer:[]};if(d.entry){for(var e=0;e<d.entry.length;e++){if(d.entry[e].checked===true){c.answer.push(d.entry[e].value);}}}else{if(typeof d.lastKnownValue!=="undefined"){c.answer=d.lastKnownValue;}}return c;};a[b].getXMLSurvey=function(){var f='<survey id="'+this.survey.id+'" >';var e=this.getActiveQuestions();for(var d=0;d<e.length;d++){var c=this.createQuestionXML(e[d]);if(c.hasAnswer){f+=c.XML;}}f+="</survey>";return f;};a[b].createQuestionXML=function(e){var d=false;var c='<question id="'+e.id+'" >';if(e.entry){for(var f=0;f<e.entry.length;f++){if(e.entry[f].checked===true){c+="<answer>"+e.entry[f].value+"</answer>";d=true;}}}else{if(e.lastKnownValue){c+="<answer>"+e.lastKnownValue+"</answer>";d=true;}}c+="</question>";return{XML:c,hasAnswer:d};};a[b].validateSurvey=function(h){var d={surveyValid:true,questionsNeeded:[]};var c=h&&typeof h==="boolean"?!h:true;var f=this.getActiveQuestions({mandatoryOnly:c});try{for(var g=0;g<f.length;g++){if(!this.validateQuestion(f[g])){d.surveyValid=false;d.questionsNeeded.push(f[g]);}}}catch(j){}return d;};a[b].validateQuestion=function(c){var d=true;if(c.entry){d=this.validateMultiOptionQuestion(c);}else{d=this.validateTextQuestion(c);}return d;};a[b].validateMultiOptionQuestion=function(d){var c=false;for(var e=0;e<d.entry.length;e++){if(d.entry[e].checked===true){c=true;break;}}if(d.mandatory&&!c){d.error=this.errorTypes.REQUIRED;}else{d.error=null;delete d.error;c=true;}return c;};a[b].validateTextQuestion=function(d){var c=true;if(d.lastKnownValue!==""){switch(d.validationType){case this.validationTypes.EMAIL:c=this.isValidEmail(d.lastKnownValue);if(!c){d.error=this.errorTypes.EMAIL;}break;case this.validationTypes.NUMBER:c=this.isNumber(d.lastKnownValue);if(!c){d.error=this.errorTypes.NUMBER;}break;case this.validationTypes.STRING:default:c=this.isString(d.lastKnownValue)&&this.isValidChars(d.lastKnownValue);if(!c){d.error=this.errorTypes.ILLEGAL_CHARS;}break;}}if(d.mandatory&&(!d.lastKnownValue||d.lastKnownValue==="")){d.error=this.errorTypes.REQUIRED;c=false;}else{if(c){d.error=null;delete d.error;}}return c;};a[b].isValidChars=function(c){return !(c.search(/<|>|\"/)>=0);};a[b].isValidEmail=function(d){try{var c=new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);return c.test(d);}catch(e){return false;}};a[b].isNumber=function(c){return !isNaN(c);};a[b].isString=function(c){return typeof c==="string";};a[b].dispose=function(){for(var c in this){if(this.hasOwnProperty(c)){this[c]=null;delete this[c];}}};})(lpTag.taglets.SurveyLogic);