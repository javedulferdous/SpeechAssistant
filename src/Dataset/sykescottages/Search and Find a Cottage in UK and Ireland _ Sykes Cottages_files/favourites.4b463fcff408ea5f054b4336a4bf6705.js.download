$((function(){function e(){$favorite_counter=$(".shortlist-counter").html(),$favorite_counter.length?$favorite_counter=parseInt($favorite_counter):$favorite_counter=0,$favorite_counter>0&&($favorite_counter--,$(".shortlist-counter").html($favorite_counter),0==$favorite_counter&&($heart_icon=$(".heart").find(".icon").first(),$heart_icon.hasClass("icon-shortlist")&&$heart_icon.removeClass("icon-shortlist").addClass("icon-shortlist-o")))}function t(){$favorite_counter=$(".shortlist-counter").html(),$favorite_counter.length?$favorite_counter=parseInt($favorite_counter):$favorite_counter=0,$favorite_counter++,$(".shortlist-counter").html($favorite_counter),$heart_icon=$(".heart").find(".icon").first(),$heart_icon.hasClass("icon-shortlist-o")&&$heart_icon.removeClass("icon-shortlist-o").addClass("icon-shortlist")}function o(e,t){if("undefined"!=typeof brand&&"ycc"!==brand||"undefined"==typeof brand){var o=function(){if("undefined"!=typeof current_list_id&&!t){var o=$("#total_results_count"),r=o.data("count")-1;if(0===r)return void location.reload(!0);o.data("count",r),o.html(r+(1==r?" cottage":" cottages")),e.closest("#search_results li").slideUp()}e.fadeOut(350)};if(!matchMediaWrapper(600,MATCH_MEDIA_MAX)||"undefined"==typeof num_of_lists||1!=num_of_lists)return setTimeout(o,5e3);o()}}function r(o,a){var s;if(a.in_favourites){if(s=o.data("del"),o.removeClass("add_favorites").addClass("del_favorites"),"Saved"===s&&("undefined"!=typeof FavouritesPopup14351&&FavouritesPopup14351?(category=$("body").hasClass("property")?"PropertyPage":"SearchResults",action=$("body").hasClass("property")?"Property Header":"Property Result",eventTracker.fireEvent(category,action,"Add To Favourites")):eventTracker.fireEvent("SearchResults","Add favourite","click")),"undefined"!=typeof recentlyShortlisted6156&&(recentlyShortlisted6156++,setCookie("recentlyShortlisted6156",recentlyShortlisted6156,365)),(d=$(".fav-qty-7910")).length&&!$(a.content).hasClass("multiple_lists")){var i=$(".header-fav .fav-badge "),n=1;d.html().replace(/\s+/g,"").length&&(n=parseInt(d.html().replace(/^\D+/g,""))+1),i.length&&(i.attr("data-count",n),i.removeClass("hide")),d.html("("+n+")")}"undefined"!=typeof FavouritesPopup3173&&FavouritesPopup3173&&!$(a.content).hasClass("multiple_lists")&&("undefined"!=typeof FavouritesPopup14351&&FavouritesPopup14351?($(".favourite-panel p").removeClass("added").addClass("removed"),$("#favouritePanel").removeClass("add"),$("#favouritePanel").addClass("show"),$("#favouritePanel span").text("Added to"),$("#view_undo14351").text("View").attr("href","/account/favourites"),setTimeout((function(){$("#favouritePanel").removeClass("show")}),3e3),"undo"==$(this).text()&&$("#favouritePanel a").on("click",(function(o){o.preventDefault();var a=this;if(eventTracker.fireEvent("KEP-14351","Search Results - Favourites Pop-Up","Undo Remove From Favourites"),"undefined"!=typeof brand&&"ycc"==brand){if(current_list_id=$("#favorite_list_id").val(),$(this).hasClass("del_favorites"))return $.post("/favourites/set_property_list",{property_id:$(a).data("property-id"),list_id:$(a).val(),status:0,current_list_id:current_list_id},(function(e){$(a).removeClass("del_favorites"),$(a).addClass("add_favorites"),$(a).closest(".shortlist-btn").find(".icon").addClass("icon-shortlist-o").removeClass("icon-shortlist")})),void e();t()}$.post("/favourites/press_favourites_button",{id:$(this).data("property-id"),current_list_id:"undefined"==typeof current_list_id?null:current_list_id},(function(e){$(a);"undefined"!=typeof enableIntileryITQS&&_itq.push(["_trackUserEvent","remove from favourites",{"Customer.Favourites":$(a).data("property-id")},"Remove From Favourites"]),r($(a),e),"undefined"!=typeof brand&&"ycc"==brand&&1==e.in_favourites&&$(a).closest(".shortlist-btn").find(".icon").addClass("icon-shortlist").removeClass("icon-shortlist-o"),"undefined"!=typeof brand&&"ycc"==brand&&0==e.in_favourites&&$(a).closest(".shortlist-btn").find(".icon").addClass("icon-shortlist-o").removeClass("icon-shortlist");var t=$(a).closest(".favourites-button-wrapper"),o=t.find(".popup");o.length?(o.show(),o.replaceWith(e.content)):t.append(e.content),(o=t.find(".popup")).find("a").on("click",(function(){eventTracker.fireEvent("SearchResults","PropertyResult","My Favourites")}))}),"json")}))):($("#favouritePanel").removeClass("add").finish().fadeIn(600).delay(3e3).fadeOut(300),$(".favourite-panel p").removeClass("added").addClass("removed"),$("#favouritePanel span").text("added to"))),"undefined"!=typeof changeFavouritesAppearance6719&&changeFavouritesAppearance6719&&$(o).closest("li").addClass("favouritebg6719")}else{var d;if(s=o.data("add"),o.removeClass("del_favorites").addClass("add_favorites"),"Save"===s&&("undefined"!=typeof FavouritesPopup14351&&FavouritesPopup14351?(category=$("body").hasClass("property")?"PropertyPage":"SearchResults",action=$("body").hasClass("property")?"Property Header":"Property Result",eventTracker.fireEvent("SearchResults",action,"Remove From Favourites")):eventTracker.fireEvent("SearchResults","Remove favourite","click")),(d=$(".fav-qty-7910")).length){i=$(".header-fav .fav-badge ");(n=parseInt(d.html().replace(/^\D+/g,""))-1)>0?(i.length&&i.attr("data-count",n),d.html("("+n+")")):(i.length&&(i.addClass("hide"),i.attr("data-count",n)),d.html(""))}"undefined"!=typeof FavouritesPopup3173&&FavouritesPopup3173&&("undefined"!=typeof FavouritesPopup14351&&FavouritesPopup14351?($(".favourite-panel p").removeClass("removed").addClass("added"),$("#favouritePanel").removeClass("add"),$("#favouritePanel").addClass("show"),$("#favouritePanel span").text("Removed from"),$("#view_undo14351").text("Undo").attr("href",""),setTimeout((function(){$("#favouritePanel").removeClass("show")}),3e3)):($(".favourite-panel p").removeClass("removed").addClass("added"),$("#favouritePanel").removeClass("add").finish().fadeIn(500).delay(3e3).fadeOut(500),$("#favouritePanel span").text("removed from"))),"undefined"!=typeof changeFavouritesAppearance6719&&changeFavouritesAppearance6719&&$(o).closest("li").removeClass("favouritebg6719")}o.html(s).prop("title",s)}$("#add-favourites-list").click((function(e){if(e.preventDefault(),!$("body").hasClass("readonly")){var t=prompt("Please enter a name for the list:");t&&$.post("/favourites/create_list",{name:t},(function(){location.reload(!0)}))}})),$(".rename-list a").click((function(e){if(e.preventDefault(),!$("body").hasClass("readonly")){var t=$(this).data("id"),o=prompt("Please enter a new name for the list:");o&&$.post("/favourites/rename_list",{name:o,id:t},(function(){location.reload(!0)}))}})),$(".delete-list a").click((function(e){if(e.preventDefault(),!$("body").hasClass("readonly")&&confirm("Are you sure you want to delete this list?")){var t=$(this).data("id");$.post("/favourites/delete_list",{id:t},(function(){location.reload(!0)}))}})),$("a.set-default-list, .set-default-list a").click((function(e){if(e.preventDefault(),!$("body").hasClass("readonly")&&confirm("Are you sure you want to set this list as default?")){var t=$(this).data("id");$.post("/favourites/set_default_list",{id:t},(function(){location.reload(!0)}))}})),$("#list-selector").change((function(){location.replace("/account/favourites/"+$(this).val())})),$(".del_favorites, .add_favorites").click((function(a){if("undefined"!=typeof FavouritesPopup14351&&FavouritesPopup14351){var s=$(this).attr("data-property-id");$("#view_undo14351").attr("data-property-id",s),action=$("body").hasClass("property")?"Property Header":"Property Result",$(this).hasClass("del_favorites")?eventTracker.fireEvent("SearchResults",action,"Remove From Favourites"):eventTracker.fireEvent("SearchResults",action,"Add To Favourites")}if(a.preventDefault(),!$("body").hasClass("readonly")){var i=this;if(clearTimeout(this.timer),"undefined"!=typeof brand&&"ycc"==brand){if(current_list_id=$("#favorite_list_id").val(),$(this).hasClass("del_favorites"))return $.post("/favourites/set_property_list",{property_id:$(i).data("property-id"),list_id:$(i).val(),status:0,current_list_id:current_list_id},(function(e){$(i).removeClass("del_favorites"),$(i).addClass("add_favorites"),$(i).closest(".shortlist-btn").find(".icon").addClass("icon-shortlist-o").removeClass("icon-shortlist")})),void e();t()}$.post("/favourites/press_favourites_button",{id:$(this).data("property-id"),current_list_id:"undefined"==typeof current_list_id?null:current_list_id},(function(e){$(i);"undefined"!=typeof enableIntileryITQS&&($(i).attr("class").indexOf("add_favorites")>-1?_itq.push(["_trackUserEvent","add to favourites",{"Customer.Favourites":$(i).data("property-id")},"Add To Favourites"]):_itq.push(["_trackUserEvent","remove from favourites",{"Customer.Favourites":$(i).data("property-id")},"Remove From Favourites"])),r($(i),e),"undefined"!=typeof brand&&"ycc"==brand&&1==e.in_favourites&&$(i).closest(".shortlist-btn").find(".icon").addClass("icon-shortlist").removeClass("icon-shortlist-o"),"undefined"!=typeof brand&&"ycc"==brand&&0==e.in_favourites&&$(i).closest(".shortlist-btn").find(".icon").addClass("icon-shortlist-o").removeClass("icon-shortlist");var t=$(i).closest(".favourites-button-wrapper"),a=t.find(".popup");a.length?(a.show(),a.replaceWith(e.content)):t.append(e.content),(a=t.find(".popup")).find("a").on("click",(function(){eventTracker.fireEvent("SearchResults","PropertyResult","My Favourites")})),i.timer=o(a,e.in_current_list)}),"json")}})),$(".favourites-button-wrapper").on("change",".popup input",(function(){var e=$(this),t=e.closest(".favourites-button-wrapper").find(".del_favorites, .add_favorites");clearTimeout(t.get(0).timer),$.post("/favourites/set_property_list",{property_id:e.data("property-id"),list_id:e.val(),status:this.checked?1:0,current_list_id:"undefined"==typeof current_list_id?null:current_list_id},(function(a){r(t,a),t.get(0).timer=o(e.closest(".popup"),a.in_current_list)}),"json")})),$(".login-or-register-headers").find("h3").click((function(){$(this).next().toggle(),$(this).toggleClass("closed")})),"left"!=$("#menu li").css("float")&&$(".login-or-register-headers fieldset").find("h3").click(),$('button[id^="share_button_"]').click((function(){var e=$(this).attr("id").replace("share_button_","");if(e&&!$("copy_url").length){var t="http://"+window.location.href.split("/")[2]+"/favourites/id/"+e;$(this).parent().find("#copy_url").val(t).parent().show(),$("#copy_url").focus().select(),$(".popup .close").bind("click",(function(){$(this).parent().hide()}))}})),$("#favouritePanel a").on("click",(function(){eventTracker.fireEvent("SearchResults","Favourites Pop-Up","Favourites Shortlist")}))}));