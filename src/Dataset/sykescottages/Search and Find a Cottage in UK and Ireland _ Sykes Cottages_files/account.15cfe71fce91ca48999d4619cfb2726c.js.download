if($((function(){if($(".main-content.account input").not(".show-placeholder").each((function(){$('label[for="'+this.id+'"]').length&&$(this).attr("placeholder","")})),$(".account-dialog").on("click",(function(e){e.preventDefault(),$("#dialog").remove();var t=$(this).data("url");t||(t=$(this).attr("href")),$('<div id="dialog" title="'+$(this).attr("title")+'">').hide().appendTo("body").load(t,(function(){$("div#dialog").dialog({buttons:{Ok:function(){$(this).dialog("close")}},minWidth:500,minHeight:250,maxHeight:600,modal:!0})}))})),$(".insurance-bought").length>0&&$(".insurance-bought").on("click",(function(){var e=$(this).closest(".uk-insurance-shown").find("input[name='itinerary']"),t=$(this).closest(".uk-insurance-shown").find("input[name='activate_insurance_dob']");if(e.length>0&&t.length>0){var a=$(this);$(this).hide(),$.ajax({type:"POST",url:"/account/add_date_of_birth_to_insurance/",data:{itinerary_id:e.first().val(),date_of_birth:t.first().val()},success:function(){a.parent().html("<b>Insurance activated!</b>")}})}})),$(".date-of-birth").length>0){$(".insurance-bought").hide();const e="-200";$(".date-of-birth").datepicker({dateFormat:"dd/mm/yy",maxDate:"0",minDate:e+"y",yearRange:e+":+0",changeYear:!0,onSelect:function(e){switch($(this).attr("name")){case"buy_insurance_dob":$('form.hidden-form input[name="date_of_birth"]').remove(),$("form.hidden-form").append('<input name="date_of_birth" type="text" value="'+e+'" />');break;case"activate_insurance_dob":var t=$(this).closest(".uk-insurance-shown").find(".insurance-bought");t.length>0&&t.first().show()}}})}$('[name*="insurance-"]').on("click",(function(){var e=$(this),t=e.data("pbn"),a=e.val(),n=e.data("type"),i=$("[name=add-insurance-"+t+"]"),o=$("#insurance-container-"+t),s=!1;if("uk-residence"==n){var r=$("[name=agree-insurance-"+t+"]:checked").val();"1"==a?(r&&(s=!0),o.next().find(".uk-insurance-shown").show(),swapClass(o,"non-uk-insurance-shown","non-uk-insurance-hidden"),swapClass(o,"uk-insurance-hidden","uk-insurance-shown")):(o.next().find(".uk-insurance-shown").hide(),swapClass(o,"non-uk-insurance-hidden","non-uk-insurance-shown"),swapClass(o,"uk-insurance-shown","uk-insurance-hidden"))}else{if("terms-agree"!=n)return;var d=$("[name=resident-insurance-"+t+"]:checked").val();"undefined"!=typeof removeResidentButton&&(d=1),e.is(":checked")&&"1"==d&&(s=!0)}s?i.removeClass("disabled-insurance"):i.addClass("disabled-insurance")})),$('[name*="waiver-"]').on("click",(function(){var e=$(this),t=e.data("pbn"),a=e.val(),n=e.data("type"),i=$("[name=add-waiver-"+t+"]"),o=$("#waiver-container-"+t),s=!1;if("uk-residence"==n){var r=$("[name=agree-waiver-"+t+"]:checked").val();"1"==a?(r&&(s=!0),swapClass(o,"non-uk-waiver-shown","non-uk-waiver-hidden"),swapClass(o,"uk-waiver-hidden","uk-waiver-shown")):(swapClass(o,"non-uk-waiver-hidden","non-uk-waiver-shown"),swapClass(o,"uk-waiver-shown","uk-waiver-hidden"))}else{if("terms-agree"!=n)return;var d=$("[name=resident-waiver-"+t+"]:checked").val();e.is(":checked")&&"1"==d&&(s=!0)}s?i.removeClass("disabled-waiver"):i.addClass("disabled-waiver")})),$(".waiver-information .tab").on("click",(function(){$(".waiver-information .tab").removeClass("active-tab"),$(this).addClass("active-tab");var e="#covered-tab";$(this).hasClass("uncovered-tab")&&(e="#uncovered-tab"),$(this).parent().find(".tab-contents").addClass("hidden-tab-contents"),$(this).parent().find(e).removeClass("hidden-tab-contents")})),$(".buy-insurance").on("click",(function(){var e=$(this).data("pbn"),t=1,a=$("[name=agree-insurance-"+e+"]:checked").val();return"undefined"==typeof removeResidentButton&&(t=$("[name=resident-insurance-"+e+"]:checked").val()),void 0===t||"1"!=t?(alert("Insurance is only available to UK residents."),!1):!(void 0===a||!a)||(alert("You must agree to the terms and conditions."),!1)})),$(".cancel-booking-action").on("click",(function(){var e=$("#cancel-booking-popup-"+$(this).data("itinerary-id"));e.find("input[type=checkbox]").prop("checked",!1),e.find(".button-call-to-action").addClass("disabled"),e.dialog({width:350,minHeight:250,maxHeight:600,modal:!0,title:"Cancel booking"})})),$(".cancel-booking-popup input[type=checkbox]").change((function(){$(this).closest(".cancel-booking-popup").find(".button-call-to-action").toggleClass("disabled",!$(this).prop("checked"))})),$(".cancel-booking-popup .button-call-to-action").on("click",(function(){var e=$(this);if(e.hasClass("disabled"))alert('Please confirm that you wish to cancel this booking by clicking "I wish to cancel this booking".');else{var t=e.data("itinerary-id");$.post("/account/cancel_booking/"+t).then((function(){var a=$("#booking-"+t);a.find(".not-cancelled").addClass("inactive"),a.find(".cancelled").removeClass("inactive"),e.closest(".cancel-booking-popup").dialog("close")}),(function(){alert("We're sorry but we are currently unable to cancel your booking.")}))}})),$(".cancel-booking-popup .close-popup").on("click",(function(){$(this).closest(".cancel-booking-popup").dialog("close")})),$("[data-toggle]").on("click",(function(){var e=$(this),t=e.parent().parent(),a=e.data("toggle");"undefined"!=typeof ChangeBookingDatesKep9290Tes1944&&"Change booking dates"==e.text()&&(eventTracker.fireEvent("Account/Bookings","click","Change Dates Tab"),""===getCookie(CHANGE_OF_DATES_COOKIE)&&setCookie(CHANGE_OF_DATES_COOKIE,CHANGE_OF_DATES_INTERACTION_STEP_1,1));var n=!matchMediaWrapper(599,MATCH_MEDIA_MAX);n&&e.hasClass("enabled")||(t.find("[data-toggle]").each((function(){var e=$(this),t=!n&&e.hasClass("low-res-trigger")||n&&!e.hasClass("low-res-trigger");"undefined"!=typeof partial_payment&&(t=e.hasClass("low-res-trigger")||n),t&&(e.data("toggle")!=a?$(this).removeClass("enabled"):$(this).toggleClass("enabled"))})),t.find(".info-area>div").each((function(){$(this).hasClass(a)?$(this).toggle():$(this).hide()})))})),$(".print-link").on("click",(function(){var e=$(this).parent().parent().clone();e.find(".hide-in-print-version").remove();var t=window.open("","print","width=600,height=450,status,scrollbars,resizable,screenX=20,screenY=40,left=20,top=40");t.document.write('<html><head></head><body><span id="printcontrols" style="float:right;"><a href="javascript:window.print();">print</a> | <a href="javascript:window.close();">close</a></span>'+e.html()+"</body></html>"),t.document.close(),t.focus()})),$(".past-bookings > li").hide(),$(".past-bookings").find("li[data-page=1]").show(),$("#bookings .controls").find("a").on("click",(function(e){e.preventDefault(),$(".past-bookings > li").hide(),$(".past-bookings").find("li[data-page="+$(this).attr("data-page")+"]").show(),$(".pagination").find("li").removeClass("active"),$(".pagination").find("a[data-page="+$(this).attr("data-page")+"]").parent().addClass("active")}));var e=function(){var e=$(this).parent().attr("id");$(this).parent().remove(),$.post("/utilities/hide_tip",{id:e})};$(".tip .close").on("click",e),$("[ng-app]").on("click",".tip .close",e);var t=$(".login-wrapper").find("input#email");null!=t&&t.length&&t.focus(),$("<img/>")[0].src="/images/spinner-logo.gif",$(".main-content.account .right form:not(.cottage_features):not(.content-query)").submit((function(){$("#loader-icon").length||$(this).find(".submit-wrapper").append('<img src="/images/spinner-logo.gif" id="loader-icon"/>').find("button").addClass("inactive")})),$(".main-content.account .right form .submit-wrapper button").on("click",(function(e){$(this).hasClass("inactive")&&e.preventDefault()})),$("form[data-form-class]").find("input, textarea").blur((function(){validateForm($(this).closest("form"),$(this).prop("name"))})),$("form[data-form-class] select").change((function(){validateForm($(this).closest("form"),$(this).prop("name"))}));var a,n=!1;if($("form[data-form-class]").submit((function(e){if(n)return n=!1,!0;e.preventDefault();var t=$(this);validationRequest&&validationRequest.abort(),validateForm(t),$.when(validationRequest).then((function(){if(t.find("li.error").length){var e=t.data("default-error-message");if(e){var a=t.prev("ul.errors");a.length?a.html('<li class="error">'+e+"</li>"):t.before('<ul class="errors"><li class="error">'+e+"</li></ul>")}t.find(".submit-wrapper button").removeClass("inactive"),$("#loader-icon").remove()}else n=!0,t.submit()}))})),"undefined"!=typeof kep_14109){$(".js-refund-direct-link").on("click",(function(e){e.preventDefault();var t=$(this).parents(".js-refund"),a=t.find(".js-refund-direct-buttons"),n=t.find(".js-refund-direct-content");a.removeClass("active"),n.addClass("active")})),$(".js-refund-back").on("click",(function(e){e.preventDefault();var t=$(this).parents(".js-refund"),a=t.find(".js-refund-direct-buttons");t.find(".js-refund-direct-content").removeClass("active"),a.addClass("active")})),$(".js-form-partial-refund").on("submit",(function(e){e.preventDefault();var t=$(this),a=t.attr("data-itinerary-id"),n=t.attr("data-succsess-amend"),i=t.find("span.error"),o=t.parents(".js-refund"),s=o.find(".js-refund-direct-content"),r=o.find(".js-refund-options-content"),d=parseFloat(t.find('input[name="total-refunded-to-date"]').val()),l=t.find('select[name="total-refunded-to-date-currency"]').val(),c=o.find(".js-received-amount-currency-"+a+" option:selected").text().split(" ")[0];o.find(".js-refund-direct-amount").text(c+d),isNaN(d)||d<=0?i.text("please enter a valid amount").show():($.ajax({type:"POST",url:"/account/refund-amount-received",data:{itineraryId:a,currency:l,ammount:d},success:function(e){e.errorMessage}}),i.text("").hide(),void 0!==typeof n&&"true"==n?location.reload():(s.removeClass("active"),r.addClass("active")))})),$(".js-options-back").on("click",(function(e){e.preventDefault();var t=$(this),a=t.attr("data-succsess-amend"),n=t.parents(".js-refund"),i=n.find(".js-refund-direct-content"),o=n.find(".js-refund-options-content");void 0!==typeof a&&"true"==a&&i.find("form").attr({"data-succsess-amend":"true"}),o.removeClass("active"),i.addClass("active")}))}var i=function(){a=window.pageYOffset,document.body.style.width="100%",document.body.style.overflowY="scroll",document.body.style.position="fixed",document.body.style.top=-a+"px"},o=function(){document.body.style.removeProperty("position"),document.body.style.removeProperty("top"),document.body.style.removeProperty("width"),document.body.style.removeProperty("overflowY"),a=a||window.pageYOffset,window.scrollTo(0,a)};if("undefined"!=typeof kep_14170){var s=".js-modal-bank-details",r=".js-tint-overlay",d="#form_bank_details #person_id",l={show:function(e){$(e).show()},hide:function(e){$(e).hide()}};function c(e,t,a,n,o){$(e).find(a).val(n),$(e).addClass(o),$(t).first().addClass(o),i()}function u(e,t,a,n,i){$(e).find(a).val(""),$(e).removeClass(n),$(t+"."+n).removeClass(n),o()}$(".js-reload-page").on("click",(function(e){e.preventDefault(),location.reload()})),$(".js-bank-details-modal-open").on("click",(function(e){e.preventDefault();var t=$(this).attr("data-person-id");t.length>0&&c(s,r,d,t,"active")})),$(".js-bank-details-modal-close").on("click",(function(e){e.preventDefault(),u(s,r,d,"active"),$(this).parents(".js-modal-bank-details").find("form")[0].reset(),f.resetForm()})),$(".js-bank-details-select").on("change",(function(e){var t=$(this),a=t.val();t.removeClass("init--grey"),t.parents(".c-banner").find(".js-bank-details-multiple-submit").attr("data-person-id",a)})),$(".js-bank-details-multiple").validate({rules:{bank_details_person_id:{required:!0}},messages:{bank_details_person_id:"Please select a person"},errorElement:"span",errorClass:"error",submitHandler:function(e){var t=$(e).find(".js-bank-details-multiple-submit").attr("data-person-id");c(s,r,"#form_bank_details #person_id",t,"active")}});var f=$(".js-bank-details-main").validate({groups:{nameGroup:"account_sort_code_a account_sort_code_b account_sort_code_c"},rules:{account_name:{required:!0},account_number:{required:!0,number:!0,minlength:8,maxlength:8},account_sort_code_a:{required:!0,number:!0,minlength:2,maxlength:2},account_sort_code_b:{required:!0,number:!0,minlength:2,maxlength:2},account_sort_code_c:{required:!0,number:!0,minlength:2,maxlength:2}},messages:{account_name:"Please enter a name",account_number:"Please enter your 8 digit account number",account_sort_code_a:"Please enter your 6 digit sort code",account_sort_code_b:"Please enter your 6 digit sort code",account_sort_code_c:"Please enter your 6 digit sort code"},errorElement:"span",errorClass:"error",submitHandler:function(e){l.show(".js-modal-bank-details-loading"),$.ajax({type:"POST",url:"/account/updatePersonCardDetails/",data:{personId:$(e).find("#person_id").val(),accountName:$(e).find("#account_name").val(),accountNumber:$(e).find("#account_number").val(),sortCode:$(e).find("#account_sort_code_a").val()+$(e).find("#account_sort_code_b").val()+$(e).find("#account_sort_code_c").val()},success:function(t){null===t.errorMessage?(console.log("BANK DETAILS SUCCESS!"),l.hide(".js-modal-bank-details-loading"),$(".js-bank-details-start").fadeOut(100,(function(){$(".js-bank-details-thank-you-name").text($(e).find("#account_name").val()),$(".js-bank-details-thankyou").fadeIn(100,(function(){setTimeout((function(){u(s,r,d,"active"),location.reload()}),3e3)}))}))):(console.log(t.errorMessage),l.hide(".js-modal-bank-details-loading"),alert("There has been an issue with the details you submitted, please check and try again, or if the problem persists, please contact us."))},error:function(e,t){var a="";a=0===e.status?"Not connect.\n Verify Network.":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+e.responseText,console.log(a),l.hide(".js-modal-bank-details-loading"),u(s,r,d,"active"),alert("There has been an issue submitting your details, please try again, or if the problem persists, please contact us.")},complete:function(){console.log("AJAX COMPLETE!")}})}})}"undefined"!=typeof kep_14258&&!0===kep_14258&&$(".js-consumer-bookings-open-tab").on("click",(function(e){e.preventDefault();var t=$(this),a=t.parents("li"),n=t.parents(".side-panel-layout"),i=t.attr("data-target-tab"),o=a.find(".side-panel-layout."+i),s=a.find(".secondary-button.enabled"),r=a.find('.secondary-button[data-toggle="'+i+'"]');s.removeClass("enabled"),r.addClass("enabled"),n.hide(),o.show()}))})),"undefined"!=typeof ChangeBookingDatesKep9290Tes1944){var CHANGE_OF_DATES_COOKIE="change_of_dates",CHANGE_OF_DATES_INTERACTION_STEP_1="Tab Clicked",CHANGE_OF_DATES_INTERACTION_STEP_2="StartDate or Nights Clicked";if(void 0===setCookie||"function"!=typeof setCookie)function setCookie(e,t,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var i="expires="+n.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}if(void 0===getCookie||"function"!=typeof getCookie)function getCookie(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var i=a[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}}var validationRequest,errors;function swapClass(e,t,a){var n=e.find("."+t);n.removeClass(t),n.addClass(a)}function validateForm(e,t){if(!1!==t){validationRequest&&validationRequest.abort();var a=t;validationRequest=$.post("/utilities/validate_form",{form_class:e.data("form-class"),attributes:e.data("attributes"),values:e.serialize(),element_name:t},(function(t){for(var n in a?e.find('[name="'+a+'"]').next("ul.errors").empty():$("ul.errors").empty(),t){var i=e.find('[name="'+n+'"]'),o=i.next("ul.errors"),s=t[n];if(s.length)for(var r in o.length||(i.after('<ul class="errors">'),o=i.next("ul.errors")),s)o.append('<li class="error">'+s[r]+"</li>")}e.find("li.error").length||e.prev("ul.errors").empty()}),"json")}else validationRequest.abort()}function deleteGuest(e){var t=$(e).closest("tr").find(".data-id"),a=e;removePartySaved(),t.length?$.post("/account/partydetails",{itinerary:$(a).closest("form").find("input[name='itinerary']").val(),deleterow:t.val()},(function(){$(a).closest("form").find(".add-guest-1096").css({visibility:"visible"}),$(a).closest("tr").remove()})):($(a).closest("form").find(".add-guest-1096").css({visibility:"visible"}),$(a).closest("tr").remove())}function removePartySaved(){$(".party-saved").remove()}function paymentCountDown(){if($("#time-remaining").length&&$("#time-remaining").val().length)var e=new Date($("#time-remaining").val().replace(" ","T")).getTime()+72e5,t=setInterval((function(){var a=(new Date).getTime(),n=e-a,i=Math.floor(n%864e5/36e5),o=Math.floor(n%36e5/6e4),s=Math.floor(n%6e4/1e3);document.getElementById("time-left").innerHTML="Booking Expires in: "+i+"h "+o+"m "+s+"s ",n<0&&(clearInterval(t),document.getElementById("time-left").innerHTML="EXPIRED")}),1e3)}$(document).ready((function(){$('[name*="insurance-"]').each((function(){$(this).attr("checked",!1),$(this).attr("selected",!1)})),"undefined"!=typeof BookingComplete_ShowPaymentTimerKep13432&&paymentCountDown()})),$(".delete-guest").on("click",(function(e){e.preventDefault(),deleteGuest(this)})),$(".add-guest-1096").on("click",(function(e){e.preventDefault(),removePartySaved(),$(this).closest("form").find(".party-table-1096").append('<tr class="table-row"><td><select name="pd-title[]" class="title-select"><option value="Mr">Mr</option><option value="Mrs">Mrs</option><option value="Ms">Ms</option><option value="Miss">Miss</option><option value="Dr">Dr</option><option value="Rev">Rev</option><option value="Prof">Prof</option></select></td><td><input type="text" name="pd-first-name[]" class="fn-select"> </td><td><input type="text" name="pd-last-name[]" class="ln-select"></td><td><input type="number" name="pd-age[]" min="0" class="age-select"></td><td><button class="delete-guest"><img src="/static/images/experiments/TES1096/cross.svg"></button></td></tr>'),$(".delete-guest").on("click",(function(e){e.preventDefault(),deleteGuest(this)})),$(this).closest("form").find(".party-table-1096").find("tr.table-row").length>=$(this).closest(".party-details-1096").find(".maxpeople").val()&&$(this).css({visibility:"hidden"})})),$(".send-party-1096").on("click",(function(e){e.preventDefault();var t=$(this).closest("form.party-details-form-1096").children("table.party-table-1096").find("tr").toArray();t.shift();var a=$(this).closest("form.party-details-form-1096").serialize();removePartySaved(),$.post("/account/partydetails",a,(function(e){data=JSON.parse(e),console.log(e);var a=data.errors,n=[];Object.keys(a).forEach((function(e,t){0;var i=a[e],o=parseInt(e.charAt(5));n.push(o);var s=$($(this).closest("form").find(".party-table-1096").find("tr.table-row")[o]);i.age?s.find(".age-select").addClass("error"):s.find(".age-select").removeClass("error"),i.lastname?s.find(".ln-select").addClass("error"):s.find(".ln-select").removeClass("error"),i.firstname?s.find(".fn-select").addClass("error"):s.find(".fn-select").removeClass("error"),i.title?s.find(".title-select").addClass("error"):s.find(".title-select").removeClass("error")}));var i=data.rows,o=0;t.forEach((function(e,t){var a=i[o],s=$(e).find(".data-id");-1==n.indexOf(t)&&(s.length>0?$(e).find(".data-id").val():($(e).append('<input type="hidden" name="pd-dataID[]" class="data-id" value="">'),$(e).find(".data-id").val(a),o++))}))})),$(this).siblings(".party-table-1096").after('<div class="party-saved">Party details saved.</div>')}));