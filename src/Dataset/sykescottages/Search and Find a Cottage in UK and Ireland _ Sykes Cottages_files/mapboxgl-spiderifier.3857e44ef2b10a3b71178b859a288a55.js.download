!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("mapbox-gl")):"function"==typeof define&&define.amd?define(["MapboxglSpiderifier"],n):e.MapboxglSpiderifier=n(e.mapboxgl)}(this,(function(e){function n(n,t){var i={each:s,map:function(e,n){var t=[];return s(e,(function(e,i){t.push(n(e,i))})),t},mapTimes:function(e,n){var t=[];return m(e,(function(e){t.push(n(e))})),t},eachTimes:m},a=function(){},r={animate:!1,animationSpeed:0,customPin:!1,initializeLeg:a,onClick:a,circleSpiralSwitchover:9,circleFootSeparation:25,spiralFootSeparation:28,spiralLengthStart:15,spiralLengthFactor:4},o=2*Math.PI,c=[];for(var l in t)r[l]=t[l];function p(){i.each(c.reverse(),(function(e,n){r.animate?(e.elements.container.style.transitionDelay=r.animationSpeed/1e3/c.length*n+"s",e.elements.container.className+=" exit",setTimeout((function(){e.mapboxMarker.remove()}),r.animationSpeed+100)):e.mapboxMarker.remove()})),c=[]}function s(e,n){var t=0;if(!e||!e.length)return[];for(t=0;t<e.length;t++)n(e[t],t)}function m(e,n){if(!e)return[];for(var t=0;t<e;t++)n(t)}this.spiderfy=function(t,a){var l,s=(m=a.length,m>=r.circleSpiralSwitchover?function(e){var n=r.spiralLengthStart,t=0;return i.mapTimes(e,(function(e){var i;return t+=r.spiralFootSeparation/n+5e-4*e,i={x:n*Math.cos(t),y:n*Math.sin(t),angle:t,legLength:n,index:e},n+=o*r.spiralLengthFactor/t,i}))}(m):function(e){var n=r.circleFootSeparation*(2+e)/o,t=o/e;return i.mapTimes(e,(function(e){var i=e*t;return{x:n*Math.cos(i),y:n*Math.sin(i),angle:i,legLength:n,index:e}}))}(m));var m;p(),l=i.map(a,(function(n,i){var a,o,c=s[i],l=function(e){var n=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div");return n.className="spider-leg-container"+(r.animate?" animate initial ":" "),i.className="spider-leg-line",t.className="spider-leg-pin"+(r.customPin?"":" default-spider-pin"),n.appendChild(i),n.appendChild(t),n.style["margin-left"]=e.x+"px",n.style["margin-top"]=e.y+"px",i.style.height=e.legLength+"px",i.style.transform="rotate("+(e.angle-Math.PI/2)+"rad)",{container:n,line:i,pin:t}}(c);return a=new e.Marker(l.container).setLngLat(t),o={feature:n,elements:l,mapboxMarker:a,param:c},r.initializeLeg(o),l.container.onclick=function(e){r.onClick(e,o)},o})),i.each(l.reverse(),(function(e){e.mapboxMarker.addTo(n)})),r.animate&&setTimeout((function(){i.each(l.reverse(),(function(e,n){e.elements.container.className=(e.elements.container.className||"").replace("initial",""),e.elements.container.style.transitionDelay=r.animationSpeed/1e3/l.length*n+"s"}))}));c=l},this.unspiderfy=p,this.each=function(e){i.each(c,e)}}function t(e,n,t){return[e[0]+(n||0),e[1]+(t||0)]}return n.popupOffsetForSpiderLeg=function(e,n){var i=e.param.x,a=e.param.y;return{top:t([0,n=n||0],i,a),"top-left":t([n,n],i,a),"top-right":t([-n,n],i,a),bottom:t([0,-n],i,a),"bottom-left":t([n,-n],i,a),"bottom-right":t([-n,-n],i,a),left:t([n,-n],i,a),right:t([-n,-n],i,a)}},n}));