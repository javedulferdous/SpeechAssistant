"use strict";define(["app","$window","$console","accordionWidget","accessibleModalHelper","accessibilityFocusHelper"],function(e,t,r,c,i,n){return function(){var s=900,o="responsiveFacets_noScroll",a="responsiveFacets_container-transitioned",l=3e3,u=":",d=".responsiveFacets_sectionItemCheckbox",p=".responsiveFacets_sectionHead",f=".responsiveFacets_sectionHead-mobile",b=".responsiveFacets_sectionContainer",v=".responsiveFacets_sectionItemLabel",h=".responsiveFacets_sectionItem",m=".responsiveFacets_sectionClear",F=".responsiveFacets_sectionTitle",k=".responsiveFacets_selection",g=".responsiveFacets_clearAll",A=".responsiveFacets_refine",S=".responsiveFacets_container",y=".responsiveFacets_saveContainer",C=".responsiveFacets_save",E=".responsiveFacets_sectionBackArrow",w=".responsiveFacets_menuClose",T=".responsiveFacets_error",_="#responsive-facets-title",x=".responsiveFacets_mobileSectionTitle",L="button, a",q='button:not(.responsiveFacets_sectionHead), input[type="checkbox"]',P=".responsiveFacets_sectionContent",H=".responsiveFacets_goToProductSectionButton",I="#responsive-product-list-title",M="[data-component=priceFacet]",O=".responsiveFacets_priceErrorMessageWrapper",R=".responsiveFacets_selectionContainer",W=".priceFacetSectionCount",U=".responsiveFacets_priceErrorIcon",D="[data-product-list-wrapper]",N={key:"data-facet-key",value:"data-facet-value",show:"data-show",closed:"data-closed",selected:"data-selected",ariaHidden:"aria-hidden",fieldName:"data-field-name",selectedValue:"data-selected-value",priceFacet:"data-price-facet",childOpen:"data-child-open",selectedFacet:"data-selected-facet",mobileFacetSelected:"mobile-facet-selected",selectionOrAllCleared:"selection-all-cleared",sectionCleared:"section-cleared"},j="responsive-facets-title",B={update:"responsiveProductListPage/update",priceFacet:"responsiveFacets/priceFacet",responsiveFacetsError:"responsiveProducts/responsiveFacets",priceRange:"priceFacet/mobileRange",priceReset:"priceFacet/mobileReset",restorePreviousSelections:"responsiveFacets/prevSelections"},z={isOpen:true,selectors:{title:".responsiveFacets_sectionHead",content:".responsiveFacets_sectionContent",focusableElements:'input[type="checkbox"]'},offset:1,tracking:{enabled:true,channel:"responsiveFacets"}},V=".fastTrack_onListPage",Y=".responsiveFacets_sectionItem_fastTrack",$="fastTrackCheckbox",K="fastTrackFacetCategory",G="fastDeliverableCountries",J={items:[],sectionContainers:[],container:null,refine:null,save:null,checkboxes:[],sectionHeads:[],sectionTitles:[],selections:[],clearAll:null,backArrows:[],menuCloses:[],error:null},Q={show:false,section:-1},X={element:null,changes:false,facets:[],_elems:J,_mobile:Q,_attr:N,_channels:B,_noScroll:o,_breakpoint:900},Z=void 0;return"function"==typeof Event?Z=new Event("change"):(Z=document.createEvent("Event")).initEvent("change",false,false),X.init=function(e){if(X.element=e,X.changes=false,J.priceFacet=X.element.querySelector(M),J.fastTrackSwitch=document.querySelector(V),J.sectionItemContainers=e.querySelectorAll(v),J.items=e.querySelectorAll(h),J.container=e.querySelector(S),J.refine=e.querySelector(A),J.saveContainer=e.querySelector(y),J.save=e.querySelector(C),J.sectionContainers=e.querySelectorAll(b),J.checkboxes=e.querySelectorAll(d),J.sectionHeads=e.querySelectorAll(f),J.sectionTitles=e.querySelectorAll(F),J.selections=e.querySelectorAll(k),J.clearAll=e.querySelector(g),J.backArrows=e.querySelectorAll(E),J.menuCloses=e.querySelectorAll(w),J.error=e.querySelector(T),J.mobileRefineTitle=e.querySelector(_),J.productTitle=document.querySelector(I),J.goToProductSectionButtons=document.querySelectorAll(H),J.priceFacetErrorMessages=X.element.querySelectorAll(O),J.selectionContainer=X.element.querySelector(R),J.priceFacetSectionCount=X.element.querySelector(W),J.priceErrorIcon=X.element.querySelector(U),J.wrapper=document.querySelector(D),J.priceFacet&&(J.priceFacetFieldName=J.priceFacet.getAttribute(N.fieldName),J.priceFacetIndex=Array.from(J.sectionContainers).findIndex(function(e){return e.hasAttribute(N.priceFacet)})),!J.container)return;J.allInteractiveElements=J.container.querySelectorAll(L),X.subscribe(),X.build(),X.bind(),X.activate(),Q.show?X.open():X.close();var t=J.wrapper.getAttribute(N.selectedFacet),r;if(t){var c=Array.from(J.checkboxes).find(function(e){return e.getAttribute(N.value)===t});c&&c.focus(),J.wrapper.removeAttribute(N.selectedFacet)}J.wrapper.getAttribute(N.mobileFacetSelected)&&(J.refine.focus(),J.wrapper.removeAttribute(N.mobileFacetSelected)),J.wrapper.getAttribute(N.selectionOrAllCleared)&&(n.focus(J.container),J.wrapper.removeAttribute(N.selectionOrAllCleared));var i=J.wrapper.getAttribute(N.sectionCleared);i&&(n.focus(J.sectionContainers[parseInt(i)]),J.wrapper.removeAttribute(N.sectionCleared)),J.sectionContainers.forEach(function(e){return e.addEventListener("keydown",function(t){if("Esc"===t.key||"Escape"===t.key){var r=e.querySelector(p);if(!r)return;if(r.disabled){var c=e.querySelector(m);c&&c.focus()}else r.focus()}})})},X.subscribe=function(){e.clear(B.priceFacet),e.clear(B.responsiveFacetsError),e.clear(B.restorePreviousSelections),e.subscribe(B.priceFacet,X.updateWithPriceChanges),e.subscribe(B.responsiveFacetsError,X.emptyResults),e.subscribe(B.restorePreviousSelections,X.restorePreviousSelections)},X.emptyResults=function(){Q.show=true,X.togglePriceFacetErrorState(),e.publish(B.priceRange)},X.restorePreviousSelections=function(e){X.changes=false,X.facets=X.facets.filter(function(t){return t.split(":")[0]!==e[0].split(":")[0]}).concat(e)},X.build=function(){X.facets=Array.from(J.sectionItemContainers).map(function(e){var t=e.querySelector(d),r=e.querySelector(h),c,i;if(!t.checked)return null;return r.getAttribute(N.key)+":"+r.getAttribute(N.value)}).filter(function(e){return null!==e}),J.sectionContainers.forEach(function(e,t){if("true"===e.getAttribute(N.selected))return;var r=J.sectionTitles[t].innerText,i=Object.assign({},z);i.tracking=Object.assign({},i.tracking),i.tracking.extra=r,e.componentObject=(new c).init(e,i)}),J.priceFacet&&X.appendPriceFacetFilters()},X.appendPriceFacetFilters=function(){if("true"===J.priceFacet.getAttribute(N.selected)){var e=J.priceFacet.getAttribute(N.fieldName),t=J.priceFacet.getAttribute(N.selectedValue);X.facets.push(e+":"+t)}},X.updateWithPriceChanges=function(e,t,r){X.facets=X.facets.filter(function(t){return e[0].split(":")[0]!==t.split(":")[0]}),r?X.changes=t:(X.changes=true,X.facets=X.facets.concat(e))},X.bind=function(){var e=this;J.checkboxes.forEach(function(t,r){return t.addEventListener("change",X.facetClick.bind(e,r))}),J.sectionHeads.forEach(function(t,r){return t.addEventListener("click",X.openSection.bind(e,r))}),J.selections.forEach(function(e){return e.addEventListener("click",X.clearSelectionListener)}),J.backArrows.forEach(function(e){return e.addEventListener("click",X.back)}),J.menuCloses.forEach(function(e){return e.addEventListener("click",X.close)}),J.fastTrackSwitch&&J.fastTrackSwitch.addEventListener("change",X.fastTrackSwitchChange),J.clearAll&&J.clearAll.addEventListener("click",X.clearAll),t.addEventListener("resize",X.resize),J.save.addEventListener("click",X.save),J.refine.addEventListener("click",X.open),J.goToProductSectionButtons.forEach(function(e){return e.addEventListener("click",X.skipToProductSection)}),J.sectionContainers.forEach(function(e,t){var r=e.querySelector(m);r&&(r._index=t,r.addEventListener("click",X.clearSectionListener))})},X.activate=function(){t.setImmediate(function(){J.container.classList.add(a)})},X.open=function(r){J.container.setAttribute("role","dialog"),J.container.setAttribute("aria-labelledby",j),t.document.body.classList.add(o),J.container.setAttribute(N.show,"true"),J.sectionContainers.forEach(function(e){return e.setAttribute(N.closed,"true")}),X.accessibleModalHelper=new i(J.container,X.close,J.mobileRefineTitle),r&&e.publish("tracking/record","responsiveFacets","open","mobile facets"),Q.show=true},X.close=function(r){r&&X.priceFacetErrorDisplayed()&&(e.publish(B.priceReset),X.togglePriceFacetErrorState(),Q.section=J.priceFacetIndex),J.container.removeAttribute("role"),J.container.removeAttribute("aria-labelledby"),n.enableElements(J.allInteractiveElements),t.document.body.classList.remove(o),J.container.setAttribute(N.show,"false"),J.container.setAttribute(N.childOpen,"false"),J.sectionContainers.forEach(function(e){return e.setAttribute(N.closed,"false")}),t.document.documentElement.clientWidth<900&&(e.publish("tracking/record","responsiveFacets","close","mobile facets"),r&&J.refine.focus()),X.changes=0,-1!==Q.section&&J.sectionContainers[Q.section].setAttribute(N.show,"false"),Q.show=false,X.accessibleModalHelper&&(X.accessibleModalHelper.close(),delete X.accessibleModalHelper)},X.save=function(){X.changes?(Q.section=-1,Q.show=false,J.wrapper.setAttribute(N.mobileFacetSelected,"true"),X.update(true)):(X.close(X.priceFacetErrorDisplayed()),J.refine.focus())},X.priceFacetErrorDisplayed=function(){return Array.from(J.priceFacetErrorMessages).filter(function(e){return!e.classList.contains("hide")})[0]},X.clearAll=function(){X.checkAndUpdateFastTrackCookie(),X.facets=[],X.changes=true,e.publish("tracking/record","responsiveFacets","remove","all facets"),t.document.documentElement.clientWidth>900&&J.wrapper.setAttribute(N.selectionOrAllCleared,"true"),X.update(true)},X.togglePriceFacetErrorState=function(){J.priceFacetErrorMessages&&Array.from(J.priceFacetErrorMessages).forEach(function(e){return e.classList.toggle("hide")});var e=Array.from(J.selections).filter(function(e){return e.getAttribute(N.key)===J.priceFacetFieldName})[0];e&&(e.classList.toggle("hide"),1===J.selections.length&&J.selectionContainer.classList.toggle("hide")),J.priceFacetSectionCount&&J.priceFacetSectionCount.classList.toggle("hide"),J.priceErrorIcon&&J.priceErrorIcon.classList.toggle("hide")},X.back=function(){X.indexUpdated=false;var t=Q.section;-1===t&&(e.publish(B.priceReset),X.indexUpdated=true,t=J.priceFacetIndex,X.togglePriceFacetErrorState());var r=J.sectionTitles[t].innerText;e.publish("tracking/record","responsiveFacets","close","mobile facets section",r);var c=J.sectionContainers[t];c.setAttribute(N.show,"false"),J.container.setAttribute(N.childOpen,"false"),c.addEventListener("transitionend",function e(){c.setAttribute(N.closed,"true"),X.accessibleModalHelper&&X.accessibleModalHelper.reload(J.container,J.mobileRefineTitle),c.removeEventListener("transitionend",e)}),Q.section=-1,X.indexUpdated&&!X.changes||X.update(true)},X.openSection=function(t){var r=J.sectionTitles[t].innerText;e.publish("tracking/record","responsiveFacets","open","mobile facets section",r),-1!==Q.section&&(J.sectionContainers[Q.section].setAttribute(N.show,"false"),J.sectionContainers[Q.section].setAttribute(N.closed,"true")),J.sectionTitles[t].setAttribute("aria-expanded","true"),J.sectionContainers[t].setAttribute(N.show,"true"),J.sectionContainers[t].setAttribute(N.closed,"false"),J.container.addEventListener("transitionend",function e(){J.container.setAttribute(N.childOpen,"true"),X.accessibleModalHelper&&X.accessibleModalHelper.reload(J.container,J.sectionContainers[t].querySelector(x)),J.container.removeEventListener("transitionend",e)}),J.priceFacetIndex===t&&X.priceFacetErrorDisplayed()?Q.section=-1:Q.section=t},X.resize=function(){X.update()},X.facetClick=function(r){X.checkAndUpdateFastTrackCookie(r,null);var c=J.items[r],i,n,s=c.getAttribute(N.key)+":"+c.getAttribute(N.value);e.publish("tracking/record","responsiveFacets","add",s),J.checkboxes[r].checked?X.facets.push(s):X.facets=X.facets.filter(function(e){return e!==s}),X.changes=true,c.classList.contains("fastTrack")?X.update(true):X.update(),t.document.documentElement.clientWidth<900?J.wrapper.setAttribute(N.mobileFacetSelected,"true"):J.wrapper.setAttribute(N.selectedFacet,c.getAttribute(N.value))},X.facetKeyboardPress=function(e,t){if(" "===t.key){t.preventDefault();var r=J.checkboxes[e];r.checked=!r.checked,r.dispatchEvent(Z)}},X.clearSectionListener=function(c){var i=c.currentTarget._index;if(!J.sectionContainers[i])return r.error("Cannot clear non-existing section at index "+i+"."),void 0;X.checkAndUpdateFastTrackCookie(null,i);var n=J.sectionTitles[i].innerText;e.publish("tracking/record","responsiveFacets","remove","facet group",n);var s=J.sectionContainers[i];if(s.hasAttribute(N.priceFacet))X.facets=X.facets.filter(function(e){return e.split(":")[0]!==J.priceFacet.getAttribute(N.fieldName)});else{var o=s.querySelectorAll(h),a=Array.from(o).map(function(e){var t,r;return e.getAttribute(N.key)+":"+e.getAttribute(N.value)});X.facets=X.facets.filter(function(e){return!a.includes(e)})}X.changes=true,t.document.documentElement.clientWidth>900&&J.wrapper.setAttribute(N.sectionCleared,i.toString()),X.update(true)},X.clearSelectionListener=function(r){var c=r.currentTarget,i=c.getAttribute(N.key),n=c.getAttribute(N.value),s=i+":"+n;c.hasAttribute(N.priceFacet)?X.facets=X.facets.filter(function(e){return e.split(":")[0]!==i}):X.facets=X.facets.filter(function(e){return e!==s}),e.publish("tracking/record","responsiveFacets","remove",s),s&&s.includes(G)&&X.setCookie("fastTrackSwitchCookie","disableSwitch"),X.changes=true,t.document.documentElement.clientWidth>900&&J.wrapper.setAttribute(N.selectionOrAllCleared,"true"),X.update(true)},X.update=function(r){if(!r&&t.document.documentElement.clientWidth<900)return;t.document.documentElement.clientWidth>900&&Q.show&&X.close(),X.changes&&(e.publish(B.update,{facetFilters:X.facets.join("|")}),J.error.setAttribute(N.show,"false"))},X.error=function(){J.error.setAttribute(N.show,"true"),J.error.removeAttribute(N.ariaHidden),J.error.style.bottom=J.saveContainer.offsetHeight+"px",t.setTimeout(function(){J.error.setAttribute(N.show,"false"),J.error.setAttribute(N.ariaHidden,"true")},3e3),e.publish("tracking/record","responsiveFacets","error","new page load")},X.fastTrackSwitchChange=function(){var e=parseInt(J.fastTrackSwitch.getAttribute("data-index")),t=J.fastTrackSwitch.getAttribute("data-switch-enabled");J.checkboxes[e].checked="false"===t,X.facetClick(e)},X.checkAndUpdateFastTrackCookie=function(e,t){var r=0,c=false,i=true,n=false,s=void 0;try{for(var o=J.checkboxes[Symbol.iterator](),a;!(i=(a=o.next()).done);i=true){var l;if(a.value.classList.contains($)){c=true;break}r++}}catch(e){n=true,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}if(c)if(null!==e&&e===r)X.setCookie("fastTrackSwitchCookie",J.checkboxes[r].checked?"enableSwitch":"disableSwitch");else if(t){var u=0,d=true,p=false,f=void 0;try{for(var b=J.sectionContainers[Symbol.iterator](),v;!(d=(v=b.next()).done);d=true){var h;if(v.value.classList.contains(K))break;u++}}catch(e){p=true,f=e}finally{try{!d&&b.return&&b.return()}finally{if(p)throw f}}u===t&&X.setCookie("fastTrackSwitchCookie","disableSwitch")}else J.checkboxes[r].checked&&X.setCookie("fastTrackSwitchCookie","disableSwitch")},X.setCookie=function(e,t){var r="/",c=new Date;c.setFullYear(c.getFullYear()+1),document.cookie=e+"="+t+"; expires="+c.toUTCString()+"; path=/"},X.skipToProductSection=function(){J.productTitle&&n.focusAndScroll(J.productTitle)},X}});
//# sourceMappingURL=responsiveFacets-ef8a474a54.js.map
