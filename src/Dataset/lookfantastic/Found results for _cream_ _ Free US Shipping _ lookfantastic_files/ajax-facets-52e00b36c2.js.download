"use strict";define(["app","siteObj","urlBuilder","module"],function(e,t){var a=t.ajaxFacetsAPI,r=document.querySelector(".js-widgets-wrapper"),l=null;r&&(l=document.querySelector(".js-widgets-container"))&&(l.innerHTML=r.innerHTML,r.innerHTML=""),(r=document.querySelector(".leftRailSlot1Wrapper"))&&(l=document.querySelector(".leftRailSlot1Container"))&&(l.innerHTML=r.innerHTML,r.innerHTML="");var c={_init:function t(){c._bindEvents(),e.publish("url/updateIdentifiers","","","","|"),e.urlReader.constructor={variableQuery:"?",categoryValueSeparator:"=",categorySeparator:"&",segmentSeparator:"|"},c._requestChange=false,e.subscribe("url/change",function(e,t){if(document.querySelector(".responsiveProductListPage"))return;if(c._requestChange||"pop"===e)return c._requestFacets(t),void 0;c._requestChange=true}),e.subscribe("facets/updatePage",c._updatePageCallback),e.subscribe("facets/removeCurrentPage",function(e){c._dynamicPathUpdate=e}),e.publish("url/init")},_updatePageCallback:function e(t,a,r,l){l&&(c._clearPageNumber=true),c._requestChange=false,c._updatePage(t,a,r,"")},_clearPageNumber:false,_requestChange:false,_dynamicPathUpdate:"",_searchKey:"search",_apiKey:"facetFilters",_pageNumberKey:"pageNumber",_sortOrderKey:"sortOrder",_cachedFacet:{},_cachedPath:window.location.href,_productListStringTemplate:document.querySelector("[data-productlist]")?document.querySelector("[data-productlist]").getAttribute("data-productlist-st"):null,_bindEvents:function t(){var a,r;e.select(".js-facets-wrapper").on("click",c._facetWrapperClick),e.select(".js-facets-loading-overlay").on("click",c._modalClick)},_requestFacets:function t(r){var l="";r.indexOf(e.urlReader.decoupler.variableQuery)>-1&&(l=r.split(e.urlReader.decoupler.variableQuery)[1]).indexOf("pageNumber")>-1?c._updatePaginationCache(l):e.publish("pageControls/updateCache","1"),c._getData(a+e.urlReader.constructor.variableQuery+l)},_updatePaginationCache:function t(a){var r=[];r=a.indexOf(e.urlReader.decoupler.categorySeparator)?a.split(e.urlReader.decoupler.categorySeparator):a;for(var l=0;l<r.length;l++){var c=r[l];c.indexOf("pageNumber=")>-1&&e.publish("pageControls/updateCache",c.split("pageNumber=")[1])}},_facetSelectors:{checkbox:"js-facet-checkbox",clearSelected:"js-facet-clear-filter",clearSet:"js-facet-clear",collapse:"js-facets-collapse",openedListPanel:"facets_collapse-open",closedListPanel:"facets_collapse-closed",facetList:"[data-list]",closedListPanelList:"facets_listPanelList-closed",noProducts_old:"zero-products",noProducts_new:"facets_noProducts",showLoadingOverlay_old:"show",showLoadingOverlay_new:"facets_loadingOverlay-show"},_facetWrapperClick:function t(a){var r=(a=a||window.event).target||a.srcElement;if(!r)return;c._requestChange=false,"I"!==r.nodeName||e.element.hasClass(c._facetSelectors.collapse,r)||(r=r.parentNode),c._filterClickableElements(r)},_filterClickableElements:function t(a){if(e.element.hasClass("js-facet",a)||e.element.hasClass(c._facetSelectors.checkbox,a)){if("INPUT"===a.nodeName)return c._facetClick(a,a.value),void 0;"A"===a.nodeName&&(c._facetClick(a,e.element.getAttribute("data-facet-value",a)),event.preventDefault?event.preventDefault():event.returnValue=false)}if(e.element.hasClass(c._facetSelectors.clearSelected,a)&&(c._facetClick(a,e.element.getAttribute("data-facet-value",a)),event.preventDefault?event.preventDefault():event.returnValue=false),"A"===a.nodeName&&e.element.hasClass(c._facetSelectors.clearSet,a)&&(c._clearFacets(a),event.preventDefault?event.preventDefault():event.returnValue=false),e.element.hasClass(c._facetSelectors.clearSet,a)&&(c._clearFacets(a),event.preventDefault?event.preventDefault():event.returnValue=false),"I"===a.nodeName&&e.element.hasClass(c._facetSelectors.collapse,a)){var r,l="[data-list="+e.element.getAttribute("data-open-list",a)+"]",n=document.querySelector(l);c._facetListCollapse(a.parentNode,n),event.preventDefault?event.preventDefault():event.returnValue=false}},_facetClick:function t(a,r){c._cachedFacet=a,c._cachedPath=window.location.href;var l="remove";a.checked&&(l="add"),e.publish("pageControls/removeCurrentPage");var n=[l,r,c._apiKey];c._dynamicPathUpdate&&n.push(c._dynamicPathUpdate),c._updatePage.apply(this,n),c._tracking(a),c._dynamicPathUpdate=""},_facetListCollapse:function t(a,r){e.element.hasClass(c._facetSelectors.openedListPanel,a)?(e.element.removeClass(c._facetSelectors.openedListPanel,a),e.element.addClass(c._facetSelectors.closedListPanel,a),e.element.addClass(c._facetSelectors.closedListPanelList,r)):(e.element.removeClass(c._facetSelectors.closedListPanel,a),e.element.addClass(c._facetSelectors.openedListPanel,a),e.element.removeClass(c._facetSelectors.closedListPanelList,r))},_clearFacets:function t(r){var l=e.element.getAttribute("data-facet-target",r),n={api:{url:window.location.href}},o=document.querySelector(l);o&&(o=o.querySelectorAll(".js-facet, ."+c._facetSelectors.checkbox)),e.publish("pageControls/removeCurrentPage"),c._dynamicPathUpdate&&(n.api.url=c._dynamicPathUpdate);for(var s=0,i=o.length;s<i;s++){var u=o[s];u.checked&&(n=e.urlReader.deconstructGet("remove",u.value,c._apiKey,n.api.url))}var p=n.api.url,d="?";(p.indexOf(c._apiKey)>-1||p.indexOf(c._sortOrderKey)>-1||p.indexOf(c._pageNumberKey)>-1||p.indexOf(c._searchKey)>-1)&&(d="&");var _=c._productListStringTemplate?d+"productListStringTemplate="+c._productListStringTemplate:"";c._getData(a+n.api.urlVariables+_),e.publish("url/updatePath",n.window.url),c._dynamicPathUpdate=""},_updatePage:function t(r,l,n,o){var s=e.urlReader.deconstructGet(r,l,n,o),i=s.window.url,u="?";(i.indexOf(c._apiKey)>-1||i.indexOf(c._sortOrderKey)>-1||i.indexOf(c._pageNumberKey)>-1||i.indexOf(c._searchKey)>-1)&&(u="&");var p=c._productListStringTemplate?u+"productListStringTemplate="+c._productListStringTemplate:"",d=a+s.api.urlVariables+p;if(c._clearPageNumber&&(d=c._removePageNumberFromUrl(d),i=c._removePageNumberFromUrl(i)),!document.querySelector(c._facetSelectors.checkbox+"[checked]")){var _=new RegExp("[?&]$");i=i.replace(_,"")}c._getData(d),e.publish("url/updatePath",i)},_componentWrappers:{facetsWrapper:document.querySelector(".js-facets-wrapper"),productWrapper:document.querySelector('[data-component="productsLoader"]'),loader:document.querySelector(".js-facets-loading-overlay"),mainWrapper:document.querySelector('[data-component="ajaxFacets"]'),searchContentWrapper:document.querySelector(".js-search-content"),listTitleWrapper:document.querySelector(".js-listTitle-wrapper"),listTitleElement:document.querySelector("[data-list-page-title]")},_loading:function t(a){e.element.scrollTo(c._componentWrappers.mainWrapper,250),a&&e.element.addClass([c._facetSelectors.showLoadingOverlay_old,c._facetSelectors.showLoadingOverlay_new],c._componentWrappers.loader)},_getData:function t(a){var r=true;e.ajax.get({url:a,dataType:"JSON",error:c._error,success:function t(a){var l;c._decoupleResponse(a)&&e.element.removeClass([c._facetSelectors.showLoadingOverlay_old,c._facetSelectors.showLoadingOverlay_new],c._componentWrappers.loader),r=false,e.publish("ajaxSuccess/quickView"),e.publish("productQuickbuy/reinitialise"),e.publish("addedToBasketModal/reinitialise")}}),c._loading(r),c._clearPageNumber=false},_error:function t(a,r,l){e.element.addClass([c._facetSelectors.showLoadingOverlay_old,c._facetSelectors.showLoadingOverlay_new],c._componentWrappers.loader);try{l?console.warn(a,r,l):console.warn(a,a.message,"getData")}catch(e){console.log(e.message,e)}},_decoupleResponse:function t(a){var r=e.element.hasClass("js-facet-uncheck",c._componentWrappers.loader);if(!a.productList){if(!r)return e.element.addClass([c._facetSelectors.noProducts_old,c._facetSelectors.noProducts_new],c._componentWrappers.loader),c._error("Could not render facets","No products found","decoupleResponse"),false;return e.element.removeClass([c._facetSelectors.showLoadingOverlay_old,c._facetSelectors.showLoadingOverlay_new],c._componentWrappers.loader),void 0}return e.publish("products/update",a.productList,c._componentWrappers.productWrapper),null!==c._componentWrappers.listTitleWrapper&&e.publish("products/updateListTitle",a.listTitle,c._componentWrappers.listTitleWrapper),r&&e.element.removeClass("js-facet-uncheck",c._componentWrappers.loader),c._componentWrappers.searchContentWrapper&&(c._componentWrappers.searchContentWrapper.innerHTML=""),a.facetSetList&&c._componentWrappers.facetsWrapper&&(c._componentWrappers.facetsWrapper.innerHTML=a.facetSetList),a.pagination&&e.publish("pageControls/update",a.pagination),true},_modalClick:function t(a){var r=(a=a||window.event).target||a.srcElement;if(!r)return;"BUTTON"===r.nodeName&&e.element.hasClass("js-close",r)&&c._closeModal()},_closeModal:function t(){e.element.removeClass([c._facetSelectors.noProducts_old,c._facetSelectors.noProducts_new,c._facetSelectors.showLoadingOverlay_old,c._facetSelectors.showLoadingOverlay_new],c._componentWrappers.loader),e.element.isDomElement(c._cachedFacet)&&(c._cachedFacet.checked=!c._cachedFacet.checked),e.publish("url/updatePath",c._cachedPath)},_tracking:function t(a){var r=e.element.getAttribute("data-list-page-title",c._componentWrappers.listTitleElement),l=e.element.getAttribute("data-facet-category",a);null!==r&&null!==l&&e.publish("tracking/record","Facets","click through",r+" - "+l+" - "+decodeURIComponent(a.value))},_removePageNumberFromUrl:function e(t){if(-1===t.indexOf(c._pageNumberKey))return t;var a=new RegExp("("+c._pageNumberKey+"=[0-9^&]+)");return t.replace(a,"")}};return c._init(),c});
//# sourceMappingURL=ajax-facets-52e00b36c2.js.map
