"use strict";define(["app","productSingleImage","productPrice","productTags","productVariations","productQuantityInput","productAddToBasket","productAddToBasketButton","productStockInformation","productViewMoreInformation","subscriptionComponent","productName","accessibleModalHelper","fastTrackSwitch","siteObj","subscribeAndSave","subscribeAndSaveContracts","subscribeAndSaveProductInBasket"],function(e,t,o,r,n,c,i,a,u,d,s,l,p,m,b,g,y,f){var h=false,k={init:function e(){}},w=function h(){var k={},w={selectors:{loading:"[data-loading]",error:"[data-error]",openTrigger:"[data-open-product-quickbuy]",closeModalButton:"[data-close]",gallery:"[data-gallery]"},classes:{showLoading:"productQuickbuy_loading-show",showError:"productQuickbuy_error-show",showQuickbuy:"productQuickbuy-show"},subscribedChannelsToClear:{image:"productSingleImage/newImage",price:"productPrice/newPrice",tags:"productTags/new",stock:"productStockInformation/newStockInformation",addToBasketButton:"productAddToBasketButton/newButton",information:"productViewMoreInformation/newUrl",productName:"productName/update",fastTrack:"fastTrackSwitch/stateChange",subscribeAndSaveContracts:"subscribeAndSaveContracts/update"},productAttribute:"[data-child-id]",productSku:"data-child-id",productBlockSku:"data-sku",recommendationContext:"data-context",recommendationParentAttribute:"[data-component=productRecommendations]",fromWishlist:"data-from-wishlist",showSubscribeAndSave:"data-subscribe-and-save"},v=function e(t,o){return k.element=t,k.loading=k.element.querySelector(k.config.selectors.loading),k.error=k.element.querySelector(k.config.selectors.error),k.closeModalButton=k.element.querySelector(k.config.selectors.closeModalButton),k.gallery=document.querySelector(k.config.selectors.gallery),k.isProductPage="product"===b.type,k.element.querySelector(k.config.productAttribute)&&(k.productId=k.element.querySelector(k.config.productAttribute).getAttribute(k.config.productSku)),o||k.subscribe(),k.context=k.getRecommendationContext(),k.bindOpenTrigger(),k.bindCloseTrigger(),k},S=function t(){e.subscribe("productQuickbuy/startLoading",k.startLoading),e.subscribe("productQuickbuy/stopLoading",k.stopLoading),e.subscribe("productQuickbuy/showError",k.showError),e.subscribe("productQuickbuy/hideError",k.hideError),e.subscribe("productQuickbuy/hideModal",k.hideModal),e.subscribe("productQuickbuy/reinitialise",k.reinitialiseComponent)},M=function e(){k.openTriggers=document.querySelectorAll(k.config.selectors.openTrigger);for(var t=0,o=k.openTriggers.length;t<o;t++)k.openTriggers[t].removeEventListener("click",k.loadModal),k.openTriggers[t].addEventListener("click",k.loadModal);k.closeModalButton&&(k.closeModalButton.removeEventListener("click",k.hideModal),k.closeModalButton.addEventListener("click",k.hideModal))},q=function e(){k.closeModalButton&&(k.closeModalButton.removeEventListener("click",k.hideModal),k.closeModalButton.addEventListener("click",k.hideModal)),k.element.addEventListener("click",k.overlayClickHandler)},C=function t(o){o.preventDefault(),e.publish("tracking/record","Product | quickBuy","clicked","quickBuy button"),e.publish("columbo/track","quick_buy_button","click");var r=e.element.getAttribute(k.config.productBlockSku,o.target),n=e.element.getAttribute(k.config.fromWishlist,o.target),c=e.element.getAttribute(k.config.showSubscribeAndSave,o.target),i="/"+r+".quickbuy",a=[];k.gallery&&a.push("variationSelect=true"),k.context&&a.push("rctxt="+k.context),n&&a.push("fromWishlist="+n),c&&(a.push("enableSubscribeAndSave="+c),a.push("variationSelect="+c));var u=a.join("&");u&&(i+="?"+u),e.ajax.get({url:i,dataType:"JSON",error:k.showError,success:k.attachModal})},A=function e(t){k.element.outerHTML=t,k.initialiseAllComponents()},T=function e(){var t=document.querySelector("[data-component=productQuickbuy]");k.init(t,true)},B=function e(){var p=document.querySelector("[data-component=productQuickbuy]");k.init(p,true);var b=p.querySelector("[data-component=productSingleImage]");k.isProductPage||(new t).init(b);var h=p.querySelector("[data-component=productPrice]");(new o).init(h);var w=p.querySelector("[data-component=fastTrackSwitch]");w&&(new m).init(w);var v=p.querySelector("[data-component=productTags]");v&&(new r).init(v);var S=p.querySelector("[data-component=productQuantityInput]");(new c).init(S);var M=p.querySelector("[data-component=productVariations]");M&&(new n).init(M);var q=p.querySelector("[data-component=productAddToBasket]");(new i).init(q);var C=p.querySelector("[data-component=productAddToBasketButton]");k.isProductPage||(new a).init(C);var A=p.querySelector("[data-component=productName]");A&&(new l).init(A);var T=p.querySelector("[data-component=productStockInformation]");k.isProductPage||(new u).init(T);var B=p.querySelector("[data-component=productViewMoreInformation]");(new d).init(B);var E=p.querySelector("[data-component=subscriptionComponent]");E&&(new s).init(E);var P=p.querySelector("[data-component=subscribeAndSave]");P&&(new g).init(P);var Q=p.querySelector("[data-component=subscribeAndSaveContracts]");Q&&(new y).init(Q);var I=p.querySelector("[data-component=subscribeAndSaveProductInBasket]");I&&(new f).init(I),k.showModal(p)},E=function t(o){o?e.element.addClass(k.config.classes.showQuickbuy,o):e.element.addClass(k.config.classes.showQuickbuy,k.element),document.body.style.top="-"+window.scrollY+"px",document.body.style.position="fixed",document.body.style.width="100vw",k.attachAccessibleModalHelper(),e.publish("tracking/record","Product | quickBuy","viewed","quickBuy modal")},P=function e(){k.accessibleModalHelper=new p(document.querySelector("[data-component=productQuickbuy]"),k.hideModal,document.querySelector(".productQuickbuy_title"))},Q=function t(){for(var o in k.config.subscribedChannelsToClear)k.config.subscribedChannelsToClear.hasOwnProperty(o)&&!k.isProductPage&&e.clear(k.config.subscribedChannelsToClear[o]);if("fixed"===document.body.style.position){var r=-1*parseFloat(document.body.style.top);document.body.style.position="",document.body.style.top="",window.scrollTo(0,r),document.body.style.width=""}e.element.removeClass(k.config.classes.showQuickbuy,k.element),k.isProductPage||k.accessibleModalHelper&&k.accessibleModalHelper.close(),e.publish("tracking/record","Product | quickBuy","clicked","close modal")},I=function t(){e.element.addClass(k.config.classes.showError,k.error)},L=function t(){k.error&&e.element.removeClass(k.config.classes.showError,k.error)},x=function t(){k.loading&&e.element.addClass(k.config.classes.showLoading,k.loading)},H=function t(){k.loading&&e.element.removeClass(k.config.classes.showLoading,k.loading)},N=function t(){e.publish("tracking/record","Product | quickBuy","viewed",k.productId)},O=function e(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var t=k.element.closest(k.config.recommendationParentAttribute);return t?t.getAttribute(k.config.recommendationContext):""},V=function e(t){t.target===k.element&&(t.preventDefault(),k.hideModal())};return k.init=v,k.subscribe=S,k.reinitialiseComponent=T,k.config=w,k.bindOpenTrigger=M,k.bindCloseTrigger=q,k.initialiseAllComponents=B,k.startLoading=x,k.stopLoading=H,k.loadModal=C,k.attachModal=A,k.showModal=E,k.attachAccessibleModalHelper=P,k.hideModal=Q,k.showError=I,k.hideError=L,k.tracking=N,k.getRecommendationContext=O,k.overlayClickHandler=V,k};return function(){if(h)return k;return h=true,new w}});
//# sourceMappingURL=productQuickbuy-ba1d72418e.js.map
