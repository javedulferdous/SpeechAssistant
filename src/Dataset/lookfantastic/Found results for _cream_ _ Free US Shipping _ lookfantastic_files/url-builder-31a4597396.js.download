"use strict";define(["app"],function(e){var r={},a={_init:function t(){r=a._apiType(),a._changeDetection(r),a._updateIdentifiers(r.variableQuery,r.categoryValueSeparator,r.categorySeparator,r.segmentSeparator),e.subscribe("url/update",function(){a._engine.updateSegment.apply(r,arguments)}),e.subscribe("url/updatePath",function(e){a._engine.updateUrl.call(r,e)}),e.subscribe("url/updateIdentifiers",function(){a._updateIdentifiers.apply(this,arguments),a._checkURLEncoded()}),e.subscribe("url/crossCompatibility",function(t,o){o=e.urlReader.getCategories(o),o=e.urlReader.constructParameters(o,true),a._engine.updateUrl.call(r,t+a._keySegments.variableQuery+o)}),e.subscribe("url/init",function(){r.hasOwnProperty("initLoad")&&r.initLoad(e.publish,"url/crossCompatibility")&&e.publish("facets/updatePage")})},_updateIdentifiers:function r(t,o,n,i){a._keySegments={variableQuery:t||a._keySegments.variableQuery,segmentSeparator:i||a._keySegments.segmentSeparator,categorySeparator:n||a._keySegments.categorySeparator,categoryValueSeparator:o||a._keySegments.categoryValueSeparator},e.urlReader.decoupler=a._keySegments},_keySegments:{variableQuery:"?",categoryValueSeparator:"=",categorySeparator:"&",segmentSeparator:":"},_apiType:function r(){for(var a in e.urlApi)if(e.urlApi.hasOwnProperty(a)&&e.urlApi[a].apiCheck)return e.urlApi[a]},_changeDetection:function r(a){a.dynamicUpdate(e.publish,"url/change")},_checkURLEncoded:function e(){for(var t=window.location.href,o=["|"],n="",i="",u=0;u<o.length;u++){var g=o[u];if(i=encodeURIComponent(g),t.indexOf(i)>-1)for(var p in a._keySegments)if(a._keySegments.hasOwnProperty(p)){var s=a._keySegments[p];if(s===g){n=s;break}}t=t.split(i).join(n)}t!==window.location.href&&a._engine.updateUrl.call(r,t)},_engine:{updateUrl:function e(r){this.apiUpdateUrl(r)},updateSegment:function e(r,t,o){a._run({url:this.url(),variableQuery:this.variableQuery,categorySeparator:this.categorySeparator,action:r,category:o,segment:t,updateSegment:this.updateFragment})}},_run:function r(t){if(e.urlReader.decoupler.variableQuery=t.variableQuery=t.variableQuery||a._keySegments.variableQuery,e.urlReader.decoupler.segmentSeparator=t.segmentSeparator=t.segmentSeparator||a._keySegments.segmentSeparator,t.category)return a._categoryValues(t),void 0;a._update(t)},_categoryValues:function r(t){if(e.urlReader.decoupler.categorySeparator=t.categorySeparator=t.categorySeparator||a._keySegments.categorySeparator,e.urlReader.decoupler.categoryValueSeparator=t.categoryValueSeparator=t.categoryValueSeparator||a._keySegments.categoryValueSeparator,!t.url.split(t.variableQuery)[1])return t.categorySeparator="",t.segmentSeparator="",a._update(t,{value:t.category,exists:false}),void 0;var o=t.url.split(t.variableQuery)[1];if(o)for(var n=o.split(t.categorySeparator),i=n.map(function(e){return e.split(t.categoryValueSeparator)[0]}),u=0,g=i.length;u<g;u++){var p=i[u];if(i[u]===t.category)return a._update(t,{value:p,exists:true},n[u]),void 0}a._update(t,{value:t.category,exists:false},o)},_update:function e(r,t,o){if(r.category)return a._segmentModifier(r,t,o),void 0;a._segmentModifier(r)},_segmentModifier:function e(r,t,o){var n=window.location.href;"add"===r.action&&(n=a._segmentAdd(r,t,o)),"remove"===r.action&&(n=a._segmentRemove(r,t,o)),r.updateSegment(n)},_segmentAdd:function e(r,a,t){var o=r.url;if(a){if(a.exists){r.category="",r.categorySeparator="",r.categoryValueSeparator="",r.variableQuery="";var n=t+r.segmentSeparator+r.segment;r.segmentSeparator="",r.segment="",o=(o=o.split(t))[0]+n+o[1]}a.exists||(r.segmentSeparator="")}else o.indexOf(r.variableQuery)<0&&(o+=r.variableQuery,r.segmentSeparator=""),r.category="",r.categorySeparator="",r.categoryValueSeparator="";return o+r.variableQuery+r.categorySeparator+r.category+r.categoryValueSeparator+r.segmentSeparator+r.segment},_segmentRemove:function e(r,t,o){var n=r.url,i=[];if(t&&t.exists)n=a._categorySegmentRemove(r,t,o),r.variableQuery="",i[0]="";else{i=n.split(r.variableQuery);for(var u=0,g=(n=i[1].split(r.segmentSeparator)).length;u<g;u++)if(n[u]===r.segment){n.splice(u,1);break}n.length?n=n.join(r.segmentSeparator):r.variableQuery=""}return i[0]+r.variableQuery+n},_categorySegmentRemove:function e(r,a,t){var o="";if(t.indexOf(r.segmentSeparator+r.segment)>-1)o=t.split(r.segmentSeparator+r.segment);else if(t.indexOf(r.categoryValueSeparator+r.segment)>-1)o=t.indexOf(r.categoryValueSeparator+r.segment+r.segmentSeparator)>-1?t.split(r.segment+r.segmentSeparator):"";else{var n=(o=t.split(r.segment).join("")).split(r.category+r.categoryValueSeparator);n[0]&&n[1]||(o="")}r.categoryValueSeparator===r.segmentSeparator&&o[0]===a.value&&(o=""),""===o&&r.url.indexOf(r.categorySeparator+t)>-1?t=r.categorySeparator+t:""===o&&r.url.indexOf(r.variableQuery+t+r.categorySeparator)>-1?t+=r.categorySeparator:""===o&&r.url.indexOf(r.variableQuery+t)>-1&&(t=r.variableQuery+t);var i=r.url.split(t);return"string"!=typeof o&&(o=o.join("")),i[0]+o+i[1]}};return a._init(),a});
//# sourceMappingURL=url-builder-31a4597396.js.map
