"use strict";define(["app","siteObj","$location","ePopup","queryString","$window"],function(e,t,n,s,i,o){var c;return(new function c(){var r=this,a={closeAriaLabelText:window.siteObj.props.accessibility&&window.siteObj.props.accessibility.closeSettings||"Close settings",settingsButtonSelector:".js-sessionSettingsButton",settingsButtonActiveClass:"sessionSettings_button-active",saveButtonSelector:".js-sessionSettingsSave",settingsShippingDestination:".js-sessionSettings_shippingDestination",notifier:{cssClass:"sessionSettings_notification",hiddenCssClass:"sessionSettings_notification-hidden",confirmMessage:t.props.sessionSettings.confirmMessage,timeout:5e3},panelContentURL:t.siteURL+t.siteDefaultLocale+"/"+t.currencyType+"/sessionSettings.overlay",inputs:{shippingCountry:{selector:".sessionSettings_shippingCountrySelect",valueAttribute:"data-country-code"},countrySite:{selector:".sessionSettings_countrySiteSelect",valueAttribute:"data-subsite-code",template:function e(t){var n=t.selected?" selected":"";return'<option class="sessionSettings_countrySiteOption" data-url="'+t.url+'" data-lang-code="'+t.langCode+'" data-subsite-code="'+t.subsiteCode+'"'+n+">"+t.countryName+"</option>\n"},getUrl:function e(){return t.siteURL+t.siteDefaultLocale+"/"+t.currencyType+"/sessionSettingCountries.session?countrycode="+r.config.getInputValue(r.config.inputs.shippingCountry)}},currency:{selector:".sessionSettings_currencySelect",valueAttribute:"data-currency-code",template:function e(t){var n=t.selected?" selected":"";return'<option class="sessionSettings_currencyOption" data-currency-symbol="'+t.symbol+'" data-currency-code="'+t.code+'"'+n+">"+t.symbol+" "+t.code+"</option>\n"},getUrl:function e(){return t.siteURL+t.siteDefaultLocale+"/"+t.currencyType+"/sessionSettingCurrencies.session?subsitecode="+r.config.getInputValue(r.config.inputs.countrySite)}}},getInputValue:function t(n){var s="",i;return e.element.init(n.selector).forEach(function(e){s=e.options[e.selectedIndex].getAttribute(n.valueAttribute).toUpperCase()}),s},getUrlForSave:function e(n){return t.siteURL+t.siteDefaultLocale+"/"+t.currencyType+"/sessionSettingsSave.session?subsitecode="+n},getPageExistsInSelectedLocale:function e(){return t.siteURL+t.siteDefaultLocale+"/"+t.currencyType+"/sessionSettingsExists.session?subsitecode="+r.config.getInputValue(r.config.inputs.countrySite)+"&href=https://"+encodeURIComponent(n.hostname)+encodeURIComponent(n.pathname)+encodeURIComponent(n.search)}},u=false,l="",p="",g=function e(){r.getPopupContent();var t=i.parse(n.search);return(t.countrySelected||t.settingsSaved)&&r.showNotification(),r},d=function t(){e.ajax.get({url:r.config.panelContentURL,success:r.contentLoadSuccess,error:r.contentLoadError})},f=function e(t){if(t){r.ready=true,r.panelContent=t,r.activateButton();var n=document.createElement("div");r.panelContent=t,n.innerHTML=r.panelContent,r.showShippingDestination(n)}},S=function e(){console.log("contentLoadError",arguments)},y=function t(n){n.preventDefault(),r.ready&&(r.epopup=new s(r.panelContent,"sessionSettings_popup",true,void 0,r.config.closeAriaLabelText),r.activateForm(),e.publish("sessionSettings/open"),r.epopup.elements.content.getElementsByClassName("sessionSettings_countrySiteSelect")[0]&&(r.currentRegion=r.epopup.elements.content.getElementsByClassName("sessionSettings_countrySiteSelect")[0].options[0].value))},m=function t(){e.element.init(r.config.saveButtonSelector).on("click",r.saveSettings).on("keydown",function(e){return"Enter"===e.key&&r.saveSettings(e)}),e.element.init(r.config.inputs.shippingCountry.selector).on("change",r.shippingCountrySelected),e.element.init(r.config.inputs.countrySite.selector).on("change",r.countrySiteSelected),e.subscribe("sessionSettings/update-countrySite",r.countrySiteSelected)},h=function t(n){e.element.init(r.config.inputs[n].selector).forEach(function(e){e.disabled=true}),e.ajax.get({url:r.config.inputs[n].getUrl(),success:function e(t){r.updateSelect(n,t)}})},v=function e(){r.getSelectUpdate("countrySite"),r.showShippingDestination(r.epopup.elements.content)},C=function e(){r.getSelectUpdate("currency")},b=function t(n,s){for(var i=JSON.parse(s),o=e.element.init(r.config.inputs[n].selector),c="",a=0;a<i.length;a++)c+=r.config.inputs[n].template(i[a]);o.forEach(function(t){t.innerHTML=c,i.length>1&&(t.disabled=false),e.publish("sessionSettings/update-"+n)})},L=function t(){e.element.init(r.config.settingsButtonSelector).on("click",r.openSettings).on("keydown",function(e){return"Enter"===e.key&&r.openSettings(e)}).forEach(function(){e.element.addClass(r.config.settingsButtonActiveClass),e.element.removeAttribute("disabled")})},E=function t(){e.ajax.get({url:r.config.getPageExistsInSelectedLocale(),dataType:"JSON",success:r.useReloadInfo})},U=function n(s){var i=JSON.parse(s),o=r.config.getInputValue(r.config.inputs.countrySite);if(i.pageExists)e.ajax.get({url:r.config.getUrlForSave(o),success:r.reloadPage});else{var c=r.epopup.elements.content.getElementsByClassName("sessionSettings")[0],a=r.epopup.elements.content.getElementsByClassName("sessionSettingsReload")[0],u=r.epopup.elements.content.getElementsByClassName("sessionSettingsReload_okButton")[0],l=r.epopup.elements.content.getElementsByClassName("sessionSettingsReload_cancelButton")[0],p=r.epopup.elements.content.getElementsByClassName("sessionSettings_countrySiteSelect")[0],g=p.options[p.selectedIndex].value;c.classList.remove("show"),a.classList.add("show"),u.innerText+=" "+g,l.innerText+=" "+r.currentRegion,u.addEventListener("click",r.reloadOk),l.addEventListener("click",r.reloadCancel),r.epopup.show(),console.log("Subsite code: "+t.subsiteCode),console.log("Site code: "+t.siteCode)}},w=function t(){var n=r.config.getInputValue(r.config.inputs.countrySite);r.epopup.close(),e.ajax.get({url:r.config.getUrlForSave(n),success:r.reloadPage})},B=function e(){r.epopup.close()},R=function t(){e.publish("sessionSettings/save");var s=i.parse(n.search);s.shippingcountry=r.config.getInputValue(r.config.inputs.shippingCountry),s.switchcurrency=r.config.getInputValue(r.config.inputs.currency),delete s.countrySelected,s.settingsSaved="Y",n.search=i.stringify(s)},I=function e(t){if(t.querySelector(r.config.inputs.shippingCountry.selector)){var n=t.querySelector(r.config.inputs.shippingCountry.selector).options[0].getAttribute(r.config.inputs.shippingCountry.valueAttribute),s=document.querySelectorAll(r.config.settingsShippingDestination);Array.from(s).map(function(e){return e.innerHTML=n})}},x=function e(){r.notifier=document.createElement("div"),r.notifier.classList.add(r.config.notifier.cssClass),r.notifier.innerText=r.config.notifier.confirmMessage,document.body.appendChild(r.notifier),r.notifier.onclick=r.dismissNotification,o.setTimeout(r.dismissNotification,r.config.notifier.timeout)},N=function e(){r.notifier.classList.add(r.config.notifier.hiddenCssClass)};r.config=a,r.ready=false,r.notifier=false,r.panelContent="",r.currentRegion="",r.init=g,r.getPopupContent=d,r.contentLoadSuccess=f,r.showShippingDestination=I,r.contentLoadError=S,r.openSettings=y,r.activateForm=m,r.getSelectUpdate=h,r.shippingCountrySelected=v,r.countrySiteSelected=C,r.updateSelect=b,r.activateButton=L,r.saveSettings=E,r.reloadPage=R,r.showNotification=x,r.dismissNotification=N,r.useReloadInfo=U,r.reloadOk=w,r.reloadCancel=B}).init()});
//# sourceMappingURL=sessionSettings-dee15493f1.js.map
