"use strict";define(["app","$location","$window","siteObj","accessibilityAnnouncer"],function(e,s,t,a,n){var l;return function l(){var o=this,r={data:{customerLocale:"data-customer-locale",currencyType:"data-currency",searchResultsContainer:"data-search-results"},selectors:{hideHeaderSearchAutoComplete:"data-hide-autocomplete",toggleFormButton:"[data-toggle-form]",toggleFormButtonSpyglass:".headerSearch_spyglass",form:"[data-form]",searchField:"[data-search]",option:"[data-option]",searchResultsContainer:"[data-search-results]",hideSearchResultsButton:"[data-hide-search-results-button]"},classes:{toggleOpen:"headerSearch_toggleForm-open",showForm:"headerSearch_form-show",active:"headerSearch_resultsListItem-active",searchResultsContainer:"headerSearch_resultsContainer",searchFieldVisibleResults:"headerSearch_input-resultsVisible",hideSearchResults:"headerSearch_results-hide",showHideSearchResultsButton:"headerSearch_hideResults-show",spyglassHidden:"headerSearch_spyglass-hidden",headerSearchOverlay:"headerSearch_overlay",showHeaderSearchOverlay:"headerSearch_overlay-show"},queryExecuted:false,searchEndpointSuffix:"/headerSearch_results/headersearch.nav?autocompleteRequest=",fullSearchEndpoint:null,lastSearchString:null,lastKeyPress:null,lastSearchTimeout:null,specialKeys:{UP:38,DOWN:40,RETURN:13,ESC:27,TAB:9},visibleResults:false,results:[],selectedIndex:null,previousSelected:null,minChars:1,error:false,checkingFocus:false,mobileBreakpoint:900},c=function s(t){return o.element=t,o.westEndHeader=document.querySelector("[data-component=westendHeader]"),o.toggleFormButton=o.element.querySelector(o.config.selectors.toggleFormButton),o.toggleFormButtonSpyglass=o.toggleFormButton.querySelector(o.config.selectors.toggleFormButtonSpyglass),o.form=o.element.querySelector(o.config.selectors.form),o.searchField=o.element.querySelector(o.config.selectors.searchField),o.customerLocale=o.element.getAttribute(o.config.data.customerLocale),o.currency=o.element.getAttribute(o.config.data.currencyType),o.searchResults=null,o.searchResultsContainer=null,o.hideSearchResultsButton=o.element.querySelector(o.config.selectors.hideSearchResultsButton),o.config.translations={correction:o.element.dataset.translationCorrection,suggestion:o.element.dataset.translationSuggestion,product:o.element.dataset.translationProduct,resultsAvailable:o.element.dataset.translationResultsAvailable,resultsDesktopInstructions:o.element.dataset.translationResultsDesktopInstructions,lastResult:o.element.dataset.translationLastResult},o.config.fullSearchEndpoint="/"+o.customerLocale+"/"+o.currency+o.config.searchEndpointSuffix,o.westEndHeader&&(o.overlayFocus=o.westEndHeader.querySelector("[data-js-element=headerSearch_overlay]"),o.buttonSearch=o.westEndHeader.querySelector("[data-js-element=headerSearch_button]"),o.buttonSearch.disabled=false),o.addEventListeners(),o.createSearchResultsContainer(),o.checkForParam(),e.subscribe("SHOW-HEADER-SEARCH-FORM",function(e){o.toggleForm(),o.searchField.value=e}),e.subscribe("HEADER-SEARCH-THAT-SCROLLS-VISIBLE",function(e){e?o.toggleFormButtonSpyglass.classList.add(o.config.classes.spyglassHidden):o.toggleFormButtonSpyglass.classList.remove(o.config.classes.spyglassHidden)}),o},i=function s(){o.toggleFormButton.addEventListener("click",o.toggleForm),o.searchField.addEventListener("keydown",o.keyDownEventHandler),o.searchField.addEventListener("keyup",o.keyUpEventHandler),o.searchField.addEventListener("focus",o.focusEventHandler),o.hideSearchResultsButton.addEventListener("click",o.hideSearchResults),o.overlayFocus&&(o.overlayFocus.addEventListener("click",o.closeSearchForm),document.addEventListener("focusin",function(s){!o.element.contains(s.target)&&e.element.hasClass(o.config.classes.showHeaderSearchOverlay,o.overlayFocus)&&o.closeSearchForm()}))},u=function e(){var s=document.createElement("div");s.setAttribute("class",o.config.classes.searchResultsContainer),s.setAttribute(o.config.data.searchResultsContainer,""),o.element.appendChild(s),o.searchResultsContainer=o.element.querySelector(o.config.selectors.searchResultsContainer)},d=function e(s){o.toggleButtonClass(),o.toggleShowForm()},h=function s(){e.element.hasClass(o.config.classes.toggleOpen,o.toggleFormButton)?(e.element.removeClass(o.config.classes.toggleOpen,o.toggleFormButton),o.hideSearchResults(),e.element.setAttribute("aria-label",a.props.accessibility.openSearch,o.toggleFormButton),o.overlayFocus&&e.element.removeClass(o.config.classes.showHeaderSearchOverlay,o.overlayFocus),o.buttonSearch&&e.element.removeClass("headerSearch_button-show",o.buttonSearch)):(e.element.addClass(o.config.classes.toggleOpen,o.toggleFormButton),e.element.setAttribute("aria-label",a.props.accessibility.closeSearch,o.toggleFormButton),o.overlayFocus&&e.element.addClass(o.config.classes.showHeaderSearchOverlay,o.overlayFocus))},g=function s(){o.overlayFocus&&(e.element.removeClass(o.config.classes.showHeaderSearchOverlay,o.overlayFocus),e.element.removeClass("headerSearch_form-overlay",o.form)),o.buttonSearch&&(o.buttonSearch.disabled=true,e.element.removeClass("headerSearch_button-show",o.buttonSearch)),e.element.removeClass(o.config.classes.toggleOpen,o.toggleFormButton),o.hideSearchResults(),e.element.removeClass(o.config.classes.showForm,o.form),o.config.searchFieldVisible=false},f=function s(){e.element.hasClass(o.config.classes.showForm,o.form)?(e.element.removeClass(o.config.classes.showForm,o.form),o.config.searchFieldVisible=false):(e.element.addClass(o.config.classes.showForm,o.form),o.config.searchFieldVisible=true,o.searchField.focus())},m=function s(){return o.config.queryExecuted=true,o.config.error=false,o.buttonSearch&&(e.element.addClass("headerSearch_button-show",o.buttonSearch),o.buttonSearch.disabled=false),e.ajax.get({url:o.config.fullSearchEndpoint+o.config.lastSearchString,dataType:"JSON",error:o.errorCallback,success:o.populateSearchResults})},S=function e(){o.config.error=true},v=function e(){var t=s.href.match(/[\?&]search=([^&]*)/);t&&(o.searchField.value=decodeURIComponent(t[1]).replace(/\+/g," "))},y=function e(s){if(o.element.hasAttribute(o.config.selectors.hideHeaderSearchAutoComplete))return false;if(o.config.lastKeyPress=s.keyCode,s.keyCode===o.config.specialKeys.UP)return o.keyNavigationHandler("up");if(s.keyCode===o.config.specialKeys.DOWN)return o.keyNavigationHandler("down");if(s.keyCode===o.config.specialKeys.ESC)return o.hideSearchResults();if(o.config.lastSearchString=s.target.value,s.target.value.length<o.config.minChars&&s.keyCode!==o.config.specialKeys.RETURN)return o.hideSearchResults();clearTimeout(o.lastSearchTimeout),o.lastSearchTimeout=setTimeout(o.doSearch,200)},p=function e(s){o.config.lastKeyPress=s.keyCode,s.keyCode===o.config.specialKeys.RETURN&&null!==o.config.selectedIndex&&(s.preventDefault?s.preventDefault():s.returnValue=false,o.config.results[o.config.selectedIndex].children[0].click())},R=function s(t){if(o.config.results.length&&("up"===t?null===o.config.selectedIndex||0===o.config.selectedIndex?o.config.selectedIndex=null:o.config.selectedIndex--:"down"===t&&(null===o.config.selectedIndex?o.config.selectedIndex=0:o.config.selectedIndex>=o.config.results.length-1?o.config.selectedIndex=o.config.results.length-1:o.config.selectedIndex++),null!==o.config.previousSelected&&e.element.removeClass(o.config.classes.active,o.config.previousSelected),null!==o.config.selectedIndex)){e.element.addClass(o.config.classes.active,o.config.results[o.config.selectedIndex]),o.config.previousSelected=o.config.results[o.config.selectedIndex];var a,l,r=""+(o.config.selectedIndex>=o.config.results.length-1?o.config.translations.lastResult+", ":"")+o.config.translations[o.config.results[o.config.selectedIndex].dataset.optionType]+": "+o.config.results[o.config.selectedIndex].innerText.replace(/\n/g," ");r&&n.announce("assertive",r)}},C=function s(t){o.overlayFocus&&(e.element.addClass(o.config.classes.showHeaderSearchOverlay,o.overlayFocus),e.element.addClass("headerSearch_form-overlay",o.form)),o.config.queryExecuted&&t.target.value.length>=o.config.minChars&&t.target.value===o.config.lastSearchString&&o.showSearchResults()},F=function s(){o.config.visibleResults&&(e.element.addClass(o.config.classes.hideSearchResults,o.searchResultsContainer),e.element.removeClass(o.config.classes.searchFieldVisibleResults,o.searchField),o.config.selectedIndex=null,o.config.visibleResults=false,o.hideHideSearchResultsButton(),o.searchField&&o.searchField.focus())},b=function e(s){o.searchResultsContainer.innerHTML=s,o.config.results=o.searchResultsContainer.querySelectorAll(o.config.selectors.option),o.searchField.value.length>=o.config.minChars&&o.showSearchResults()},w=function s(){e.element.removeClass(o.config.classes.hideSearchResults,o.searchResultsContainer),e.element.addClass(o.config.classes.searchFieldVisibleResults,o.searchField),o.config.visibleResults=true,t.innerWidth>o.config.mobileBreakpoint?n.announce("assertive",o.config.translations.resultsAvailable+", "+o.config.translations.resultsDesktopInstructions):n.announce("assertive",o.config.translations.resultsAvailable),o.showHideSearchResultsButton()},E=function s(){e.element.addClass(o.config.classes.showHideSearchResultsButton,o.hideSearchResultsButton)},H=function s(){o.searchField.value="",e.element.removeClass(o.config.classes.showHideSearchResultsButton,o.hideSearchResultsButton),o.buttonSearch&&(o.buttonSearch.disabled=true,e.element.removeClass("headerSearch_button-show",o.buttonSearch))};o.config=r,o.init=c,o.addEventListeners=i,o.createSearchResultsContainer=u,o.toggleForm=d,o.closeSearchForm=g,o.toggleButtonClass=h,o.toggleShowForm=f,o.doSearch=m,o.errorCallback=S,o.focusEventHandler=C,o.keyDownEventHandler=p,o.keyNavigationHandler=R,o.keyUpEventHandler=y,o.hideSearchResults=F,o.populateSearchResults=b,o.showSearchResults=w,o.checkForParam=v,o.showHideSearchResultsButton=E,o.hideHideSearchResultsButton=H}});
//# sourceMappingURL=headerSearch-16d298c1ff.js.map
