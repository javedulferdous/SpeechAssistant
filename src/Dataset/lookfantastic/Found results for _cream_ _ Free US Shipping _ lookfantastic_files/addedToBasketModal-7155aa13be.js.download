"use strict";define(["app","$location","lazyloadIntersectionObserver","accessibleModalHelper"],function(e,t,o,n){var r=false,a={init:function e(){}},i=function r(){var a=this,i={attributes:{cndUrl:"data-cdn-url",secureUrl:"data-secure-url"},selectors:{error:"[data-error]",quantityLimitedReached:"[data-quantity-limit-reached]",quantityLimitedPartiallyReached:"[data-quantity-limit-partially-reached]",productTitle:"[data-product-title]",productPrice:"[data-product-price]",productQuantity:"[data-product-quantity]",productImage:"[data-product-image]",productID:"[data-product-id]",basketTotal:"[data-basket-total]",basketTotalItems:"[data-basket-total-items]",productUrl:"[data-product-url]",closeModalButton:"[data-close]",continueShoppingButton:"[data-continue-shopping]",viewBasketButton:"[data-view-basket]",recommendations:"[data-recommendations]",recommendationsItem:"[data-recommendations-item]",responsiveBasketComponent:"[data-component=responsiveBasket]",loyaltyPoints:"[data-loyalty-points]"},subscribeChannels:{productAdded:"addedToBasketModal/productAdded",showError:"addedToBasketModal/showError",hideError:"addedToBasketModal/hideError",reinitialise:"addedToBasketModal/reinitialise"},classes:{showError:"addedToBasketModal_error-show",showWarning:"addedToBasketModal_warning-show",showModal:"addedToBasketModal-show",emptyRecommendations:"addedToBasketModal_productRecommendations-empty"},messages:{maxQuantityReached:e.utils.getProperty("maxQuantityReached","addedToBasketModal"),partialMaxQuantityReached:e.utils.getProperty("partialMaxQuantityReached","addedToBasketModal")},recommendationsResetHTML:'<span class="addedToBasketModal_loading"><span class="addedToBasketModal_loadingSpinny"></span></span>'},c=function t(n,r){return a.element=n,a.cndUrl=e.element.getAttribute(a.config.attributes.cndUrl,a.element),a.secureUrl=e.element.getAttribute(a.config.attributes.secureUrl,a.element),a.error=a.element.querySelector(a.config.selectors.error),a.quantityLimitedReached=a.element.querySelector(a.config.selectors.quantityLimitedReached),a.quantityLimitedPartiallyReached=a.element.querySelector(a.config.selectors.quantityLimitedPartiallyReached),a.closeModalButton=a.element.querySelector(a.config.selectors.closeModalButton),a.continueShoppingButton=a.element.querySelector(a.config.selectors.continueShoppingButton),a.viewBasketButton=a.element.querySelector(a.config.selectors.viewBasketButton),a.recommendationsContainer=a.element.querySelector(a.config.selectors.recommendations),a.onBasketPage=document.querySelector(a.config.selectors.responsiveBasketComponent),a.productTitle=a.element.querySelector(a.config.selectors.productTitle),a.productPrice=a.element.querySelector(a.config.selectors.productPrice),a.productQuantity=a.element.querySelector(a.config.selectors.productQuantity),a.basketTotal=a.element.querySelector(a.config.selectors.basketTotal),a.basketTotalItems=a.element.querySelector(a.config.selectors.basketTotalItems),a.productImage=a.element.querySelector(a.config.selectors.productImage),a.productUrls=a.element.querySelectorAll(a.config.selectors.productUrl),a.loyaltyPoints=a.element.querySelector(a.config.selectors.loyaltyPoints),a.lazyLoading=new o,a.domParser=new DOMParser,r||a.subscribe(),a.closeModalButton&&a.closeModalButton.addEventListener("click",a.closeModalTracking),a.continueShoppingButton&&a.continueShoppingButton.addEventListener("click",a.continueShoppingTracking),a.viewBasketButton&&a.viewBasketButton.addEventListener("click",a.viewBasketTracking),a.element.addEventListener("click",a.overlayClickHandler),a},s=function t(){e.subscribe(a.config.subscribeChannels.productAdded,a.productAddReceived),e.subscribe(a.config.subscribeChannels.showError,a.showError),e.subscribe(a.config.subscribeChannels.hideError,a.hideError),e.subscribe(a.config.subscribeChannels.reinitialise,a.reinitialiseComponent)},d=function e(){var t=document.querySelector("[data-component=addedToBasketModal]");a.init(t,true)},l=function t(){e.element.addClass(a.config.classes.showModal,a.element),document.body.style.top="-"+window.scrollY+"px",document.body.style.position="fixed",document.body.style.width="100vw",a.accessibleModalHelper=new n(a.element,function(){return a.closeModal("keypress","Pressed escape key")},a.element.querySelector("h2")),a.viewedModalTracking()},u=function o(n,r){if(e.element.removeClass(a.config.classes.showModal,a.element),a.productImage.src="//:0",a.recommendationsContainer&&(a.recommendationsContainer.innerHTML=a.config.recommendationsResetHTML),a.tracking(n,r),a.hideQuantityErrors(),a.accessibleModalHelper&&a.accessibleModalHelper.close(),"fixed"===document.body.style.position){var i=-1*parseFloat(document.body.style.top);document.body.style.position="",document.body.style.top="",window.scrollTo(0,i),document.body.style.width=""}a.onBasketPage&&t.reload()},m=function e(t){var o;return a.domParser.parseFromString(t,"text/html").body.textContent},p=function t(o){var n=0,r=8;if(o.productUrl){for(var i=0,c=a.productUrls.length;i<c;i++)a.switchProductUrl(a.productUrls[i],o.productUrl);n++}if(o.productTitle&&(a.switchProductTitle(o.productTitle),a.switchImageAltTag(o.productTitle),n++),o.productImageUrl&&(a.switchProductImage(o.productImageUrl),n++),null!==o.productQuantity&&(a.switchProductQuantity(o.productQuantity),n++),o.productPrice&&(a.switchProductPrice(o.productPrice),n++),o.basketTotalItems&&(a.switchBasketTotalItems(o.basketTotalItems),n++),o.basketTotalPrice&&(a.switchBasketTotalPrice(o.basketTotalPrice),n++),o.productId&&(a.loadRecommendations(o.productId),n++),isNaN(o.loyaltySchemePoints)||a.switchLoyaltyPoints(o.loyaltySchemePoints),8===n?(a.showModal(),e.publish("productQuickbuy/stopLoading","",false)):e.publish("productQuickbuy/showError","",false),0===o.productQuantity&&o.productQuantityRequested>0&&a.showQuantityReachedError(o.lastAddedMaxPerOrder),o.productQuantity>0&&o.productQuantity<o.productQuantityRequested){var s=o.productQuantityRequested-o.productQuantity;a.showQuantityPartiallyReachedError(s,o.lastAddedMaxPerOrder)}o.productQuantity===o.productQuantityRequested&&a.hideQuantityErrors()},y=function e(t,o){t.href=a.secureUrl+o},h=function e(t){a.productImage.alt=t},g=function e(t){a.productImage.src=a.cndUrl+t},f=function e(t){a.productTitle.innerText=t},k=function e(t){a.productPrice.innerText=a.parseAndReturn(t)},w=function e(t){a.productQuantity.innerText=t},T=function e(t){a.basketTotal.innerText=a.parseAndReturn(t)},b=function e(t){a.basketTotalItems.innerText=t},M=function e(t){if(!a.loyaltyPoints)return;a.loyaltyPoints.innerText=t},P=function t(){e.element.addClass(a.config.classes.showError,a.error)},B=function t(){e.element.removeClass(a.config.classes.showError,a.error)},R=function t(o){e.element.addClass(a.config.classes.showError,a.quantityLimitedReached);var n=a.config.messages.maxQuantityReached.replace("%d",o);a.quantityLimitedReached.innerHTML=n},v=function t(o,n){e.element.addClass(a.config.classes.showWarning,a.quantityLimitedPartiallyReached);var r=a.config.messages.partialMaxQuantityReached.replace("%1",o).replace("%2",n);a.quantityLimitedPartiallyReached.innerHTML=r},q=function t(){e.element.removeClass(a.config.classes.showError,a.quantityLimitedReached),e.element.removeClass(a.config.classes.showWarning,a.quantityLimitedPartiallyReached)},I=function t(o,n){e.publish("tracking/record","Product | AddedToBasket",o,n)},C=function e(){a.tracking("viewed","AddToBasket Modal")},Q=function e(){a.closeModal("clicked","close modal")},E=function e(){a.closeModal("clicked","continue shopping")},S=function e(){a.tracking("clicked","view basket")},L=function t(o){var n=o.target||o.srcElement,r=e.element.closest(a.config.selectors.productID,n).element,i=e.element.getAttribute("data-product-id",r);a.tracking("clicked","Recommended Item | "+i)},x=function t(o){e.ajax.get({url:"/"+o+".recommendations?renderAddedToBasketModal=false&rctxt=postAddToBasket",success:a.showRecommendations,error:a.loadRecommendationsError})},A=function t(o){a.recommendationsContainer&&(a.recommendationsContainer.innerHTML=o,a.accessibleModalHelper.refresh(a.element)),""===o?e.element.addClass(a.config.classes.emptyRecommendations,a.recommendationsContainer):(a.recsClickHandler(),a.lazyLoading.init())},U=function e(){a.recommendationsItems=a.element.querySelectorAll(a.config.selectors.recommendationsItem);for(var t=0,o=a.recommendationsItems.length;t<o;t++)a.recommendationsItems[t].addEventListener("click",a.clickedRecItemTracking)},H=function t(){a.recommendationsContainer.innerHTML="",e.element.addClass(a.config.classes.emptyRecommendations,a.recommendationsContainer)},_=function e(t){t.target===a.element&&(t.stopPropagation(),a.closeModal("clicked","modal overlay"))};a.init=c,a.config=i,a.subscribe=s,a.reinitialiseComponent=d,a.closeModal=u,a.showModal=l,a.parseAndReturn=m,a.productAddReceived=p,a.showError=P,a.showQuantityReachedError=R,a.showQuantityPartiallyReachedError=v,a.hideError=B,a.hideQuantityErrors=q,a.switchProductUrl=y,a.switchImageAltTag=h,a.switchProductImage=g,a.switchProductTitle=f,a.switchProductPrice=k,a.switchProductQuantity=w,a.switchBasketTotalPrice=T,a.switchBasketTotalItems=b,a.switchLoyaltyPoints=M,a.tracking=I,a.viewedModalTracking=C,a.closeModalTracking=Q,a.continueShoppingTracking=E,a.viewBasketTracking=S,a.clickedRecItemTracking=L,a.recsClickHandler=U,a.loadRecommendations=x,a.showRecommendations=A,a.loadRecommendationsError=H,a.overlayClickHandler=_};return function(){if(r)return a;return r=true,new i}});
//# sourceMappingURL=addedToBasketModal-7155aa13be.js.map
