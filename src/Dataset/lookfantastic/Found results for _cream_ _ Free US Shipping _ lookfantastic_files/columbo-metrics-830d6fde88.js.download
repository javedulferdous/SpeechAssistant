"use strict";define(["cookie","columboConstants","$location","siteObj","uaParser","$window"],function(e,t,r,i,n,a){var o;return function o(){var s={},u=e.get(t.chaseSessionKey),c=e.get(t.chaseUserKey),d,m=(new n).getResult(),l=function e(t){var r={aix:true,"amiga os":true,android:false,arch:true,bada:false,beos:true,blackberry:false,centos:true,"chromium os":true,contiki:true,fedora:true,"firefox os":false,freebsd:true,debian:true,dragonfly:true,gentoo:true,gnu:true,haiku:true,hurd:true,ios:false,joli:true,linpus:true,"mac os":true,mageia:true,mandriva:true,meego:false,minix:true,mint:true,"morph os":true,netbsd:true,nintendo:false,openbsd:true,openvms:true,"os/2":true,palm:false,"pc-bsd":true,pclinuxos:true,playstation:false,qnx:true,redhat:true,"rim tablet os":false,"risc os":true,sailfish:false,series40:false,slackware:true,solaris:true,suse:true,symbian:false,tizen:true,ubuntu:true,unix:true,vectorlinux:true,webos:false,windows:true,"windows phone":false,"windows mobile":false,zenwalk:true};return!(!t||!r[t.toLowerCase()])&&r[t.toLowerCase()]},b=function e(t,r,i){var n=String.prototype.split.call(r,/[,[\].]+?/).reduce(function(e,t){return null!=e?e[t]:e},t);return void 0===n||n===t?i:n},p=function e(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o={};return n&&(o.args=n),i.forEach(function(e){var i=void 0;switch(e){case"ux":o.server={ip:"",hostname:"",elysium_version:s.getSiteObjItem("version"),columbo_version:t.columboVersion},o.request={url:r.toString(),client_timestamp:Math.round((new Date).getTime()/1e3)},o.property={site_id:s.getSiteObjItem("siteID"),channel:s.getSiteObjItem("siteCode"),shipping_country_code:s.getSiteObjItem("shippingCountry"),subsite:s.getSiteObjItem("subsiteCode"),is_mobile_version:s.getSiteObjItem("siteIsMobile"),locale:s.getSiteObjItem("siteDefaultLocale")},o.device={cookie:c,sess_cookie:u,type:{family:m.device.type,brand:m.device.vendor,model:m.device.model,is_mobile:"mobile"===m.device.type,is_tablet:"tablet"===m.device.type,is_pc:"mobile"!==m.device.type&&"tablet"!==m.device.type?l(m.os.name):""},screen:{width:a.screen.width,height:a.screen.height,devicePixelRatio:a.devicePixelRatio?a.devicePixelRatio:""},browser:{family:m.browser.name,version:m.browser.version,major_version:m.browser.major},ip:{country:s.getSiteObjItem("customerLocation")}},o.experiments=s.getSiteObjItem("experiments"),o.errors=[],o.event=n,o.attributes=[],o.nonce=s.getSiteObjItem("nonce");break;case"meta":o.meta=s.getMetaData();break;case"performance":o.performance=s.getPerformanceStats();break;case"experiments":o.experiments=s.getExperiments();break;case"widget":n[0]&&1===n[0].nodeType&&(i=n[0]),n[0]&&n[0].srcElement&&(i=n[0].srcElement),o.widget=s.getWidgetData(i);break;case"products":o.products=s.getProducts();break;case"basket":o.basket=s.getBasket(n);break;default:o[e]={message:"this metric is not defined."}}}),o},f=function e(t){var r=t;while(r!==document.body&&r.parentNode){if(r.getAttribute("data-widget-id"))return r;r=r.parentNode}return null},g=function e(t){var r={};if(t){var i=f(t);i&&(r.id=i.getAttribute("data-widget-id"),r.type=i.getAttribute("data-block-type"),r.name=i.getAttribute("data-block-name"),r.link=v(i))}return r},v=function e(t){if(t.href)return t.href;var r=t.querySelector("[href]");if(r&&r.href)return r.href;return null},I=function e(){return s&&!s.meta&&(s.meta={sessionId:u,userId:c,URL:r.toString(),siteDefaultLocale:s.getSiteObjItem("siteDefaultLocale"),countryCode:s.getSiteObjItem("countryCode"),currency:s.getSiteObjItem("currencyType"),customerLocale:s.getSiteObjItem("customerLocale"),customerLocation:s.getSiteObjItem("customerLocation"),nonce:s.getSiteObjItem("nonce"),shippingCountry:s.getSiteObjItem("shippingCountry"),elysiumVersion:s.getSiteObjItem("version"),serverIP:s.getSiteObjItem("serverIP"),siteCode:s.getSiteObjItem("siteCode"),subsiteCode:s.getSiteObjItem("subsiteCode"),siteID:s.getSiteObjItem("siteID"),productID:s.getSiteObjItem("productID")}),s.meta},S=function e(t){return b(i,t)?i[t]:""},y=function e(){return s.experiments||(s.experiments=S("experiments")),s.experiments},h=function e(t){if(!s.performanceStats||t){var r=void 0,i={};if(s.isTimingEnabled){var n=(r=s.timingAPI).navigationStart,o=r.loadEventStart,u;r.loadEventEnd>0&&(o=r.loadEventEnd),i={navigationTime:o-n,redirectTime:r.redirectEnd-r.redirectStart,cacheTime:r.domainLookupStart-r.fetchStart,dnsTime:r.domainLookupEnd-r.domainLookupStart,connectionTime:r.connectEnd-r.connectStart,backendLoadTime:r.responseEnd-r.requestStart,domInteractiveTime:r.domInteractive-n,domParsingTime:r.domInteractive-r.domLoading,domReadyTime:r.domComplete-r.domInteractive,frontendLoadTime:o-r.domInteractive},o!==r.loadEventStart&&(i.loadEventTime=o-r.loadEventStart),"number"==typeof r.msFirstPaint&&(r.firstPaint=r.msFirstPaint),r.firstPaint&&(i.firstPaintTime=Math.round(r.firstPaint-n)),a.PerformancePaintTiming&&performance.getEntriesByType("paint")[0]&&(i.firstPaintTime=Math.round(performance.getEntriesByType("paint")[0].startTime))}s.performanceStats=i}return s.performanceStats},k=function e(){if(!s.products){var t=Array.from(document.querySelectorAll(".thg-track[rel]"));s.products=t.map(function(e){return{Pid:e.getAttribute("rel")}})}return s.products},P=function e(t){if(!s.basket){var r=t[0],i,n=r.simpleBasket.basketItems.map(function(e,t){return{BasketItemId:t+1,ProductId:e.productId?0:e.productId,ChildMasterProductId:e.childMasterProductId?0:e.childMasterProductId,FreeGift:e.freeGift,Quantity:e.quantity,Price:e.price.split(";")[1]}});s.basket={BasketId:r.simpleBasket.basketId,lastAddedItem:r.simpleBasket.lastAddedItem.productId,TotalPrice:r.simpleBasket.totalprice.split(";")[1],BasketItems:n,Event:"basketItemAdded"}}return s.basket};return s.isTimingEnabled=!!a.performance,s.timingAPI={},s.isTimingEnabled&&!!a.performance.timing&&(s.timingAPI=a.performance.timing),s.getExperiments=y,s.get=b,s.getPerformanceStats=h,s.getMetaData=I,s.getWidgetData=g,s.getProducts=k,s.getMetrics=p,s.getBasket=P,s.getSiteObjItem=S,s}});
//# sourceMappingURL=columbo-metrics-830d6fde88.js.map
