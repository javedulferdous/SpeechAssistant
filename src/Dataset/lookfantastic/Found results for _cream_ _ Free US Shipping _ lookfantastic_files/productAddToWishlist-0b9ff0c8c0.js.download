"use strict";define(["app","siteObj","$window"],function(t,e,o){var i="data-product-id",n="data-selected",s="data-list-type",r="data-customer-state",a="data-unavailable",d="data-show-modal",l="data-wishlist-page",u="Wishlist Engagement",c="data-translation-added",p="data-translation-removed",h;return function u(){var h={},b={wishlistsTooltipModal:"wishlistsTooltipModal/update"},m=function e(o,n){return h.element=o,o&&(h.updateAvailabilityStateOfComponent(),h.partOfAlternatives=o.parentNode.classList.contains("productAlternatives_productAddToWishlist"),h.button=o.querySelector(".productAddToWishlist_button_default"),h.popupwindow=o.querySelector(".productAddToWishlist_popup"),h.loginbutton=o.querySelector(".productAddToWishlist_login_button"),h.closeButton=o.querySelector(".productAddToWishlist_popup_close"),h.basketPageButtonText=o.querySelector(".productAddToWishlist_basketPageButtonText"),h.otherPagesButtonIcons=o.querySelector(".productAddToWishlist_buttonIcon"),h.deleteButton=o.parentNode.querySelector(".productAddToWishlist_deleteButton"),h.heartIcon=h.element.querySelector(".heart"),h.attrs={productId:o.getAttribute(i),showWishlistsTooltipModal:o.getAttribute(d),wishlistPage:o.getAttribute(l)},h.translations={added:o.getAttribute(c),removed:o.getAttribute(p)},n||(t.subscribe("productAddToWishlist/update",h.updateProductAddToWishlist),h.partOfAlternatives?t.subscribe("productAddToWishlist/changeAlternativesWishlist",h.replaceDom):t.subscribe("productAddToWishlist/changeProductWishlist",h.replaceDom)),h.addListeners(),h.pathName=window.location.pathname,h.requestParameters=window.location.search,h.updateWishlistsTooltipModal()),h},g=function e(){"LOGGED_IN"!==h.element.getAttribute(r)&&t.publish("tracking/record","Wishlist Engagement","clicked add to wishlist | logged out",h.attrs.productId)},f=function t(){h.button.addEventListener("click",h.buttonOnClick.bind(null,h.button)),h.button.addEventListener("click",h.addToWishlistNotLoggedInEvent),h.closeButton.addEventListener("click",h.buttonOnClick.bind(null,h.button)),h.deleteButton.addEventListener("click",h.deleteOnClick.bind(null,h.button)),h.loginbutton.addEventListener("click",h.loginOnClick),"LOGGED_IN"===h.element.getAttribute(r)&&h.button.removeAttribute("aria-expanded")},w=function e(){h.button.setAttribute("aria-expanded","false"),h.popupwindow.classList.remove("productAddToWishlist_popup_show"),document.removeEventListener("keydown",h.keyboardHandler),window.removeEventListener("click",h.checkTarget),t.publish("tracking/record","Wishlist Engagement","close login pop-up",h.attrs.productId)},v=function e(o){var i=o.getAttribute(s),a=o.getAttribute(n),d;if("LOGGED_IN"===h.element.getAttribute(r))return"true"===a?(t.publish("tracking/record","Wishlist Engagement","removed from wishlist",h.attrs.productId),h.removeFromList(i).then(h.fetchDomForRemove).then(h.replaceDom).then(h.announceRemoved).catch(console.error)):(t.publish("tracking/record","Wishlist Engagement","added to wishlist",h.attrs.productId),h.addToList(i).then(h.fetchDomForAdd).then(h.replaceDom).then(h.updateWishlistsTooltipModal).then(h.animateHeartIcon).then(h.announceAdded).catch(console.error));h.popupwindow.classList.contains("productAddToWishlist_popup_show")&&t.publish("tracking/record","Wishlist Engagement","close login pop-up",h.attrs.productId),h.toggleWishlistTooltip()},T=function t(){var e=h.popupwindow.classList.contains("productAddToWishlist_popup_show");h.popupwindow.classList.toggle("productAddToWishlist_popup_show"),e?(h.button.setAttribute("aria-expanded","false"),h.button.focus(),h.closePopup()):(h.button.setAttribute("aria-expanded","true"),h.loginbutton.focus(),document.addEventListener("keydown",h.keyboardHandler),window.addEventListener("click",h.checkTarget))},A=function t(e){!h.element.contains(e.target)&&h.popupwindow.classList.contains("productAddToWishlist_popup_show")&&h.closePopup()},W=function o(i){i.preventDefault(),t.publish("tracking/record","Wishlist Engagement","clicked login link",h.attrs.productId);var n=h.button.getAttribute(s),r=h.getReqParam("recentlyDeleted"),a=e.siteURL+"wishlist.account?prodId="+h.attrs.productId+"&type="+n+"&wishlisted="+r+"&origin="+h.pathName+"&fromWishlist=true";window.location.href=a},k=function e(){return new Promise(function(e,o){return t.ajax.get({url:"/"+h.attrs.productId+".addToWishlist/?isInWishlist=false",success:e,error:o})})},L=function e(){return new Promise(function(e,o){return t.ajax.get({url:"/"+h.attrs.productId+".addToWishlist/?isInWishlist=true",success:e,error:o})})},I=function e(o,i){i||(h.partOfAlternatives?t.publish("productAddToWishlist/changeProductWishlist",o,true):t.publish("productAddToWishlist/changeAlternativesWishlist",o,true));var n=h.element.parentNode;n.innerHTML=o;var s=n.querySelector("[data-component=productAddToWishlist]");h.init(s,true)},E=function e(o){var i="false",n="/"+o+"/false/addTo.collections";return new Promise(function(e,o){return t.ajax.post({url:n+"?fromWishlist=true&productID="+h.attrs.productId,send:[h.attrs.productId],requestHeader:{header:"Content-Type",value:"application/json"},success:e,error:o})})},y=function e(o){return new Promise(function(e,i){return t.ajax.call({url:"/"+o+"/removeFrom.collections?fromWishlist=true&productID="+h.attrs.productId,send:[h.attrs.productId],type:"DELETE",requestHeader:{header:"Content-Type",value:"application/json"},success:e,error:i})})},_=function e(o){t.publish("tracking/record","Wishlist Engagement","removed from wishlist",h.attrs.productId);var i=o.getAttribute(s);h.removeFromList(i).then(function(){return window.location.reload()})},C=function e(){"true"===h.attrs.showWishlistsTooltipModal&&"true"!==h.attrs.wishlistPage&&(h.setCookie("wishlistsTooltipModalCookie","wishlistsTooltipModalShown"),o.setTimeout(function(){return t.publish(h.subscribeChannels.wishlistsTooltipModal,true)},1e3))},P=function t(e,o){var i="/",n=new Date;n.setFullYear(n.getFullYear()+5),document.cookie=e+"="+o+"; expires="+n.toUTCString()+"; path=/"},D=function t(e){if(e=new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(location.search))return decodeURIComponent(e[1])},O=function t(){var o=e.siteURL+"my.basket?wishlisted="+h.attrs.productId;window.location.href=o},q=function e(o,i){if(!i)return new Promise(function(){return t.ajax.get({url:"/"+o+".addToWishlist",success:h.replaceDom,error:h.errorHandler})});h.updateAvailabilityStateOfComponent(true)},x=function t(){console.error("ERROR: Could not retrieve new productAddToWishlist information")},R=function t(){h.heartIcon&&h.heartIcon.classList.add("heartscale")},S=function e(){h.button.focus(),t.publish("accessibility/announce","assertive",h.translations.added)},M=function e(){h.button.focus(),t.publish("accessibility/announce","assertive",h.translations.removed)},N=function t(){switch(event.key){case"Esc":case"Escape":h.closePopup(event);break;default:}},F=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.element.getAttribute(a),o=h.element.parentNode;"true"===e?o.classList.contains("disabled")||o.classList.add("disabled"):o.classList.contains("disabled")&&o.classList.remove("disabled")};return h.init=m,h.addListeners=f,h.closePopup=w,h.buttonOnClick=v,h.checkTarget=A,h.loginOnClick=W,h.fetchDomForRemove=k,h.fetchDomForAdd=L,h.replaceDom=I,h.addToList=E,h.removeFromList=y,h.deleteOnClick=_,h.updateWishlistsTooltipModal=C,h.setCookie=P,h.getReqParam=D,h.redirectConfirmation=O,h.updateProductAddToWishlist=q,h.errorHandler=x,h.addToWishlistNotLoggedInEvent=g,h.animateHeartIcon=R,h.announceAdded=S,h.announceRemoved=M,h.toggleWishlistTooltip=T,h.subscribeChannels=b,h.keyboardHandler=N,h.updateAvailabilityStateOfComponent=F,h}});
//# sourceMappingURL=productAddToWishlist-0b9ff0c8c0.js.map
