"use strict";define(["app","siteObj","module"],function(t,e,a){var i;return function e(){var i=this,s={dataAttributes:{productIdSelector:"data-product-id",childId:"data-child-id",siteIdSelector:"data-site-id",fromWishlist:"data-from-wishlist",defaultLocaleSelector:"data-default-locale",subsiteCodeSelector:"data-subsite-code",eGiftSelector:"data-eGift",headerBasketSelector:"header-basket",basketItemsSelector:"basket-items",basketQuantityClass:"header-menu-basket-counter",skipAddedToBasket:"data-skip",context:"data-context",wishlistPage:"data-wishlist-page",linkedProduct:"data-linked-product",subscriptionContractId:"data-subscription-contract-id",purchaseMethod:"data-basket-purchase-method"},selectors:{productVariations:"[data-variation-container=productVariations]",individualVariation:".individualVariation",iRazor:".productAddToBasket-iRazor",productPromotionalMessage:"#productPromotionalMessage"},ids:{productPromotionalMessage:"productPromotionalMessage"},subscribeChannels:{variations:"productVariations/variationData",quantity:"productQuantityInput/quantityData",addedToBasket:"productAddedToBasket/loadSuccess",eGift:"producteGift/eGift",eGiftAddToBasket:"producteGift/addToBasket",subscribeAndSaveContracts:"subscribeAndSaveContracts/changeContractId",subscribeAndSaveDisableBasket:"productAddToBasket/disableBasket"},publishChannels:{subscribeAndSaveProductInBasketMessage:"subscribeAndSaveProductInBasket/showMessage",productQuantityDisable:"productQuantityInput/disable"},stateObject:{variationTitle:"variation"},soldOutClass:"productAddToBasket-soldOut"},r=function e(s,r){if(i.element=s,i.element){if(i.parentElement=i.element.parentElement.parentElement,i.quantity={value:1,max:99,inBasket:0},i.parentElement&&(i.allVariations=i.parentElement.querySelectorAll(i.config.selectors.individualVariation),i.wishlistPage=i.parentElement.getAttribute(i.config.dataAttributes.wishlistPage),i.linkedProduct=i.parentElement.getAttribute(i.config.dataAttributes.linkedProduct),i.productId=i.parentElement.getAttribute(i.config.dataAttributes.productIdSelector),i.childProductId=i.element.getAttribute(i.config.dataAttributes.productIdSelector),i.iRazor=i.parentElement.querySelector(i.config.selectors.iRazor),i.subscriptionContractId=i.parentElement.getAttribute(i.config.dataAttributes.subscriptionContractId),"true"===i.linkedProduct&&r&&(i.productId=r),i.siteId=i.parentElement.getAttribute(i.config.dataAttributes.siteIdSelector),i.defaultLocale=i.parentElement.getAttribute(i.config.dataAttributes.defaultLocaleSelector),i.subsiteCode=i.parentElement.getAttribute(i.config.dataAttributes.subsiteCodeSelector),i.eGift=i.element.getAttribute(i.config.dataAttributes.eGiftSelector),i.skipAddedToBasket=i.element.getAttribute(i.config.dataAttributes.skipAddedToBasket),i.context=i.parentElement.getAttribute(i.config.dataAttributes.context),i.fromWishlist=i.parentElement.getAttribute(i.config.dataAttributes.fromWishlist)),"true"===i.wishlistPage)i.variationReceived(i.buildVariations());else{var n=t.subscribe(i.config.subscribeChannels.variations,i.variationReceived);i.checkSubscribeMessages(n,i.variationReceived)}var o=t.subscribe(i.config.subscribeChannels.quantity,i.quantityReceived);i.checkSubscribeMessages(o,i.quantityReceived),t.subscribe(i.config.subscribeChannels.subscribeAndSaveContracts,i.subscriptionContractsChangeContractId),t.subscribe(i.config.subscribeChannels.subscribeAndSaveDisableBasket,i.subscribeAndSaveAddToBasket),i.element.hasAttribute(i.config.dataAttributes.purchaseMethod)&&(i.purchaseMethod=i.element.getAttribute(i.config.dataAttributes.purchaseMethod),t.publish(i.config.publishChannels.subscribeAndSaveProductInBasketMessage,i.purchaseMethod)),i.eGift?(t.subscribe(i.config.subscribeChannels.eGift,i.eGiftReceived),i.element.addEventListener("click",i.egiftAddToBasket)):i.skipAddedToBasket?i.element.addEventListener("click",i.triggerAddStraightToBasket):i.iRazor?i.element.addEventListener("click",i.customiseiRazor):i.element.addEventListener("click",i.triggerAddToBasket)}return i.basketHeaderClass=a.config().basketHeaderClass||i.config.dataAttributes.headerBasketSelector,i.basketHeaderID=a.config().basketHeaderID||false,i.basketItemsContainerClass=a.config().basketItemsContainerClass||i.config.dataAttributes.basketItemsSelector,i.element.hasAttribute("disabled")&&!i.element.classList.contains(i.config.soldOutClass)&&i.element.setAttribute("disabled",false),document.querySelector(i.config.selectors.productPromotionalMessage)&&i.element.setAttribute("aria-describedby",i.config.ids.productPromotionalMessage),i},n=function t(){i.iRazor.href+="&qty="+i.quantity.value},o=function t(e){var a=e.variationLength,s=e.variations;i.variationsObject={variationLength:a,variations:s},i.canAdd()?i.enableAddToBasket():i.disableAddToBasket()},d=function t(e){var a=e.value,s=e.max,r=e.inBasket;i.quantity={value:a>0&&a<100?a:1,max:s,inBasket:r},i.canAdd()?i.enableAddToBasket():i.disableAddToBasket()},c=function e(){var a=i.quantity,s=i.variationsObject;if(!a||!s)return false;if(t.element.hasClass(i.config.soldOutClass,i.element))return false;if(a.max&&a.inBasket&&a.value+a.inBasket>a.max)return false;if(s.variationLength!==s.variations.length)return false;if(s.variations.some(function(t){return!t}))return false;return true},u=function t(){i.element.disabled=false},l=function t(){i.element.disabled=true},b=function t(e,a){var i;e.messages.length>0&&a(e.messages.slice(-1)[0])},f=function e(){t.publish("addedToBasketModal/hideError","",false),t.publish("productQuickbuy/hideError","",false),t.publish("productQuickbuy/startLoading","",false),i.childProductId?t.publish("tracking/record","Product | AddToBasket","clicked",i.productId,i.childProductId):t.publish("tracking/record","Product | AddToBasket","clicked",i.productId),i.postAddToBasket(i.querystringifyStateObject(i.createStateObject()))},p=function t(){var e,a=document.querySelector(i.config.selectors.productVariations).getAttribute(i.config.dataAttributes.childId);window.location.href="/my.basket?buylist="+a+":1"},g=function e(a){var s=i.querystringifyStateObject(i.createStateObject());s&&s.length>0&&a&&t.ajax.post({url:"/basketinterface.json?"+s,send:JSON.stringify(a),success:i.addToBasketSuccess,error:i.eGiftError})},h=function e(){t.publish("producteGift/eGiftError","")},k=function e(a){a&&a.length>0&&t.ajax.get({url:"/basketinterface.json?"+a,success:i.addToBasketSuccess,error:i.addToBasketError})},A=function e(){t.publish("productQuickbuy/stopLoading","",false),t.publish("productQuickbuy/showError","",false),t.publish("addedToBasketModal/showError","",false)},m=function e(a){var s=JSON.parse(a),r=i.getLastAddedItemData(s.simpleBasket,i.createStateObject());if(r.subscriptionContractId?(i.element.setAttribute(i.config.dataAttributes.purchaseMethod,"subscription"),t.publish(i.config.publishChannels.subscribeAndSaveProductInBasketMessage,"subscription")):(i.element.setAttribute(i.config.dataAttributes.purchaseMethod,"otp"),t.publish(i.config.publishChannels.subscribeAndSaveProductInBasketMessage,"otp")),t.publish("productQuickbuy/hideModal","",false),t.publish("addedToBasketModal/productAdded",r,false),t.publish("globalBasketItemsCount/updateGlobalBasketItemsCount",r.basketTotalItems),t.publish("BasketItemAdded",s),s.simpleBasket.lastAddedItem){var n=s.simpleBasket.lastAddedItem.productId;window.dataLayer.length&&(window.dataLayer[0].lastAddedItemSku=n)}},v=function t(e){var a=e.lastAddedItem,i={productId:a.productId,productTitle:a.productTitle,productUrl:a.productURL,productQuantity:e.lastAddedQuantity,productQuantityRequested:e.lastAddedQuantityRequested,productPrice:a.price,basketTotalPrice:e.totalprice,recommendations:e.recommendations,basketTotalItems:e.totalUnits,message:e.message,lastAddedMaxPerOrder:a.maxPerOrder,loyaltySchemePoints:e.loyaltySchemePoints,subscriptionContractId:a.subscriptionContractId},s="";return a.productImages&&a.productImages.largeproduct&&(s=a.productImages.largeproduct),i.productImageUrl=s,i},I=function t(e){var a=[];for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];0===i.indexOf("variation")&&"variationLength"!==i&&(s=i+":"+s),a.push(i+"="+s)}return a.join("&")},B=function t(){var e={productId:i.productId,siteId:i.siteId,siteDefaultLocale:i.defaultLocale,siteSubsiteCode:i.subsiteCode,variationLength:null,quantity:null,fromWishlist:i.fromWishlist};i.context&&(e.rctxt=i.context),i.subscriptionContractId&&(e.subscriptionContractId=i.subscriptionContractId,e.enableSubscribeAndSave=true);var a=i.transformVariations(e);return a=i.transformQuantity(a)},S=function t(e){var a=i.variationsObject;if(a&&a.variations){e.variationLength=a.variationLength;for(var s=0;s<a.variations.length;s++){var r=a.variations[s];e[i.config.stateObject.variationTitle+(s+1)]=r}}return e},y=function t(e){return e.quantity=i.quantity?i.quantity.value:1,e},C=function e(){t.publish(i.config.subscribeChannels.eGiftAddToBasket,"")},T=function t(){for(var e={variationLength:i.allVariations.length,variations:[]},a=0;a<i.allVariations.length;a++){var s=i.allVariations[a];if("-1"===s.getAttribute("data-variation-id"))return{variationLength:i.allVariations.length,variations:[]};e.variations.push(s.getAttribute("data-variation-id"))}return e},P=function t(e){i.parentElement.hasAttribute(i.config.dataAttributes.subscriptionContractId)&&(i.parentElement.setAttribute(i.config.dataAttributes.subscriptionContractId,e),i.subscriptionContractId=e)},E=function e(a){var s=a||!i.canAdd();s?i.disableAddToBasket():i.enableAddToBasket(),t.publish(i.config.publishChannels.productQuantityDisable,s)};i.init=r,i.config=s,i.variationReceived=o,i.quantityReceived=d,i.canAdd=c,i.enableAddToBasket=u,i.disableAddToBasket=l,i.checkSubscribeMessages=b,i.triggerAddToBasket=f,i.triggerAddStraightToBasket=p,i.createStateObject=B,i.transformVariations=S,i.transformQuantity=y,i.querystringifyStateObject=I,i.postAddToBasket=k,i.addToBasketSuccess=m,i.addToBasketError=A,i.getLastAddedItemData=v,i.eGiftReceived=g,i.eGiftError=h,i.egiftAddToBasket=C,i.customiseiRazor=n,i.buildVariations=T,i.subscriptionContractsChangeContractId=P,i.subscribeAndSaveAddToBasket=E}});
//# sourceMappingURL=productAddToBasket-7bd37bf35d.js.map
