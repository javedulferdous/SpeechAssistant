"use strict";var _slicedToArray=function(){function e(e,t){var r=[],n=true,o=false,a=void 0;try{for(var i=e[Symbol.iterator](),s;!(n=(s=i.next()).done);n=true)if(r.push(s.value),t&&r.length===t)break}catch(e){o=true,a=e}finally{try{!n&&i["return"]&&i["return"]()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define(["responsiveFacets","responsivePagination","responsiveSort","app","componentHelper","$window","$console","lazyloadIntersectionObserver","accessibilityFocusHelper"],function(e,t,r,n,o,a,i,s,c){return function(){var l=48,u="|",p=":",d=".responsiveEmptySearchResult",f={sectionPath:"data-section-path",isSearch:"data-is-search",show:"data-show",navOffset:"data-nav-offset",focusedFacetCategory:"data-focused-facet-category",showAllFilters:"data-open-filters",horizontalFacets:"data-horizontal-facets",priceFacetCategoryName:"data-price-facet-category",preventPageUpdate:"data-prevent-update"},v={component:'[data-component="responsiveProductListPage"]',loaderOverlay:".responsiveProductListPage_loaderOverlay",facets:".responsiveFacets",pagination:".responsivePaginationPages",sortSelector:".responsiveSort",goToRefineSectionButton:".responsiveProductListPage_goToRefineSectionButton",refineTitle:"#responsive-facets-title"},y={search:"/search.productlist",section:"/section/{}.productlist"},g={update:"responsiveProductListPage/update",horizontalFacetsError:"responsiveProducts/horizontalFacets",responsiveFacetsError:"responsiveProducts/responsiveFacets"},h={element:null,overlay:null,sectionPath:null,facets:null,lazyLoading:null,query:{search:void 0,perPage:void 0,pageNumber:void 0,facetFilters:void 0,sortOrder:void 0,hasLazyLoadingImages:void 0},_channels:g,_attrs:f,init:function(e){h.element=e,h.overlay=e.querySelector(v.loaderOverlay),h.goToRefineSectionButton=e.querySelector(v.goToRefineSectionButton),h.nav=e.querySelector(v.nav),h.isSearch="true"===e.getAttribute(f.isSearch),h.sectionPath=e.getAttribute(f.sectionPath),h.horizontalFacetsEnabled=e.getAttribute(f.horizontalFacets),h.priceFacetCategoryName=e.getAttribute(f.priceFacetCategoryName),h.initDeps(),n.subscribe(g.update,h.update),a.addEventListener("popstate",h.onHistoryChange),h.goToRefineSectionButton.addEventListener("click",h.skipToRefineSection)},initDeps:function(){h.facets=new e,h.pagination=new t,h.sortSelector=new r,h.lazyLoading=new s,h.facets.init(h.element),h.pagination.init(h.element),h.sortSelector.init(h.element)},build:function(){var e;a.location.search.substr(1).split("&").forEach(function(e){var t=/^([^=]*)=(.*)$/gi;if(!e.match(t))return;var r=t.exec(e),n=_slicedToArray(r,3),o=n[1],a=n[2];h.query.hasOwnProperty(o)&&(h.query[o]=a)})},update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];h.overlay.setAttribute(f.show,"true"),h.build(),h.query=Object.assign(h.query,{pageNumber:1},e);var r=void 0;r=h.isSearch?y.search:y.section.replace("{}",h.sectionPath),"true"===h.horizontalFacetsEnabled&&h.element.setAttribute(f.preventPageUpdate,h.lastSelectionFromPriceFacet(e)),n.ajax.get({url:r+"?"+h.serialise(),success:function e(r){return h.onSuccess(r,t)},error:h.onError})},serialise:function(){return Object.keys(h.query).filter(function(e){return void 0!==h.query[e]}).map(function(e){return e+"="+h.query[e]}).join("&")},onSuccess:function(e,t){var r=h.element.getAttribute(f.focusedFacetCategory),i=h.element.getAttribute(f.showAllFilters);if(h.overlay.setAttribute(f.show,"false"),h.preventUpdate(e))n.publish(h.priceFacetErrorChannel());else{var s=h.parseQuery(a.location.search);s=Object.assign(s,h.query);var c=a.location,l=c.pathname,u=c.hash,p=Object.keys(s).filter(function(e){return void 0!==s[e]}).map(function(e){return e+"="+s[e]}).join("&");t&&a.history.pushState({},a.document.title,l+"?"+p+u);var d=h.element.parentElement;h.element.outerHTML=e,h.element=d.querySelector(v.component),h.overlay=h.element.querySelector(v.loaderOverlay),h.facets.init(h.element),h.pagination.init(h.element),h.sortSelector.init(h.element),h.lazyLoading.init(),n.publish("productQuickbuy/reinitialise"),o.reloadAllComponents(h.element);var y=parseInt(h.element.getAttribute(f.navOffset))||48,g=a.pageXOffset||a.document.documentElement.scrollLeft,m=(a.pageYOffset||a.document.documentElement.scrollTop)+h.element.getBoundingClientRect().top-y;a.scrollTo(g,Math.max(m,0)),r&&h.element.setAttribute(f.focusedFacetCategory,r),i&&h.element.setAttribute(f.showAllFilters,i),n.publish("topProductCategory/update"),h.goToRefineSectionButton=h.element.querySelector(v.goToRefineSectionButton),h.goToRefineSectionButton&&h.goToRefineSectionButton.addEventListener("click",h.skipToRefineSection)}},onError:function(){i.error("Cannot reload facets.",arguments),h.overlay.setAttribute(f.show,"false"),h.facets.error()},parseQuery:function(e){var t={},r=e.substr(1).split("&").map(function(e){return e.split("=")}),n=true,o=false,a=void 0;try{for(var i=r[Symbol.iterator](),s;!(n=(s=i.next()).done);n=true){var c=s.value,l=_slicedToArray(c,2),u=l[0],p=l[1];t[u]=p}}catch(e){o=true,a=e}finally{try{!n&&i.return&&i.return()}finally{if(o)throw a}}return t},lastSelectionFromPriceFacet:function(e){if(e&&e.facetFilters){var t=e.facetFilters.split("|");return t[t.length-1].split(":")[0]===h.priceFacetCategoryName}return false},priceFacetErrorChannel:function(){if(a.screen.width>=900)return g.horizontalFacetsError;return g.responsiveFacetsError},preventUpdate:function(e){if("true"===h.element.getAttribute(f.preventPageUpdate)){var t=document.createElement("div");return t.innerHTML=e,null!==t.querySelector(d)}return false},onHistoryChange:function(){h.query={search:void 0,perPage:void 0,pageNumber:void 0,facetFilters:void 0,sortOrder:void 0,hasLazyLoadingImages:void 0};var e=h.parseQuery(a.location.search);h.update({pageNumber:e["pageNumber"]||1},false)},skipToRefineSection:function(){var e=document.querySelector(v.refineTitle);e&&c.focusAndScroll(e)}};return h}});
//# sourceMappingURL=responsiveProductListPage-f9d7c877e5.js.map
