ReamazePushAgent={initialize:function(){window.ReamazePushData?(this.data=window.ReamazePushData,this.handleSubscription()):window.addEventListener("ReamazePushDataInit",function(){this.data=window.ReamazePushData,this.handleSubscription()}.bind(this))},handleSubscription:function(){var e="serviceWorker"in navigator&&"PushManager"in window,t="undefined"!=typeof Notification?Notification.permission:null;"undefined"!=typeof this.data.customVapidToken?this.data.customVapidToken&&this.saveVapidToken(this.data.customVapidToken):e&&"granted"==t&&this._nonReamazeDomain()&&this.registerServiceWorker()},saveVapidToken:function(e){httpRequest=new XMLHttpRequest,httpRequest.open("POST",this.data.baseDataUrl+"/data/push_tokens.json",!0),httpRequest.setRequestHeader("Content-Type","application/json");var t=JSON.stringify({sso:this.data.currentUser.ssoData(),push_token:{token:e,token_name:null,device_id:null,platform:"vapid",status:this.data.subscribed?"active":"paused"}});httpRequest.send(t)},registerServiceWorker:function(){var e=function(t){worker=null,t.installing?worker=t.installing:t.waiting?worker=t.waiting:t.active&&(worker=t.active),worker&&("activated"==worker.state?this.subscribeToken(t):worker.addEventListener("statechange",function(e){"activated"==e.target.state&&this.subscribeToken(t)}.bind(this)))}.bind(this);navigator.serviceWorker.register("/apps/reamaze/sdks/rmzServiceWorker.js").then(e)["catch"](function(){navigator.serviceWorker.register("/sdks/rmzServiceWorker.js").then(e)["catch"](function(){navigator.serviceWorker.register("/rmzServiceWorker.js").then(e)["catch"](function(){})})}),navigator.serviceWorker.ready.then(function(e){this.subscribeToken(e)}.bind(this))},subscribeToken:function(e){e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlB64ToUint8Array("BB4X1o9wQvuF7xVsk1NSgSLQlw-UB-NvdYvpc67vxa9GuHOKCBhXM9QyJUiaAAtSILVblrunLrQeuMOYImJuoI8")}).then(function(e){this.saveVapidToken(JSON.stringify(e.toJSON()))}.bind(this))},urlB64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),n=new Uint8Array(i.length),a=0;a<i.length;++a)n[a]=i.charCodeAt(a);return n},_nonReamazeDomain:function(){return!window.location.href.match(/reamaze\.com/)}},ReamazePushAgent.initialize();