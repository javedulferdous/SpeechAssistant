(window.gvpc_shop_header=window.gvpc_shop_header||[]).push([[21],{242:function(t,e,i){"use strict";i.r(e);var s=i(0),n=i.n(s),a=i(27),o=i(17),r=i(6),c=i.n(r),l=i(3),p=i(34),h=i(37),d=i(20),u=i(24),b=i(29),f=new c.a(l.LocalStorageHandler);class _ extends n.a.Component{constructor(t){super(t),this.wrapperRef=n.a.createRef(),this.state={is_notifi_visible:!1},this.handleClickOutside=this.handleClickOutside.bind(this),this.onHandleToastClick=this.onHandleToastClick.bind(this),this.dispatchRequestToInterruptionsManager=this.dispatchRequestToInterruptionsManager.bind(this),this.listenToInterruptionsManagerResponse=this.listenToInterruptionsManagerResponse.bind(this),this.showNotification=this.showNotification.bind(this)}componentDidMount(){this.getPersistenceData(b.a)||this.manageToast(),document.addEventListener("click",this.handleClickOutside)}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside)}componentDidUpdate(t,e){"ShoppingHistory"===this.props.activeHeadingItem&&"ShoppingHistory"!==t.activeHeadingItem&&this.setPersistenceData("BBY_IS_RECENTLY_VIEWED_OPENED",{expireAt:this.getExpiryDate()})}manageToast(){Object(p.b)().then(t=>{this.setPersistenceData("BBY_RECENTLY_VIEWED_DATA",{expireAt:this.getExpiryDate()}),t.length>0&&(this.listenToInterruptionsManagerResponse(),this.dispatchRequestToInterruptionsManager())})}listenToInterruptionsManagerResponse(){var{instanceId:t}=this.props;Object(d.listen)(t=>{t.type===h.a&&t.payload.interruptionType===b.f&&t.payload.permissionGranted&&this.showNotification()},t)}showNotification(){var{liveConfig:t}=this.props,e=t.toastWaitTime?t.toastWaitTime:3e3;this.setState({is_notifi_visible:!0}),this.setPersistenceData("BBY_IS_TOAST_DISPLAYED",{expireAt:this.getExpiryDate()}),Object(u.dispatch)({type:"TRACK_DATA",reportingVariables:{"bb.notification":1,"bb.notificationType":"Notification:Recently Viewed"}}),setTimeout(()=>{this.state.is_notifi_visible&&(this.setState({is_notifi_visible:!1}),Object(u.dispatch)({type:"TRACK_DATA",reportingVariables:{"bb.notification_":1,"bb.notificationType":"Notification:Recently Viewed:Timeout Close"}}))},e)}dispatchRequestToInterruptionsManager(){var{instanceId:t,liveConfig:e,deviceClass:i}=this.props,s=e.toastWaitTime?e.toastWaitTime:3e3;return Object(d.dispatch)({type:h.b,payload:{deviceClass:i,interruptionId:b.e,interruptionType:b.f,placement:"header",requestedInterruptionDuration:s}},t)}getPersistenceData(t){return f.get(t)}setPersistenceData(t,e){f.set(t,!0,e)}handleClickOutside(t){this.wrapperRef.current&&!this.wrapperRef.current.contains(t.target)&&(this.setState({is_notifi_visible:!1}),Object(u.dispatch)({type:"TRACK_DATA",reportingVariables:{"bb.notification":1,"bb.notificationType":"Notification:Recently Viewed:Close"}}))}onHandleToastClick(t,e){var{handleOpenMenu:i,styleId:s}=this.props;this.noBubble(e),Object(u.dispatch)({type:"TRACK_DATA",reportingVariables:{"bb.notification":1,"bb.notificationType":"Notification:Recently Viewed"}}),"overlay"===t?(i(s),this.setState({is_notifi_visible:!1})):this.setState({is_notifi_visible:!1})}getExpiryDate(){var t=new Date,e=new Date;return e.setDate(t.getDate()+1),e}noBubble(t){(t=t||event)&&(t.returnValue=!1,t.cancelBubble=!0,t.stopPropagation(),t.preventDefault())}render(){var{is_notifi_visible:t}=this.state;return t?n.a.createElement("div",{className:"notification-toast shopping-history-toast",ref:this.wrapperRef},n.a.createElement(o.PLButton,{buttonStyle:"unstyled",className:"notifi_toastBtn shopping-history_toastBtn",size:"medium",onClick:t=>this.onHandleToastClick("overlay",t)},n.a.createElement("h3",null,"Welcome back!"),n.a.createElement("div",{className:"notifi_cnt"},"See the items youâ€™ve recently viewed.")),n.a.createElement(o.PLButton,{buttonStyle:"unstyled",size:"medium",href:"#",className:"notifi_closeBtn",onClick:t=>this.onHandleToastClick("close",t)},n.a.createElement(a.a,{fill:"#0046be",width:"15",height:"15",iconString:"Close_Cancel_Line"}))):null}}e.default=_}}]);
//# sourceMappingURL=welcome-back-f9661a9f6186ef8929eebb9a36c73bb3.mjs.map