!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e){t.exports=_},function(t,e){t.exports=actionLog},function(t,e){t.exports={creatorNamespace:"shop",componentId:"interruptions-manager",componentVersion:"",contractVersion:"v1",assetBasePath:"dist/client"}},function(t,e){t.exports=initializer},function(t,e,r){const n=window.metaLayer||window._metaLayer,i="shop/interruptions-manager/dist/client/",o=n?`${n.env_assets}/${i}`:i;r.p=o},function(t,e,r){"use strict";r.r(e),r.d(e,"init",(function(){return q}));r(4);var n=r(3),i=r.n(n),o=r(2),a=r(1);const s={},u=[],c="Interruptions Manager received an interruption request action without",p="Interruptions Manager received an interruption request action without or with an invalid",l="is a required payload parameter.",d="is a required and must be a valid payload parameter.",f=()=>{};var y=r(0);class h{constructor(t,e){this._defaultState=t,this._localStorageKey=e}clearStorage(){localStorage.setItem(this._localStorageKey,JSON.stringify(this._defaultState))}getStoredValue(){let t;try{t=JSON.parse(localStorage.getItem(this._localStorageKey))}catch(e){this.clearStorage(),t=this._defaultState}return t}appendArrayItem(t){let e=this.getStoredValue();Array.isArray(e)||(this.clearStorage(),e=this._defaultState),e.push(t),this.setValue(e)}setValue(t){("Interruptions-Manager-Request-History-Key"!==this._localStorageKey||Array.isArray(t))&&localStorage.setItem(this._localStorageKey,JSON.stringify(t))}}const m=t=>{new h(u,"Interruptions-Manager-Request-History-Key").appendArrayItem(t)};function g(){return new h(s,"Interruptions-Manager-Business-Rules").getStoredValue()}function S(t){const e=Object(y.get)(g(),"priorities");return Object(y.get)(e,t,0)}const I=["price-change-notification","test-notification","sign-in-toast-notification","email-modal-notification","last-item-viewed-toast-notification","alt-pickup-toast-notification","total-tech-support-toast-notification"],b=t=>`Interruption permission has been granted. The permitted interruptionDuration is ${t} milliseconds, which should match your request.`,w=(t,e)=>{const r={interruptionId:t.payload.interruptionId,interruptionType:t.payload.interruptionType,interruptionDuration:t.payload.requestedInterruptionDuration},n=window.location.pathname;if(e)return r.interruptionDuration=0,r.permissionGranted=!1,r.reason="A request for interruption with higher priority was granted permission.",r;try{(t=>{const e=["header","footer"];if(!t.interruptionId)throw new Error(v("interruptionId"));if(!t.interruptionType||!I.includes(t.interruptionType))throw new Error(O("interruptionType"));if(!t.requestedInterruptionDuration)throw new Error(v("requestedInterruptionDuration"));if(!t.placement||!e.includes(t.placement))throw new Error(O("placement"))})(t.payload);const e=Object(y.get)(g(),"blacklist"),i=((t,e,r)=>{const n=(e[t.interruptionType]||[]).filter(t=>t.url===r),i=0===n.length,o=i?t.requestedInterruptionDuration:0;return{permissionGranted:i,interruptionDuration:o,reason:n.length>0?n[0].reason:b(o)}})(t.payload,e,n),o=i.permissionGranted,a=i.interruptionDuration,s=i.reason;r.permissionGranted=o,r.interruptionDuration=a,r.reason=s}catch(t){r.interruptionDuration=0,r.permissionGranted=!1,r.reason="Error: "+t.message}return r},v=t=>`${c} ${t}. ${t} ${l}`,O=t=>`${p} ${t}. ${t} ${d}`;function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return T(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}class A{constructor(t,e){this.actionQueue=[],this.duration=e,this.actionHandler=t,this.timeout=null}addAction(t,e){this.actionQueue.push([t,e]),this.timeout||(this.timeout=setTimeout(()=>{this._handleActions(),this.timeout=null},this.duration))}_handleActions(){this._sortActionsByPriority(),this.actionQueue.forEach(t=>{let e=_(t,2),r=e[0],n=e[1];return this.actionHandler(r,n)}),this.actionQueue=[]}_sortActionsByPriority(){this.actionQueue.sort((t,e)=>{let r=_(t,1)[0],n=_(e,1)[0];const i=S(Object(y.get)(r,"payload.interruptionType")),o=S(Object(y.get)(n,"payload.interruptionType"));return i===o?0:i<o?1:-1})}}let E,j=!1;function R(t,e){const r=w(t,j);var n;r.permissionGranted&&(j=!0),Object(a.dispatch)({type:"INTERRUPTION_PERMISSION_RESPONSE",payload:{interruptionDuration:(n=r).interruptionDuration,interruptionId:n.interruptionId,interruptionType:n.interruptionType,permissionGranted:n.permissionGranted,reason:n.reason}},e)}function D(t,e,r){E||(E=new A(R,Object(y.get)(g(),"batchDuration"))),m(t),E.addAction(t,r)}function N(t,e,r){m(t)}const P=t=>{Object(a.listen)((e,r)=>{(function(t,e){switch(t.type){case"REQUEST_INTERRUPTION_PERMISSION":return D;case"INTERRUPTION_STATUS_UPDATE":return N;default:return f}})(e)(e,r,t)},t)},M={componentId:o.componentId,contractVersion:o.contractVersion,creatorNamespace:o.creatorNamespace},q=(t,e,r,n)=>{$(r.app);const i=()=>{P(t)};"interactive"===document.readyState?i():document.addEventListener("DOMContentLoaded",i)},$=t=>{const e=new h(s,"Interruptions-Manager-Business-Rules");t.hasBusinessRulesError?e.setValue({hasBusinessRulesError:t.hasBusinessRulesError}):e.setValue(t.businessRules)};i.a.registerComponent(M,q)}]);
//# sourceMappingURL=client-6ca391413ddf4ac92550b3fdfaf8e470.mjs.map