!function(){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function e(t,e,r,n){return new(r||(r=Promise))((function(s,o){function i(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,a)}u((n=n.apply(t,e||[])).next())}))}Object.create;var r,n,s,o;Object.create;(n=r||(r={})).Search="Search",n.RoomsAndRates="RoomsAndRates",n.Confirmation="Confirmation",n.Payment="Payment",n.Group="Group",n.Partial="Partial",n.Unknown="Unknown",(o=s||(s={})).Singleton="Singleton",o.ApplicationHost="ApplicationHost",o.DataSource="DataSource";var i=function(){var r=this,n={exports:this};function s(t){switch(typeof t){case"undefined":return!0;case"string":return""===t.trim();case"number":return isNaN(t);case"object":if(null==t)return!0;if(t.constructor===Object)return 0===Object.keys(t).length;if(Array.isArray(t))return 0===t.length}return!1}r.__esModule=!0,r.isEmpty=s;r.Strings=class{static noWhitespace(t){return t&&"string"==typeof t?t.replace(/\s+/g,""):""}static startWith(t,e){return t?t.substring(0,e.length)===e:t===e}static endsWith(t,e){return t.substring(t.length-e.length,t.length)===e}static isEmpty(t){return null==t||0===t.trim().length}static isLowerCase(t){return t===t.toLowerCase()&&t!==t.toUpperCase()}static isUpperCase(t){return t===t.toUpperCase()&&t!==t.toLowerCase()}static kebabCase(t){return t.replace(/([A-Z][a-z]+)/g,"$1-").toLowerCase().replace(/-$/,"")}};class o{static keys(t){return Object.keys(t)}static values(t){return Object.keys(t).map((e=>t[e]))}static entries(t){return Object.keys(t).map((e=>[e,t[e]]))}static removeEmpty(t){return t&&t.constructor===Object?Object.keys(t).reduce(((e,r)=>{const n=o.removeEmpty(t[r]);return s(n)||(e[r]=n),e}),{}):t}static sort(t){return t?Array.isArray(t)?t.map(o.sort):t.constructor===Object?Object.keys(t).sort().reduce(((e,r)=>{const n=t[r];return e[r]=o.sort(n),e}),{}):t:t}static toLowerCase(t){return"string"==typeof t?t.toLowerCase():Array.isArray(t)?t.map(o.toLowerCase):a((()=>t.constructor===Object))?Object.entries(t).reduce(((t,[e,r])=>(t[e]=o.toLowerCase(r),t)),{}):t}}r.Objects=o;r.Maps=class{static entries(t){if(t.entries)return t.entries();const e=[];return t.forEach(((t,r)=>{e.push([r,t])})),e}};class i{static from(t){return Array.from(t)}static find(t,e){if(t.find)return t.find(e);const[r]=t.filter(e);return r}static toObject(t){return t.reduce(((t,e)=>(Object.keys(e).forEach((r=>{r in t||(t[r]=e[r])})),t)),{})}static flatten(t){return t.reduce(((t,e)=>t.concat(e)),[])}static flatMap(t,e){return t.flatMap?t.flatMap(e):i.flatten(t.map(e))}static unique(t){return Array.from(new Set(t))}static clean(t){return t.filter(Boolean)}static trim(t){return t.map((t=>t.trim()))}static includes(t,e){return"includes"in t?t.includes(e):-1!==t.indexOf(e)}static last(t){return t[t.length-1]}static safeReverse(t){return t.slice().reverse()}}r.Arrays=i;function a(t,e){try{const r=t();return void 0===r?e:r}catch(t){return e}}function u(t,e){const r=e.toLowerCase(),n=i.find(Object.keys(t),(t=>t.toLowerCase()===r));if(!n)return;const s=t[n];return"string"==typeof s?s.trim():s}function c(t,...e){if(!t)return[];if(Array.isArray(t))return i.clean(i.flatten(t.map((t=>c(t,...e)))));if("object"==typeof t){const[r,...n]=e,s=u(t,r);return"object"==typeof s?c(s,...n):Boolean(s)?[s]:[]}return[]}r.Elements=class{static path(t){let e=[t];for(;t.parentElement;)t=t.parentElement,e.push(t);return e}},r.get=a,r.getAsync=function(t,r){return e(this,void 0,void 0,(function*(){try{const e=yield t();return void 0===e?r:e}catch(t){return r}}))},r.getValue=u,r.getAll=c,r.extract=function(t,e){return i.flatten(e.map((e=>i.clean(i.unique(c(t,...e.split(".")))))))};const l="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:void 0!==n?n:Function("return this")();function d(t,e,r,n=(t=>t)){const s=[];let o,i=0;for(;null!=(o=t.exec(e));)s.push(n(e.substring(i,o.index))),s.push(r(o)),i=t.lastIndex;return s.push(n(e.substring(i))),s.join("")}function h(t){return t.substr(0,1).toUpperCase()+t.substr(1).toLowerCase()}function g(t){return JSON.stringify(o.sort(t))}r.globalThis=l,r.accumulateMultipleValues=function(t,e,r){const n=t[e];return void 0===n?t[e]=r:Array.isArray(n)?-1==n.indexOf(r)&&n.push(r):t[e]=[n,r],t},r.regexReplace=d,r.titleCase=function(t){return d(/\w+/g,t,(t=>h(t[0])))},r.caseWord=h,r.stableJson=g,r.same=function(t,e){return g(t)===g(e)},r.sameIgnoringCase=function(t,e){return g(o.toLowerCase(t))===g(o.toLowerCase(e))},r.limit=function(t,e){return t.slice(0,e)};const f=/\s+/g;return r.cleanSpaces=function(t){return t.trim().replace(f," ")},n.exports}.call({});class a{now(){return new Date}}function u(t,e){for(e=t="";t++<36;e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-");return e}class c{constructor(t){const e=c.RFC_3986.exec(t);if(!e)throw new Error("Invalid Uri: "+t);const[,,r,,n,s,,o,,i]=e;this.scheme=r,this.authority=n?new l(n):void 0,this.path=s,this.query=o,this.fragment=i}toString(){const t=[];return void 0!==this.scheme&&t.push(this.scheme,":"),void 0!==this.authority&&t.push("//",this.authority.toString()),t.push(this.path),void 0!==this.query&&t.push("?",this.query),void 0!==this.fragment&&t.push("#",this.fragment),t.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}}c.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class l{constructor(t){const e=l.RFC_3986.exec(t);if(!e)throw new Error("Invalid Authority: "+t);const[,r,n,s]=e;this.userInfo=r,this.host=n,this.port=s}toString(){const t=[];return void 0!==this.userInfo&&t.push(this.userInfo,"@"),void 0!==this.host&&t.push(this.host),void 0!==this.port&&t.push(":",this.port),t.join("")}}function d(t,e=!0){return t?(0==t.indexOf("?")&&(t=t.substring(1,t.length)),t.split("&").map((function(t){return t.split("=")})).reduce((function(t,r){const n=r[0],s=r[1];if(!n)return t;const o=s?i.get((()=>decodeURIComponent(s.replace(/\+/g,"%20"))),void 0):s,a=e?function(t){try{return JSON.parse(t)}catch(e){return t}}(o):o;return i.accumulateMultipleValues(t,n,a)}),{})):{}}function h(t){return e(this,void 0,void 0,(function*(){const e=t[t.GoogleAnalyticsObject||"ga"];return"function"!=typeof e?[]:yield new Promise((t=>e((()=>t(i.Arrays.unique(e.getAll().map((t=>t.get("trackingId")))))))))}))}function g(t){return i.Arrays.unique(Array.from(t.document.querySelectorAll("script[src*=googletagmanager]")).map((t=>{const{query:e}=new c(t.src),{id:r}=d(e);return r})))}l.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;class f{constructor(t=console.log,e=console.error,r=console.debug||console.log){this.log=t,this.error=e,this.debug=r}}class p{constructor(){this.log=()=>{},this.error=()=>{},this.debug=()=>{}}}const y="triptease-debug";function m(t){return function(t,e="triptease-debug"){const r=i.get((()=>{var r;return d(null===(r=t.location)||void 0===r?void 0:r.search,!1)[e]}))||i.get((()=>{var r;return d(new c(null===(r=t.location)||void 0===r?void 0:r.originalHref).query,!1)[e]}))||i.get((()=>{var e,r;return null===(r=null===(e=t.process)||void 0===e?void 0:e.env)||void 0===r?void 0:r.DEBUG}))||i.get((()=>{var r;return(null===(r=t.localStorage)||void 0===r?void 0:r.getItem)&&t.localStorage.getItem(e)}))||"";return i.get((()=>r.substring(0,256)),"")}(t,y).split(",").map((t=>t.trim()))}function w(t){const e=t.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+e+"$")}class b{constructor(t){this.name=t,this.console=new f}debug(t,...e){this.console.debug(`[${this.name}] ${t}`,...e)}log(t,...e){this.console.log(`[${this.name}] ${t}`,...e)}error(t,...e){this.console.error(`[${this.name}] ${t}`,...e)}}function v(t,e=i.globalThis){return function(t,e=i.globalThis){try{const r=m(e),n=r.filter((t=>"!"===t[0])).map((t=>t.substr(1)));return n.length>0?!n.some((e=>w(e).test(t))):r.some((e=>"true"===e||w(e).test(t)))}catch(t){return!1}}(t,e)?new b(t):new p}const O={name:"onboard",version:class{static get(){return i.get((()=>{const t="3428.30504";return"v"+t}),"latest")}}.get()};const j=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function A(t,e,r){if(e(t))return r(t);switch(typeof t){case"undefined":return;case"object":if(null===t)return null;if(Array.isArray(t))return t.map((t=>A(t,e,r)));if(t.constructor===Object)return i.Objects.keys(t).sort().reduce(((n,s)=>{const o=t[s];return n[s]=A(o,e,r),n}),{})}return t}function q(t){return function(t){return A(t,(t=>"string"==typeof t&&j.test(t)),(t=>{const e=new Date(t);return isNaN(e.valueOf())?t:e}))}(JSON.parse(t))}class I{static parse(t){return q(t)}static stringify(t){return JSON.stringify(this.validate(t))}static validate(t){return A(t,(t=>{const e=typeof t;switch(e){case"undefined":case"string":case"number":case"boolean":return!0;case"object":if(null===t)return!0;if(Array.isArray(t))return!1;if(t.constructor===Object)return!1;if("toJSON"in t)return!0}throw new Error(`Illegal JsonValue: ${e} ${t} `)}),(t=>t))}}class k{static same(t,e){return I.stringify(t)===I.stringify(e)}static isSuperset(t,e){return null===t||null===e?k.same(t,e):Array.isArray(t)&&Array.isArray(e)?!(t.length>e.length)&&t.every((t=>e.some((e=>k.isSuperset(t,e))))):i.get((()=>t.constructor===Object))&&i.get((()=>e.constructor===Object))?Object.keys(t).reduce(((r,n)=>r&&k.isSuperset(t[n],e[n])),!0):k.same(t,e)}static compress(t){const e=k.groupValues(t);return this.compressGrouped(e)}static compressGrouped(t){return Object.entries(t).reduce((({shared:t,unique:e},[r,n])=>{if(i.get((()=>n.constructor===Object))){const s=k.compressGrouped(n);Object.keys(s.shared).length>0&&(t[r]=s.shared),s.unique.forEach(((t,n)=>{e[n]=e[n]||{},Object.keys(t).length>0&&(e[n][r]=t)}))}return Array.isArray(n)&&n.forEach(((s,o)=>{e[o]=e[o]||{},1===i.Arrays.unique(n.map((t=>I.stringify(t)))).length?t[r]=s:void 0!==s&&(e[o][r]=s)})),{shared:t,unique:e}}),{shared:{},unique:[]})}static groupValues(t){const e=Array.from(t.reduce(((t,e)=>Object.keys(e).reduce(((t,e)=>t.add(e)),t)),new Set)),[r,n]=t.reduce(((t,r)=>e.reduce((([t,e],n)=>{const s=r[n];return i.get((()=>s.constructor===Object))?(e[n]=e[n]||[],e[n].push(s)):(t[n]=t[n]||[],t[n].push(s)),[t,e]}),t)),[{},{}]),s=Object.entries(n).reduce(((t,[e,r])=>(t[e]=k.groupValues(r),t)),{});return Object.assign(Object.assign({},r),s)}static decompress(t){return t.unique.map((e=>this.merge(t.shared,e)))}static merge(t,e){return[...Object.keys(t),...Object.keys(e)].reduce(((r,n)=>{const s=t[n],o=e[n];return i.get((()=>s.constructor===Object))&&i.get((()=>o.constructor===Object))?r[n]=k.merge(s,o):r[n]=null!=o?o:s,r}),{})}}function C(t){return{title:t.document.title,locale:t.document.documentElement.lang||t.document.documentElement.getAttribute("xml:lang")||"",url:t.location.href,urlParsed:S(t.location.href),referrer:t.document.referrer,referrerParsed:S(t.document.referrer),characterSet:t.document.characterSet}}function S(t){if(!t)return{};const{scheme:e,host:r,path:n,query:s,fragment:o}=new c(t);return i.Objects.removeEmpty({scheme:e,host:r,path:n,query:s,queryParsed:d(s,!1),fragment:o})}class E{constructor(t,e=new a){this.window=t,this.clock=e;try{this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(t){this.timezone=""}}buildMessage(t){return e(this,void 0,void 0,(function*(){const r=i.get((()=>this.window.triptease.onboard.bootstrap.identity)),n=this.clock.now();return k.merge({createdAt:n,messageId:u(),userId:i.get((()=>r.userId)),sessionId:i.get((()=>r.sessionId)),domainUserId:i.get((()=>r.domainUserId)),context:{library:O,userAgent:this.window.navigator.userAgent,locale:this.window.navigator.language,page:C(this.window),screen:{width:this.window.screen.width,height:this.window.screen.height},timezone:this.timezone,google:yield i.getAsync((()=>function(t){return e(this,void 0,void 0,(function*(){return{ga:yield h(t),gtm:g(t)}}))}(this.window)),{})}},t)}))}}class L{constructor(t,e,r=M,n=v("messaging")){this.listener=t,this.target=e,this.allowedOrigins=r,this.logger=n}addListener(t){this.listener&&this.listener.addEventListener("message",(e=>{this.disallowedOrigin(e)||function(t){try{const{target:e,method:r}=x(t.type);if(e&&r)return!0}catch(t){}return!1}(e.data)&&t(e.data,new L(void 0,e.source||this.target))}))}disallowedOrigin(t){return t.origin&&this.allowedOrigins.length>0&&-1===this.allowedOrigins.indexOf(new c(t.origin).host)}send(t){this.target.postMessage(t,"*")}}const M=["onboard.triptease.io","localhost"],T=/^(.*)\.([^.]+)$/;function x(t){const[,e,r]=t.match(T)||[];return{target:e,method:r}}function R(t,e,r){return{name:t,message:e,stack:null!=r?r:""}}function $(t){return t&&"object"==typeof t&&"triptease.onboard.request"===t.type&&"string"==typeof t.requestType&&"string"==typeof t.correlationId&&Array.isArray(t.payload)}function P(t,e){return{type:"triptease.onboard.response",correlationId:t,payload:e}}function N(t,e){return P(t,R("MissingHandler","No handler for "+e))}const B=v("messaging");class F{constructor(){this.handlers=new Map}register(t,e){return t.forEach((t=>{if(this.hasHandlerFor(t))throw new Error(`Method name "${t}" already registered to a handler`);this.handlers.set(t,e)})),this}handle(t){return e(this,void 0,void 0,(function*(){const e=this.handlers.get(t.requestType);return e?(B.debug("Matched message to handler",t,e),yield e.handle(t)):N(t.correlationId,t.requestType)}))}hasHandlerFor(t){return this.handlers.has(t)}}const U=v("messaging");class H{constructor(t){this.target=t}handle(t){return e(this,void 0,void 0,(function*(){const e=this.target[t.requestType];if(!e)return U.debug("No method found that matches method",t.requestType,this.target),N(t.correlationId,t.requestType);try{U.debug("Found method",t.requestType);const r=yield e.apply(this.target,t.payload);return P(t.correlationId,r)}catch(e){return U.debug("Error trying to in invoke method",t.requestType,e),function(t,e){return P(t,R(e.name,e.message,e.stack))}(t.correlationId,e)}}))}}const z=v("messaging");class J{constructor(t,e){this.listen=t,this.router=e,this.rules=[],t.addListener(this.handler.bind(this)),this.addRule($,(t=>t),(t=>t)),this.addRule(_,D,G)}registerAlias(t,e){if(!this.router.hasHandlerFor(e))throw new Error(`Illegal alias: Method "${e}" is not registered with router`);return this.addRule((r=t,t=>t.type===r),function(t){return e=>({type:"triptease.onboard.request",requestType:String(t),payload:[e],correlationId:e.correlationId||"fire-and-forget"})}(e),G);var r}handler(t,r){return e(this,void 0,void 0,(function*(){if((e=t)&&"object"==typeof e&&"triptease.onboard.response"===e.type&&"string"==typeof e.correlationId)return;var e;z.debug("listenOn received request",t);const n=this.rules.find((e=>e.predicate(t)));if(!n)return;const s=n.requestConverter(t),o=yield this.router.handle(s);t.correlationId&&t.correlationId===o.correlationId&&(z.debug("listenOn sending response to sender",o),r.send(n.responseConverter(o)))}))}addRule(t,e,r){return this.rules.push({predicate:t,requestConverter:e,responseConverter:r}),this}}function _(t){return!$(t)&&!!t.correlationId}function D(t){const{value:e,correlationId:r}=t,{method:n}=x(t.type);return{type:"triptease.onboard.request",requestType:n,payload:[e],correlationId:r}}function G(t){return{type:"triptease.onboard.response",correlationId:t.correlationId,value:t.payload}}var V={};Object.defineProperty(V,"__esModule",{value:!0});var W=(Z=void 0,V.SystemClock=Z);V.StoppedClock=W;var Z=class{now(){return new Date}};V.SystemClock=Z;W=class{constructor(t){this.value=t}now(){return this.value}},V.StoppedClock=W;const X=new V.SystemClock;new class{constructor(t,e,r=new E(t)){this.window=t,this.messageBatcher=e,this.messageBuilder=r}start(){const t=new H(this);new J(new L(window,window,[]),(new F).register(["trackConfig","trackEvent","trackError"],t)).registerAlias("triptease.config","trackConfig")}trackConfig(t){if(!i.get((()=>t.payload.type===r.Payment)))return this.messageBatcher.send(i.Objects.removeEmpty(t))}trackEvent(t){return this.messageBatcher.send(t)}trackError(t){return e(this,void 0,void 0,(function*(){return this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:"triptease.error",payload:t}))}))}}(window,new class{constructor(t,r,n=v("analytics"),s=50){this.window=t,this.clock=r,this.logger=n,this.batchSize=s,this.queued=[],setInterval((()=>e(this,void 0,void 0,(function*(){return yield this.flush()}))),1e3),this.window.addEventListener("unload",(()=>e(this,void 0,void 0,(function*(){return yield this.flush()}))))}send(t){return e(this,void 0,void 0,(function*(){this.queued.push(function(t,e){return Object.assign({messageId:u(),createdAt:t.now()},e)}(this.clock,t)),this.queued.length>this.batchSize&&(yield this.flush())}))}flush(){return e(this,void 0,void 0,(function*(){if(0===this.queued.length)return;const t=this.queued.splice(0,this.batchSize);this.logger.log(`Flushing batch of ${t.length}, remaining in queue ${this.queued.length}`);!function({method:t="POST",url:e,body:r}){const n=JSON.stringify(r);if(void 0!==navigator.sendBeacon&&"POST"===t)navigator.sendBeacon(e,n);else if("undefined"!=typeof fetch)fetch(e,{method:t,body:n});else if(XMLHttpRequest){const r=new XMLHttpRequest;r.open(t,e,!0),r.send(n)}}({url:"https://onboard.triptease.io/message/batch",body:{type:"triptease.onboard.batch",sentAt:this.clock.now(),payload:t}})}))}}(window,X),new E(window,X)).start()}();