if(window.console==undefined){window.console=new function(){this.log=function(){};this.info=function(){};};}window.noGarbageClean=Browser.ie&&Browser.version<8;var MultiSliderFilter=new Class({Extends:Slider,options:{onChange:function(){},onComplete:function(){if(!this.disabled){var newLimitPos=this.toPosition([this.step[0],this.step[1]]);this.drag1.options.limit.x=[this.options.offset,newLimitPos[1]];this.drag2.options.limit.x=[newLimitPos[0],this.max-this.options.offset];this.filterContainer.sendFilter("&searchFilter.name="+this.options.name+"&minValue="+this.getMin()+"&maxValue="+this.getMax());}},onTick:function(pos){this.knob1.setStyle(this.p,pos[0]);this.knob2.setStyle(this.p,pos[1]);},init:function(container){this.input=container.getElement("input").set("readonly","readonly");container.getElement(".slider").removeClass("hide");
},mode:"horizontal",steps:100,offset:0,valueOffset:0,snap:false,scaleSize:1,name:""},initialize:function(container,filterContainer,options){this.setOptions(options);this.initPos=this.options.initialPosition;this.options.steps=this.options.steps||1;this.filterContainer=filterContainer;this.container=container;this.sliderEl=container.getElement(".slider");if(this.container){this.container.getParent().removeClass("hide");}this.options.init(container);var knobs=container.getElements("div div.knobs");this.knobs=knobs;this.hasNotDragged=true;this.knob1=knobs[0].addEvents({"moveTo":this.moveTo.bind(this),"moveEnd":this.moveEnd.bind(this)});this.knob2=knobs[1].addEvents({"moveTo":this.moveTo.bind(this),"moveEnd":this.moveEnd.bind(this)});this.leftEl=this.knob2.getNext();this.rightEl=this.leftEl.getNext();
this.previousChange=[-1,-1];this.previousEnd=[-1,-1];this.step=[-1,-1];this.z="x";this.p="left";if(this.options.input){this.options.input.setStyle("border","none");}knobs.setStyles({left:0,position:"relative"});this.setKnobs();},update:function(options){this.setOptions(options);if(typeof this.options.initialPosition[0]!="undefined"&&typeof this.options.initialPosition[1]!="undefined"){this.setKnobs();}},moveTo:function(knob,pos,index,offsetParentX){var dragObj=this[index==0?"drag1":"drag2"],newPos=Number(pos-offsetParentX),limitObj=dragObj.options.limit.x;newPos=newPos.limit(limitObj[0],limitObj[1]);dragObj.value.now.x=newPos;this.draggedKnob(index);knob.setStyle("left",newPos);},moveEnd:function(knob,index){this.draggedKnob(index);this.end(index);},setKnobs:function(){mod={"x":"left","y":false};
offset="offsetWidth";var sliderbase=this.container.getElement("div.slider");this.getPos=sliderbase["get"+this.p.capitalize()].bind(this.sliderbase);this.max=sliderbase[offset]-this.knob1[offset]+(this.options.offset*2);var lim1={};lim1[this.z]=[-this.options.offset,this.max-this.options.offset];var lim2={};lim2[this.z]=[-this.options.offset,this.max-this.options.offset];if(!this.drag1){this.drag1=new Drag(this.knob1,{limit:lim1,modifiers:mod,snap:0,onStart:function(){this.draggedKnob(0);}.bind(this),onDrag:function(){this.draggedKnob(0);}.bind(this),onComplete:function(){this.draggedKnob(0);this.end(0);}.bind(this)});}else{this.drag1.options.limit=lim1;}if(!this.drag2){this.drag2=new Drag(this.knob2,{limit:lim2,modifiers:mod,snap:0,onStart:function(){this.draggedKnob(1);}.bind(this),onDrag:function(){this.draggedKnob(1);
}.bind(this),onComplete:function(){this.draggedKnob(1);this.end(1);}.bind(this)});}else{this.drag1.options.limit=lim2;}if(this.options.initialPosition[0]===0&&this.options.initialPosition[1]===0){this.waiting=true;this.options.initialPosition[1]=1;}else{this.waiting=false;}if(this.options.initialize){this.options.initialize.call(this);}this.set(this.options.initialPosition);this.previousChange=this.options.initialPosition;},set:function(step){var measureStep0=0,measureStep1;if(this.options.name=="totalRating"){measureStep1=10;}else{if(this.options.name=="price"){var priceStep=this.sliderEl.getPrevious().value.split(" ");measureStep0=step[0];measureStep1=step[1];}else{measureStep1=5;}}this.step=[step[0].limit(this.options.valueOffset,this.options.steps+this.options.valueOffset),step[1].limit(this.options.valueOffset,this.options.steps+this.options.valueOffset)];
this.checkStep(1);if(!this.measurer){this.measurer=new Element("div",{"class":"measure",html:'<span class="left">'+measureStep0+'</span> <span class="right">'+measureStep1+"</span>"}).inject(this.sliderEl,"after");}var pos=this.toPosition(this.step);this.knob1.setStyle(this.p,pos[0]);this.knob2.setStyle(this.p,pos[1]);this.drag1.value.now.x=-this.options.offset;this.drag2.value.now.x=this.max-this.options.offset;var newLimitPos=this.toPosition([this.step[0],this.step[1]]);this.drag1.options.limit.x=[this.options.offset,newLimitPos[1]];this.drag2.options.limit.x=[newLimitPos[0],this.max-this.options.offset];this.fireEvent("onChange",{min:this.step[0],max:this.step[1]});var theRightW=this.sliderEl.getSize().x-pos[1]-20;this.leftEl.setStyle("width",pos[0]+"px");this.rightEl.setStyle("width",theRightW+"px");
this.options.hasChanged=false;return this;},draggedKnob:function(i){i==0?knob=this.drag1:knob=this.drag2;this.step[i]=this.toStep(knob.value.now[this.z]);this.checkStep(i);var theRightW=this.sliderEl.getSize().x-knob.value.now[this.z]-20;i==0?this.leftEl.setStyle("width",knob.value.now[this.z]+"px"):this.rightEl.setStyle("width",theRightW+"px");},checkStep:function(i){if(this.previousChange[i]!=this.step[i]){this.previousChange[i]=this.step[i];this.fireEvent("onChange",{min:this.step[0],max:this.step[1]});}},end:function(knobNumber){if(this.options.snap){var pos=this.toPosition(this.step);this.knob1.setStyle(this.p,pos[0]);this.knob2.setStyle(this.p,pos[1]);var theRightW=this.sliderEl.getSize().x-pos[1]-20;this.leftEl.setStyle("width",pos[0]+"px");this.rightEl.setStyle("width",theRightW+"px");
this.drag1.value.now.x=pos[0];this.drag2.value.now.x=pos[1];}for(var i=0,l=this.step.length;i<l;i++){if(this.previousEnd[i]!=this.step[i]){this.previousEnd[i]=this.step[i];if(!this.hasNotDragged){if(this.requestTimeout){clearTimeout(this.requestTimeout);}this.fireEvent("onComplete",this.step);}else{this.hasNotDragged=false;this.requestTimeout=setTimeout(function(){this.fireEvent("onComplete",this.step);}.bind(this),10);}}}if(knobNumber==0){this.knob1.setStyle("zIndex",10);this.knob2.setStyle("zIndex",9);}else{this.knob1.setStyle("zIndex",9);this.knob2.setStyle("zIndex",10);}this.options.hasChanged=true;},disable:function(){this.drag1.options.savedLimit=this.drag1.options.limit.x;this.drag2.options.savedLimit=this.drag2.options.limit.x;this.drag1.options.limit.x=[this.drag1.value.now.x-0.01,this.drag1.value.now.x+0.01];
this.drag2.options.limit.x=[this.drag2.value.now.x+0.01,this.drag2.value.now.x-0.01];this.disabled=true;},enable:function(){this.drag1.options.limit.x=this.drag1.options.savedLimit;this.drag2.options.limit.x=this.drag2.options.savedLimit;this.disabled=false;},restore:function(){this.set(this.options.restorePosition);},toStep:function(position){return Math.round((position+this.options.offset)/this.max*this.options.steps)+this.options.valueOffset;},toPosition:function(step){return[this.max*(step[0]-this.options.valueOffset)/this.options.steps,this.max*(step[1]-this.options.valueOffset)/this.options.steps];},getMax:function(){return this.step[0]>this.step[1]?this.step[0]:this.step[1];},getMin:function(){return this.step[0]<this.step[1]?this.step[0]:this.step[1];}});var CheckboxFilter=new Class({initialize:function(checkbox,filterContainer){this.filterContainer=filterContainer;
this.checkbox=checkbox;this.initialState=checkbox.checked;this.parent=checkbox.getParent().getParent("li");if(this.checkbox.checked&&this.checkbox.value=="on"){this.parent.addClass("isChecked");}else{this.parent.removeClass("isChecked");}checkbox.addEvent("click",function(){var name="searchFilter."+this.checkbox.id;if(this.checkbox.id.match(/spa/)){var name="searchFilter.spa";}if(this.checkbox.id.match(/seniorComfortHotel/)){var name="searchFilter.seniorComfortHotel";}var state=this.checkbox.checked,checkboxCollection=undefined;if(this.checkbox.id.match(/spa/)){checkboxCollection=$$("#spaHotelType, #spaHotelConfiguration");}if(this.checkbox.id.match(/seniorComfortHotel/)){checkboxCollection=$$("#seniorComfortHotel, #seniorComfortHotelRoom");}if(checkboxCollection){checkboxCollection.each(function(checkbox){checkbox.checked=state;
var li=checkbox.getParent("li");if(state){li.addClass("isChecked");}else{li.removeClass("isChecked");}});}this.filterContainer.sendFilter("&name="+name+"&value="+this.checkbox.value+"&checked="+state+"&"+name+"="+(state?"on":"off"));if(state){this.parent.addClass("isChecked");}else{this.parent.removeClass("isChecked");}}.bind(this));},setSummaryFilter:function(){this.parent.addClass("isChecked");var txt=this.parent.get("text").split("(")[0],summaryCheck;var name="searchFilter."+this.checkbox.id;if(this.checkbox.id.match(/spa/)){var name="searchFilter.spa";}if(this.checkbox.id.match(/seniorComfortHotel/)){var name="searchFilter.seniorComfortHotel";}if(!summaryCheck){this.summaryCheck=new Element("span",{html:txt,events:{click:function(){this.filterContainer.sendFilter("&name="+name+"&value="+this.checkbox.value+"&checked=false"+"&"+this.name+"= off");
this.checkbox.setProperty("checked","");this.parent.removeClass("isChecked");this.summaryCheck.destroy();}.bind(this)}}).inject($("summaryfilter"));}},set:function(){this.checkbox.value=true;},restore:function(){this.checkbox.checked=this.initialState;},uncheck:function(){this.checkbox.checked=false;},disable:function(){this.checkbox.setProperty("disabled","disabled");},enable:function(){this.checkbox.removeProperty("disabled");},getCheckbox:function(){return this.checkbox;}});var Filter=new Class({Implements:[Options,Events],options:{url:""},initialize:function(options){this.setFilterOptions(options);this.filter=[];if(options.isVeMapSearch){this.multiSliders=[];$("price").setStyle("display","none");}else{this.multiSliders=["price"];}if($("stars")){this.multiSliders.push("stars");}if($("totalRating")){this.multiSliders.push("totalRating");
}this.isTouch=(Browser.Features.iOSTouch||Browser.Features.Touch)&&Browser.isMobile;this.multiSliders.each(function(item){this.filter.push(new MultiSliderFilter($(item),this,this.sliderSettings[item]));},this);$$("#filter .check input").each(function(item){this.filter.push(new CheckboxFilter(item,this));},this);$$("div#filter .jsRestore").addEvent("click",function(event){if(event){event.stop();}this.restoreFiltersFromHotellist();}.bind(this)).removeClass("hide");$$(".sliderBox label").setStyle("width","auto");HotellistEventManager.addEvent("restoreFiltersFromHotellist",this.restoreFiltersFromHotellist.bind(this));},restoreFiltersFromHotellist:function(){$("filter").getElements("label.check").each(function(item){item.getParent().removeClass("isChecked");});this.filter.each(function(item){item.restore();
},this);this.sendFilter("&restore=true");},uncheckFilters:function(){$("filter").getElements("label.check").each(function(item){item.getParent().removeClass("isChecked");});this.filter.each(function(item){if(item.uncheck){item.uncheck();}else{item.restore();}});},setFilterOptions:function(options){this.options.url=this.options.url||options.url;this.options.isVeMapSearch=options.isVeMapSearch;this.sliderSettings.price.steps=options.maxPriceAbsolute-options.minPriceAbsolute;this.sliderSettings.price.valueOffset=options.minPriceAbsolute;this.sliderSettings.price.currency=options.currency;this.sliderSettings.price.restorePosition=[options.minPriceAbsolute,options.maxPriceAbsolute];this.sliderSettings.price.initialPosition=[options.minPrice,options.maxPrice];this.sliderSettings.stars.initialPosition=[options.minNumberOfStars,options.maxNumberOfStars];
this.sliderSettings.totalRating.initialPosition=[options.minEvaluationResult,options.maxEvaluationResult];},updateFilter:function(options){this.setFilterOptions(options);this.multiSliders.each(function(item,i){if(this.filter[i]&&typeof this.filter[i].update=="function"){this.filter[i].update(this.sliderSettings[item]);}},this);},sliderSettings:{price:{onChange:function(){if(!this.waiting){var min=this.getMin();var max=this.getMax();var text="";min==max?text=max+" "+this.options.currency:text=min+" - "+max+" "+this.options.currency;this.options.input.value=text;}},snap:false,name:"price"},stars:{onChange:function(){var min=this.getMin();var max=this.getMax();if(min==max){$$("#starsMax").addClass("hide");$$("#min").addClass("hide");}else{$$("#starsMax").removeClass("hide");$$("#min").removeClass("hide");
}if(min==0){$("starsMin").addClass("notRated");$("starsMin").setStyle("width",10);}else{$("starsMin").removeClass("notRated").set("text","");$("starsMin").setStyle("width",min*10);}$("starsMax").setStyle("width",max*10);},init:function(container){container.getElements(".hide").removeClass("hide");container.getElement("input").addClass("hide");},steps:5,valueOffset:0,snap:true,name:"stars",restorePosition:[0,5]},totalRating:{onChange:function(){this.options.input.value=this.getMin()+" - "+this.getMax();},steps:10,valueOffset:0,snap:true,name:"totalRating",restorePosition:[0,10]}},sendFilter:function(values){var href=this.options.url+values+"&hotelListIframeTarget="+(window.hotellistMap?window.hotellistMap.getState():"");if(href.indexOf("hotelListJson")<0){href+="&hotelListJson=true";}HotellistEventManager.fireEvent("loadHotels",{"url":href,"linkTrackingMethod":"trackHotelListFilter","linkTrackingSourceName":"Dynamic Filter"});
if(window.hotellistMap&&window.hotellistMap.getMap()){window.hotellistMap.getHotelsJS();}this.fireEvent("sendFilter");},disableFilter:function(){this.filter.each(function(item){item.disable();});},enableFilter:function(){this.filter.each(function(item){item.enable();});}});var GoogleMapV3=new Class({Implements:Options,options:{updateType:"showNeutral"},initialize:function(opt){this.setOptions(opt);this.userInteractionAllowed=true;this.mapInstance=undefined;this.toggleButton=$("openMap");this.toggleButtonContainer=$("openMap").getParent("div.teaser");this.toggleButtonText=this.toggleButton.getElement(".mapButtonTitle");this.mapContainer=$("map");this.searchForm=$("searchForm");this.isFreefly=false;this.iconSize=50;this.zoomChange=true;this.isShown=false;this.currency=null;this.markers=[];this.selectedMarkers=[];
this.specialMarkers=[];this.infoBoxes=[];this.selectedInfoBoxes=[];this.specialInfoBoxes=[];this.currentUpdateType=this.options.mapAction;this.coordinates={"bottomLeftLat":this.options.bottomLeftLat,"bottomLeftLon":this.options.bottomLeftLon,"topRightLat":this.options.topRightLat,"topRightLon":this.options.topRightLon,"isShown":this.options.isShown,"centerLat":this.options.centerLat,"centerLon":this.options.centerLon,"zoom":this.options.zoom,"centerZoom":this.options.centerZoom};if(this.toggleButton){var loadList;this.toggleButtonContainer=this.toggleButtonContainer.removeClass("hide");this.toggleButtonText=this.toggleButton.getElement(".mapButtonTitle");if(this.options.deeplink=="map"){this.open();}if(this.options.deeplink=="gallery"){loadList=true;}else{loadList=false;}this.state=this.toggleButton.hasClass("act")?"map":"list";
this.toggleButtonContainer.addEvent("click",function(event){HotellistEventManager.fireEvent("updateMapData");if(this.toggleButton.hasClass("act")){this.toggleButton.removeClass("act");this.close();}else{this.toggleButton.addClass("act");this.open();}var target=event.target;if(target.hasClass("mapButtonTitle")){target=target.getParent();}if(!loadList){event.preventDefault();this.currentUpdateType="showNeutral";this.updateMap();}loadList=false;this.trackState(!target.hasClass("act")?"list":"map");if(this.getState()==="list"&&this.dashboard){this.dashboard.hideStreetView();}}.bind(this));}if(!this.toggleButton||this.toggleButton.hasClass("act")){this.open();}$("toggleLegend").addEvent("click",function(){$("legend").toggleClass("hide");this.getElement("strong").toggleClass("open");});this.state=this.toggleButton.hasClass("act")?"map":"list";
if(this.state==="map"){this.reloaded=true;this.currentUpdateType="showNeutral";this.updateMap();}},setToggleSearch:function(toggleSearchObject){this.toggleSearch=toggleSearchObject;this.toggleSearch.initAvailibiltyButton();},updateMap:function(){switch(this.currentUpdateType){case"showNeutral":if(this.isShown){if(this.mapInstance){this.userInteractionAllowed=true;this.storeMapBoundsHandler();}else{if(this.userInteractionAllowed){this.userInteractionAllowed=false;this.getMapInstance();}}}break;case"showSelectedHotels":if(this.mapInstance){this.getSelectedMarkers();}else{this.getMapInstance();}break;default:break;}},getMapInstance:function(){if(this.mapInstance){this.updateMap();}else{createMapInstance({lat:this.coordinates.centerLat,lon:this.coordinates.centerLon,zoom:this.coordinates.zoom,callback:this.mapReady.bind(this),mapDivId:"map"});
}},mapReady:function(mapInstance){if(mapInstance.getBounds()){this.projectionChanged(mapInstance);}else{google.maps.event.addListenerOnce(mapInstance,"projection_changed",function(){this.projectionChanged(mapInstance);}.bind(this));}},projectionChanged:function(mapInstance){this.mapInstance=mapInstance;this.mapInstance.jsMapClass=this;this.mapInstance.markerRegister={};if(this.options.dashboard){this.dashboard=new Dashboard("dashboard",this.mapInstance,{location:"hotellist"});this.dashboard.setMapStyles({"roadmap":google.maps.MapTypeId.ROADMAP,"hybrid":google.maps.MapTypeId.HYBRID,"satellite":google.maps.MapTypeId.SATELLITE,"panoramio":"PANORAMIO"});if(this.isShown){this.dashboard.getDashboard().removeClass("hide");}}if(this.options.routing){this.routing=new Routing(mapInstance,this.options.routing.routingLink,this.options.routing.texts,this.dashboard.getDashboard()).init();
}this.fitMap();google.maps.event.addListener(this.mapInstance,"zoom_changed",function(){this.storeMapBoundsHandler();}.bind(this));google.maps.event.addListener(this.mapInstance,"dragend",function(){this.storeMapBoundsHandler();}.bind(this));this.markersHidden=false;google.maps.event.addListener(this.mapInstance,"zoom_changed",function(){disableInfoBoxes(this.mapInstance);if(window.IETestHideLableOnZoom&&!this.markersHidden){this.markers.each(function(item){if(item!==null&&item&&item.label&&item.setVisible){item.setVisible(false);}});this.markersHidden=true;}}.bind(this));google.maps.event.addListener(this.mapInstance,"tilesloaded",function(){enableInfoBoxes(this.mapInstance);if(window.IETestHideLableOnZoom&&this.markersHidden){this.markersHidden=false;this.markers.each(function(item){if(item!==null&&item&&item.label&&item.setVisible){item.setVisible(true);
}});}}.bind(this));this.updateMap();},updateMapData:function(coordinates){for(var a in coordinates){this.coordinates[a]=coordinates[a];}if(this.mapInstance){this.fitMap();}},fitMap:function(){if(this.reloaded){this.mapInstance.setCenter(new google.maps.LatLng(this.coordinates.centerLat,this.coordinates.centerLon));this.mapInstance.setZoom(this.coordinates.zoom);this.reloaded=false;}else{var neLL=new google.maps.LatLng(this.coordinates.topRightLat,this.coordinates.topRightLon),swLL=new google.maps.LatLng(this.coordinates.bottomLeftLat,this.coordinates.bottomLeftLon);this.bounds=new google.maps.LatLngBounds(swLL,neLL);this.mapInstance.fitBounds(this.bounds);this.coordinates.centerLat=this.mapInstance.getCenter().lat();this.coordinates.centerLon=this.mapInstance.getCenter().lng();}},hideMap:function(){this.close();
},open:function(){if(!this.isShown){if(this.toggleButtonText){this.toggleButtonText.set("text",this.options.minimizeText);}this.mapContainer.removeClass("hide");$("mapFooter").removeClass("hide");this.isShown=true;}var openList=$("openList");if(openList){$("openList").removeClass("act");}$$("#openMap, #openMap a").addClass("act");$("mapExpanded").value=true;if(this.dashboard){this.dashboard.getDashboard().removeClass("hide");}},close:function(){if(this.dashboard&&!this.dashboard.getDashboard().hasClass("hide")){this.dashboard.getDashboard().addClass("hide");}if(this.isShown){if(this.toggleButtonText){this.toggleButtonText.set("text",this.options.maximizeText);}this.mapContainer.addClass("hide");$("mapFooter").addClass("hide");this.isShown=false;}$("mapExpanded").value=false;},getHotelsJS:function(){HotellistEventManager.fireEvent("disableFilter");
var offsets=this.getOffsets(this.iconSize);DynamicMap.getHotelListJS(this.coordinates.topRightLat,this.coordinates.topRightLon,this.coordinates.bottomLeftLat,this.coordinates.bottomLeftLon,offsets[0]+0.001,offsets[1]+0.001,this.mapInstance.getZoom(),this.manageHotelsJS.bind(this));HotellistEventManager.fireEvent("enableFilter");},manageHotelsJS:function(data){if(data){var evalThis=data.result?data.result:data;hrsMapsEval.call(this,evalThis);this.markers=this.killMarkers(this.markers,this.infoBoxes);if(this.selectedMarkers){this.selectedMarkers.each(function(item){if(item!==null){var zIndex=Math.round(item.getPosition().lat()*10000);zIndex=Math.abs(zIndex);item.setZIndex(zIndex);}});}if(window.addressSearchLoaction&&!this.addressSearchMarker){this.addressSearchMarker=createIconMarker(this.mapInstance,window.googleMapsMarkerIconSet.addressSearchMarker,addressSearchLoaction.lat,addressSearchLoaction.lng,"","","");
addSimpleInfoBoxToMarker(this.addressSearchMarker,{content:addressSearchLoaction.locationText},false);this.addressSearchMarker.setOptions({zIndex:google.maps.Marker.MAX_ZINDEX+2,optimized:false});}}if(data&&data.fullcount<this.options.availabilityCheckCount&&data.unavailablecount>0){this.toggleSearch.availibiltyButton.removeClass("btnDisabled");$("mapFooter").getElement("p").set("text",CHECKPOSSIBLE);}else{this.searchForm.getParent().removeClass("show");this.searchForm.getParent().removeClass("availabilityForm");this.searchForm.removeClass("jsShowBtn");this.toggleSearch.availibiltyButton.addClass("btnDisabled");$("mapFooter").getElement("p").set("text",CHECKNOTPOSSIBLE);this.toggleSearch.availibiltyButton.getElement("strong").addClass("open");if($("jsToggleSearch")){$("jsToggleSearch").removeClass("open");
}}if(this.zoomChange){this.reloaded=false;this.fitMap();HotellistEventManager.fireEvent("enableFilter");this.zoomChange=false;}this.userInteractionAllowed=true;},setSpecialMarker:function(obj){var tempMarker,tempInfoBox,mapcenter;switch(obj.type){case"center":var zIndex=Math.round((mapcenter.lat()+mapcenter.lng())*1000);zIndex=Math.abs(zIndex);mapcenter=this.mapInstance.getCenter();tempMarker=createIconMarker(this.mapInstance,window.googleMapsMarkerIconSet.centerMarker,mapcenter.lat(),mapcenter.lng(),"","","");tempMarker.setZIndex(zIndex);tempInfoBox=addSimpleInfoBoxToMarker(tempMarker,{content:obj.text},false);break;}this.specialMarkers.push(tempMarker);this.specialInfoBoxes.push(tempInfoBox);},getOffsets:function(offset){offset=(offset&&offset=="number"?offset:50)/Math.pow(2,this.mapInstance.getZoom());
var center=this.mapInstance.getCenter(),point1=this.mapInstance.getProjection().fromLatLngToPoint(center);point1.x+=offset;point1.y+=offset;var point2=new google.maps.Point(point1.x,point1.y),ltlng=this.mapInstance.getProjection().fromPointToLatLng(point2);return[Math.abs(center.lat()-ltlng.lat()),Math.abs(center.lng()-ltlng.lng())];},trackState:function(state){if(this.state!=state){HotelListViewTracker.trackViewSwitching(state,function(json){if(json.metadataTracking){md=JSON.parse(json.metadataTracking);if(window.wa){if(state==="map"){window.wa.viewChange("HotelListMapOpen",{});}else{if(state==="list"){window.wa.viewChange("HotelListMapClose",{});}}}}s_trackPage(json.vars,true);});}this.state=state;window.fireEvent("mapChange",this.state);},showSelected:function(selectedHotels){HotellistEventManager.fireEvent("updateMapData");
this.selectedHotels=selectedHotels;this.currentUpdateType="showSelectedHotels";if(!this.isShown){this.open();}this.updateMap();},getSelectedMarkers:function(){if(this.state=="list"){$("openMap").addClass("act");}var hotelKeys=[];var numbersInList=[];var isZoomIn;scrollTo(0,100);this.trackState("map");if(this.selectedHotels&&this.selectedHotels.length){this.selectedHotels.each(function(item){hotelKeys.push(item.hotelKey!=null?item.hotelKey:item.getProperty("value"));var tmp=item.indexInList!=null?item.indexInList:item.getParent().getPrevious().get("text").replace(".","");numbersInList.push(tmp);isZoomIn=item.zoomIn!=null?item.zoomIn:false;}.bind(this));if(hotelKeys&&numbersInList&&hotelKeys.length>0&&numbersInList.length>0){this.selectedMarkers=this.killMarkers(this.selectedMarkers,this.selectedInfoBoxes);
DynamicMap.createGoogleDetailPushpins(hotelKeys,numbersInList,this.mapContainer.id,this.showSelectedMarkers.bind(this));}}else{this.selectedMarkers=this.killMarkers(this.selectedMarkers,this.selectedInfoBoxes);this.storeMapBoundsHandler();}},showSelectedMarkers:function(data){this.specialMarkers=this.killMarkers(this.specialMarkers,this.specialInfoBoxes);this.manageHotelsJS(data);this.storeMapBoundsHandler();},storeMapBoundsHandler:function(){if(this.coordinates){var currentBounds=this.mapInstance.getBounds();this.checkDestinationIsInView(currentBounds);if(!this.zoomChange){this.coordinates.topRightLat=currentBounds.getNorthEast().lat();this.coordinates.topRightLon=currentBounds.getNorthEast().lng();this.coordinates.bottomLeftLat=currentBounds.getSouthWest().lat();this.coordinates.bottomLeftLon=currentBounds.getSouthWest().lng();
this.coordinates.centerLat=currentBounds.getCenter().lat();this.coordinates.centerLon=currentBounds.getCenter().lng();this.coordinates.zoom=this.mapInstance.getZoom();}DynamicMap.storeMapCoordinate(this.coordinates,function(data){});this.getHotelsJS();}},checkDestinationIsInView:function(currentBounds){var summarySpan=$("summary_destination"),destiny=$("destiny");if(summarySpan){if(!this.orginalDestination){this.orginalDestination=summarySpan.innerHTML;this.originalCoordinates=this.coordinates;}if(destiny.value===""&&summarySpan.innerHTML===SEEMAP){destiny.value=SEEMAP;destiny.setStyle("color","#808080");}}},killMarkers:function(markers,infoboxes){infoboxes.length=0;markers=markers.clean();var keylistString,mapObject;markers.each(function(item,index){if(item){mapObject=item.getMap();if(!item.doNotDelete&&item.setMap&&mapObject){try{keylistString=String(item.hotelKeyValue);
mapObject.markerRegister[keylistString]=null;item.setMap(null);markers[index]=null;}catch(error){}}if(item&&markers[index]!==null){item.doNotDelete=false;}}else{}});return markers;},setCenter:function(latlng){this.coordinates.centerLat=latlng.lat();this.coordinates.centerLon=latlng.lng();this.mapInstance.setCenter(latlng);},setBounds:function(myLatLongs){if(myLatLongs.length===1){this.setCenter(myLatLongs[0]);this.mapInstance.setZoom(15);this.updateMapData({"centerLat":myLatLongs[0].lat(),"centerLon":myLatLongs[0].lng()});}else{var newBounds=new google.maps.LatLngBounds();for(var i=0,len=myLatLongs.length;i<len;i++){newBounds.extend(myLatLongs[i]);}this.updateMapData({"bottomLeftLat":newBounds.getSouthWest().lat(),"bottomLeftLon":newBounds.getSouthWest().lng(),"topRightLat":newBounds.getNorthEast().lat(),"topRightLon":newBounds.getNorthEast().lng()});
this.fitMap();}},setMapStyle:function(mapStyleID){if(mapStyleID!=="PANORAMIO"&&mapStyleID!=="STREETVIEW"){this.mapInstance.setMapTypeID(mapStyleID);this.storeChangeMapStyleHandler();}},getMap:function(){return this.mapInstance;},getState:function(){return this.state;},getDashboard:function(){return this.dashboard;}});function hrsMapsEval(code){if(isEvasdropMode){console.log("hrsMapsEval");console.log("code");console.log(code);console.log("/code");}var result;try{result=eval(code);if(isEvasdropMode){console.log("result");console.log(result);console.log("/result");}}catch(exception){if(isEvasdropMode){console.log("exception");console.log(exception);console.log("/exception");}}if(isEvasdropMode){console.log("/hrsMapsEval");}return result;}var ToggleSearch=new Class({initialize:function(){this.searchForm=$("searchForm");
if(window.hotellistMap){window.hotellistMap.setToggleSearch(this);}},initAvailibiltyButton:function(){this.availibiltyButton=$("checkAvailability").addEvent("click",function(){if(!this.availibiltyButton.hasClass("btnDisabled")){$("searchSource").value=9;this.searchForm.submit();}}.bind(this));}});function hideLoaderPopup(){var popup=document.querySelector(".hrsPopup--loader");if(popup){popup.setAttribute("class",popup.getAttribute("class")+" hidden");return;}else{if(window.domReadyNotFired){setTimeout(hideLoaderPopup,50);}}}var LoadTimer=new Class({Implements:[Events,Options],options:{linkSelector:"[target=hotellist]",containerId:"promContainer"},initialize:function(time,url,options){time=3000;this.setOptions(options);this.doNotAddEvents=false;this.isFirstClick=true;this.clickHasFired=false;
var isInitialLoad=!window.location.hash.contains("initialLoaded");if(isInitialLoad){this.fireEvent("start");this.time=time;this.startTimeout();if(url&&!Browser.ie6&&!Browser.ie7){this.url=url;this.addClickEvents();}}else{window.counterReady=true;this.killOverlay();}},hideLoaderPopup:hideLoaderPopup,killOverlay:function(){var overlayWrapper=$("overLayWrapper");if(overlayWrapper){overlayWrapper.dispose();this.fireEvent("end");this.doNotAddEvents=true;}else{if(window.domReadyNotFired){setTimeout(function(){this.killOverlay();}.bind(this),50);}}this.hideLoaderPopup();},startTimeout:function(){if(this.loaderTimeout){clearTimeout(this.loaderTimeout);}this.loaderTimeout=setTimeout(function(){window.counterReady=true;if(window.hotellistReady){if(window.location.hash.indexOf("scroll")==1){var scrollHeight=parseInt(window.location.hash.replace("#scroll",""));
scrollTo(0,scrollHeight);}window.removeOverlay();}},this.time);},addClickEvents:function(){var container=$(this.options.containerId);if(container){container.addClass("added").getElements("a"+this.options.linkSelector).addEvent("click",this.handleClick.bind(this));}else{if(window.domReadyNotFired&&!this.doNotAddEvents){setTimeout(function(){this.addClickEvents();}.bind(this),50);}}},handleClick:function(event){event.stop();if(!this.clickHasFired){this.clickHasFired=true;event.preventDefault();if(this.isFirstClick){this.startTimeout();this.isFirstClick=false;}var targetType="Link",target=$(event.target);if(target.match("img")){targetType="Picture";}if(!target.match("a")){target=target.getParent("a");}var params=target.href.parseQueryString(),chains=params.chains.length?params.chains:"",hotelIDs=params.hotelIDs.replace(/,/g,":"),eVar18=hotelIDs+";1;"+targetType;
var trackingVars={eVar18:eVar18,linkTrackVars:"eVar18,events",linkTrackEvents:"event15",events:"event15"};if(typeof s_trackLink==="function"){s_trackLink(hotelIDs,true,trackingVars,"PR:Promotion");}if(window.wa){var teaserElement=$("promContainer");if(teaserElement){var data={el:targetType};window.wa.teaserClick(teaserElement,data);}}HotellistEventManager.fireEvent("loadHotels",{"url":this.url+"&hotelIDs="+params.hotelIDs+"&chains="+chains,"preventListReady":"preventListReady"});}}});var SliderEx=new Class({Extends:Slider});Fx.Value=new Class({Extends:Fx,compute:function(from,to,delta){this.value=Fx.compute(from,to,delta);this.fireEvent("motion",this.value);return this.value;},get:function(){return this.value||0;}});var IEMouseover=new Class({initialize:function(els){els.each(function(item){item.addEvent("mouseenter",function(){item.addClass("me");
});item.addEvent("mouseleave",function(){item.removeClass("me");});});}});var SelectObserver=new Class({Implements:Events,pseudoSelects:{},initialize:function(selects){if(selects){selects.each(function(select){this.addSelect(select);},this);}},addSelect:function(pseudoSelect){if(pseudoSelect&&pseudoSelect.list){this.buttons=$$("#isSortedByRecommendation, #isSortedByPrice, #isSortedByName, #isSortedByRating");var that=this;this.buttons.each(function(button){if(button.hasClass("active")){this.activeButton=button;}button.addEvent("click",that.changeActivePseudoSelects.bind(that,button));});var list=pseudoSelect.list.getParent().getParent();if(list.hasClass("active")){this.activeButton=pseudoSelect.input.getParent();this.activeElement=list.getElements(".initial");}this.pseudoSelects[pseudoSelect.container.id]=pseudoSelect;
pseudoSelect.addEvent("onSelected",this.changeActivePseudoSelects.bind(this,pseudoSelect));}},meSelect:function(evt){var $target=$(evt.target);},mlSelect:function(evt){var $target=$(evt.target);},changeActivePseudoSelects:function(pseudoSelect){this.pseudoSelects.distances.container.getParent("li").removeClass("noBorderRight").removeClass("noBorderLeft").removeClass("noDivider");if(this.pseudoSelects.sortReview&&this.pseudoSelects.sortReview.container){this.pseudoSelects.sortReview.container.getParent("li").removeClass("noBorderRight").removeClass("noBorderLeft").removeClass("noDivider");}this.buttons.each(function(button){button.removeClass("noBorderRight").removeClass("noBorderLeft").removeClass("noDivider");});this.deactivatePseudoSelectOrButton(pseudoSelect);this.activatePseudoSelectOrButton(pseudoSelect);
},activatePseudoSelectOrButton:function(el){var isPS=el.input;if(isPS){this.activeButton=isPS.getParent().addClass("active");if(el.selectedListElement){this.activeElement=el.selectedListElement.addClass("initial");}if(el.options.selectOnDesscription&&this.activeElement.getParent().getParent().getPrevious()){this.activeElement=$$([this.activeElement,this.activeElement.getParent().getParent().getPrevious().addClass("initial")]);}this.pseudoSelect=el;}else{this.activateButton(el);}var item=el.container?el.container.getParent(".hotelListSortItem"):el;var leftNeighbour=item.getPrevious(".hotelListSortItem"),rightNeighbour=item.getNext(".hotelListSortItem");if(leftNeighbour){leftNeighbour.addClass("noBorderRight");leftNeighbour.addClass("noDivider");}if(rightNeighbour){rightNeighbour.addClass("noBorderLeft");
}},activateButton:function(name){var newActiveButton=$(name);if(newActiveButton){this.activeButton=newActiveButton.addClass("active");this.activeElement=null;this.pseudoSelect=null;}},deactivatePseudoSelectOrButton:function(pseudoSelect){if(this.activeElement){this.activeElement.removeClass("initial");}if(this.activeButton){this.activeButton.removeClass("active");}if(this.pseudoSelect&&this.pseudoSelect!=pseudoSelect){this.pseudoSelect.selectedListElement=null;this.pseudoSelect=null;}}});var SemLightBox=new Class({Extends:LightBox,initialize:function(options){this.parent(options);this.form=$("searchForm");if(this.form){this.formParent=this.form.getParent();}this.toHide=$$(".hideforSEM");},getContent:function(url){this.parent(url);this.formTarget=this.content.getElement(".searchFormWrapper")||$$("body")[0].getElement(".searchFormWrapper");
this.form.inject(this.formTarget,"inside");if(this.toHide.length<1){this.toHide=$$(".hideforSEM");}$$(".hideforSEM").addClass("hide");},closeLightBox:function(event){this.form.inject(this.formParent,"inside");this.parent(event);this.toHide.removeClass("hide");},setForm:function(el){this.form=$(el);this.formParent=this.form.getParent();}});function csh(element,id){var delay=400;var options={openEvent:"mouseenter",closeButton:false,container:($("hotellistWrap")?($("hotellistWrap").hasClass("notepad")?null:$("hotellistWrap")):null),maxWidth:id?350:300,minWidth:id?300:200,firstDirection:"right",directions:id?["left","bottom","top","right","left"]:["right","bottom","top","left","right"],maxHeight:id?400:150,widthOffset:25,timerDelay:250,showDelay:delay,offsets:{"x":25,"y":20}},nameSuffix=id?id:"";
window["contextHelp"+nameSuffix]=window["contextHelp"+nameSuffix]||new ContextSensitiveHelp([],options);element=$(element);var tooltipText=element.retrieve("tooltipText"),firstTimer,patternElement=$(id);if(!tooltipText){if(patternElement){element.store("tooltipText",patternElement.innerHTML);}else{var dl=element.getParent().getElement("dl");if(!dl||dl.get("tag")!="dl"){dl=element.getParent().getNext();}element.store("tooltipText",'<dl class="checkList">'+dl.innerHTML+"</dl>");}element.onmouseover=null;window["contextHelp"+nameSuffix].build(element);firstTimer=setTimeout(function(){window["contextHelp"+nameSuffix].start(element);window["contextHelp"+nameSuffix].position(element);},delay);}element.onmouseout=function(){if(firstTimer){clearTimeout(firstTimer);}};}var createTooltipEventhandler=function(data){return function(event){tooltipNew.call(this,event,data);
};};var tooltipNew=function(event,data){event=event||window.event;if(window.TT){var el=$(this);el.title=data||this.tooltipData;window.TT.attach([el]);window.TT.elementEnter({page:{x:event.clientX,y:event.clientY}},this);}};function tt(el,title){var event=window.event||arguments.callee.caller.arguments[0];if(window.TT){el=$(el);el.title=title||(el.getElement("span.tt")||el).get("text")||el.title;if(!el.getParent("#tablehead")){el.onmouseover=null;}else{if(el.retrieve("tip:title")){if(el.retrieve("tip:title")!=el.title){el.store("tip:title",el.title);}el.title="";}}if(!el.retrieve("tip:title")){window.TT.attach([el]);window.TT.elementEnter({page:{x:event.clientX,y:event.clientY}},el);}}}function swapText(el,swapText,kmuTxt){if(!((Browser.Features.iOSTouch||Browser.Features.Touch)&&Browser.isMobile)){el=$(el);
var theWidth=el.getSize(),theFormerText=unescape(kmuTxt).toString(),theText=Browser.ie7?'<span class="edge_after"></span>'+unescape(swapText):unescape(swapText),swapTimeout=setTimeout(function(){el.addClass("over");el.innerHTML=theText;el.setStyle("width",theWidth.x+"px");},30);if(typeof el.onmouseout!=="function"){el.addEvent("mouseleave",function(){el.removeClass("over");el.innerHTML=theFormerText;el.setStyle("width","auto");if(swapTimeout){clearTimeout(swapTimeout);}});}}}var HotelListEventCallbacks={tryRemoveOverlay:(function(){var cache={};return function(type){cache[type]=true;if(cache.filterReady&&cache.sortReady){HotellistEventManager.fireEvent("removeOverlay");HotellistEventManager.fireEvent("startRenderPortionsHtmlToList");cache={};}};}()),showCounter:(function(){var elem;return function(value){if(!elem){elem=document.getElementById("counterSpan");
}if(elem){elem.innerHTML=value;elem.className="";}};}())};var createPriceGuaranteeHelp=function(){window.priceGuaranteeHelp=new ContextSensitiveHelp($("priceGuaranteeHeader"),{openEvent:(Browser.isMobile&&(Browser.Features.iOSTouch||Browser.Features.Touch))?"click":"mouseenter",layerInitiallyOpen:false,closeButton:true,maxWidth:230,minWidth:20,firstDirection:"bottom",widthOffset:25,timerDelay:250,showDelay:0,offsets:{"x":25,"y":0},maxHeight:"auto",overflowY:"visible",autoFadeDelay:4000});};window.priceGuaranteeFlag=true;var openPriceGuaranteeLightbox=function(a,evt){evt.returnValue=false;if(evt.preventDefault){evt.preventDefault();}var href=a.href;window.priceGuaranteeLightbox=new LightBox({lightBoxId:"PriceGuaranteeLightbox",openInitial:false,dynamicVerticalPosition:true,dynamicScrollFixedPosition:true,afterCreation:function(){this.wrap.addEvent("submit",function(event){event.stop();
this.getContent(event.target,event);}.bind(this));},close:function(){},xhrError:function(){console.log("todo XHR Error");}});priceGuaranteeLightbox.addEvent("contentLoaded",function(){var icon=new Element("span",{"class":"priceGuaranteeIcon"});icon.inject(this.wrap.getElement(".ciBox"));});priceGuaranteeLightbox.openLightBox(href);priceGuaranteeHelp.hide();return false;};var getAbsoluteOffetTop=function(elem){var offset=elem.offsetTop,orgElem=elem;if(elem.totalOffsetTop){return elem.totalOffsetTop;}while((elem=elem.offsetParent)&&(elem.nodeType!=9)){if(elem.totalOffsetTop){offset+=elem.totalOffsetTop;break;}else{offset+=elem.offsetTop;}}return orgElem.totalOffsetTop=offset;};var HotelList=new Class({Implements:[Options,Events],options:{hotelURL:"",errorURL:"",hollidayInsiderTeasers:{},hollidayInsiderTeaserPositions:[],texts:{},hotelContainer:undefined,baseLink:undefined,forcedSearch:false,showRoomIcon:false,hotelLink:"",hotelListRenderedCallback:function(){},teaserClickCallback:function(){}},hrsDealHotels:[],initialize:function(options){var self=this;
this.setOptions(options);this.preventListReady=false;this.reqJSON=this.createRequestObject();this.firstRequest=true;this.boundTrackPage=function(){self.trackPage();};HotellistEventManager.addEvents({"loadHotels":this.loadHotels.bind(this),"trackPage":this.boundTrackPage,"trackLink":this.trackLink.bind(this),"trackCriteo":this.trackCriteo.bind(this),"trackCriteoLayer":this.trackCriteoLayer.bind(this),"trackTradedoubler":this.trackTradedoubler.bind(this),"trackTablefootButton":this.trackTablefootButton.bind(this),"updateMetadataObject":this.updateMetadataObject.bind(this)});},doc:document,getForcedSearch:function(){return this.options.forcedSearch;},createRequestObject:function(){var self=this;return new Request({method:"GET",noCache:true,onSuccess:function(data){self.buildJSON(data);},onError:function(text,error){console.log("Error",error);
},onCancel:function(){console.log("this.reqJSON canceled: ",arguments);}.bind(this)});},createPromoRequestObject:function(){var self=this;this.reqJSONPromo=new Request({method:"GET",noCache:true,onComplete:function(){this.preventListReady=false;}.bind(this),onSuccess:function(data){self.buildJSON(data);},onError:function(text,error){console.log("Error",error);},onCancel:function(){console.log("this.reqJSONPromo canceled: ",arguments);}});return this.reqJSONPromo;},loadHotels:function(options){var url,preventListReady,linkTrackingMethod,useRequest;this.reqJSON.cancel();if(this.trackingTimeout){clearTimeout(this.trackingTimeout);}if(options){if(options.url){this.options.hotelURL=options.url;}preventListReady=options.preventListReady;linkTrackingMethod=options.linkTrackingMethod;}useRequest=this.reqJSON;
if(preventListReady){this.preventListReady=true;useRequest=(this.reqJSONPromo||this.createPromoRequestObject());}useRequest.send({url:this.options.hotelURL});if(this.firstRequest){return this;}if(linkTrackingMethod){this.linkTrackingMethod=linkTrackingMethod;}},getRatingLink:function(hn){var chlink=this.getChineseLink(hn),link;if(chlink!==false){return chlink;}link=this.options.baseLink;link+="&hotelnumber="+hn+"&activity=showListHotel"+"&method=showRating";return link;},isChineseLink:function(){return window.s.prop26==="zh_CN";},replaceHotelDetailsLink:function replaceHotelDetailsLink(number,hash,currency){return this.options.hotelLink.replace(/hotelnumber=5555/g,"")+"&actionDetails=showHotelDetailsFromHotelList"+"&hotelnumber="+number+(this.singleOfferTmpData?"&position="+this.singleOfferTmpData.listPosition:"")+(currency?"&currency="+currency:"")+(hash?"#"+hash:"");
},getChineseLink:function(hn){if(this.isChineseLink()){var link=this.replaceHotelDetailsLink(hn);if(this.options.currency!=undefined){link+="&currency="+this.options.currency;}return link;}return false;},getRoomLink:function(hn){var link;if(this.isChineseLink()){return this.getChineseLink(hn);}link=this.options.baseLink+"&hotelnumber="+hn+"&activity=showListHotel"+"&method=showHotel";return link;},getBookingLink:function(hn){var chlink=this.getChineseLink(hn),link;if(chlink!==false){return chlink;}link=this.options.bookingLink+"&hotelnumber="+hn;return link;},getDetailsLink:function(hn){var chlink=this.getChineseLink(hn),link;if(chlink!==false){return chlink;}link=this.options.baseLink;link+="&hotelnumber="+hn+"&activity=showListHotel"+"&method=showPhotos";return link;},getMapLink:function(hn){var chlink=this.getChineseLink(hn);
if(chlink!==false){return chlink;}return this.replaceHotelDetailsLink(hn,"mapHdAnchor")||undefined;},showTooltip:function($el){if(window.TT&&this.ttTexts){var titleText,evt=window.event||arguments.callee.caller.arguments[0];if($el.hasClass("jsTTrating")){titleText=this.ttTexts[0];}if($el.hasClass("jsTThasVideos")){titleText=this.ttTexts[1];}if($el.hasClass("jsTThasPhotos")){titleText=this.ttTexts[2];}}$el.title=titleText;window.TT.attach([$el]);window.TT.elementEnter({page:{x:evt.clientX,y:evt.clientY}},$el);},getMapData:function(){return this.mapData;},isHrsDeal:function(hotelTeaser){if(typeof hotelTeaser[5]!="undefined"&&hotelTeaser[5][0].length>0&&hotelTeaser[5][0][8].dealsTariff){return true;}if(typeof hotelTeaser[5]!="undefined"&&hotelTeaser[5][1].length>0&&hotelTeaser[5][1][8].dealsTariff){return true;
}return false;},lazyGenerateInterval:null,updateHotelListSearchDataLayer:function updateHotelListSearchDataLayer(properties,data){var GTMData=convertToValidTrackingObject(data);window.HRS_PUW.GTM.hotelListSearchDataLayer=window.GTMHelper.Utils.getObjectPropertiesSubset(properties,GTMData);},getHotelECommerceData:function getHotelECommerceData(data,position,pageName){var price;var originalPrice;var mapper=this.teaserDataMapper;var availability=mapper.getRoomsAvailability(data);var singleRoomData=mapper.getSingleRoomDataObject(data);var doubleRoomData=mapper.getDoubleRoomDataObject(data);if((singleRoomData&&doubleRoomData)||doubleRoomData){price=mapper.getRoomPriceInEUR(data,true);originalPrice=mapper.getOriginalPriceInEUR(data,true);}else{if(singleRoomData){price=mapper.getRoomPriceInEUR(data,false);
originalPrice=mapper.getOriginalPriceInEUR(data,false);}}return Object.assign({price:price,dimension1:(originalPrice.length>0&&originalPrice)||undefined,dimension2:window.GTMHelper.Utils.mapHrsTariff(mapper.getTariffKey(data)),dimension3:(availability.length>0&&availability)||undefined,name:mapper.getHotelNameHTML(data),id:mapper.getHotelNumber(data).toString(),category:mapper.getStarsClass(data).slice(-1)||"0",variant:mapper.getRatingString(data).replace(",",".")||undefined,position:position.toString(),brand:"0"},pageName&&{list:pageName});},buildJSON:function(data){if(!this.preventListReady){var allData,bannerHtml,hotelCount;var hotelListPropertiesSubset=["searchFilterAdvanced","searchFilterDistanceHigh","searchFilterDistanceLow","searchFilterHRSStarsHigh","searchFilterHRSStarsLow","searchFilterHotelFacilities","searchFilterHotelPayment","searchFilterHotelService","searchFilterHotelType","searchFilterPriceHigh","searchFilterPriceLow","searchFilterRatingHigh","searchFilterRatingLow","searchFilterRoomFacilities","searchFilterRoomType","searchFilterUsed","searchNumberOfResults","searchResultSortingAdditionalInfo","searchResultSortingCriteria","searchResultSortingDirection","searchStarsMin"];
try{allData=JSON.decode(data);}catch(error){console.log("JSON error: "+error);HotellistEventManager.fireEvent("removeOverlay");document.open();document.write(data);document.close();return;}if(allData.gtmDataLayer){this.updateHotelListSearchDataLayer(hotelListPropertiesSubset,allData.gtmDataLayer);window.HRS_PUW.GTM.hotelListPageDataLayer=allData.gtmDataLayer;}if(allData.sorting){this.sortingData=allData.sorting;}if(allData.filtering){this.filteringData=allData.filtering;}if(allData.map){this.mapData=allData.map;}if(allData){this.criteoTracking=allData.criteoTracking;}if(allData){this.tradedoublerTracking=allData.tradedoublerTracking;}if(allData.pageTrackingData){this.pageTrackingData=allData.pageTrackingData;}if(allData.linkTrackingData){this.linkTrackingData=allData.linkTrackingData;}if(allData.metadataTracking){this.metadataTracking=allData.metadataTracking;
}if(allData.listUpdateInfo){this.listUpdateInfo=allData.listUpdateInfo;}if(allData.hotels){HotellistEventManager.fireEvent("showCounter",allData.hotels[0]);this.expoData=allData.hotels[1];this.ttTexts=allData.hotels[2];this.trueHotelData=allData.hotels.slice(3);hotelCount=this.trueHotelData.length;if(typeof allData.teaser!="undefined"&&typeof allData.teaser.teaserType!="undefined"){if(hotelCount<allData.teaser.position){allData.teaser.position=hotelCount;}else{allData.teaser.position=allData.teaser.position;}this.options.hollidayInsiderTeaserPositions[0]=allData.teaser.position;bannerHtml=this.getHolidayInsiderBanner[allData.teaser.teaserType](allData.teaser);window.s.prop18="HI Linkout;10";this.options.hollidayInsiderTeasers["position"+allData.teaser.position]={html:bannerHtml,isDisplayed:false};
this.addTeaserTrackingParam(allData.teaser);}this.buildExpo();this.generateIdx=0;this.lastHotelPositionFullyGenerated=0;this.generateFlags={};this.teaserSeparatorData={separatorRows:{},separatorCount:0,separatorTotalHeight:0};this.teaserGenerationCache.cache={};this.teaserGenerationCache.position2IdMapper=[];this.teaserGenerationCache.tmpOfferData={};this.buildHotellistRows();this.calculateHotelTeaserHeightAssumption();getAbsoluteOffetTop(document.getElementById("hotelListCol"));var nodes=document.getElementById("containerAllHotels").childNodes,k=0;for(k=0;;k++){if(nodes[k].childNodes.length>1){break;}}if(this.lazyGenerateInterval){clearInterval(this.lazyGenerateInterval);}var self=this,maxPos=self.getMaxHotelPosition();this.lazyGenerateInterval=setInterval(function(){if(maxPos>self.lastHotelPositionFullyGenerated){self.lazyGenerateNext();
}else{clearInterval(self.lazyGenerateInterval);}},40);var myhrsSmartHotel=document.querySelectorAll(".tooltip-info a");this.trackMyhrsSmartHotel(myhrsSmartHotel);if(typeof this.options.hotelListRenderedCallback=="function"){this.options.hotelListRenderedCallback();}}else{if(allData.errorForward){window.location.href=this.options.errorFilterURL;return;}if(allData.errorType){window.location.href=this.options.errorURL+"&errorType="+allData.errorType;return;}if(allData.noticeBox){this.getDOMContainer().innerHTML=allData.noticeBox.replace('type="submit"','type="button" class="filterRestoreFromHotellist"');var input=$(this.getDOMContainer().getElementsByClassName("filterRestoreFromHotellist")[0]);HotellistEventManager.fireEvent("initializeFilterManager",this.filteringData).fireEvent("initFilterCounter").fireEvent("removeOverlay");
input.addEvent("mousedown",function(event){event.stop();HotellistEventManager.fireEvent("restoreFiltersFromHotellist");}).addEvent("click",function(event){event.stop();});}}this.firstRequest=false;if(document.getElementById("jsBusinessTariffPreselectedHotelId")){this.showBTRegisterPoupuWithHotel(document.getElementById("jsBusinessTariffPreselectedHotelId").value);}}},getHotelTeaserDataByPosition:function(position){return this.trueHotelData[position-1];},getMaxHotelPosition:function(){return this.trueHotelData.length;},getHotelDataByHotelId:function(hotelId){for(var i=0;i<this.trueHotelData.length;i++){if(hotelId==this.trueHotelData[i][0]){return this.trueHotelData[i];}}},hotelTeaserHeightAssumptionBasedOn:0,hotelTeaserHeightAssumption:140,calculateHotelTeaserHeightAssumption:function(){var maxRendered=this.teaserGenerationCache.maxRendered,container,base,i;
if(maxRendered==this.hotelTeaserHeightAssumptionBasedOn){return this.hotelTeaserHeightAssumption;}container=document.getElementById("containerAllHotels");base=this.hotelTeaserHeightAssumption*this.hotelTeaserHeightAssumptionBasedOn;for(i=this.hotelTeaserHeightAssumptionBasedOn;i<maxRendered;i++){base+=container.childNodes[i].offsetHeight+5;}return this.hotelTeaserHeightAssumption=base/(this.hotelTeaserHeightAssumptionBasedOn=maxRendered);},teaserSeparatorData:{separatorRows:{},separatorCount:0,separatorTotalHeight:0},buildHotellistRows:function(){var maxIndex=this.trueHotelData.length,i,d,hotelListPosition,hotelTeaser,doc=this.doc,renderStart,domContainer=doc.createDocumentFragment();window.listLogger=this.logger;this.calculateInitialGeneratedHotelsNum(true);this.hrsDealHotels=[];var bodyEl=document.getElementsByTagName("body");
for(hotelListPosition=1;hotelListPosition<=maxIndex;hotelListPosition++){hotelTeaser=this.getHotelTeaserDataByPosition(hotelListPosition);if(this.isHrsDeal(hotelTeaser)){this.hrsDealHotels.push({hotelPosition:hotelListPosition,hotelId:hotelTeaser[0]});}if(hotelTeaser.length){if(this.options.hollidayInsiderTeaserPositions.indexOf(hotelListPosition)>-1){d=doc.createElement("div");d.innerHTML=this.options.hollidayInsiderTeasers["position"+hotelListPosition].html;domContainer.appendChild(d.childNodes[0]);}if(hotelTeaser[0]==="separator"){d=doc.createElement("div");d.innerHTML=hotelTeaser[1];domContainer.appendChild(d.childNodes[0]);this.teaserSeparatorData.separatorRows[hotelListPosition]=true;this.teaserSeparatorData.separatorCount++;}else{domContainer.appendChild(this.jsonSingleOffer(hotelListPosition));
}}}renderStart=this.logger.time();this.renderDOM(domContainer);this.logger.createGlobal("render",{total:this.logger.time()-renderStart});this.lazyRenderUpTo(this.calculateInitialGeneratedHotelsNum(true));this.logger.outputResults();},getDOMContainer:function(){return this.container=this.container||$(this.options.hotelContainer);},renderDOM:function(domData){if(!this.preventListReady){this.container=document.getElementById("containerAllHotels");if(this.container){if(this.renderTimeout){clearTimeout(this.renderTimeout);}this.container.innerHTML="";this.container.appendChild(domData);this.listReadyTimeout=setTimeout(function(){new window.HRS_PUW.GTM.EventHandler.HotelListViewHandler({isHotelListPage:true,selector:".hotelTeaserContainer",hotelData:this.trueHotelData,mapper:this.teaserDataMapper});
this.initEventHandlers();this.fireEvent("listReady");}.bind(this),0);}else{this.renderTimeout=setTimeout(function(){this.renderDOM(domData);}.bind(this),100);}}},initEventHandlers:function initEventHandlers(){var that=this;var MOUSE_BUTTON={LEFT:0};var container=document.getElementById("containerAllHotels");container.addEventListener("mousedown",function(e){if(e.button!==MOUSE_BUTTON.LEFT){return;}var target=e.target;var hotelTeaser=target.closest(".hotelTeaserContainer");that.trackHotelDetailsClick(e,hotelTeaser);if(target.closest(".CorporateDiscountTeaser")){that.showBTRegisterPoupuWithHotel(hotelTeaser&&hotelTeaser.getAttribute("id"),true);}});},trackHotelDetailsClick:function trackHotelDetailsClick(e,hotelTeaser){var hotelPosition=hotelTeaser.dataset.listPos;var initialPageName=window.GTMHelper.getInitialPageName();
var elementClickName=window.GTMHelper.Utils.getElementClickName(e.target);var hotelData=this.trueHotelData.find(function(el){return el[0].toString()===hotelTeaser.id;});if(!hotelData){return;}var hotelName=this.teaserDataMapper.getHotelNameHTML(hotelData);var eCommerceData=this.getHotelECommerceData(hotelData,hotelPosition);window.HRS_PUW.GTM.EventHandler.HotelListClickHandler({"pageName":initialPageName,"elementClickName":elementClickName,"elementClickPosition":hotelPosition,"elementClickAdditionalInfo":hotelName,"eCommerceData":[eCommerceData]});},sortingDataMapper:{getSortingDataObject:function(sortingData){var obj={},automaticSorting=sortingData.distance&&sortingData.distance[4]&&sortingData.distance[6];if(automaticSorting){obj.sortedByStations=sortingData.distance[5][0];obj.sortedByAirports=sortingData.distance[6][0];
}else{obj.sortedByStations=sortingData.listhead.train[0];obj.sortedByAirports=sortingData.listhead.airport[0];}obj.manual={airport:sortingData.listhead.airport[0]?{enabled:sortingData.listhead.airport[0]}:false,area:sortingData.listhead.area[0]?{enabled:sortingData.listhead.area[0],code:sortingData.listhead.area[3]}:false,highway:sortingData.listhead.highway[0]?{enabled:sortingData.listhead.highway[0]}:false,train:sortingData.listhead.train[0]?{enabled:sortingData.listhead.train[0]}:false};return obj;}},teaserIconDataMapper:{getIconDataObject:function(iconsData,iconIndex){var dataIndex=(iconIndex*3);return{label:iconsData[dataIndex],description:iconsData[dataIndex+1],cssClass:iconsData[dataIndex+2]};}},teaserDataMapper:{getHotelNumber:function(teaserData){return teaserData[0];},getPosition:function(teaserData){return teaserData[1][0];
},isChecked:function(teaserData){return teaserData[1][1];},isSmartHotel:function(teaserData){return teaserData[11].isSmartHotel;},getPhotoId:function(teaserData){return teaserData[2][0];},getPhotoClass:function(teaserData){return teaserData[2][1];},hasVideo:function(teaserData){return teaserData[2][2];},getPhotoURL:function(teaserData){return teaserData[2][3];},isChineseFriendly:function(teaserData){return teaserData[2][4];},getHotelNameLinkId:function(teaserData){return teaserData[3][0][0];},getHotelCityLinkId:function(teaserData){return teaserData[3][0][2];},getHotelNameHTML:function(teaserData){return teaserData[3][1];},getHotelCityHTML:function(teaserData){return teaserData[3][2];},hasSeal:function(teaserData){return teaserData[3][3];},getRatingId:function(teaserData){return teaserData[4][0];
},getStarsClass:function(teaserData){return teaserData[4][1];},getGenerateRatings:function(teaserData){return teaserData[4][2];},getRatingString:function(teaserData){return teaserData[4][3];},getRatingNumber:function(teaserData){return teaserData[4][4];},getHRRatingString:function(teaserData){return teaserData[4][5];},getSingleRoomData:function(teaserData){return teaserData[5][0];},getSingleRoomDataObject:function(teaserData){return this.getRoomDataObject(this.getSingleRoomData(teaserData));},getDoubleRoomDataObject:function(teaserData){return this.getRoomDataObject(this.getDoubleRoomData(teaserData));},getRoomDataObject:function(roomData){return roomData&&roomData.length?{trackingLink:roomData[0],priceHTML:roomData[1],iconData:roomData[5],candyData:roomData[6],provisionsText:roomData[7]}:null;
},getRoomsDataObject:function(teaserData){return{singleRoom:this.getSingleRoomDataObject(teaserData),doubleRoom:this.getDoubleRoomDataObject(teaserData)};},getIsMixedRoomsOffer:function(teaserData){return(this.getSingleRoomDataObject(teaserData)&&this.getDoubleRoomDataObject(teaserData))?true:false;},getDoubleRoomData:function(teaserData){return teaserData[5][1];},getKMUHint:function(teaserData){return teaserData[5][2];},getBusinessTariffOriginalPrice:function(teaserData,doubleRoom){var indexRoom=doubleRoom?1:0;if(teaserData[5][indexRoom][8]&&teaserData[5][indexRoom][8]["originalPrice"]!=""){return teaserData[5][indexRoom][8]["originalPrice"]+" "+teaserData[5][indexRoom][8]["currency"];}else{return"";}},getOriginalPriceInEUR:function getOriginalPrice(teaserData,doubleRoom){var indexRoom=doubleRoom?1:0;
return teaserData[5][indexRoom][8]["originalPriceInEUR"];},getRoomPriceInEUR:function getOriginalPrice(teaserData,doubleRoom){var indexRoom=doubleRoom?1:0;return teaserData[5][indexRoom][8]["roomPriceInEUR"];},getRoomsAvailability:function getRoomsAvailability(teaserData){if(teaserData&&teaserData[7]&&teaserData[7][3]){return teaserData[7][3]["roomsAvailable"];}return"";},isMyHRSTariff:function(teaserData,doubleRoom){var indexRoom=doubleRoom?1:0;if(teaserData[5][indexRoom][8]&&teaserData[5][indexRoom][8]["myHRSTariff"]==true){return true;}else{return false;}},getRoomAbbreviation:function(teaserData,doubleRoom){var indexRoom=doubleRoom?1:0;return teaserData[5][indexRoom][8]&&teaserData[5][indexRoom][8]["roomAbbreviation"];},isBusinessTravelerDiscount:function(teaserData){if(teaserData[5][2]!=undefined&&teaserData[5][2][1]!=undefined&&teaserData[5][2][1]>0){return true;
}else{return false;}},isCorporateDiscountAvailable:function isCorporateDiscountAvailable(teaserData,singleRoom,doubleRoom){var roomIndex=singleRoom?0:1;var isDicountPossible=teaserData[5][roomIndex][8]["corporateDiscountPossible"];var isCorporateDiscountAlreadyUnlocked=teaserData[5][roomIndex][8]["maxBusinessTravelerDiscountAmount"].length;if(singleRoom&&doubleRoom){isDicountPossible=teaserData[5][0][8]["corporateDiscountPossible"]||teaserData[5][1][8]["corporateDiscountPossible"];isCorporateDiscountAlreadyUnlocked=teaserData[5][2]&&!!teaserData[5][2][1];}return isDicountPossible&&!isCorporateDiscountAlreadyUnlocked&&this.isUserEligibleForDiscount();},isUserEligibleForDiscount:function isUserEligibleForDiscount(){var locale=window.HRS_PUW.locale;var isLocaleAllowed=locale.isGerman||locale.isEnglish;
var isLoggedIn=document.querySelector("body").classList.contains("signedin");return !isLoggedIn&&isLocaleAllowed;},getBusinessTravelerDiscontPrice:function(teaserData,doubleRoom){var indexRoom=doubleRoom?1:0;if(teaserData[5][indexRoom][8]&&teaserData[5][indexRoom][8]["maxBusinessTravelerDiscountAmount"]!=""){return teaserData[5][indexRoom][8]["maxBusinessTravelerDiscountAmount"]+" "+teaserData[5][indexRoom][8]["currency"];}else{return"";}},getMyCandy:function(teaserData){var sr=this.getSingleRoomData(teaserData),dr;if(sr.length){return sr[6];}dr=this.getDoubleRoomData(teaserData);if(dr.length){return dr[6];}return null;},getDistanceData:function(teaserData){return teaserData[6];},getDistanceDataObject:function(teaserData){var data=this.getDistanceData(teaserData),isDefined=data.length>1;return{isDefined:isDefined,area:isDefined&&data[0]&&data[0].length&&data[0][0]?{distance:data[0][0],name:data[0][1],type:data[0][2],distanceUnit:data[0][3]}:null,station:isDefined&&data[1]&&data[1].length&&data[1][0]?{distance:data[1][0],name:data[1][1],type:data[1][2],distanceUnit:data[1][3]}:null,airport:isDefined&&data[2]&&data[2].length&&data[2][0]?{distance:data[2][0],name:data[2][1],type:data[2][2],distanceUnit:data[2][3]}:null,highway:isDefined&&data[3]&&data[3].length&&data[3][0]?{distance:data[3][0],name:data[3][1],distanceUnit:data[0][3]}:null};
},getHotelDetailsLinkId:function(teaserData){return teaserData[7][0];},getShortage:function(teaserData){return teaserData[7][1];},getTariffData:function(teaserData){return teaserData[10];},getTariffName:function(teaserData){return teaserData[10]?teaserData[10][0]:null;},getTariffKey:function(teaserData){return(teaserData[10]&&teaserData[10][1]!="null")?teaserData[10][1]:null;},isFlexTariff:function(teaserData){return this.getTariffKey(teaserData)==="flex"||this.getTariffKey(teaserData)==="businessFlex";},getTariffDataObject:function(teaserData){var data=this.getTariffData(teaserData);return data?{text:data[0],enabled:data[1]}:null;}},divTemplate:document.createElement("div"),spanTemplate:document.createElement("span"),linkTemplate:(function(){var link=document.createElement("a");link.target="_blank";
return link;}()),imgTemplate:document.createElement("img"),h5Template:document.createElement("h5"),pTemplate:document.createElement("p"),getCheckboxAreaDOMForSingleOfferTemplate:(function(){var cache={};return function(isChineseLink){var key=isChineseLink?1:0,container,part;if(cache[key]){return cache[key].cloneNode(true);}container=this.divTemplate.cloneNode(false);container.className="mm";part=(isChineseLink?this.linkTemplate:this.spanTemplate).cloneNode(false);part.className="op";container.appendChild(part);return(cache[key]=container).cloneNode(true);};}()),createCheckboxAreaDOMForSingleOffer:function(){var tmpData=this.singleOfferTmpData,isChinese=tmpData.isChinese,container=this.getCheckboxAreaDOMForSingleOfferTemplate(isChinese),part=container.firstChild;if(isChinese){part.href=tmpData.detailsLink;
}part.appendChild(this.doc.createTextNode(tmpData.displayPosition));return container;},tqSealPattern:function(){csh(this,"tqSealPattern");},chineseFriendlyPattern:function(){csh(this,"chineseFriendlyPattern");},getHotelPhotoAreaDOMForSingleOfferTemplate:(function(){var cache={};return function(hasSeal,isChineseFriendly,isChineseLink){var key=(hasSeal?"1":"0")+(isChineseFriendly?"1":"0")+(isChineseLink?"1":"0"),container,link,img,span;if(cache[key]){return cache[key].cloneNode(true);}container=this.divTemplate.cloneNode(false);link=this.linkTemplate.cloneNode(false);img=this.imgTemplate.cloneNode(false);img.alt="";container.appendChild(link).appendChild(img);if(hasSeal){span=this.spanTemplate.cloneNode(false);span.className="tqSeal";container.appendChild(span);}if(isChineseFriendly){if(isChineseLink){link=this.linkTemplate.cloneNode(false);
span=this.spanTemplate.cloneNode(false);span.className="chineseFriendly";container.appendChild(link).appendChild(span);}else{span=this.spanTemplate.cloneNode(false);span.className="chineseFriendly";container.appendChild(span);}}return(cache[key]=container).cloneNode(true);};}()),createHotelPhotoAreaDOMForSingleOffer:function(){var tmpData=this.singleOfferTmpData,hasSeal=tmpData.hasSeal,isChineseFriendly=tmpData.isChineseFriendly,isChineseLink=tmpData.isChinese,fotoURL=tmpData.fotoURL,hasImage=fotoURL.indexOf("nophoto")===-1,photoClass="",smartHotel=tmpData.isSmartHotel,container=this.getHotelPhotoAreaDOMForSingleOfferTemplate(hasSeal,isChineseFriendly,isChineseLink),detailsLink=this.replaceHotelDetailsLink(tmpData.hotelNumber),firstLink=container.firstChild,img=firstLink.firstChild,mod=0,link;
if(hasImage){photoClass=tmpData.hasVideo?" jsTThasVideos":" jsTThasPhotos";}container.className="hotelPhoto "+tmpData.photoClass+(hasSeal?" hasTqSeal":"")+(isChineseFriendly?" hasChineseFriendly":"");firstLink.id=tmpData.photoId;firstLink.className="test pu"+photoClass;firstLink.href=detailsLink;img._src=fotoURL;if(hasSeal){container.childNodes[1].onmouseover=this.tqSealPattern;mod++;}if(isChineseFriendly){container.childNodes[1+mod].onmouseover=this.chineseFriendlyPattern;}if(isChineseFriendly&&isChineseLink){link=container.childNodes[1+mod];link.href=detailsLink;}if(smartHotel){var smartHotelDiv=document.createElement("div"),tooltip=$$(".tooltip-info");smartHotelDiv.addClass("smart-hotel");smartHotelDiv.innerHTML='<img class="icon" src="images/wide/_general/_general/icons/smartHotelIcon16.png"><span class="label">smarthotel</span>';
container.appendChild(smartHotelDiv);smartHotelDiv.addEvents({"mouseenter":function(e){smartHotelDiv.appendChild(tooltip[0]);},"mouseleave":function(){smartHotelDiv.getElement(tooltip[0]).remove();}});}return container;},ttThis:function(){tt(this);},getHotelNameAndAddressAreaDOMForSingleOfferTemplate:(function(){var template={};return function(starsClass,isChineseLink){var container,link,img,span,span2,div,isChineseLinkKey=isChineseLink?1:0;if(!template[starsClass]){template[starsClass]={};}if(template[starsClass][isChineseLinkKey]){return template[starsClass][isChineseLinkKey].cloneNode(true);}container=this.divTemplate.cloneNode(false);container.className="hotelname hn pu";if(starsClass){span=this.spanTemplate.cloneNode(false);span.className=starsClass;if(isChineseLink){link=this.linkTemplate.cloneNode(false);
container.appendChild(link).appendChild(span);}else{container.appendChild(span);}var span=document.createElement("span");span.className="hrsStarsTooltip";span.appendChild(document.createTextNode(this.options.texts.hrsStars));container.appendChild(span);}link=this.linkTemplate.cloneNode(false);link.className="pu jsTrackLink";link.href+="&position="+this.singleOfferTmpData.listPosition;container.appendChild(link);link=this.linkTemplate.cloneNode(false);link.className="jsTrackLink address pu";link.title="";if(isChineseLink){link.target="_blank";}container.appendChild(link);div=this.divTemplate.cloneNode(false);div.className="borderHelper";container.appendChild(div);return(template[starsClass][isChineseLinkKey]=container).cloneNode(true);};}()),createHotelNameAndAddressAreaDOMForSingleOffer:function(){var tmpData=this.singleOfferTmpData,hotelNumber=tmpData.hotelNumber,starsClass=tmpData.starsClass,hotelNameLinkId=tmpData.hotelNameLinkId,hotelCityLinkId=tmpData.hotelCityLinkId,hotelNameHTML=tmpData.hotelNameHTML,hotelCityHTML=tmpData.hotelCityHTML,isChineseLink=tmpData.isChinese,detailsLink=tmpData.detailsLink,container=this.getHotelNameAndAddressAreaDOMForSingleOfferTemplate(starsClass,isChineseLink),position=tmpData.listPosition,mod=0,tmp;
detailsLink+="&actionDetails=showHotelDetailsFromHotelList&position="+position;container.setAttribute("href",detailsLink);if(starsClass){tmp=container.firstChild;tmp.tooltipData=this.options.texts.hotelCategoryTitle;tmp.onmouseover=tooltipNew;if(isChineseLink){tmp.href=detailsLink;}mod=2;}tmp=container.childNodes[mod];tmp.id=hotelNameLinkId;tmp.href=this.replaceHotelDetailsLink(tmpData.hotelNumber);tmp.appendChild(this.doc.createTextNode(hotelNameHTML));tmp=container.childNodes[mod+1];tmp.id=hotelCityLinkId;tmp.href=this.getMapLink(hotelNumber);tmp.appendChild(this.doc.createTextNode(hotelCityHTML));tmp.tooltipData=hotelCityHTML;tmp.onmouseover=tooltipNew;return container;},getRatingAreaDOMForSingleOfferTemplate:(function(){var template={};return function(teaserData,isChineseLink){var container,link,div,part,span,ratingComma,ratingPoint,showRatingLink,isChineseLinkKey=isChineseLink?1:0,key,key1=teaserData[4][2]?1:0,key2=teaserData[4][3]?teaserData[4][3]:"_",ratingAsTextExistsKey=teaserData[4][5]?1:0,doc=this.doc;
key=""+isChineseLinkKey+key1+key2+ratingAsTextExistsKey;if(template[key]){return template[key].cloneNode(true);}container=this.divTemplate.cloneNode(false);container.className="hr pu"+this.options.noRatingPaddingClass;if(teaserData[4][2]){ratingComma=teaserData[4][3];if(isNaN(ratingComma)||ratingComma.indexOf(".")!==-1){link=this.linkTemplate.cloneNode(false);link.className="pu totalRating jsTTrating";link.title="";span=this.spanTemplate.cloneNode(false);link.appendChild(span);if(ratingAsTextExistsKey){span=this.spanTemplate.cloneNode(false);span.className="ratingAsText";link.appendChild(span);}span=this.spanTemplate.cloneNode();span.className="totalRatingsText";link.appendChild(span);container.appendChild(link);}else{part=(isChineseLink?this.linkTemplate:this.spanTemplate).cloneNode(false);
part.className="noRatingText";part.appendChild(doc.createTextNode(this.options.texts.noRating));container.appendChild(part);}}div=this.divTemplate.cloneNode(false);div.className="borderHelper";container.appendChild(div);return(template[key]=container).cloneNode(true);};}()),createRatingAreaDOMForSingleOffer:function(teaserData){var tmpData=this.singleOfferTmpData,isChineseLink=tmpData.isChinese,container=this.getRatingAreaDOMForSingleOfferTemplate(teaserData,isChineseLink),position=tmpData.listPosition,humanReadableRating=tmpData.ratingHRString,ratingString,ratingNumber,displayRatingNumber,ratingNumberTxt,tmp,tmp2,doc=this.doc,options=this.options,texts=options.texts;tmpData.detailsLink+="&actionDetails=showHotelDetailsFromHotelList&position="+position;container.className="hr pu"+options.noRatingPaddingClass;
container.setAttribute("href",tmpData.detailsLink);if(tmpData.generateRatings){ratingString=tmpData.ratingString;ratingNumber=typeof ratingString==="string"?parseFloat(ratingString.replace(",","."),10):ratingString;if(isNaN(ratingString)||ratingString.indexOf(".")!==-1){displayRatingNumber=ratingNumber==10?"10":ratingString;ratingNumberTxt=(tmpData.ratingNumber===1)?texts.oneRating:texts.totalRatings;tmp=container.firstChild;tmp.id=tmpData.ratingId;tmp.href=this.replaceHotelDetailsLink(tmpData.hotelNumber,"ratingAnchor");tmp2=tmp.firstChild;tmp2.className="icon rating"+Math.round(ratingNumber);tmp2.appendChild(doc.createTextNode(displayRatingNumber));if(humanReadableRating){tmp.childNodes[1].appendChild(doc.createTextNode(humanReadableRating));tmp.childNodes[2].appendChild(doc.createTextNode(teaserData[4][4]+" "+ratingNumberTxt));
}else{tmp.childNodes[1].appendChild(doc.createTextNode(teaserData[4][4]+" "+ratingNumberTxt));}}else{if(isChineseLink){container.firstChild.href=tmpData.ratingLink;}}}return container;},getDistanceAreaDOMForSingleOfferTemplate:(function(){var template={0:null,1:{}};return function(sortingDataObject){var container,div,tmpData=this.singleOfferTmpData,isChineseLink=tmpData.isChinese,distanceData=tmpData.distanceData,isDefinedKey=distanceData.isDefined?1:0,isChineseKey=isChineseLink?1:0,key,distanceDataAreaKey,distanceDataHighwayKey,distanceDataAirportKey,sortingManualAreaKey,sortingManualHighwayKey,distanceDataStationKey,setFirstTippKey,setAirportTippKey,setStationTippKey,chinesePartBase=isChineseLink?this.linkTemplate:this.divTemplate;if(!isDefinedKey){if(template[isDefinedKey]){return template[isDefinedKey].cloneNode(true);
}}else{distanceDataAreaKey=distanceData.area?1:0;distanceDataHighwayKey=distanceData.highway?1:0;distanceDataAirportKey=distanceData.airport?1:0;distanceDataStationKey=distanceData.station?1:0;sortingManualAreaKey=sortingDataObject.manual.area?1:0;sortingManualHighwayKey=sortingDataObject.manual.highway?1:0;setFirstTippKey=((distanceData.area&&distanceData.area.name)||(distanceData.highway&&distanceData.highway.name))?1:0;setAirportTippKey=(distanceDataAirportKey&&distanceData.airport.name)?1:0;setStationTippKey=(distanceDataStationKey&&distanceData.station.name)?1:0;key=""+distanceDataAreaKey+distanceDataHighwayKey+distanceDataAirportKey+distanceDataStationKey+sortingManualAreaKey+sortingManualHighwayKey+isChineseKey+setFirstTippKey+setAirportTippKey+setStationTippKey;if(template[isDefinedKey][key]){return template[isDefinedKey][key].cloneNode(true);
}}container=this.divTemplate.cloneNode(false);container.className="distances pu";div=this.divTemplate.cloneNode(false);div.className="distances_centered";container.appendChild(div);if(isDefinedKey){if(distanceDataAreaKey){if((!sortingManualHighwayKey)||(sortingManualHighwayKey&&distanceDataHighwayKey)){div.appendChild(chinesePartBase.cloneNode(false));}}if(distanceDataAirportKey){div.appendChild(chinesePartBase.cloneNode(false));}if(distanceDataStationKey){div.appendChild(chinesePartBase.cloneNode(false));}}div=this.divTemplate.cloneNode(false);div.className="borderHelper";container.appendChild(div);if(!isDefinedKey){template[isDefinedKey]=container;}else{template[isDefinedKey][key]=container;}return container.cloneNode(true);};}()),createDistanceAreaDOMForSingleOffer:function(teaserData){var tmpData=this.singleOfferTmpData,sortingDataObject=this.sortingDataMapper.getSortingDataObject(this.sortingData),manualSorting=sortingDataObject.manual,distanceData=tmpData.distanceData,detailsLink=tmpData.detailsLink,isChineseLink=tmpData.isChinese,doc=this.doc,container=this.getDistanceAreaDOMForSingleOfferTemplate(sortingDataObject),position=tmpData.listPosition,distancesContainer=container.firstChild,areaTemp,airportTemp,stationTemp,highwayTemp,mod=0,tmp,useDataObject,styleClass="",setFirstTipp="";
tmpData.ratingLink+="&actionDetails=showHotelDetailsFromHotelList&position="+position;container.setAttribute("href",tmpData.ratingLink);if(distanceData.isDefined){if(areaTemp=distanceData.area){if(!manualSorting.area&&!manualSorting.highway&&this.lastStyleClass&&this.lastStyleClass.indexOf("citycenter")===-1){styleClass=this.lastStyleClass.replace(" bold","");}else{if(manualSorting.highway){styleClass="highway bold";}else{if(manualSorting.area){styleClass=manualSorting.code+" bold";}}}highwayTemp=distanceData.highway;setFirstTipp=(highwayTemp&&highwayTemp.name)||areaTemp.name;if(manualSorting.highway){if(highwayTemp){useDataObject=highwayTemp;}}else{useDataObject=areaTemp;}if(useDataObject){tmp=distancesContainer.firstChild;tmp.className="hd "+styleClass;tmp.appendChild(doc.createTextNode(useDataObject.distance+" "+areaTemp.distanceUnit));
if(isChineseLink){tmp.href=detailsLink;}if(setFirstTipp){tmp.tooltipData=useDataObject.name;tmp.onmouseover=tooltipNew;}mod+=1;}this.lastStyleClass=styleClass;}if(airportTemp=distanceData.airport){tmp=distancesContainer.childNodes[mod];tmp.className="hd "+airportTemp.type+(sortingDataObject.sortedByAirports?" bold":"");tmp.appendChild(doc.createTextNode(airportTemp.distance+" "+airportTemp.distanceUnit));if(isChineseLink){tmp.href=detailsLink;}if(airportTemp.name){tmp.tooltipData=airportTemp.name;tmp.onmouseover=tooltipNew;}mod+=1;}if(stationTemp=distanceData.station){tmp=distancesContainer.childNodes[mod];tmp.className="hd "+stationTemp.type+(sortingDataObject.sortedByStations?" bold":"");tmp.appendChild(doc.createTextNode(stationTemp.distance+" "+stationTemp.distanceUnit));if(isChineseLink){tmp.href=detailsLink;
}if(stationTemp.name){tmp.tooltipData=stationTemp.name;tmp.onmouseover=tooltipNew;}}}return container;},getPriceBreakfastAreaDOMForSingleOfferTemplate:(function(){var template={};return function(teaserData,isChinese){var mapper=this.teaserDataMapper,singleRoomData=mapper.getSingleRoomData(teaserData),doubleRoomData=mapper.getDoubleRoomData(teaserData),roomsDataObject=mapper.getRoomsDataObject(teaserData),singleRoomIcon,doubleRoomIcon,container,link,img,span,span2,div,div2,part,iconData,iconText,provisionsEZ=singleRoomData[7],provisionsDZ=doubleRoomData[7],stupidKey=(provisionsEZ&&provisionsDZ||!(doubleRoomData&&doubleRoomData.length))?1:0,isChineseKey=isChinese?1:0,singleRoomKey=roomsDataObject.singleRoom?1:0,singleRoomDiscountsKey=0,singleRoomIconKey=0,doubleRoomKey=roomsDataObject.doubleRoom?1:0,doubleRoomDiscountsKey=0,doubleRoomIconKey=0,shortageKey=mapper.getShortage(teaserData)?1:0,key,i;
container=this.divTemplate.cloneNode(false);container.className="np pu";if(teaserData[10]){var isTariff=teaserData[10][1];if(isTariff&&isTariff!="null"){var srTariff=isTariff;var drTariff=isTariff;}}if(singleRoomKey){singleRoomIcon=roomsDataObject.singleRoom.iconData;if(singleRoomIcon.length){for(i=0;i<singleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(singleRoomIcon,i);if(iconData.cssClass!=="hotdeal"){singleRoomIconKey+=1;}}}singleRoomDiscountsKey=(singleRoomIcon.length||srTariff)?1:0;}if(doubleRoomKey){doubleRoomIcon=roomsDataObject.doubleRoom.iconData;if(doubleRoomIcon.length){for(i=0;i<doubleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(doubleRoomIcon,i);if(iconData.cssClass!=="hotdeal"){doubleRoomIconKey+=1;}}}doubleRoomDiscountsKey=(doubleRoomData&&(doubleRoomIcon.length||drTariff))?1:0;
}key=""+isChineseKey+stupidKey+singleRoomKey+singleRoomDiscountsKey+singleRoomIconKey+doubleRoomKey+doubleRoomDiscountsKey+doubleRoomIconKey+shortageKey+(isTariff?1:0);if(template[key]){return template[key].cloneNode(true);}if(singleRoomKey){if(singleRoomDiscountsKey){div=this.divTemplate.cloneNode(false);div.className="discounts";if(singleRoomIcon.length){for(i=0;i<singleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(singleRoomIcon,i);if(iconData.cssClass!=="hotdeal"){part=(isChinese?this.linkTemplate:this.spanTemplate).cloneNode(false);div.appendChild(part);}}}container.appendChild(div);}div=this.divTemplate.cloneNode(false);div.className="clearer";container.appendChild(div);span=this.spanTemplate.cloneNode(false);span.className="priceContainer";link=this.linkTemplate.cloneNode(false);
link.className="standardPrice pu";container.appendChild(span).appendChild(link);if(isTariff&&isTariff!="null"){span2=this.spanTemplate.cloneNode(false);span.appendChild(span2);}div=this.divTemplate.cloneNode(false);div.className="clearer";container.appendChild(div);if(stupidKey){part=(isChineseKey?this.linkTemplate:this.divTemplate).cloneNode(false);part.className="hi";container.appendChild(part);}}if(doubleRoomKey){doubleRoomIcon=roomsDataObject.doubleRoom.iconData;container.appendChild(this.divTemplate.cloneNode(false));if(doubleRoomDiscountsKey){div=this.divTemplate.cloneNode(false);div.className="discounts lastDiscounts";var isFull=false;if(doubleRoomIcon.length){for(i=0;i<doubleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(doubleRoomIcon,i);if(iconData.cssClass!=="hotdeal"){part=(isChinese?this.linkTemplate:this.spanTemplate).cloneNode(false);
div.appendChild(part);isFull=true;}}}if(!isFull){div.className+=" discountsEmpty";}container.appendChild(div);}div=this.divTemplate.cloneNode(false);div.className="clearer";container.appendChild(div);span=this.spanTemplate.cloneNode(false);span.className="priceContainer";link=this.linkTemplate.cloneNode(false);link.className="standardPrice pu";link.target="_blank";container.appendChild(span).appendChild(link);if(isTariff&&isTariff!="null"){span2=this.spanTemplate.cloneNode(false);span.appendChild(span2);}div=this.divTemplate.cloneNode(false);div.className="clearer";container.appendChild(div);part=(isChineseKey?this.linkTemplate:this.divTemplate).cloneNode(false);part.className="hi";container.appendChild(part);}div=this.divTemplate.cloneNode(false);div.className="booking";div2=this.divTemplate.cloneNode(false);
link=this.linkTemplate.cloneNode(false);link.className="standardPrice pu HD__button";link.target="_blank";link.appendChild(this.doc.createTextNode(this.options.texts.details));container.appendChild(div).appendChild(div2).appendChild(link);if(shortageKey){part=(isChineseKey?this.linkTemplate:this.divTemplate).cloneNode(false);part.className="shortage";container.appendChild(part);}return(template[key]=container).cloneNode(true);};}()),createCorporateDiscountTeaser:function createCorporateDiscountTeaser(multiOffer){var container=this.divTemplate.cloneNode(false);var icon=this.divTemplate.cloneNode(false);var text=this.spanTemplate.cloneNode(false);container.className="CorporateDiscountTeaser goToKisSMElayer gtm__business-layover--locked"+(multiOffer?" CorporateDiscountTeaser--multi":"");icon.className="CorporateDiscountTeaser__icon-lock";
text.className="CorporateDiscountTeaser__text";text.innerText=window.HRS_PUW.i18n.myHRS.CORPORATE_DISCOUNT;container.appendChild(text);container.appendChild(icon);return container;},createPriceBreakfastAreaDOMForSingleOffer:function(teaserData){var mapper=this.teaserDataMapper,tmpData=this.singleOfferTmpData,detailsLink=tmpData.detailsLink,isChinese=tmpData.isChinese,roomsDataObject=mapper.getRoomsDataObject(teaserData),singleRoomDataObject=roomsDataObject.singleRoom,doubleRoomDataObject=roomsDataObject.doubleRoom,singleRoomPriceText,doubleRoomPriceText,singleRoomIcon,doubleRoomIcon,provisionsEZ,provisionsDZ,iconData,tmp,i,j,container=this.getPriceBreakfastAreaDOMForSingleOfferTemplate(teaserData),position=tmpData.listPosition,tttID,doc=this.doc,priceContainer,mainMod=0,singleRoomMod=0,tariffKey=tmpData.tariffKey;
tmpData.detailsLink+="actionDetails=showHotelDetailsFromHotelList&position="+position;tmpData.roomLink+="actionDetails=showHotelDetailsFromHotelList&position="+position;container.setAttribute("href",tmpData.roomLink);if(doubleRoomDataObject){provisionsDZ=doubleRoomDataObject.provisionsText;}var isLongPriceSg=false;var isLongPriceDb=false;if(singleRoomDataObject){provisionsEZ=singleRoomDataObject.provisionsText;singleRoomPriceText=this.getPriceFromStrong(singleRoomDataObject.priceHTML);if(this.isLongPrice(singleRoomPriceText)){isLongPriceSg=true;}singleRoomPriceText="<strong>"+singleRoomPriceText+"</strong>";singleRoomIcon=singleRoomDataObject.iconData;if(this.options.showRoomIcon&&singleRoomDataObject.priceHTML.length){singleRoomPriceText=singleRoomPriceText.split("<strong>");singleRoomPriceText='<span class="ic_ez"></span><strong>'+singleRoomPriceText[1];
}if(singleRoomIcon.length||tariffKey){if(singleRoomIcon.length){var discountsContainer=container.firstChild;j=0;for(i=0;i<singleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(singleRoomIcon,i);if(iconData.cssClass!=="hotdeal"){tmp=discountsContainer.childNodes[j];if(isChinese){tmp.href=detailsLink;}tmp.className=iconData.cssClass;tmp.onmouseover=createTooltipEventhandler(iconData.description);switch(iconData.cssClass){case"discount":case"corpRate":tmp.appendChild(doc.createTextNode(iconData.label));tmp.style.fontWeight="bold";break;case"economy":tmp.appendChild(doc.createTextNode(iconData.label));break;default:tmp.appendChild(doc.createTextNode(iconData.description));}j++;}}}singleRoomMod+=1;}priceContainer=container.childNodes[singleRoomMod+1];tmp=priceContainer.firstChild;
tmp.id=roomsDataObject.singleRoom.trackingLink;tmp.href=this.replaceHotelDetailsLink(tmpData.hotelNumber,"priceAnchor");tmp.innerHTML=singleRoomPriceText;if(tariffKey){tttID="toolTipTariff"+teaserData[10][1];tmp=priceContainer.childNodes[1];tmp.className="hasTariff "+tariffKey+" jsTooltipTariff";tmp.setAttribute("data-toolTipText",tttID);if(!$(tttID)){createTooltip(this.ttTexts,teaserData[10],tttID,this.options.tariffsLightboxURL);}}var breakfastInfoContainer=container.childNodes[singleRoomMod+3];if(provisionsEZ&&provisionsDZ||!doubleRoomDataObject){if(isChinese){breakfastInfoContainer.href=detailsLink;}breakfastInfoContainer.appendChild(doc.createTextNode(provisionsEZ));singleRoomMod+=1;}mainMod+=singleRoomMod+3;}var doubleRoomMod=0;if(doubleRoomDataObject){provisionsDZ=doubleRoomDataObject.provisionsText;
doubleRoomPriceText=this.getPriceFromStrong(doubleRoomDataObject.priceHTML);if(this.isLongPrice(doubleRoomPriceText)){isLongPriceDb=true;}doubleRoomPriceText="<strong>"+doubleRoomPriceText+"</strong>";doubleRoomIcon=doubleRoomDataObject.iconData;if(this.options.showRoomIcon&&doubleRoomDataObject.priceHTML.length){doubleRoomPriceText=doubleRoomPriceText.split("<strong>");doubleRoomPriceText='<span class="ic_dz"></span><strong>'+doubleRoomPriceText[1];}var visibleIconsExist=false;if(doubleRoomIcon.length){j=0;for(i=0;i<doubleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(doubleRoomIcon,i);if(iconData.cssClass!="hotdeal"){visibleIconsExist=true;break;}}}var clearer=container.childNodes[mainMod];if(singleRoomDataObject&&visibleIconsExist){clearer.className="priceClearer space";
}else{clearer.className="priceClearer";}if(doubleRoomIcon.length||tariffKey){var doubleRoomDiscountsContainer=container.childNodes[mainMod+1];if(doubleRoomIcon.length){j=0;for(i=0;i<doubleRoomIcon.length/3;i++){iconData=this.teaserIconDataMapper.getIconDataObject(doubleRoomIcon,i);if(iconData.cssClass!="hotdeal"){tmp=doubleRoomDiscountsContainer.childNodes[j];if(isChinese){tmp.href=detailsLink;}tmp.className=iconData.cssClass;tmp.onmouseover=createTooltipEventhandler(iconData.description);switch(iconData.cssClass){case"discount":case"corpRate":tmp.appendChild(doc.createTextNode(iconData.label));tmp.style.fontWeight="bold";break;case"economy":tmp.appendChild(doc.createTextNode(iconData.label));break;default:tmp.appendChild(doc.createTextNode(iconData.description));}j++;}}}doubleRoomMod+=1;}priceContainer=container.childNodes[mainMod+doubleRoomMod+2];
tmp=priceContainer.firstChild;tmp.id=doubleRoomDataObject.trackingLink;tmp.href=this.replaceHotelDetailsLink(tmpData.hotelNumber,"priceAnchor");tmp.innerHTML=doubleRoomPriceText;if(tariffKey){tttID="toolTipTariff"+teaserData[10][1];tmp=priceContainer.childNodes[1];tmp.className="hasTariff "+tariffKey+" jsTooltipTariff";tmp.setAttribute("data-toolTipText",tttID);if(!$(tttID)){createTooltip(this.ttTexts,teaserData[10],tttID,this.options.tariffsLightboxURL);}}var provisionsContainer,provisionsVar;if(provisionsDZ&&provisionsEZ){provisionsVar=provisionsDZ;}else{provisionsVar=provisionsDZ||provisionsEZ;}provisionsContainer=container.childNodes[mainMod+doubleRoomMod+4];if(isChinese){provisionsContainer.href=detailsLink;}provisionsContainer.className="hi";provisionsContainer.appendChild(doc.createTextNode(provisionsVar||""));
doubleRoomMod+=1;mainMod+=doubleRoomMod+4;}var bookingContainer=container.childNodes[mainMod];tmp=bookingContainer.firstChild;tmp.className="buttonBox "+this.options.applicationLayout;tmp.firstChild.id=mapper.getHotelDetailsLinkId(teaserData);tmp.firstChild.href=this.replaceHotelDetailsLink(tmpData.hotelNumber,"priceAnchor",this.options.currency);var priceLabel;var btText=this.options.texts.businessTariff.toUpperCase();var hrsText=this.options.texts.myHrsTariff;var isBusinessTravelerDiscount=mapper.isBusinessTravelerDiscount(teaserData);if(singleRoomDataObject){var originalPriceSme=mapper.getBusinessTariffOriginalPrice(teaserData,false);var originalPriceNoSme=mapper.getBusinessTravelerDiscontPrice(teaserData,false);var isMyHrsTariff=mapper.isMyHRSTariff(teaserData,false);var roomAbbreviation="";
var newSpan=new Element("div",{"class":"additionalPrice pu","href":tmpData.roomLink});var priceContainer=$$(container).getElements(".priceContainer")[0];var additionalPriceNeeded=false;if(mapper.isCorporateDiscountAvailable(teaserData,true,false)&&!doubleRoomDataObject){priceContainer[0].firstChild.prepend(this.createCorporateDiscountTeaser());}if(this.options.isKMUTraveller&&isBusinessTravelerDiscount&&originalPriceSme!=""&&!mapper.getIsMixedRoomsOffer(teaserData)){newSpan.innerHTML="<div class='priceValue'><div class='strikeLine'></div>"+this.formatNicePrice(originalPriceSme)+"</div><div class='labelBusiness gtm__business-layover'>"+btText+"</div>";newSpan.className="additionalPrice strike pu";additionalPriceNeeded=true;var businessLabel=new Element("span",{"class":"labelBusiness","html":btText});
if(priceContainer[0].childNodes.length){priceContainer[0].firstChild.appendChild(businessLabel);if(isLongPriceSg){container.addClass("smallerPrice");}}}else{if(!this.options.isKMUTraveller&&originalPriceNoSme!=""&&!doubleRoomDataObject&&!isMyHrsTariff&&!mapper.getIsMixedRoomsOffer(teaserData)){newSpan.innerHTML="<div class='priceValue'><div class='strikeLine'></div>"+this.formatNicePrice(originalPriceNoSme)+"</div><div class='labelBusiness gtm__business-layover'>"+btText+"</div>";newSpan.className="additionalPrice goToKisSMElayer";additionalPriceNeeded=true;if(isLongPriceSg){container.addClass("smallerPrice");}}else{if(originalPriceSme!=""&&isMyHrsTariff){if(doubleRoomDataObject){roomAbbreviation='<span class="roomAbbreviation">'+mapper.getRoomAbbreviation(teaserData,false)+"&nbsp;</span>";
}newSpan.innerHTML="<div class='priceValue'><div class='strikeLine'></div>"+this.formatNicePrice(originalPriceSme)+"</div><div class='labelBusiness gtm__business-layover'>"+hrsText+"</div>"+roomAbbreviation;newSpan.className="additionalPrice strike pu";additionalPriceNeeded=true;var businessLabel=new Element("span",{"class":"labelBusiness","html":hrsText});if(priceContainer[0].childNodes.length){priceContainer[0].firstChild.appendChild(businessLabel);}}else{if(doubleRoomDataObject){var test=new Element("span",{"class":"roomAbbreviation","html":mapper.getRoomAbbreviation(teaserData,false)+"&nbsp;"});priceContainer[0].firstChild.appendChild(test);}}}}if(additionalPriceNeeded){newSpan.inject(priceContainer[0],"before");}this.addGoToKisSMELayer(newSpan);}if(doubleRoomDataObject){var originalPrice=mapper.getBusinessTariffOriginalPrice(teaserData,true);
var isMyHrsTariff=mapper.isMyHRSTariff(teaserData,true);var originalPriceNoSme=mapper.getBusinessTravelerDiscontPrice(teaserData,true);var newSpan=new Element("div",{"class":"additionalPrice","href":tmpData.roomLink});var priceContainer=$$(container).getElements(".priceContainer")[0];var additionalPriceNeeded=false;if(mapper.isCorporateDiscountAvailable(teaserData,false,true)&&!singleRoomDataObject){priceContainer[0].firstChild.prepend(this.createCorporateDiscountTeaser());}if(this.options.isKMUTraveller&&isBusinessTravelerDiscount&&originalPrice!=""&&!mapper.getIsMixedRoomsOffer(teaserData)){newSpan.innerHTML="<div class='priceValue'><div class='strikeLine'></div>"+this.formatNicePrice(originalPrice)+"</div><div class='labelBusiness gtm__business-layover'>"+btText+"</div>";newSpan.className="additionalPrice strike pu";
additionalPriceNeeded=true;var businessLabel=new Element("span",{"class":"labelBusiness","html":btText});if(priceContainer[0].childNodes.length){priceContainer[0].firstChild.appendChild(businessLabel);if(isLongPriceDb){container.addClass("smallerPrice");}}}else{if(!this.options.isKMUTraveller&&originalPriceNoSme!=""&&!singleRoomDataObject&&!isMyHrsTariff&&!mapper.getIsMixedRoomsOffer(teaserData)){newSpan.innerHTML="<div class='priceValue'><div class='strikeLine'></div>"+this.formatNicePrice(originalPriceNoSme)+"</div><div class='labelBusiness gtm__business-layover'>"+btText+"</div>";newSpan.className="additionalPrice goToKisSMElayer";additionalPriceNeeded=true;if(isLongPriceDb){container.addClass("smallerPrice");}}else{if(originalPrice!=""&&isMyHrsTariff){var roomAbbreviation="";if(singleRoomDataObject){roomAbbreviation='<span class="roomAbbreviation">'+mapper.getRoomAbbreviation(teaserData,true)+"&nbsp;</span>";
}newSpan.innerHTML="<div class='priceValue'><div class='strikeLine'></div>"+this.formatNicePrice(originalPrice)+"</div><div class='labelBusiness gtm__business-layover'>"+hrsText+"</div>"+roomAbbreviation;newSpan.className="additionalPrice strike pu";additionalPriceNeeded=true;var businessLabel=new Element("span",{"class":"labelBusiness","html":hrsText});if(singleRoomDataObject&&priceContainer[0].childNodes.length){priceContainer[1].firstChild.appendChild(businessLabel);}else{if(priceContainer[0].childNodes.length){priceContainer[0].firstChild.appendChild(businessLabel);}}}else{if(singleRoomDataObject){var test=new Element("span",{"class":"roomAbbreviation","html":mapper.getRoomAbbreviation(teaserData,true)+"&nbsp;"});priceContainer[1].firstChild.appendChild(test);}}}}if(additionalPriceNeeded){if(singleRoomDataObject){newSpan.inject(priceContainer[1],"before");
}else{newSpan.inject(priceContainer[0],"before");}}this.addGoToKisSMELayer(newSpan);}if(singleRoomDataObject&&doubleRoomDataObject){if(mapper.isCorporateDiscountAvailable(teaserData,true,true)){container.prepend(this.createCorporateDiscountTeaser(true));}$$(container).addClass("multiRoom");}if(!this.teaserDataMapper.isMyHRSTariff(teaserData,false)){container.prepend(this.createKMUHintAreaDOMForSingleOffer(teaserData));}var discounts=$$(container).getElements(".discounts");return container;},addGoToKisSMELayer:function(newSpan){newSpan.addEvent("click",function(event){if(newSpan.getAttribute("class").indexOf("goToKisSMElayer")>-1){this.showBTRegisterPoupuWithHotel(newSpan.getParent(".hotelTeaserContainer").getAttribute("id"));}}.bind(this));},isLongPrice:function(price){if(price.indexOf("<s")>3){return true;
}},getPriceFromStrong:function(price){var priceArr=price.split("<strong>");if(priceArr.length<2){return this.formatNicePrice(price);}priceArr=priceArr[1].split("</strong>");return this.formatNicePrice(priceArr[0]);},showBTRegisterPoupuWithHotel:function(hotelId,isBTBlocked){var hotelDetails=this.getHotelDataByHotelId(hotelId);if(!hotelDetails){return;}var mapper=this.teaserDataMapper;var roomsDataObject=mapper.getRoomsDataObject(hotelDetails);var popupDetails=$$(".myHRSLightBox .hotelDetails");popupDetails.getElement(".image img").set("src",mapper.getPhotoURL(hotelDetails));popupDetails.getElement(".hotelname .name").set("text",mapper.getHotelNameHTML(hotelDetails));popupDetails.getElement(".hotelname .address").set("text",mapper.getHotelCityHTML(hotelDetails));popupDetails.getElement(".hotelname .rating").set("class","rating");
popupDetails.getElement(".hotelname .rating").addClass(mapper.getStarsClass(hotelDetails));var btPrice=this.formatNicePrice(mapper.getBusinessTravelerDiscontPrice(hotelDetails,false));if(roomsDataObject.singleRoom){popupDetails.getElement(".priceArea .strike .priceValue").set("html",'<div class="strikeLine"></div>'+this.getPriceFromStrong(roomsDataObject.singleRoom.priceHTML));popupDetails.getElement(".priceArea .hi").set("text",roomsDataObject.singleRoom.provisionsText);}else{if(roomsDataObject.doubleRoom){btPrice=this.formatNicePrice(mapper.getBusinessTravelerDiscontPrice(hotelDetails,true));popupDetails.getElement(".priceArea .strike .priceValue").set("html",'<div class="strikeLine"></div>'+this.getPriceFromStrong(roomsDataObject.doubleRoom.priceHTML));popupDetails.getElement(".priceArea .hi").set("text",roomsDataObject.doubleRoom.provisionsText);
}}popupDetails.getElement(".priceArea .noStrike .priceValue").set("html",btPrice);if(btPrice){popupDetails.setStyle("display","block");$$(".myHRSLightBox .topContent.alternativeDescription").setStyle("display","none");$$(".myHRSLightBox .topContent.firstDescription").setStyle("display","block");}else{popupDetails.setStyle("display","none");$$(".myHRSLightBox .topContent.alternativeDescription").setStyle("display","block");$$(".myHRSLightBox .topContent.firstDescription").setStyle("display","none");}if($$(".myHRSLightBox.activated.lightbox").length){$$(".myHRSLightBox.activated.lightbox").removeClass("hide").setStyle("display","block");$$(".myHRSLightBox.activated.lightbox").removeClass("activated");}else{if(window.isNewRegistrationEnabled){window.frameRegistration.open("HLList:Business-Layover","register");
}else{var touchpoint=isBTBlocked?"gtm__business-layover--locked":"gtm__business-layover";window.HRS_PUW.AuthPopupOverlay.instance.show({popup:".myHRSLightBox.lightbox.jsBTRegisterForm",touchpoint:touchpoint,popupName:"MyHRS Registration Form"});s.pageName="SME Registration Empty HD";s.hier1="Public Web,"+s.pageName;md.mpt="HD";md.mphier="Public Web,smeUserRegistration";md.mpn="SMELayerOpen";if(isBTBlocked){s.linkTrackVars="eVar65,eVar27,prop73,events,channel,pageName";s.linkTrackEvents="event131,event132";s.events="event131,event132";s.eVar27="HL:List";s.eVar65="HLList:BusinessTariffLock-Layover";s.channel="Public Web";s.tl(true,"o","BusinessTariffLock");}else{s_trackPage();}}}},trackMyhrsSmartHotel:function(element){Array.prototype.forEach.call(element,function(el){el.addEventListener("click",function(e){if(window.isNewRegistrationEnabled){window.frameRegistration.open("HLList:Smarthotel",e.target.className);
}else{window.registerForm.showAuthForm(e.target.className,false,undefined,"SmartHotel");}});});},formatNicePrice:function(price){var index,lastPart,currency,firstPart,curr={"eur":"","usd":"$","gbp":""};price=price.replace(/[\(\)]+/g,"");index=price.lastIndexOf(" ");if(index==-1){return price;}currency=price.substr(index+1);price=price.substr(0,index);index=price.lastIndexOf(",");if(index<price.lastIndexOf(".")){index=price.lastIndexOf(".");}if(index==-1){index=price.length;}firstPart=price.substr(0,index);lastPart=price.substr(index+1);if(lastPart.length>2){firstPart=price;lastPart="00";}if(curr[currency.toLowerCase()]!=undefined){currency=curr[currency.toLowerCase()];}else{currency="<span>"+currency+"</span>";}return firstPart+"<sup>"+lastPart+" </sup>"+currency;},getKMUHintAreaDOMForSingleOfferTemplate:(function(){var cache={};
return function(kmuHint){var key,gold,container,part;key=kmuHint?1:0;if(kmuHint){gold=kmuHint[0].search("gold")!==-1?1:0;key="1"+gold+(this.options.isKMUTraveller?1:0);}else{key="0";}if(cache[key]){return cache[key].cloneNode(true);}container=this.doc.createDocumentFragment();if(kmuHint){part=this.linkTemplate.cloneNode();if(this.options.isKMUTraveller){part.className="kmuTxt mixedRooms"+(gold?" gold":"");}else{part.className="kmuTxt jsOpenKissmeLayer jsTeaser jsTrackLink mixedRooms"+(gold?" gold":"");}container.appendChild(part);}return(cache[key]=container).cloneNode(true);};}()),createKMUHintAreaDOMForSingleOffer:function(teaserData){var mapper=this.teaserDataMapper,tmpData=this.singleOfferTmpData,position=tmpData.displayPosition,hotelNumber=tmpData.hotelNumber,kmuHint=mapper.getKMUHint(teaserData),container=this.getKMUHintAreaDOMForSingleOfferTemplate(kmuHint),link;
if(kmuHint){link=container.firstChild;this.setDataSetProperty(link,"celinfo","Banderole");this.setDataSetProperty(link,"hotelidpos",hotelNumber+";"+position);this.setDataSetProperty(link,"tid","businessRegistration;"+position+";businessBanderole");var secondSpace=kmuHint[0].indexOf(" ",kmuHint[0].indexOf(" ")+1);link.innerHTML=kmuHint[0].slice(0,secondSpace)+"</span>"+kmuHint[0].slice(secondSpace).replace(/<(?:.|\n)*?>/gm,"");if(!mapper.getIsMixedRoomsOffer(teaserData)){link.setAttribute("class",link.getAttribute("class")+" hide");}if(!this.options.isKMUTraveller){link.id="businessBanderole;"+position+";"+((kmuHint&&kmuHint.length>0&&kmuHint[1])||"");this.setDataSetProperty(link,"tiv","0");this.setDataSetProperty(link,"tpos",position);link.href=this.options.businessLink;}else{link.setAttribute("class",link.getAttribute("class")+" pu");
link.setAttribute("href",this.singleOfferTmpData.roomLink);}}return container;},extendContainerWithFreeCancellationInfo:function(container){var ribbon=this.divTemplate.cloneNode(false);ribbon.className="FreeCancellationRibbon";var ribbonTitle=this.h5Template.cloneNode(false);ribbonTitle.className="FreeCancellationRibbon__title";ribbonTitle.innerText=(this.options.texts.freeCancellation||"").toUpperCase();ribbon.appendChild(ribbonTitle);var ribbonText=this.pTemplate.cloneNode(false);ribbonText.className="FreeCancellationRibbon__text";ribbonText.innerText=this.options.texts.freeCancellationUntil;ribbon.appendChild(ribbonText);container.appendChild(ribbon);},createHotelTeaserFooterAreaDOMForSingleOffer:function(teaserData){var container=this.doc.createDocumentFragment(),div,mapper=this.teaserDataMapper,smartHotel=mapper.isSmartHotel(teaserData),hotelNumber=mapper.getHotelNumber(teaserData),position=mapper.getPosition(teaserData),myCandy=mapper.getMyCandy(teaserData),locale=window.HRS_PUW.locale;
div=this.divTemplate.cloneNode(false);div.className="hotelFooter";var innerDivLeft=this.divTemplate.cloneNode(false);innerDivLeft.className="hotelFooterLeft";if(smartHotel&&myCandy.length!==0){innerDivLeft.addClass("marginSmartHotel");}var candyTeasers=this.createCandyBanderoleDOMTeasers(myCandy,position,hotelNumber);innerDivLeft.appendChild(candyTeasers);div.appendChild(innerDivLeft);var innerDivRight=this.divTemplate.cloneNode(false);innerDivRight.className="hotelFooterRight";var shortage=mapper.getShortage(teaserData);if(shortage){var shortageDiv=this.divTemplate.cloneNode(false);shortageDiv.className="shortage";shortageDiv.appendChild(this.doc.createTextNode(shortage));innerDivRight.appendChild(shortageDiv);}div.appendChild(innerDivRight);container.appendChild(div);div=this.divTemplate.cloneNode(false);
div.className="clearFix";container.appendChild(div);if(mapper.isFlexTariff(teaserData)&&locale.isLangEligibleForCVBonus){this.extendContainerWithFreeCancellationInfo(container);}return container;},initialGeneratedHotelsNum:0,calculateInitialGeneratedHotelsNum:function(force){var initialHotelsMode="auto";if(this.initialGeneratedHotelsNum&&!force){return this.initialGeneratedHotelsNum;}if(initialHotelsMode=="get"){var initialNum=0,parsed,a=document.createElement("a"),i,tmp;a.href=location.href;parsed=a.search.substr(1).split("&");for(i=0;i<parsed.length;i++){tmp=parsed[i].split("=");if(tmp[0]=="initialHotels"){initialNum=tmp[1];break;}}this.initialGeneratedHotelsNum=window.hotelListInitialGeneratedHotels=initialNum;}else{if(initialHotelsMode=="auto"){this.initialGeneratedHotelsNum=initialNum=window.hotelListInitialGeneratedHotels=Math.ceil((document.documentElement.clientHeight+window.getScrollTop())/this.hotelTeaserHeightAssumption);
}}return initialNum+this.getBufferSize();},getInitialGeneratedHotelsNum:(function(){var initialHotelsMode="auto";if(initialHotelsMode=="get"){var initialNum=0,parsed,a=document.createElement("a"),i,tmp;a.href=location.href;parsed=a.search.substr(1).split("&");for(i=0;i<parsed.length;i++){tmp=parsed[i].split("=");if(tmp[0]=="initialHotels"){initialNum=tmp[1];break;}}window.hotelListInitialGeneratedHotels=initialNum;}else{if(initialHotelsMode=="auto"){initialNum=window.hotelListInitialGeneratedHotels=Math.ceil((document.documentElement.clientHeight+window.window.getScrollTop())/this.hotelTeaserHeightAssumption);}}return function(){return initialNum;};}()),getBufferSize:function(){return(Browser.isMobile?30:5)+this.teaserSeparatorData.separatorCount;},lazyRenderHotelTeasersForScreen:function(){var generateUpTo=Math.ceil((document.documentElement.clientHeight+window.getScrollTop())/this.hotelTeaserHeightAssumption)+this.getBufferSize();
this.lazyRenderUpTo(generateUpTo);},registerOnScrollEvent:function(){var self=this;window.onscroll=(function(){var minimalSleepTime=100,sleptOverEvent=null,sleeping=false;return function(event){if(sleeping){sleptOverEvent=event;return;}self.lazyRenderHotelTeasersForScreen();sleeping=true;setTimeout(function(){sleeping=false;if(sleptOverEvent){window.onscroll(sleptOverEvent);sleptOverEvent=false;}},minimalSleepTime);};}());if(window.addEventListener){window.addEventListener("touchmove",(function(){var minimalSleepTime=100,sleptOverEvent=null,sleeping=false;return function(event){if(sleeping){sleptOverEvent=event;return;}self.lazyRenderHotelTeasersForScreen();sleeping=true;setTimeout(function(){sleeping=false;if(sleptOverEvent){window.touchmove(sleptOverEvent);sleptOverEvent=false;}},minimalSleepTime);
};}()));}return this;},registerOnResizeEvent:function(){var self=this;window.onresize=(function(){var minimalSleepTime=100,sleptOverEvent=null;sleeping=false;return function(event){if(sleeping){sleptOverEvent=event;return;}self.lazyRenderHotelTeasersForScreen();sleeping=true;setTimeout(function(){sleeping=false;if(sleptOverEvent){window.onscroll(sleptOverEvent);sleptOverEvent=false;}},minimalSleepTime);};}());return this;},getGenerationMode:(function(){var asHTML=!!location.href.match(/generateHTML/g),mode;if(asHTML){mode="generateHTML";}else{mode="generateDOM";}window.hotelListGenerateMode=mode;return function(){return mode;};}()),isForcedChineseLink:(function(){var forced=!!location.href.match(/forceChineseLink/g);return function(){return forced;};}()),isForcedSeal:(function(){var forced=!!location.href.match(/forceSeal/g);
return function(){return forced;};}()),isForcedChineseFriendly:(function(){var forced=!!location.href.match(/forceChineseFriendly/g);return function(){return forced;};}()),setInnerTextContent:(function(){var tmp=document.createElement("DIV");return(typeof tmp.textContent!=="undefined")?function(container,textContent){container.textContent=textContent;}:function(container,textContent){container.innerText=textContent;};}()),logger:{log:{entries:[]},current:undefined,time:(window.performance&&window.performance.now)?function(){return performance.now();}:function(){return Date.now();},getPerformanceReportMethod:(function(){var inline=!!location.href.match(/inlineReport/g),console=!!location.href.match(/consoleReport/g),mode;if(inline){mode="inline";}else{if(console){mode="console";}else{mode="none";
}}window.hotelListGenerateReportMode=mode;return function(){return mode;};}()),generateReportLine:(function(){window.hotelListReportSummary="";return function(msg){var div;switch(this.getPerformanceReportMethod()){case"inline":div=document.createElement("div");div.innerHTML=msg;document.getElementById("head").appendChild(div);break;case"console":console.info(msg);default:}window.hotelListReportSummary+=msg+"\n";};}()),outputResults:function(){var fullTotal=0,initialGenerated=window.hotelListInitialGeneratedHotels?window.hotelListInitialGeneratedHotels:"all";this.generateReportLine("-- generation options: { mode: "+window.hotelListGenerateMode+", initialGeneratedHotels: "+initialGenerated+", reportMode: "+window.hotelListGenerateReportMode+" }");this.generateReportLine("-- total generation time: "+this.getTotalGenerationTime());
fullTotal+=this.getTotalGenerationTime();this.generateReportLine("-- total render time: "+this.log.render.total);fullTotal+=this.log.render.total;this.generateReportLine("-- FULL total: "+fullTotal);},createGlobal:function(key,value){this.log[key]=value;},createNewEntry:function(){this.current={};this.log.entries.push(this.current);return this.current;},addToCurrentEntry:function(key,value){if(!this.current){this.createNewEntry();}this.current[key]=value;},getTotalGenerationTime:function(){var i,total=0;for(i=0;i<this.log.entries.length;i++){total+=this.log.entries[i].total;}return total;}},singleOfferTmpData:null,setDataSetProperty:(function(){var tmp=document.createElement("span");return tmp.dataset?function(el,key,value){el.dataset[key]=value;}:function(el,key,value){el.setAttribute("data-"+key,value);
};}()),teaserGenerationCache:(function(){var cacheContainer={cache:{},position2IdMapper:[],maxRendered:0,tmpOfferData:{},initPosition:function(position){if(!this.cache[position]){this.cache[position]={teaserComponent:null,container:null,rendered:false,yPos:null,position:position};}return this;},set:function(position,teaserGenerationData){this.initPosition(position).cache[position]=teaserGenerationData;},setComponent:function(position,component){this.initPosition(position).cache[position].teaserComponent=component;return this;},setContainer:function(position,container){this.initPosition(position).cache[position].container=container;this.setVerticalPosition(position,getAbsoluteOffetTop(container));return this;},setRendered:function(position,rendered){this.initPosition(position).cache[position].rendered=rendered;
if(rendered){this.maxRendered=Math.max(this.maxRendered,position);}return this;},setVerticalPosition:function(position,yPos){this.initPosition(position).cache[position].yPos=yPos;return this;},get:function(position){if(this.cache[position]){return this.cache[position];}}};return cacheContainer;}()),lazyRenderUpTo:function(position){var i,tmp,maxPos=Math.min(position,this.getMaxHotelPosition());this.lazyGenerateUpTo(maxPos);for(i=1;i<=maxPos;i++){if(this.teaserSeparatorData.separatorRows[i]){continue;}try{tmp=this.teaserGenerationCache.get(i);if(tmp.rendered){continue;}}catch(e){console.info(i,e);}this.lazyRenderTeaserForPosition(i);}},lazyGenerateUpTo:function(position){var i,maxPos=Math.min(this.getMaxHotelPosition(),position);for(i=this.lastHotelPositionFullyGenerated+1;i<=maxPos;i++){this.lazyGenerateTeaserForPosition(i);
}},lazyGenerateTeaserForPosition:function(position){var maxPos=this.getMaxHotelPosition();if(maxPos>=position){return this.generateHotelTeaserContentsForPosition(position);}},lazyGenerateNext:function(){var maxPos=this.getMaxHotelPosition();if(maxPos>this.lastHotelPositionFullyGenerated){return this.lazyGenerateTeaserForPosition(this.lastHotelPositionFullyGenerated+1);}},lazyRenderTeaserForPosition:function(position){var maxPos=this.getMaxHotelPosition(),container,orgOffsetHeight,absOffsetTop,diff,img,teaserGenerationCache=this.teaserGenerationCache;if(maxPos>=position){if(!teaserGenerationCache.get(position)){this.lazyGenerateTeaserForPosition(position);}container=document.getElementById(teaserGenerationCache.position2IdMapper[position]);if(container){container.removeChild(container.childNodes[0]);
orgOffsetHeight=container.offsetHeight;container.appendChild(teaserGenerationCache.get(position).teaserComponent);teaserGenerationCache.setRendered(position,true).setContainer(position,container);img=container.getElementsByTagName("img")[0];img.src=img._src;absOffsetTop=getAbsoluteOffetTop(container);diff=container.offsetHeight-orgOffsetHeight;if(diff&&(window.window.getScrollTop()>(absOffsetTop+container.offsetHeight))){window.scrollBy(0,diff);}this.calculateHotelTeaserHeightAssumption();new ContextSensitiveHelp(document.id(container).getElements(".jsTooltipTariff"),{openEvent:"mouseenter",closeButton:false,maxWidth:480,minWidth:210,firstDirection:"top",widthOffset:15,timerDelay:10,showDelay:300,offsets:{"x":7,"y":7},maxHeight:"auto",overflowY:"visible",showPike:true,simpleDesign:true,deltaTopPosition:-6,preventOrgEvent:true});
}}},lastHotelPositionFullyGenerated:0,generateIdx:0,generateFlags:{},generateHotelTeaserContentsForPosition:function(listPosition,forceFullOffer){forceFullOffer=forceFullOffer||false;if(this.teaserSeparatorData.separatorRows[listPosition]){return;}if(this.generateFlags[listPosition]&&!forceFullOffer){return this.generateFlags[listPosition];}var container=this.doc.createDocumentFragment(),teaserData=this.getHotelTeaserDataByPosition(listPosition),tmp;this.singleOfferTmpData=this.teaserGenerationCache.tmpOfferData[listPosition];if(this.isPromoHotel(teaserData)){container.appendChild(this.createPromoLabel());}container.appendChild(this.createCheckboxAreaDOMForSingleOffer());container.appendChild(this.createHotelPhotoAreaDOMForSingleOffer());container.appendChild(this.createHotelNameAndAddressAreaDOMForSingleOffer());
container.appendChild(this.createDistanceAreaDOMForSingleOffer(teaserData));container.appendChild(this.createRatingAreaDOMForSingleOffer(teaserData));container.appendChild(this.createPriceBreakfastAreaDOMForSingleOffer(teaserData));tmp=this.divTemplate.cloneNode(false);tmp.className="clearer";container.appendChild(tmp);container.appendChild(this.createHotelTeaserFooterAreaDOMForSingleOffer(teaserData));if(forceFullOffer){return container;}this.generateFlags[this.lastHotelPositionFullyGenerated=listPosition]=container;this.teaserGenerationCache.setComponent(listPosition,container);return container;},isPromoHotel:function(hotelTeaser){if(typeof hotelTeaser[5]!="undefined"&&hotelTeaser[5][0].length>0&&hotelTeaser[5][0][8].promoLabel){return true;}if(typeof hotelTeaser[5]!="undefined"&&hotelTeaser[5][1].length>0&&hotelTeaser[5][1][8].promoLabel){return true;
}return false;},createPromoLabel:function(){var tmpData=this.singleOfferTmpData,text=document.createElement("DIV"),container=document.createElement("DIV");text.className="line-text";text.appendChild(this.doc.createTextNode(this.options.texts.promoLabel));container.className="line";container.appendChild(text);return container;},jsonSingleOffer:function(hotelListPosition,forceFullOffer){forceFullOffer=forceFullOffer||false;var logger=this.logger,entryStart=logger.time();logger.createNewEntry();var mapper=this.teaserDataMapper,teaserData=this.getHotelTeaserDataByPosition(hotelListPosition),hotelNumber=mapper.getHotelNumber(teaserData),displayPosition=mapper.getPosition(teaserData),checked=mapper.isChecked(teaserData),kmuHint=mapper.getKMUHint(teaserData),noPinter="",checkedClassString=(checked?" mc":"");
this.singleOfferTmpData={hotelNumber:hotelNumber,displayPosition:displayPosition,listPosition:hotelListPosition,detailsLink:this.getDetailsLink(hotelNumber),roomLink:this.getRoomLink(hotelNumber),ratingLink:this.getRatingLink(hotelNumber),isChinese:this.isForcedChineseLink()||this.isChineseLink(),isSmartHotel:mapper.isSmartHotel(teaserData),hasSeal:this.isForcedSeal()||mapper.hasSeal(teaserData),isChineseFriendly:this.isForcedChineseFriendly()||mapper.isChineseFriendly(teaserData),hasVideo:mapper.hasVideo(teaserData),fotoURL:mapper.getPhotoURL(teaserData),photoId:mapper.getPhotoId(teaserData),photoClass:mapper.getPhotoClass(teaserData),ratingId:mapper.getRatingId(teaserData),generateRatings:mapper.getGenerateRatings(teaserData),ratingString:mapper.getRatingString(teaserData),ratingHRString:mapper.getHRRatingString(teaserData),ratingNumber:mapper.getRatingNumber(teaserData),starsClass:mapper.getStarsClass(teaserData),hotelNameLinkId:mapper.getHotelNameLinkId(teaserData),hotelCityLinkId:mapper.getHotelCityLinkId(teaserData),hotelNameHTML:mapper.getHotelNameHTML(teaserData),hotelCityHTML:mapper.getHotelCityHTML(teaserData),tariffName:mapper.getTariffName(teaserData),tariffKey:mapper.getTariffKey(teaserData),isFlexTariff:mapper.isFlexTariff(teaserData),distanceData:mapper.getDistanceDataObject(teaserData)};
this.teaserGenerationCache.position2IdMapper[hotelListPosition]=hotelNumber;this.teaserGenerationCache.tmpOfferData[hotelListPosition]=this.singleOfferTmpData;if(this.isChineseLink()&&Browser.name.toLowerCase()==="firefox"){noPinter="containerNoPointer containerPointer";}else{if(this.isChineseLink()&&Browser.name.toLowerCase()!=="firefox"){noPinter="containerPointer";}}var div=this.divTemplate.cloneNode(),tmp,img,initialGeneratedHotels=this.calculateInitialGeneratedHotelsNum();div.className="hotelTeaserContainer "+noPinter+" hotellist"+checkedClassString;div.id=hotelNumber;div.style.minHeight="133px";div.detailsLink=this.singleOfferTmpData.detailsLink;if(this.isPromoHotel(teaserData)){div.className+=" promoHotel";}this.setDataSetProperty(div,"hpos",displayPosition);this.setDataSetProperty(div,"trackingId","ListElement;"+displayPosition);
this.setDataSetProperty(div,"hotelitemurl",this.singleOfferTmpData.detailsLink+"&actionDetails=showHotelDetailsFromHotelList&position="+this.singleOfferTmpData.listPosition);if(!initialGeneratedHotels||this.generateIdx<initialGeneratedHotels||forceFullOffer){div.appendChild(this.generateHotelTeaserContentsForPosition(hotelListPosition,forceFullOffer));if(!forceFullOffer){this.teaserGenerationCache.setRendered(hotelListPosition,true).setContainer(hotelListPosition,div);}img=div.getElementsByTagName("img")[0];img.src=img._src;this.lastHotelPositionFullyGenerated=hotelListPosition;}else{tmp=this.doc.createElement("span");tmp.style.fontSize="1px";tmp.style.color="#fff";tmp.appendChild(this.doc.createTextNode(mapper.getHotelNameHTML(teaserData)));div.appendChild(tmp);}logger.addToCurrentEntry("total",logger.time()-entryStart);
this.generateIdx++;return div;},getCandyBanderoleTeasersTemplate:(function(){var cache={};return function(isChineseLink,myCandy){var container=this.divTemplate.cloneNode(),link,tmp,p,span,i,l,key;key=""+(isChineseLink?1:0)+(myCandy.length);if(cache[key]){return cache[key].cloneNode(true);}container.className="candy showHide";p=this.pTemplate.cloneNode(false);span=this.spanTemplate.cloneNode(false);span.className="hL";p.appendChild(span);for(i=0,l=myCandy.length;i<l-1;i++){span=this.spanTemplate.cloneNode(false);p.appendChild(span);}span=this.spanTemplate.cloneNode(false);span.style.marginRight="0px";p.appendChild(span);if(isChineseLink){link=this.linkTemplate.cloneNode(false);link.appendChild(p);container.appendChild(link);}else{container.appendChild(p);}return(cache[key]=container).cloneNode(true);
};}()),createCandyBanderoleDOMTeasers:function(myCandy,pos,hNum){var container=this.doc.createDocumentFragment(),candyText=this.options.texts.candyTitle,doc=this.doc,i,l,div,tmp,pbase;if(myCandy.length){div=this.getCandyBanderoleTeasersTemplate(this.isChineseLink(),myCandy);this.setDataSetProperty(div,"hNum",hNum);this.setDataSetProperty(div,"listPos",pos);if(this.isChineseLink()){div.firstChild.href=this.getDetailsLink(hNum);pbase=div.firstChild.firstChild;}else{pbase=div.firstChild;}pbase.firstChild.appendChild(doc.createTextNode(candyText));for(i=0,l=myCandy.length;i<l;i++){pbase.childNodes[1+i].appendChild(doc.createTextNode(myCandy[i]+" "));}container.appendChild(div);}return container;},addCandyBanderoleToTeasers:function(myCandy,teasers,pos,hNum){var candyText=this.options.texts.candyTitle,i,l;
if(myCandy.length){teasers.push('<div class="candy showHide" data-hNum="'+hNum+'" data-listPos="'+pos+'" >');if(this.isChineseLink()){teasers.push('<a target="_blank" href="'+this.getDetailsLink(hNum)+'">');}teasers.push("<p>");teasers.push('<span class="hL">'+candyText+"</span>");for(i=0,l=myCandy.length;i<l-1;i++){teasers.push("<span>"+myCandy[i]+"</span> ");}teasers.push('<span style="margin-right: 0px;">'+myCandy[i]+"</span> ");teasers.push("</p>");if(this.isChineseLink()){teasers.push("</a>");}teasers.push("</div>");}},getExpoData:function(){return this.expoData;},buildExpo:function(){var data=this.getExpoData(),expoHtml,expoContainer,closeBt;if(data.length){expoHtml='<span class="fairIcon" />'+data.join("<br/>");if(expoContainer=document.getElementById("noticeBoxEvents")){expoContainer.innerHTML=expoHtml;
}else{expoContainer=new Element("div",{"class":"noticeBox ie7Fair","id":"noticeBoxEvents","html":expoHtml});}closeBt=new Element("span",{"class":"close"}).addEvent("click",function(){expoContainer.dispose();});closeBt.inject(expoContainer,"bottom");expoContainer.inject($$(".hl_Wrapper")[0],"top");}},trackPage:function(){if(!this.linkTrackingMethod){if(this.trackingTimeout){clearTimeout(this.trackingTimeout);}var overLayWrapper=$("overLayWrapper");if(!overLayWrapper&&window.counterReady&&!this.preventListReady){if(this.pageTrackingData){HotellistEventManager.removeEvent("trackPage",this.boundTrackPage);s_trackPage(this.pageTrackingData,true);}if(this.metadataTracking){var rememberLoginTracking=(md.mpev=="login")?true:false;md=this.metadataTracking;if(rememberLoginTracking&&md.mpev==undefined){md.mpev="login";
}if(window.wa){window.wa.viewChange("HotelListReady",{});}}window.setTimeout(function(){window.backgroundPageTrackingFinished=true;},500);}else{this.trackingTimeout=setTimeout(function(){HotellistEventManager.fireEvent("trackPage");}.bind(this),500);}}},trackLink:function(event){if(this.linkTrackingMethod){if(this.linkTrackingData){s_trackLink(this.linkTrackingData.name,true,this.linkTrackingData.vars,s.pageName);}this.linkTrackingMethod=false;}},trackTablefootButton:function(event){var element=event.target;var trackingNames={"hotelComparisonButton":"compare","mapDisplaySubmit":"showMap","notepadSubmit":"memorise","printSubmit":"print"};if(element.id&&trackingNames[element.id]){var selected_hotels=$$(".hotelTeaserContainer.hotellist.selected");var hotel_numbers=[];selected_hotels.each(function(el){hotel_numbers.push(el.id);
});var hotel_numbers_string=hotel_numbers.join(";");var vars={};vars.linkTrackVars="prop61";vars.prop61=hotel_numbers_string;var trackingData=";"+trackingNames[element.id]+";markedHotel";s_trackLink(trackingData,element,vars,s.pageName);}},trackCriteo:function(event){if(this.criteoTracking){eval(this.criteoTracking);}},trackCriteoLayer:function(event){},trackTradedoubler:function(event){if(this.tradedoublerTracking){eval(this.tradedoublerTracking);}},updateMetadataObject:function(event){if(this.metadataTracking){md=this.metadataTracking;if(window.wa&&this.listUpdateInfo){var type;if(this.listUpdateInfo.type==="sort"){type="SortHotelList";}else{if(this.listUpdateInfo.type==="filter"){type="FilterHotelList";}}window.wa.viewChange(type,{subType:this.listUpdateInfo.subType});}}},showLoaderElement:function(){this.loaderTimeout=setTimeout(function(){var loader=(this.loaderElement||this.createLoader()).setStyle("visibility","visible");
}.bind(this),this.options.showLoaderDelay);},createLoader:function(){this.loaderElement=new Element("span.loaderElement").inject(document.body);return this.loaderElement;},hideLoader:function(){if(this.loaderTimeout){clearTimeout(this.loaderTimeout);}if(this.loaderElement){this.loaderElement.setStyle("visibility","hidden");}},addTeaserTrackingParam:function(bannerData){var checkVariable=function(){if(window.md&&(window.md["dom.url"]!==undefined)){window.md["dom.url"]+="&"+bannerData.trackingParam;}else{window.setTimeout(checkVariable,10);}};checkVariable();},getHolidayInsiderBanner:{TXS:function(bannerData){var images="";for(var i=0;i<bannerData.imageSrcList.length;i++){images+="<img src='"+bannerData.imageSrcList[i]+"'>";}return'<a target="_blank" href = "'+bannerData.linkout+'"><div class="teaser hollidayInsiderBanner dynamic jsTrackLink" id=";HI Linkout;1'+bannerData.position+";Banner::events::event15::eVar18::HL:List;HI Linkout;1"+bannerData.position+';Banner::linkTrackVars::eVar18::linkTrackVars::eVar18_2C_events">'+'<div class="content_container">'+'<div class="text_container">'+'<p class="title_firstline">Neu: HRS Holidays </p>'+'<p class="title_secondline">Im Urlaub wie zuhause fhlen. </p>'+"</div>"+'<div class="image_container jsTrackLink" id=";HI Linkout;1'+bannerData.position+";Picture::events::event15::eVar18::HL:List;HI Linkout;1"+bannerData.position+';Picture::linkTrackVars::eVar18::linkTrackVars::eVar18_2C_events">'+images+"</div>"+"</div>"+'<p class="header_info jsTrackLink" id=";HI Linkout;1'+bannerData.position+";Banner::events::event15::eVar18::HL:List;HI Linkout;1"+bannerData.position+';Banner::linkTrackVars::eVar18::linkTrackVars::eVar18_2C_events">'+'<span class="subline">'+bannerData.subline+"</span>"+'<span class="jsTrackLink button_green" id=";HI Linkout;1'+bannerData.position+";Button::events::event15::eVar18::HL:List;HI Linkout;1"+bannerData.position+';Button::linkTrackVars::eVar18::linkTrackVars::eVar18_2C_events">Jetzt erleben</span>'+'<img class="banner_logo" src="images/hollidayInsider/HRS_Holidays_Vorablogo_HL.png">'+"</p>"+"</div></a>";
}}});var FilterManager=new Class({Implements:Events,initialize:function(filterData,url,isVeMapSearch){this.initials=filterData.initials;this.filterCnts=filterData.matches;this.filterOptions={minPrice:this.initials[0],minPriceAbsolute:this.initials[1],maxPrice:this.initials[2],maxPriceAbsolute:this.initials[3],currency:this.initials[4],minEvaluationResult:Number(this.initials[5]),maxEvaluationResult:Number(this.initials[6]),minNumberOfStars:this.initials[7],maxNumberOfStars:this.initials[8],url:url,isVeMapSearch:isVeMapSearch};this.boundInitFilterCnt=this.initFilterCnt.bind(this);HotellistEventManager.addEvents({"initFilterCounter":this.boundInitFilterCnt});},initFilterCnt:function(){var filterWrap=$("filter");if(filterWrap){if(this.filterOptions){this.filterObj=new Filter(this.filterOptions);
}HotellistEventManager.addEvents({"enableFilter":this.filterObj.enableFilter.bind(this.filterObj),"disableFilter":this.filterObj.disableFilter.bind(this.filterObj),"uncheckFilter":this.uncheckTQFilter.bind(this)});var ids=["cityHotel","beachHotel","countryHotel","businessHotel","conventionHotel","sportHotel","clubHotel","wintersportHotel","apartmentSuiteHotel","familyHotel","greenHotel","holidayHotel","castleHotel","designHotel","allInclusiveHotel","parking","hotelNonSmoking","hotelAirCondition","restaurant","internet","spaHotelType","spaHotelConfiguration","sauna","pool","fitnessCenter","elevator","bar","roomCategoriesFilterForm.comfortSuite","roomCategoriesFilterForm.businessSuite","roomCategoriesFilterForm.juniorSuite","roomCategoriesFilterForm.familySuite","roomCategoriesFilterForm.balcony","wheelchairFriendlyHotel","wheelchairFriendlyRoom","wlanInRoom","roomAirCondition","cable","payTV","desktop","roomSafe","bathroom","minibar","allSeason","businessCenter","porterService","childcare","shuttle","expressCheckout","newspaper","pets","laundry","wlanInPublicArea","publicInternetTerminal","dslInRoom","freeInternetInRoom","paymentFilterForm.visaCard","paymentFilterForm.euroCardMasterCard","paymentFilterForm.electronicCash","boardFilterForm.breakfast","boardFilterForm.fullBoard","boardFilterForm.allInclusive","boardFilterForm.halfBoard","boardFilterForm.boardNotSpecified","topQuality","seniorComfortHotel","seniorComfortHotelRoom","paymentFilterForm.amex"];
var i=ids.length;while(i--){var cnt=this.filterCnts[i],checkbox=$(ids[i]),counterSpan;if(checkbox){if(cnt){counterSpan=checkbox.getNext();if(counterSpan){counterSpan.set("text",cnt);}}else{checkbox.getParent().getParent().dispose();}}}filterWrap.getElements("ul").each(function(ul){if(!ul.getChildren().length){var prev=ul.getPrevious();if(prev){prev.dispose();}ul.dispose();}});new Toggler(filterWrap.getElements(".jsToggle"),filterWrap.getElements(".jsToggler"));if((Browser.Features.iOSTouch||Browser.Features.Touch)&&Browser.isMobile){$$("#filter .slider").each(function(slider){slider.getParent(".sliderBox").setStyle("WebkitUserSelect","none");slider.getElements("a,div").each(function(knob,index){var knobOffset,offsetParentX;knob.addEvents({"touchstart":function(event){event.preventDefault();
document.addEventListener("touchmove",preventEvent,false);knobOffset=getPageXY(event).pageX-knob.getPosition().x;offsetParentX=slider.getPosition().x;},"touchmove":function(event){moveX=getPageXY(event).pageX;var movTo=moveX-knobOffset;knob.fireEvent("moveTo",[knob,movTo,index,offsetParentX]);},"touchend":function(){document.removeEventListener("touchmove",preventEvent,false);knob.fireEvent("moveEnd",[knob,index]);}});});});}HotellistEventManager.removeEvent("initFilterCounter",this.boundInitFilterCnt);}},uncheckTQFilter:function(filterObj){this.filterObj.filter.each(function(item){if(item.checkbox&&item.checkbox.id==="topQuality"){item.uncheck();item.checkbox.getParent("li").removeClass("isChecked");return;}});}});var SortManager=new Class({Implements:Events,initialize:function(contentNav,url){this.selects=[];
this.sorters=["airport","area","highway","train","hp","hn","hr","recommendation"];this.reviewCats=[];this._SO=new SelectObserver();this.baseURL=url;this.container=contentNav;this.list=this.container.getElement("ul.sortList").getElements("li.hotelListSortItem");var myClass=this;this.list.each(function(item){item.addEvents({mouseenter:myClass._mouseoverLi.bind(myClass),mouseleave:myClass._mouseoutLi.bind(myClass),click:myClass._clickLi.bind(myClass)});});this.links=this.container.getElements("a")[0];this.baseLink=this.links[0].href;this.isTouch=Browser.isMobileTouch;if(this.isTouch&&!Browser.firefox){this.container[0].getElements("a, span").each(function(linkEl){NoClickDelay(linkEl);},this);NoClickDelay(this.container[0]);}this.container[0].addEvent("click",this.sortingClicked.bind(this));HotellistEventManager.addEvent("updateSorterManager",this.updateSortManager.bind(this));
},_getTarget:function(item){var $target=item.hasClass("hotelListSortItem")?item:item.getParent("li.hotelListSortItem");return $target;},_addDividerClass:function(item){var leftNeighbour=item.getPrevious(".hotelListSortItem");if(leftNeighbour&&!leftNeighbour.hasClass("active")){leftNeighbour.addClass("noDivider");}},_removeDividerClass:function(item){var leftNeighbour=item.getPrevious(".hotelListSortItem");if(leftNeighbour&&!leftNeighbour.hasClass("active")){leftNeighbour.removeClass("noDivider");}},_mouseoverLi:function(evt){var $target=this._getTarget(evt.target);$target.addClass("hlHover");if(Browser.ie7&&($target.id==="isSortedByReview"||$target.id==="isSortedByDistance")){$target.getParent().getParent().addClass("hoverParent");}this._addDividerClass($target);},_mouseoutLi:function(evt){var $target=this._getTarget(evt.target);
$target.removeClass("hlHover");if(Browser.ie7&&($target.id==="isSortedByReview"||$target.id==="isSortedByDistance")){$target.getParent().getParent().removeClass("hoverParent");}if(!$target.hasClass("active")){this._removeDividerClass($target);}},_clickLi:function(evt){if(evt&&evt.target){var $target=this._getTarget(evt.target);this._addDividerClass($target);}},setPSLinks:function(){this.distanceLinks=$$("#distances a");this.reviewLinks=$$("#sortReview a");},registerPseudoSelect:function(element,options){var ps=new PseudoSelect($(element).getFirst(),options);this.selects.push({"element":ps});this._SO.addSelect(ps);},sortingClicked:function(ev){ev.preventDefault();var el=$(ev.target);var elParentA=el.getParent("a");if(!el.href&&!elParentA){return;}var ref=el.href||elParentA.href;ref=ref.replace("switchSortCriteriaWeb1000","sortHotelListJson");
if(ref.indexOf("hotelListJson")===-1){ref+="&hotelListJson=true&sortSource=flyout";}HotellistEventManager.fireEvent("loadHotels",{"url":ref,"linkTrackingMethod":"trackHotelListSort"});HotellistEventManager.fireEvent("uncheckFilter");},updateSortManager:function(sortdata){var sd=sortdata||this.sortingData;this.texts=sd.texts;this.highlighting=sd.listhead;var sendData={};var sendTexts={};var mySortDir={};var currSortID=false;for(var i=0,len=this.sorters.length;i<len;i++){var currSort=this.sorters[i];var el=this.highlighting[currSort];var isRecommendation=(currSort==="recommendation");var te=this.texts[currSort];var elsortdir=isRecommendation?"DOWN":el[1].indexOf("UP")!==-1?"UP":"DOWN";if(currSort==="area"){sendData["hd_0"]=el;sendTexts["hd_0"]=te;mySortDir["hd_0"]=elsortdir;}else{if(currSort==="train"){sendData["hd_1"]=el;
sendTexts["hd_1"]=te;mySortDir["hd_1"]=elsortdir;}else{if(currSort==="airport"){sendData["hd_2"]=el;sendTexts["hd_2"]=te;mySortDir["hd_2"]=elsortdir;}else{if(currSort==="highway"){sendData["hd_3"]=el;sendTexts["hd_3"]=te;mySortDir["hd_3"]=elsortdir;}else{sendData[currSort]=el;mySortDir[currSort]=elsortdir;}}}}if(el[0]===true){if(isRecommendation){currSortID="RECOMMENDATION";}else{currSortID=el[1];}}}var data={texts:sendTexts,nodeInfo:sendData,sortDir:mySortDir};if(currSortID){this.highlightPseudoSelects({csID:currSortID,discount:this.highlighting.discount[0]});}},highlightPseudoSelects:function(data){var dataArr=data.csID.split("~");var searchID="";if(dataArr[0]!=="RECOMMENDATION"){for(var a=0,len=dataArr.length-1;a<len;a++){searchID+=dataArr[a];if(a<len-1){searchID+="_";}}}var highlightName=dataArr[0];
var listElement;if(highlightName==="RECOMMENDATION"){listElement=$("isSortedByRecommendation");}else{if(highlightName==="PRICE"){if(!data.discount){listElement=$("isSortedByPrice");}}else{if(highlightName==="HOTELCATEGORY"){listElement=$("isSortedByRating");}else{if(highlightName==="DISTANCE"){this.distanceLinks.each(function(item){if(item.href.indexOf(searchID)!==-1){listElement=item.getParent("li")||item.getParent("dt");}}.bind(this));}else{if(highlightName==="HOTELNAME"){listElement=$("isSortedByName");}}}}}if(listElement){listElement.fireEvent("click");}},buildURL:function(orderDir){var temp=this.baseURL;if(orderDir){temp+="&orderDirectionCombined="+orderDir;}return temp;},buildReview:function(){var reviews=this.sortingData.reviews,len=reviews.length,evaluationsArr=["","Evaluations:AllCustomers","Evaluations:PrivateTraveller","Evaluations:BusinessTraveller","Evaluations:YoungCouple","Evaluations:MatureCouple","Evaluations:SmallChildren","Evaluations:OlderChildren","Evaluations:GroupTraveller","Evaluations:ConferenceParticipant"];
if(!$("#sortReview ul")){var hStr=["<ul>"];for(var i=1;i<len;i++){var currRev=reviews[i];var matched=currRev[2]?"initial":"",dataCelPos=i+30;if(i===(len-1)){hStr.push('<li class="last '+matched+'">');}else{hStr.push('<li class="'+matched+'">');}hStr.push('<label for="sortReview_'+i+'" data-celpos="'+dataCelPos+'" data-celinfo="'+evaluationsArr[i]+'">');hStr.push('<a href="'+this.buildURL(this.reviewCats[i-1])+'">'+currRev[1]+"</a>");hStr.push('<input type="checkbox" id="sortRev_'+i+'">');hStr.push("</label>");hStr.push("</li>");}hStr.push("</ul>");}$("sortReview").innerHTML=hStr.join("");},buildDistances:function(){var distances=this.sortingData.distance;var len_level1=distances.length;if(!$("#distances dl")){var hStr=["<dl>"];for(var i=4;i<len_level1;i++){var currDist=distances[i];var matched=currDist[0]?"initial":"";
var actionId=currDist[1]?currDist[1]:"";var l1type=currDist[2]?currDist[2]:"";var l1label=currDist[3]?currDist[3]:"";var dataCelPos=38+i;var currDist_level2=currDist[5];if(currDist_level2&&currDist_level2.length){var level2Len=currDist_level2.length;if(i===(len_level1-1)){hStr.push('<dt class="last '+matched+'" id="'+actionId+'">');}else{hStr.push('<dt class="'+matched+'" id="'+actionId+'">');}hStr.push('<label for="distance_'+l2counter+'">');hStr.push('<span class="'+l1type+'">'+l1label+"</span>");hStr.push('<input type="radio" id="distance_'+i+'"/>');hStr.push("</label>");hStr.push("</dt>");hStr.push('<dd class="list">');hStr.push("<ul>");for(var a=0;a<level2Len;a++){var l2counter=a+1;var currDist2=currDist_level2[a];var matched2=currDist2[0]?"initial":"";var actionID2=currDist2[1]?currDist2[1]:"";
var last2=(a===level2Len-1)?"last":"";var dataCelInfoArr=["Distance:Airports","Distance:TradeFairs"];var b=i-5;hStr.push('<li class="'+last2+" "+matched2+'" data-celpos="'+dataCelPos+'" data-celinfo="'+dataCelInfoArr[b]+'"><input type="checkbox" id="'+actionID2+'" />');hStr.push('<a href="'+this.buildURL(actionID2)+'">'+currDist2[2]+"</a>");hStr.push("</li>");}hStr.push("</ul>");hStr.push("</dd>");}else{if(i===(len_level1-1)){hStr.push('<dt class="last">');}else{hStr.push("<dt>");}hStr.push('<label for="'+actionId+'">');hStr.push('<a class="'+l1type+'" href="'+this.buildURL(currDist[4])+'">'+l1label+"</a>");hStr.push('<input type="radio" id="'+actionId+'" '+(matched!==""?'checked="checked"':"")+"/>");hStr.push("</label>");}}hStr.push("</dl>");$("distances").innerHTML=hStr.join("");}},setSortingData:function(data){this.sortingData=data;
this.setReviewCats();},setReviewCats:function(){var i,a,len;if(this.sortingData&&this.sortingData.reviews){for(i=1,len=this.sortingData.reviews.length;i<len;i+=1){a=i-1;this.reviewCats[a]=this.sortingData.reviews[i][0];}}}});var EventManager=new Class({Implements:Events});function setMapData(mapData){var mapObj=window.hotellistMap;if(mapObj){var coordinates={"bottomLeftLat":(mapData?mapData[1]:0),"bottomLeftLon":(mapData?mapData[2]:13),"topRightLat":(mapData?mapData[3]:52),"topRightLon":(mapData?mapData[4]:0),"isShown":(mapData?mapData[0]:0)};mapObj.updateMapData(coordinates);}else{window.mapDataObject={"bottomLeftLat":(mapData?mapData[1]:0),"bottomLeftLon":(mapData?mapData[2]:13),"topRightLat":(mapData?mapData[3]:52),"topRightLon":(mapData?mapData[4]:0)};}}window.kissmelightbox=new LightBox({lightBoxId:"KisSMELightBox",openInitial:false,isPageHotellist:false,dynamicVerticalPosition:true,dynamicScrollFixedPosition:true,afterCreation:function(){this.wrap.addEvent("submit",function(event){event.stop();
this.getContent(event.target,event);}.bind(this));this.wrap.addEvent("click",function(event){var target=event.target;if(target.get("tag")==="a"&&!target.get("onclick")&&!target.hasClass("close")){console.log(target);event.stop();this.getContent(target.get("href"));}}.bind(this));},xhrError:function(){console.log("todo XHR Error");}});var HotellistClickHandler=new Class({Implements:[Events,Options],options:{isHdSinglePage:false},initialize:function(container,ccCallback,options){var self=this;if(container){this.setOptions(options);if(this.options.isHdSinglePage){this.container=container.addEvent("mousedown",function(event){self.handleContext(event);});}else{this.container=container.addEvent("click",function(event){self.handleClick(event);});}}this.ccCallback=ccCallback||function(){};},searchForLink:function(elementToCheck){while(((" "+elementToCheck.className+" ").indexOf(" pu ")<0&&(" "+elementToCheck.className+" ").indexOf(" hotelTeaserContainer ")<0)||elementToCheck.tagName!="DIV"){elementToCheck=elementToCheck.parentElement;
}return elementToCheck;},handleContext:function(event){if(event.target.className.indexOf("loyaltyPromoBanner")>-1||event.target.parentElement.className.indexOf("loyaltyPromoBanner")>-1){return;}var teaser=event.target.hasClass("hotelTeaserContainer")?event.target:event.target.getParents(".hotelTeaserContainer")[0];if(event.control||event.shift||event.rightClick){return;}if(this.options.isNewTab||(window.s.prop26==="zh_CN"&&teaser.hasClass("hotelTeaserContainer"))){if(event.target.getParent("a")!=null||$(event.target).get("tag")==="a"){return;}event.stop();var tmpLink=document.createElement("A");tmpLink.target="_blank";tmpLink.style.display="none";tmpLink.href=this.options.lpLink.replace(/hotelnumber=5555/g,"")+"&hotelnumber="+teaser.id;teaser.parentNode.parentNode.appendChild(tmpLink);clickElement(tmpLink);
setTimeout(function(){teaser.parentNode.parentNode.removeChild(tmpLink);},100);return;}this.handleClick(event);},handleClick:function(event){var obj=$(this.searchForLink(event.target)),puCalled=false;if(obj){var objParent=obj.getParent(),objParentParent=objParent.getParent();if(window.priceGuaranteeHelp){window.priceGuaranteeHelp.hide();}if(event.target.getParent(".tooltip-info")){return;}if(event.target.hasClass("goToKisSMElayer")||event.target.getParent(".goToKisSMElayer")){event.preventDefault();window.selectedHotelId=obj.getParents(".hotelTeaserContainer").get("id");var parent=obj.getParent(".hotelTeaserContainer").getChildren(".jsOpenKissmeLayer").fireEvent("click");}else{if(event.target.hasClass("jsOpenKissmeLayer")||event.target.getParent(".jsOpenKissmeLayer")){event.stop();if(window.isNewRegistrationEnabled){window.frameRegistration.open("HLList:Business-Layover","register");
}else{window.registerForm.showAuthForm("register",undefined,undefined,"HLList:Business-Layover");}return false;}if(objParent.hasClass("pu")||objParent.hasClass("tr")||objParent.hasClass("cc")||objParent.hasClass("op")){obj=objParent;}if(obj.hasClass("pu")||obj.hasClass("tr")){this.track(obj);}if(obj.hasClass("pu")){event.preventDefault();if(!puCalled){this.pu(obj);puCalled=true;}}if(obj.hasClass("hotelFooter")||obj.getParent(".hotelFooter")){obj=obj.getParent(".hotelTeaserContainer");}if((obj.hasClass("hotelTeaserContainer")||objParent.hasClass("hotelTeaserContainer"))&&!obj.hasClass("jsOpenKissmeLayer")){event.stop();var datatidParent=objParent.getAttribute("data-trackingId");if(datatidParent){s_trackLinkWithCustomLinkTrackProp(datatidParent,objParent,{},s.pageName);}var datahotelitemurl=(obj.hasClass("hotelTeaserContainer"))?obj.getAttribute("data-hotelitemurl"):objParent.getAttribute("data-hotelitemurl");
obj.setProperty("href",datahotelitemurl);if(!puCalled){this.pu(obj);puCalled=true;}}if(window.HotelDetailsLayer){if(obj.hasAttribute("data-hpos")){window.HotelDetailsLayer.options.hotelListPosition=obj.getAttribute("data-hpos");}else{if(objParent.hasAttribute("data-hpos")){window.HotelDetailsLayer.options.hotelListPosition=objParent.getAttribute("data-hpos");}else{if(objParentParent.hasAttribute("data-hpos")){window.HotelDetailsLayer.options.hotelListPosition=objParentParent.getAttribute("data-hpos");}}}}}}},track:function(obj){if(obj.id&&window.s_trackLink){var split=obj.id.split("::"),json={};for(var i=1;i<split.length;i+=2){json[split[i]]=split[i+1];}s_trackLink(split[0],split[0].match(/hb/)?obj:true,json);}},pu:function(el){if(el.getAttribute("data-trackingId")){s_trackLinkWithCustomLinkTrackProp(el.getAttribute("data-trackingId"),el,{},s.pageName);
}var href=$(el).getProperty("href").replace(/&inCont=1/g,"");if(!window.HotelDetailsLayer){window.HotelDetailsLayer=new HotelDetailsHDLayer({closeText:"x",lightBoxId:"hotelDetailsHD",lightBoxEl:href+"&showSinglePage=true",verticalScrollPosition:window.getScroll().y,isParallax:this.options.isParallax,close:function(){if(window.layerMap){window.layerMap=false;}window.HotelDetailsLayer.content.empty();}});}else{window.HotelDetailsLayer.options.verticalScrollPosition=window.getScroll().y;window.HotelDetailsLayer.options.lightBoxEl=href+"&showSinglePage=true";window.HotelDetailsLayer.openLightBox(href+"&showSinglePage=true");}if(el.hasClass("hotelTeaserContainer")){window.HotelDetailsLayer.hotelId=el.id;}else{window.HotelDetailsLayer.hotelId=el.getParent(".hotelTeaserContainer").id;}},op:function(el){if(window.hotellistMap){window.hotellistMap.showSelected([el.getNext().getElement("input")]);
}var theList=$("openMap");theList.addClass("act");theList.getChildren().addClass("act");},cc:function(input){checked=checked||[];countChecked=checked.length;if(!input.checked){checked.erase(input);input.getParent("div.mm").addClass("mc");}else{if(countChecked<9){checked.push(input);input.getParent("div.mm").removeClass("mc");}else{input.checked=false;this.ccCallback.attempt();}}}});var tabOrBanderole={init:function(data){var destinationHeader=$$("h2.destination"),summaryDestination=$("summary_destination"),rightTab=$$(".right-tab"),rightBanderole=$$(".right-banderole"),hotellistContainer=$("hotelListCol"),cidParam=null,tabLinkout=$$(".tab a"),priceGuaranteeHeader=$("priceGuaranteeHeader"),isShowLink=data.holidaysTab.show;if(isShowLink===true&&typeOfTab!=="undefined"){if(typeOfTab==="tab"){destinationHeader.removeClass("hide");
rightTab.setStyle("display","block");summaryDestination.addClass("hide");hotellistContainer.addClass("tab");cidParam="HRS_HL_Test_Tab";if(isShowLink){$$(".freeHotelsText")[0].innerHTML="freie Hotels";}}else{if(typeOfTab==="banderole"){rightBanderole.setStyle("display","block");hotellistContainer.addClass("banderole");cidParam="HRS_HL_Test_Logo";}}tabLinkout.set("href",data.holidaysTab.link+"?cid="+cidParam);priceGuaranteeHeader.addClass("hide");}}};var searchWidgetHorizontal={init:function(){document.querySelector(".toggle").setStyle("height","65px");if($$("#destiny.error")[0]){$$('label[for="destiny"] span.error')[0].setStyle("width","100%");document.querySelector(".searchingSummaryLink").addClass("hide");document.querySelector(".form").removeClass("hide");var checkForElem=setInterval(function(){var elem=document.querySelector(".searchingSummaryLink");
if(elem){elem.fireEvent("click");clearInterval(checkForElem);}},100);}if(parseInt($("roomSelector").value)===4){$("roomSelectionOptions").removeClass("hide");}else{$("roomSelectionOptions").addClass("hide");}$("roomSelector").addEvent("change",function(){if(parseInt($(this).value)===4){$("roomSelectionOptions").removeClass("hide");}else{$("roomSelectionOptions").addClass("hide");}});}};window.addEvent("domready",function(){searchWidgetHorizontal.init();});function removeOverlay(){var overLayWrapper=$("overLayWrapper");if(window.counterReady&&(overLayWrapper||$(".hrsPopup--loader"))){hideLoaderPopup();if(overLayWrapper){overLayWrapper.dispose();}if(!window.location.hash.contains("hotelId")){window.location.hash="#initialLoaded";}window.removeOverlay=function(){};HotellistEventManager.fireEvent("loadTimerEnd").removeEvent("removeOverlay",removeOverlay);
}else{window.hotellistReady=true;}}function convertToValidTrackingObject(obj){var keys=Object.keys(obj);for(var i=0;i<keys.length;i+=1){if(obj[keys[i]]===null){obj[keys[i]]=undefined;}}return obj;}function printForm(form){var hotellistForm=form||hotellist.document.getElementById("hotelBookingForm");if(!hotellistForm){return false;}var printWindow=window.open("","print","width=785, height=648, left=50, top=0, scrollbars=yes, resizable=yes");printWindow.focus();hotellistForm.target="print";if(form){var targetHiddenField=document.getElementById("targetButton");if(targetHiddenField){targetHiddenField.name=this.name;targetHiddenField.value=this.value;}if(!Browser.ie8){form.submit();}}}function setHotelistFormTarget(form){var hotellistForm=form||document.getElementById("hotelBookingForm");if(!hotellistForm){return false;
}hotellistForm.target="_self";}function initShowInMapButton(){var showInMapButton=$("mapDisplaySubmit");if(showInMapButton&&window.mapBrowser){showInMapButton.addEvent("click",function(event){event.preventDefault();checked=window.checked;if(window.hotellistMap){window.hotellistMap.showSelected(checked);}});var showHotelsOnMap=true;if(!showHotelsOnMap){showInMapButton.addClass("hide");}}}function preventEvent(e){e.preventDefault();}function getPageXY(event){if(event.targetTouches){event=event.targetTouches[0];}if(event.pageX!=null&&event.pageY!=null){return{pageX:event.pageX,pageY:event.pageY};}var element=(!document.compatMode||document.compatMode=="CSS1Compat")?document.documentElement:document.body;return{pageX:event.clientX+element.scrollLeft,pageY:event.clientY+element.scrollTop};}function NoClickDelay(el){this.element=typeof el=="object"?el:document.getElementById(el);
this.element.addEventListener("touchstart",this,false);}NoClickDelay.prototype={handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e);break;}},onTouchStart:function(e){e.preventDefault();this.moved=false;this.theTarget=document.elementFromPoint(e.targetTouches[0].clientX,e.targetTouches[0].clientY);if(this.theTarget.nodeType==3){this.theTarget=theTarget.parentNode;}this.theTarget.className+=" pressed";this.element.addEventListener("touchmove",this,false);this.element.addEventListener("touchend",this,false);},onTouchMove:function(e){this.moved=true;this.theTarget.className=this.theTarget.className.replace(/ ?pressed/gi,"");},onTouchEnd:function(e){this.element.removeEventListener("touchmove",this,false);
this.element.removeEventListener("touchend",this,false);if(!this.moved&&this.theTarget){this.theTarget.className=this.theTarget.className.replace(/ ?pressed/gi,"");var theEvent=document.createEvent("MouseEvents");theEvent.initEvent("click",true,true);this.theTarget.dispatchEvent(theEvent);}this.theTarget=undefined;}};window.SubSessionStorage=window.SubSessionStorage||(function(){var name=window.name;try{JSON.decode(name);}catch(e){name="{}";}var storage=JSON.decode(name);var WINDOWNAME="windowname";function refreshWindowName(){window.name=(storage[WINDOWNAME]?storage[WINDOWNAME]:window.name);}function Save(){storage[WINDOWNAME]=window.name;window.name=JSON.encode(storage);}if(window.addEventListener){window.addEventListener("unload",Save,false);}else{if(window.attachEvent){window.attachEvent("onunload",Save);
}else{window.onunload=Save;}}if(window.addEventListener){window.addEventListener("load",refreshWindowName,false);}else{if(window.attachEvent){window.attachEvent("onload",refreshWindowName);}else{window.onload=refreshWindowName;}}return{setValue:function(key,value){storage[key]=value;},getValue:function(key){return storage[key];}};})();function showDetailPage(elem){var link=elem.parentNode.getAttribute("data-hotelitemurl");window.location=link;}function initHotelListDealsPromo(hotelList,image_path,priceText){if(hotelList==null||hotelList==undefined){return null;}var obj={wrapper:null,image_name:null,teaserText:priceText,image_id:1,styleToImage:["position: absolute;z-index:30;top:-8px;left:-3px;","position: absolute;z-index:30;top:5px;left:8px;","position: absolute;z-index:30;top:-8px;left:-4px;"],init:function(image_id){this.createPromoWrapper();
this.initImage(image_id);hotelList.options.hotelListRenderedCallback=this.renderPromoHotel.bind(this);this.renderPromoHotel();return this;},initImage:function(image_id){image_id=Number(image_id);if(image_id==null||isNaN(image_id)||image_id<1||image_id>3){image_id=Math.floor(Math.random()*3)+1;}this.image_name="deals_logo_"+image_id+".png";this.image_id=image_id;},createPromoWrapper:function(){var hotelDiv=document.createElement("div"),wrapper=$("summary");hotelDiv.className="hl_PromoWrapper";hotelDiv.setStyle("height","150px").setStyle("display","none");wrapper.parentNode.insertBefore(hotelDiv,wrapper);},setPromoWrapperVisibility:function(todo){$$(".hl_PromoWrapper")[0].setStyle("height",String(hotelList.hotelTeaserHeightAssumption+30)+"px").setStyle("display",todo?"block":"none");},renderPromoHotel:function(){var hotelPosition,hotelDiv,hotelTeaserContainer;
if(hotelList.hrsDealHotels.length<=0){this.setPromoWrapperVisibility(false);return;}this.setPromoWrapperVisibility(true);hotelPosition=hotelList.hrsDealHotels[0].hotelPosition;hotelDiv=hotelList.jsonSingleOffer(hotelPosition,true);this.setupPromoHotel(hotelDiv);$("containerAllHotels").style.position="relative";hotelTeaserContainer=$$("#containerAllHotels .hotelTeaserContainer")[0];hotelTeaserContainer.parentNode.insertBefore(hotelDiv,hotelTeaserContainer);},getTopValue:function(){var menu=$$(".loh_contentNav")[0],summary=$("summary"),height=0;if(menu==undefined){height+=48;}else{height+=menu.getSize().y;}if(summary==undefined){height+=66;}else{height+=summary.getSize().y;}height+=hotelList.hotelTeaserHeightAssumption;height+=30;return"-"+String(height)+"px";},setupPromoHotel:function(hotelDiv){var elements,topValue=this.getTopValue();
hotelDiv.setStyle("position","absolute").setStyle("top",topValue).setStyle("width","677px").setStyle("padding","15px 19px 0px 10px");hotelDiv.removeAttribute("data-hpos");hotelDiv.id=hotelDiv.id+"_hrsdeals-"+this.image_id;$(hotelDiv).getElements("div.mm")[0].innerHTML='<img style="'+this.styleToImage[this.image_id-1]+'" class="deals_logo" src="'+image_path+this.image_name+'" />';$(hotelDiv).getElements("span.priceContainer")[0].innerHTML='<span class="pricePromoTitle">'+this.teaserText+"</span>"+$(hotelDiv).getElements("span.priceContainer")[0].innerHTML;elements=$(hotelDiv).getElements(".priceContainer span.hasTariff");if(elements.length>0){elements[0].style.top="25px";}},setOwnCookie:function(){Cookie.write("abthldp","1");},checkOwnCookie:function(){var intr;if(Cookie.read("abthldp")!="1"){return;
}intr=setInterval(function(){if(window.hotellistReady!=true){clearInterval(intr);this.init();return false;}return true;},100);}};obj.checkOwnCookie();return obj;}