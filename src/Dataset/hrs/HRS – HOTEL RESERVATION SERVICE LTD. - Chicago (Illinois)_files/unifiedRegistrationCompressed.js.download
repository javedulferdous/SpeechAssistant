function initRegisterForm(jQuery,options){var $=jQuery;var self=null;var registerForm={options:{smeUrl:null,validators:null,privateUrl:null,loginUrl:null,defaultRedirect:null,scenario:null,isLayover:false,showLayover:false,justRegistered:true,backButtonText:"",activeForm:null,touchpoint:"StandalonePage",oneWebRedirectUrl:null,promotion:null,validationKey:null,savePromotionDataUrl:null,isStandalone:false},constants:{NOT_EMPTY:"NOT_EMPTY",LETTERS_AND_HYPHENS:"LETTERS_AND_HYPHENS",EMAIL:"EMAIL",PRIVATE:"private",BUSINESS:"business"},skipSuccessMessage:false,scrollTo:null,isOneWebLandingPage:false,isPromotionLandingPage:false,elements:{layover:null,closingEl:null,veil:null},urlCheck:/userLayover=(register)|userLayover=(login)/i,init:function(options){try{self=this;this.options=options;if(this.options.oneWebRedirectUrl!=null&&this.options.oneWebRedirectUrl!=""){this.isOneWebLandingPage=true;
}if(this.options.promotion!=null&&this.options.promotion!=""){this.isPromotionLandingPage=true;}this.hideMenuElements();this.displayProperForm();if(!this.isOneWebLandingPage&&!this.isPromotionLandingPage){this.layoverRegisterHandling();}else{if(this.isOneWebLandingPage){this.initOneWebSuccessMessage();}else{if(this.isPromotionLandingPage){this.initPromotionSuccessMessage();}}}this.handleCompanyField();this.submitForm();this.cleaningForm();this.handleSwitchingForms();}catch(e){console.log(e);}},initOneWebSuccessMessage:function(){var closingEl=$("#KisSMELightBox_veilPopup, .successBox .close");closingEl.click(function(e){e.preventDefault();window.location.replace(self.options.oneWebRedirectUrl);});},initPromotionSuccessMessage:function(){$("#registerWrapper").addClass("oneWebRegister");$(".successBox.cart").find(".deOnly").remove();
$(".successBox.cart").find(".otherLangs").removeClass("otherLangs");$(".successBox.cart").find(".desc p").remove();$(".successBox.cart").addClass("promotionSuccess");$.getJSON(self.getFormUrl()+"&activity=promotionData&type="+self.options.promotion,function(data){$(".successBox.cart").find(".title h2").html(data.header);$(".successBox.cart").find(".desc").prepend(data.body);$(".successBox.cart").find("input").attr("value",data.button);var closingEl=$("#KisSMELightBox_veilPopup, .successBox .close");closingEl.click(function(e){e.preventDefault();window.location.replace(data.url);});});},showOneWebSuccessMessage:function(){$("#KisSMELightBox_veilPopup").show();jQuery(".successBox").addClass("display").show();},displayProperForm:function(){$("input[name='typeOfUser']").on("change",function(){var typeOfUser=$("input[name='typeOfUser']:checked").val();
$(".businessContent, .privateContent").hide();self.cleaningForm();if(typeOfUser==="both"){$(".businessContent").show();}else{$("."+typeOfUser+"Content").show();}});},handleCompanyField:function(){var companyNameField=$("#registerCompanyName"),freelancerInput=$('input[name="freelancer"]');$("#iamfreelancer").on("change",function(){if($(this).is(":checked")){freelancerInput.val(true);companyNameField.removeClass("error valid").attr("disabled","disabled").val("").next("span.error").text("");}else{freelancerInput.val(false);companyNameField.removeAttr("disabled");}});},handleSwitchingForms:function(){var param=self.options.scenario;(param===null)?param="register":param=param;if(param==="register"||param===""){self.setActiveForm("register");$("form.register, .cart .title h2.register, #switcher p.alreadyRegistered").show();
}else{if(param==="login"){self.setActiveForm("login");$("form.login, .cart .title h2.login, #switcher p.notRegistered").show();}}$("#switcher a").on("click",function(e){e.preventDefault();var currentElement=$(this),sectionToShow=currentElement.attr("class");self.showAuthForm(sectionToShow,undefined,undefined,self.touchpoint);});},setCurrentForm:function(sectionToShow){var mainTitle=$("#register.cart .title"),switcher=$("#switcher p"),mandatoryInfo=$("p.mandatory");mainTitle.find("h2").hide();mainTitle.find("h2."+sectionToShow).show();$("#registerWrapper form").hide();$("#registerWrapper form."+sectionToShow).show();if(sectionToShow==="login"){self.setActiveForm("login");switcher.hide();$("p.notRegistered").show();mandatoryInfo.hide();}else{if(sectionToShow==="register"){self.setActiveForm("register");
switcher.hide();$("p.alreadyRegistered").show();mandatoryInfo.show();}}registerForm.createRegistrationTracking(false);self.cleaningForm();},hideMenuElements:function(){if(location.href.contains("register.do")){jQuery("#isMyhrs > a").hide();}if(!self.isOneWebLandingPage){return;}$(".logo a").attr("href","https://beta.hrs.com");$("#breadcrumb .breadcrumb__list").hide();$("#breadcrumb h3").html(self.options.backButtonText).css("cursor","pointer").click(function(e){e.preventDefault();window.location.replace(self.options.oneWebRedirectUrl);});$("#nav").hide();$("#registerWrapper").addClass("oneWebRegister");},setActiveForm:function(formName){registerForm.options.activeForm=formName;registerForm.setActiveFormCookie(formName);},getActiveForm:function(){var regex=/newRegistrationRememberForm=([a-zA-Z]+)/;
var result=regex.exec(document.cookie)&&regex.exec(document.cookie)[1];return this.options.activeForm||result;},setActiveFormCookie:function(formName){if(registerForm.options.isLayover===true){return;}var date=new Date();date.setTime(date.getTime()+(31*24*60*60*1000));var expires="; expires="+date.toGMTString();document.cookie="newRegistrationRememberForm="+formName+expires+"; path=/";},cleaningForm:function(){var errorValidation=$(".error--validation");var errorEmpty=$(".error--empty");if(errorValidation){errorValidation.hide();}if(errorEmpty){errorEmpty.hide();}$("#registerWrapper form input.text").val("").removeClass("error valid").next("span.error").text("");$("#iamfreelancer").attr("checked",false);$('input[name="freelancer"]').val(false);$('input[name="companyName"]').removeAttr("disabled");
},getFormClass:function(userType){if(userType==="private"){return"privateContent";}else{if(userType==="business"||userType==="both"){return"businessContent";}else{if(!userType){return"loginContent";}}}},getFormUrl:function(userType){if(userType==="private"){return self.options.privateUrl;}else{if(userType==="business"||userType==="both"){return self.options.smeUrl;}else{if(!userType){return self.options.loginUrl;}}}},validateForm:function validateForm(form,type){var isFormValid=true;var formType=(type===self.constants.PRIVATE?self.constants.PRIVATE:self.constants.BUSINESS);var formFields=$(form).find("input.register--"+formType);formFields.each(function(i,field){var results=self.getValidationResults(field);if(!self.validateField(field,results)){isFormValid=false;}});return isFormValid;},getValidationResults:function getValidationResults(field){var result=[];
var validators=self.options.validators;switch(field.name){case"password":result.push(validators.notEmpty(field.value));break;case"firstName":case"lastName":result.push(validators.notEmpty(field.value),validators.characters(field.value));break;case"email":case"personalData.email":result.push(validators.email(field.value));break;default:result.push({valid:true,error:null});break;}return result;},validateField:function validateField(field,results){var isFieldValid=true;results.each(function(result,i){var isValid=result.valid;isValid?self.removeError(field,result.error,i):self.addError(field,result.error);if(!isValid){isFieldValid=false;}});return isFieldValid;},addError:function addError(selector,error){selector.removeClass("valid");selector.addClass("error");if(error===self.constants.NOT_EMPTY){$(selector).nextAll(".error--empty").css("display","block");
}else{$(selector).nextAll(".error--validation").css("display","block");}},removeError:function removeError(selector,error,ruleIndex){if(ruleIndex===0){selector.removeClass("error");}if(error===self.constants.NOT_EMPTY){$(selector).nextAll(".error--empty").hide();}else{$(selector).nextAll(".error--validation").hide();}},handleErrorResponse:function(data){if(registerForm.options.activeForm==="register"){var formContent=self.getFormClass($("input[name='typeOfUser']:checked").val()),formToOperate=$("form.register "+"."+formContent),errors=data.errors;if(errors&&errors.reCaptcha){var registerWrapper=$("#registerWrapper");var overlay=$("#KisSMELightBox_veilPopup");var captchaErrorWrapper=$("#captchaErrorWrapper");registerWrapper.hide();overlay.show();captchaErrorWrapper.show();overlay.on("click",function(){captchaErrorWrapper.hide();
registerWrapper.css("display","");});}formToOperate.find("input.text").each(function(){var item=$(this);item.removeClass("error valid").next("span.error").text("");if(item.val()!==""){item.addClass("valid");}});$.each(errors,function(index,errorMessage){if(index){formToOperate.find('input[name="'+index+'"]').removeClass("valid").addClass("error").next("span.error").text(errorMessage);}});window.HRS_PUW.AuthPopupOverlay.instance.handleRegistrationFailure();}else{if(registerForm.options.activeForm==="login"){errors=data.error;if(errors){$("form.login span.error").text(errors);}}}},getRedirectUrl:function(data){if(data["reloadUrl"]==null||!data["reloadUrl"] instanceof Array||data["reloadUrl"].length==0||data.reloadUrl[0].length==0){return self.options.defaultRedirect;}if(data["reloadUrl"] instanceof Array){return data.reloadUrl[0];
}return data.reloadUrl;},loading:function(visible){if(visible){jQuery("#layoverRegisterWrapper .overlay").fadeIn(150);return;}jQuery("#layoverRegisterWrapper .overlay").fadeOut(150);},savePromotionData:function(){var data={promotion:self.options.promotion,validationKey:self.options.validationKey};$.ajax({type:"post",url:self.options.savePromotionDataUrl,data:data,dataType:"json",beforeSend:function(req){self.loading(true);req.setRequestHeader("Accept","application/json");},mimeType:"multipart/form-data"});},setLostPasswordLink:function createLostPasswordLink(){window.HRS_PUW.GTM.EventHandler.PuwForgotPasswordHandler.createUrlWithTouchpoint(".forgottenLoginDetails");},handleResponse:function(data){if(!data.success){self.handleErrorResponse(data);self.loading(false);return;}if(registerForm.options.activeForm==="login"){var touchpointMyHRS=GTMHelper.getLastTouchpointMyHRS();
self.trackSuccessLogin(data);var userType;switch(document.querySelector('input[name="typeOfUser"]:checked').value){case"private":userType=0;break;case"business":userType=1;break;case"both":userType=1;break;}window.HRS_PUW.GTM.EventHandler.PuwLoginHandler(touchpointMyHRS,data.userType,(document.getElementById("rememberMe").checked)?"Y":"N",data.userMyHRSID);}else{self.createRegistrationTracking(true);self.createRegistrationMdTracking(data);window.HRS_PUW.AuthPopupOverlay.instance.handleRegistrationSuccess(JSON.parse(data.metadataObject),true);}if(self.isOneWebLandingPage===true||self.isPromotionLandingPage===true){self.showOneWebSuccessMessage();if(self.isPromotionLandingPage===true){self.savePromotionData();}return;}if(self.isPromotionLandingPage){return;}if(self.options.isLayover===true){if(registerForm.options.activeForm==="login"){window.location.reload();
return;}self.options.justRegistered=true;if(self.skipSuccessMessage===true||self.isBookingForm()){if(self.scrollTo!=null){window.location.replace(self.scrollToUrl(self.scrollTo));}else{window.location.reload();}self.skipSuccessMessage=false;self.scrollTo=null;return;}var typeOfUser=$("input[name='typeOfUser']:checked").val();var userName=$("form.register ."+self.getFormClass(typeOfUser)+" input[name='firstName']").val()+" "+$("form.register ."+self.getFormClass(typeOfUser)+" input[name='lastName']").val();$("#registeredUserNameLayover").text(userName);$("#layoverRegisterWrapper #register").hide();$("#layoverRegisterWrapper .successBox").show();return;}self.setActiveFormCookie("login");document.location.href=self.getRedirectUrl(data);},isBookingForm:function(){if(s.pageName.trim().toLowerCase()==="bo:data"){return true;
}},isHotelDetailsLayer:function(){return jQuery("body").hasClass("hasDetailsLayer");},trackSuccessLogin:function(data){s.linkTrackVars="eVar33,eVar65,prop33,prop28,events,pageName";s.linkTrackEvents=data.trackingData.loginEvent;s.events=data.trackingData.loginEvent;s.eVar33=s.prop33=data.trackingData.state+";"+data.trackingData.type+";"+data.trackingData.status;s.eVar65=self.generateTouchpointName();var tmpPageName;if(self.isLayover){tmpPageName=s.prop28="MY:Login Overlay";}else{tmpPageName=s.prop28="MY:Login Landingpage";}s.tl(true,"o",tmpPageName);},createRegistrationTracking:function(registered){if(registered){var userTypesArr={"private":"0","business":"1","both":"3"};var events={"private":"event23,event3","business":"event22,event26","both":"event29,event26"};var typeOfUser=$("input[name='typeOfUser']:checked").val();
var tmpPageName=this.options.isLayover?"MY:Registration Overlay":"MY:Registration Landingpage";s.linkTrackVars="events,channel,eVar33,eVar65,prop33,prop28,prop25";s.prop33=s.eVar33="3;"+userTypesArr[typeOfUser]+(typeOfUser=="private"?";0":";11");s.eVar65=self.generateTouchpointName();s.prop28=tmpPageName;s.prop25=typeOfUser=="private"?"6011":"6012";s.events=events[typeOfUser];s.linkTrackEvents=s.events;s.tl(true,"o",tmpPageName);}else{md.mphier="Public Web,MyHRS Registration Form";md.mpn="MyHRS Register Form";md.mpt="MyHRS";var tmpPageName=s.pageName;s.pageName="MY:"+(this.options.activeForm==="login"?"Login":"Registration")+(this.options.isLayover?" Overlay":" Landingpage");s.eVar33="0;;";s.events="";s_trackPage();s.pageName=tmpPageName;}},createRegistrationMdTracking:function(data){if(typeof data.metadataObject!="undefined"){md=JSON.parse(data.metadataObject);
}md.mphier="Public Web, MyHRS Registration Confirmation";md.mpn="MyHRS Register Confirmation";md.mpt="MyHRS";if($("input[name='typeOfUser']:checked").val()=="both"){md.mpev="MyHRSReg,login";}},generateTouchpointName:function(){if(self.isOneWebLandingPage===true&&self.options.activeForm==="register"){return"POW:Registration";}else{return s.pageName.replace(/\s|:/g,"")+":"+(self.touchpoint?self.touchpoint:"StandalonePage");}},scrollToUrl:function(scrollTo){var searchForm=jQuery("#wrap.hotellist #searchForm");var index,time,url=String(window.location.href);index=url.lastIndexOf("#");time=new Date().getTime();time="&"+time+"="+time;if(index<0){url=url+time+"#"+scrollTo;}else{url=url.substring(0,index)+time+"#"+scrollTo;}if(searchForm.length>0){url=url.replace("showHotellistWithPromotion","startSearch");
}return url;},submitForm:function(){$("#registerWrapper form").submit(function(e){e.preventDefault();var formToSubmit=$(this).attr("name"),typeOfUser=(formToSubmit==="register")?$("input[name='typeOfUser']:checked").val():null,formData=(formToSubmit==="register")?$(this).find("."+self.getFormClass(typeOfUser)+" input").serialize()+"&userType="+typeOfUser:$(this).find("input").serialize(),pass=new RegExp("[?&]password=([^&#]*)").exec(formData)[1],hashPass=MD5(pass);if(!self.validateForm(this,typeOfUser)){return;}if(registerForm.options.activeForm==="login"){formData=formData.replace(/(password=)[^\&]+/,"$1"+hashPass);if(!$$("#rememberMe")[0].checked){formData=formData.replace("rememberMe=true","rememberMe=false");}}else{var reCaptchaResponse=grecaptcha&&grecaptcha.getResponse(window.recaptchaMYHRS);
if(!reCaptchaResponse){grecaptcha.execute(window.recaptchaMYHRS);return;}formData+="&reCaptchaResponse="+reCaptchaResponse;}var input=$('form[name="bookingForm"] input[name="activity"]');if(input!=null&&input.val()=="doBookingConfirmationAction"){formData+="&bookingStepVar3=bookingStepVar3";}if(self.isBookingForm()){self.overwritePersonalData();}$.ajax({type:"post",url:self.getFormUrl(typeOfUser),data:formData,dataType:"json",beforeSend:function(req){self.loading(true);req.setRequestHeader("Accept","application/json");},mimeType:"multipart/form-data",success:self.handleResponse,error:function(err){self.loading(false);console.log(err);}});grecaptcha.reset(window.recaptchaMYHRS);});},layoverRegisterHandling:function(){var layover=$("#layoverRegisterWrapper");if(!layover.length){if(this.options.isStandalone&&this.getActiveForm()==="register"){window.HRS_PUW.AuthPopupOverlay.instance.handleRegistrationProcess("MyHRS Registration Form","MyHRSRegistration:StandalonePage");
}self.setLostPasswordLink();jQuery("#nav ul li.login .registrationLink a.link").on("click",function(){jQuery('input[name="firstName"]:visible').focus();});return;}this.elements.layover=layover;this.elements.closingEl=$("#KisSMELightBox_veilPopup, #layoverRegisterWrapper .close");this.elements.veil=$("#KisSMELightBox_veilPopup");this.elements.closingEl.on("click",function(){self.cleaningForm();if(self.options.justRegistered){self.safelyReloadPage();}});jQuery("#nav ul li.login .registrationLink a.link").on("click",function(){self.showAuthForm(undefined,undefined,undefined,"Header-Flyout-PopUp");});var layoverShow=this.isLayoverVisible();if(layoverShow!==false){layover.show();this.elements.veil.show();}this.layoverDisplayCorrectForm(layoverShow);},showAuthForm:function(form,hideSuccessMessage,scrollTo,touchpoint){var popupName=form==="login"?"MyHRS Login Form":"MyHRS Registration Form";
self.skipSuccessMessage=(hideSuccessMessage==true);self.scrollTo=scrollTo;self.touchpoint=touchpoint?touchpoint:"StandalonePage";self.setCurrentForm(form||"register");window.HRS_PUW.AuthPopupOverlay.instance.show({popup:"#layoverRegisterWrapper",touchpoint:self.touchpoint,popupName:popupName,isStandAlone:this.options.isStandalone});self.setLostPasswordLink();},layoverDisplayCorrectForm:function(layoverShow){if(layoverShow===true||layoverShow===false){return;}self.options.scenario=layoverShow;},isLayoverVisible:function(){return this.options.showLayover;},safelyReloadPage:function(){var searchForm=jQuery("#wrap.hotellist #searchForm");if(searchForm.length){var scrollY=jQuery(document).scrollTop();if(scrollY>0){searchForm.attr("action",searchForm.attr("action")+"#scroll"+scrollY);}searchForm.submit();
}else{if(window.location.pathname.slice(0,5)!=="/web3"){window.location.href="/web3"+window.location.pathname+window.location.search;}else{window.location.reload();}}},overwritePersonalData:function(){var firstName=document.getElementById("orderer.firstname"),lastName=document.getElementById("orderer.lastname"),email=document.getElementById("orderer.email"),countryCode=document.getElementById("orderer.phone.countryCode"),phoneNumber=document.getElementById("orderer.phone.number");if(firstName.value!==""||lastName.value!==""||email.value!==""||countryCode.value!==""||phoneNumber.value!==""){sessionStorage.setItem("overwritePersonalData","true");}if(firstName.value!==""){sessionStorage.setItem("firstName",firstName.value);}if(lastName.value!==""){sessionStorage.setItem("lastName",lastName.value);
}if(email.value!==""){sessionStorage.setItem("email",email.value);}if(countryCode.value!==""){sessionStorage.setItem("countryCode",countryCode.value);}if(phoneNumber.value!==""){sessionStorage.setItem("phoneNumber",phoneNumber.value);}}};registerForm.init(options);return registerForm;}