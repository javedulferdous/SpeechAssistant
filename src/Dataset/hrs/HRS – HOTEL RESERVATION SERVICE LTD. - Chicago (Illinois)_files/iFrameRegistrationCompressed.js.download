(function(){window.addEventListener=window.addEventListener||function(e,f){window.attachEvent("on"+e,f);};window.removeEventListener=window.removeEventListener||function(e,f){window.detachEvent("on"+e,f);};var ireg={elements:{rootLink:null,overlay:null,registrationForm:null,iFrame:null,loader:null,loadingElement:null},settings:{},initialIframeDimensions:{login:{height:447,width:580},register:{height:460,width:580}},urlCheck:/userLayover=(register)|userLayover=(login)/i,touchpoint:"Header",reloadOnClose:false,isMounted:false,isFormMounted:false,pageNameMapping:{hotelListFragment:"HLList",homepage:"Homepage","HL:List":"HLList",listOfHotelsFrameset:"HLList",hotelDataSinglePage:"HDetail",bookingForm:"BStep1"},init:function(settings){if(settings.loggedId){return;}try{ireg.initElements();ireg.initBindings();
ireg.settings=settings;ireg.initDeeplink();}catch(err){console.log(err);}if(window.autoOpenRegistration&&window.autoOpenRegistration.touchpoint){ireg.open(window.autoOpenRegistration.touchpoint,window.autoOpenRegistration.form||"register");}},initDeeplink:function(){var deeplink=ireg.getDeeplink();if(deeplink===false){return;}ireg.open(ireg.getPageName()+":Deeplink",deeplink);},getDeeplink:function(){var res=this.urlCheck.exec(location.search);if(res==null||res.length<3){return false;}if(res[1]!=undefined){return res[1];}if(res[2]!=undefined){return res[2];}return false;},initBindings:function(){if(window.isNewRegistrationEnabled){ireg.elements.rootLink.addEvent("click",ireg.handlerRootLink);}window.addEventListener("message",ireg.handlePostMessage,false);},initElements:function(){ireg.elements.rootLink=document.getElementById("mainNav_A_6");
if(ireg.elements.rootLink==null){ireg.elements.rootLink=document.getElementById("mainNav_A_1");}if(window.isNewRegistrationEnabled){ireg.elements.rootLink.getParent().className+=" newRegActive";}ireg.elements.overlay=document.getElementById("KisSMELightBox_veilPopup");ireg.elements.errorPage=document.getElementById("loadingPageError");ireg.createRegistrationForm();ireg.elements.rootLink.style.cursor="pointer";},getUrlOrigin:function(url){var tmp=document.createElement("a");tmp.href=url;return tmp.origin;},handlePostMessage:function(e){if(e.origin!=ireg.getUrlOrigin(ireg.settings.iframeOrigin)){return;}var data=e.data;switch(e.data.action){case"close":ireg.closeLayer();break;case"resize":ireg.handlePostMessage_resize(data);break;case"registration":ireg.reloadOnClose=true;ireg.handleTracking(e.data.action,data);
break;case"login":ireg.handleTracking(e.data.action,data);break;case"toggle":ireg.openIframeTracking(data.params.formname);break;case"mounted":ireg.elements.loadingElement.classList.remove("active");ireg.elements.iFrame.classList.remove("hidden");break;default:}},handlePostMessage_resize:function(data){var margin=(data.params.width/2)*-1;ireg.elements.iFrame.style.height=data.params.height+"px";if(data.params.width){ireg.elements.iFrame.style.width=data.params.width+"px";ireg.elements.registrationForm.style.marginLeft=margin+"px";}},open:function(touchpoint,scenario){ireg.setDisplayOverlay(true);ireg.setDisplayRegistrationForm(true,{touchpoint:touchpoint,scenario:scenario});ireg.errorMonitoring();ireg.openIframeTracking(scenario,touchpoint);},errorMonitoring:function(){var timeout=ireg.settings.newRegFormTimeout||10;
function setMounted(data){if(data.data.action==="mounted"){ireg.isMounted=true;ireg.isFormMounted=true;window.removeEventListener("message",setMounted);}}window.addEventListener("message",setMounted);setTimeout(function(){if(!ireg.isMounted){ireg.errorHandler();}},timeout*1000);},openIframeTracking:function(scenario,touchpoint){if(touchpoint){ireg.touchpoint=touchpoint;}var tmpPageName=s.pageName;s.pageName="MY:"+(scenario==="login"?"Login":"Registration")+" Overlay";s.eVar33="0;;";s.events="";s_trackPage();s.pageName=tmpPageName;},handleTracking:function(action,data){s.linkTrackVars="events,channel,eVar33,eVar65,prop33,prop28,prop25";s.prop33=s.eVar33="3;1;11";s.eVar65=ireg.touchpoint;s.prop25="6012";if(action==="login"){var touchpointMyHRS=GTMHelper.getLastTouchpointMyHRS();s.prop28="MY:Login Overlay";
s.events="event26"+((data.params&&data.params.rememberMe)?",event71":"");window.HRS_PUW.GTM.EventHandler.PuwLoginHandler(touchpointMyHRS,data.userType,(data.params&&data.params.rememberMe)?"Y":"N",data.userMyHRSID);}else{s.prop28="MY:Registration Overlay";s.events="event22,event26";}s.linkTrackEvents=s.events;s.tl(true,"o",s.prop28);if(action==="login"){if(window.location.pathname.slice(0,5)!="/web3"){window.location.href="/web3"+window.location.pathname+window.location.search;}else{window.location.reload();}}},createRegistrationForm:function(){var container=document.createElement("div"),iFrame=document.createElement("iframe");ireg.elements.iFrameContainer=container;iFrame.scrolling="no";iFrame.classList.add("hidden");ireg.elements.iFrame=iFrame;container.appendChild(iFrame);container.id="newFrameRegisterForm";
ireg.elements.registrationForm=container;document.body.appendChild(container);container.insertAdjacentHTML("beforeend",'<div class="loadingElement"></div>');ireg.elements.loadingElement=container.querySelector(".loadingElement");},handlerCloseLayer:function(e){e.preventDefault();ireg.closeLayer();},closeLayer:function(){ireg.setDisplayRegistrationForm(false);ireg.setDisplayOverlay(false);ireg.elements.errorPage.style.display="none";ireg.elements.iFrame.src="about:blank";ireg.isFormMounted=false;ireg.elements.iFrame.classList.add("hidden");if(ireg.reloadOnClose){ireg.safelyReloadPage();}},safelyReloadPage:function(){var searchForm=document.getElementById("searchForm");var pagesToReload=["HL:List","hotelListFragment","HD:SinglePageLayer"];if(searchForm&&pagesToReload.indexOf(md.mpn)>-1){if(md.mpn==="HD:SinglePageLayer"&&window.hotelId){document.getElementById("searchForm").action+="#hotelId"+window.hotelId;
}searchForm.submit();}else{if(window.location.pathname.slice(0,5)!="/web3"){window.location.href="/web3"+window.location.pathname+window.location.search;}else{window.location.reload();}}},handlerRootLink:function(e){e.preventDefault();ireg.initPreloader();ireg.open(ireg.getPageName()+":Header-Myhrs","login");},getPageName:function(){if(ireg.pageNameMapping[md.mpn]!=undefined){return ireg.pageNameMapping[md.mpn];}return md.mpn;},getIframeUrl:function(options){options=options||{};var url=[ireg.settings.url,"?locale=",ireg.settings.locale,"&targetOrigin=",ireg.settings.targetOrigin,"&loginKey=",ireg.settings.loginKey,"&reCaptchaSiteKey=",ireg.settings.reCaptcha.siteKey];if(options.touchpoint){url.push("&touchpoint=",options.touchpoint);}if(options.scenario){url.push("&scenario=",options.scenario);
}return url.join("");},setDisplayRegistrationForm:function(what,options){var style="none";if(!ireg.getIframeUrl(options)){ireg.errorHandler();return;}if(what){ireg.elements.iFrame.src=ireg.getIframeUrl(options);ireg.resetIframe(options);style="block";}ireg.elements.registrationForm.style.display=style;},resetIframe:function(options){var scenario=options.scenario||"login";ireg.elements.iFrame.style.height=ireg.initialIframeDimensions[scenario].height+"px";ireg.elements.iFrame.style.width=ireg.initialIframeDimensions[scenario].width+"px";var margin=(ireg.initialIframeDimensions[scenario].width/2)*-1;ireg.elements.registrationForm.style.marginLeft=margin+"px";},setDisplayOverlay:function(what){ireg.elements.overlay.style.display=what?"block":"none";if(what){$(ireg.elements.overlay).addEvent("click",ireg.handlerCloseLayer);
}else{$(ireg.elements.overlay).removeEvent("click",ireg.handlerCloseLayer);}},errorHandler:function(){ireg.setDisplayRegistrationForm(false);ireg.elements.errorPage.style.display="block";ireg.setDisplayOverlay(true);frameRegistration.elements.errorPage.getElementsByClassName("closeButton")[0].addEvent("click",ireg.handlerCloseLayer);},initPreloader:function(){if(!ireg.isFormMounted){ireg.elements.loadingElement.classList.add("active");}}};window.frameRegistration=ireg;})();