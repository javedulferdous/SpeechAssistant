/**
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Smile ElasticSuite to newer
 * versions in the future.
 *
 * @category  Smile
 * @package   Smile\ElasticsuiteTracker
 * @author    Aurelien FOUCRET <aurelien.foucret@smile.fr>
 * @copyright 2020 Smile
 * @license   Open Software License ("OSL") v. 3.0
 */


var smileTracker=function(){"use strict";function t(t){for(var i=t+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){for(var r=e[n];" "===r.charAt(0);)r=r.substring(1);if(-1!==r.indexOf(i))return r.substring(i.length,r.length)}return null}function i(t,i,e,n){var r="expires="+e.toUTCString();document.cookie=t+"="+i+"; "+r+"; path="+n}function e(t){var i=null;if(t&&t.replace){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search)}return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function n(){this.addPageVar("site",window.location.hostname),this.addPageVar("url",window.location.pathname),this.addPageVar("title",document.title)}function r(){["utm_source","utm_campaign","utm_medium","utm_term"].forEach(function(t){var i=t,n=e(i);n&&this.addPageVar(i,n)}.bind(this))}function o(){if(document.referrer){var t=document.createElement("a");t.href=document.referrer,this.addPageVar("referrer.domain",t.hostname),this.addPageVar("referrer.page",t.pathname)}}function s(){return this.addPageVar("resolution.x",window.screen.availWidth),this.addPageVar("resolution.y",window.screen.availHeight),this}function a(){for(var t=document.getElementsByTagName("meta"),i=0;i<t.length;i++)if(t[i].getAttribute("name")){var e=t[i].getAttribute("name").split(":");if(2===e.length&&"sct"===e[0]){var n=e[1];this.addPageVar(n,t[i].getAttribute("content"))}}}function c(){m.bind(this)(),!1===this.trackerSent&&(n.bind(this)(),o.bind(this)(),r.bind(this)(),a.bind(this)(),s.bind(this)());var t=[];for(var i in this.vars)({}).hasOwnProperty.call(this.vars,i)&&t.push(i+"="+this.vars[i]);return this.baseUrl+"?"+t.join("&")}function d(t){t.setAttribute("style","position: absolute; top: 0; left: 0; visibility: hidden;")}function u(t){if(!1===this.trackerSent||!0===t){var i=document.getElementsByTagName("body")[0];if(this.config&&this.config.hasOwnProperty("sessionConfig")){var e=c.bind(this)(),n=document.createElement("img");n.setAttribute("src",e),n.setAttribute("alt",""),d(n),i.appendChild(n),this.trackerSent=!0,this.vars={}}}}function h(t,i){return this.vars[t]=encodeURIComponent(i),this}function f(t,i){h.bind(this)(g.bind(this)(t,"session"),i)}function l(t,i){h.bind(this)(g.bind(this)(t,"page"),i)}function g(t,i){return i+"["+t.replace(/[.]/g,"][")+"]"}function m(){if(this.config&&this.config.hasOwnProperty("sessionConfig")){var e=this.config.sessionConfig,n=new Date,r=e.path||"/";null===t(e.visit_cookie_name)?(n.setSeconds(n.getSeconds()+parseInt(e.visit_cookie_lifetime,10)),i(e.visit_cookie_name,p(),n,r)):(n.setSeconds(n.getSeconds()+parseInt(e.visit_cookie_lifetime,10)),i(e.visit_cookie_name,t(e.visit_cookie_name),n,r)),null===t(e.visitor_cookie_name)&&(n.setDate(n.getDate()+parseInt(e.visitor_cookie_lifetime,10)),i(e.visitor_cookie_name,p(),n,r)),f.bind(this)("uid",t(e.visit_cookie_name)),f.bind(this)("vid",t(e.visitor_cookie_name))}}var p=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}(),v=function(){this.vars={},this.trackerSent=!1};return v.prototype.sendTag=function(){require(["domReady"],function(t){t(u.bind(this))}.bind(this))},v.prototype.setConfig=function(t){this.config=t,this.baseUrl=t.beaconUrl},v.prototype.addPageVar=function(t,i){l.bind(this)(t,i)},v.prototype.addSessionVar=function(t,i){f.bind(this)(t,i)},new v}();
//# sourceMappingURL=tracking.js.map