var disabledSelectedStore=!1,statusStore="";jQuery((function(){function e(e,r){if(e.is("#orderNumber")){if(!e.val().length)return jQuery(r).closest(".form-group").removeClass("has-error has-success"),!1;/(^[gt]\d{7}$)/gi.test(e.val().trim())?jQuery(r).closest(".form-group").addClass("has-success").removeClass("has-error"):jQuery(r).closest(".form-group").addClass("has-error").removeClass("has-success")}else if(e.is("#invoiceNumber")){if(!e.val().length)return jQuery(r).closest(".form-group").removeClass("has-error has-success"),!1;/(^\d{3,3}[-]\d{5,15}$)/gi.test(e.val().trim())?jQuery(r).closest(".form-group").addClass("has-success").removeClass("has-error"):jQuery(r).closest(".form-group").addClass("has-error").removeClass("has-success")}}function r(){jQuery("#selectStoreSelectric").select2({theme:"classic",placeholder:"Select Store Location",allowClear:!1,minimumResultsForSearch:-1,dropdownCssClass:"price-match-selectric"})}currencyFormatRegex=new RegExp("^([0-9]{1,3},([0-9]{3},)*[0-9]{3}|[0-9]+)(.[0-9][0-9])$"),jQuery("#priceMatchModal").on("shown.bs.modal",(function(e){jQuery("#priceMatchForm").removeClass("hide"),jQuery("#btnSubmitPriceMatchRequest").prop("disabled","disabled"),r();var t=jQuery(e.relatedTarget).attr("data-prod-id"),a=jQuery(e.relatedTarget).attr("data-prod-desc"),u=jQuery(e.relatedTarget).attr("data-prod-userName"),o=jQuery(e.relatedTarget).attr("data-prod-email"),s=jQuery(e.relatedTarget).attr("data-prod-phone"),i=jQuery(e.relatedTarget).attr("data-fprice");!function(e){jQuery.get("/pricematch/findstores?prodId="+e).done((function(e){var r="<option></option>";r+="<option value='-1'>Parcel Shipping</option>";var t=!0,a=!1;jQuery.each(e,(function(e,u){u.statusMessage.indexOf("Out of Stock")>-1?r+="<option disabled value='"+u.statusCode+"'>"+u.statusMessage+"</option>":u.statusMessage.indexOf("esd product")>-1?(t=!1,a=!0):(r+="<option  value='"+u.statusCode+"'>"+u.statusMessage+"</option>",t=!1),jQuery("#selectStoreSelectric").find("option[value]").remove(),jQuery("#selectStoreSelectric").append(r)})),t&&jQuery("#selectStoreSelectric > option").each((function(){"-1"==this.value&&(jQuery(this).prop("disabled",!0),jQuery(this).text("Parcel Shipping -- Out of Stock"))})),a&&jQuery("#selectStoreSelectric > option").each((function(){"Parcel Shipping"==this.text&&jQuery(this).attr("selected","selected")}))}))}(t),function(e){null!=e&&null!=e&&(jQuery("#frysProductNumber").val(""+e),jQuery("#frysPlu").val(""+e),jQuery("#frysProductNumberStatic").text(e))}(t),function(e){null!=e&&null!=e&&jQuery("#frysItemDescription").val(""+e)}(a),function(e,r,t){null!=e&&null!=e&&jQuery("#fullName").val(""+e.trim()),null!=r&&null!=r&&(jQuery("#contactEmail").val(""+r),jQuery("#contactConfirmEmail").val(""+r)),null!=t&&null!=t&&jQuery("#contactPhoneNumber").val(""+t)}(u,o,s),function(e){null!=e&&null!=e&&jQuery("#productOriginalPrice").val(""+e)}(i),jQuery("#btnSubmitPriceMatchRequest").find(".fas").remove(),jQuery("#btnSubmitPriceMatchRequest").text("Submit Request")})),jQuery("#priceMatchModal").on("hidden.bs.modal",(function(e){jQuery("#btnSubmitPriceMatchRequest").prop("disabled","disabled"),jQuery("#selectStoreSelectric").val("").trigger("change"),t.resetForm(),jQuery("#btnSubmitPriceMatchRequest").prop("disabled","disabled"),jQuery("#priceMatchForm").find(".form-group").removeClass("has-success has-error"),jQuery(".flash-message-wrapper").addClass("hide"),jQuery("#priceMatchForm").find(".form-control").val("")})),jQuery("#contactPhoneNumber").keyup((function(){if(jQuery(this).val().length){let e=jQuery(this).val().split("-").join("");e=e.match(new RegExp(".{1,4}$|.{1,3}","g")).join("-"),jQuery(this).val(e)}})),jQuery.validator.addMethod("alphanumeric",(function(e,r){return!!/^\d{10}$/i.test(e.split("-").join(""))}),"Not a valid phone number. Phone number must have 10 digits and should be numeric"),jQuery.validator.addMethod("validateUrl",(function(e,r){return/^(http(s)?:\/\/)?(www\.)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/i.test(e.trim())})),jQuery.validator.addMethod("orderNumberRegex",(function(e,r){return/(^[gt]\d{7}$)/gi.test(e.trim())})),jQuery.validator.addMethod("invoiceNumberRegex",(function(e,r){return/(^\d{3,3}[-]\d{5,15}$)/gi.test(e.trim())})),jQuery.validator.addMethod("currencyFormatValidator",(function(e,r){var t=parseFloat(e.trim().split(",").join()),a=jQuery("#productOriginalPrice").val(),u=!(isNaN(t)||t>=a);return/^([0-9]{1,3},([0-9]{3},)*[0-9]{3}|[0-9]+)(.[0-9][0-9])?$/.test(e.trim())&&u}),(function(e,r){return"Please enter valid price. Price should be positive and less than $"+parseFloat(jQuery("#productOriginalPrice").val()).toFixed(2)})),jQuery.validator.addMethod("numericOnly",(function(e,r){return/^\d+$/.test(e.trim())}));var t=jQuery("#priceMatchForm").validate({ignore:".ignore",rules:{selectStoreSelectric:{required:function(){return!("select-store-placeholder"!=jQuery("#selectStoreSelectric").find(":selected").attr("id")&&!jQuery("#selectStoreSelectric").find(":selected").is(":disabled"))}},orderNumber:{required:!1},invoiceNumber:{required:!1},fullName:{required:!0,normalizer:function(e){return jQuery.trim(e)}},frysProductNumber:{required:!0,numericOnly:!0},competitorName:{required:!0,normalizer:function(e){return jQuery.trim(e)}},competitorWebPath:{required:!0,validateUrl:!0},competitorProductPrice:{required:!0,currencyFormatValidator:!0,min:.01},contactConfirmEmail:{required:!0,equalTo:"#contactEmail",maxlength:100,normalizer:function(e){return jQuery.trim(e)}},contactEmail:{required:!0,email:!0,maxlength:100,normalizer:function(e){return jQuery.trim(e)}},contactPhoneNumber:{required:!0,maxlength:12,alphanumeric:!0}},messages:{fullName:"Name cannot be empty",competitorName:"Competitor name cannot be empty",orderNumber:{orderNumberRegex:"Invalid order number format",require_from_group:"Either Order number or Invoice number required"},invoiceNumber:{require_from_group:"Either Order number or Invoice number required",invoiceNumberRegex:"Invalid invoice format."},competitorWebPath:{required:"Competitor URL cannot be empty",validateUrl:"Not a valid web URL"},contactEmail:{required:"Email cannot be empty",email:"Email is incorrect",maxlength:"* Email address should not be more than 100 characters."},contactConfirmEmail:{required:"Email cannot be empty",equalTo:"Email address must match",maxlength:"* Email address should not be more than 100 characters."},contactPhoneNumber:{required:"Phone number cannot be empty",maxlength:"Not a valid phone number. Phone number must have 10 digits and should be numeric"},selectStoreSelectric:{required:"Please select store location"},competitorProductPrice:{required:"Price cannot be empty",min:"Price cannot be 0"},frysProductNumber:{required:"Fry's product id cannot be empty",numericOnly:"Invalid product number"}},errorElement:"em",errorPlacement:function(e,r){var t=jQuery(r);e.addClass("help-block"),t.hasClass("has-input-group")?e.insertAfter(r.parent()):t.hasClass("select2-hidden-accessible")?(r=jQuery("#select2-"+t.attr("id")+"-container").parent().parent().parent(),e.insertAfter(r)):e.insertAfter(r),console.log(e)},highlight:function(r,t,a){var u=jQuery(r);u.hasClass("select2-hidden-accessible")?jQuery("#select2-"+u.attr("id")+"-container").closest(".form-group").addClass("has-error").removeClass("has-success"):u.hasClass("orderInvoiceGroup")?e(u,r):jQuery(r).closest(".form-group").addClass("has-error").removeClass("has-success")},unhighlight:function(r,t,a){var u=jQuery(r);u.hasClass("select2-hidden-accessible")?jQuery("#select2-"+u.attr("id")+"-container").closest(".form-group").addClass("has-success").removeClass("has-error"):u.hasClass("orderInvoiceGroup")?e(u,r):jQuery(r).closest(".form-group").addClass("has-success").removeClass("has-error")},success:function(){a("#priceMatchForm")},submitHandler:function(e,t){if(t.preventDefault(),!jQuery("#orderNumber").val().length&&!jQuery("#invoiceNumber").val().length&&2==jQuery("#requestTypeSelectric").find(":selected").val())return jQuery("#orderNumber,#invoiceNumber").rules("add",{require_from_group:[1,".orderInvoiceGroup"]}),a("#priceMatchForm"),jQuery("#orderNumber").focus(),setTimeout((function(){jQuery("#orderNumber,#invoiceNumber").closest(".form-group").addClass("has-error")}),1),!1;!function(e){var t=jQuery(e).attr("action"),u={};u.email=jQuery.trim(jQuery("#contactEmail").val()),u.fullName=jQuery.trim(jQuery("#fullName").val()),u.phoneNum=jQuery.trim(jQuery("#contactPhoneNumber").val()),u.orderNumber=jQuery.trim(jQuery("#orderNumber").val()),u.invoiceNumber=jQuery.trim(jQuery("#invoiceNumber").val()),u.prodId=jQuery.trim(jQuery("#frysPlu").val()),u.competitorName=jQuery.trim(jQuery("#competitorName").val()),u.competitorURL=jQuery.trim(jQuery("#competitorWebPath").val()),u.competitorPrice=jQuery.trim(jQuery("#competitorProductPrice").val()),u.message=jQuery.trim(jQuery("#messageDescription").val()),u.requestType="1",u.storeNum=jQuery.trim(jQuery("#selectStoreSelectric").val()),u.upc=jQuery.trim(jQuery("#frysProductNumber").val()),u.frysItemDescription=jQuery.trim(jQuery("#frysItemDescription").val()),jQuery("#priceMatchForm").find(".error-message").remove();var o=jQuery.ajax({type:"POST",url:t,data:u,dataType:"json",beforeSend:function(){jQuery("#btnSubmitPriceMatchRequest").find(".fas").remove(),jQuery("#btnSubmitPriceMatchRequest").text("Submitting "),jQuery("#btnSubmitPriceMatchRequest").append("<span class='fas fa-spinner fa-spin' aria-hidden='true' style='font-style:normal'></span>"),jQuery("#btnSubmitPriceMatchRequest").prop("disabled","disabled")}});o.done((function(e){if(jQuery("#btnSubmitPriceMatchRequest").find(".fas").remove(),jQuery("#btnSubmitPriceMatchRequest").text("Submit Request"),null!=e&&null!=e&&200==e.statusCode)jQuery("#req-id-con").html(e.statusMessage),jQuery("#priceMatchForm").addClass("hide"),jQuery("#price-match-success").removeClass("hide");else if(null!=e&&null!=e&&400==e.statusCode)jQuery("#req-error-msg").html(e.statusMessage),jQuery("#priceMatchForm").addClass("hide"),jQuery("#price-match-error").removeClass("hide");else if(null!=e&&null!=e&&429==e.statusCode){a("#priceMatchForm");var t="Unable to process your request. Please try again after some time";jQuery("<div class='alert alert-danger error-message'>"+t+"</div>").insertAfter("#price-match-extended-form")}else{a("#priceMatchForm"),""!=(t=e.statusMessage)&&null!=t||(t="Unable to process request. Please verify entered information and try again."),-1==e.statusCode&&(t="No inventory available for this product."),jQuery("<div class='alert alert-danger error-message'>"+t+"</div>").insertAfter("#price-match-extended-form"),""==e.statusCode&&null==e.statusCode||(-1==e.statusCode?(jQuery("#selectStoreSelectric option").prop("disabled",!0),jQuery("#selectStoreSelectric").select2("destroy"),r(),a("#priceMatchForm")):(statusStore=e.statusCode,disabledSelectedStore=!0,jQuery("#selectStoreSelectric option[value="+e.statusCode+"]").attr("disabled",!0),jQuery("#selectStoreSelectric").select2("destroy"),r(),a("#priceMatchForm")))}})),o.fail((function(e){jQuery("#btnSubmitPriceMatchRequest").find(".fas").remove(),jQuery("#btnSubmitPriceMatchRequest").text("Submit Request"),a("#priceMatchForm");var r="";null!=e&&null!=e&&e.statusMessage,""!=r&&null!=r||(r="Unable to process request. Please verify entered information and try again."),jQuery("<div class='alert alert-danger error-message'>"+r+"</div>").insertAfter("#price-match-extended-form")}))}(e)}});jQuery("#priceMatchForm").on("blur","select",(function(e){a("#priceMatchForm")})),jQuery("#priceMatchForm .form-control").on("blur input change",(function(e){a("#priceMatchForm")})),jQuery("#priceMatchForm textarea.ignore").on("blur input",(function(e){jQuery(e.target).val().length?jQuery(".textarea-error-msg").length&&(jQuery(e.target).closest(".form-group").addClass("has-success"),jQuery(e.target).closest(".form-group").removeClass("has-error"),jQuery(e.target).closest(".form-group").find(".textarea-error-msg").remove()):(jQuery(e.target).closest(".form-group").removeClass("has-success"),jQuery(e.target).closest(".form-group").addClass("has-error"),jQuery(".textarea-error-msg").length||jQuery(e.target).closest(".form-group").append('<div class="textarea-error-msg help-block">Please enter a message</div>')),a("#priceMatchForm")})),jQuery("#orderNumber, #invoiceNumber").on("keyup",(function(e){jQuery("#orderNumber").val().length||jQuery("#invoiceNumber").val().length||jQuery("#orderNumber,#invoiceNumber").rules("add",{require_from_group:[1,".orderInvoiceGroup"]}),"orderNumber"==jQuery(e.target).attr("id")&&(jQuery("#orderNumber").val().length?(jQuery("#orderNumber").rules("add",{orderNumberRegex:!0}),jQuery("#invoiceNumber").rules("remove","invoiceNumberRegex")):jQuery("#orderNumber").rules("remove","orderNumberRegex")),"invoiceNumber"==jQuery(e.target).attr("id")&&(jQuery("#invoiceNumber").val().length?(jQuery("#invoiceNumber").rules("add",{invoiceNumberRegex:!0}),jQuery("#orderNumber").rules("remove","orderNumberRegex")):jQuery("#invoiceNumber").rules("remove","invoiceNumberRegex"))})),jQuery("body").on("click","#resetPriceMatchForm",(function(e){jQuery("#selectStoreSelectric").val("").trigger("change"),t.resetForm(),jQuery("#btnSubmitPriceMatchRequest").prop("disabled","disabled"),jQuery("#priceMatchForm").find(".form-group").removeClass("has-success has-error")})),jQuery(".input-group > input").focus((function(e){jQuery(this).parent().addClass("input-group-focus")})).blur((function(e){jQuery(this).parent().removeClass("input-group-focus")}));function a(e){jQuery(e).validate().checkForm()&&jQuery("#priceMatchForm textarea.ignore").val().length&&(!jQuery("#previousPurchaseContainer").is(":visible")||jQuery("#orderNumber").val().length>1||jQuery("#invoiceNumber").val().length>1)?(jQuery("#btnSubmitPriceMatchRequest").prop("disabled",!1),jQuery("#btnSubmitPriceMatchRequest").find(".fas").remove()):jQuery("#btnSubmitPriceMatchRequest").prop("disabled","disabled")}jQuery("#frysProductNumber").change((function(e){var r=jQuery("#frysPlu").val(),t=jQuery(this).val();null!=t&&t.length<=8&&t!=r&&jQuery.get("/template/inc/price/pricematchreq.jsp",{prodId:t})})),jQuery("#selectStoreSelectric").change((function(){""!=statusStore&&(jQuery("#selectStoreSelectric > option").each((function(){"Parcel Shipping"==this.text&&jQuery(this).attr("selected","selected")})),jQuery("#selectStoreSelectric > option").each((function(){parseInt(this.value)==parseInt(statusStore)&&(jQuery(this).attr("disabled","disabled"),statusStore="")})))}))}));