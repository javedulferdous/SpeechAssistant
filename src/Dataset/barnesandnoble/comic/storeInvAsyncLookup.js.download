/*! BARNES-BUILDER 2020-10-06 */
function recursively_ajax(a,b,c){for(var d=[],e=a;b>=e;e++){var f=$($(".ean-nos")[e]).val();""==!f&&(d.push(f),availabilityCode[f]=$($(".ean-nos")[e]).data("availability"))}$.ajax({type:"POST",url:webContextRoot+"/bopis/check-bopis-eligibility.jsp",datatype:"json",data:{eanArray:d.toString()}}).done(function(d){if(d){var e,f,g=JSON.parse(d);if(g.length>1?(e=g[0],f=g[1]):e=g,e&&e.message){for(var h=a;b>=h;h++)$($(".plp-bopis-badge")[h]).removeClass("hidden").attr("aria-hidden","false");heightCalculation()}else e&&showAvailability(e,a,b,c,f)}}).always(function(){c&&"undefined"!=typeof performance.mark&&"undefined"!=typeof performance.measure&&(performance.mark("Search_bopis_functionality_loading_ends"),performance.measure("SearchBopisDur","Search_bopis_functionality_loading_starts","Search_bopis_functionality_loading_ends"))})}function showAvailability(a,b,c,d,e){for(var f="",g="",h=b;c>=h;h++){if(void 0!=a.items[h%itemsPerRequest]){var i=availabilityCode[a.items[h%itemsPerRequest].ean],j=$($(".plp-bopis-badge")[h]);!$.isEmptyObject(availabilityCode)&&a.items[h%itemsPerRequest].available&&1!=i&&(f="icon-check",g="In Stock at My Store",bopisDisplayBadge(j,f,g),e?a.items[h%itemsPerRequest].eligible&&e[a.items[h%itemsPerRequest].ean]===!1?(f="icon-check",g="Store Pickup Available",bopisDisplayBadge(j,f,g)):(f="icon-close-modal",g="Store Pickup Unavailable",bopisDisplayBadge(j,f,g)):a.items[h%itemsPerRequest].eligible?(f="icon-check",g="Store Pickup Available",bopisDisplayBadge(j,f,g)):(f="icon-close-modal",g="Store Pickup Unavailable",bopisDisplayBadge(j,f,g))),$.isEmptyObject(availabilityCode)||a.items[h%itemsPerRequest].available||1==i||(f="icon-close-modal",g="Not in Stock at My Store",bopisDisplayBadge(j,f,g))}j.removeClass("hidden").attr("aria-hidden","false")}heightCalculation()}function bopisDisplayBadge(a,b,c){var d='<div class="availability-spacing flex"><div class="bopis-icon"><span class="'+b+'"></span></div><p class="ml-xxs bopis-badge-message mt-0 mb-0">'+c+"</p></div>";a.append(d)}function changeCheckboxPlp(){$("#bopisPlpRibbon").on("change",function(){var a=$("#plpRibbonText").html();if($("#bopisPlpRibbon").is(":checked")){if("undefined"!=typeof s_setP){var b=getAnalyticsEventCount();s_setP("digitalData.event["+b+"].eventInfo.eventName","BOPIS Filter Selected"),s_setP("digitalData.event["+b+"].eventInfo.eventAction","bopisFilterSelected"),s_setP("digitalData.event["+b+"].eventInfo.timeStamp",""+new Date),s_setP("digitalData.event["+b+"].category.primaryCategory","Buy Online Pay In Store"),_satellite.track("onBopisFilterSelected")}if($("#checkBoxValue").attr("value","true"),$("#plpRibbonText").html(a.replace("View","Viewing")),$(".bopis-nook-badge, .availability").removeClass("hidden").attr("aria-hidden","false"),1===$($(".plp-bopis-badge")[0]).children().length)for(var c=Math.ceil(Number(Number($("#totalItemsShown").val())-Number($("#startItemsShown").val())-Number($("#bopisUnavailableCount").val())+1)/itemsPerRequest),d=0;c>d;d++){var e=d==c-1?!0:!1;recursively_ajax(d*itemsPerRequest,d*itemsPerRequest+(itemsPerRequest-1),e)}else $(".plp-bopis-badge").removeClass("hidden").attr("aria-hidden","false");$(".loading-info").html("Item Availability Badge loaded")}else $("#checkBoxValue").attr("value","false"),$("#plpRibbonText").html(a.replace("Viewing","View")),$(".bopis-nook-badge, .plp-bopis-badge, .availability").addClass("hidden").attr("aria-hidden","true"),$(".loading-info").html("Item Availability Badge removed"),heightCalculation();$("#bopisPlpRibbonForm").submit()});var a=$("#searchKey").val();""!=a&&null!=a&&$("#bopisPlpRibbon").click()}function showBadgesAfterAjaxPlp(){$(".bopis-nook-badge, .availability").removeClass("hidden").attr("aria-hidden","false");for(var a=Math.ceil(Number(Number($("#totalItemsShown").val())-Number($("#startItemsShown").val())-Number($("#bopisUnavailableCount").val())+1)/itemsPerRequest),b=0;a>b;b++){var c=b==a-1?!0:!1;recursively_ajax(b*itemsPerRequest,b*itemsPerRequest+(itemsPerRequest-1),c)}$(".loading-info").html("Store Availability loaded")}var itemsPerRequest=Number($("#itemsPerRequest").val()),availabilityCode=new Object;