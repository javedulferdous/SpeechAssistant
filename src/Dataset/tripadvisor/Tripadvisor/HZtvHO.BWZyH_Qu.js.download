(this.$WP=this.$WP||[]).push(["HZtvHO",(e,t)=>{"use strict";var a,r,i,n,o,s,l,c,d,p,v,u,T,S,m,C,g,b,E,I,_,k,f,y,h,O,A,j,M,P,R,L,N,w,x,V,D,F,U,G,W;function X(e,t){if(null==e)return{};var a,r,i={},n=Object.keys(e);for(r=0;r<n.length;r++)a=n[r],t.indexOf(a)>=0||(i[a]=e[a]);return i}var q=(e,t)=>{var a,r,i;if(!t)return e;var n=(null==(a=e.paginatedTrips)?void 0:a.trips)||[],o=(null==(r=t.paginatedTrips)?void 0:r.trips)||[];return{paginatedTrips:e.paginatedTrips?{trips:[...n,...o],hasMore:!!(null==(i=t.paginatedTrips)?void 0:i.hasMore),__typename:e.paginatedTrips.__typename}:t.paginatedTrips,savedTrips:e.savedTrips}},Q=e=>{var t;return{__typename:e.__typename,id:e.id||0,title:e.title||void 0,status:e.status||void 0,photoId:e.photoId||void 0,photo:e.photo||{},route:{url:e.route&&e.route.url||void 0},actionPermissions:{canAddItem:!!(null==(t=e.actionPermissions)?void 0:t.canAddItem)}}},B=e=>{var t,{saveObject:o,overlayState:s,validateTripName:l,lastSavedItem:c,trackingContext:p,trackingSource:v}=e,u=X(e,["saveObject","overlayState","validateTripName","lastSavedItem","trackingContext","trackingSource"]),[m,C]=i(!0),{fetching:b,error:E,data:I,hasMore:_,loadMore:f}=(e=>{var t,r,i,n,o,s,l,c=(t,a)=>{if(!t||!a)return"invalidateAndRefetch";var{originalObject:r}=e;return r&&a===r.type&&t===String(r.id)||a===e.type&&t===String(e.id)?"invalidateAndRefetch":"validate"},{userId:d}=a(g),p={offset:0,limit:10,userId:d||"",reference:T(e),loadSavedTrips:!0},[v,u]=N({query:x,variables:p,combineData:q,showFetchingAfterFirstQuery:!0,invalidationPredicates:{createTrip:()=>"invalidateAndRefetch",cloneTrip:()=>"invalidateAndRefetch",tripsDelete:()=>"invalidateAndRefetch",addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>c(e,t),moveTripItem:({variables:{reference:e}})=>c(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveItem:({variables:{reference:e}})=>c(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>c(null==e?void 0:e.id,null==e?void 0:e.type)}}),S=k("trips_skip_check_whitelist_public_trips"),[m]=D({query:V,variables:{},pause:S}),C=(null==(t=v.data)||null==(r=t.paginatedTrips)?void 0:r.trips)||[],b=C.slice().filter(Boolean).map(Q),E=!!(null==(i=v.data)||null==(n=i.paginatedTrips)?void 0:n.hasMore),I=(null==(o=v.data)?void 0:o.savedTrips)||[],_=new Set(I.map(e=>null==e?void 0:e.id).filter(Boolean)),f=E?()=>u({offset:(null==C?void 0:C.length)||0,loadSavedTrips:!1}):()=>Promise.resolve(),y=S||(null==(s=m.data)||null==(l=s.authzInfo)?void 0:l.canMakePublicTrip);return{fetching:v.fetching||m.fetching,error:!!v.error,data:{tripList:b,saveSet:_,canMakePublicTrip:y},hasMore:E,loadMore:f}})(o);b?t=r(j,{size:"large"}):E&&(t=r(L,{refetch:f})),n(()=>{b||C(!1)},[]);var[y]=d({source:v||"trips",trackingContext:p,pageAsContext:!0,withSaveSession:!0}),h=()=>{u.onClose(),C(!0)},M=F[s](o.type),P=r(A,{iconName:k("trips_heart_icon")?"heart":"suitcase",displayType:"LEFT_ALIGN_GRAY"},M);return r(R,{element:"bundleSave"===o.type?"copyTripModal":"saveTripModal"},r(O,{header:P,closeIconColor:"BLACK",bodyProps:{isFullBleed:!0},onClose:h},t&&m?r("div",{className:"_1ZX8j9so"},t):(()=>{var e=c?S(c):void 0,a=()=>r("div",{className:"_2VvuVGxR"},r(U,{gate:()=>Promise.resolve(),object:o,onMount:()=>{b||E||y({elementClick:{element:"createTrip"}})},onAddedToCreatedTrip:e=>{u.statCallback("ADD","NEW",e,!0,!0),h()},onError:u.onError,canMakePublicTrip:I.canMakePublicTrip,validateTripName:l,trackingContext:p,trackingSource:v}));switch(s){case"DEFAULT":return 0===I.tripList.length?a():r(W,{tripList:I.tripList,savedSet:I.saveSet,tripListBottom:t,onPaginate:f,hasMore:_,saveObject:o,onMount:()=>{u.preventInteractionInMountedComponents||y({elementClick:{element:"stat"}})},onCreateTrip:()=>{u.onCreateTripClicked&&u.onCreateTripClicked()},tripAction:"SAVE",onRemovedFromTrip:(e,t,a)=>{u.statCallback("REMOVE","EXISTING",e,t,a),h()},onSavedToTrip:(e,t,a)=>{u.statCallback("ADD","EXISTING",e,t,a),h()},onError:u.onError,trackingContext:p,trackingSource:v});case"CREATE":return a();case"SELECT":return e?r(W,{tripList:I.tripList,savedSet:I.saveSet,tripListBottom:t,onPaginate:f,hasMore:_,saveObject:e,onMount:()=>{y({elementClick:{element:"stat"}})},onCreateTrip:()=>{u.onSelectCreateTripClicked&&u.onSelectCreateTripClicked()},tripAction:"MOVE",onMovedToTrip:(e,t,a)=>{u.statCallback("MOVE","EXISTING",e,t,a),h()},onRemovedFromTrip:(e,t,a)=>{u.statCallback("REMOVE","EXISTING",e,t,a),h()},onError:u.onError,trackingContext:p,trackingSource:v}):"";case"SELECT_CREATE":return c?r("div",{className:"_2VvuVGxR"},r(G,{gate:()=>Promise.resolve(),item:c,onMovedToCreatedTrip:e=>{u.statCallback("MOVE","NEW",e,!0,!0),h()},canMakePublicTrip:I.canMakePublicTrip})):a();default:return""}})()))},H=(e,t)=>{switch(t.type){case"setOverlayState":return Object.assign({},e,{overlayState:t.state});case"afterSave":return Object.assign({},e,{overlayState:"DEFAULT",preventInteractionInMountedComponents:!0});default:throw new Error}},z=e=>{var t,{logInteraction:c,object:d,active:p,preventInteractionPropagation:u,trackingContext:T,trackingSource:S,resaveTrip:m,saveObject:b,saveStatus:E,updateLastTripId:I,initialOverlayState:_}=e,k=X(e,["allowPopStatModal","logInteraction","puid","object","active","preventInteractionPropagation","trackingContext","trackingSource","resaveTrip","saveObject","saveStatus","updateLastTripId","onClose","initialOverlayState"]),{userId:h}=a(g),{launchViewTripToast:O,launchRemoveFromTripToast:A,launchErrorTripToast:j}=C(),{getTripErrorMessage:M}=f(),P=y("SAVE_TO_TRIP_INTENT"),R=y("SAVE_TO_TRIP"),L=y({type:"CREATE_TRIP",payload:{user_id:h||""}}),N=a(v),[w,x]=o(H,{overlayState:_||"DEFAULT",preventInteractionInMountedComponents:!1}),V=s(!0);n(()=>()=>{V.current=!1},[]);var{onComplete:D}=k,F=l(e=>{D&&D(e),N.resetSession()},[D,N]),U=l((e,t)=>{e&&!t?(O(e,"SAVED",()=>{c({elementClick:{element:"saved_viewTrip"}})}),F(!0)):t&&(j(t),F(!1)),V.current&&x({type:"setOverlayState",state:"DEFAULT"}),c({elementClick:{element:"unsave_undo"}})},[O,F,j,c]),G=l(e=>{A(e,b,U)},[A,U,b]),W=l(e=>{j(e)},[j]),[q,Q]=i(!1),z=l(()=>{Q(!0),N.resetSession()},[N]),Z=l((e,t)=>{"CREATED"===t&&(R(),L()),V.current&&x({type:"afterSave"}),O(e,t,()=>{c({elementClick:{element:"saved_viewTrip"}})}),I(e.id),F(!0)},[R,O,F,I,L,c]);return!q&&r("div",{className:"stat_wrapper",onClick:e=>{e.stopPropagation(),e.preventDefault(),!u&&h&&c({elementClick:{element:"item_save",tripId:null==m?void 0:m.id}}),p||P()}},r(B,{saveObject:b,overlayState:w.overlayState,lastSavedItem:null==(t=E.result)?void 0:t.tripItem,trackingContext:T,trackingSource:S,onCreateTripClicked:()=>{V.current&&x({type:"setOverlayState",state:"CREATE"})},onSelectCreateTripClicked:()=>{V.current&&x({type:"setOverlayState",state:"SELECT_CREATE"})},onClose:z,onError:W,preventInteractionInMountedComponents:w.preventInteractionInMountedComponents,statCallback:(e,t,a,r,i)=>{"REMOVE"===e?(G(a),F(i)):"NEW"===t?Z(a,"CREATED"):r&&Z(a,"SAVED")},validateTripName:e=>{if("bundleSave"===b.type&&e.trim().toLowerCase()===d.title.trim().toLowerCase())return M("COPY_TRIP",{type:"INVALID_VALUE",field:"TITLE"})}}))},Z=e=>k("trips_bookmark")?r(p,null,r(h,null,r(z,e))):null,J=["Profile","HomeFeed","Trips","Home"],K=e=>{var{children:t}=e,i=X(e,["children"]),o=c(()=>i.saveObject||S(i.object,!0),[i.saveObject,i.object]),T=(e=>{var t=c(()=>e.saveObject||S(e.object,!0),[e.saveObject,e.object]),{resaveTrip:i,onComplete:o,allowPopStatModal:p}=e,{isNativeWebview:T}=e,m=X(e,["isNativeWebview"]),{launchAutoSavedToTripToast:g,launchErrorTripToast:f}=C(),[y]=a(b),{page:h}=y,O=c(()=>({source:e.trackingSource||"trips",saveObject:t,trackingContext:e.trackingContext,withSaveSession:!0,pageAsContext:!0}),[e.trackingContext,e.trackingSource,t]),[A,j]=d(O),M=a(v),[P,R,L]=E(t,e.active),N=null==t?void 0:t.id,w=null==t?void 0:t.type,x=l(e=>{f(e)},[f]),V=l(()=>{A({elementClick:{element:"ITEM_SAVE_LOGIN",context:h&&u(h)||void 0,puid:j,saveType:w,detailId:N?""+N:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:M.sessionUuid,sessionOrder:M.sessionOrder}})},[A,h,j,i,N,w,M.sessionOrder,M.sessionUuid]),D=l(()=>{A({modalSuccess:{element:"ITEM_SAVE_LOGIN",context:h&&u(h)||void 0,puid:j,saveType:w,detailId:N?""+N:"",tripId:null==i?void 0:i.id,sessionType:"SAVE",sessionUuid:M.sessionUuid,sessionOrder:M.sessionOrder}})},[A,h,j,i,N,w,M.sessionOrder,M.sessionUuid]),F=c(()=>({pid:h&&J.includes(y.page)?40439:39766,flow:T?"NATIVE_LOGIN":"SAVES_COMBINED",onLogin:V,onSuccess:D,isFullWidthMobile:!0}),[V,D,h,y.page,T]),U=I(F),G=s(!1),{open:W}=_(()=>t?r(Z,Object.assign({},m,{logInteraction:A,puid:j,saveObject:t,saveStatus:P,updateLastTripId:L})):null),{open:q}=_(()=>t?r(Z,Object.assign({},m,{initialOverlayState:"SELECT",logInteraction:A,puid:j,saveObject:t,saveStatus:P,updateLastTripId:L})):null),Q=c(()=>y.params.popStat||!1,[y.params]),B=l(()=>!!p&&Q&&k("trips_pop_stat_modal"),[p,Q]);return n(()=>{B()&&!G.current&&(G.current=!0,A({elementClick:{element:"autoPopStat"}}),U().then(W))},[A,U,W,B]),l(()=>{U().then(()=>R()).then(([e,t])=>{null!==e||null!==t?t?x({query:"ADD_ITEM_TO_TRIP",tripsError:t}):e&&(g(e,()=>{q(),A({elementClick:{element:"quickSave_change"}})}),A({modalSuccess:{element:"quickSave",tripId:null==i?void 0:i.id,context:h&&u(h)||void 0,saveType:w,detailId:N?""+N:""}}),o&&o(!0)):W()})},[W,q,g,A,U,o,x,R,h,i,N,w])})(i);return o?r(p,null,t(T)):null},Y=({saveObject:e,object:t,queryObject:o,preventInteractionPropagation:s,trackingContext:l,trackingSource:c,children:d,trip:p,allowPopStatModal:v,onComplete:u,isNativeWebview:T})=>{var S,m,C,b,E,[I,_]=i((null==t||null==(S=t.object)?void 0:S.socialStatistics)?!!(null==t||null==(m=t.object)||null==(C=m.socialStatistics)?void 0:C.isSaved):!!(null==t||null==(b=t.socialStatistics)?void 0:b.isSaved)),k=(e,t)=>{if(!e||!t)return"invalidateAndRefetch";var{originalObject:a}=o;return a&&t===a.type&&e===String(a.id)||t===o.type&&e===String(o.id)?"invalidateAndRefetch":"validate"},{userId:f}=a(g);E=f?(null==t?void 0:t.socialStatistics)?"afterInvalidation":"immediately":"never";var[{fetching:y,data:h,error:O}]=w({query:o.query,variables:o.variables,executeWhen:E},{addItemToTrip:({variables:{referenceId:e,referenceType:t}})=>k(e,t),tripsRemoveItem:({variables:{reference:e}})=>k(null==e?void 0:e.id,null==e?void 0:e.type),tripsRemoveReference:({variables:{reference:e}})=>k(e.id,null==e?void 0:e.type)});return n(()=>{if(!y&&!O){var e=h&&h.savesObjects&&h.savesObjects[0];if(e){var{id:t,socialStatistics:a={}}=e,r=(t===o.id||String(t)===o.id)&&!!a.isSaved;r!==I&&_(r)}}},[y,h,O]),r(K,{saveObject:e,object:t,active:I,preventInteractionPropagation:s,trackingContext:l,trackingSource:c,resaveTrip:p,allowPopStatModal:v,onComplete:u,isNativeWebview:T},e=>d(e,I,y))},$=e=>{if(!k("trips_bookmark"))return null;var t=e.saveObject||S(e.object,!0);if(!t)return console.error("An invalid saves object was passed to QueriedTripFlowSelector"),null;var a=m(t);return a?r(Y,Object.assign({},e,{queryObject:a})):(console.error("Unsupported saves object was passed to QueriedTripFlowSelector"),null)};return[()=>{F=Object.freeze({DEFAULT:e=>r(M,"bundleSave"!==e?{id:"stat_modal_save_to_trip_v2"}:{id:"save_all_items_modal_header"}),CREATE:()=>r(M,{id:"stat_modal_create_a_trip_v2"}),SELECT:()=>r(M,{id:"select_trip_header"}),SELECT_CREATE:()=>r(M,{id:"stat_modal_create_a_trip_v2"})}),U=P.onUsage(()=>t("neHaXV"),"CreateTripWithAddItemModal",r("div",{className:"_1ZX8j9so"},r(j,{size:"large"}))),G=P.onUsage(()=>t("neHaXV"),"CreateTripWithMoveItemModal",r("div",{className:"_1ZX8j9so"},r(j,{size:"large"}))),W=P.onUsage(()=>t("pBQaod"),"SaveToTripContent",r("div",{className:"_1ZX8j9so"},r(j,{size:"large"}))),z.defaultProps={preventInteractionPropagation:!1,onComplete:void 0,trackingContext:void 0,allowPopStatModal:!1},$.defaultProps={object:null,trackingContext:void 0,allowPopStatModal:!1},e({QueriedTripFlowSelector:$,TripFlowSelector:K})},[e=>(a=e.useContext,r=e.createElement,i=e.useState,n=e.useEffect,o=e.useReducer,s=e.useRef,l=e.useCallback,c=e.useMemo),e=>(d=e.useTripInteraction,p=e.SaveSessionProvider,v=e.SaveSessionTrackingContext,u=e.getInteractionsContext),e=>(T=e.toReference,S=e.toSavesObject,m=e.objectStatisticQuery),e=>C=e.default,e=>(g=e.Visitor,b=e.Route),e=>E=e.useAutosave,e=>I=e.useSocialLoginGate,e=>_=e.useVDOMPortal,e=>k=e.featureIsEnabled,e=>f=e.useLocalizeTripError,e=>y=e.usePixelCallback,e=>h=e.ToastProvider,e=>O=e.default,e=>A=e.TitleBar,e=>j=e.LoadingSpinner,e=>M=e.default,e=>P=e.component,e=>R=e.TripsImpression,e=>L=e.default,e=>(N=e.usePaginatedQuery,w=e.useInvalidatableQuery),e=>(x=e.TripDetailStatQuery,V=e.GetUserAuthZInfo),e=>D=e.useQuery]]},["cDcdfi","U-DhDC","eFKnUp","PiTJFd","2R4xv2","fTyhRT","JFHNGL","vq6MSq","-i3PJS","9I0t-6","jb_4W2","Q7TAd7","O8LbtK","6nM-E7","V08PS7","0DsHEV","pLbCP4","c_rvp5","LFeTN6","OnmvvE","RXx5aI","5X2em-"]]);
