define(['jquery','mage/mage','jquery/ui','mage/validation'],function($){console.log("==Corra ajax newsletter ==");$.widget("corra.ajaxnewsletter",{_init:function(){thisElem=this.element;this.bindEvents();this.popupForm();},popupForm:function(){try{if(localStorage.getItem("is_first_visit")!="1"){var cloneForm=$(this.element).clone();cloneForm.attr("id","form-cloned-nl");$("<div>",{"id":"newsletter-form"}).html("<a class='jq-close' href='javascript:;'></a>").append(cloneForm).appendTo("body");var dataForm=$("#newsletter-form").find("form");dataForm.mage('validation',{});}
localStorage.setItem("is_first_visit","1");}catch(e){console.log(e);}},bindEvents:function(){$(document).delegate(".jq-ajaxnewsletter","submit",function(){var myForm=$(this);myForm.find("#nl-success-msg").hide().removeClass("nl-success-msg nl-error");myForm.validation('isValid');$.ajax(thisElem.attr("action"),{type:"json",method:"post",showLoader:true,loaderContext:myForm,data:myForm.serialize(),success:function(response){try{if(response.status=="success"){myForm.find("#nl-success-msg").text(response.message).fadeIn();}else{myForm.find("#nl-success-msg").text(response.message).fadeIn().addClass("nl-error");}}catch(e){console.log(e);}}});return false;});$(document).delegate(".jq-close","click",function(){$("#newsletter-form").fadeOut();});$(document).delegate(".jq-nl-button","click",function(){$(this).parents("form").find("#nl-success-msg").hide();});}});return $.corra.ajaxnewsletter;});