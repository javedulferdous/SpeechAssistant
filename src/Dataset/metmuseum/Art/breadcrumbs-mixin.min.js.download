define(['jquery','Magento_Theme/js/model/breadcrumb-list'],function($,breadcrumbList){'use strict';return function(widget){$.widget('mage.breadcrumbs',widget,{options:{categoryItemSelector:'.jq-parent',menuContainer:'[data-action="navigation"] > ul'},_appendCatalogCrumbs:function(){var categoryCrumbs=this._resolveCategoryCrumbs();categoryCrumbs.forEach(function(newCrumb){for(let i=0;i<breadcrumbList.length;i++){let crumb=breadcrumbList[i];if(crumb['name']==newCrumb['name']&&crumb['label']==newCrumb['label']&&crumb['link']==newCrumb['link']){return;}}
breadcrumbList.push(newCrumb);});},_resolveCategoryCrumbs:function(){var menuItem=this._resolveCategoryMenuItem(),categoryCrumbs=[];if(menuItem!==null&&menuItem.length){var currentCategoryCrumb=this._getCategoryCrumb(menuItem);if(!this.options.product){currentCategoryCrumb['link']='';}
categoryCrumbs.unshift(currentCategoryCrumb);while((menuItem=this._getParentMenuItem(menuItem))!==null){categoryCrumbs.unshift(this._getCategoryCrumb(menuItem));}}
return categoryCrumbs;},_getCategoryCrumb:function(menuItem){menuItem=$(menuItem.get(0));return{'name':'category','label':menuItem.text().toLowerCase(),'link':menuItem.attr('href'),'title':''};},_getParentMenuItem:function(menuItem){var classes,classNav,parentClass,levelClass='level',childLevel,parentMenuItem=null;if(!menuItem){return null;}
classes=menuItem.parent().attr('class');classNav=classes.match(/(nav\-)[0-9]+(\-[0-9]+)+/gi);if(classNav){classNav=classNav[0];parentClass=classNav.substr(0,classNav.lastIndexOf('-'));if(parentClass.lastIndexOf('-')!==-1){parentMenuItem=$(menuItem).parents('.'+parentClass).children('a[href!="javascript:;"]');parentMenuItem=parentMenuItem.length?parentMenuItem:null;}}
if(parentMenuItem){return parentMenuItem;}
var regexp=new RegExp('('+levelClass+')[0-9]+','gi');classNav=classes.match(regexp);if(classNav){classNav=classNav[0];childLevel=parseInt(classNav.substr(levelClass.length));if(!childLevel||childLevel==0){return parentMenuItem;}
while(--childLevel>=0){parentMenuItem=$(menuItem).parents('.'+levelClass+childLevel).children('a[href!="javascript:;"]');if(parentMenuItem.length){return parentMenuItem;}}}
return null;},_resolveCategoryMenuItem:function(){var categoryUrl=this._resolveCategoryUrl(),menu=$(this.options.menuContainer),categoryMenuItem=null,cleanCategoryUrl=null;if(!menu.length||!categoryUrl){return categoryMenuItem;}
var itemSelector=this.options.categoryItemSelector+' > a[href="'+categoryUrl+'"]';categoryMenuItem=menu.find('.active '+itemSelector);if(!categoryMenuItem.length){categoryMenuItem=menu.find(itemSelector);}
if(!categoryMenuItem&&categoryUrl.indexOf('?')>0){cleanCategoryUrl=categoryUrl.substr(0,categoryUrl.indexOf('?'));itemSelector=this.options.categoryItemSelector+' > a[href="'+cleanCategoryUrl+'"]';categoryMenuItem=menu.find('.active '+itemSelector);if(!categoryMenuItem.length){categoryMenuItem=menu.find(itemSelector);}}
return categoryMenuItem;},_resolveCategoryUrl:function(){var categoryUrl=null;if(!this.options.product){categoryUrl=document.location.href;}else if(this.options.useCategoryPathInUrl){categoryUrl=window.location.href.split('?')[0];categoryUrl=categoryUrl.substring(0,categoryUrl.lastIndexOf('/'))+
this.options.categoryUrlSuffix;}else{categoryUrl=document.referrer;}
return categoryUrl;}});return $.mage.breadcrumbs;};});