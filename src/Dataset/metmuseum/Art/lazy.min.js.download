define(['jquery','js/viewportCallbacks','jquery/ui'],function($,viewportCallbacks){$.widget("corra.lazy",{options:{threshold:1500,selector:'',media:'image'},_create:function(){var _this=this;if(this.options.media=='image'){if($(this.element).is('body')){$(_this.options.selector).not('.lazy-loaded').each(function(){_this.start(this);});viewportCallbacks.onChange(function(){$(_this.options.selector).not('[data-src]').each(function(){_this.start(this);});},true);$(window).on('scroll',function(){clearTimeout(_this.options.threshold);setTimeout(function(){$(_this.options.selector).not('.lazy-loaded').each(function(){_this.start(this);});},_this.options.threshold);});}else{_this.start(_this.element);}}else if(this.options.media=='video'){$(_this.element).on('click',function(){$(_this.element).parent().addClass('lazy-loading');var iframe=$('<iframe style="display: none;" class="media" frameborder="0" gesture="media" allow="encrypted-media"></iframe>');iframe.insertAfter(_this.element);iframe.on('load',function(){$(_this.element).hide();$(_this.element).parent().removeClass('lazy-loading');iframe.show();})
iframe.attr('src',$(this).attr('data-video-src'));});}},start:function(image){var _this=this;image=$(image);var top_of_element=image.offset().top;var bottom_of_element=image.offset().top+image.outerHeight();var bottom_of_screen=$(window).scrollTop()+window.innerHeight;var top_of_screen=$(window).scrollTop();if((bottom_of_screen>top_of_element)&&(top_of_screen<bottom_of_element)){_this._swapImage(image);}
return this;},_swapImage:function(img){img=$(img);img.removeClass('lazy-loaded');$(img).off('.lazyImg').on('load.lazyImg',function(){$(img).addClass('lazy-loaded');if($(img).attr('data-placeholder-height')){$(img).css('height','');}});var srcsetSupported=('sizes'in document.createElement('img'));var srcAttr='data-src-'+CorraUI.getViewport();if(typeof img.attr('data-src')!='undefined'){srcAttr='data-src';}
if(srcsetSupported){img.attr('srcset',img.attr(srcAttr));}else{img.attr('src',this._computeFallbackImg(img.attr(srcAttr)));}
return this;},_computeFallbackImg:function(src){console.log('******* EXECUTING FALLBACK LOGIC ****** ')
var srcArray=src.split(',');for(var i=0;i<srcArray.length;i++){if(srcArray[i].indexOf('1x')!=-1){src=srcArray[i].split(' ')[0];}}
return src;}});return $.lazy;})