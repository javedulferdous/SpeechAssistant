require(['jquery','underscore','ko','Magento_Customer/js/customer-data'],function($,_,ko,customerData){'use strict';window.monetateQ=window.monetateQ||[];window.monetateData=window.monetateData||{};var trackData=function(cartData){if(window.monetateData.addProductDetails){window.monetateQ.push(["addProductDetails",window.monetateData.addProductDetails]);}
if(window.monetateData.addProducts){window.monetateQ.push(["addProducts",window.monetateData.addProducts]);}
if(window.monetateData.addCategories){window.monetateQ.push(["addCategories",window.monetateData.addCategories]);}
if(window.monetateData.addCartRows){window.monetateQ.push(["addCartRows",window.monetateData.addCartRows]);}
if(!window.monetateData.addPurchaseRows){window.monetateQ.push(["addCartRows",cartData]);}
if(window.monetate_custom_variables&&window.monetate_custom_variables.length>0){window.monetateQ.push(["setCustomVariables",window.monetate_custom_variables]);}
if(window.monetateData.addPurchaseRows){var arr=window.monetateData.addPurchaseRows;arr.forEach(function(item,i,arr){if(window.monetateData.setPageType){window.monetateQ.push(["setPageType",window.monetateData.setPageType]);}
if(window.monetateData.addBreadcrumbs){window.monetateQ.push(["addBreadcrumbs",window.monetateData.addBreadcrumbs]);}
window.monetateQ.push(["addPurchaseRows",item]);window.monetateQ.push(["trackData"]);});}else{if(window.monetateData.setPageType){window.monetateQ.push(["setPageType",window.monetateData.setPageType]);}
if(window.monetateData.addBreadcrumbs){window.monetateQ.push(["addBreadcrumbs",window.monetateData.addBreadcrumbs]);}
window.monetateQ.push(["trackData"]);}};var getCartData=function(arr){var cartData=[];if(arr!==undefined){arr.forEach(function(item,i,arr){var sku=item.sku;var pid=item.sku;if(item.parent_sku){pid=item.parent_sku;}
cartData.push({'productId':pid,'quantity':item.qty,'unitPrice':parseFloat(item.product_price_value).toFixed(2),'currency':item.currency,'sku':sku.substring(0,32)});});}
return cartData;};var initTrackData=false;var oldValue=[];var trackDataFlag=false;var cart=customerData.get('cart');var cartSubscription=cart.subscribe(function(newCart){var cartItems=newCart.items;if(newCart.monetate_grouped_products!=undefined){cartItems=cartItems.concat(newCart.monetate_grouped_products);}
if((JSON.stringify(getCartData(cartItems))!==JSON.stringify(oldValue))||(cartItems.length==0&&oldValue.length==0)){oldValue=getCartData(cartItems);trackData(getCartData(cartItems));}});});