define(['jquery','jquery/ui','rtpZoom','corraui','owlcarousel','elevateZoom'],function($,ui,PinchZoom){"use strict";$.widget('corra.productGallery',{_init:function(){console.log('productGallery');var $widget=this;this.mainImageCarousel=$("#mainImageCarousel");this.thumbImageCarousel=$("#thumbImageCarousel");this.thumbImageCarousel.find(".item:first").addClass("active-thumb");this.thumbContainer="#thumbImageCarousel";$widget.initMainSlider();$widget.initThumbSlider();var windowWidth=$(window).width();$(window).resize(function(){if($(window).width()!=windowWidth){windowWidth=$(window).width();$widget.initThumbSlider();}});$(document).delegate("#thumbImageCarousel .item","click",function(event){var currentThumb=jQuery(this).parent().index();$("#mainImageCarousel").trigger("to.owl.carousel",currentThumb);if($(this).hasClass('video-thumb')){event.preventDefault();var activeItem=$("#mainImageCarousel .owl-item.active");var embedUrl=activeItem.find('img:first').data("video");if(embedUrl!==''||embedUrl!==null){embedUrl=$widget.embedVideo(embedUrl,true);if(activeItem.find('.jq-embed-video-iframe').length==0){var iframeTag='<div class="jq-embed-video-iframe"><iframe id="jq-embed-video-iframe" src="'+(embedUrl)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe></div>';activeItem.find('img:first').after(iframeTag);activeItem.find('img:first').hide();}}}});$("#mainImageCarousel .owl-stage").on("transitionend",function(){var activeItem=$("#mainImageCarousel .owl-item.active");var embedUrl=activeItem.find('img:first').data("video");if(embedUrl!==''){activeItem.find('.main-video-thumb').css('position','relative');activeItem.find('.main-video-thumb').parent().css('height','100%');embedUrl=$widget.embedVideo(embedUrl,true);if(activeItem.find('.jq-embed-video-iframe').length==0){var iframeTag='<div class="jq-embed-video-iframe"><iframe id="jq-embed-video-iframe" src="'+(embedUrl)+'?autoplay=1" frameborder="0" allowfullscreen></iframe></div>';activeItem.find('img:first').after(iframeTag);activeItem.find('img:first').hide();}}});$(document).delegate("#mainImageCarousel .owl-dot","click",function(event){var currentThumb=jQuery(this).index();$("#mainImageCarousel").trigger("to.owl.carousel",currentThumb);var activeItem=$("#mainImageCarousel .owl-item.active");var embedUrl=activeItem.find('img:first').data("video");if(embedUrl!==''){activeItem.find('.main-video-thumb').css('position','relative');activeItem.find('.main-video-thumb').parent().css('height','100%');embedUrl=$widget.embedVideo(embedUrl,true);if(activeItem.find('.jq-embed-video-iframe').length==0){var iframeTag='<div class="jq-embed-video-iframe"><iframe id="jq-embed-video-iframe" src="'+(embedUrl)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe></div>';activeItem.find('img:first').after(iframeTag);activeItem.find('img:first').hide();}}});this.mainImageCarousel.on('resized.owl.carousel',function(event){$widget.reInitZoom($widget);});},initMainSlider:function(){var mainItemCt=$("#mainImageCarousel .item").length,$widget=this;this.mainGalleryConfig={"items":1,"nav":false,"dots":false,"lazyLoad":false,"mouseDrag":mainItemCt>1?true:false,"touchDrag":mainItemCt>1?true:false,"responsive":{0:{"dots":true,"nav":false},768:{"dots":false,"nav":false}},"onChange":function(e){var current=e.item.index;$widget.removeVideo(current);},"onChanged":function(e){var current=e.item.index;$widget.syncPosition(current);},"onInitialized":function(){$widget.reInitZoom(this);}};this.mainImageCarousel.owlCarousel(this.mainGalleryConfig);},initThumbSlider:function(){if(CorraUI.checkMediaQuery(767)){$('.thumb-container').hide();}else{var productImgCt=this.thumbImageCarousel.find('div.item').length;if(productImgCt>1){$('.thumb-container').show();if(typeof this.thumbImageCarousel.data('owl.carousel')=='undefined'){this.thumbGalleryConfig={"items":6,"nav":true,"dots":false,"slideBy":3,"lazyLoad":false,"responsive":{0:{},768:{"items":4,"mouseDrag":productImgCt>4?true:false,"touchDrag":productImgCt>4?true:false},1024:{"items":5,"mouseDrag":productImgCt>5?true:false,"touchDrag":productImgCt>5?true:false},1225:{"items":6,"mouseDrag":productImgCt>6?true:false,"touchDrag":productImgCt>6?true:false}},};this.thumbImageCarousel.owlCarousel(this.thumbGalleryConfig);}}else{$('.thumb-container').hide();}}},syncPosition:function(current){$("#thumbImageCarousel").find(".item").removeClass("active-thumb").eq(current).addClass("active-thumb");if(typeof $("#thumbImageCarousel").data('owl.carousel')!==undefined){var getPrevThumb=$("#thumbImageCarousel").find(".item.active-thumb").parent().prev(),getNextThumb=$("#thumbImageCarousel").find(".item.active-thumb").parent().next();if(getNextThumb.length>0&&!getNextThumb.hasClass('active')){$("#thumbImageCarousel").trigger('next.owl.carousel');}else if(getPrevThumb.length>0&&!getPrevThumb.hasClass('active')){$("#thumbImageCarousel").trigger('prev.owl.carousel');}
if(!$("#thumbImageCarousel").find(".owl-item").eq(current).hasClass('active')){$("#thumbImageCarousel").trigger("to.owl.carousel",current);}}
this.enableZoom(current);},enableZoom:function(current){this.destroyZoom();var activeImage=this.mainImageCarousel.find(".item").eq(current).find('.corra-zoom');if(!CorraUI.isTouch()&&!CorraUI.isMobile()&&activeImage){activeImage.elevateZoom({zoomType:"inner",cursor:"crosshair",easing:true});$('body').css('overflow-x','hidden');}},reInitZoom:function($widget){if(CorraUI.isTouch()){if($('.zoomContainer').length>0){$widget.destroyZoom();}
setTimeout(function(){if($('.pinch-zoom').parent().hasClass('pinch-zoom-container')){$('.pinch-zoom').unwrap().removeAttr('style');}
$('.pinch-zoom').each(function(index,itm){new PinchZoom($(itm),{maxZoom:2.5});});},0.5);}else{if($('.pinch-zoom').parent().hasClass('pinch-zoom-container')){$('.pinch-zoom').unwrap().removeAttr('style');}}},destroyZoom:function(){var image=$(".corra-zoom");$.removeData(image,'elevateZoom');$('.zoomContainer, .zoomWindowContainer').remove();},removeVideo:function(current){if(typeof $("#mainImageCarousel").data('owl.carousel')!==undefined){if($(".jq-embed-video-iframe").length>0){var getParent=$(".jq-embed-video-iframe").parents('.owl-item');$(".jq-embed-video-iframe").remove();getParent.find('img:first').show();}}},embedVideo:function(href,forceVideo){if(typeof href!=='string')return href;href=this.parseHref(href);var id,url,type;if(href.host.match(/youtube\.com/)&&href.search){id=href.search.split('v=')[1];if(id){var ampersandPosition=id.indexOf('&');if(ampersandPosition!==-1){id=id.substring(0,ampersandPosition);}
type='youtube';}
url='//www.youtube.com/embed/'+id;}else if(href.host.match(/youtube\.com|youtu\.be/)){id=href.pathname.replace(/^\/(embed\/|v\/)?/,'').replace(/\/.*/,'');type='youtube';url='//www.youtube.com/embed/'+id;}else if(href.host.match(/vimeo\.com/)){type='vimeo';id=href.pathname.replace(/^\/(video\/)?/,'').replace(/\/.*/,'');url='//player.vimeo.com/video/'+id;}
if((!id||!type)&&forceVideo){id=href.href;type='custom';url=href.href;}
return url;},parseHref:function(href){var a=document.createElement('a');a.href=href;return a;}});return $.corra.productGallery;});