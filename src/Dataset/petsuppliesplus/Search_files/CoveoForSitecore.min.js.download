!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Coveo"),require("CoveoForSitecoreUserContext")):"function"==typeof define&&define.amd?define(["Coveo","CoveoForSitecoreUserContext"],t):"object"==typeof exports?exports.CoveoForSitecore=t(require("Coveo"),require("CoveoForSitecoreUserContext")):e.CoveoForSitecore=t(e.Coveo,e.CoveoForSitecoreUserContext)}(this,function(e,t){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),e.exports=n(24)},function(e,t,n){"use strict";var i=n(2);Coveo.initCoveoForSitecore=function(e,t,n){"init"===t?i.initializeSearch(e,n):"initSearchbox"===t?i.initializeSearchbox(e,n):console.error("The action '"+t+"' is not part of the coveoForSitecore plugin. Ignoring action.")},Coveo.initializeJQuery=function(e){Coveo.$=e,Coveo.initializeCoveoForSitecorePlugin()},Coveo.initializeCoveoForSitecorePlugin=function(){"undefined"!=typeof Coveo.$&&"undefined"!=typeof Coveo.$.fn&&(Coveo.$.fn.coveoForSitecore=function(e,t){return Coveo.initCoveoForSitecore(this[0],e,t),this})},function(e){"undefined"!=typeof e&&Coveo.initializeJQuery(e)}("undefined"!=typeof Coveo&&"undefined"!=typeof Coveo.$?Coveo.$:jQuery)},function(e,t,n){"use strict";function i(e,n){t.tabsBinding.applyBindings(),r(e)||("undefined"==typeof n.userContext&&(n.userContext=t.userContext.getContext()),t.plugin=new l.default(e,n,t.defaults),t.plugin.initialize())}function o(e,n){"undefined"==typeof n.userContext&&(n.userContext=t.userContext.getContext()),t.plugin=new c.default(e,n,t.defaults),t.plugin.initialize()}function r(e){return t.plugin&&t.plugin.element&&t.plugin.element.id===e.id}var s=this,a=n(3),l=n(4),u=n(17),c=n(18),p=n(12),d=n(19),h=n(20),f=n(21);t.OmniboxResultList=n(22),t.CoveoDistanceResources=n(23);var g=new f.default;t.userContext="undefined"!=typeof h?h.handler:new d.default,t.componentsOptions=new a.default,t.tabsBinding=new u.default,t.SearchEndpointHelper=p.default,t.defaults=new a.default,t.initializeSearch=i,t.initializeSearchbox=o,t.initRecommendations=function(e,t){g.initRecommendations(e,t||s.userContext.getContext())},t.initRelatedQuery=function(e,t,n,i){g.initRelatedQuery(e,t,n||s.userContext.getContext(),i)}},function(e,t){"use strict";var n=function(){function e(){this.analyticsCustomMetadata={},this.analyticsEndpointUri="/coveo/rest/v6/analytics/",this.boostExpressions="",this.clientLanguageFieldName="",this.clientLanguageName="",this.componentRefreshCallback=null,this.defaultSortType="Relevancy",this.defaultSortField="",this.defaultSortCriteriaNoSpace="Relevancy",this.defaultSortCriteriaLowercase="relevancy",this.enableClientSideLogging=!1,this.externalCollections=[],this.externalSources=[],this.externalSourcesFromCurrentTab=[],this.externalCollectionsFromCurrentTab=[],this.filterExpression="",this.filterResultOnLatestVersion=!0,this.filterResultsOnCurrentCulture=!1,this.indexSourceName="",this.isEditingInPageEditor=!1,this.isInitialized=!1,this.isPreviewingInPageEditor=!1,this.isPreviewingInPageEditorWithSimulatedDevice=!1,this.keepOmniboxSuggestionsProvidersDefaultOrdering=!0,this.latestVersionFieldName="",this.omniboxDataRowIndexCounter=0,this.pageFullPath="",this.pageName="",this.restEndpointUri="/coveo/rest/",this.resultListInfiniteScrollContainer=window,this.searchboxPlaceholderText="",this.searchRedirectionUrl="",this.searchRedirectionItemName="",this.sendToSitecoreAnalytics=!1,this.sitecoreItemId="",this.sitecoreItemUri="",this.siteName="",this.userContext={}}return e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";var i=n(5),o=n(6),r=n(7),s=n(8),a=n(12),l=n(13),u=n(14),c=function(){function e(e,t,n){this.isInPageEditorCssClass="coveo-page-editor",this.isEditingInPageEditorCssClass="coveo-page-editor-editing",this.isPreviewingInPageEditorCssClass="coveo-page-editor-previewing",this.isPreviewingInPageEditorWithSimulatedDeviceCssClass="coveo-page-editor-previewing-with-simulator",this.element=e,this.domElement=i.$$(e),this.options=_.extend({},n,t),this.logger=new o.default(this.options.enableClientSideLogging),this.expressionsHelper=new s.default,this.omniboxResultListHandler=new l.default,this.sitecoreAnalyticsHandler=new u.default(this.options),this.defaultSortHandler=new r.default(t),this.context={}}return e.prototype.initialize=function(){var e=this;if(this.logger.log("Initializing search."),this.initializeSearchOptions(),!this.options.isInitialized){this.addPageEditorCssClasses(),this.addResultListHeaderCssClasses(),this.domElement.on(i.InitializationEvents.afterInitialization,function(){i.HashUtils.getValue("sort",window.location.hash)||i.state(e.element,"sort",e.options.defaultSortCriteriaLowercase)});var t=i.Utils.extendDeep({Facet:{},SearchInterface:{}},this.options);i.init(this.element,t)}this.doPostInitializationActions()},e.prototype.doPostInitializationActions=function(){var e=this;_.forEach(this.domElement.findAll(".CoveoQuerybox input, .CoveoOmnibox input"),function(t){t.setAttribute("placeholder",e.options.searchboxPlaceholderText)})},e.prototype.initializeSearchOptions=function(){var e=this;a.default.initializeEndpoint(this.options),this.options.enableClientSideLogging&&i.Logger.enable(),this.options.isInitialized||(this.addPageEditorCssClasses(),this.domElement.on(i.QueryEvents.buildingQuery,function(t,n){e.defaultSortHandler.addSortCriteriaToQuery(n.queryBuilder),e.addContextToQuery(n.queryBuilder)}),this.domElement.on(i.InitializationEvents.afterInitialization,function(){e.registerSearchEvents(),e.options.isInitialized=!0}),this.options.sendToSitecoreAnalytics&&this.sitecoreAnalyticsHandler.registerSitecoreAnalytics(this.domElement))},e.prototype.postAnalytics=function(e,t,n){this.sitecoreAnalyticsHandler.postAnalytics(e,t,n)},e.prototype.addPageEditorCssClasses=function(){this.isInPageEditor()&&(this.domElement.addClass(this.isInPageEditorCssClass),this.options.isEditingInPageEditor&&this.domElement.addClass(this.isEditingInPageEditorCssClass),this.options.isPreviewingInPageEditor&&this.domElement.addClass(this.isPreviewingInPageEditorCssClass),this.options.isPreviewingInPageEditorWithSimulatedDevice&&this.domElement.addClass(this.isPreviewingInPageEditorWithSimulatedDeviceCssClass))},e.prototype.addResultListHeaderCssClasses=function(){var e=this.getDomElementsMatchingSelector(".coveo-results-header, .coveo-result-header-section");_.filter(e,function(e){return"undefined"!=typeof e&&!e.hasClass("CoveoQuerySummary")&&e.hasClass("CoveoQueryDuration")&&e.hasClass("CoveoSort")}).forEach(function(e){e.addClass("coveo-empty")})},e.prototype.getFilterExpressions=function(){return this.expressionsHelper.getFilterExpression(this.options)},e.prototype.registerSearchEvents=function(){var e=this;this.logger.log("Registering search events."),this.domElement.on(i.QueryEvents.buildingQuery,function(t,n){var i=e.getOptionsWithTabExternalContent(n.queryBuilder.tab);n.queryBuilder.advancedExpression.add(e.expressionsHelper.getSearchExpression(i)),n.queryBuilder.constantExpression.add(e.expressionsHelper.getFilterExpression(i))}),this.domElement.on(i.AnalyticsEvents.changeAnalyticsCustomData,function(t,n){var i=e.options;i&&(i.clientLanguageName&&(n.language=i.clientLanguageName),i.pageName&&(n.originLevel1=i.pageName),i.analyticsCustomMetadata&&_.extend(n.metaObject,i.analyticsCustomMetadata))}),this.options.componentRefreshCallback&&(this.domElement.on(i.QueryEvents.deferredQuerySuccess,function(){e.options.componentRefreshCallback()}),this.domElement.on(i.QueryEvents.queryError,function(){e.options.componentRefreshCallback()}))},e.prototype.isInPageEditor=function(){return this.options.isEditingInPageEditor||this.options.isPreviewingInPageEditor||this.options.isPreviewingInPageEditorWithSimulatedDevice},e.prototype.configureOmnibox=function(e){this.domElement.on(i.OmniboxEvents.populateOmnibox,this.generatePopulateOmniboxFunction(e))},e.prototype.addContextToQuery=function(e){var t=this;"undefined"==typeof e.context&&(e.context={}),Object.keys(this.options.userContext).map(function(e){return{key:e,value:t.options.userContext[e]}}).filter(function(e){return""!==e.value}).forEach(function(t){e.context[t.key]=t.value})},e.prototype.getOptionsWithTabExternalContent=function(e){var t=_.extend({},this.options);if("undefined"!=typeof e&&this.options.hasOwnProperty(e)){var n=this.options[e];t.externalSourcesFromCurrentTab=n.externalSources,t.externalCollectionsFromCurrentTab=n.externalCollections}return t},e.prototype.generatePopulateOmniboxFunction=function(e){var t=this,n=i.get(this.element).queryController;return function(i,o){t.omniboxResultListHandler.populateOmniboxResultList(o,e,n)}},e.prototype.getDomElementsMatchingSelector=function(e){return _.map(document.querySelectorAll(e),function(e){return i.$$(e)})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=c},function(t,n){t.exports=e},function(e,t){"use strict";var n=function(){function e(e){this.enableClientSideLogging=e}return e.prototype.log=function(e){this.enableClientSideLogging&&console.log(["TRACE","Coveo for Sitecore"].concat(e))},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";var n=function(){function e(e){this.fieldSortType="Field",this.defaultSortOptions=e}return e.prototype.addSortCriteriaToQuery=function(e){e.sortCriteria=this.defaultSortOptions.defaultSortCriteriaLowercase,this.defaultSortOptions.defaultSortType===this.fieldSortType&&(e.sortField=this.defaultSortOptions.defaultSortField)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";var i=n(9),o=n(10),r=n(11),s=function(){function e(e,t){var n=new r.default;this.filterExpressionHelper=e||new o.default(n),this.searchExpressionHelper=t||new i.default(n)}return e.prototype.getFilterExpression=function(e){var t=this.filterExpressionHelper.getContextFilterExpressions(e);return this.filterExpressionHelper.appendExternalContentToExpression(t,e)},e.prototype.getSearchExpression=function(e){var t=[this.searchExpressionHelper.getSourcesAndCollectionsExpression(e,e,e),this.searchExpressionHelper.getSearchFilterExpression(e,e),this.searchExpressionHelper.getSearchBoostExpression(e)];return t.filter(function(e){return""!==e}).join(" ")},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t){"use strict";var n=function(){function e(e){this.utilities=e}return e.prototype.getSourcesAndCollectionsExpression=function(e,t,n){var i,o=this.getSourcesExpression(t,n),r=this.getAllExternalCollections(e,n);if(r.length>0){var s=this.utilities.getExternalCollectionsExpression(r);i="("+o+" OR "+s+")"}else i=o;return i},e.prototype.getSearchFilterExpression=function(e,t){var n=[e.filterExpression];return t.externalSourcesFromCurrentTab.length>0&&n.push(this.utilities.getExternalSourcesExpression(t.externalSourcesFromCurrentTab)),t.externalCollectionsFromCurrentTab.length>0&&n.push(this.utilities.getExternalCollectionsExpression(t.externalCollectionsFromCurrentTab)),n.join(" OR ")},e.prototype.getSearchBoostExpression=function(e){return e.boostExpressions},e.prototype.getSourcesExpression=function(e,t){var n=[];return this.utilities.isDefined(e.indexSourceName)&&n.push(e.indexSourceName),e.externalSources.length>0&&n.push.apply(n,e.externalSources),t.externalSourcesFromCurrentTab.length>0&&n.push.apply(n,t.externalSourcesFromCurrentTab),this.utilities.getFilterExpression("@syssource",n)},e.prototype.getAllExternalCollections=function(e,t){var n=[];return n.push.apply(n,e.externalCollections),n.push.apply(n,t.externalCollectionsFromCurrentTab),n},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";var n=function(){function e(e){this.utilities=e}return e.prototype.getFilterExpressions=function(e){var t=this.getContextFilterExpressions(e),n=this.appendExternalContentToExpression(t,e);return n},e.prototype.getContextFilterExpressions=function(e){var t="",n=[];if(e.filterResultsOnCurrentCulture){var i=this.utilities.getFilterExpression(e.clientLanguageFieldName,e.clientLanguageName);n.push(i)}if(e.filterResultOnLatestVersion){var o=this.utilities.getFilterExpression(e.latestVersionFieldName,"1");n.push(o)}if(n.length>0){var r=n.join(" ").replace(/^\s+|\s+$/g,"");t="("+r+")"}return t},e.prototype.appendExternalContentToExpression=function(e,t){var n=e;if(this.hasExternalContentSpecified(t)){var i=[e],o=this.getAllExternalSources(t,t);o.length>0&&i.push(this.utilities.getExternalSourcesExpression(o));var r=this.getAllExternalCollections(t,t);r.length>0&&i.push(this.utilities.getExternalCollectionsExpression(r)),n="("+i.join(" OR ")+")"}return n},e.prototype.getAllExternalSources=function(e,t){var n=[];return n.push.apply(n,e.externalSources),n.push.apply(n,t.externalSourcesFromCurrentTab),n},e.prototype.getAllExternalCollections=function(e,t){var n=[];return n.push.apply(n,e.externalCollections),n.push.apply(n,t.externalCollectionsFromCurrentTab),n},e.prototype.hasExternalContentSpecified=function(e){return e.externalCollections.length>0||e.externalSources.length>0||e.externalSourcesFromCurrentTab.length>0||e.externalCollectionsFromCurrentTab.length>0},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";var n=function(){function e(){}return e.prototype.getFilterExpression=function(e,t){if("string"==typeof t)return e+'=="'+t+'"';var n=t;return n.length>0?e+'==("'+n.join('","')+'")':""},e.prototype.getExternalCollectionsExpression=function(e){return this.getFilterExpression("@syscollection",e)},e.prototype.getExternalSourcesExpression=function(e){return this.getFilterExpression("@syssource",e)},e.prototype.isDefined=function(e){return"undefined"!=typeof e},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";var i=n(5),o=function(){function e(){}return e.initializeEndpoint=function(e){i.SearchEndpoint.endpoints.default=new i.SearchEndpoint({restUri:e.restEndpointUri,queryStringArguments:{sitecoreItemUri:e.sitecoreItemUri,siteName:e.siteName}})},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(5),o=function(){function e(){}return e.getOmniboxDataRowIndex=function(){return this.omniboxDataRowIndexCounter=this.omniboxDataRowIndexCounter+1,this.omniboxDataRowIndexCounter},e.prototype.onOmniboxRowClicked=function(e){window.location.href=e.clickUri},e.prototype.buildOmniboxContent=function(e,t){var n=this,o=t.id?t.id:t.resultTemplateId,r=document.getElementById(o),s=new i.UnderscoreTemplate(r),a=this.getResultContainer(t.headerTitle),l=i.$$("div");return l.append(a.el),e.forEach(function(e){var t=s.instantiateToElement(e),o=i.$$(t);o.addClass("CoveoResult coveo-omnibox-selectable"),o.on("click keyboardSelect",function(){n.onOmniboxRowClicked(e)}),l.append(t)}),l.el},e.prototype.populateOmniboxResultList=function(e,t,n){var i=this,o=n.createQueryBuilder(t);t.queryExpression&&"string"==typeof t.queryExpression&&o.advancedExpression.add(t.queryExpression),o.numberOfResults=t.numberOfResults;var r=o.build(),s=this.executeSearchQuery(r).then(function(e){if(e.totalCount>0){var n=i.buildOmniboxContent(e.results,t),o={zIndex:t.omniboxDataRowIndex,element:n};return o}return{element:void 0}});e.rows.push({deferred:s})},e.prototype.executeSearchQuery=function(e){return i.SearchEndpoint.endpoints.default.search(e)},e.prototype.getResultContainer=function(e){var t=i.$$("div");return t.addClass("coveo-omnibox-result-list-header"),t.append(this.getIcon().el),t.append(this.getCaption(e).el),t},e.prototype.getIcon=function(){var e=i.$$("span");return e.addClass("coveo-icon-omnibox-result-list"),e},e.prototype.getCaption=function(e){var t=i.$$("span");return t.addClass("coveo-caption"),t.el.textContent=e,t},e.omniboxDataRowIndexCounter=0,e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t,n){"use strict";var i=n(5),o=n(15),r=n(16),s=function(){function e(e,t){this.options=e,this.endpointCaller=t||new r.default}return e.prototype.registerSitecoreAnalytics=function(e,t){var n=this;(t||window).onbeforeunload=function(){i.Defer.flush()},e.on(i.AnalyticsEvents.searchEvent,function(e,t){n.postAnalytics("searches","searchEvents",t.searchEvents)}),e.on(i.AnalyticsEvents.documentViewEvent,function(e,t){n.postAnalytics("documentViews","documentViewEvents",t.documentViewEvent)}),e.on(i.AnalyticsEvents.customEvent,function(e,t){n.postAnalytics("custom","customEvents",t.customEvent)})},e.prototype.postAnalytics=function(e,t,n){var i=this,r=[];"undefined"!=typeof n&&(r=r.concat(n)),r.filter(function(e){return"undefined"!=typeof e}).forEach(function(e){e.sitecoreItemId=i.options.sitecoreItemId});var s={};s[t]=JSON.stringify(r),this.endpointCaller.sendPost(o.default.appendTrailingSlash(this.options.analyticsEndpointUri)+e,s)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t){"use strict";var n=function(){function e(){}return e.appendTrailingSlash=function(e){return"/"===e.charAt(e.length-1)?e:e+"/"},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";var i=n(5),o=function(){function e(e){this.endpointCaller=e||new i.EndpointCaller}return e.prototype.sendPost=function(e,t){var n={errorsAsSuccess:!1,method:"POST",queryString:[],requestData:t,url:e,responseType:"text",requestDataType:"application/json"};return this.endpointCaller.call(n)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t){"use strict";var n=function(){function e(){var e=this;this.bindings={},this.getElementBinding=function(t){return{elementId:t,document:document.getElementById(t),binding:e.bindings[t]}},this.elementFound=function(e){var t="undefined"!=typeof e.document&&null!=e.document;return t||console.error("The element with the ID '"+e.elementId+"' was not found. Ensure the element exists in the DOM."),t},this.initBinding=function(t){return e.bindings.hasOwnProperty(t)||(e.bindings[t]={tabNot:[]}),e.bindings[t]},this.applyBinding=function(t){e.addExcludeFromTabTag(t.document,t.binding.tabNot)},this.addExcludeFromTabTag=function(e,t){t.length>0&&e.setAttribute("data-tab-not",t.join(","))}}return e.prototype.excludeItemsIdsInTab=function(e,t){e.map(this.initBinding,this).forEach(function(e){e.tabNot.push(t)})},e.prototype.applyBindings=function(){Object.keys(this.bindings).map(this.getElementBinding).filter(this.elementFound).forEach(this.applyBinding)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(5),r=n(4),s=function(e){function t(t,n,i){e.call(this,t,n,i),this.searchBoxOptions=_.extend({},i,n)}return i(t,e),t.prototype.initialize=function(){var e=this;if(this.logger.log("Initializing searchbox."),this.initializeSearchOptions(),this.options.isInitialized||this.domElement.on(o.QueryEvents.buildingQuery,function(t,n){var i=e.expressionsHelper.getSearchExpression(e.searchBoxOptions);n.queryBuilder.advancedExpression.add(i)}),o.initSearchbox(this.element,this.searchBoxOptions.searchRedirectionUrl,this.searchBoxOptions),this.searchBoxOptions.searchRedirectionItemName){var t=o.get(this.element,o.SearchInterface);t&&t.componentOptionsModel.set("searchHub",this.searchBoxOptions.searchRedirectionItemName)}this.doPostInitializationActions()},t}(r.default);Object.defineProperty(t,"__esModule",{value:!0}),t.default=s},function(e,t){"use strict";var n=function(){function e(){this.context={}}return e.prototype.initializeContext=function(e){return this.context=this.replaceInvalidCharacterInContext(e),this},e.prototype.setContext=function(e,t){return this.context[this.replaceInvalidCharacters(e)]=t,this},e.prototype.getContext=function(){return this.context},e.prototype.replaceInvalidCharacterInContext=function(e){var t=this,n={};return Object.keys(e).forEach(function(i){n[t.replaceInvalidCharacters(i)]=e[i]}),n},e.prototype.replaceInvalidCharacters=function(t){return"string"==typeof t?t.replace(e.invalidCharacters,"_"):(console.error("The user context key '{key}' is not a string."),"")},e.invalidCharacters=/[^A-Za-z0-9_]/gi,e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,n){e.exports=t},function(e,t,n){"use strict";var i=n(5),o=n(7),r=n(14),s=n(11),a=function(){function e(){}return e.prototype.initRelatedQuery=function(e,t,n,a){var l=new s.default,u=new o.default(a),c=i.$$(e);if(c.on(i.QueryEvents.buildingQuery,function(e,t){if(u.addSortCriteriaToQuery(t.queryBuilder),a.filterResultsOnCurrentCulture){var n=l.getFilterExpression(a.clientLanguageFieldName,a.clientLanguageName);t.queryBuilder.constantExpression.add(n)}}),a&&a.sendToSitecoreAnalytics){var p=new r.default(a);p.registerSitecoreAnalytics(c)}i.initRecommendation(e,t,n,a)},e.prototype.initRecommendations=function(e,t){i.initRecommendation(e,null,t)},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=a},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(5),r=n(13),s=o.Component,a=function(e){function t(n,i,s){e.call(this,n,t.ID,s),this.element=n,this.options=i,this.omniboxResultListHandler=new r.default,this.options=o.ComponentOptions.initComponentOptions(n,t,i),s&&this.initializeOmniboxDataRowIndex(s),this.bind.onRootElement(o.OmniboxEvents.populateOmnibox,this.populateOmnibox),this.bindEnterToSearchButton()}return i(t,e),t.prototype.bindEnterToSearchButton=function(){var e=document.querySelectorAll(".CoveoSearchbox");_.map(e,function(e){return{input:e.querySelector("input"),button:e.querySelector(".CoveoSearchButton")}}).filter(function(e){return null!==e.button&&null!==e.input}).forEach(function(e){e.input.addEventListener("keyup",function(t){13===t.keyCode&&e.button.click()})})},t.prototype.populateOmnibox=function(e){this.omniboxResultListHandler.populateOmniboxResultList(e,this.options,this.queryController)},t.prototype.initializeOmniboxDataRowIndex=function(e){var t=document.getElementsByClassName("CoveoForSitecoreOmniboxResultList")[0];e.searchInterface.options.originalOptionsObject.keepOmniboxSuggestionsProvidersDefaultOrdering||(this.options.omniboxDataRowIndex=51+o.$$(t).children().length-e.searchInterface.options.originalOptionsObject.omniboxDataRowIndexCounter,e.searchInterface.options.originalOptionsObject.omniboxDataRowIndexCounter++)},t.ID="ForSitecoreOmniboxResultList",t.options={headerTitle:o.ComponentOptions.buildStringOption(),queryExpression:o.ComponentOptions.buildStringOption(),numberOfResults:o.ComponentOptions.buildNumberOption({defaultValue:10,min:1}),omniboxDataRowIndex:o.ComponentOptions.buildNumberOption({defaultValue:51,min:16}),resultTemplateId:o.ComponentOptions.buildStringOption()},t}(s);t.OmniboxResultList=a,o.Initialization.registerAutoCreateComponent(a)},function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=n(5),r=n(16),s="google",a="sitecoreGeolocation",l="browser",u="custom",c="https://www.googleapis.com/geolocation/v1/geolocate?key=",p=function(e){function t(n,i,s){e.call(this,n,t.ID,s),this.element=n,this.options=i,this.bindings=s,this.providerWarningDisabled=!1,this.options=o.ComponentOptions.initComponentOptions(n,t,i),this.endpointCaller=new r.default,this.options.geolocationProviders&&(this.options.geolocationProviders=this.options.geolocationProviders.reverse(),this.tryNextGeolocationProvider())}return i(t,e),t.prototype.setDistance=function(e,t){this.latitude=e,this.longitude=t,this.registerDistanceQuery(),this.queryController.executeQuery()},t.prototype.setCoordinateFromGoogle=function(){var e=this;if(this.options.googleApiKey){var t={},n=c+this.options.googleApiKey,i=this.endpointCaller.sendPost(n,t);i.then(function(t){var n=t.data.location;n?e.setDistance(n.lat,n.lng):e.tryNextGeolocationProvider()})}else this.logger.error(s+' provider was selected, but "googleApiKey" option was not set.'),this.tryNextGeolocationProvider()},t.prototype.setDefaultCoordinates=function(){this.isNullOrEmpty(this.options.defaultLatitude)||this.isNullOrEmpty(this.options.defaultLongitude)?(this.logger.error(a+' provider was selected, but "defaultLongitude" and "defaultLatitude" options were not set.'),this.tryNextGeolocationProvider()):this.setDistance(this.options.defaultLatitude,this.options.defaultLongitude)},t.prototype.setCoordinatesFromBrowser=function(){var e=this;navigator.geolocation.getCurrentPosition(function(t){e.setDistance(t.coords.latitude,t.coords.longitude)},function(t){e.tryNextGeolocationProvider()})},t.prototype.registerDistanceQuery=function(){var e=this;this.bind.onRootElement(Coveo.QueryEvents.buildingQuery,function(t){var n={function:e.getConvertedUnitsFunction("dist("+e.options.latitudeField+", "+e.options.longitudeField+", "+e.latitude+", "+e.longitude+")"),fieldName:e.options.distanceField};t&&t.queryBuilder&&(t.queryBuilder.queryFunctions.push(n),e.enableDistanceComponents())})},t.prototype.enableDistanceComponents=function(){for(var e=this,t=document.getElementsByClassName(this.options.disabledDistanceCssClass),n=[],i=0,o=t.length;i<o;i++)n.push(t.item(i));n.forEach(function(t){try{t.classList.remove(e.options.disabledDistanceCssClass),Coveo.get(t).enable()}catch(n){e.logger.error("Could not re-enable distance component:",n,t)}})},t.prototype.getConvertedUnitsFunction=function(e){return e+"/"+this.options.unitConversionFactor},t.prototype.tryNextGeolocationProvider=function(){var e=this.options.geolocationProviders.pop();if(null==e)this.providerWarningDisabled||console.warn('None of the mentioned geolocation providers were able to provide the user\'s coordinates. The distance field will not be calculated and the distance components will be disabled until the next call to "setDistance".');else switch(e){case s:this.setCoordinateFromGoogle();break;case u:this.providerWarningDisabled=!0;break;case a:this.setDefaultCoordinates();break;case l:this.setCoordinatesFromBrowser();break;default:console.warn("Invalid geolocation provider: '"+e+"'."),this.tryNextGeolocationProvider()}},t.prototype.isNullOrEmpty=function(e){return null===e||"undefined"==typeof e},t.ID="ForSitecoreDistanceResources",t.options={distanceField:o.ComponentOptions.buildStringOption(),latitudeField:o.ComponentOptions.buildStringOption(),longitudeField:o.ComponentOptions.buildStringOption(),defaultLatitude:o.ComponentOptions.buildNumberOption(),defaultLongitude:o.ComponentOptions.buildNumberOption(),geolocationProviders:o.ComponentOptions.buildListOption(),googleApiKey:o.ComponentOptions.buildStringOption(),unitType:o.ComponentOptions.buildStringOption(),unitConversionFactor:o.ComponentOptions.buildStringOption(),disabledDistanceCssClass:o.ComponentOptions.buildStringOption({defaultValue:"coveo-distance-disabled"})},t}(o.Component);t.CoveoForSitecoreDistanceResources=p,o.Initialization.registerAutoCreateComponent(p)},function(e,t,n){"use strict";function i(e,n){t.tabsBinding.applyBindings(),r(e)||("undefined"==typeof n.userContext&&(n.userContext=t.userContext.getContext()),t.plugin=new l.default(e,n,t.defaults),t.plugin.initialize())}function o(e,n){"undefined"==typeof n.userContext&&(n.userContext=t.userContext.getContext()),t.plugin=new c.default(e,n,t.defaults),t.plugin.initialize()}function r(e){return t.plugin&&t.plugin.element&&t.plugin.element.id===e.id}var s=this,a=n(3),l=n(4),u=n(17),c=n(18),p=n(12),d=n(19),h=n(20),f=n(21);t.OmniboxResultList=n(22),t.CoveoDistanceResources=n(23);var g=new f.default;t.userContext="undefined"!=typeof h?h.handler:new d.default,t.componentsOptions=new a.default,t.tabsBinding=new u.default,t.SearchEndpointHelper=p.default,t.defaults=new a.default,t.initializeSearch=i,t.initializeSearchbox=o,t.initRecommendations=function(e,t){g.initRecommendations(e,t||s.userContext.getContext())},t.initRelatedQuery=function(e,t,n,i){g.initRelatedQuery(e,t,n||s.userContext.getContext(),i)}}])});
//# sourceMappingURL=CoveoForSitecore.min.js.map