(window.discovery_pages_mcom_jsonp=window.discovery_pages_mcom_jsonp||[]).push([["monetization"],{"391a71c0":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),n=s(r("5dcf66de")),i=s(r("6f192794")),a=s(r("85bff120"));function s(e){return e&&e.__esModule?e:{default:e}}var c={},u=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=r,this.userId=void 0,this.options=t,"[object Object]"!==Object.prototype.toString.call(this.options)?(this.options={},this.options.properties={}):Object.prototype.hasOwnProperty.call(this.options,"properties")||(this.options.properties={})}return o(e,[{key:"updateRequiredProperties",value:function(e){void 0===this.userId&&(this.userId=n.default.get("macys_online_uid")||"",this.options.properties.cUserId=this.userId);for(var t=0;t<e.length;t+=1){var r=e[t];i.default.hasChildProperty(this.options,"properties."+r)||(this.options.properties[r]=null)}}},{key:"newRequest",value:function(){c=window.HLLibrary.newRequest();this.updateRequiredProperties(["hlPageType","pCount","organicSKUs","pgSize","pgN","view","brand","minRating","minPrice","maxPrice"]),e.setProp(this.options.taxonomy,"setTaxonomy"),e.setProp(this.options.keyword,"setKeyword"),e.setProp(this.options.product,"setProduct"),e.setProp(this.options.module,"setModule"),e.setData(this.options.properties,"setProperty"),e.setData(this.options.filters,"setFilter"),e.setData(this.options.attributes,"setAttribute"),c.submit(this.id),c={}}}],[{key:"setData",value:function(e,t){if(e)for(var r=Object.keys(e),o=0;o<r.length;o+=1)c=c[t](r[o],e[r[o]])}},{key:"setProp",value:function(e,t){e&&(c=c[t](e))}}]),e}();t.default={start:function(){var e=0;return new Promise((function(t,r){var o=setInterval((function(){void 0===window.HLLibrary&&e>=10?(a.default.error("HLLibrary is not defined."),clearInterval(o),r()):void 0!==window.HLLibrary?(clearInterval(o),t(u)):e+=1}),500)}))}}},ae6b36fa:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),i=d(r("8fa5214a")),a=d(r("8554f259")),s=d(r("ed888121")),c=d(r("adf96922")),u=r("5521983e");function d(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.app=s.default,this.state=t}var t,r;return n(e,[{key:"init",value:(t=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchSponsoredItems();case 3:t=e.sent,this.activate(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.handleError(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})),r=function(){var e=t.apply(this,arguments);return new Promise((function(t,r){return function o(n,i){try{var a=e[n](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then((function(e){o("next",e)}),(function(e){o("throw",e)}));t(s)}("next")}))},function(){return r.apply(this,arguments)})},{key:"fetchSponsoredItems",value:function(){var e=this.state.sponsoredItemsUrl,t=this.state.isXAPIHomePage;return e?new Promise((function(r,n){i.default.ajax({method:"GET",url:e,dataType:"json",cache:!1,complete:function(e){var i=JSON.parse(e.responseText)||{},a=i.productPoolMedia;a&&a.collection&&a.collection.length&&r(o({sponsoredCarouselHomePage:t,sponsoredCarousel:!0},i)),c.default.error("no sponsered items"),n(i.errors)},error:function(e,t){n(t)}})})):Promise.reject("XAPI url is not specified")}},{key:"activate",value:function(e){var t=e.productPoolMedia,r=t.collection;t.collection=new a.default.Collection(r);var o=new a.default.Model(e);this.app.channel.trigger(u.Actions.pool.start,{model:o,selector:".siteMonetization"})}},{key:"handleError",value:function(e){c.default.log(e)}}]),e}();t.default=l},e4c6dd17:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=f(r("8fa5214a")),n=f(r("3ebdffc6")),i=f(r("ed888121")),a=f(r("5dcf66de")),s=f(r("43733114")),c=f(r("eab81cf1")),u=f(r("884f27d8")),d=f(r("a5675553")),l=r("b7d5f61d"),p=f(r("391a71c0"));function f(e){return e&&e.__esModule?e:{default:e}}var h={selector:"hl-1"},v=void 0,g="",m=void 0;function y(e){var t,r,o=a.default.get("macys_online_guid"),n=a.default.get("utag_main"),i=a.default.get("AMCV_8D0867C25245AE650A490D4C@AdobeOrg"),s=(t="|",(r=decodeURI(i).split(t))?r[4]:void 0),c=n&&n.match(/(v_id:)([a-z0-9])+/i)||[],u=c.length>0&&c[0].replace("v_id:",""),d=void 0;if(e){d=e.indexOf("criteo")>-1?e+"&puserid="+(u||"")+"&cuserid="+(o||""):e+"?sessionId="+(s||"")+"&customerId="+(o||"");var l=document.createElement("img");return l.src=d,l}return""}function b(){(0,o.default)(".siteMonetizationBrowseAndSearch").one("click",(function(){var e=(0,o.default)(this).data();e.productName=(0,o.default)(this).attr("title"),y(e.clickBeacon);var t={event_name:"sponsored items click",product_id:e.productId,product_name:e.productName,item_position:e.itemPosition-("PHONE"===i.default.getMeta("context").deviceType?1:2),sponsored_revenue:0};d.default.fireTag("link",t)}))}function w(e,t){if(e){m="search"===e;var r=a.default.get("shippingCountry")||"US";h.placeHolder=m?"#search_landing_pageRegion":".filterBackGround",v=c.default.getValue(m?"smSearch":"smBrowse"),function(e){(0,o.default)("body").on("click",".hl-container a",(function(){var t=(0,o.default)(this).data();u.default.createLinkClickTag({href:"?cm_sp=site_monetization-_-browse-_-sponsored_item",name:"SPONSORED_ITEM",pageID:i.default.getMeta("analytics.coremetrics.pageID")}),u.default.createLinkClickTag({href:t.hlDest+"&cm_sp=site_monetization-_-"+e+"_ad"+t.hlPosition+"-_-"+t.hlProductid})}))}(m?"search":"browse"),v&&""===v.registryMode&&"US"===r&&((0,o.default)(h.placeHolder).before('<div id="'+h.selector+'"></div>'),function(e){var t={};t=v,""===g?(t.properties.organicSKUs=t.properties.organicSKUs.join("|"),t.properties.view="default"):(t.properties=g.properties,t.filters=g.filters),t.properties.hlPageType=m?"S":"B",t.properties.platform="web",e&&(t.properties.displaya="0"),t.properties.abbucket="B",t.module=(0,o.default)(window).width()<1024?"MobileListingPage":"ListingPage",p.default.start().then((function(e){new e(t,h.selector).newRequest()}),(function(){}))}(t))}else console.error("Site Monetization: pageType is undefined")}s.default.observe("HookLogicProperty").subscribe((function(e){g=function(e){var t=e.meta,r=void 0===t?{}:t,o=r.selectedFacets,i=void 0===o?{}:o,a=i.PRICE,s=i.CUSTRATINGS,c="",u="";a&&a.constructor===Array&&(c=a[0]||"",u=a[a.length-1]||"");var d="";n.default.each(i.BRAND,(function(e,t){d+=t<i.BRAND.length-1?e+"|":e}));var l="";return n.default.each(r.productIds,(function(e,t){l+=t<r.productIds.length-1?e+"|":e})),{properties:{minRating:s&&s[s.length-1].charAt(0)||"",minPrice:c,maxPrice:u,view:sessionStorage.getItem("gridType")||"",pCount:r.productIds&&r.productIds.length||"0",pgSize:e.productsPerPage||"",pgN:e.pageIndex||"",sort:e.sortBy||"",brand:d,organicSKUs:l},filters:n.default.mapObject(n.default.omit(i,["BRAND","PRICE","CUSTRATINGS"]),(function(e){return e.join("|")}))}}(e),w(m?"search":"browse")})),t.default={start:w,fireBeacon:y,siteMonetizationBrowseAndSearch:function(){(0,o.default)(".siteMonetizationBrowseAndSearch")[0]&&(b(),Array.from(document.querySelectorAll(".siteMonetizationBrowseAndSearch")).forEach((function(e){var t=e.dataset.viewBeacon,r=y.bind(null,t);(0,l.onElementWillBeVisible)(e,r,0,50)})))},onClickBeacon:b}}}]);
//# sourceMappingURL=discovery-pages-mcom.monetization.c8a9cd5cacfe7b915d50.js.map