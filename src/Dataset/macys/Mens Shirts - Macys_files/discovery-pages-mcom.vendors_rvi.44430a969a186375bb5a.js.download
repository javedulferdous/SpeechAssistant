(window.discovery_pages_mcom_jsonp=window.discovery_pages_mcom_jsonp||[]).push([["vendors~rvi"],{"088c64bb":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=r(i("1be88a21")),n=r(i("92d30a0c"));function r(e){return e&&e.__esModule?e:{default:e}}t.default=a.default.ItemView.extend({template:n.default,attachElContent:function(e){return this.$el.prepend(e),this}})},"2bb03a14":function(e,t,i){},"5339ddef":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=r(i("c9e943a0")),n=r(i("c5f8ef0c"));function r(e){return e&&e.__esModule?e:{default:e}}a.default.model=new n.default,delete a.default.collection,t.default=a.default},"7af1196b":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=s(i("f0b9b09a")),n=s(i("8554f259")),r=s(i("138dc03a")),o=i("c4556a2b"),l=s(i("ed888121"));function s(e){return e&&e.__esModule?e:{default:e}}var d=n.default.Collection.extend({meta:null,setContext:function(e){this.context=e},setRviItems:function(e){this.rviItems=e},initialize:function(e,t){t&&t.context?this.setContext(t.context):this.setContext({})},parse:function(e){var t=this,i=l.default.getMeta("properties");return e.forEach((function(e){var a=e;a.product.traits.colors.colorMap=[],a.id=a.product.id,i.newGWPEnabled&&(a.product.meta.properties=Object.assign({isGWPEnabled:!0},a.product.meta.properties)),a.product.meta.properties=Object.assign(i,a.product.meta.properties),a.product.registry_mode=l.default.getMeta("context").shoppingMode,a.product.availability.available&&t.push(a)})),this.models},url:function(){var e=void 0,t=void 0;return(t=void 0===this.rviItems?a.default.getPersistent(o.RVI_STORAGE_NAME):this.rviItems)&&(e="/xapi/discover/v1/product?productIds="+t+r.default.generateContextUrlParams(this.context)+"&clientId=RVI"),e},fetchCollection:function(){var e=this;return new Promise((function(t,i){var a=e.models.length;0===a&&i();var n=[],r=function(i){i.set("loaded",!0),i.isValid()?(i.set("id",i.attributes.productId),n.push(i)):(e.remove(i),a-=1),a===n.length&&t(n)};e.models.forEach((function(e){e.get("loaded")?r(e):function(e){e.fetch({success:r,error:r})}(e)}))}))}},{fromArray:function(e,t){var i=e.map((function(e,t){return{productId:e,index:t}}));return new d(i,t)}});t.default=d},"88342c39":function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=l(i("b0865de3")),r=i("c45d9355"),o=l(i("8fa5214a"));function l(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=function(e){function t(){return s(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"doSizing",value:function(){if(0!==this.childrenView.length){this.buttonsContainers=this.carouselView.querySelectorAll(".carousel-chevron");var e=this.el.offsetWidth+24;this.doChildSizingPercentage(e,5,2.5);var t=this.childSize.childWidth;this.carouselWrapper.style.width=e+"px";var i=Math.floor(e/t),a=Math.floor(e-t*i),n=getComputedStyle(this.childrenView[0]),o=n.marginRight,l=n.paddingRight;i=(i+=Math.floor(a/(t-parseInt(o,10)-parseInt(l,10))))||1;var s=Math.floor(this.childrenView.length/i)+(this.childrenView.length%i>0?1:0);this.scroller.style.width=i*(s+1)*t+"px",this.opts.scrollType===r.ScrollType.PAGE?(this.page.max=s,this.page.current>1&&this.page.childPerPage!==i&&(this.page.current=Math.floor(this.page.lastItemShown/i)+(this.page.lastItemShown%i>0?1:0)),this.page.childPerPage=i,this.lastItemShown()):this.page.max=this.childrenView.length-1,this.page.childPerPage=i}}},{key:"doChildSizingPercentage",value:function(e,t,i){var a=void 0;a=this.opts.isBagPage?window.innerWidth<680?i:window.innerWidth<=1024?3:t:window.innerWidth>680?t:i;var n=Math.ceil(e/a);this.childSize.childWidth=n,this.childrenView.forEach((function(e){e.style.width=n+"px"}));var r=this.el.getElementsByClassName("productThumbnailImage")[0].offsetHeight/2-18;if(this.buttons[0].parentElement.style.cssText="margin-left: 8px; top: "+r+"px !important;",this.buttons[1].parentElement.style.cssText="right: 0px; margin-right: 8px; top: "+r+"px !important;",document.getElementsByClassName("rviRemoveBtn").length){var l=.68*(0,o.default)(".rviRedesignEnabled .productThumbnailImage").innerHeight(),s=((0,o.default)(".rviRedesignEnabled .productThumbnailImage").innerWidth()-94.2344)/2;(0,o.default)(".rviRemoveBtn").css({top:l+"px",left:s+"px"})}}}]),t}(n.default);t.default=c},"92d30a0c":function(e,t,i){var a=i("4541af2a");e.exports=(a.default||a).template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="removeOverlay">\n    <button class="secondary rviRemoveBtn">Remove</button>\n</div>\n'},useData:!0})},c5f8ef0c:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=c(i("8554f259")),n=c(i("3ebdffc6")),r=c(i("ed888121")),o=c(i("138dc03a")),l=c(i("0304e3a8")),s=c(i("6f192794")),d=c(i("5dcf66de"));function c(e){return e&&e.__esModule?e:{default:e}}t.default=a.default.Model.extend({defaults:{loaded:!1},url:function(){var e=r.default.getMeta("context");return e&&!e.currencyCode&&(e.currencyCode=d.default.getCurrencyCode()||"USD"),e&&!e.regionCode&&(e.regionCode=d.default.getCountryCode()||"US"),"/xapi/digital/v1/product/"+this.attributes.productId+"?size=small"+o.default.generateContextUrlParams(e)},parse:function(e){if(e.product&&e.product.length&&(e.product[0].availability.available||this.attributes.singleFetch)){var t=e.product[0],i=Object.assign(t,{imagery:this.mapImagery(t),detail:this.mapDetail(t),pricing:this.mapPricing(t),meta:this.mapMeta(e),traits:this.mapTraits(t),imageWidth:this.mapImageWidth(t)}),a=s.default.getChildProperty(i,"pricing.badges",!1);if(a){i.detail.flags.hasFinalPrice=a.find((function(e){return e.finalPrice}))||!1;var n=i.pricing.price.tieredPrice;i.detail.flags.hasFinalPrice&&n.length>1&&n[1].values.forEach((function(e){e.type="regular"}))}var o=["268-22","268-23"],d=o[0],c=o[1],u=r.default.getMeta("properties");return i.traits.colors.colorMap=[],u.homepageRecentlyViewedEnabled&&(i.meta={properties:{listHeartsEnabled:!0,homepageRecentlyViewedEnabled:!0}},l.default.getSelectedRecipesForExperiment(o).always((function(e){e.length>0&&(e.indexOf(d)>-1||e.indexOf(c)>-1)&&(i.detail.reviewStatistics=void 0,i.pricing&&i.pricing.badges&&(i.pricing.badges=i.pricing.badges.filter((function(e){return e.finalPrice}))))}))),u.newGWPEnabled&&(i.meta.properties=Object.assign({isGWPEnabled:!0},i.meta.properties)),i.meta.properties=u,i.registry_mode=r.default.getMeta("context").shoppingMode,{product:i}}},isValid:function(){var e=!1;return this.attributes.product&&this.attributes.product.identifier&&this.attributes.product.detail&&this.attributes.product.availability&&this.attributes.product.availability.available&&this.attributes.product.pricing&&(e=!0),e},mapImagery:function(e){var t=e.imagery;return{primaryImage:t.images?t.images[0]:{},additionalImageSource:t}},mapDetail:function(e){var t=r.default.getMeta("properties"),i=e.detail;return i.brand&&(i.brand=i.brand.name,/CHANEL/i.test(i.brand)||t&&!t.rviRedesignEnabled&&(i.name=i.brand+" "+i.name)),i},mapPricing:function(e){var t=e.pricing;if(t)return t.price&&t.price.tieredPrice&&t.price.tieredPrice.length>0&&(t.price.tieredPrice=n.default.filter(t.price.tieredPrice,(function(e){return e&&e.label&&e.label.toLowerCase()!=="was [price]".toLowerCase()}))),Object.assign(t,this.mapBadges(e))},mapMeta:function(e){var t=s.default.getChildProperty(e,"meta.analytics.data"),i={analytics:{data:{}}};return t&&Object.keys(t).forEach((function(e){var a;i.analytics.data[(a=e,a.toLowerCase().replace(/[-_]+/g," ").replace(/[^\w\s]/g,"").replace(/ (.)/g,(function(e){return e.toUpperCase()})).replace(/ /g,""))]=t[e]})),i},mapTraits:function(e){var t=e.traits,i=void 0,a=r.default.getMeta("properties");if(i=a.snbTemplateUrlRemovalEnabled?{product:a.productUrlTemplate,swatch:a.swatchUrlTemplate}:e.meta&&e.meta.properties?{product:e.meta.properties.productUrlTemplate,swatch:e.meta.properties.swatchUrlTemplate}:e.urlTemplate,t&&t.colors&&t.colors.colorMap&&n.default.isObject(t.colors.colorMap)&&i){var o=Object.values(t.colors.colorMap);t.colors.colorMap=o.map((function(e){var t=Object.assign({},e);return t.imagery.primaryImage=s.default.getChildProperty(e,"imagery.images")[0]||{},t})),t.colors.urlTemplate=i}return t},mapImageWidth:function(){var e=this.get("imageWidth");if(e)return e},mapBadges:function(e){var t=e.pricing.price.finalPrice||{},i=this.getTopBadges(e);return n.default.isEmpty(t)||(i=this.badgeWithFinalPrice(i,t)),{badges:i}},badgeWithFinalPrice:function(e,t){var i=this.getFinalPricePosition(e,t),a=e.length>1?e[1].header:"";return i&&(2===i&&a&&a[0]===a[0].toUpperCase()&&(e[1].header=this.formatSecondBadge(a)),e.forEach((function(e,t){e.type=t<i?"discount":"regular"})),e.splice(i,0,{finalPrice:t})),e},getTopBadges:function(e){var t=e.pricing,i=t.badgeIds,a=void 0===i?[]:i,n=t.badgesMap,r=void 0===n?{}:n;return a.map((function(e){return r[e]})).slice(0,2)},getFinalPricePosition:function(e,t){var i=t.applicablePromotions,a=void 0===i?[]:i,r=n.default.pluck(e,"promoId"),o=0;return r.length>=a.length&&(o=n.default.intersection(r,a).length),o===a.length?o:0},formatSecondBadge:function(e){return"Plus "+e.charAt(0).toLowerCase()+e.slice(1)}})},c9e943a0:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=i("bfe5ddf1"),n=i("c4556a2b"),r=v(i("3ebdffc6")),o=v(i("8fa5214a")),l=v(i("8554f259")),s=v(i("1be88a21")),d=v(i("ed888121")),c=v(i("a5675553")),u=v(i("f0b9b09a")),f=v(i("0304e3a8")),p=v(i("89e5ba99")),h=v(i("c5f8ef0c")),g=v(i("7af1196b")),m=v(i("88342c39"));function v(e){return e&&e.__esModule?e:{default:e}}var b=i("ebe182f5");i("2bb03a14");var y=s.default.ItemView.extend({template:b,events:{"click .editRvi":"edit","click .rviEditDone":"editDone","click .rviRemoveBtn":"hideItem","click .rvi":"resetRvi"},model:new l.default.Model,collection:new g.default([],{context:d.default.getMeta("context")}),initialize:function(e){var t=this;this.id=r.default.uniqueId(),this.zone=e.zone||"",this.makeRecentlyViewedResponsive=e.makeRecentlyViewedResponsive||!1,this.itemsDisplayConfig=e.itemsDisplayConfig||{};var i=d.default.getMeta("properties");this.rviRedesignEnabled=i&&i.rviRedesignEnabled,this.rviRedesignEnabled&&this.zone.indexOf("RVI_RESP_BAG_ZONE")>-1&&f.default.getSelectedRecipesForExperiment(["527-21"]).always((function(e){e&&e.length?(t.rviRedesignEnabled=!0,t.isBagPage=!0):t.rviRedesignEnabled=!1})),this.model.set({id:this.id,itemCount:0,editMode:!1,renderCalled:!1,makeRecentlyViewedResponsive:this.makeRecentlyViewedResponsive,itemsDisplayConfig:this.itemsDisplayConfig,rviRedesignEnabled:this.rviRedesignEnabled}),void 0!==e.rviItems&&this.collection.setRviItems(e.rviItems);var a=this;this.collection.on("reset",(function(){a.render()})),this.$el.on("component::productThumbnail::clicked",(function(e,t){var i=r.default.findIndex(a.collection.models,(function(e){return(e.get("product").id||0).toString()===t}));a.trackRecentlyViewedItemClick(i+1)}))},resetRvi:function(e){var t=(0,o.default)(e.target);t.hasClass("rviRemoveBtn")||t.hasClass("m-carousel-button")||t.parent().hasClass("m-carousel-button")||((0,o.default)(".rvi").show(),(0,o.default)(".rvi li.hide").removeClass("hide"),this.model.set("editMode",!1),this.toggleEdit())},toggleEdit:function(){var e="#FeatureRvi_"+this.id;if(this.model.get("editMode")){if(new(0,i("088c64bb").default)({el:e+" .carousel .productThumbnail"}).render(),(0,o.default)(e+" .productThumbnailImage").addClass("edit"),(0,o.default)(e+" .editDoneRvi").removeClass("editRvi").addClass("rviEditDone").html("Done"),this.rviRedesignEnabled){var t=.68*(0,o.default)(e+" .productThumbnailImage").innerHeight(),a=((0,o.default)(e+" .productThumbnailImage").innerWidth()-94.2344)/2;(0,o.default)(".rviRemoveBtn").css({top:t+"px",left:a+"px"})}}else(0,o.default)(e+" .productThumbnailImage").removeClass("edit"),(0,o.default)(e+" .removeOverlay").remove(),(0,o.default)(e+" .editDoneRvi").addClass("editRvi").removeClass("rviEditDone").html("Edit")},edit:function(){this.model.set("editMode",!0),this.toggleEdit()},editDone:function(){var e=this;this.model.set("editMode",!1),(0,o.default)(".rvi li.hide").each((function(t,i){var a=(0,o.default)(i).find(".productThumbnail").attr("id");e.removeItem(a)})),u.default.getPersistent(n.RVI_STORAGE_NAME).length?this.toggleEdit():this.destroy()},removeItem:function(e){var t=this.collection.get(e),i=this.collection.indexOf(t);if(-1!==i){this.collection.remove(t),this.rviCarousel.removeChild(i),this.model.set("itemCount",this.collection.length);var a=u.default.getPersistent(n.RVI_STORAGE_NAME).split(",");a.splice(a.indexOf(e),1),(0,o.default)("#recentlyViewedContainer #"+e).parent().remove(),u.default.setPersistent(n.RVI_STORAGE_NAME,a.join(","))}},hideItem:function(e){var t=(0,o.default)(e.target).closest("li");1===(0,o.default)("#recentlyViewedContainer li:not(.hide)").length&&(0,o.default)(".rvi").hide(),(0,o.default)(t).addClass("hide")},setProduct:function(e){var t=e.get("product"),i=t.detail.name,a=t.detail.name;return i.length>26&&(i=i.substring(0,26)+"..."),t.detail.title=a,t.detail.name=i,e.set("product",t),e},onRender:function(){var e=this;if(u.default.getPersistent(n.RVI_STORAGE_NAME)&&!this.model.get("renderCalled")){var t=u.default.getPersistent(n.RVI_STORAGE_NAME).split(",");this.model.set("renderCalled",!0),this.collection=g.default.fromArray(t,{context:d.default.getMeta("context"),model:h.default}),this.collection.fetchCollection().then((function(t){t.forEach((function(t){e.setProduct(t)})),e.showProducts()}))}},showProducts:function(){var e=this,t=p.default.extend({tagName:"li"}),i=this;this.model.set("itemCount",this.collection.length),this.collection.length?(r.default.each(this.collection.models,(function(t,i){var a=t,n=a.get("product")&&a.get("product").identifier.productUrl,r=a.get("product")&&a.get("product").id,o="Browse";d.default.getMeta("pageType")&&(!0===d.default.getMeta("pageType").search?o="Search":!0===d.default.getMeta("pageType").product?o="PDP":!0===d.default.getMeta("pageType").catSplash&&(o="Catsplash"));var l=i+1;n=n+"&RVI="+o+"_"+l+"&tdp=cm_choiceId~z"+r+"~xcm_pos~zPos"+l,a.get("product")&&(a.get("product").identifier.productUrl=n,a.get("product").position=l,a.get("product").isProsPanelRedesignEnabled=e.rviRedesignEnabled)})),this.itemsDisplayConfig.noOfItems&&this.model.get("itemCount")<this.itemsDisplayConfig.noOfItems?(0,o.default)(".homePageRvi").hide():this.rviCarousel=this.createCarousel(".rvi",this.collection,t),this.toggleEdit(),(0,o.default)(".productThumbnail img").one("load",(function(){(0,o.default)(window).scroll()})),(0,o.default)("body").off("click.closeRVI").on("click.closeRVI",(function(e){!i.model.get("editMode")||i.$el.find(".scroller").has(e.target).length||(0,o.default)(e.target).hasClass("rviEditDone")||i.resetRvi(e)}))):this.destroy()},createCarousel:function(e,t,i){var n=r.default.clone(t.models),o=this.itemsDisplayConfig.noOfItems,l=n.length;if(l>o&&l%o!=0){var s=n.slice(l-o,l);n=n.slice(0,l-l%o).concat(s)}var d=n.map((function(e){return new i({model:e}).render().$el.get(0)})),c=Object.assign({},{el:e,childrenView:d,carouselType:a.HORIZONTAL,isBagPage:this.isBagPage},this.options.config);this.makeRecentlyViewedResponsive&&(c=Object.assign({},c,{overlayButtons:!0,swatch:!0,makeRecentlyViewedResponsive:!0}));var u=this.rviRedesignEnabled?new m.default(c):(0,a.createCarouselView)(c.carouselType,c);return u.render(),u},trackRecentlyViewedItemClick:function(e){var t={event_name:"recommendation link click",recommendation_position:e.toString(),recommendation_zone:this.zone,recommendation_model:"",recommendation_title:"recently viewed items"};"bcom"===d.default.brand&&r.default.extend(t,{recommendation_model:"RR",recommendation_zone:"prodrec_zsrzb"}),c.default.fireTag("link",t)},updateHeart:function(e,t){var i=e.closest(".productThumbnail").attr("id");t&&-1!==t.indexOf(i)&&e.find(".listHearts").removeClass("icon-gen-heart-gr-large").addClass("icon-gen-heart-red-large").attr("title","Remove From Default List")}});t.default=y},e1b7dc24:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var a=o(i("8fa5214a")),n=o(i("f0b9b09a")),r=i("c4556a2b");function o(e){return e&&e.__esModule?e:{default:e}}var l=void 0,s=void 0;t.default={loadWhenVisible:function(e,t){l=e;var i=(0,a.default)(l),o=(0,a.default)(window);function d(){var e=void 0;o.height()+o.scrollTop()>i.offset().top-200&&(e=n.default.getPersistent(r.RVI_STORAGE_NAME))&&e!==s&&(s=e,t(0))}i.length&&(o.on("scroll touchmove",d),d())}}},ebe182f5:function(e,t,i){var a=i("4541af2a");e.exports=(a.default||a).template({1:function(e,t,i,a,n){return" rviRedesignEnabled "},3:function(e,t,i,a,n){return"        homePageRvi\n        "},5:function(e,t,i,a,n){return"                    RECENTLY VIEWED\n"},7:function(e,t,i,a,n){return"                    recently viewed items\n"},9:function(e,t,i,a,n){return'            <a class="small editRvi editDoneRvi">edit</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){var r,o,l=null!=t?t:e.nullContext||{},s=e.escapeExpression;return'<div id="FeatureRvi_'+s("function"==typeof(o=null!=(o=i.id||(null!=t?t.id:t))?o:i.helperMissing)?o.call(l,{name:"id",hash:{},data:n}):o)+'" class="featureRvi '+(null!=(r=i.if.call(l,null!=t?t.rviRedesignEnabled:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?r:"")+'">\n    <h2 class="headerLabel\n'+(null!=(r=i.if.call(l,null!=t?t.makeRecentlyViewedResponsive:t,{name:"if",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n}))?r:"")+'">\n'+(null!=(r=i.if.call(l,null!=t?t.makeRecentlyViewedResponsive:t,{name:"if",hash:{},fn:e.program(5,n,0),inverse:e.program(7,n,0),data:n}))?r:"")+(null!=(r=i.unless.call(l,null!=t?t.makeRecentlyViewedResponsive:t,{name:"unless",hash:{},fn:e.program(9,n,0),inverse:e.noop,data:n}))?r:"")+'    </h2>\n    <div class="rvi '+s(e.lambda(null!=(r=null!=t?t.itemsDisplayConfig:t)?r.homePageClass:r,t))+'">\n\n    </div>\n</div>\n\n\n'},useData:!0})}}]);
//# sourceMappingURL=discovery-pages-mcom.vendors~rvi.44430a969a186375bb5a.js.map