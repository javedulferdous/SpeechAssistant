//tealium universal tag - utag.765 ut4.0.202009011307, Copyright 2020 Tealium.com Inc. All Rights Reserved.
function __readRMCookie(n){for(var r=n+"=",t=document.cookie.split(";"),e=0;e<t.length;e++){for(var i=t[e];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(r))return i.substring(r.length,i.length)}return""}
function __readRMCookiev2(e,o){o=o||"rmStore";for(var r=__readRMCookie(o);r!==decodeURIComponent(r);)r=decodeURIComponent(r);for(var t=r.split("|"),n=0;n<t.length;n++){var i=t[n].split(":")[0],d=t[n].split(":")[1];if(i===e)return d}return""}
function __readParam(e,o,r,a){var i=o||"",n=r||"",t=a||{},_=__readRMCookiev2(e||""),f=t[i],s=(_=t.ignoreCookie||!1?0:_)||f||n;return s=("string"!=typeof s||"false"!==s.toLowerCase())&&s}
function sRAN(){var e=DataLayer&&DataLayer.Sale&&DataLayer.Sale.Basket?DataLayer.Sale.Basket:{},a=e.affiliateConfig||{},t=__readParam("atm","tagType","pixel",a),r=__readParam("adr","discountType","order",a),o=__readParam("acs","includeStatus","false",a),n=__readParam("arto","removeOrderTax","false",a),i=__readParam("artp","removeTaxFromProducts","false",a),s=__readParam("artd","removeTaxFromDiscount","false",a),u=__readParam("atr","taxRate",0,a),m=(100+(u=Number(u)))/100,l=__readParam("ald","land",!1,{})||(a.land&&!0===a.land?__readRMCookie("ranLandDateTime"):a.land)||!1,d=__readParam("atrv","tr",!1,{})||(a.tr&&!0===a.tr?__readRMCookie("ranSiteID"):a.tr)||!1,c=!1,p=__readParam("amid","ranMID","",a)||e.ranMID;if(!p)return!1;if(!(void 0===a.allowCommission||"false"!==a.allowCommission))return!1;var N=encodeURIComponent(e.orderid||"OrderNumberNotAvailable"),C="",_="",b="",y="",v=e.currency||"";v=encodeURIComponent(v.toUpperCase());var R=e.taxAmount?Math.abs(Math.round(100*Number(e.taxAmount))):0,T=e.discountAmount?Math.abs(Math.round(100*Number(e.discountAmount))):0;s&&u&&(T=Math.round(T/m));var f="pixel"===t?"ep":"mop"===t?"eventnvppixel":"ep",D=e.customerStatus||"",I=document.location.protocol+"//track.linksynergy.com/"+f+"?",P="";null!=D&&""!=D&&(o&&"EXISTING"==D.toUpperCase()||o&&"RETURNING"==D.toUpperCase())&&(P="R_");for(var h=[],S=0,U=0;U<(e.lineitems?e.lineitems.length:0);U++){var x=!1,g=window.JSON?JSON.parse(JSON.stringify(e.lineitems[U])):e.lineitems[U],L=Number(g.unitPrice||0);i&&u&&!g.unitPriceLessTax&&(L/=m);for(var O=0;O<h.length;O++){h[O].SKU===g.SKU&&(x=!0,h[O].quantity=Number(h[O].quantity)+Number(g.quantity),h[O].totalValueLessTax=Number(h[O].totalValueLessTax)+Number(g.quantity)*L,h[O].totalValue=Number(h[O].totalValue)+Number(g.quantity)*Number(g.unitPrice))}x||(g.totalValue=Number(g.quantity)*Number(g.unitPrice),g.totalValueLessTax=Number(g.quantity)*L,h.push(g)),S+=Number(g.quantity)*L*100}var A={};for(U=0;U<h.length;U++){g=h[U];var w=encodeURIComponent(g.SKU),q=g.totalValueLessTax||g.totalValue,M=g.quantity,V=encodeURIComponent(g.productName)||"",k=100*Number(q);"item"===r.toLowerCase()&&T&&(k-=T*k/S);var E=g.optionalData;for(var B in E)E.hasOwnProperty(B)&&(A[B]=A[B]||"",A[B]+=encodeURIComponent(E[B])+"|");C+=P+w+"|",_+=M+"|",b+=Math.round(k)+"|",y+=P+V+"|"}C=C.slice(0,-1),_=_.slice(0,-1),b=b.slice(0,-1),y=y.slice(0,-1),T&&"order"===r.toLowerCase()?(C+="|"+P+"DISCOUNT",y+="|"+P+"DISCOUNT",_+="|0",b+="|-"+T):T&&"item"===r.toLowerCase()&&(c=!0),n&&R&&(C+="|"+P+"ORDERTAX",_+="|0",b+="|-"+R,y+="|"+P+"ORDERTAX"),I+="mid="+p+"&ord="+N+"&skulist="+C+"&qlist="+_+"&amtlist="+b+"&cur="+v+"&namelist="+y+"&img=1&",l&&(I+="land="+l+"&"),d&&(I+="tr="+d+"&"),c&&(I+="discount="+T+"&");E=e.optionalData||{};for(var B in e.discountCode&&(E.coupon=e.discountCode),e.customerStatus&&(E.custstatus=e.customerStatus),e.customerID&&(E.custid=e.customerID),T&&(E.disamt=T),E)E.hasOwnProperty(B)&&(I+=encodeURIComponent(B)+"="+encodeURIComponent(E[B])+"&");for(var B in A)A.hasOwnProperty(B)&&(I+=encodeURIComponent(B)+"list="+A[B].slice(0,-1),T&&"order"===r.toLowerCase()&&(I+="disamt"==B||"margin"==B?"|0":"|DISCOUNT"),R&&n&&(I+="disamt"==B||"margin"==B?"|0":"|ORDERTAX"),I+="&");"&"===I[I.length-1]&&(I=I.slice(0,-1)),2037<I.length&&(I=I.slice(0,2037),I+="&trunc=true");var X,J=document.createElement("img");J.setAttribute("src",I),J.setAttribute("height","1px"),J.setAttribute("width","1px"),(X=document.getElementsByTagName("script")[0]).parentNode.insertBefore(J,X)}
function IsJsonString(str){try{JSON.parse(str);}catch(e){return false;}
return true;}
try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag.ut===undefined){utag.ut={};}
if(utag.ut.loader===undefined){u.loader=function(o){var b,c,l,a=document;if(o.type==="iframe"){b=a.createElement("iframe");o.attrs=o.attrs||{"height":"1","width":"1","style":"display:none"};for(l in utag.loader.GV(o.attrs)){b.setAttribute(l,o.attrs[l]);}
b.setAttribute("src",o.src);}else if(o.type=="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";for(l in utag.loader.GV(o.attrs)){b[l]=o.attrs[l];}
b.src=o.src;}
if(o.id){b.id=o.id;}
if(typeof o.cb=="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){this.onreadystatechange=null;o.cb();}};}}
l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l=="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}};}else{u.loader=utag.ut.loader;}
if(utag.ut.typeOf===undefined){u.typeOf=function(e){return({}).toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase();};}else{u.typeOf=utag.ut.typeOf;}
u.ev={"view":1};u.map={"product_sub_total":"product_unit_price","product_upc":"product_id"};u.extend=[];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var c,d,e,f;var TK="";var DD=document.domain;if(DD.indexOf("fds.com")>-1){TK="114515";}
else if(DD.indexOf("macys.com")>-1||DD.indexOf("macysbackstage.com")>-1){TK="112046";}
u.data={"qsp_delim":"&","kvp_delim":"=","base_url":"//intljs.rmtag.com/"+TK+".ct.js","lineitems":[],"item":{},"product_id":[],"product_name":[],"product_quantity":[],"product_unit_price":[],"product_discount":[]};c=[];for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
u.data.order_id=u.data.order_id||b._corder||"";u.data.order_subtotal=u.data.order_subtotal||b._csubtotal||"";u.data.order_tax=u.data.order_tax||b._ctax||"";u.data.order_currency=u.data.order_currency||b._ccurrency||"";u.data.order_coupon_code=u.data.order_coupon_code||b._cpromo||"";u.data.customer_id=u.data.customer_id||b._ccustid||"";if(u.data.product_id.length===0&&b._cprod!==undefined){u.data.product_id=b._cprod.slice(0);}
if(u.data.product_name.length===0&&b._cprodname!==undefined){u.data.product_name=b._cprodname.slice(0);}
if(u.data.product_quantity.length===0&&b._cquan!==undefined){u.data.product_quantity=b._cquan.slice(0);}
if(u.data.product_unit_price.length===0&&b.product_sub_total!==undefined){u.data.product_unit_price=b.product_sub_total.slice(0);}
if(u.data.product_discount.length===0&&b._cpdisc!==undefined){u.data.product_discount=b._cpdisc.slice(0);}
window.DataLayer||(window.DataLayer={}),DataLayer.events||(DataLayer.events={});window.DataLayer.events.SiteSection=u.data.siteSection||"1";u.loader({"type":"script","src":u.data.base_url,"cb":null,"loc":"script","id":'utag_765'});if(!!u.data.order_id){var obj=(window.JSON&&IsJsonString(localStorage.getItem('__rmStore'))?JSON.parse(localStorage.getItem('__rmStore')):'');var land=obj.ald||'';var tr=obj.atrv||'';g={};g.orderid=u.data.order_id;g.affiliateConfig={ranMID:3184,tagType:"mop",discountType:'item',land:land,tr:tr};g.currency=u.data.order_currency||"";g.customerStatus="";g.conversionType=u.data.conversionType||"Sale";g.customerID=u.data.customer_id||"";g.discountCode=u.data.order_coupon_code||"";g.discountAmount=0;if(u.data.order_tax){g.taxAmount=u.data.order_tax;}
g.allowCommission=u.data.allowCommission;if(u.data.product_id.length>0){g.lineitems=[];}
for(var i=0;i<u.data.product_id.length;i++){u.data.item={};u.data.item.quantity=u.data.product_quantity[i];if(u.data.product_unit_price[i]){u.data.item.unitPriceLessTax=u.data.product_unit_price[i];u.data.item.unitPrice=u.data.product_unit_price[i]/u.data.product_quantity[i];}
u.data.item.SKU=u.data.product_id[i];u.data.item.productName=u.data.product_name[i];g.lineitems.push(u.data.item);}
window.rm_trans=g;if(!window.DataLayer){window.DataLayer={Sale:{Basket:rm_trans}};}else{DataLayer.Sale=DataLayer.Sale||{Basket:rm_trans};DataLayer.Sale.Basket=DataLayer.Sale.Basket||rm_trans;}
DataLayer.Sale.Basket.Ready=true;sRAN();}
}};utag.o[loader].loader.LOAD(id);}("765","macys.main"));}catch(error){utag.DB(error);}
