(function(g,c){"object"===typeof module&&"object"===typeof module.exports?module.exports=g.document?c(g):function(a){if(!a.document)throw Error("TagDeliveryData requires a window with a document");return c(a)}:c(g)})("undefined"!==typeof window?window:this,function(g){var c={GLOBAL_NAME:"TagDeliveryData",HOST:"data.tagdelivery.com",PROTOCOL:"https://",PID:"pid",LOADED:!1,requests:[],errors:[],isLoaded:function(){return c.LOADED},onLoadHandler:function(a){c.LOADED=!0;c.log("Page Loaded")}};g.addEventListener?
g.addEventListener("load",c.onLoadHandler):g.attachEvent("onload",c.onLoadHandler);c.log=function(){this.Log.add.apply(this.Log,[].slice.call(arguments))};c.collect=function(){var a=new this.Request([].slice.call(arguments));a.send();this.requests.push(a);var b=a.hasErrors();b&&Array.prototype.push.apply(this.errors,a.errors);return!b};c.getErrors=function(){return this.errors.splice(0)};c.Util=function(){return{generateUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})},attachImage:function(a){var b=document.createElement("img");b.src=a;return b},getType:function(a){var b=typeof a;"object"==b&&"[object Array]"===Object.prototype.toString.call(a)&&(b="array");return b},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},isObject:function(a){return"[object Object]"==Object.prototype.toString.call(a)},arrayToQueryString:function(a){for(var b=[],d=0,e=a.length;d<e;d++)b.push(encodeURIComponent(a[d]));
return b.join(",")},objectToQueryString:function(a){var b=[],d;for(d in a)if(null!==a[d]){var e=this.getType(a[d]);e="array"==e&&0<a[d].length?this.arrayToQueryString(a[d]):"object"==e?encodeURIComponent(this.objectToQueryString(a[d])):encodeURIComponent(a[d]);b.push(d+"="+e)}return b.join("&")},assign:function(){for(var a=[].slice.call(arguments),b=a.shift(),d=0,e=a.length;d<e;d++)for(var h in a[d])a[d].hasOwnProperty(h)&&(b[h]=a[d][h]);return b},inArray:function(a,b){for(var d=0,e=a.length;d<e;d++)if(a[d]===
b)return!0;return!1}}}();c.Log=function(){return{entries:[],toConsole:!1,add:function(){var a=[].slice.call(arguments);a.unshift(new Date);this.entries.push(a);this.toConsole&&this.print(a)},print:function(a){a=a.slice(0);a[0]=a[0].toTimeString().substr(0,8)+"."+("000"+a[0].getMilliseconds()).substr(-3);a.unshift(_tdc.GLOBAL_NAME);try{console.log.apply(console,a)}catch(b){}}}}();c.Request=function(){return function(a){this.id=c.Util.generateUuid();this.inputs=c.Util.isArray(a)?a:[];this.events={"conversion:summary":[["txnid"],
"customer user items currency revenue shipping tax tags".split(" "),{items:"conversion:item"}],"conversion:item":[["txnid","sku"],"customer user qty price customer brand supplier rfc sfc currency tags".split(" ")]};this.errors=[];this.event=null;this.parameters={};this.children=[];this.baseUrl=c.PROTOCOL+c.HOST+"/collect?";this.url=null;this.requestedAt=+new Date;this.sentAt=null;c.log("received request",this.id,this.inputs);this.parse=function(){if(0===this.inputs.length)this.addError("No arguments supplied");
else{this.event=String(this.inputs[0]).toLowerCase();var b=1<this.inputs.length&&c.Util.isObject(this.inputs[1])?this.inputs[1]:{},d=3<=this.events[this.event].length?this.events[this.event][2]:{};_parseZulilyConversions=function(v,p){for(var q=[],r=p.sku.split(","),w=p.price.split(","),m={},k=0;k<r.length;k++)m[r[k]]=w[k];for(var t in m)q.push([v,{sku:t,price:m[t],qty:1}]);return q};for(var e=0;2>e;e++){var h=this.events[this.event][e],u=!e;u&&h.unshift(c.PID);for(var n=0,x=h.length;n<x;n++){var f=
h[n];if(b.hasOwnProperty(f))if(d.hasOwnProperty(f))for(var l=0,y=b[f].length;l<y;l++)if(11===b.pid){this.children=_parseZulilyConversions(d[f],b[f][l]);break}else this.children.push([d[f],b[f][l]]);else this.parameters[f]=b[f];else u&&this.addError("Missing required parameter "+f+" for the event "+this.event)}}this.parameters.e=this.event}};this.addError=function(b){this.errors.push(b)};this.hasErrors=function(){return 0<this.errors.length};this.setUrl=function(){this.url=this.baseUrl+c.Util.objectToQueryString(this.parameters)};
this.send=function(){this.parse();if(!this.hasErrors()){this.setUrl();this.sentAt=+new Date;c.Util.attachImage(this.url);c.log("url called after",this.id,this.sentAt-this.requestedAt,this.url);for(var b=0,d=this.children.length;b<d;b++)c.collect(this.children[b][0],c.Util.assign(this.parameters,this.children[b][1]))}}}}();"function"===typeof define&&define.amd&&define("tagDeliveryData",[],function(){return c});return g[c.GLOBAL_NAME]=c});