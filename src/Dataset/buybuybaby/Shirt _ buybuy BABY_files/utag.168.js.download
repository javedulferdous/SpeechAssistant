//tealium universal tag - utag.168 ut4.0.202010151000, Copyright 2020 Tealium.com Inc. All Rights Reserved.
try{(function(id,loader){const u={id};utag.o[loader].sender[id]=u;if(utag.ut===undefined){utag.ut={};}
const match=/ut\d\.(\d*)\..*/.exec(utag.cfg.v);if(utag.ut.loader===undefined||!match||parseInt(match[1])<41){u.loader=function(o,a,b,c,l,m){utag.DB(o);a=document;if(o.type=='iframe'){m=a.getElementById(o.id);if(m&&m.tagName=='IFRAME'){b=m;}else{b=a.createElement('iframe');}
o.attrs=o.attrs||{};utag.ut.merge(o.attrs,{height:'1',width:'1',style:'display:none'},0);}else if(o.type=='img'){utag.DB(`Attach img:${o.src}`);b=new Image();}else{b=a.createElement('script');b.language='javascript';b.type='text/javascript';b.async=1;b.charset='utf-8';}
if(o.id){b.id=o.id;}
for(l in utag.loader.GV(o.attrs)){b.setAttribute(l,o.attrs[l]);}
b.setAttribute('src',o.src);if(typeof o.cb==='function'){if(b.addEventListener){b.addEventListener('load',()=>{o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){this.onreadystatechange=null;o.cb();}};}}
if(o.type!='img'&&!m){l=o.loc||'head';c=a.getElementsByTagName(l)[0];if(c){utag.DB(`Attach to ${l}:${o.src}`);if(l=='script'){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}}};}else{u.loader=utag.ut.loader;}
if(utag.ut.typeOf===undefined){u.typeOf=function(e){return{}.toString
.call(e)
.match(/\s([a-zA-Z]+)/)[1]
.toLowerCase();};}else{u.typeOf=utag.ut.typeOf;}
u.ev={view:1,link:1};u.initialized=false;u.scriptrequested=false;u.queue=[];let session_id='',product_metadata=[],isRIS=false;u.map={"groupbySearchId":"search_id"};u.extend=[];u.loader_cb=function(a,b,c){utag.DB('send:168:CALLBACK');u.initialized=true;let i,j,k,l,product_collection=[],product_data={},event_data={},missing_items=[],required_items=['product_id','product_name','product_unit_price'];session_id=u.data.session_id||b['ut.session_id'];let isProductView=false;let isSearchView=false;let collection=[];const siteIdLC=(b["site_id"]&&b["site_id"].toLowerCase())||'bbby';const isCASite=siteIdLC==='bbbca'||siteIdLC==='bbbytbs.ca';const isBABYSite=siteIdLC==='baby'||siteIdLC==='buybuybabytbs.com';const isTealiumProdQAEnv=b.tealium_environment==='prod'||b.tealium_environment==='qa';const testEnvDomains=['et01-www.bbbyapp.com','et01-www.bbbycaapp.com','et01-www.bbbabyapp.com'];if(isTealiumProdQAEnv){collection=['searchProductionUS'];if(isCASite){collection=['searchProductionCA'];}else if(isBABYSite){collection=['searchProductionBaby'];}}else if(testEnvDomains.indexOf(b['dom.domain'])!==-1){collection=['searchTestUS'];if(isCASite){collection=['searchTestCA'];}else if(isBABYSite){collection=['searchTestBaby'];}}else{collection=['searchDevUS'];if(isCASite){collection=['searchDevCA'];}else if(isBABYSite){collection=['searchDevBaby'];}}
if(isTealiumProdQAEnv){u.data.area='ProductionBBBYUS';if(isCASite){u.data.area='ProductionBBBYCA';}else if(isBABYSite){u.data.area='ProductionBuyBuyBaby';}}else{u.data.area='StagingBBBYUS';if(isCASite){u.data.area='StagingBBBYCA';}else if(isBABYSite){u.data.area='StagingBuyBuyBaby';}}
if(typeof window.gbTracker==='undefined'){window.gbTracker=new GbTracker(u.data.customer_id,u.data.area);gbTracker.autoSetVisitor(u.data.visitor_id,session_id);}
if(u.data.order_id&&u.data.event.indexOf('sendOrderEvent')===-1){u.data.event.push('sendOrderEvent');}
if((b.page_name==='quick view modal'||b.page_name==='ProductDetails'||b.page_name==='add to cart')&&b['ut.event']==='view'){u.data.event.push('sendViewProductEvent');isProductView=true;}
const pageViewIds=['SubCategoryDetails','SearchResults','CategoryLandingDetails','BrandLandingDetails',];const pageLinkIds=['facet selection','pagination','sort btn'];const pageLinkActions=["remove from facets","clear all facets","change products displayed"];if((pageViewIds.indexOf(b["page_name"])!==-1&&b['ut.event']==='view')||(pageLinkIds.indexOf(b["page_name"])!==-1&&b['ut.event']==='link')||pageLinkActions.indexOf(b.call_to_actiontype)!==-1){u.data.event.push('sendAutoSearchEvent');isSearchView=true;}
const call_to_actiontype=b.call_to_actiontype;if(pageLinkIds.indexOf(b.container)==-1&&call_to_actiontype==='prc_impression'&&b['ut.event']==='link'){u.data.event.push('sendAutoSearchEvent');}
if((b['ut.event']==='link'&&(b.page_name==='add to cart'&&call_to_actiontype==='add to cart'))||(call_to_actiontype==='reserve in store'&&(b.page_name==='ProductDetails'||b.page_name==='SearchResults'||b.page_name==='BrandLandingDetails'||b.cart_add_location==="PLP"))||(b.page_name==='add to registry'&&call_to_actiontype==='add to registry')||(b.page_name==='add to cart'&&call_to_actiontype==='add to cart from prc')){const isChooseOptionModal=document.querySelector("[data-locator='chooseOptionModal_productImage']");const isMCID=(b['qp.mcid']!==undefined&&!b['qp.mcid'].includes("PS_googlepla"))?true:false;isProductView=true;u.data.event=[];((b.cart_add_location==="Product Details Page"&&b.page_type==="Product Details Page"&&b['cp.previous_event_name']!=="certona product click"&&!isMCID)||(b.cart_add_location==="Quickview Page"&&b["cp.previous_event_name"]==="prc_impression")||(b.cart_add_location==="PLP"&&b.call_to_actiontype==="reserve in store"&&!isChooseOptionModal)||(b.cart_add_location==="SearchResults"&&b.call_to_actiontype==="reserve in store"&&!isChooseOptionModal)||(b.cart_add_location==="BrandLanding"&&b.call_to_actiontype==="reserve in store"&&!isChooseOptionModal)||((b.registry_add_location==="BrandLanding"||b.registry_add_location==="SearchResults"||b.registry_add_location==="PLP")&&b.call_to_actiontype==="add to registry"&&b.account_type==="guest"&&b.isChooseOption!=="true")||(b.cart_add_location==="Quickview Page"&&b.call_to_actiontype==="add to cart"&&b.internal_search_term===undefined)||(b.registry_add_location==="Quickview Page"&&!isChooseOptionModal)||b.registry_add_location==="Product Detail Page"||(b.registry_add_location==="SearchResults"&&!(b.page_type==="Product Details Page")))?u.data.event.push('sendAddToCartEvent'):u.data.event.push('sendViewProductEvent','sendAddToCartEvent');if(call_to_actiontype!==undefined){var meta_atc_pick_it_up_atr="";switch(call_to_actiontype){case"add to cart":meta_atc_pick_it_up_atr='ATC';break;case"add to cart from prc":meta_atc_pick_it_up_atr='ATC';break;case"reserve in store":meta_atc_pick_it_up_atr='Pick it Up';break;case"add to registry":meta_atc_pick_it_up_atr='Add to Reg';break;default:meta_atc_pick_it_up_atr="";}}}
for(j=0;j<u.data.event.length;j++){if(u.data.event[j]==='autoSetVisitor'){if(u.data.visitor_id!=='anonymous'){gbTracker.autoSetVisitor(u.data.visitor_id,session_id);}else{gbTracker.autoSetVisitor();}}else if(u.data.event[j]==='sendViewProductEvent'||u.data.event[j]==='sendAddToCartEvent'||u.data.event[j]==='sendRemoveFromCartEvent'||u.data.event[j]==='sendOrderEvent'){gbTracker.autoSetVisitor(u.data.visitor_id,session_id);if(u.data.event_metadata.length>0){event_data.event_metadata=u.data.event_metadata;}
if(u.data.event[j]!=='sendViewProductEvent'){required_items.push('product_quantity');}
for(i=0;i<required_items.length;i++){if(u.data[required_items[i]].length===0){missing_items.push(required_items[i]);}}
if(missing_items.length>0){utag.DB(`${u.id}:GroupBy ${u.data.event[j]}missing the following required parameters:${missing_items.join(', ')}`);}
if(b.order_id&&b.order_id.length>0){product_metadata.push({key:'Tax',value:b.order_tax_amount||""},{key:'Shipping charge',value:b["order_shipping_amount"]||""},{key:'Shipping Discount',value:b.order_shipping_discount||""});event_data.metadata=product_metadata;product_metadata=[];}
if(isProductView&&u.data.event[j]==='sendViewProductEvent'){let brandId="";let searchTerm=b.search_keyword||b.search_words_applied||"";let pathName=b["dom.pathname"]||"";if(pathName.includes('/store/brand/')){const pathArr=pathName.split('/');const path=pathArr.filter(data=>!data.includes("-")&&data!=="");brandId=path[path.length-1];}
searchTerm=((searchTerm==='non search'||searchTerm==="non-search")&&pathName.includes('/store/product/'))?(b["cp.last_search_term"]!=='non-search'?b["cp.last_search_term"]:""):searchTerm;if(!pathName.includes('/store/s/')&&!pathName.includes('/store/product/')&&!b["cp.utag_main_previous_full_pathname"].includes('/store/s/')){searchTerm="";}
let catId=(!pathName.includes('/store/brand/')&&!pathName.includes('/store/s/')&&!b["cp.utag_main_previous_full_pathname"].includes('/store/brand/'))&&!b["cp.utag_main_previous_full_pathname"].includes('/store/s/')&&(!b["cp.utag_main_previous_full_pathname"].includes('/store/product/')&&!b["cp.utag_main_previous_full_pathname"].includes('ta=typeahead&keyword='))&&b["qp.opbthead"]===undefined?b.sub_sub_category_id||b.subcategory_id||b.category_id||"":"";if((catId===''||catId===undefined)&&pathName.includes('/store/category/')){let temp=b["dom.pathname"].split('/');catId=temp[temp.length-2];}
if(((b.container==="solrRecommendation"||b["qp.mcid"]&&b["qp.mcid"].startsWith("PS_googlepla_"))&&b.strategy)||(b["cp.previous_page_name"]==="quick view modal"&&b["cp.previous_event_name"]==="modal product click")||(b.page_name==="quick view modal"&&b.page_type==="Product Details Page"&&(b["qp.mcid"]!==undefined&&b["qp.mcid"]==="PS_googlepla_nonbrand_brand_local"))){let container_id;if(b["cp.previous_page_name"]==="quick view modal"&&b["cp.previous_event_name"]==="modal product click"){container_id="quickview";}
if(b.page_name==="quick view modal"&&b.page_type==="Product Details Page"&&(b["qp.mcid"]!==undefined&&b["qp.mcid"]==="PS_googlepla_nonbrand_brand_local")){container_id="pdp_collcav";}
product_metadata.push({"key":"Container_Id","value":container_id?container_id:(b.strategy||''),},{"key":"Experiment","value":b.boosted_search_engine||"solr_s1",});}else{product_metadata.push({key:'search_term',value:searchTerm,},{key:'category_id',value:catId,},{key:'brand_id',value:((!pathName.includes('/store/s/')&&!pathName.includes('/store/category/'))&&!b["cp.utag_main_previous_full_pathname"].includes('/store/category/')&&!b["cp.utag_main_previous_full_pathname"].includes('/store/s/'))&&(!b["cp.utag_main_previous_full_pathname"].includes('/store/product/')&&!b["cp.utag_main_previous_full_pathname"].includes('ta=typeahead&keyword='))&&b["qp.opbthead"]===undefined?(brandId||b.brand_id):"",},{key:'CollectionID',value:b.product_collection_id||"",},{key:'Experiment',value:b.boosted_search_engine||"",});}
event_data.metadata=product_metadata;product_metadata=[];isProductView=false;}
if(u.data.event[j]==='sendAddToCartEvent'){let brandId="";let pathName=b["dom.pathname"]||"";if(pathName.includes('/store/brand/')){const pathArr=pathName.split('/');const path=pathArr.filter(data=>!data.includes("-")&&data!=="");brandId=path[path.length-1];}
let catId=((!pathName.includes('/store/brand/')&&!pathName.includes('/store/s/')&&!b.page_referrer_url.includes('/store/brand/')&&!b.page_referrer_url.includes('/store/s/'))||pathName.includes('/store/category/'))?b.sub_sub_category_id||b.subcategory_id||b.category_id||b["qp.categoryId"]||"":"";let brand_id=(!pathName.includes('/store/s/')&&!pathName.includes('/store/category/')&&!b.page_referrer_url.includes('/store/category/')&&!b.page_referrer_url.includes('/store/s/'))?brandId||b.brand_id||b["qp.brandId"]||"":"";let searchTerm=b.search_keyword||b.search_words_applied||b["qp.keyword"]||b["cp.last_search_term"]||"";searchTerm=(searchTerm==="non-search"||searchTerm==='non search')?"":searchTerm;if((catId===''||catId===undefined)&&pathName.includes('/store/category/')){let temp=b["dom.pathname"].split('/');catId=temp[temp.length-2];}
if(b.call_to_actiontype==="add to cart from prc"||(b['cp.previous_event_name']==="certona product click"&&(b["qp.mcid"]!==undefined&&b['qp.mcid'].includes("PS_googlepla"))&&b.page_type==="Product Details Page")||b["qp.strategy"]!==undefined&&b["qp.strategy"]!==""&&b.page_type==="Product Details Page"){let strategy=(b['cp.previous_event_name']==="certona product click"&&(b["qp.mcid"]!==undefined&&b['qp.mcid'].includes("PS_googlepla"))&&b.page_type==="Product Details Page")?"pdp_collcav":"";product_metadata.push({"key":"Container_Id","value":b.strategy||strategy||b["qp.strategy"]||'',},{"key":"Experiment","value":b.boosted_search_engine||"solr_s1"});}
else{product_metadata.push({key:meta_atc_pick_it_up_atr||"",value:true,},{key:'search_term',value:(!catId&&!brand_id)?searchTerm:"",},{key:'category_id',value:catId,},{key:'brand_id',value:brand_id,},{key:'CollectionID',value:b.product_collection_id||"",},{key:'Experiment',value:b.boosted_search_engine||"",});}
event_data.metadata=product_metadata;product_metadata=[];isProductView=false;}
const productIdLength=(u.data.product_id&&u.data.product_id.length)||0;for(k=0;k<productIdLength;k++){product_data.productId=(u.data.product_id&&u.data.product_id[k])||'';if((b.product_sku_name&&typeof b.product_sku_name==="string")||(b.product_name&&typeof b.product_name==="string")){product_data.title=b.product_sku_name||b.product_name||"";}else{product_data.title=(b.product_sku_name&&b.product_sku_name[k])||(b.product_name&&b.product_name[k])||'';}
product_data.price=(b.product_price&&b.product_price[k])||(b.Cart_Product_price&&b.Cart_Product_price[k])||'';if((b.product_price[k]!==''&&b.product_price[k].indexOf("$")>-1)||(product_data.price!==''&&product_data.price.indexOf("$")>-1)){product_data.price=Number(product_data.price.replace(/[^0-9.-]+/g,''));}
if(u.data.product_quantity&&u.data.product_quantity.length>0&&u.data.event[j]!=='sendViewProductEvent'){product_data.quantity=u.data.product_quantity[k];}
if((collection&&collection.length>0)||(u.data.product_brand&&u.data.product_brand.length>0)){product_data.collection=collection[0]||u.data.product_brand[k];}
if(u.data.product_category&&u.data.product_category.length>0){product_data.category=u.data.product_category[k];}
if((u.data.product_sku&&u.data.product_sku.length>0)||(b.product_sku&&b.product_sku.length>0)||(b.product_sku_id&&b.product_sku_id.length>0)){product_data.sku=u.data.product_sku[k]||b.product_sku_id[k]||b.product_sku;}
if(u.data.product_margin&&u.data.product_margin.length>0){product_data.margin=u.data.product_margin[k];}
product_collection.push(product_data);product_data={};}
if(u.data.event[j]==='sendViewProductEvent'){event_data.product=product_collection[0];}else{event_data.cart={};if(u.data.cart_id){event_data.cart.id=u.data.cart_id;}else if(u.data.order_id){event_data.cart.id=u.data.order_id;}
if(u.data.cart_metadata&&u.data.cart_metadata.length>0){event_data.cart.metadata=u.data.cart_metadata;}
event_data.cart.items=product_collection;if(u.data.order_id){event_data.cart.totalItems=u.data.product_id&&u.data.product_id.length>0?u.data.product_id.length:1;if(u.data.product_quantity&&u.data.product_quantity.length>0){event_data.cart.totalQuantity=0;for(l=0;l<u.data.product_quantity.length;l++){event_data.cart.totalQuantity+=parseInt(u.data.product_quantity[l]);}}else{event_data.cart.totalQuantity=1;}
if(u.data.order_total||u.data.order_grand_total){event_data.cart.totalPrice=u.data.order_total||u.data.order_grand_total;}}}
if(b.call_to_actiontype==="reserve in store"){isRIS=true;}else if(isRIS&&u.data.event[j]!=="sendViewProductEvent"&&u.data.event[0]==="sendViewProductEvent"&&u.data.event[1]==="sendAddToCartEvent"){event_data.metadata[0].key="Pick it Up";isRIS=false;}
gbTracker[u.data.event[j]](event_data);product_collection=[];event_data={};}else if(u.data.event[j]==='sendSearchEvent'||u.data.event[j]==='sendAutoSearchEvent'){event_data.search={};gbTracker.autoSetVisitor(u.data.visitor_id,session_id);if(b["qp.flyout"]!=="true"&&(b['dom.pathname'].includes('/store/s')||b['product_finding_method']==='internal keyword search')){u.data.search_origin='search';}
else if(b['ut.event']==='view'&&b["qp.flyout"]==="true"&&b["page_name"]==="SearchResults"){u.data.search_origin='sayt';}
else{u.data.search_origin='navigation';}
event_data.search.origin={recommendations:false,dym:false,sayt:false,search:false,navigation:false,};switch(u.data.search_origin.toLowerCase()){case'recommendations':event_data.search.origin.recommendations=true;break;case'dym':event_data.search.origin.dym=true;break;case'sayt':event_data.search.origin.sayt=true;break;case'search':event_data.search.origin.search=true;break;case'navigation':event_data.search.origin.navigation=true;break;default:event_data.search.origin.search=true;}
if(u.data.event[j]==='sendAutoSearchEvent'&&isSearchView){if(u.data.search_id){event_data.search.id=u.data.search_id;gbTracker.sendAutoSearchEvent(event_data);isSearchView=false;event_data={};}else{utag.DB(`${u.id}:Missing required parameter search_id for GroupBy sendAutoSearchEvent.Event not triggered.`);}}}}
utag.DB('send:168:CALLBACK:COMPLETE');};u.callBack=function(){let data={};while((data=u.queue.shift())){u.data=data.data;u.loader_cb(data.a,data.b,data.c);}};u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){utag.DB('send:168');utag.DB(b);let c,d,e,f,h;u.data={customer_id:'bedbathbeyond',base_url:'//cdn.groupbycloud.com/dist/gb-tracker-client-3.min.js',area:'',visitor_id:'',session_id:'',event_metadata:[],product_id:[],product_quantity:[],product_name:[],product_brand:[],product_category:[],product_sku:[],product_margin:[],product_metadata:[],product_unit_price:[],product_discount:[],product_position:[],cart_id:'',cart_total_items:0,cart_metadata:[],search_id:'',search_area:'',search_origin:'',search_query:'',search_count:'',record_start:'',record_end:'',biasing_profile:'',did_you_mean:[],available_navigation:[],selected_navigation:[],records:[],match_strategy:'',event:[],};utag.DB('send:168:EXTENSIONS');utag.DB(b);c=[];for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==''){e=u.map[d].split(',');for(f=0;f<e.length;f++){if(u.data.hasOwnProperty(e[f])){u.data[e[f]]=b[d];}else{u.data.custom[e[f]]=b[d];}}}else{h=d.split(':');if(h.length===2&&b[h[0]]===h[1]){if(u.map[d]){u.data.event=u.data.event.concat(u.map[d].split(','));}}}}
utag.DB('send:168:MAPPINGS');utag.DB(u.data);u.data.visitor_id=u.data.visitor_id||b['ut.visitor_id']||'anonymous';u.data.session_id=session_id||b['cp.utag_main_ses_id']||'';u.data.order_id=u.data.order_id||b._corder||'';u.data.order_total=u.data.order_total||b._ctotal||'';if(u.data.product_id.length===0&&b._cprod!==undefined){u.data.product_id=b._cprod.slice(0);}
if(u.data.product_quantity.length===0&&b._cquan!==undefined){u.data.product_quantity=b._cquan.slice(0);}
if(u.data.product_name.length===0&&b._cprodname!==undefined){u.data.product_name=b._cprodname.slice(0);}
if(u.data.product_unit_price.length===0&&b._cprice!==undefined){u.data.product_unit_price=b._cprice.slice(0);}
if(u.data.product_brand.length===0&&b._cbrand!==undefined){u.data.product_brand=b._cbrand.slice(0);}
if(u.data.product_sku.length===0&&b._csku!==undefined){u.data.product_sku=b._csku.slice(0);}
if(u.data.product_category.length===0&&b._ccat!==undefined){u.data.product_category=b._ccat.slice(0);}
if(u.data.product_discount.length===0&&b._cpdisc!==undefined){u.data.product_discount=b._cpdisc.slice(0);}
if(!u.data.customer_id){utag.DB(`${u.id}:Tag not fired:Required attribute customer_id not populated`);return;}
if(u.initialized){u.loader_cb(a,b,c);}else{u.queue.push({data:u.data,a,b,c});if(!u.scriptrequested){u.scriptrequested=true;u.loader({type:'script',src:u.data.base_url,cb:u.callBack,loc:'script',id:'utag_168',attrs:{},});}}
utag.DB('send:168:COMPLETE');}};utag.o[loader].loader.LOAD(id);})('168','bbb.bbb-feo');}catch(error){utag.DB(error);}
