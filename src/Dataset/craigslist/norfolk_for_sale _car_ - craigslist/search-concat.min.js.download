if(window.clUnsupportedBrowser)throw"unsupported browser";$.widget("custom.dropdown",{options:{onSelect:function(){}},_create:function(){this._setDropdownToCurrentSelection(),this._on(this.element,{click:function(e){$(this.element).children(".dropdown-list").hasClass("dropdown-show")?(this._closeDropdown(),this._unfocus(),this.options.onSelect(e),this._setDropdownToCurrentSelection()):(e.preventDefault(),this._openDropdown())},keydown:function(e){var t=$(e.target),n=$(this.element),a=n.find(".dropdown-list"),o=0<n.length,i=Number(e.which);27!==i?13!==i?o&&(!a.hasClass("dropdown-show")&&0<=[9,13,32,38,40].indexOf(i)?(e.preventDefault(),this._openDropdown()):(e.preventDefault(),this._navigateMenu(e,i,t))):this.options.onSelect(e):this._closeDropdown()}}),this._on(this.element,{updateView:function(){this._setDropdownToCurrentSelection()}}),this._on(this.document,{click:function(e){$(this.element).find(".dropdown-list").hasClass("dropdown-show")&&this._shouldCloseOnDocumentClick(e)&&(this._unfocus(),this._closeDropdown())}})},_openDropdown:function(){$(this.element).children(".dropdown-list").addClass("dropdown-show").parent(".dropdown").attr("aria-expanded","true")},_closeDropdown:function(){$(this.element).children(".dropdown-list").removeClass("dropdown-show").parent(".dropdown").attr("aria-expanded","false"),this._setDropdownToCurrentSelection()},_unfocus:function(){$(":focus").trigger("blur")},_shouldCloseOnDocumentClick:function(e){return!$(e.target).closest(".dropdown").length},_selectNextTabbable:function(){var e,t=$(":tabbable"),n=$(":focus"),a=0;0<this.element.parents(".search-view").length?$(".search-sort .sel a").trigger("focus"):(1!==n.length||(e=t.index(n))+1<t.length&&(a=e+1),t.eq(a).trigger("focus"))},_selectPrevTabbable:function(){var e,t=$(":tabbable"),n=$(":focus"),a=t.length-1;0<this.element.parents(".search-sort").length?$(".search-view .sel button").trigger("focus"):(1!==n.length||0<(e=t.index(n))&&(a=e-1),t.eq(a).trigger("focus"))},_navigateMenu:function(e,t,n){var a,o,i,s=n.parents(".dropdown-item"),r=$(this.element).find(".dropdown-list"),c=9===t&&!e.shiftKey,l=9===t&&e.shiftKey;if(40===t||c){if((a=s.is(":last-child"))&&c)return this._selectNextTabbable(),void this._closeDropdown();i=a?r.children().first():s.next()}else{if(38!==t&&!l)return;if((o=s.is(":first-child"))&&l)return this._selectPrevTabbable(),void this._closeDropdown();i=o?r.children().last():s.prev()}s.attr("aria-selected",!1).removeClass("sel").trigger("blur"),i.attr("aria-selected",!0).addClass("sel").children("button, a").trigger("focus")},_setDropdownToCurrentSelection:function(){var e,t=$(this.element),n=t.hasClass("dropdown-sort"),a=t.hasClass("dropdown-view"),o=t.find(".sel [data-selection]").data("selection"),i=CL.page.viewMode,s=t.data("defaultSort")||"date";o&&(a&&o!==i&&(e=$("[data-selection="+i+"]").closest(".dropdown-item")),n&&o!==s&&(e=$("[data-selection="+s+"]").closest(".dropdown-item")),e&&(t.find(".dropdown-item").attr("aria-selected",!1).removeClass("sel").trigger("blur"),e.attr("aria-selected",!0).addClass("sel").children("button, a")))}}),function(){var s=window.CL=window.cl=window.cl||window.CL||{},r=0,d=[],p={},h=[],f="maps_visited_pids_v1",m="maps_visited_cids_v1",g="maps_visited_cids_mru_v1",v=500;function b(e,t){return t-e}function C(e){return Number.isSafeInteger(e)&&0<e?e:0}function e(e){return e+""}function w(e){return e&&"string"==typeof e&&(e=s.safeJsonParse("["+e+"]")),Array.isArray(e)&&e.every(C)?e.sort(b):0}function L(e){r.setJsonItem(f,d=e)}function $(e,t){r.setJsonItem(m,p=e),r.setJsonItem(g,h=t)}function a(e,t,n,a){var o=e.indexOf(t);-1!==o&&e.splice(o,1),e.unshift(t);var i=e.splice(n);a&&i.forEach(a)}function k(e,t){var n={},a=e.filter(function(e){return!n[e]&&(n[e]=1)});return a.splice(t),a}function y(t,n){var a=!1,o={},e=n.filter(function(e){return t[e]&&!o[e]&&(o[e]=1)});return Object.keys(t).forEach(function(e){o[e]||(a=!0,delete t[e])}),e.splice(v).forEach(function(e){a=!0,delete t[e]}),e.length!==n.length&&(a=!0,n.splice(e.length),e.forEach(function(e,t){n[t]=e})),a}s.searchMapsVisitedCache={visitPosting:function(e){(e=C(Number(e)))&&(a(d,e,1e3),L(d),r.setJsonItem(e,1))},isPostingVisited:function(e){return-1!==d.indexOf(Number(e))},visitCluster:function(e,t){e+="";var n=w(t);e&&n&&(a(h,e,v,function(e){delete p[e]}),p[e]=n,$(p,h),r.setJsonItem(e,t))},isClusterVisited:function(e,t){t=w(t);var n=p[e];return t&&n&&t.length===n.length&&t.every(function(e,t){return n[t]===e})},init:function(e){try{!function(e){var t,n;d=(r=e).getJsonItem(f),p=r.getJsonItem(m),h=r.getJsonItem(g),d&&p&&h||(d=[],p={},h=[]),Array.isArray(d)?(t=d.length,(d=k(d.filter(C),1e3)).length!==t&&L(d)):L([]),"object"==typeof p&&Array.isArray(h)?(t=h.length,n=(h=k(h,v)).length!==t,Object.keys(p).forEach(function(e){e+""&&w(p[e])||(n=!0,delete p[e])}),(y(p,h)||n)&&$(p,h)):$({},[]);var c={},l={},u=s.safeJsonParse;function a(e){var t=[];try{for(var n=0,a=e.length;n<a;n++){var o,i=e.key(n),s=i.match(/^(\d+)|([^:]+:(\d+))$/),r=0;s&&(r=C(Number(s[1]||s[3])),t.push(i)),r&&("1"===(o=e.getItem(i))?c[r]=1:(o=w(u(o)))&&(l[r]=o))}return t}catch(e){}return[]}a(window.localStorage),a(r);var o=Object.keys(c).map(function(e){return Number(e)}).sort(b).slice(0,1e3);L(k(d=d.slice(0,100).concat(o).concat(d.slice(100)),1e3));var i=Object.keys(l).sort(function(e,t){return l[t][0]-l[e][0]}).slice(0,v);(h=k(h=h.slice(0,100).concat(i).concat(h.slice(100)),v)).forEach(function(e){p[e]||(p[e]=l[e])}),y(p,h),$(p,h)}(e)}catch(e){}},get visitedPostingIds(){return d},get visitedClusterIds(){return p},get visitedClusterMru(){return h},VISITED_PIDS_KEY:f,VISITED_CIDS_KEY:m,VISITED_CIDS_MRU_KEY:g,MAX_VISITED_PIDS:1e3,MAX_VISITED_CIDS:v,validatePostingId:C,validateClusterId:e,validateClusterValue:w,ensureVisitedClusterConsistency:y}}(),function(){function s(e){e.find(".viewcontainer").toggleClass("pics info"),e.filter(".viewcontainer").toggleClass("pics info")}function c(e){var t=["posting","cluster"],n=t.indexOf(e);-1!==n&&(delete t[n],t=t.join(" "),r.addClass(e).removeClass(t))}function t(){var e=$(".lbframe"),t=parseInt(e.css("top"),10),n=0,a="",o={transform:"","-webkit-transform":"","-ms-transform":""};t<0&&(n=1+2*t/e.height(),a="scale("+n+", "+n+")",Object.keys(o).forEach(function(e){o[e]=a})),e.css(o)}function l(e){A.activeMarker=e,CL.page.isMobile?CL.lightbox(r,{afterCenter:t}):A.openPopup=L.popup({offset:L.point(1,-5),autoPanPadding:[50,5]}).setLatLng(e.getLatLng()).setContent(r[0]).openOn(A.map)}function a(){CL.page.isMobile?CL.lightbox.close():A.openPopup&&A.map.closePopup(A.openPopup)}function u(e,t){$("#postbubble").find(".title").toggleClass("banished",t),$("#clusterbubble").find('.posting[data-pid="'+e+'"]').toggleClass("banished",t)}var o,d,i,r,p,h,_=$("#map"),x=cl.searchMapsVisitedCache,f={},I=$("<div>"+(window.currencySymbol||"")+"</div>").text();CL.banish.events.on("banish unbanish",function(e,t){var n=A.marker.containingPID[t];n&&("banish"===e.type?(n.banishedCount++,n.unbanishedCount--):"unbanish"===e.type&&(n.banishedCount--,n.unbanishedCount++),A.marker.updateIcon(t)),"map"===CL.page.viewMode&&A.openPopup&&A.activeMarker&&-1!==A.activeMarker.options.pids.indexOf(t)&&("banish"===e.type?(u(t,!0),CL.page.showBanished||(0===n.unbanishedCount?a():1<n.banishedCount+n.unbanishedCount&&$(".backtolist").click())):"unbanish"===e.type&&u(t,!1),A.marker.updateIcon(n.marker)),CL.maps.countMarkers()});function m(t,e){CL.favorites.init(t.find(".icon-star"),function(){A.marker.updateIcon(A.activeMarker)}),t.find(".contenttoggle a").off("click touchstart").on("click touchstart",function(e){e.preventDefault(),s(t)}),CL.swipe.makeGallery(t),g(t,e),t.find(".show-contact").on("click",function(e){e.preventDefault(),CL.page.showContactInfo(this.href)})}function M(){CL.maps.isFrozen||(this.title&&this.marker&&!A.openPopup?(A.activeMarker=this.marker,A.openPopup=L.popup({offset:L.point(1,-5),closeButton:!1,autoPan:!1,isTitlePreview:!0}).setLatLng(this.marker.getLatLng()).setContent('<div style="margin: -10px 0;">'+this.title+"</div>").openOn(A.map)):A.openPopup&&A.openPopup.options.isTitlePreview&&a())}function D(e){CL.maps.fullsizeMap();var t=e.target;function n(e){p.html(e),c("cluster"),l(t),h.off("click").on("click",".backtolist",function(){c("cluster"),CL.lightbox.center(),CL.favorites.init(p.find(".icon-star"),function(){A.marker.updateIcon(t)})}),p.off("click").on("click",".posting",function(){var t=$(this).addClass("visited").data("pid"),e=v(t);x.visitPosting(t),h.html(e.dom()),c("posting"),u(t,CL.banish.isBanished(t)),e.buildMapBubble(function(e){h.html(e.dom()),u(t,CL.banish.isBanished(t)),m(h,t)}),CL.maps.openPopup?CL.maps.openPopup._adjustPan():CL.lightbox.center()}),e.each(function(e,t){var n=$(t),a=n.data("pid");u(a,CL.banish.isBanished(a)),g(n,a)}),CL.favorites.init(p.find(".icon-star"),function(){A.marker.updateIcon(t)})}A.activeMarker=t;var a="";h.addClass("iscluster");var o=CL.url.params();["s"].forEach(function(e){delete o[e]});var i=decodeURI(this.url+"&"+$.param(o)),s=this.PostingID,r=this.GeoCluster;x.visitCluster(r,s),t.options.visited=!0,A.marker.updateIcon(t),f[i]?n(f[i]):$.getJSON(i).done(function(e){var t;e[0].forEach(function(e){var t;e.visited=x.isPostingVisited(e.PostingID)?"visited":"",e.ImageThumb&&0<e.ImageThumb.indexOf(",")&&(t=e.ImageThumb.split(","),e.ImageThumb=t[0]+"_50x50c.jpg"),e.ImageThumb||(e.ImageThumb="/images/peace-sm.jpg"),v(e.PostingID).data(e),a+=L.Util.template(d,e)}),t=$(a),f[i]=t,n(t)})}function P(e){CL.maps.fullsizeMap();var t=this.PostingID,n=v(t);n.data()||n.data(this);var a=e.target;(A.activeMarker=a).options.visited=!0,A.marker.updateIcon(a),h.removeClass("iscluster"),x.visitPosting(t),h.html(n.dom()),c("posting"),l(a),u(t,CL.banish.isBanished(t)),g(h,t),n.buildMapBubble(function(e){h.html(e.dom()),u(t,CL.banish.isBanished(t)),m(h,t)})}function S(){A.openPopup&&A.openPopup._map&&A.openPopup._adjustPan()}var n,g=function(e,t){CL.banish.ready.done(function(){e.find(".map-banish-unbanish").find(".banish").off("click").on("click",{pid:t},function(e){CL.banish.ban(e.data.pid),L.DomEvent.stopPropagation(e)}).end().find(".unbanish").off("click").on("click",{pid:t},function(e){CL.banish.unban(e.data.pid),L.DomEvent.stopPropagation(e)}),CL.maps.countMarkers()}).fail(function(){e.find(".map-banish-unbanish").hide()})},A=CL.maps,v=(n={},b.prototype.buildMapBubble=function(a){var o=n[this.id()],i=this;return o.data.fullyLoaded?"function"==typeof a&&a(i):$.get(o.data.PostingURL).done(function(e){var t=function(e){var t,n,a,o,i,s=e.match(/imgList\s+=\s+(\[[^\]]*\])/);if(s&&2===s.length)try{s=JSON.parse(s[1])}catch(e){s=[]}else s=[];return s=s.map(function(e){return(e.url||"").replace(/600x450/,"300x300")}),n=(t=$(e)).find("#postingbody"),a=t.find("#display-date time"),o=t.find(".attrgroup"),i=t.find(".bigattr"),0===n.length&&(n=t.find(".userbody")),{imgList:s,$postingBody:n,$attrs:o,$bigattr:i,$postedDate:a}}(e),n=t.imgList;o.data.imgList=n,o.dom.find(".infocontainer").append(t.$attrs,t.$bigattr,t.$postingBody),o.dom.find(".timecontainer").replaceWith(t.$postedDate),n.length?(o.dom.find(".swipe-wrap").html(n.map(function(e){return'<div><img src="'+e+'" /></div>'}).join("")),o.dom.find(".contenttoggle").show()):(o.dom.find(".swipe").remove(),s(o.dom)),o.dom.removeClass("loading"),o.data.fullyLoaded=!0,"function"==typeof a&&a(i)}),i},b.prototype.clear=function(){return n[this.id()]={},this},b.prototype.data=function(e){var t=n[this.id()];return e?(t.data=t.data||{},e.currencySymbol=I,e.hasPrice=e.price||0===e.price?"":"no",e.BedroomsContent=e.bedrooms?e.bedrooms+"BR":"",$.extend(t.data,e),t.dom=$(L.Util.template(i,t.data)).find(".icon-star").data("pid",this.id()).end(),this):t.data},b.prototype.dom=function(){return n[this.id()].dom.clone()},function(e){return new b(e)});function b(e){var t=e;n[t]||(n[t]={}),this.id=function(){return t}}function T(e,t){var n,a;A.map?A.map.setView(e,t):(A.map=new L.Map("map",{center:e,zoom:t,minZoom:1,maxZoom:17,maxBounds:[[-90,-180],[90,180]],layers:[A.tilelayer],zoomControl:!1}),CL.maps.controls={},n=new L.Control.ZoomFS,CL.maps.controls.fullsize=n,A.map.addControl(CL.maps.controls.fullsize),$(".close-full-screen-map-mode-button").on("click",function(){n.fullscreen()}),a=L.control.scale({metric:"US"!==window.areaCountry,imperial:"US"===window.areaCountry,updateWhenIdle:!0}),A.map.addControl(a),A.map.attributionControl.setPrefix(""))}var B={};Object.assign(CL.maps||(CL.maps={}),{init:function(){o=$("#popuptemplate").html().trim(),d=$("#clustertemplate").html().trim(),i=$("#postingtemplate").html().trim(),r=$(o),p=r.find("#clusterbubble"),h=r.find("#postbubble"),r.on("click",function(e){e.stopPropagation()}),$(window).on("resize",function(){CL.lightbox.center()}),$(document).on("keydown",function(e){e.shiftKey&&_.addClass("xhair")}).on("keyup",function(e){e.shiftKey||_.removeClass("xhair")}),L.Icon.Default.imagePath="//www.craigslist.org/images/map/",A.tilelayer=new L.TileLayer(A.clMapsUrl,{subdomains:"0123456789",setView:!0,enableHighAccuracy:!0,attribution:'&copy; craigslist - Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> - <a href="https://forums.craigslist.org/?forumID=3132">Report a problem</a>'});var e=["jsonsearch",window.catAbb||"fav"];window.subarea&&e.push(window.subarea),e.push(window.location.search);var t,n,k,y,a=decodeURIComponent("/"+e.join("/"));t=a,n=$("#mapcontainer"),k=new L.LatLng(n.data("arealat"),n.data("arealon")),T(k,y=10),$.getJSON(t).done(function(w){cl.localStorage.then(function(e){x.init(e);var t,n,a,o=w[0],i=w[1],s=o.length;navigator.userAgent.match(/iPhone OS 7/)&&500<s&&(o.length=s=500),0<s&&(t=i.clat,n=i.clng,k=new L.LatLng(t,n),a=i.zoom,17<(y=1<a?a:15)&&(y=17)),T(k,y),postalLat&&postalLon&&0<searchDistance&&L.circle([postalLat,postalLon],searchDistance,{color:"#777777",weight:1,fillOpacity:.07}).addTo(A.map);var r=new L.MarkerClusterGroup({chunkedLoading:!0,chunkInterval:100,zoomToBoundsOnClick:!1,spiderifyOnMaxZoom:!1,showCoverageOnHover:!1,animate:!1,maxClusterRadius:64,disableClusteringAtZoom:17,iconCreateFunction:function(e){var t=0,n=0,a=!1;return e.getAllChildMarkers().forEach(function(e){t+=e.options.numposts,a=a||e.options.visited,n+=A.marker.containingPID[e.options.pids[0]].unbanishedCount}),isNaN(n)&&(n=t),A.makeIcon({unbanishedCount:n,totalCount:t,visited:a,cluster:!0,fav:!1,marker:e})}});r.on("clusterclick",CL.maps.fullsizeMap);for(var c=[],l=0,u=0;u<s;u++){var d,p,h,f=o[u],m=Number(f.NumPosts)||1,g=f.PostingID,v="";1<m?(d=x.isClusterVisited(f.GeoCluster,g),h=g.split(",").map(Number).sort(),(p=CL.maps.marker.create(f.Latitude,f.Longitude,{visited:d,numposts:m,posteddate:1e3*f.PostedDate,pids:h})).on("click",D,f)):(d=x.isPostingVisited(g),h=[Number(g)],v=f.price?'<span class="price">'+I+f.price+"</span> - ":"",v+=f.PostingTitle,(p=CL.maps.marker.create(f.Latitude,f.Longitude,{visited:d,numposts:1,posteddate:1e3*f.PostedDate,pids:h})).on("click",P,f).on("mouseover",M,{title:v,marker:p}).on("mouseout",M)),A.marker.updateIcon(p),B[g]=p,c.push(p),l++}r.addLayers(c);var b,C=$("#mapcontainer");0===l&&(b=$("#noresult-overlay, #noresult-text")).css("line-height",C.height()+"px").addClass("visible").on("click",function(){b.removeClass("visible")}),A.map.addLayer(r),CL.maps.countMarkers(),_.removeClass("loading"),A.map.on("popupopen",function(e){e.popup===A.openPopup&&(e.popup._close(1),A.openPopup=void 0)}).on("popupclose",function(){A.openPopup=void 0}).on("enterFullscreen",function(){S()}).on("exitFullscreen",function(){CL.page.isMobile?(CL.page.oldMode&&"map"!=CL.page.oldMode||(CL.page.oldMode=window.defaultView),$(".close-map-view-button").trigger("click")):(S(),CL.maps.countMarkers())}).on("moveend",function(){CL.maps.countMarkers()});r.on("clusterclick",function(e){var t=e.latlng,n=A.map.getZoom(),a=A.map.getBoundsZoom(e.layer.getConvexHull()),o=n+Math.round((a-n)/2);A.map.setView(t,o)}),CL.maps.ready.resolve(A.map)})}),CL.maps.init=CL.util.noop},countMarkers:function(){var n,a,o,e=CL.maps.map;e&&"map"===CL.page.viewMode&&(n=CL.maps.marker.byID,a=0,o=e.getBounds(),Object.keys(n).forEach(function(e){var t=n[e];o.contains(t.marker.getLatLng())&&(a+=t.unbanishedCount)}),$(".displaycountShow").text(a))},ready:new $.Deferred,zoomToPosting:function(n){this.ready.done(function(e){var t=B[n];t&&e&&(e.setView(t.getLatLng(),17,{animate:!1}),t.fireEvent("click"))})},fullsizeMap:function(){$("button#mapview").click(),$("ul.dropdown-list").removeClass("dropdown-show"),$(".leaflet-control-zoom").length&&CL.maps.map.removeControl(CL.maps.controls.fullsize),CL.maps.map&&CL.maps.map.addControl(CL.maps.controls.fullsize),$("#mapcontainer").css({height:"99%"}),CL.maps.thawMap()},inlineMap:function(){CL.maps.init(),CL.maps.map.removeControl(CL.maps.controls.fullsize),$("#map").on("click",CL.maps.fullsizeMap),CL.maps.freezeMap()}})}(),function(){var n,a,o,i,s,t,r,c,l,u,d,p,e,h,f,m,g,v,b,C,w,L,k,y,_,x,I,M,D,P,S,A,T,B,O,N,j,E,z,V,U,Z,F,J,R,G,K,H,Y,q,W,X,Q,ee,te,ne,ae,oe,ie,se,re,ce,le,ue,de,pe,he,fe,me,ge,ve,be=window.cl,Ce=$("body");Ce.hasClass("search")&&($("span.icon-locate").on("click",function(e){e.preventDefault(),e.stopPropagation(),reverseGeocodeUser({onSuccess:function(e){var t=e[0],n=$("input.postal"),a=$("input.search_distance");n.val(t.postal),a.val(Math.round(t.radius)),$("button.searchbtn").click()},onError:function(e){alert(e)},extra:{src:"sr"}})}),n={},a=$("input[name=searchNearby]"),o=$(".nearbyAreas").find("input[name=nearbyArea]"),i=$("#nearbyNumber"),(s=$(".nextNearbyZone")).on("click",function(){var e=$(this),t=Number(e.data("zone"));if($(".nearbyZone.nearbyZone_"+t).removeClass("nearbyZone"),$(".nearbyZone").length){for(var n=0;0===n&&t<4;)t++,n=$(".nearbyZone.nearbyZone_"+t).length,e.data("zone",t);i.text(n)}else e.hide()}),$(".duplicate-row").each(function(){var t=$(this),n=t.find(".duplicate-rows");t.find(".expand").on("click",function(e){e.preventDefault(),e.stopPropagation(),t.toggleClass("expanded"),t.hasClass("expanded")&&"grid"===CL.page.viewMode&&n.find(".result-row").each(function(e,t){CL.swipe.makeGallery($(t))})}),t.find(".collapsed-trash").on("click",function(e){e.stopPropagation(),e.preventDefault(),CL.banish.ban(t.data("pid")),t.find(".result-row").each(function(e,t){CL.banish.ban($(t).data("pid"))}),t.detach(),p()})}),be.localStorage.then(function(e){var t=(n=e.getJsonItem("chosenLocals",!0))&&0<Object.keys(n).length;n=n||{},a.is(":checked")&&o.each(function(){var e=$(this);t&&(!0===n[e.val()]?(e.parent().parent().removeClass("nearbyZone"),e.attr("checked","checked")):"boolean"==typeof n[e.val()]&&e.removeAttr("checked"))}),i.text($(".nearbyZone.nearbyZone_"+s.data("zone")).length),a.removeClass("autosubmit"),a.off("click").on("click",function(){$(".nearbyArea").each(function(){$(this).removeAttr("disabled")}),m.submit()})}),o.each(function(){var t=$(this);t.on("click",function(){var e=t.val();t.is(":checked")?n[e]=!0:n[e]=!1,be.localStorage.setJsonItem("chosenLocals",n,!0)})}),t=$("a.to-banish-page-link"),r=$(".banished_count"),c=$(".banished_count_shown"),l=$(".banish-out-of"),u=$(".banish-count-only"),(d=1===$(".my-banished").length)&&$(".category").each(function(){var t=$(this);t.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$("#categories-hidden").val(t.prev().attr("value")),$("#searchform").submit()})}),p=function(){var e=CL.banish.banishedCount();r.text(e),c.text($(".banished").length),l.toggle(e!==parseInt($(".banished").length,10)),u.toggle(e===parseInt($(".banished").length,10)),t.attr("href","/favorites?uf=1&fl="+CL.banish.encode()),Ce.toggleClass("has-banished",Boolean(e)),0===e&&"map"!==CL.page.viewMode&&CL.banish.hide()},CL.banish.ready.done(function(){Ce.on("click",".banish",function(e){e.stopPropagation(),e.preventDefault(),CL.banish.ban($(this).closest(".result-row").data("pid"))}),Ce.on("click",".unbanish, .restore-link",function(e){var t=$(this).closest(".result-row"),n=t.data("pid");t.remove(),CL.banish.unban(n),e.stopPropagation(),e.preventDefault()}),$(".mobile-discards, .discards, .map .favlink").on("click",function(){CL.browser.hashChange?CL.page.showBanished&&history.back():CL.page.showBanished?CL.banish.hide():CL.banish.show()}),CL.banish.events.on("banish unbanish",function(e,t){var n=$(".result-row[data-pid="+t+"]"),a="banish"===e.type?"/flag/?async=async&flagCode=35&postingID="+t:"/flag/?async=async&flagCode=36&postingID="+t;n.length&&("banish"===e.type&&CL.favorites.isFavorite(t)&&n.find(".icon-star").trigger("click"),$.get(a),"banish"===e.type?n.addClass("banished"):n.removeClass("banished").addClass("restored")),p()}),$(".result-row").each(function(){var e=$(this),t=e.data("pid"),n=e.data("repost-of");(CL.banish.isBanished(t)||CL.banish.update(n,t))&&e.addClass("banished"),d&&!CL.banish.isBanished(t)&&e.removeClass("banished").addClass("restored")}),$(".duplicate-row").each(function(){var n=$(this),e=n.find(".duplicate-rows"),t=n.find(".expand.first"),a=t.find(".expand-toggle");e.find(".result-row").each(function(){var t=$(this);t.find(".icon-trash").on("click",function(){CL.banish.ban(t.data("pid"));var e=a.text()-1;a.text(e),0==e&&n.find(".expand.first").detach()})});var o,i,s=e.find(".result-row").not(".banished"),r=1+s.length;n.hasClass("banished")&&0<--r&&((o=$(s[0]).detach()).addClass("duplicate-row"),e=e.detach(),t=t.detach(),n.replaceWith(o),e.insertAfter(o.find(".result-info")),$(o.find("span.banish.icon")[0]).after(t),o.find(".expand").off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),o.toggleClass("expanded")}),(i=$(o.find(".icon-trash")[0])).addClass("collapsed-trash"),i.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),CL.banish.ban(o.data("pid")),o.find(".result-row").each(function(e,t){CL.banish.ban($(t).data("pid"))})})),1===r?t.detach():0===r?n.detach():a.text(r-1)}),p()}).fail(function(){$(".banish-unbanish").hide()}),e=function(e){var t=(e||window.location.pathname).replace(/\/d\/[^\/]*/g,"").split("/").filter(Boolean),n=t.shift(),a={category:t.pop(),subArea:t.pop(),area:window.location.hostname.split(".")[0],isSearch:"search"===n,isFavorites:"favorites"===n,purveyor:void 0};window.purveyorCategories&&Object.keys(window.purveyorCategories).some(function(e){if(window.purveyorCategories[e]===a.category)return a.purveyor=e,1});function o(e){return i.hasOwnProperty(e)&&i[e]}var i=Object.create(a),s={category:function(e){return void 0===e?i.category:(i.category=e,s)},subArea:function(e){return void 0===e?i.subArea:(i.subArea=e,s)},area:function(e){return void 0===e?i.area:(i.area=e,s)},purveyor:function(e){if(void 0===e)return i.purveyor;var t={o:"owner",d:"dealer",a:"all"};t[e]&&(e=t[e]);var n={owner:1,dealer:1,all:1};if(!n[e])throw new Error("Invalid purveyor type! Must be one of: "+Object.keys(n).join(" "));return i.purveyor=e,s},isSearch:function(e){return e?(i.isSearch=Boolean(e),i.isFavorites=!1,s):i.isSearch},isFavorites:function(e){return e?(i.isFavorites=Boolean(e),i.isSearch=!1,s):i.isFavorites},toString:function(){var e="",t=[];return o("area")&&(e="//"+i.area+"."+CL.url.baseDomain),i.isSearch?(window.purveyorCategories&&o("purveyor")&&window.purveyorCategories[i.purveyor]&&(i.category=window.purveyorCategories[i.purveyor]),t=["search",i.subArea,i.category]):i.isFavorites&&(t=["favorites"]),(t=t.filter(Boolean)).unshift(""),e+t.join("/")}};return s},h=function(e){var t,n=e.delimiter||"-",a=[];if("string"==typeof e.values?a=(a=e.values.trim())?a.split(n).map(Number):[]:e.values&&e.values.length&&(a=e.values.map(Number)),e.isUncompressed)t=a;else if(0<a.length){t=[a[0]];for(var o=1;o<a.length;o++)t.push(t[o-1]+a[o])}else t=[];return{real_values:t=t.sort(function(e,t){return e-t}),add:function(e){var t=this;return e.map(Number).map(function(e){t.real_values.push(e)}),this.real_values=this.real_values.sort(function(e,t){return e-t}),t},remove:function(e){e=e.map(Number);for(var t={},n=0;n<e.length;n++)t[e[n]]=!0;for(var a=[],n=0;n<this.real_values.length;n++)t[this.real_values[n]]||a.push(this.real_values[n]);return a=a.sort(function(e,t){return e-t}),this.real_values=a,this},asDiffArray:function(){if(0===this.real_values.length)return[];for(var e=[this.real_values[0]],t=1;t<this.real_values.length;t++){var n=this.real_values[t]-this.real_values[t-1];0<n&&e.push(n)}return e},asDiffString:function(){return this.asDiffArray().join(n)},asFullArray:function(){return this.real_values.slice(0)}}},f=$(window),m=$("#searchform"),g=new e,v=m.find("input, select, .searchInput"),b=$("#query"),C=$(".categories").find("input[type=checkbox]").not(".selectallcb").removeAttr("name"),w=$("#excats"),m.on("submit",function(){var a,e,t;e=C.not(":checked"),t="",e.length!==C.length-1||g.isFavorites()?(a=[],e.length===C.length&&0<C.length&&!g.isFavorites()&&g.category(window.sectionAbb),e.each(function(e,t){var n=t.value.split(",");a=a.concat(n)}),t=h({values:a,isUncompressed:!0}).asDiffString()):g.category(C.filter(":checked").data("abb")),w.val(t),v.each(function(){var e,t,n,a=$(this),o=a.val();e=a,""!==o?e.renameAttr("data-name","name"):e.renameAttr("name","data-name"),n=o,((t=a).hasClass("min")||t.hasClass("max"))&&t.val(n.replace(/[.,]\d{1,2}$/,"").replace(/[^\d.,k]/g,""))}),m.attr("action",g)}),L=$("#map"),k=function(){var e=Math.round($("footer").offset().top-L.offset().top-1);L.height(e),CL.maps.map&&CL.maps.map.invalidateSize(),CL.maps.map&&!$(".leaflet-control-zoom").length&&CL.maps.map.addControl(CL.maps.controls.fullsize),CL.maps.thawMap()},y=function(){CL.maps.map&&CL.maps.map.closePopup(CL.maps.openPopup),$(".leaflet-control-zoom").length&&CL.maps.map.removeControl(CL.maps.controls.fullsize),L.height(200),L.removeClass("fullsize-map"),CL.maps.freezeMap()},_={},x=0,M=(I="changed_input")+" clickme",D=$(".searchbtn"),P=$(".searchlink"),S=!1,A=function(e,t,n,a,o){e!==Boolean(_[t])&&(n.toggleClass(I,e),_[t]=!_[t],x+=e?1:-1,S=Boolean(x),D.toggleClass(M,S),P.toggleClass(M,S),o&&o(t,n,a))},T=function(e){var t,n,a,o,i,s,r,c,l=$(e);t=e,n=l.hasClass("multi_checkbox")||l.hasClass("use-id"),a=void 0,o=l.hasClass("multi_checkbox")?function(e,t,n){var a=$("#headerattr_"+n.data("attr")),o=Number(a.data("checked-count"))||0;n.prop("checked")?o++:o--,a.data("checked-count",o),a.removeClass("strong"),0<o&&a.addClass("strong")}:void 0,s=$(t),r=s[0].type,c=n?s.attr("id"):s.attr("name"),void 0===a||void 0===a[c]?(i="checkbox"===r?s.prop("checked"):"radio"===r?n?$("input[id="+s.attr("id")+"]:checked").val():$("input[name="+s.attr("name")+"]:checked").val():s.val(),a&&(a[c]=i)):i=a[c],s.on("change keyup",function(n,a,o,i){if("checkbox"===r)return function(){A(n.prop("checked")!=o,a,n.parent(),n,i)};if("radio"!==r)return function(e,t){A(n.val()!==o,a,t||n,t||n,i)};var e=$("input[name="+n.attr("name")+"]");return function(){A(e.filter(":checked").val()!==o,a,e.parent(),e,i)}}(s,c,i,o))},v.not(".selectallcb").not(".autosubmit").not(".no_changed_input").each(function(e,t){T(t)}),B=$("#gallerycarousel").html().trim(),Ce.on("click",".result-row .arrow",function(e){e.preventDefault()}),O=function(e,t,n){return'<img alt="" class="'+(n=n||"")+'" src="'+CL.image.url(e,t)+'">'},N={},j={},E=function(c){$(".result-row").each(function(e,t){var n,a,o=$(t),i=e+"-"+o.data("pid"),s=o.find("> .result-image"),r=s.data("idList");Array.isArray(r)||(r=(r=s.data("ids")||"")?r.split(","):[],s.data("idList",r)),0===r.length?s.addClass("empty").attr("title",window.noImageText):"thumb"!==c||N[i]?"gallery"!==c||j[i]||(j[i]=!0,1===r.length?s.prepend(O(r[0],"gallery")):(n=r.map(function(e,t){return"<div>"+(0===t?O(e,"gallery"):"")+"</div>"}).join(""),s.append('<div class="swipe"><div class="swipe-wrap">'+n+"</div></div>"+B),a=!1,CL.swipe.makeGallery(s,{callback:function(){a||(s.find(".swipe-wrap div").each(function(e,t){0!==e&&$(t).html(O(r[e]||r[e-r.length],"gallery"))}),a=!0)}}))):(N[i]=!0,s.prepend(O(r[0],"thumb","thumb")))})},z={},V=function(e){var t="cl_tocmode";if(void 0===e){var n=CL.cookies.getItem(t);return n&&n.split(",").forEach(function(e){e=e.split(":"),z[e[0]]=e[1]}),z[window.sectionBase]||window.defaultView}var a=new Date;a.setTime(a.getTime()+31536e6),z[window.sectionBase]=e;var o=Object.keys(z).map(function(e){return e+":"+z[e]}).join(",");CL.cookies.removeItem(t,{path:"/"}),CL.cookies.setItem(t,o,{expires:a,path:"/",domain:CL.url.baseDomain})},$(".backtotop").on("click",function(e){$(window).scrollTop(0),e.preventDefault()}),CL.page.viewMode=V(),Z=function(e){var t={list:function(){y()},pic:function(){var t,n,a;CL.browser.isTouchCapable||(t=$("#floater"),n=t.find("img.payload"),a=!1,$(".result-image").on("mouseover",function(){var e=($(this).data("idList")||[])[0];e&&(t.show(),n.attr("src",CL.image.url(e,"gallery")).on("load",function(){$("#floater").addClass("f")}),a=!0)}).on("mouseout",function(){t.hide().removeClass("f"),n.attr("src",""),a=!1}).on("mousemove",function(e){a&&$("#floater").css({left:e.pageX+15+"px",top:e.pageY+15+"px"})})),y(),E("thumb")},grid:function(){y(),$(".result-image").off(),$("#floater").hide(),E("gallery")},map:function(){CL.maps.init(),$("#mapcontainer").css({height:"99%"}),k(),CL.page.isMobile&&CL.maps.controls.fullsize.fullscreen(),CL.maps.countMarkers()}};U=CL.page.viewMode,CL.page.oldMode=U,/^BB/.test(CL.cookies.getItem("cl_b"))&&$.ajax("/stats",{type:"HEAD",data:{type:"search-view-mode",from:U,to:e}}),t[e]&&$("#"+e+"view").length||(e="list"),Ce.removeClass(Object.keys(t).join(" ")).addClass(e),t[CL.page.viewMode=e](),V(e)},$(".open-map-view-button").on("click",function(){Z("map"),$(".dropdown").trigger("updateView")}),$(".close-map-view-button").on("click",function(e){"map"==CL.page.oldMode&&(CL.page.oldMode=window.defaultView),Z(CL.page.oldMode),$(".dropdown").trigger("updateView"),e.stopPropagation()}),$(".search-view .dropdown").dropdown({onSelect:function(e){e.preventDefault();var t=$(e.target).data("selection");CL.browser.hashChange&&t!==CL.page.viewMode&&Z(t)}}),$(".search-sort .dropdown").dropdown(),F="",(J=(location.hash||"").replace("#",""))?"hidden"===J?(Z(CL.page.viewMode),CL.banish.show()):Z(J):(F=CL.page.viewMode,Z(F)),CL.browser.hashChange&&f.on("hashchange",function(){var e=(location.hash||"").replace("#","");if("hidden"===e)return U=CL.page.viewMode,void CL.banish.show();"hidden"!==e&&CL.page.showBanished&&(CL.banish.hide(),e=e||CL.page.viewMode),!e&&F&&(e=F),e!==CL.page.viewMode&&Z(e)}),R=$("#is_paid"),$(".remuneration").on("click","a",function(e){e.preventDefault(),R.val($(this).data("val")),m.submit()}),$(".purveyor").on("click","a",function(e){e.preventDefault(),g.purveyor($(this).data("val")),m.submit()}),$("input[name=srchType]").on("click",function(){b.val()&&m.submit()}),$(".savealert a").on("click",function(e){var n=this,a=n.href;e.preventDefault(),$.ajax("/session/?v=1",{dataType:"json",timeout:1500}).done(function(e){var t;window.location.href=a+"&_csrf="+encodeURIComponent(e.csrf),S&&(t=$(n).data("action"),m.append('<input type="hidden" name="'+t+'" value="1">').append('<input type="hidden" name="_csrf" value="'+e.csrf+'">').submit())}).fail(function(){var e;window.location.href=a,S&&(e=$(n).data("action"),m.append('<input type="hidden" name="'+e+'" value="1">').submit())})}),$(".experimentalFeature a").on("click",function(e){var t=$(this).data("query");t&&(e.preventDefault(),b.val(t),m.submit())}),function(){var e=$(".morecats"),t=$(".othercats"),n=$(".search-options-container"),a=$(".search-options-header");t.hasClass("closed");e.on("click",function(){t.add(e).toggleClass("closed")}),$(".form-tab").on("click",function(){var e=Ce.toggleClass("hide-search").hasClass("hide-search")?1:0;k(),CL.cookies.setItem("hidesearch",e,{path:"/",domain:CL.url.baseDomain})}),a.on("click",function(){n.toggleClass("options-visible"),a.toggleClass("options-visible")})}(),$(".search-attribute").each(function(e,t){var n=$(t),a=(n.data("attr"),n.find(".title")),o=n.find(".list"),i=o.find(".selectall"),s=o.find(".moreless"),r=o.find(".multi_checkbox");a.on("click",function(){n.toggleClass("hide-list")}),o.on("change",".multi_checkbox",function(){var e=0<r.filter(":checked").length;i.toggleClass("selected",e),a.toggleClass("strong",e)}),i.on("click",".all",function(){r.prop("checked",!0).trigger("change"),s.find(".more").trigger("click")}),i.on("click",".none",function(){r.prop("checked",!1).trigger("change")}),s.on("click",".more",function(){o.removeClass("short-list")}),s.on("click",".less",function(){o.addClass("short-list")})}),G=$(".catcheck").not(".selectallcb"),K=$(".catcheck.selectallcb"),G.on("change",function(){var e=$(this),t=h({values:$("#breadcrumbform #excats").val()});G.not(":checked").length?K.prop("checked",!1).trigger("change"):K.prop("checked",!0).trigger("change"),e.prop("checked")?t.remove(e.val().split(",").map(Number)):t.add(e.val().split(",").map(Number)),$("#searchform #excats,#breadcrumbform #excats").val(t.asDiffString()),e.closest(".selectall").toggleClass("checked").closest(".searchgroup").find("input[type=checkbox]").not(e).prop("checked",e.prop("checked")).trigger("change")}),K.on("click",function(){var e=$(this).prop("checked");G.each(function(){$(this).prop("checked",e).trigger("change")})}),be.localStorage.whenPersistent(function(){var e=be.resultSetManager.create();e&&Ce.on("click",".hdrlnk, .paginator a, a.result-image",e.makeCurrent)}),be.localStorage.whenPersistent(function(){var e,t,n=be.localStorage.getItem("scrollToPost");n&&(be.localStorage.removeItem("scrollToPost"),"map"!==CL.page.viewMode&&(e="grid"===CL.page.viewMode?350:"pic"===CL.page.viewMode?180:140,(t=document.getElementById("postid_"+n))&&t.scrollIntoView&&(t.scrollIntoView(),t.focus(),window.scrollTo(0,window.scrollY-e))))}),CL.browser.pushState&&(H=120,Y=CL.url.params(),q=$(".rows"),W=$(".paginator"),X=Math.min(Number(W.find(".totalcount").first().text()),window.maxResults),Q=W.find("a.first"),ee=W.find("a.prev"),te=W.find("a.next"),0!==(ne=Number(Y.s)||0)&&0<ne%H||(ae=$(".paginator .range"),oe={},ie=function(e){return!!oe[e]&&(oe[ne]=q.find(".result-row, #moon").detach(),q.prepend(oe[e]),Z(CL.page.viewMode),CL.favorites.init(),!0)},se=function(t){var e=re({index:t,ajax:!0});!oe[t]&&0<=t&&t<X&&$.get(e).done(function(e){oe[t]=$(e.trim()).find(".content .result-row")})},re=function(e){(e=e||{}).index?Y.s=e.index:delete Y.s;var t=window.location.pathname,n=Object.keys(Y).sort().map(function(e){var t=Array.isArray(Y[e])?Y[e].join("&"+e+"="):Y[e];return e+"="+t}).join("&");return t+(n=n&&"?"+n)},ce=function(){var e=ne+1,t=Math.min(ne+H,ne+oe[ne].length);ae.text(e+" - "+t)},le=function(e,t,n){ie(ne+n)&&(t.preventDefault(),f.scrollTop(0),ne+=n,ce(),ee.attr("href",re({index:ne-H})),te.attr("href",re({index:ne+H})),history.pushState({index:ne},void 0,re({index:ne})),W.toggleClass("firstpage",0===ne),W.toggleClass("lastpage",X<=ne+H),n<0&&se(ne+n),0)},se(ne-H),Q.on("click",function(e){le(0,e,-ne)}),ee.on("click",function(e){le(0,e,-H)}),te.on("click",function(e){le(0,e,H)}),window.onpopstate=function(e){var t=e.state&&e.state.index||Number(CL.url.params().s)||0;ie(t)?(ce(),ne=t):t!==ne&&window.location.reload()})),be.autocomplete({type:"search",buildParams:function(e){return{term:e.term,cat:window.catAbb}},onSelect:function(e,t){t.item.value&&(b.val(t.item.value),m.submit())}}),be.autocomplete({type:"makemodel",buildParams:function(e){var t=window.catAbb;window.purveyorCategories&&(t=window.purveyorCategories.all),t===window.sectionBase&&(t=void 0);var n={term:e.term};return t&&(n.cat=t),n},onSelect:function(e,t){t.item.value&&($(".auto_make_model").val(t.item.value),m.submit())}}),(ue=$("#breadcrumbform").on("submit",function(){$(this).attr("action",de)})).find("select").removeAttr("name").end().find("input").each(function(){var e=$(this);""===e.val()&&e.removeAttr("name")}),$(".clear-all-banished").off("click").on("click",function(e){e.preventDefault();var t=[];$(".result-row").each(function(){var e=$(this);t.push(e.data("pid"))}),CL.favesManager.deleteBanished(t),$(".rows").empty(),p()}),de=new e($("#breadcrumbform").attr("action")),$("#areaAbb").on("change",function(){ue.find("input[name=postal]").remove(),ue.find("input[name=search_distance]").remove(),de.area($(this).val()).subArea(""),ue.submit()}),$("#subArea").on("change",function(){de.subArea($(this).val()),ue.submit()}),$("#catAbb, #subcatAbb").on("change",function(){de.category($(this).val()).isSearch(!0),ue.find("input[name=excats]").remove(),ue.find("input[name=fl]").remove(),ue.find("input[name=uf]").remove(),ue.submit()}),pe=7,he=0,fe=$(".event_attr_label"),me=Math.max,fe.each(function(){var e=$(this).width();he=me(he,e)}),he+=pe,fe.css("min-width",he),CL.browser.matchMedia&&(ge=window.matchMedia("(max-width: 480px)"),(ve=function(e){e?$(".autosubmit").off("change").each(function(e,t){T(t)}):($(".autosubmit").off("change").on("change",function(){m.submit()}),$(".options-visible").removeClass("options-visible"))})(ge.matches),ge.addListener(function(e){var t=e.matches;ve(t)})),Ce.on("click",".result-row",function(){var e;!CL.page.isMobile||(e=$(this).find(".result-info a").attr("href"))&&(window.location.href=e)}),Ce.hasClass("has-map")&&("hhh"===window.sectionBase&&!["swp","hsw","sha"].includes(window.catAbb)||"sss"===window.sectionBase&&"gms"===window.catAbb)&&("desktop"!==window.pagemode||CL.url.params().s||Ce.addClass("has-map-view-button")))}();var reverseGeocodeUser=function(e){if(e&&e.onSuccess){var t=e.onSuccess,a=e.onError||function(){},n=e.extra||{};try{CL.browser.geolocation?navigator.geolocation.getCurrentPosition(function(e){n.lat=e.coords.latitude,n.lon=e.coords.longitude,n.acc=e.coords.accuracy,$.ajax({dataType:"json",url:"/codegeo",data:n,success:function(e){t(e)},error:function(e,t,n){a(t+" "+n)}})},function(e){a("Cannot get location. "+function(e){var t="";switch(e.code){case e.PERMISSION_DENIED:t="Permission Denied.";break;case e.POSITION_UNAVAILABLE:t="Location Unavailable.";break;case e.TIMEOUT:t="Timeout.";break;case e.UNKNOWN_ERROR:default:t="Unknown Error."}return t+" "+e.message}(e))},{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e4}):a("Cannot get location.")}catch(e){a("Cannot get location. "+e.message)}}};
/* {"sources":{"search-concat.js":"2468b6a1ca79e6c748c2a8ef25c3ef5b"}} */