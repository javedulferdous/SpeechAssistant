var totalBubbles,compareMaxSize=4,isGettingComparison=!1,compareCounter=0,nonExpManagerSearchId="searchRefine",expManagerSearchId="searchRefineV2";function removeCompareItem(e,o){$object=$(this),$("#compareItem"+e).slideUp("slow",function(){$.getJSON(common_utils.appendSessionId("/mobile/comparison.do?action=remove&sku="+o),function(e){if(e.object<=compareMaxSize)$("#comparemaxBody").find(".compareItem").each(function(){$(this).fadeOut(2e3,function(){$(this).remove()})}),$("#comparemaxFooter").text($("button",this).text()+$("#compare_error_redirect").text()),odApp.compare.isBSD()&&$(".compare_checkbox").prop("disabled",!0),$("#skuListFormID").submit();else{var o=$("#cmp_size").text(),a=$("#cmp_oversize").text();$("#cmp_size").text(o-1),$("#cmp_oversize").text(a-1)}})})}odApp.compare=function(e){var c,r,o,p=!0,i="text_button";function m(){return $("#"+expManagerSearchId).length}function a(e,o,a){var t,n=$("#skuListFormID .compare_checkbox").not(":checked");n.prop("disabled",e),m()?(t=n.siblings(".compareButton").find("input")).val(o):t=n.siblings("label"),1==a?t.addClass("disabled_text_button"):t.removeClass("disabled_text_button"),p=!p}function s(e){m()?(e.find("input").val(r),odApp.compare.processCompareCheckboxCheck(e.siblings("input[type=checkbox]"))):odApp.compare.isBSD()&&e.html($("#compare_already_compare").text())}return e.getValues=function(){c=$("#compare_text").length?$("#compare_text").text():"Compare",r=$("#compare_item").length?$("#compare_item").text():"Compare now",o=$("#compare_limits").length?$("#compare_limits").text():"Compare (Limit 4 Items)"},e.callDwrForComparisonData=function(e){var a=odApp.utils.browser;$.getJSON(common_utils.appendSessionId("/mobile/comparison.do?action=itemInfo&sku="+e),function(e){if(isGettingComparison=!1,e.object.size<=compareMaxSize)$("#skuListFormID").submit();else{0<$(".od_compare").length&&odApp.compare.compareDialog();var o=common_utils.appendSessionId("/ajaxhtml/compareMax.do");$("#comparemaxBody").load(o,function(e){a.msie&&9===parseInt(a.version,10)&&$(".ui-dialog-titlebar").off("click mousedown"),$("#loadingbar").remove(),$("#comparemaxBody").show("blind",{direction:"vertical"},1e3)})}})},e.compareButtonMakeLinkable=function(e){e.removeClass(i)},e.compareButtonMakeText=function(e){e.addClass(i)},e.compareDialog=function(){var e="<div id='comparemax' class='compare-dialog'><div id='comparemaxBody'><div id='loadingbar'><p id='loading-message>"+$("#compare_error_pleasewait").text()+"</p></div></div></div>";$(e).dialog({bgiframe:!0,dialogId:"compareMaxDialogId",title:$("#compare_error_header").text(),modal:!0,resizable:!1,draggable:!1,position:"center",width:525,overlay:{opacity:.5,background:"black"},hide:"fade",open:function(){},close:function(){$(this).remove()},closeText:$("#compareLightboxCloseText").val()})},e.lazyLoadNotEnabled=function(){return!$(".load_more_section").length},e.disableUncheckedCheckboxes=function(){1==p&&!0===this.lazyLoadNotEnabled()&&a(!0,o,!0)},e.enableUncheckedCheckboxes=function(){0==p&&a(!1,c,!1)},e.getComparisonCount=function(){$.getJSON(common_utils.appendSessionId("/mobile/comparison.do?action=itemCount"),function(e){for(var o=e.object,a=0,t=new Array,n=$("#skuListFormID").find(".compare_checkbox:checked"),c=n.length,r=$("#isExperienceManager").val(),p=0;p<c;p++){var i=n[p];if(!i.disabled){if(r)var m=i.id.replace("checkbox_","#sku_"),s=$(m,".omega").val();else m=i.id.replace("checkbox_","#sku_"),s=$(m,".product_block").val();t[a]=s,a++}}var d=o+t.length;compareMaxSize<d||isNaN(d)?(odApp.compare.callDwrForComparisonData(t),$(".od_compare").length<1&&odApp.compare.compareDialog()):($("#skuListFormID").submit(),isGettingComparison=!1)})},e.getComparisonCountOnly=function(){return $("#skuListFormID").find(".compare_checkbox:checked").length},e.getSearchRefineObj=function(){return $("#"+nonExpManagerSearchId).length?$("#"+nonExpManagerSearchId):$("#"+expManagerSearchId)},e.initialCounterAndAlreadyCompared=function(e){for(var o,a=new Array,t=e.find(".hidden").find(".c_sku"),n=t.length,c=0;c<n;c++)o=t.eq(c).text(),a[compareCounter]=o,compareCounter++;0<a.length&&function(e){for(var o=0;o<e.length;o++){var a=e[o],t="#checkbox_"+a,n=(odApp.compare.isBSD()?$(t+" > input").prop("disabled",!0).prop("checked",!0):$(t+" > input").prop("checked",!0).addClass("compareRemove")).next("label");odApp.compare.isBSD()&&n.addClass("compareRemove").attr("id",a),s(n)}}(a)},e.isBSD=function(){var e=0;return 0==$("#searchRefineV2").length&&(e=$(".bsd").length),e},e.linkClickTag=function(e){document.location.href.indexOf("?")},e.maxComparedDisableOthers=function(){if(m()){var e=$("#skuListFormID .compare_checkbox:checked").length;compareMaxSize<=e&&odApp.compare.disableUncheckedCheckboxes()}},e.processCompareCheckboxCheck=function(e){var o=$(e),a=!0,t=c,n=$(e).siblings("label").find("input");n.addClass(i),o.is(":checked")&&(a=!1,t=r,odApp.compare.compareButtonMakeLinkable(n)),n.prop("disabled",a).val(t)},e.removeCompare=function(o){$.getJSON(common_utils.appendSessionId("/mobile/comparison.do?action=remove&sku="+o),function(e){$(".bsd").length&&function(e){var o=$("#checkbox_"+e),a=o.find(".compareButton input"),t=$("#compare_text").text(),n=o.find("label");n.removeClass("compareRemove"),function(e){e.removeAttr("disabled").prop("checked",!1)}(o.find(".compare_checkbox")),m()?(a.prop("disabled",!0),a.val(t),odApp.compare.compareButtonMakeText(a)):n.html(t);--compareCounter,odApp.compare.showBubbles(--totalBubbles),$("#c_sku_size").html(totalBubbles.toString()),odApp.compare.enableUncheckedCheckboxes()}(o)})},e.setComparisonIcon=function(o){$.getJSON(common_utils.appendSessionId("/mobile/comparison.do?action=itemCount"),function(e){e.object;odApp.compare.showBubbles(o)})},e.setCompareButtonDefaults=function(e){m()&&e.find("#productView .compareButton").not(".compareRemove").find("input").attr("disabled",!0).addClass(i)},e.showBubbles=function(e){var o=0;0==e?o=-55:1==e?o=-44:2==e?o=-33:3==e?o=-22:4==e?o=-11:5==e&&(o=0),$(".compareCounter").css("background-position",o+"px 100%"),totalBubbles=e},e.showCompare=function(e,o){return 0<e.length?e.parent().show():(e=o.find(".compareButton")).show(),e},e.prepareCompare=function(){var e=odApp.compare.getSearchRefineObj(),o=$("#navSearch"),a=e.find(".compareButton > .link_button");odApp.compare.getValues(),odApp.compare.showBubbles($("#c_sku_size").text()),odApp.compare.showCompare(a,e),a=odApp.compare.showCompare(a,e),odApp.compare.setCompareButtonDefaults(e),odApp.compare.initialCounterAndAlreadyCompared(o),odApp.compare.maxComparedDisableOthers(),this.bindClickEvents(a,e)},e.bindClickEvents=function(e,a){e.on("keypress",function(e){13==(e.keyCode?e.keyCode:e.which?e.which:e.charCode)&&(e.preventDefault(),$(this).click())}),e.on("click",function(e){if(e.preventDefault(),$(this).parent().hasClass("compareRemove")){var o=$(this).parent().attr("id");odApp.compare.removeCompare(o)}else{if(0==$("#c_sku_size").text()&&0===a.find(".compare_checkbox:checked").length&&"false"==$("#isIBSD").val())return odApp.compare.compareDialog(),void $("#comparemaxBody").html('<p class="default">'+$("#compare_nothing_error").text()+"</p>").show();if($("#skuListFormID").append('<input id="jsCompare" type="hidden" name="cmd_compare" value="1"/>'),odApp.compare.linkClickTag("CompareSelected"),isGettingComparison)return;isGettingComparison=!0,odApp.compare.getComparisonCount()}})},e.init=function(){var e=document.querySelector(".js-module-asyncSkuList");e&&e.parentNode.addEventListener("skuList.contentUpdate",this.prepareCompare.bind(this))},e}(odApp.compare||{}),$(function(){var e=odApp.compare.getSearchRefineObj(),a=$("#navSearch"),o=e.find(".compareButton > .link_button");odApp.compare.getValues(),odApp.compare.showBubbles($("#c_sku_size").text()),o=odApp.compare.showCompare(o,e),odApp.compare.setCompareButtonDefaults(e),odApp.compare.initialCounterAndAlreadyCompared(a),odApp.compare.maxComparedDisableOthers(),odApp.compare.bindClickEvents(o,e),odApp.compare.init(),$(document).on("click","label.compareRemove",function(){var e=$(this).attr("id");$(this).hasClass("compareRemove")&&odApp.compare.removeCompare(e)}),$(document).on("click",".removeAllCompare",function(e){odApp.compare.linkClickTag("DiscardSelected")}),$(document).on("click",".compare_checkbox",function(){var e=odApp.compare.getComparisonCountOnly();if(compareMaxSize<e&&!odApp.compare.isBSD()&&!0===odApp.compare.lazyLoadNotEnabled())return!1;odApp.compare.processCompareCheckboxCheck(this),odApp.compare.isBSD()||(compareMaxSize<=e?odApp.compare.disableUncheckedCheckboxes():odApp.compare.enableUncheckedCheckboxes())}),$(document).on("click","input[type=checkbox].compare_checkbox",function(){if(0<$(".od_compare").length&&0==this.checked){var e=this.parentNode.id.replace("checkbox_","");$.getJSON(common_utils.appendSessionId("/mobile/comparison.do?action=remove&sku="+e),function(e){})}var o=a.find("input[type=checkbox]:checked").length;odApp.compare.setComparisonIcon(o)})});
odApp.compareEmail=function(a){return a.populateTranslations=function(){$("#senderName").attr("value",$.trim($("#userName").text())).attr("tabindex",tabindex++),$("#mailFrom").attr("value",$.trim($("#emailAddress").text())).attr("tabindex",tabindex++),$("#mailTo").attr("tabindex",tabindex++),$("#mailBody").attr("tabindex",tabindex++)},a.sendEmail=function(a){!function(a,e,o,l,n){var t=!1;0<$("#isPBCompare").length&&(t=!0);jQuery.post(common_utils.appendSessionId("/mobile/comparison.do?action=email"),{userName:a,userEmail:e,sendToEmail:o,emailBody:l,isPBComparePage:t},function(a){var e=a.object;if(0==e.length)$("#email-body").slideUp("slow"),$("#email-success").css({display:"block"}).animate({opacity:1},2750).fadeOut("slow",function(){$(n).dialog("close")});else{$("#email-validation").html('<span><strong class="alert">'+$("#compare_email_corrections").text()+"</strong></span>");var o="";for(i=0;i<e.length;i++)o="<div style='padding-left:15px'>&bull;&nbsp;"+e[i]+"</div>",$("#email-validation").append(o),$("#email-validation").show()}},"json")}($("#senderName").val(),$("#mailFrom").val(),$("#mailTo").val(),$("#mailBody").val(),a)},a}(odApp.compareEmail||{}),$(function(){$("li.emailLink").find("a").on("click",function(a){a.preventDefault(),$("body").append('<div id="compareMailBody"></div>');$("#compareMailBody").load(common_utils.appendSessionId("/ajaxhtml/compareEmail.do"),function(){var a=$("#compareMailBody").dialog({bgiframe:!0,title:$("#compare_email_title").text(),modal:!0,resizable:!1,draggable:!1,position:"center",width:440,overlay:{opacity:.5,background:"black"},hide:"fade",open:function(){},close:function(a,i){$(this).dialog("destroy").remove()}});odApp.compareEmail.populateTranslations(),$("#compareMailBody").show("blind",{direction:"vertical"},1e3),$("#cancelEmail").on("click",function(){$(a).dialog("close"),$("#cancelEmail").off("click")}),$("#sendEmail").on("click",function(){odApp.compareEmail.sendEmail(a)})})})});
odApp.comparePaging=function(e){return e.checkSelectedComparisons=function(e){for(var o=new Array,t=0,a=$("#skuListFormID").find(".compare_checkbox"),c=a.length,r=0;r<c;r++){var n=a[r],i=n.id;if(i=i.replace("checkbox_",""),1==n.checked&&0==n.disabled){var d=document.getElementById("sku_"+i).value;o[t]=d,t++}}return 0<o.length?(odApp.comparePaging.askAddQuestion(e,o),!1):this.forward(e)},e.forward=function(e){var o=document.querySelector(".js-module-asyncSkuList");if(o){var t=o.parentNode,a=new CustomEvent("skuList.redirect",{detail:{target:e}});t.dispatchEvent(a)}else window.location.href=e;return!1},e.askAddQuestion=function(o,e){for(var t="<div id='comparemax'><div id='loadingbar'><p id='loading-message'>"+$("#compare_error_pleasewait").text()+"</p></div>",a=($(t+="<div id='compareYesNoBody' style='hidden'></div></div>").dialog({bgiframe:!0,title:$("#compare_paging_header").text(),modal:!0,resizable:!1,draggable:!1,position:"center",width:400,overlay:{opacity:.5,background:"black"},open:{effect:"fade",duration:4e3},close:function(){$(this).remove()},closeText:$("#compareLightboxCloseText").val()}),""),c=0;c<e.length;c++)a+=e[c],c+1<e.length&&(a+=",");var r=common_utils.appendSessionId("/ajaxhtml/compareYesNo.do");$("#compareYesNoBody").load(r,function(e){$("#loadingbar").hide(),$("#c_forward").text(o),$("#c_addedSkus").text(a)})},e}(odApp.comparePaging||{}),$(function(){odApp.compare.getSearchRefineObj().on("click",".paging",function(e){var o=$(this).attr("href");return odApp.comparePaging.checkSelectedComparisons(o)}),$(document).on("click","#no","#compareYesNoBody",function(e){forward=$("#c_forward").text(),odApp.comparePaging.forward(forward),$(this).closest(".ui-dialog-content").dialog("close")}),$(document).on("click","#yes","#compareYesNoBody",function(e){var o=document.querySelector(".compare_checkbox.alreadySelected").parentNode.querySelector('input[type="submit"]');o.disabled&&(o.disabled=!1),o.click()}),$(document).on("click","#cancelAdd",function(e){$(this).closest(".ui-dialog-content").dialog("close")}),$(document).on("change","#skuListFormID .sort select",function(){var e=$(this).find("option:selected").val();return odApp.comparePaging.checkSelectedComparisons(e)})});