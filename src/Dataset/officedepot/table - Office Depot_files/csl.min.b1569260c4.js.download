odApp.ui.csl.actions=function(){"use strict";var e,t;return{init:function(){e=document.querySelector("#command_hidden"),t=document.querySelector("#cslListForm")},executeRemoveAvailableItems:function(){e.setAttribute("name","cmd_removeItems"),t.submit()},executeRemoveUnavailableItem:function(e,t,n,i){var o=common_utils.appendSessionId("/mobile/altUtils.do?action=updateCSLItems&listId="+e+"&entryId="+t+"&skuId=&isSchoolList="+n);$.getJSON(o,i)}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.actions.init);
function addEvent(t){var e=t.type,n=t.action,o=t.element;o.addEventListener?o.addEventListener(e,n):o.attachEvent(e,n)}odApp.ui.csl.addProductToCart=function(){"use strict";var c={container:".js-csl-add-product-container",quantity:".js-csl-add-product-quantity",updateQtyButton:".csl-link-update",button:{name:".js-csl-add-product-cart",skuNumber:"data-sku-number",cslItemIndex:"data-csl-item-index"},addedButton:".js-csl-added-to-cart"};function n(t){var o,a,d,e;function n(){common_uielements.showAjaxLoadingOnBody({scrollTo:!1});var t=o.value,e=a.getAttribute(c.button.skuNumber),n=a.getAttribute(c.button.cslItemIndex);common_utils.asyncAddBySku(e,t,function(){initializeATCTagging(n,t),document.querySelector(".header-responsive")?common_uielements.updateCartStatusForResponsive():odApp.ui.myOfficeToolbar.loadToolbarCart();common_uielements.hideAjaxLoading(),d&&(a.classList.add("is-hidden"),d.classList.remove("is-hidden"))})}function i(){var t=window.pageYOffset;sessionStorage.cslUpdateQtyLocation=t}t&&(a=t.querySelector(c.button.name),o=t.querySelector(c.quantity),d=t.querySelector(c.addedButton),e=t.querySelector(c.updateQtyButton),a&&addEvent({element:a,type:"click",action:n}),e&&addEvent({element:e,type:"click",action:i}),sessionStorage.cslUpdateQtyLocation&&window.scrollTo(0,sessionStorage.cslUpdateQtyLocation))}return{init:function(){for(var t=document.querySelectorAll(c.container),e=0;e<t.length;e++)n(t[e])}}}(),addEvent({element:document,type:"DOMContentLoaded",action:odApp.ui.csl.addProductToCart.init});
var cslATCTagMapping={atcLocation:"atc_location",atcReferralUrl:"atc_referral_url",availableQty:"available_qty",businessRelation:"business_relation_code",categoryId:"category_id",productName:"name",quantity:"quantity",reviewsCount:"reviews_count",productId:"sku",siteType:"site_type_name",starRatingAvg:"star_rating_avg",unitPrice:"unit_price"};function initializeATCTagging(t,a){if("object"==typeof window&&window.odAnalytics)try{var e=window.location.href,n=document.getElementById("csl-sku-item-info-"+t),i=cslGenerateTagsObject(cslGetAttributeNames(n),n);i.atcReferralUrl=e,i.quantity=a;var r=cslNormalizeCartData(i);window.odAnalytics.onATC({auid:"bsd-shopping-list-old",payload:[r]})}catch(t){}}function cslGetAttributeNames(t){var e=t.attributes,n=[];return Object.keys(e).forEach(function(t){var a=e[t].name;n.push(a)}),n}function cslGenerateTagsObject(t,n){var i={};return t.forEach(function(t){var a=toCamelCase(t.substring(5).split("-").join(" ")),e=n.getAttribute(t);t.includes("data-")&&(i[a]=e)}),i}function cslNormalizeCartData(i){var r={};return Object.keys(cslATCTagMapping).forEach(function(t){var a=cslATCTagMapping[t],e=i[t],n=null==e;r[a]=n?"":e}),r}function toCamelCase(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,a){return 0==a?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"")}
odApp.ui.csl.emailList=function(){"use strict";var e,t=".js-csl-email-list";function i(e){e.preventDefault(),common_uielements.collabPopupOriginal(!0)}return{init:function(){(e=document.querySelector(t))&&e.addEventListener("click",i)}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.emailList.init);
odApp.ui.csl.printList=function(){"use strict";var t,n=".js-csl-print-list";function i(t){t.preventDefault(),window.print()}return{init:function(){(t=document.querySelector(n))&&t.addEventListener("click",i)}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.printList.init);
odApp.ui.csl.removeItem=function(){"use strict";var a={trigger:{name:".js-csl-remove-item",targetKey:"data-csl-remove-item-key",entryId:"data-csl-remove-item-unavailable-entry-id",listId:"data-csl-remove-item-unavailable-list-id",isSchoolList:"data-csl-remove-item-unavailable-is-school-list"}};function i(e){e.target.getAttribute(a.trigger.targetKey)?function(e){var t=e.target.getAttribute(a.trigger.targetKey),i=document.querySelector('[data-Auid="'+t+'"]');i&&(i.disabled&&(i.disabled=!1),i.checked=!0,common_uielements.showAjaxLoadingOnBody(),odApp.ui.csl.actions.executeRemoveAvailableItems())}(e):function(e){var t=e.target,i=t.getAttribute(a.trigger.entryId),o=t.getAttribute(a.trigger.listId),r=t.getAttribute(a.trigger.isSchoolList);odApp.ui.csl.actions.executeRemoveUnavailableItem(o,i,r,function(){window.location.reload(!0)}),common_uielements.showAjaxLoadingOnBody()}(e)}return{init:function(){!function(e){if(e)for(var t=0;t<e.length;t++)e[t].addEventListener("click",i)}(document.querySelectorAll(a.trigger.name))}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.removeItem.init);
odApp.ui.csl.selectAll=function(){"use strict";var l={trigger:".js-csl-see-similar-items",target:".js-csl-select-all-item-list"};function i(t){var e=t.target.getAttribute("data-auid"),i=document.querySelector(l.target+'[data-Auid="'+e+'"]');i&&i.classList.toggle("is-hidden")}return{init:function(){var t=document.querySelectorAll(l.trigger);t&&function(t){for(var e=0;e<t.length;e++)t[e].addEventListener("click",i)}(t)}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.selectAll.init);
odApp.ui.csl.selectAll=function(){"use strict";var n,c,e=".js-csl-select-all",t=".js-csl-select-all-item";function l(){var e=0;if(c){for(var t=0;t<c.length;t++)c[t].checked&&e++;n.checked=e==c.length}}return{init:function(){n=document.querySelector(e),c=document.querySelectorAll(t),n&&function(){if(n.addEventListener("click",function(){if(c)for(var e=0;e<c.length;e++)c[e].checked=n.checked}.bind(this)),c)for(var e=0;e<c.length;e++)c[e].addEventListener("change",l.bind(this))}()}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.selectAll.init);
odApp.ui.csl.toggleSettings=function(){"use strict";var s,t,n,i,o={trigger:{name:".js-toggle-csl-list-settings",autoOpen:"autoOpen"},target:{name:".js-toggle-csl-list-settings-container"},iconGear:{name:".js-toggle-csl-list-settings-icon-gear"},iconClose:{name:".js-toggle-csl-list-settings-icon-close"}};function g(){t.classList.toggle("opened-settings");var e=t.classList.contains("opened-settings")?"open":"close";odApp.utils.odAnalytics.pushOverlayTaggingEvent("shopping-list-setting-modal",e),n.classList.toggle("is-hidden"),i.classList.toggle("is-hidden")}return{init:function(){s=document.querySelector(o.trigger.name),t=document.querySelector(o.target.name),s&&(n=s.querySelector(o.iconGear.name),i=s.querySelector(o.iconClose.name)),s&&t&&(function(){s.addEventListener("click",g.bind(this))}(),function(){var e=s.dataset[o.trigger.autoOpen];if(e)try{for(var t=JSON.parse(e),n=0;n<t.length;n++)if(document.querySelector(t[n]))return g()}catch(e){}}())}}}(),document.addEventListener("DOMContentLoaded",odApp.ui.csl.toggleSettings.init);
var bLoadCSLLightbox=!1;odApp.ui.csl.od=function(){"use strict";var l,s,c,i=[],o=[],a=[],n=1,d=n,e={skuPageElementName:'input[name^="cmd_addCSL.button.INDEX["]',enableSkuPageAddToList:function(){$(document).on("click",this.skuPageElementName,function(t){$("#cslDoLogin").length?function(t,e){p(),c=$('input[name="entryFormList[0].qty"]'),s=c.val(),""===$.trim(s)&&(s="1");l=$("#skuId").val();var n="clickedAddToCSL=true&cslItemQty="+s+"&cslSku="+l;common_uielements.loadModalLoginBehavior($(t).attr("name"),"body","#accountLoginDialog",!0,e,n)}(this,t):(p(),c=$('input[name="entryFormList[0].qty"]'),s=c.val(),""===$.trim(s)&&(s="1"),l=$("#skuId").val(),r(t))})},disableSkuPageAddToList:function(){$(this.skuPageElementName).off("click").on("click",function(t){t.preventDefault()})}};function r(t){"undefined"!==t&&t&&t.preventDefault();var e=$("#generic-form-ready-dialog"),n=$("#csl_title_chooseorcreate").val();common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap"),e.load(common_utils.appendSessionId("/ajaxhtml/displayShoppingLists.do"),function(){$(document).on("click","#createListButton",function(t){common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap"),function(){var t=$("#generic-form-ready-dialog");t.load(common_utils.appendSessionId("/ajaxhtml/displayCreateList.do"),function(){$("#saveListDetails").click(function(){common_uielements.showAjaxLoadingInsideElement("div.create_list_wrap",$("#csl_title_addingtolist").val()),$("#validate_message").hide(),function(){var e=$("#validate_message");if(0===$.trim($("#newListName").val()).length)return common_uielements.hideAjaxLoading(),e.html($("#csl_required_listname").val()),e.show();$.getJSON("/csl/createCslAndAddItems.do",function(){var t=h("");return t.newListName=$("#newListName").val(),t.newDescription=$("#newDescription").val(),t.action="new",t}(),function(t){t.errorMessage?(common_uielements.hideAjaxLoading(),e.html(t.errorMessage),e.show()):$.post("/ajaxhtml/cslItemsAdded.do",{listId:t.listId,listStyle:"csl"},function(t){f(t)})})}()}),$('#startSchoolList input[name="bts_sku"]').val(l),$('#startSchoolList input[name="bts_qty"]').val(s),common_uielements.hideAjaxLoading()}),m(t,$("#csl_title_createnewlist").val())}(),$("#myOfficeToolbar").length}),$(document).on("click",".addToListBTS",function(){u($(this).attr("id"))}),$(".addToListShopping").on("click",function(){common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap");var t=$(this).attr("id");$.post("/ajaxhtml/cslItemsAdd.do",h(t),function(t){f(t)})}),common_uielements.hideAjaxLoading()}),m(e,n)}function u(t,e){e&&m($("#generic-form-ready-dialog"),$("#csl_title_pleasewait").val()),common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap"),$.post("/ajaxhtml/tppcAddToList.do",{sku:l,qty:s,listId:t,listStyle:"tppc"},function(t){f(t)})}function m(t,e){t.dialog({modal:!0,title:e,width:460,position:"center",dialogClass:"bg_white"})}function h(t){var e={};if(e.destinationListId=t,e.listId=t,e.listStyle="csl",e.cmd_addtolist="ADD TO LIST",e.useSelected=!1,e.ajax="y",l=l||$("#skuId").val(),s=s||$("#mainqtybox").val(),0===o.length)e["entryFormList[0].sku"]=l,e["entryFormList[0].qty"]=s;else for(var n=0;n<o.length;n++)e["entryFormList["+n+"].sku"]=i[n],e["entryFormList["+n+"].qty"]=o[n],e["entryFormList["+n+"].selected"]=!0;return e}function f(t){var e=$("#generic-form-ready-dialog");e.html(t),function(){var t,e=$("#cslConfirm");$("#pageName").val();if(0===o.length)t=$('span[class="added_sku_id_'+l+'"][title="'+g(s)+'"]').first().text(),e.append("<tr><td>"+t+"</td></tr>");else for(var n=0;n<o.length;n++)t=$('span[class="added_sku_id_'+i[n]+'"][title="'+g(o[n])+'"]').first().text(),e.append("<tr><td>"+t+"</td></tr>")}(),$("#cslListNameAdded").length?m(e,(0!==o.length?o.length:1)+" "+$("#csl_title_itemsadded").val()):m(e,$("#csl_title_error").val()),function(){if(0===o.length)void 0!==c&&c.val(d);else for(var t=0;t<a.length;t++)a[t].val(d)}(),$("#continueShopping").click(function(){e.dialog("close")}),$("#viewMyList").click(function(){window.location.href=$("#aMyList").attr("href")}),$("#shareList").click(function(){e.dialog("close"),common_uielements.collabPopup($("#modalCollabSkus").text())})}function g(t){if(""===t)return n;var e=t;return"number"!=typeof t&&(e=parseInt(t,10)),isNaN(e)&&(e=n),0===e?e:Math.max(e,0)}function p(){s=l="",i=[],o=[],c=null,a=[]}function v(n){$(document).on("keyup",n,function(t){$(t.target).val($(t.target).val().replace(/[^A-Za-z0-9-]+/g,""))}),$(document).on("blur",n,function(t){var e=$(t.target).val().replace(/^[^a-zA-Z0-9]*|[^a-zA-Z0-9]*$/g,"");$(n).val(e)})}return{init:function(){void 0!==bLoadCSLLightbox&&bLoadCSLLightbox&&r(),0===$('input[name="addToCart_schoolList"]').length?d="":$('input[name^="cmd_addList.button.INDEX["]').each(function(){var t=$(this).attr("name").replace(/^cmd_addList.button.INDEX\[|\]$/g,"");$('input[name="entryFormList['+t+'].qty"]').val(n)}),$(document).on("click",'input[name^="cmd_addList.button.INDEX["]',function(t){if($("#cslDoLogin").length)!function(t,e){p();var n=$(t).attr("name").replace("cmd_addList.button.INDEX[","");n=n.replace("]",""),c=$('input[name="entryFormList['+n+'].qty"]'),s=c.val(),""===$.trim(s)&&(s="1");l=$("#sku_"+n).val();var i="clickedAddToCSL=true&cslItemQty="+s+"&cslSku="+l;common_uielements.loadModalLoginBehavior($(this).attr("name"),"body","#accountLoginDialog",!0,e,i)}(this,t);else{p();var e=$(this),n=e.closest("form"),i=e.attr("name").replace(/^cmd_addList.button.INDEX\[|\]$/g,""),o='input[name="entryFormList['+i+'].qty"]';c=n.find(o),s=c.val(),l=$("#sku_"+i).val();var a=$("#pickedListId");if(a.length)return u(a.text(),!0),!1;r(t)}}),e.enableSkuPageAddToList(),$(document).on("click","#addAllToList",function(t){p(),$('input[name^="cmd_addList.button.INDEX["]').each(function(){var t=$(this).attr("name").replace(/^cmd_addList.button.INDEX\[|\]$/g,""),e=$('input[name="entryFormList['+t+'].qty"]');a.push(e),o.push(e.val());var n="#sku_"+t;i.push($(n).val())}),l=i.join(","),s=o.join(",");var e=$("#pickedListId");if(e.length)return u(e.text(),!0),!1;if($("#cslDoLogin").length){var n="clickedAddAllToCSL=true&cslItemQty="+s+"&cslSku="+l;common_uielements.loadModalLoginBehavior($(this).attr("name"),"body","#accountLoginDialog",!0,t,n)}else r(t)}),$('form .quantity_box input[type="number"]').each(function(){bindQty($(this))});var t=window.location.pathname;("/checkout/confirmRouter.do"===t||"/checkout/checkoutProcess.do"===t)&&$("#btsBefore").length<1&&$.ajax({type:"GET",url:common_utils.appendSessionId("/mobile/schoolback/fivePercent.do"),async:!1,cache:!1,dataType:"json",success:function(t){""!==t.schoolInfo&&"string"==typeof t.schoolInfo?($("#fivePercentBack").show(),$("#schoolInfo").html(t.schoolInfo)):$("#btsOffer").show()}}),0<$(".enteritem").length&&v("#"+this.id),0<$("#skuNumber").length&&v("#skuNumber"),0<$("#skuNumber_cart").length&&v("#skuNumber_cart")},setSelectedSku:function(t){l=t},setSelectedQty:function(t){s=t}}}(),$(odApp.ui.csl.od.init);