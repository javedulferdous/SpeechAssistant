window.CQ_Analytics||(window.CQ_Analytics={});
(function(n,g){g.mboxes=g.mboxes||[];var l=function(g,h){function k(a){v&&console.log(a)}function n(a){try{0===a.indexOf("/")&&p&&0!==a.indexOf(p+"/")&&(a=p+a)}catch(d){}return a}function w(a){try{var d=g.ajax({type:"GET",url:n(a),async:!1,externalize:!1,encodePath:!1,hook:!1});return d?d:null}catch(c){return null}}function q(){return CQ.shared.HTTP.getPath(top.document.location.href).includes("/editor.html/")}function x(a){var d=CQ.shared.HTTP.getParameter(document.location.href,"wcmmode");q()&&
(d="disabled");d&&0<d.length&&(a=CQ.shared.HTTP.addParameter(a,"wcmmode",d));return a}function r(a,d){a=x(a);var c=(a=w(window.targetGlobalSettings.currentPagePath+".targetoffer.html"+a))&&a.responseText&&0<a.responseText.length;if(a&&a.status&&200===a.status&&c){c=document.getElementById(d);var b=!1;if(c){for(;c.firstChild;)c.removeChild(c.firstChild);b=c.getElementsByTagName("div");1===b.length&&(c=b[0]);b=document.createElement("div");b.innerHTML=a.responseText;c.appendChild(b);b=c.getElementsByTagName("script");
for(var e=0;e<b.length;e++)eval(b[e].text);b=!0;if(c=c.parentElement)e=document.createEvent("CustomEvent"),e.initEvent("target-dom-loaded",!0,!1),e.mboxName=d,c.dispatchEvent(e)}b||document.write(a.responseText)}}function m(){for(var a=0;a<h.mboxes.length;a++){var d={};Array.isArray(h.mboxes[a].staticParameters)&&h.mboxes[a].staticParameters.map(function(a,c){a=a.split("\x3d");2===a.length&&(d[a[0]]=a[1])});for(var c=0;c<CQ_Analytics.mboxes[a].mappings.length;c++){var b="",e=CQ_Analytics.mboxes[a].mappings[c].param,
g="/"+h.mboxes[a].mappings[c].ccKey.replace(".","/");-1<h.mboxes[a].isProfile.indexOf(e)&&(b="profile.");g=h.DataProvider.replaceVariables(y(g));d[b+e]="undefined"!==typeof g?g:""}h.mboxes[a].includeResolvedSegments&&h.SegmentMgr&&0<h.SegmentMgr.getResolved().length&&(d["profile._cq_.resolvedSegments"]="|"+h.SegmentMgr.getResolved().join("|")+"|");(function(c,d){setTimeout(function(){CQ_Analytics.TestTarget.updateMboxContent(c,d)},0<a?100:0)})(h.mboxes[a].name,d)}}function y(a){var d=void 0;(a=window.ContextHub?
ContextHub.get(a):h.ClientContext.get(a))&&(Array.isArray(a)?d=a.join(","):"object"!==typeof a&&(d=a));return d}function t(){var a=[];if(window.CQ_Analytics&&window.CQ_Analytics.TestTarget&&window.CQ_Analytics.TestTarget.mappings)for(var d in window.CQ_Analytics.TestTarget.mappings)a.push(d);return a}function z(){if("undefined"!==typeof CQ&&CQ.WCM&&CQ.utils&&CQ.utils.WCM)return CQ.WCM.isPreviewMode()||CQ.utils.WCM.isEditMode();var a=(document.cookie||"").split(/;\s*/).reduce(function(a,c){(c=c.match(/([^=]+)=(.*)/))&&
(a[c[1]]=unescape(c[2]));return a},{});return"undefined"===typeof a.wcmmode||"preview"===a.wcmmode||"edit"===a.wcmmode}function u(){var a=document.querySelector('[class*\x3d"aem-AuthorLayer"]');return a?a.className.match("aem-AuthorLayer-[^ ]+")[0]:null}var A=/^(?:http|https):\/\/[^/]+(\/.*)\/(?:etc\.clientlibs|etc(\/.*)*\/clientlibs|libs(\/.*)*\/clientlibs|apps(\/.*)*\/clientlibs|etc\/designs).*\.js(\?.*)?$/,b={};if(this.constructor===l.prototype)throw"This is a singleton!";if(l.instance)return l.instance;
l.instance=b;var v=-1!==window.location.href.indexOf("debug-mbox-calls\x3d1"),p=function(){try{if(window.CQURLInfo)return CQURLInfo.contextPath||"";for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){var c=A.exec(a[b].src);if(c)return c[1]}}catch(f){}return""}();b.registeredCHListeners={};b.usedStoresLoaded=!1;b.defaults={};b.mappings=[];b.maxProfileParams=200;b.pull=function(a,b,c){"undefined"===typeof c&&(a=a.replace(/(\/content\/campaigns\/.*?)\/(.*)/,"$1/master/$2"));r(a,b)};
b.displayOffer=function(a,b){adobe.target.getOffer({mbox:a,params:b,success:function(b){adobe.target.applyOffer({mbox:a,selector:"#"+a,offer:b})},error:function(b,d){console.error(b,d);g("#"+a).css("visibility","visible")}})};b.updateMboxContent=function(a,d){k("Updating content for mbox "+a);if(q()){var c=u();c?"aem-AuthorLayer-Edit"===c?b.signalDefaultOffer(a):b.displayOffer(a,d):setTimeout(function(){b.updateMboxContent(a,d)},100)}else b.displayOffer(a,d)};b.registerMboxUpdateCalls=function(){"undefined"!==
typeof window.CQ_Analytics&&window.CQ_Analytics.TestTarget.mappings&&(k("[Target][init] Registering Mbox update calls"),0<t().length?b.registerContextHubListeners():m())};b.registerContextHubListeners=function(){if(window.ContextHub){for(var a=t(),d=[],c=0;c<a.length;c++){var f=a[c],e=f.split(".")[0];f="/"+f.replace(".","/");ContextHub.get(e)&&!b.registeredCHListeners[e]&&(b.registeredCHListeners[e]=!0,d.push(f),k("[Target][CH] - Listening for updates on "+f+" CH"))}0<d.length&&ContextHub.bind(d,
function(a){k("[Target][CH][registerContextHubListeners] All properties available, triggering update!");m();b.usedStoresLoaded=!0},function(a){k("[Target][CH][registerContextHubListeners] Not all properties available, triggering update!");b.usedStoresLoaded||m()},500)}};b.addMbox=function(a){var d=!1,c=!1;CQ_Analytics.mboxes||(CQ_Analytics.mboxes=[]);for(var f=0;f<CQ_Analytics.mboxes.length;f++){var e=CQ_Analytics.mboxes[f];if(e.id===a.id){CQ_Analytics.mboxes.splice(f,1);d=!0;c=e.defined;break}}a.defined=
c;h.mboxes.push(a);a=a.mappings;for(c=0;c<a.length;c++)f=a[c].ccKey,b.mappings[f]||(b.mappings[f]={});return d};b.triggerUpdate=function(a){"undefined"===typeof a&&(a=500);b.reloadRequested||(b.reloadRequested=!0,setTimeout(function(){var a=u();("aem-AuthorLayer-Edit"===a||"aem-AuthorLayer-Preview"===a||z())&&m();b.reloadRequested=!1},a))};b.signalDefaultOffer=function(a){"undefined"===typeof b.defaults[a]?console&&console.log("The default offer path was not found in the internal map for mbox "+a):
(r(b.defaults[a],a),g("#"+a).css("visibility","visible"))};return b};g.TestTarget=l(n,g);top.$(top.document).on("editor-frame-mode-changed",function(){CQ_Analytics&&CQ_Analytics.TestTarget&&CQ_Analytics.TestTarget.triggerUpdate()})})($,window.CQ_Analytics);