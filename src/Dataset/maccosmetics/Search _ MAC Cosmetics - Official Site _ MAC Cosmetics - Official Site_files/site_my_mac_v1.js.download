!function(e,t,i,n){"use strict";n.template=n.template||{};var o={formatter:e(".site-my-mac-v1"),signed_in:void 0===n.userInfoCookie?"0":n.userInfoCookie.getValue("signed_in"),is_mobile:void 0===n.client.isMobile?"0":n.client.isMobile};t.behaviors.siteMyMacV1={get:function(e){return o[e]},set:function(e,t){o[e]=t},setMyMac:function(e,t){if("1"==e.get("signed_in")){var i=n.userInfoCookie.getValue("first_name");i&&i.length>7&&(i=""),t.find(".first-name").html(i)}},showMyMacContents:function(i){var n=i.find(".js-gnav-util-trigger"),o=i.find(".js-gnav-util-trigger-reset");if(e(document).trigger("click"),"0"==this.get("is_mobile")){i.addClass("active"),t.settings.globals_variables&&t.settings.globals_variables.cr20&&n.prop("checked",!0);var s=e('<div class="site-header__dim-overlay"></div>'),a=e(".site-header").siblings(".site-container");s.prependTo(a),i.bind("clickoutside",(function(){i.removeClass("active").unbind("clickoutside"),s.remove(),o.trigger("click")})),i.find(".site-my-mac__contents-close").once().click((function(e){e.preventDefault(),i.find(".js-my_mac_link").attr("aria-expanded","false").focus(),i.trigger("clickoutside")}))}},setContentsTitle:function(e,t){var i=e.find(".site-my-mac__contents");!0===t?(i.find(".site-my-mac__contents-title").hide(),i.find(".site-my-mac__contents-title__alt").show()):(i.find(".site-my-mac__contents-title").show(),i.find(".site-my-mac__contents-title__alt").hide())},setContentsOffset:function(t){var i=e(".site-header .site-bag");if(1===i.length){var n=i.outerWidth(!1);t.find(".site-my-mac__contents").css({right:"-"+n+"px"})}},setMyMacContents:function(e,t){var i=e.find(".site-my-mac__contents");!0===t?(i.find(".site-my-mac__contents-signin").hide(),i.find(".site-my-mac__contents-signed_in").show()):(i.find(".site-my-mac__contents-signin").show(),i.find(".site-my-mac__contents-signed_in").hide())},isLoyaltyMember:function(){return"1"==n.userInfoCookie.getValue("is_loyalty_member")},isRewardsEligible:function(){return"1"==n.userInfoCookie.getValue("is_rewards_eligible")},getLoyaltyLevel:function(){return n.userInfoCookie.getValue("loyalty_level")},getTierFooterSelector:function(e){return".site-my-mac__contents-footer__loyalty-tier"+e},attach:function(t,o){if(!this.attached){this.attached=!0;var s=this,a=s.get("formatter"),c=e(".js-forgot-password",t),r=e(".js-return-user-email-gnav",t),l=e(".js-signin-errors",t);c.length>0&&n.signin.forgotPassword({resetPassword:!0,emailNode:r,errorListNode:l,forgotPasswordLink:c}),a.each((function(){var t=e(this);if(t.find(".site-my-mac__link").once().click((function(){if("0"==s.get("is_mobile"))return t.hasClass("active")?(t.removeClass("active"),t.trigger("clickoutside")):(e(window).trigger("window::show_login_overlay"),e(this).children(".js-my_mac_link").attr("aria-expanded","true"),n.restrict_navigation(e(".js-my-mac-overlay"))),!1})).on("mouseleave",(function(){e(this).children(".js-my_mac_link").attr("aria-expanded","false"),e("input:focus",t).blur()})),t.find(".overlay-toggle").once().click((function(){var n=t.find(".site-my-mac__overlay-content");return n.length>0&&i.overlay.launch({content:n.clone(!0),includeBackground:!0,includeCloseLink:!0,initialHeight:0,height:0,width:"50%",onComplete:function(){e(this).colorbox.resize()}}),!1})),e(window).on("window::show_login_overlay",(function(){t.hasClass("active")||setTimeout((function(){s.showMyMacContents(t)}),100)})),"1"==s.get("signed_in")){s.setContentsTitle(t,!0),s.setMyMacContents(t,!0);var o=e(".js-mac-select-points");if(o){var a=n.userInfoCookie.getValue("current_available");o.html(a)}var c=parseInt(n.userInfoCookie.getValue("is_loyalty_member"))?"/account/loyalty/index.tmpl":"/account/mac-lover.tmpl#offers";if(e(".js-mac-lover-redirect-link").attr("href",c),s.isLoyaltyMember()&&s.isRewardsEligible()){var r=t.find(".site-my-mac__contents-footer"),l=Number(s.getLoyaltyLevel());if(l>=0&&l<=4){var d=s.getTierFooterSelector(l),m=e(d);r.addClass("hidden"),m.removeClass("hidden")}}}else{sessionStorage.show_my_mac&&sessionStorage.removeItem("show_my_mac");var f=t.find(".js-facebook_signin"),u=t.find("form"),g=u.attr("action");g.match(/^http[s]?:/)?u.attr("action",g.replace("http:","https:")):u.attr("action","https://"+window.location.hostname+g),sessionStorage.getItem("loyalty_redirect")?t.find('[name="RETURN_URL"]').val(sessionStorage.getItem("loyalty_redirect")):window.location.pathname.search("password_request")>0||window.location.pathname.search("confirm")>0||window.location.pathname.search("signin")>0?t.find('[name="RETURN_URL"]').val("/account/index.tmpl"):location.pathname.match("/checkout/checkout.tmpl")?(f.attr("action","/checkout/checkout.tmpl"),f.find('[name="RETURN_URL"]').val("/checkout/checkout.tmpl")):t.find('[name="RETURN_URL"]').val(window.location.pathname+window.location.search+window.location.hash)}s.setContentsOffset(t),e(window).resize(_.debounce((function(){s.setContentsOffset(t),t.hasClass("active")&&t.trigger("clickoutside")}),50)),e(window).on("gnavdata_success",(function(e,i){s.setMyMac(s,t)}))}))}},attached:!1},e(".favorites-none__sign").click((function(i){return"0"==t.behaviors.siteMyMacV1.get("is_mobile")&&(i.preventDefault(),e(window).trigger("window::show_login_overlay")),!0}))}(jQuery,Drupal,window.generic||{},window.site||{});
//# sourceMappingURL=site_my_mac_v1.js.map
