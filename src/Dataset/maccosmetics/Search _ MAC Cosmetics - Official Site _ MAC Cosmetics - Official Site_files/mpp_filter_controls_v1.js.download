var site=site||{},Router=Router||{};!function(t){"use strict";Drupal.behaviors.mppFilterControls={attach:function(t){site.mppFilterControls.init(t)}}}(jQuery),site.mppFilterControls={init:function(t){if($(".mpp-filter-img-v1").length<1)return null;var i={state:{},filters:{},masterFilters:{},setState:function(t,i){_.has(this.state,t)?_.contains(this.state[t],i)?this.state[t]=_.without(this.state[t],i):this.state[t].push(i):(this.state[t]=[],this.state[t].push(i)),_.isEmpty(this.state[t])&&delete this.state[t]},nukeState:function(){this.state={}},isEmpty:function(){return _.isEmpty(this.state)}},e=(Router({"/filter":{"/([\\S]*)":function(t){var i=t.split("/");_.each(i,(function(t){var i=t.split("=");i[0],i[1].split(",")}))}}}).configure({strict:!1}).init(),$(".grid-filter",t)),r=".grid-filter__facet-item",l=function(){_.each(site.productApp.products,(function(t){t.showProductDOM(".grid--mpp__item")})),e.find(r).removeClass("grid-filter__facet-item--count-zero");var t=$(".grid--mpp__item:has(.product)");$(".grid--mpp__item:has(.node-elc-nodeblock)").each((function(i){var e=$(this);void 0!==e.data("position")&&e.detach().insertBefore(t[e.data("position")-i])}))};$(".grid-filter__facet").each((function(){$(".grid-filter__column-title",$(this)).click((function(t){$(this).attr("aria-expanded","true"===$(this).attr("aria-expanded")?"false":"true"),$(this).parent().toggleClass("grid-filter__column--open")}));var t=$(this).data("filter-key");i.filters[t]={},$(".grid-filter__facet-item",$(this)).each((function(){var e=$(this).data("filter-facet"),r=$(".grid-filter__facet-item-count",$(this)).text();i.filters[t][e]=r})),i.masterFilters[t]=$(this).data("filter-master")?i.filters[t]:""}));var a=function(t,e){_.each(i.filters,(function(t,e){_.each(t,(function(t,r){i.filters[e][r]=0}))})),_.each(t,(function(t){_.each(i.filters,(function(e,r){_.each(e,(function(e,l){t.filterProductsByAttribute(r,[l])&&i.filters[r][l]++}))}))})),n(e)},n=function(t){console.log(i.filters),_.each(i.filters,(function(i,e){_.each(i,(function(i,e){var r=$("[data-filter-facet='"+e+"']");if($(".grid-filter__facet-item-count",r).text(i),t){var l=t.parent()[0]===r.parent()[0];0!==i||l?0===i||l||r.removeClass("grid-filter__facet-item--count-zero"):r.addClass("grid-filter__facet-item--count-zero")}}))}))};e.on("click",r,(function(){var t=$(this);t.attr("aria-selected","false"===t.attr("aria-selected")?"true":"false");var e=t.parents(".grid-filter__facet").data("filter-key"),r=t.data("filter-facet");i.setState(e,r),_.each(site.productApp.products,(function(t){t.hideProductDOM(".grid--mpp__item"),t.showProductDOM(".mpp-complementary-products__item")}));var n=function(){var t,e=[];_.forEach(i.state,(function(i,r){t=_.map(i,(function(t){return t.replace(/_/g," ")})),e.push(_.map(site.productApp.findProductsByProductAttribute(r,t),(function(t){return t.data.PRODUCT_ID})))}));var r=_.intersection.apply(null,e);return _.flatten(_.map(r,(function(t){return site.productApp.lookupProducts({prodid:t})})))}();a(n,t);var s=$(".grid--mpp__item:has(.node-elc-nodeblock)");s.each((function(t){var i=$(this);void 0===i.data("position")&&i.data("position",$(this).index())}));var c=s.first().parent();s.each((function(t){$(this).appendTo(c)})),_.each(n,(function(t){t.showProductDOM(".grid--mpp__item")})),i.isEmpty()&&(l(),a(site.productApp.products)),t.toggleClass("grid-filter__facet-item--checked"),d()}));$(window).on("productApp:products_added",(function(){!function(){var t=window.location.hash;if(t.indexOf("#filters")>=0){window.location.hash="";for(var i=t.substr(9).split("/"),e=0;e<i.length;e++){var r=i[e],l=$('.grid-filter__facet-item[data-filter-facet="'+decodeURI(r)+'"]');l.length>0&&!l.hasClass("grid-filter__facet-item--count-zero")&&l.trigger("click")}}}()}));var s,c,o,d=function(){var t="";if(history.pushState("",document.title,window.location.pathname+window.location.search),!i.isEmpty()){window.location.hash;var e=window.location.href,r="#filters/";e.indexOf("#")>=0&&(r="filters/"),t=e+r;var l=i.state,a="";for(var n in l)for(var s=l[n],c="",o=0;o<s.length;o++)c=s[o],a.length>0?a.indexOf(c)<0&&(a=a+"/"+c):a=c;window.location.href=t+a}},f=[];window.filter=f,s=null==site.translations.product.mpp_filtering_done?"Done":site.translations.product.mpp_filtering_done,c=null==site.translations.product.mpp_filtering_filtered_by?"Filtered by":site.translations.product.mpp_filtering_filtered_by,o=null==site.translations.product.mpp_filtering_clear_all?"Clear all":site.translations.product.mpp_filtering_clear_all;var u=function(){var i="",e=[];$.each(f,(function(t,e){i+='<div class="grid-filter__results-item" data-filter-name="+ value +">         <div class="grid-filter__results-item-title js-remove-filter" data-filter-name="'+e+'" tabindex="0" role="link" aria-label="'+e+'">'+e.replace("_"," ")+'</div>         <div class="grid-filter__results-item-remove js-remove-filter" data-filter-name="'+e+'" role="link" aria-label="'+e+'"><i class="icon-remove"></i></div>         </div>         '})),$(".grid-filter__results-list",t).html(i),$(".grid-filter__column").each((function(t){var i=$(this);e[t]="",$.each(f,(function(r,l){0!==i.find('[data-filter-facet="'+l+'"]').length&&(e[t]+='<div class="grid-filter__results-item" data-filter-name="'+l+'"">            <div class="grid-filter__results-item-title" data-filter-name="'+l+'">'+l.replace(/_/g," ")+'</div>            <div class="grid-filter__results-item-remove" data-filter-name="'+l+'">X</div>            </div>            ')})),$(this).find(".grid-filter__partial-results-list").html(e[t])}))},p=function(){f.length>0?($(".grid-filter__results",t).slideDown("fast"),$(window).width()<768&&$(".filter-popup-clear-all-button",t).css("display","inline-block")):($(".grid-filter__results",t).slideUp("fast"),$(window).width()<768&&$(".filter-popup-clear-all-button",t).css("display","none"))},h=function(e){f=[],$(".grid-filter__facet-item--checked",t).removeClass("grid-filter__facet-item--checked"),$(".grid-filter__results-list",t).html(""),i.nukeState(),window.location.hash="",e.data.print&&e.data.print(),e.data.check&&e.data.check(),l(),a(site.productApp.products)},m=function(i){i.preventDefault();var e=$(this).attr("data-filter-name");$('.grid-filter__facet-item[data-filter-facet="'+e+'"]',t).trigger("click"),a(site.productApp.products)},g=$(".grid-filter",t),v="<div class='grid-filter__results'>"+("<label class='grid-filter__results-label'>"+(c=Drupal.settings.globals_variables.foundation_filter_mobile?c:c+" :")+"</label>")+"<div class='grid-filter__results-list'></div>        <span class='grid-filter__results-clear js-clear-filters' tabindex='0' role='link'>"+o+"</span>        </div>",w=function(t){t.preventDefault();var i=$(this).closest(".grid-filter__column");i.siblings(".grid-filter__column").removeClass("grid-filter__column--active"),i.toggleClass("grid-filter__column--active")};$(".grid-filter_facet-list",t).each((function(){$(this).append("<li class='grid-filter__done-button-wrapper'>          <div class='grid-filter__done-button js-done-button' tabindex='0' role='button'>"+s+"</div></li>")})),g.after(v),$(".grid-filter__column").append("<div class='grid-filter__partial-results-list'></div>"),u(),p(),$(document).on("click",".grid-filter__column-title",w),$(document).on("click",".grid-filter__done-button",w),$(document).on("click",".grid-filter__results-item-title",m),$(document).on("click",".grid-filter__results-item-remove",m),$(document).on("click",".grid-filter__results-clear",{check:p,print:u},h),$(document).on("keydown",".js-clear-filters",(function(t){13===site.getKeycode(t)&&$(this).trigger("click",{check:p,print:u})})),$(document).on("click",".filter-popup-clear-all-button",{check:p,print:u},h),$(document).on("click",".grid-filter__facet-item:not(:last-child)",{update:function(t){f.indexOf(t)>-1?f=f.filter((function(i){return i!==t})):f.push(t)},check:p,print:u},(function(t){t.preventDefault();var i=$(this);t.data.update&&t.data.update(i.attr("data-filter-facet")),t.data.print&&t.data.print(),t.data.check&&t.data.check()})),$("body").click((function(t){$(t.target).closest(".grid-filter__column").length||$(".grid-filter__column--active").length&&$(window).width()>767&&$(".grid-filter__column--active").find(".grid-filter__done-button").trigger("click")})),$(".mpp-filter-with-attributes-mobile",t).click((function(i){$(".mpp-filter-with-attributes").show(),$(".mpp-filter-with-attributes",t).hasClass("first-filter-column-opened")&&$(window).width()<768&&$(".grid-filter__column",t).first().find(".grid-filter__column-title").trigger("click")})),$(".filter-popup-done-button",t).click((function(t){$(".mpp-filter-with-attributes").hide()})),$(".grid--mpp:not(.grid-layout--masonry)",t).mixItUp({selectors:{target:".grid--mpp__item"}})}};
//# sourceMappingURL=mpp_filter_controls_v1.js.map
