!function(e,t,i,s){"use strict";s.template=s.template||{};var n=0,a={formatter:e(".site-bag-v1"),template:"site_bag_contents",is_mobile:void 0===s.client.isMobile?"0":s.client.isMobile,bagCount:void 0===s.userInfoCookie?0:parseInt(s.userInfoCookie.getValue("item_count")),fadeOutDelay:2e3};t.behaviors.siteBagV1={get:function(e){return a[e]},set:function(e,t){a[e]=t},loadBagContents:function(t,s,a,o){var r=this;o=void 0!==o?o:function(){},void 0!==a&&(a&&Array.isArray(a)&&a.length||Object.keys(a).length?r.repopCart(t,a.trans_data,a,s,o):i.jsonrpc.fetch({method:"trans.get",params:[{trans_fields:["TRANS_ID","totals"],payment_fields:[],order_fields:["items","samples","offerCodes"]}],onSuccess:function(e){var i=e.getValue();r.repopCart(t,i,a,s,o)},onFailure:function(t){n&&e(location).attr("href","/checkout/viewcart.tmpl")}}))},repopCart:function(i,n,a,o,r){var l,d=this;if(n===l||null===n)return d.setBagCount(i,d.get("bagCount")?d.get("bagCount"):0),d.showBagContents(i,!1),i.find(".site-bag__contents-subtotal").hide(),void(t.settings.globals_variables&&t.settings.globals_variables.enable_preorder&&(i.find(".js-cart_overlay__preorderhead").hide(),i.find(".js-site-bag__contents-preorder-total").hide()));for(var c=d.get("template"),_=n.order.items!==l?n.order.items.concat(n.order.samples):[],g={items:[],recommendations:[],display_sub_line:t.settings.globals_variables.display_sub_line!==l?t.settings.globals_variables.display_sub_line:0,display_tax_price:t.settings.globals_variables.display_tax_price!==l?t.settings.globals_variables.display_tax_price:0,display_bundle_info:0},u=0,f=_.length;u<f;u++){var p=_[u];for(var h in g.items[u]={},p)p.hasOwnProperty(h)&&(g.items[u][h.replace(/\./,"_")]=p[h]);if(g.items[u].hasOwnProperty("isKitItem")&&1===g.items[u].isKitItem)for(var b=0,m=g.items[u].items.length;b<m;b++){var v=g.items[u].items[b];for(var w in v)v.hasOwnProperty(w)&&(g.items[u].items[b][w.replace(/\./,"_")]=v[w])}g.items[u].hasOwnProperty("isBundleItem")&&g.items[u].isBundleItem&&(g.display_bundle_info=1)}g.enablePreorder=t.settings.globals_variables.enable_preorder!==l?t.settings.globals_variables.enable_preorder:0,g.hasPreorderItems=n.preorder&&n.preorder.items_count!==l?1:0,g.hasRecommendations=n.hasRecommendations,g.recommendations=n.recommendations,g.formattedSubtotal=n.formattedSubtotal,g.formattedSubtotalNoTax=n.formattedSubtotalNoTax||n.formattedSubtotal,g.formattedSubtotalWithTax=n.formattedSubtotal,g.items_count=n.items_count;var C=s.template.get({name:c,data:g});i.find(".site-bag__contents").remove(),i.append(C).promise().done((function(){d.loadPreOrderBagContents(n),i.find(".cart-product-kit-shade").tooltipster({arrow:!1,contentAsHTML:!0,hideOnClick:!0,theme:"mac-tooltip",offsetX:10}),i.find(".js-shipping-overlay").once().click((function(){return e(window).trigger("window:show_shipping_overlay"),!1})),!0===o?(d.setBagTitle(i,!0,a),d.showBagContents(i,!0)):d.setBagTitle(i,!1,[]),d.setBagCount(i,g.items_count)})),e(window).trigger("macproMakeVisible"),r()},showBagContents:function(i,n){var a=this;e(document).trigger("click"),i.addClass("active");var o=i.find(".js-site_bag_contents"),r=i.find(".js-gnav-util-trigger"),l=i.find(".js-gnav-util-trigger-reset");if(s.restrict_navigation(o),t.settings.globals_variables&&t.settings.globals_variables.cr20&&r.prop("checked",!0),i.bind("clickoutside",(function(){l.trigger("click"),i.removeClass("active").unbind("clickoutside")})),i.find(".site-bag__contents-close").once().click((function(e){e.preventDefault(),i.children(".js-site_bag_link").attr("aria-expanded","false").focus(),i.trigger("clickoutside")})),!0===n){i.find(".site-bag__contents-subtotal").hide(),t.settings.globals_variables&&t.settings.globals_variables.enable_preorder&&(i.find(".js-cart_overlay__preorderhead").hide(),i.find(".js-site-bag__contents-preorder-total").hide()),i.find(".site-bag__contents-recommendations").hide(),i.find(".site-bag__contents-products").attr("style","");var d=a.get("fadeOutDelay"),c=function(){i.find(".site-bag__contents").fadeOut(400,(function(){i.removeClass("active").unbind("clickoutside"),e(this).attr("style",""),e(window).trigger("window:close_bag")}))},_=setTimeout(c,d);i.find(".site-bag__contents").hover((function(){clearTimeout(_)}),(function(){_=setTimeout(c,d)}))}else e(".site-bag__contents-subtotal").show(),t.settings.globals_variables&&t.settings.globals_variables.enable_preorder&&(e(".js-cart_overlay__preorderhead").show(),e(".js-site-bag__contents-preorder-total").show()),e(".site-bag__contents-recommendations").show(),a.setOverlayHeight(i);a.initRecommendations(i)},setBagTitle:function(t,i,s){var n=t.find(".site-bag__contents"),a=t.find(".site-bag__contents-products .cart-product");!0===i?(a.hide(),e.each(s.ac_results,(function(e,i){if(void 0!==i.result.CARTITEM&&void 0!==i.result.CARTITEM["sku.SKU_BASE_ID"]){var s=i.result.CARTITEM["sku.SKU_BASE_ID"];t.find('.site-bag__contents-products .cart-product[data-sku_base_id="'+s+'"]:first').show()}})),n.find(".site-bag__contents-title").hide(),n.find(".site-bag__contents-title__alt").show()):(a.show(),n.find(".site-bag__contents-title").show(),n.find(".site-bag__contents-title__alt").hide())},setBagCount:function(e,t){e.find(".site-bag__link-count").html(t),this.set("bagCount",t)},showBagCount:function(e){var t=this.get("bagCount");t=isNaN(t)?0:t,this.setBagCount(e,t)},loadPreOrderBagContents:function(i){var n;if(!(void 0!==t.settings.globals_variables.enable_preorder?t.settings.globals_variables.enable_preorder:0))return"";if(!s.templates.site_bag_preorder_contents)return"";var a={has_preorder:0,items:0,preorder_items:[],display_sub_line:t.settings.globals_variables.display_sub_line!==n?t.settings.globals_variables.display_sub_line:0,display_tax_price:t.settings.globals_variables.display_tax_price!==n?t.settings.globals_variables.display_tax_price:0},o=i.order.items!==n?i.order.items.concat(i.order.samples):[],r=i.preorder?i.preorder:{};if(a.items=o,a.has_preorder=r.items_count,r.items_count>0){a.preorder_items=r.items,a.formattedTotalPriceWithTax=r.totals.formattedTotalPriceWithTax,a.formattedTotalPrice=r.totals.formattedTotalPrice;for(var l=r.items,d=0,c=l.length;d<c;d++){var _=l[d];for(var g in a.preorder_items[d]={},_)_.hasOwnProperty(g)&&(a.preorder_items[d][g.replace(/\./,"_")]=_[g]);if(a.preorder_items[d].hasOwnProperty("isKitItem")&&1===a.preorder_items[d].isKitItem)for(var u=0,f=a.preorder_items[d].preorder_items.length;u<f;u++){var p=a.preorder_items[d].preorder_items[u];for(var h in p)p.hasOwnProperty(h)&&(a.preorder_items[d].preorder_items[u][h.replace(/\./,"_")]=p[h])}}}var b=s.template.get({name:"site_bag_preorder_contents",data:a});return e(b).appendTo(".js-site-bag-contents-products")},setOverlayHeight:function(t){var i=t.find(".site-bag__contents"),s=e(window).height()-i.position().top-e(".site-banner__is-open .site-banner").height();i.height(s);var n=i.find(".site-bag__contents-header").outerHeight(!1),a=i.find(".site-bag__contents-footer").outerHeight(!1),o=i.find(".site-bag__contents-products"),r=0;i.find(".site-bag__contents-recommendations").is(":visible")&&(r=i.find(".site-bag__contents-recommendations").outerHeight(!1));var l=s-n-a-r;o.height(l)},initRecommendations:function(t){var i=t.find(".site-bag__contents-recommendations");if(i.is(":visible")){var n=t.find(".site-bag__contents-products"),a=n.outerHeight(!1),o=i.outerHeight(!1),r=o,l=i.find(".site-bag__contents-recommendations__title"),d=i.find(".site-bag__contents-recommendations-carousel"),c=d.find("> ul"),_=d.find(".site-bag__contents-recommendations-carousel__controls"),g=_.find(".count"),u=c.find(".carousel-slide").length;l.once().click((function(){if(i.hasClass("active")){i.removeClass("active"),c.unslick();var t=a-r+o;n.animate({height:t},300,(function(){a=n.outerHeight(!1)}))}else{i.addClass("active"),1===u&&_.hide();var l=!s.direction.isRTL,d=l;c.slick({rtl:s.direction.isRTL,swipe:l,draggable:d,appendArrows:_,autoplay:!1,fade:!0,slide:".carousel-slide",slidesToShow:1,slidesToScroll:1,accessibility:!0,speed:300,onInit:function(){o=i.outerHeight(!1),g.html("1/"+u)},onAfterChange:function(){var e=c.slickCurrentSlide()+1;g.html(e+"/"+u)}});var f=a+r-o;n.animate({height:f},300,(function(){a=n.outerHeight(!1)})),c.find(".js-add-to-bag").once().click((function(){var t={skuBaseId:e(this).closest(".cart-product").data("sku_base_id")};return prodcat.ui.addToCart(t),!1}))}}))}},attach:function(t,s){if(!this.attached){this.attached=!0;var a=this;a.get("formatter").each((function(){var t=e(this);a.showBagCount(t),t.find(".site-bag__link").once().click((function(i){(0===parseInt(a.get("is_mobile"))||e(".js-custom-kit").length)&&(i.preventDefault(),e(this).attr("aria-expanded","true"),t.hasClass("active")?t.removeClass("active"):(n=1,a.loadBagContents(t,!1,[],(function(){a.setBagTitle(t,!1,[]),a.showBagContents(t,!1),t.find(".js-cart-product-name a, .js-cart-product a").each((function(){var t,i,s=e(this),n=s.attr("href"),a=n.split("shade/")[0],o=(t=n.toString().split(" ").join("_"),i=t.split("shade/")[1],encodeURIComponent(i).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16)})));s.attr("href",a+"shade/"+o)}))}))))})),e(window).resize(_.debounce((function(){t.hasClass("active")&&(t.trigger("clickoutside"),t.children(".js-site_bag_link").attr("aria-expanded","false"))}),50)),e(window).on("gnavdata_success",(function(){a.showBagCount(t)})),e(window).on("addToCart.success",(function(e,i){a.loadBagContents(t,!0,i)})),e(window).on("window:refresh_bag_contents",(function(){a.loadBagContents(t,!1,[])})),e(window).on("window:update_bag_count",(function(e,i,s){(s||a.get("bagCount")!==i)&&a.setBagCount(t,i)})),e(window).on("window:show_shipping_overlay",(function(){var s=e(document.activeElement),n=t.find(".site-bag__overlay-content");n.length>0&&i.overlay.launch({content:n.clone(!0),includeBackground:!0,includeCloseLink:!0,initialHeight:0,height:0,width:"50%",onComplete:function(){e(window).trigger("macproMakeVisible"),e(this).colorbox.resize()},onClosed:function(){s.focus()}})})),e(".js-shipping-overlay").once().click((function(){return e(window).trigger("window:show_shipping_overlay"),!1})),e("#viewcart-panel").find(".cart-product-kit-shade").tooltipster({arrow:!1,contentAsHTML:!0,hideOnClick:!0,theme:"mac-tooltip",offsetX:10})}))}},attached:!1}}(jQuery,Drupal,window.generic||{},window.site||{});
//# sourceMappingURL=site_bag_v1.js.map
