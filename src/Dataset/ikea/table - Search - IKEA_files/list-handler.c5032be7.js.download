(window.webpackJsonpPurchaseMiddleware=window.webpackJsonpPurchaseMiddleware||[]).push([[1],{19:function(t,e,n){var r=n(5);t.exports=function(t){return function(t){var e=function(t,e,n){return{method:"GET",headers:{Accept:"application/vnd.ikea.iows+json; version=2.0",Contract:"37249",Consumer:"MAMMUT"},url:"".concat(e,"/").concat(n,"/customer/irw/").concat(t,"/shoppingbags/onlineshoppinglist"),mode:"cors",cache:"default",credentials:"include"}}(t,"https://iows.ikea.com/retail/iows","us/en");return r(3,1e3)(e.url,e).then(function(t){var e=t.ShoppingBagRefList.ShoppingBagRef;return e?Array.isArray(e)?e:[e]:[]})}(t.userId).then(function(t){return{status:"LIST_FETCH_SUCCESS",bags:t.map(function(t){return{id:t.BagId.$,name:t.BagName.$,noOfItems:t.NoOfItems.$}})}}).catch(function(){return{status:"LIST_FETCH_FAIL"}})}},20:function(t,e,n){var r=n(5),i=function(t){var e=t.itemType,n=t.itemNo,r=t.itemQty;return{ShoppingBagAdjustmentItemList:{ShoppingBagAdjustmentItem:[{ItemType:{$:e.toUpperCase()},ItemNo:{$:n},ItemQty:{$:r},SectionId:{$:0}}],"@xmlns":{$:"ikea.com/cem/iows/ShoppingBagService/2.0/"}}}},o=function(t){return{method:"PUT",headers:{Accept:"application/vnd.ikea.iows+json; version=2.0",Contract:"37249",Consumer:"MAMMUT"},url:"".concat("https://iows.ikea.com/retail/iows","/").concat("us/en","/customer/irw/").concat(t.userId,"/shoppingbags/onlineshoppinglist/").concat(t.bagId,"/items"),mode:"cors",cache:"default",credentials:"include",body:"list=".concat(JSON.stringify(t.payload))}};t.exports=function(t){var e=i({itemType:t.productType,itemNo:t.productNumber,itemQty:t.quantity}),n=o({bagId:t.listId,userId:t.session.userId,payload:e});return r(3,1e3,!0)(n.url,n).then(function(){return{status:"LIST_ADD_SUCCESS"}}).catch(function(){return{status:"LIST_ADD_FAIL"}})}},21:function(t,e,n){var r=n(5),i=function(t){return{method:"POST",headers:{Accept:"application/vnd.ikea.iows+json; version=2.0",Contract:"37249",Consumer:"MAMMUT"},url:"".concat("https://iows.ikea.com/retail/iows","/").concat("us/en","/customer/irw/").concat(t.userId,"/shoppingbags/onlineshoppinglist"),mode:"cors",cache:"default",credentials:"include",body:"list=".concat(JSON.stringify(t.payload))}},o=function(t){var e=t.userId,n=t.itemType,r=t.itemNo,i=t.itemQty;return{ShoppingBag:{BagType:{$:"onlineshoppinglist"},BagSource:{$:"M2"},BagName:{$:t.bagName},CustomerSource:{$:"M2"},CustomerId:{$:e},CreatedDateTime:{$:(new Date).toUTCString()},ShoppingBagSectionList:[{ShoppingBagSection:{ShoppingBagItemList:{ShoppingBagItem:[{ItemType:{$:n.toUpperCase()},ItemNo:{$:r},ItemQty:{$:i}}]}}}],"@xmlns":{$:"ikea.com/cem/iows/ShoppingBagService/2.0/"}}}};t.exports=function(t){var e=o({userId:t.session.userId,bagName:t.listName,itemType:t.productType,itemNo:t.productNumber,itemQty:t.quantity}),n=i({userId:t.session.userId,payload:e});return r(3,1e3)(n.url,n).then(function(){return{status:"LIST_ADD_SUCCESS"}}).catch(function(){return{status:"LIST_ADD_FAIL"}})}},25:function(t,e,n){"use strict";n.r(e);var r=n(0),m=n.n(r),i=n(1),o=n.n(i),s=n(6),a="ADD_TO_FAVOURITES",l="ADD_TO_FAVOURITES_INITIATE",g="ADD_TO_FAVOURITES_SUCCESS",w="ADD_TO_FAVOURITES_FAIL",S=Object(s.a)("FAVOURITE_CLIENT"),b="LIST_FETCH_SUCCESS",I="LIST_ADD_SUCCESS",T=function(){var s=o()(m.a.mark(function t(e,n,r,i,o,s){var a,u,c;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={session:r,productType:o,productNumber:i,quantity:s},0===n.length)return u=Object.assign({},a,{listName:"Shopping list"}),t.abrupt("return",e.addToNewList(u));t.next=4;break;case 4:return c=Object.assign({},a,{listId:n[0].id}),t.abrupt("return",e.addToList(c));case 6:case"end":return t.stop()}},t)}));return function(t,e,n,r,i,o){return s.apply(this,arguments)}}();e.default=function(t,e){S.subscribe(a,function(f,h){return function(){var t=o()(m.a.mark(function t(){var e,n,r,i,o,s,a,u,c,p,d=arguments;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=0<d.length&&void 0!==d[0]?d[0]:{},t.prev=1,window.ikea&&window.ikea.favourites&&window.ikea.favourites.agentLoaded)return t.abrupt("return");t.next=4;break;case 4:if(n=e.productNumber,r=e.productType,i=e.quantity,o=void 0===i?1:i,n&&r){t.next=9;break}return s=new Error("productNumber or productType is missing"),S.publish(w,Object.assign({errorMessage:s},e)),t.abrupt("return");case 9:return S.publish(l,e),t.next=12,f();case 12:if((a=t.sent).error)throw new Error("Error fetching session context");t.next=15;break;case 15:return t.next=17,h.fetchLists(a);case 17:if(u=t.sent,c=u.status,p=u.bags,c!==b)throw new Error("Error fetching lists");t.next=22;break;case 22:return t.next=24,T(h,p,a,n,r,o);case 24:if(t.sent.status!==I)throw new Error("Error adding to list");t.next=27;break;case 27:S.publish(g,e),t.next=33;break;case 30:t.prev=30,t.t0=t.catch(1),S.publish(w,Object.assign(t.t0,e));case 33:case"end":return t.stop()}},t,null,[[1,30]])}));return function(){return t.apply(this,arguments)}}()}(t,e))}},26:function(t,e,n){t.exports={fetchLists:n(19),addToList:n(20),addToNewList:n(21)}},5:function(t,e){t.exports=function s(t,e,n){var a=0<arguments.length&&void 0!==t?t:2,u=1<arguments.length?e:void 0,c=2<arguments.length&&void 0!==n&&n;return function(i,o){return new Promise(function(n,r){return fetch(i,o).then(function(t){return t.ok?c?t.text().then(function(t){return t.length?JSON.parse(t):{}}).then(function(t){return n(t)}).catch(function(t){return r(t)}):t.json().then(function(t){return n(t)}).catch(function(t){return r(t)}):Promise.reject(t)}).catch(function(t){var e=t&&t.status;return a<=1||401===e||404===e?r("Failed to fetch from: ".concat(i,". Status code: ").concat(e,".")):n(new Promise(function(t){return setTimeout(function(){return t(s(a-1,u,c)(i,o))},u)}))})})}}},6:function(t,e,n){"use strict";var r={};e.a=function(t){var n=t.toUpperCase();return r[n]||(r[n]={namespace:n,publish:function(t,e){window.ikea&&window.ikea.pubsub&&window.ikea.pubsub.publish("".concat(n,"/").concat(t),e)},subscribe:function(t,e){window.ikea&&window.ikea.pubsub&&window.ikea.pubsub.subscribe("".concat(n,"/").concat(t),e)}}),r[n]}}}]);
//# sourceMappingURL=list-handler.c5032be7.js.map