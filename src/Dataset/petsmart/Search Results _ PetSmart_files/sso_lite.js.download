!function(a){function b(){return!!(m&&q&&v&&y&&z)}function c(a,b){JANRAIN.SSO.debug_log("checkVisited: ",a);var c={found:!1,isLoggedIn:!1};if(null==a||void 0===a)return c;for(idx=0;idx<a.length;idx++){var d=a[idx];if(currentReceiverKey=g(d.xdReceiverURI),"undefined"!=typeof currentReceiverKey&&currentReceiverKey===b){JANRAIN.SSO.debug_log("checkVisited found "+b+" on "+d.domain),c.domain=d.domain,c.found=!0,JANRAIN.SSO.debug_log("checkVisited: is "+(d.isLoggedIn?"":"not ")+"logged in"),c.isLoggedIn=d.isLoggedIn;break}}return c}function e(a,b){this.origin="https://"+i(a).host,this.path=b,this._iframe=null,this._iframeReady=!1,this._queue=[],this._requests={},this._messageId=0}function f(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function g(a){return a=i(a),a.host+a.path}function h(a){try{return JSON.parse(a)}catch(b){return JANRAIN.SSO.warn("json array did not parse: "+a),[]}}function i(a){var b=i.options;a=b.parser[b.strictMode?"strict":"loose"].exec(a);for(var c={},d=14;d--;)c[b.key[d]]=a[d]||"";return c[b.q.name]={},c[b.key[12]].replace(b.q.parser,function(a,d,e){d&&(c[b.q.name][d]=e)}),c}function j(a,b,c,d,e,f){a=a+"="+escape(b),c&&(c=setExpiration(c),a+=";expires="+c),d&&(a+=";path="+d),e&&(a+=";domain="+e),f&&(a+="secure; "),document.cookie=a}if(void 0===a.JANRAIN||!a.JANRAIN.SSO){var k=!1;window.localStorage&&(k=window.localStorage.getItem("janrainSsoDebugEnabled")),JANRAIN={SSO:{}},JANRAIN.SSO.CAPTURE={},JANRAIN.SSO.version="3.3.2","undefined"==typeof janrain&&(janrain={}),void 0===janrain.capture&&(janrain.capture={}),void 0===janrain.capture.ui&&(janrain.capture.ui={}),void 0===janrain.capture.ui.handleCaptureResponse&&(janrain.capture.ui.handleCaptureResponse=function(a){}),void 0===janrain.capture.ui.handleErrorResponse&&(janrain.capture.ui.handleErrorResponse=function(a){}),void 0===janrain.capture.ui.login_callback&&(janrain.capture.ui.login_callback=function(a){}),void 0===janrain.capture.ui.nologin_callback&&(janrain.capture.ui.nologin_callback=function(a){});var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;e.prototype={constructor:e,init:function(){var a=this;if(!this._iframe){if(!(window.postMessage&&window.JSON&&window.localStorage)||JANRAIN.SSO.useCookiesOnly())throw Error("Unsupported browser.");this._iframe=document.createElement("iframe"),this._iframe.style.cssText="position:absolute;width:1px;height:1px;left:-9999px;";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(this._iframe,b),window.addEventListener?(this._iframe.addEventListener("load",function(){a._iframeLoaded()},!1),window.addEventListener("message",function(b){a._handleMessage(b)},!1)):this._iframe.attachEvent&&(this._iframe.attachEvent("onload",function(){a._iframeLoaded()},!1),window.attachEvent("onmessage",function(b){a._handleMessage(b)}))}this._iframe.src=this.origin+this.path},getValue:function(a,b,c){a={request:{key:a,messageId:++this._messageId,action:b},callback:c},this._iframeReady?this._sendRequest(a):this._queue.push(a),this._iframe||this.init()},setValue:function(a,b,c,d){a={request:{key:a,messageId:++this._messageId,action:b,storedValue:c},callback:d},this._iframeReady?this._sendRequest(a):this._queue.push(a),this._iframe||this.init()},removeValue:function(a,b){var c={request:{key:a,messageId:++this._messageId,action:"remove"},callback:b};this._iframeReady?this._sendRequest(c):this._queue.push(c),this._iframe||this.init()},_sendRequest:function(a){this._requests[a.request.messageId]=a,this._iframe.contentWindow.postMessage(JSON.stringify(a.request),this.origin)},_iframeLoaded:function(){if(this._iframeReady=!0,this._queue.length){for(var a=0,b=this._queue.length;a<b;a++)this._sendRequest(this._queue[a]);this._queue=[]}},_handleMessage:function(a){if(a.origin==this.origin){var b;try{b=JSON.parse(a.data)}catch(a){JANRAIN.SSO.warn("json object did not parse: "+array),b={}}void 0!==b.messageId&&(this._requests[b.messageId].callback(b.key,b.storedValue),delete this._requests[b.messageId])}}},i.options={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},JANRAIN.SSO._deleteChecked=function(){for(var b=a.document.cookie.split(";"),c=0;c<b.length;c++)-1<b[c].search(/janrain_sso_checked/)&&(a.document.cookie=b[c]+"=;expires="+(new Date).toGMTString()+";path=/;",JANRAIN.SSO.log("sso removed cookie "+b[c]))},JANRAIN.SSO._doLogout=function(b,c,d){onComplete=function(){void 0!==o&&"function"==typeof o?(JANRAIN.SSO.log("calling logout_callback()"),o()):void 0!==b&&(JANRAIN.SSO.log("redirecting to "+b),a.document.location.href=b)},JANRAIN.SSO._loadUrls(c,onComplete)},JANRAIN.SSO._getLogoutUrls=function(a,b){var c,d=[];void 0!==b&&(c=g(b)),JANRAIN.SSO.debug_log("localSiteKey: "+c);for(var e=0;e<a.length;e++){var f=g(a[e].xdReceiverURI),h=a[e].isLoggedIn;JANRAIN.SSO.debug_log(e+1+" this siteKey: "+f),h&&f!==c&&(JANRAIN.SSO.debug_log("logoutURI: "+a[e].logoutURI),d.push(a[e].logoutURI))}return d},JANRAIN.SSO._loadUrls=function(b,c){if(onComplete=function(){void 0!==c&&"function"==typeof c&&c()},null!=b&&0<b.length){var d=0;onFrameLoad=function(){++d>=b.length&&onComplete()};for(var e,f=0;f<b.length;f++){a.document.all?(e=document.createElement("div"),e.innerHTML='<iframe onload="onFrameLoad();"></iframe>',e=e.firstChild):(e=a.document.createElement("iframe"),e.onload=onFrameLoad);var g=decodeURIComponent(b[f]);"https:"===document.location.protocol&&(g=g.replace("^http:","https:")),e.setAttribute("src",g),JANRAIN.SSO.log("calling logout url "+f+" of "+b.length+": "+b[f]),a.document.getElementsByTagName("head")[0].appendChild(e)}}else onComplete()},JANRAIN.SSO.CAPTURE._login=function(b,c,d,e,f){if(void 0===v)JANRAIN.SSO.error("sso server is not defined");else{var g=document.createElement("script");g.src=v+"/capture/loginx?v="+(new Date).getTime()+"&callback="+encodeURIComponent(e)+"&xd_receiver="+encodeURIComponent(z)+"&origin="+encodeURIComponent(a.document.location.href)+"&logout_uri="+encodeURIComponent(p)+"&redirect_uri="+encodeURIComponent(q)+"&client_id="+encodeURIComponent(m)+"&bp_channel="+encodeURIComponent(l)+"&segment="+encodeURIComponent(f)+"&response_type="+encodeURIComponent(b.response_type)+"&response_method="+encodeURIComponent(b.response_method)+"&widget_parameters="+encodeURIComponent(b.widget_parameters)+"&transaction_id="+encodeURIComponent(b.transaction_id)+"&session_id="+encodeURIComponent(c)+"&visited="+encodeURIComponent(d),g.type="text/javascript",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(g,b)}},JANRAIN.SSO.CAPTURE._loginCallback=function(b){if(b&&"fail"!==b.stat){JANRAIN.SSO.log("callback from SSO server received"),s||(s=new e(v,"/static/server.html")),JANRAIN.SSO.log("updating SSO session");var c={session_id:decodeURIComponent(b.session_id),visited:decodeURIComponent(b.visited),visited_expires:b.visited_expires};s.setValue(b.segment,"set",c,function(c,d){b.capture_callback&&"jsonp"===b.response_method&&"undefined"!=typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"==typeof b.capture_callback?b.capture_callback():b.redirect_uri&&0<b.redirect_uri.length&&(a.document.location.href=b.redirect_uri)})}else JANRAIN.SSO.error("login failed: "+b.msg)},JANRAIN.SSO._redirectCallback=function(a,b,c,d,f,j,k){(j=j||v)?f||z?(s||(s=new e(j,"/static/server.html")),JANRAIN.SSO.log("updating session"),s.getValue(f,"getSegment",function(c,e){s.getValue(e.segment,"get",function(c,l){var m,n=[];if(l.visited){JANRAIN.SSO.log("visited: "+l.visited),n=h(l.visited),z||(z=getXdrFromLocation());var o=0;if(z)m=g(z);else for(var p=0;p<n.length;p++)i(n[p].xdReceiverURI).host==f&&o++;for(1<o&&(JANRAIN.SSO.log("multiple domains match, resetting visited"),n=[]),p=0;p<n.length;p++){var o=g(n[p].xdReceiverURI),q=i(n[p].xdReceiverURI);if(void 0!==o&&(o===m||q.host===f)){!0===n[p].isLoggedIn?JANRAIN.SSO.log("logging in again to: "+n[p].domain):(JANRAIN.SSO.log("found and logging in to: "+n[p].domain),n[p].isLoggedIn=!0),n=[n[p]];break}}}else JANRAIN.SSO.warn("expected a visited list for segment "+e.segment+" - none found");JANRAIN.SSO._setSSOSession(a,b,JSON.stringify(n),d,j,e.segment,f,function(){"function"==typeof k&&k()})})})):(JANRAIN.SSO.error("no session set, due to missing xd_receiver and logged_in_host parameters"),"function"==typeof k&&k()):(JANRAIN.SSO.error("no session set, due to missing sso server parameter"),"function"==typeof k&&k())},JANRAIN.SSO._setSession=function(a,b,c,d,e,f){JANRAIN.SSO._setSSOSession(a,null,b,c,v,d,e,f)},JANRAIN.SSO._setSSOSession=function(a,b,c,d,f,g,h,i){s||(s=new e(f,"/static/server.html")),JANRAIN.SSO.debug_log("visited expires:  "+d),b={session_id:a,session_id_expires:b,visited:c,visited_expires:d,host:h},a?JANRAIN.SSO.log("setting session "+b.host+" with segment "+g):JANRAIN.SSO.log("updating the visited list for segment "+g),s.setValue(g,"set",b,function(a,b){"undefined"!==i&&"function"==typeof i&&i()})},JANRAIN.SSO.check_login_dispatch=function(a,b){s||(s=new e(a.sso_server,"/static/server.html")),JANRAIN.SSO.log("checking for session"),JANRAIN.SSO.debug_log("Segments to check: "+a.supported_segments_ary),s.getValue("","getAllVisited",function(c,d){var e=g(a.xd_receiver),f=h(d.allVisited).some(function(a){if(e===g(a.xdReceiverURI))return a.isLoggedIn});a.supported_segments_ary.forEach(function(c){s.getValue(c,"get",function(d,e){b(a,e,c,f)})})})},JANRAIN.SSO.debug_log=function(a,b){k&&(b&&(window.JSON&&window.JSON.stringify&&(b=JSON.stringify(b)),a+=": "+b),d=new Date,a="SSO DEBUG ("+d.toGMTString()+"): "+a,window.console&&window.console.debug?console.debug(a):window.console&&window.console.log&&console.log(a))},JANRAIN.SSO.error=function(a){window.console&&window.console.error&&console.error("SSO ERROR: "+a)},JANRAIN.SSO.CAPTURE.handleSegmentCheck=function(a,b,d,e){var f=[],k={found:!1},l=g(a.xd_receiver),m=i(a.xd_receiver).host;if(JANRAIN.SSO.log("checking segment "+d),!b.visited_expires||"session"===b.visited_expires){for(b.visited_expires="session",cName="",pCOOKIES=[],pCOOKIES=document.cookie.split("; "),bb=0;bb<pCOOKIES.length;bb++)NmeVal=[],NmeVal=pCOOKIES[bb].split("="),"janrainSSO_session"==NmeVal[0]&&(cName=unescape(NmeVal[1]));1<cName.length&&('"'===cName[0]&&(cName=cName.substr(1,cName.length)),'"'===cName[cName.length-1]&&(cName=cName.substr(0,cName.length-1))),"session"!==cName.replace(/\\"/g,'"')&&(a.refresh=!0,JANRAIN.SSO.log("visited tracker is session-based but no janrainSSO_session cookie found; will refresh even if marked as logged in"),j("janrainSSO_session","session",null,"/"))}if(b.visited&&(f=h(b.visited),k=c(f,l),JANRAIN.SSO.debug_log("handleSegmentCheck visitedStatus",k),!0===k.found))if(!0===k.isLoggedIn){if(JANRAIN.SSO.log("already logged into: "+k.domain),!a.refresh||n)return void("undefined"!=typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"==typeof janrain.capture.ui[a.nologin_callback]&&janrain.capture.ui[a.nologin_callback]({transactionId:a.transaction_id,result:"already checked"}));JANRAIN.SSO.log("overriding with refresh")}else JANRAIN.SSO.log("found: "+k.domain+" but not logged in");if(!k.found){var o=i(a.xd_receiver);f.push({domain:o.host+o.path,xdReceiverURI:a.xd_receiver,isLoggedIn:!1,logoutURI:a.logout_uri}),10<f.length&&f.splice(0,1)}!b.session_id||1>b.session_id.length?(JANRAIN.SSO.log("no session exists; not logging in"),e=function(){"undefined"!=typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"==typeof janrain.capture.ui[a.nologin_callback]&&janrain.capture.ui[a.nologin_callback]({transactionId:a.transaction_id,result:"sso failed - no session exists"})},k.found?e():JANRAIN.SSO._setSession(b.session_id,JSON.stringify(f),b.visited_expires,d,m,e)):(!b.visited&&!n&&(a.refresh=!0,JANRAIN.SSO.log("session exists, but no visited list; forcing a refresh")),e&&!a.refresh||n?(JANRAIN.SSO.log("capture user already logged in to the site; marking as logged in on this segment, too"),f.some(function(a,b){if(g(a.xdReceiverURI)===l)return f[b].isLoggedIn=!0}),JANRAIN.SSO._setSession(b.session_id,JSON.stringify(f),b.visited_expires,d,m)):(n=!0,JANRAIN.SSO.log("logging in capture user"),JANRAIN.SSO.CAPTURE._login(a,b.session_id,JSON.stringify(f),"JANRAIN.SSO.CAPTURE._loginCallback",d)))},JANRAIN.SSO.log=function(a,b){window.console&&window.console.log&&(b&&(window.JSON&&window.JSON.stringify&&(b=JSON.stringify(b)),a+=": "+b),d=new Date,console.log("SSO ("+d.toGMTString()+"): "+a))},JANRAIN.SSO.safariWorkAround=function(a){var b=!1,c=navigator.userAgent;if(-1!=c.indexOf("Safari")){var d=c.indexOf("Version");if(-1!=d)var c=c.substring(d+8),e=parseInt(""+c,10);5<e&&(JANRAIN.SSO.debug_log("Safari version is "+e+", workaround enabled"),b=!0)}b?localStorage.getItem("federateUnlocked")||(JANRAIN.SSO.debug_log("SSO not unlocked yet"),b=encodeURIComponent(location.href),a=a+"/static/server.html?origin="+b,JANRAIN.SSO.debug_log("Navigating to SSO server at: "+a),localStorage.setItem("federateUnlocked","true"),location.href=a):JANRAIN.SSO.debug_log("safariWorkAround called but not in Safari")},JANRAIN.SSO.useCookiesOnly=function(){return void 0===x&&(x=!!(navigator&&navigator.userAgent&&-1<navigator.userAgent.search("__use_cookies__"))),x},JANRAIN.SSO.warn=function(a){window.console&&window.console.warn&&console.warn("SSO WARNING: "+a)},JANRAIN.SSO.end_session=function(c){if(b()){k&&(callback_message=void 0===c?"callback function undefined":"callback: "+c.name,JANRAIN.SSO.debug_log("logout called "+callback_message+" caller name: '"+arguments.callee.caller.name+"'")),JANRAIN.SSO._deleteChecked(),void 0!==c&&"function"==typeof c&&(o=c);var d=i(window.location.hostname).host;if(window.localStorage&&!JANRAIN.SSO.useCookiesOnly())s||(s=new e(v,"/static/server.html")),JANRAIN.SSO.log("removing session_id"),s.getValue(d,"getSegment",function(a,b){JANRAIN.SSO.log("got segment "+a+"="+b.segment),s.getValue(b.segment,"getAllVisited",function(a,e){var f=[],g=[];if(e.allVisited){f=h(e.allVisited),g=JANRAIN.SSO._getLogoutUrls(f,z),JANRAIN.SSO.debug_log("SSO: logoutUrls: ",g);for(var j=[],k=0;k<f.length;k++){var l=i(f[k].xdReceiverURI).host;if(f[k].xdReceiverURI===z||l===d){f[k].isLoggedIn=!1,j=[f[k]];break}}f=j}toBeDeletedValue=e,toBeDeletedValue.session_id="deleteMe",toBeDeletedValue.visited=JSON.stringify(f),toBeDeletedValue.session_id_expires="deleteMe",JANRAIN.SSO.log("deleting session "+toBeDeletedValue),JANRAIN.SSO.log("deleting session "+toBeDeletedValue.visited),s.setValue(b.segment,"deleteSession",toBeDeletedValue,function(a,b){JANRAIN.SSO.log("session removed "+a+"="+b),JANRAIN.SSO._doLogout(p,g,c)})})});else{var f=a.document.createElement("script");f.setAttribute("src",v+"/session/logout.js?logout_uri="+encodeURIComponent(p)),document.getElementsByTagName("body")[0].appendChild(f)}}else JANRAIN.SSO.warn("SSO has not been configured.")},JANRAIN.SSO.check_session=function(c,d,e){m=c.client_id,q=c.redirect_uri,v=c.sso_server,y=JSON.stringify({flow:c.flow_name,flow_version:c.flow_version,locale:c.locale}),z=c.xd_receiver,p=c.logout_uri,l=c.bp_channel||"",r=c.refresh||!1,u=c.response_type||"token",t=c.response_method||"jsonp",login_callback="login_callback",c.callback_failure&&(janrain.capture.ui.nologin_callback=c.callback_failure),c.callback_success&&(janrain.capture.ui.login_callback=c.callback_success),c.capture_error&&(janrain.capture.ui.handleErrorResponse=c.capture_error),c.capture_success&&(janrain.capture.ui.handleCaptureResponse=c.capture_success),b()?(c=f(),JANRAIN.SSO.safariWorkAround(v),n=!1,e=void 0===e?"":e.replace(/ /g,"_"),w=[],void 0!==d&&(w=d.split("-")),w.push(e),window.localStorage&&!JANRAIN.SSO.useCookiesOnly()?(c={bp_channel:l,client_id:m,logout_uri:p,redirect_uri:q,refresh:r,response_method:t,response_type:u,segment:e,sso_server:v,transaction_id:c,supported_segments:d,supported_segments_ary:w,widget_parameters:y,xd_receiver:z},JANRAIN.SSO.check_login_dispatch(c,JANRAIN.SSO.CAPTURE.handleSegmentCheck)):(d="janrain_sso_checked_"+getPath(z),-1===a.document.cookie.search(RegExp(d))?(d=document.createElement("script"),d.src=v+"/capture/v1/sso_check.js?v="+(new Date).getTime()+"&xd_receiver="+encodeURIComponent(z)+"&origin="+encodeURIComponent(a.document.location.href)+"&logout_uri="+encodeURIComponent(p)+"&redirect_uri="+encodeURIComponent(q)+"&client_id="+encodeURIComponent(m)+"&bp_channel="+encodeURIComponent(l)+"&segment="+encodeURIComponent(e)+"&response_type="+encodeURIComponent(u)+"&response_method="+encodeURIComponent(t)+"&widget_parameters="+encodeURIComponent(y)+"&nologin_callback="+encodeURIComponent("nologin_callback")+"&transaction_id="+encodeURIComponent(c)+"&refresh="+r,d.type="text/javascript",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(d,e)):"undefined"!=typeof janrain&&janrain.capture&&janrain.capture.ui&&"function"==typeof janrain.capture.ui.nologin_callback&&janrain.capture.ui.nologin_callback({transactionId:c,result:"already checked"}))):JANRAIN.SSO.warn("config missing required parameters. Please include client_id, redirect_uri, sso_server, flow_name, flow_version, locale, and xd_receiver")},JANRAIN.SSO.set_session=function(a){if(b())if(void 0===v||void 0===q)JANRAIN.SSO.error("check_login must be called before calling set_login");else{var c=f(),d=document.createElement("script");d.src=v+"/capture/v1/set_login?v="+(new Date).getTime()+"&redirect_uri="+encodeURIComponent(q)+"&code="+encodeURIComponent(a)+"&login_callback="+encodeURIComponent(login_callback)+"&transaction_id="+encodeURIComponent(c),d.type="text/javascript",a=document.getElementsByTagName("script")[0],a.parentNode.insertBefore(d,a)}else JANRAIN.SSO.warn("SSO has not been configured.")}}}(this);