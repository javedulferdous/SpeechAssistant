var updateIframeStyle,getURLParam,jaaulde;(function(n){function t(n,t){if(!(n.originalEvent.touches.length>1)){n.preventDefault();var i=n.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null);n.target.dispatchEvent(r)}}if(n.support.touch="ontouchend"in document,n.support.touch){var i=n.ui.mouse.prototype,u=i._mouseInit,f=i._mouseDestroy,r;i._touchStart=function(n){var i=this;!r&&i._mouseCapture(n.originalEvent.changedTouches[0])&&(r=!0,i._touchMoved=!1,t(n,"mouseover"),t(n,"mousemove"),t(n,"mousedown"))};i._touchMove=function(n){r&&(this._touchMoved=!0,t(n,"mousemove"))};i._touchEnd=function(n){r&&(t(n,"mouseup"),t(n,"mouseout"),this._touchMoved||t(n,"click"),r=!1)};i._mouseInit=function(){var t=this;t.element.bind({touchstart:n.proxy(t,"_touchStart"),touchmove:n.proxy(t,"_touchMove"),touchend:n.proxy(t,"_touchEnd")});u.call(t)};i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:n.proxy(t,"_touchStart"),touchmove:n.proxy(t,"_touchMove"),touchend:n.proxy(t,"_touchEnd")});f.call(t)}}})(jQuery),function(n,t,i){"use strict";var s;i.Coupons=i.Coupons||{};var u=i.Coupons,f={},e={action:{getCoupons:"GetCoupons",getPrintToken:"GetPrintToken",sendClippedCouponsEmail:"SendClippedCouponsEmail"},cookie:{checkedArr:"checkedArr",clipAllInput:"ClipAllInput",emailClicked:"EmailClicked",installClicked:"InstallClicked",printClicked:"PrintClicked"},hash:{contactConfirmation:"#ContactConfirmation",install:"#Install",upgrade:"#Upgrade"},param:{clippedCoupons:"clippedCoupons"},template:{activeCoupon:"#active-coupon-template",expiredCoupon:"#expired-coupon-template",featuredCoupon:"#featured-coupon-template",homeHelp:"#home-help-template",homeSavingsBar:"#home-savings-bar-template",highValueCoupon:"#high-value-coupon-template",partnerCoupon:"#partner-coupon-template",printedCoupon:"#printed-coupon-template",printerAppDialog:"#printer-app-dialog-template",unavailableFeaturedCoupon:"#unavailable-featured-coupon-template"},url:{couponsService:"/api/Coupons"}},o={active:"active",couponErrorDialog:"coupon-error-dialog",couponHoverStyle:"coupon-hover-style",clipBtn:"coupon-clip-btn",clippedBtn:"coupon-clipped-btn",disabled:"disabled",inGalleryView:"in-gallery-view",printerConnectedDialog:"printer-connected-dialog",tooltipHelp:"tooltip-help",tooltipOpen:"tooltip-open"},r={contactConfirmationContainer:"#contact-confirmation-container",couponErrorDialog:"#coupon-error-dialog",couponGlobalHeader:"#coupon-global-header",couponHomeContainer:"#coupon-home-container",helpTooltip:"#help-tooltip",installContainer:"#install-container",upgradeContainer:"#upgrade-container",printerConnectedDialog:"#printer-connected-dialog",loadingContainer:"#loading-container",mainContainer:"#main-coupon-container",mainForm:"#mainform",noCouponsContainer:"#no-coupons-container",printingContainer:"#printing-container",activeCouponCount:".active-coupon-list-container .title-count",activeCouponListContainer:".active-coupon-list-container",availableCouponsTodayContainer:".available-coupons-today-container",btnText:".btn-text",clipAllInput:".clip-all-input",clipBox:".coupon-clip-box",clipBtn:".coupon-clip-btn",clippedBtn:".coupon-clipped-btn",contactAuthenticated:".contact-body-auth",contactKnown:".contact-body-known",couponAnonymous:".coupon-anonymous",couponContainer:".coupon-container",couponDescription:".coupon-body",couponErrorText:".coupon-error-text",couponKnown:".coupon-known",couponListLineBreak:".coupon-list-line-break",couponSectionHeaderContainer:".coupon-section-header-container",currentSavingsAmount:".current-savings-amount",currentSavingsNumber:".current-savings-number",currentSavingsTotalNumber:".current-savings-total-number",descriptionFull:".full-desc",descriptionShort:".short-desc",descriptionToggleShowMore:".desc-toggle",emailCouponsBtn:".email-coupons-btn",emailLink:".email-link",expiredCouponCount:".expired-coupon-list-container .title-count",expiredCouponListContainer:".expired-coupon-list-container",featuredCouponContainer:".featured-coupon-container",headerSubNavigation:".header-sub-navigation",helpIcon:".help-icon",helpLink:".help-link",highValueCountdown:".high-value-countdown",highValueCouponListContainer:".high-value-coupon-list-container",highValueCouponNumber:".high-value-coupon-number",highValueDescription:".high-value-description",highValueMoreSavingsContainer:".more-savings-message",homeBodyContainer:".home-body-container",homeSavingsBarContainer:".home-savings-bar-container",partnerCouponCount:".partner-coupon-list-container .title-count",partnerCouponListContainer:".partner-coupon-list-container",printedAndExpiredContainer:".printed-expired-container",printedCouponCount:".printed-coupon-list-container .title-count",printedCouponListContainer:".printed-coupon-list-container",printLink:".print-link",sendCouponsBtn:".send-coupons-btn",subNavLink:".sub-nav-link",tooltipHelp:".tooltip-help",ytdSavingsContainer:".ytd-savings-container"};n.fn.isOnScreen=function(i){var u=this.offset(),e=n(t),o,f,r;return r={top:e.scrollTop(),left:e.scrollLeft()},o={xoffset:0,yoffset:0},f=this.extend({},o,i),r.right=r.left+e.width(),r.bottom=r.top+e.height(),u.right=u.left+this.outerWidth(),u.bottom=u.top+this.outerHeight(),!(r.right<u.left+f.xoffset||r.left>u.right-f.xoffset||r.bottom<u.top+f.yoffset||r.top>u.bottom-f.yoffset)};s={};s.now=Date.now||function(){return(new Date).getTime()};s.debounce=function(n,t,i){var r,u,f,o,e,h=function(){var c=s.now()-o;c<t&&c>0?r=setTimeout(h,t-c):(r=null,i||(e=n.apply(f,u),f=u=null))};return function(){f=this;u=arguments;o=s.now();var c=i&&!r;return r||(r=setTimeout(h,t)),c&&(e=n.apply(f,u),f=u=null),e}};u.init=function(n){var i=this;if(t.location.hash)return t.location=t.location.origin+t.location.pathname,!1;i.initViewModel(n);i.initTemplates();i.initEvents();i.initTooltips();i.initUiAndPrinter(n);i.populateCurrentTotal()};u.initEvents=function(){var i=this;n(t).on("hashchange",i.onHashChange.bind(i));n(t).on("scroll",s.debounce(i.onScroll,f.OnScrollDelay));n(r.mainForm).on("submit",function(n){n.preventDefault()});n(r.couponHomeContainer).on("click",r.clipBtn+","+r.clippedBtn,function(){i.toggleClass(this,o.clipBtn,o.clippedBtn)});n(r.couponHomeContainer).on("click",r.descriptionToggleShowMore,function(){i.toggleDescriptionShowMore(this,f)});n(r.mainContainer).on("click",r.clipAllInput,function(){i.toggleClipAll(n(this))});n(r.mainContainer).on("click",r.emailLink,i.onEmailCoupons.bind(i));n(r.mainContainer).on("click",r.printLink,i.onPrintCouponsClicked.bind(i));n(r.mainContainer).on("click",r.emailCouponsBtn,i.onEmailCoupons.bind(i));n(r.mainContainer).on("click",r.sendCouponsBtn,i.onSendCoupons.bind(i))};u.initTemplates=function(){var i={},o=t.parseTemplate,f,u;i[e.template.homeSavingsBar]=r.homeSavingsBarContainer;for(u in i)i.hasOwnProperty(u)&&(f=n(o(n(u).html(),{})),f.appendTo(i[u]))};u.initTooltips=function(){function i(t,i){i.stopImmediatePropagation();n(r.tooltipHelp).length?(t.tooltip("close"),t.removeClass(o.tooltipOpen)):(t.tooltip("open"),t.addClass(o.tooltipOpen))}var t={content:n(r.helpTooltip).html(),items:"span",show:!1,tooltipClass:o.tooltipHelp};n(r.helpIcon).tooltip(t).off().on("click",function(t){i(n(this),t);n(".ui-tooltip-content").attr("id","gmi_coupon_helpPopUp_paragraph")}).on("mouseleave",function(n){n.stopImmediatePropagation()});n(document).on("click",function(){n(r.tooltipHelp).length&&(n(r.helpIcon).tooltip("close"),n(r.helpIcon).removeClass(o.tooltipOpen))})};u.initUiAndPrinter=function(n){var t=this;t.startSpinner();t.removeCoupons();t.enableCoupons();t.enableActiveSubNavigationLink();t.enableCouponSectionHeaders();t.enableKnownState();t.enableNewWindowHelpLinks();t.printAdapter=new i.Coupons.PrintAdapter(n);t.printAdapter.initializeLegacyPrintControl().done(function(){t.handleLegacyPrintControlInitialized(this)}).fail(function(){t.handleLegacyPrintControlFailed()})};u.initViewModel=function(n){f=n;f.couponsReady=!1;f.deviceId=null};u.buildBrandArr=function(){var t=[];return n(r.clippedBtn).each(function(){t.push(n(this).attr("data-brand"))}),t};u.buildCheckedArr=function(){var t=[];return n(r.clippedBtn).each(function(){t.push(n(this).attr("id"))}),t};u.buildClippedOfferCodes=function(){var t=[];return n(r.clippedBtn).each(function(){t.push(n(this).attr("data-offer-code"))}),t};u.encodeCurrentRelativePath=function(n){var i=n.location.pathname+n.location.search;return t.encodeURI(i)};u.checkCoupons=function(t){for(var i=0,u=t.length;i<u;i++)n(r.clipBtn).each(function(){var u=n(this);u.attr("id")===t[i]&&(u.attr("class",o.clippedBtn),u.find(r.btnText).text(f.ClippedButtonText))})};u.disableCoupons=function(){n("input",r.couponHomeContainer).attr("disabled","disabled");n(r.couponHomeContainer).addClass(o.disabled)};u.enableCoupons=function(){n("input",r.couponHomeContainer).removeAttr("disabled");n(r.couponHomeContainer).removeClass(o.disabled)};u.enableActiveSubNavigationLink=function(){var i;i=t.location.pathname.toLowerCase();i=i.substring(i.lastIndexOf("/"));n(r.headerSubNavigation).each(function(){var t=n(this);t.find(r.subNavLink).each(function(){var t=n(this),r=t.attr("href").toLowerCase();r.indexOf(i)!==-1&&t.parent().addClass(o.active)})})};u.enableCouponSectionHeaders=function(){f.GMICouponSectionTitle&&n(r.activeCouponListContainer+" "+r.couponSectionHeaderContainer).show();f.PartnerCouponSectionTitle&&(n(r.couponListLineBreak).show(),n(r.partnerCouponListContainer+" "+r.couponSectionHeaderContainer).show())};u.enableKnownState=function(){f.CurrentUserIsKnown?(n(r.couponKnown).show(),n(r.couponAnonymous).hide()):(n(r.couponKnown).hide(),n(r.couponAnonymous).show())};u.enableNewWindowHelpLinks=function(){f.IsOpenInNewWindow&&n(r.helpTooltip).find(r.helpLink).attr("target","_blank")};u.getCouponsSuccess=function(t){var u=this,s={DisplayType:"CouponGallery",EventType:"ViewCoupon",CouponBrandName:[],CouponId:[],OfferCode:[],CouponOfferCount:0},y=function(n){return n.isActive},l=function(n){return function(t){return!t[n]?"":String(t[n])}},h,e;for(t.couponList!==null?f.ShowGMICoupons||f.ShowPartnerCoupons||f.ShowPrintedCoupons||f.ShowExpiredCoupons?(u.parseCoupons(t.couponList,t.currentDateTime,t.couponBadgeList,t.featuredCouponIndex),u.populateTotals(),u.populateYtdSavings(t.totalUserPrintedYearlySavings,t.totalAvailableYearlySavings),n(r.couponContainer).mouseover(function(){n(this).addClass(o.couponHoverStyle)}).mouseout(function(){n(this).removeClass(o.couponHoverStyle)}),n(r.couponGlobalHeader).show(),n(r.couponHomeContainer).show()):u.viewNoCouponsContainer():u.viewNoCouponsContainer(),h=t.couponList!==null?t.couponList.filter(y):[],e=0;e<h.length;){var a=h.length-e,v=a<10?a:10,c=h.slice(e,e+v);s.CouponBrandName=c.map(l("brand"));s.CouponId=c.map(l("number"));s.OfferCode=c.map(l("offerCode"));s.CouponOfferCount=c.length;i.Analytics.raiseEvent(s);e=e+v}u.stopSpinner();u.parseQueryString();u.populateCurrentTotal()};u.getPrintToken=function(n){var t=this,i;n||(n=t.buildCheckedArr());i={deviceId:f.deviceId,couponList:n};t.getJson(e.url.couponsService,e.action.getPrintToken,i,t.handleLegacyPrintTokenResponse)};u.initiateQuotientPrintFlow=function(n,t){var i=this;i.printAdapter.getPrintId()&&t!==!0?i.showQuotientPrintDialog(n):i.showPrinterConnectedModal(n)};u.showPrinterConnectedModal=function(i){var u=this,e=n(r.printerConnectedDialog);e.dialog({dialogClass:o.printerConnectedDialog,resizable:!1,modal:!0,width:280,buttons:{No:function(){t.location=f.PrintHelpUrl},Yes:function(){n(this).dialog("close");u.showQuotientPrintDialog(i)}}})};u.showQuotientPrintDialog=function(n){var t=this;n||(n=t.buildCheckedArr());t.viewPrintingContainer();t.printAdapter.printCoupons({couponList:n}).done(function(i){t.handlePrintResponse(i.status,null,n)}).fail(function(i){if(i&&i.action==="securePrintCoupons"){t.handlePrintResponse(i.status,null,n);return}t.cancelPrint()})};u.getTotalSavings=function(){function i(n){t+=Number(n.attr("accesskey"))}var t=0;return n(r.clipBtn).each(function(){i(n(this))}),n(r.clippedBtn).each(function(){i(n(this))}),t};u.handleLegacyPrintControlInitialized=function(n){var i=this,t="";n&&n.deviceId&&(t=n.deviceId);i.initDisplay(t,null)};u.handlePrintIdServiceInitialized=function(){var n=this;console.log("PrintId from PrintAdapter: "+n.printAdapter.getPrintId());n.initDisplay(null,n.printAdapter.getPrintId())};u.handleLegacyPrintControlFailed=function(){var n=this;console.log("Legacy PrintControl not available. Attempting to initialize PrintId service...");n.printAdapter.initializePrintIdService().done(function(){n.handlePrintIdServiceInitialized()}).fail(function(){n.showErrorDialog("An attempt to initialize PrintID service failed.")})};u.handleLegacyPrintTokenResponse=function(n){var t=this;if(!n){t.showErrorDialog("The printer token is not valid.");return}t.printAdapter.printCoupons({legacyPrintToken:n}).always(function(i){t.handlePrintResponse(i,n)});t.viewPrintingContainer()};u.handlePrintResponse=function(n,i,r){var u=this,o={statusCode:n};u.printAdapter.isPrintIdServiceEnabled()?(o.printIdUserToken=u.printAdapter.getPrintId(),o.couponList=r):u.printAdapter.isLegacyPrintingEnabled()&&(o.legacyPrintToken=i);u.removeCookie(e.cookie.checkedArr);u.removeCookie(e.cookie.printClicked);u.removeCookie(e.cookie.clipAllInput);u.printAdapter.recordPrintResult(o).always(function(){t.location.href=f.PrintThankYouPageUrl+"?"+f.StatusCodeParameter+"="+n})};u.cancelPrint=function(){u.hidePrintingContainer()};u.initDisplay=function(t,i){var r=this,s=n("input[id$=DataSourceItemHidden]").val(),h=f.PrimaryFeaturedCouponId,c=f.SecondaryFeaturedCouponId,l=f.FeaturedContentId,u=isNaN(parseInt(t,10))?"0":t,o;f.deviceId=u;o={deviceId:u,printId:i,dataSourceItem:s,primaryFeaturedCouponId:h,secondaryFeaturedCouponId:c,featuredContentId:l};r.getJson(e.url.couponsService,e.action.getCoupons,o,r.getCouponsSuccess)};u.initPrint=function(n,t){var r=this;if(r.removeCookie(e.cookie.printClicked),r.removeCookie(e.cookie.installClicked),i.Analytics.raiseEvent({DisplayType:"CouponGallery",EventType:"Print",CouponBrandName:r.buildBrandArr(),CouponId:n,OfferCode:r.buildClippedOfferCodes(),CouponOfferCount:n.length}),r.printAdapter.isLegacyPrintingEnabled())try{r.getPrintToken(n)}catch(u){r.showErrorDialog(u)}else r.printAdapter.isPrintIdServiceEnabled()?r.initiateQuotientPrintFlow(n,t):r.showErrorDialog("Printing is not available due to an issue with the print service.")};u.insertInCookie=function(){var t=this,i=t.buildCheckedArr();t.setCookie(e.cookie.checkedArr,i);n(r.clipAllInput).attr("checked")?t.setCookie(e.cookie.clipAllInput,"true"):t.removeCookie(e.cookie.clipAllInput)};u.isCouponClipped=function(){return n(r.clippedBtn).length===0?(n(r.couponErrorText).show(),!1):!0};u.onHashChange=function(){var i=this;n(r.couponGlobalHeader).hide();n(r.couponHomeContainer).hide();n(r.contactConfirmationContainer).hide();n(r.installContainer).hide();n(r.upgradeContainer).hide();switch(t.location.hash){case e.hash.contactConfirmation:n(r.contactConfirmationContainer).show();break;case e.hash.install:n(r.installContainer).show();break;default:n(r.couponGlobalHeader).show();n(r.couponHomeContainer).show();i.enableKnownState()}t.scroll(0,0)};u.onEmailCoupons=function(){var n=this;if(!n.isCouponClipped())return!1;f.couponsReady&&(t.location.hash=e.hash.contactConfirmation)};u.onPrintCouponsClicked=function(){var n=this,i,t;if(!n.isCouponClipped())return!1;f.couponsReady&&(t=n.getCookie(e.cookie.checkedArr),t&&(i=t.split(","),n.initPrint(i,!1)))};u.onScroll=function(){var t=n(r.homeSavingsBarContainer),i=n(r.homeBodyContainer).isOnScreen({yoffset:f.OnScrollYOffset});i&&!t.hasClass(o.inGalleryView)?t.addClass(o.inGalleryView):!i&&t.hasClass(o.inGalleryView)&&t.removeClass(o.inGalleryView);n(".home-footer-container").each(function(){n(this).find(".email-link").attr("id","gmi_coupon_bottomEmail_link");n(this).find(".print-link").attr("id","gmi_coupon_bottomPrint_link");n(this).find(".clip-all-text").attr("id","gmi_coupon_bottomClipAllInput_text");n(this).find(".clip-all-input").attr("id","gmi_coupon_bottomClipAllInput_check");n(this).find(".savings-left").attr("id","gmi_coupon_bottomCurrentSavings_text");n(this).find(".coupon-error-text").attr("id","gmi_coupon_bottomCouponPrintError_text")})};u.onSendCoupons=function(){var t=this,u=t.buildCheckedArr(),i;if(!t.isCouponClipped())return!1;i={emailAddress:n(r.contactConfirmationContainer+" input").val(),clippedCoupons:u.toString()};t.post(e.url.couponsService,e.action.sendClippedCouponsEmail,JSON.stringify(i),t.viewSentConfirmation)};u.parseCoupons=function(i,u,o,s){var y=this,b=t.parseTemplate,nt=0,tt=0,k=0,ut=0,it=0,w,c,p,a,v,l,rt,g,h,ft,d,et,ot;for((f.FeaturedContentId||s>-1)&&(ot=i[s],y.displayFeaturedCoupon(ot)),h=0,ft=i.length;h<ft;h++){if(p="display:none;",i[h].shortDescription=y.highlightUppercase(y.populateShortDescription(f,i[h])),i[h].midLevel=y.highlightUppercase(i[h].midLevel),i[h].expandDescriptionText=f.ExpandDescriptionText,i[h].collapseDescriptionText=f.CollapseDescriptionText,h===s){nt+=1;continue}for(d=0,et=o.length;d<et;d++)n.inArray(i[h].number.toString(),o[d].couponId)>-1&&(w=o[d].badgeImageUrl,p="display:block;");i[h].isPrinted?f.ShowPrintedCoupons&&i[h].couponType!==1&&(v=n(r.printedCouponListContainer).show(),l=e.template.printedCoupon,c={coupon:i[h],badgeUrl:w,display:p},a=n(b(n(l).html(),c)),it+=1):i[h].isExpired||!!i[h].endDate&&i[h].endDate<u?f.ShowExpiredCoupons&&(v=n(r.expiredCouponListContainer).show(),l=e.template.expiredCoupon,c={coupon:i[h],badgeUrl:w,display:p},a=n(b(n(l).html(),c)),tt+=1):i[h].couponType===3?f.ShowPartnerCoupons&&(v=n(r.partnerCouponListContainer).show(),l=e.template.partnerCoupon,c={coupon:i[h],badgeUrl:w,display:p},a=n(b(n(l).html(),c)),ut+=1):i[h].couponType===1?f.HighValueTotalCount!==0&&(v=n(r.highValueCouponListContainer).show(),l=e.template.highValueCoupon,c={coupon:i[h],badgeUrl:w,display:p},a=n(b(n(l).html(),c)),k+=1,rt=a.find(r.highValueCouponNumber),g=rt.html(),g=g.replace(/#HighValueCouponNumber#/g,k),rt.html(g)):f.ShowGMICoupons&&(v=n(r.activeCouponListContainer).show(),l=e.template.activeCoupon,c={coupon:i[h],badgeUrl:w,display:p},a=n(b(n(l).html(),c)),nt+=1);!!v&&n(v).length&&(a.appendTo(v.find("ul")),y.setDescriptionShowHide(a,i[h],f))}f.HighValueTotalCount===0||k===0?(n(r.highValueCouponListContainer).hide(),n(r.highValueMoreSavingsContainer).hide()):y.populateHighValueMessaging(k);y.populateCounts(nt,ut,k,it,tt);it+tt===0&&n(r.printedAndExpiredContainer).hide()};u.allowFeaturedCoupon=function(n){return n?n.isActive===!0&&n.isExpired===!1&&n.isPrinted===!1:!1};u.displayFeaturedCoupon=function(t){var o=this,i={},u=n(e.template.unavailableFeaturedCoupon),s=n(r.featuredCouponContainer).find("ul"),f;o.allowFeaturedCoupon(t)&&(i={coupon:t},u=n(e.template.featuredCoupon));f=parseTemplate(u.html(),i);s.html(f)};u.populateHighValueMessaging=function(){var i,t,o=this,u,e;t=n(r.highValueDescription);i=t.html();i=i.replace(/#TotalHighValueCount#/g,f.HighValueTotalCount);t.html(i);t=n(r.highValueCountdown);u=f.HighValueCountdownFormat;e=f.HighValueCountdownExpiration;t.html(o.generateHighValueCountdown(u,e,new Date))};u.generateHighValueCountdown=function(n,t,i){var s=-(i.getTimezoneOffset()/60),h=-6-s,f=new Date(i.getTime()+h*36e5),r=new Date(f.getTime()),o,e,u;return r.setDate(r.getDate()-r.getDay()+1),o=Math.floor(t/24),r.setDate(r.getDate()+o),t=t-o*24,r.setHours(t,0,0,0),r<f&&r.setDate(r.getDate()+7),e=Math.floor((Date.parse(r)-Date.parse(f))/864e5),u=Math.floor((Date.parse(r)-Date.parse(f))/36e5),u=u-e*24+1,u==24&&(e+=1,u=0),n.replace(/#CountdownDays#/g,e).replace(/#CountdownHours#/g,u)};u.populateShortDescription=function(n,t){var i;return n.ShowFullDescription!==!0&&n.MaxDescriptionCharacterCount?t.midLevel?(i=t.midLevel.length>n.MaxDescriptionCharacterCount?t.midLevel.substring(0,n.MaxDescriptionCharacterCount-10):t.midLevel,(!n.ExpandDescriptionText||n.ExpandDescriptionText.trim()==="")&&t.midLevel.length>n.MaxDescriptionCharacterCount&&(i+="&hellip;")):i="":i=t.midLevel,i};u.highlightUppercase=function(n){var i=n.match(/[A-Z]{2,}/g),t;if(i)for(t=0;t<i.length;t++)n=n.replace(i[t],'<span class="uppercase">'+i[t]+"<\/span>");return n};u.setDescriptionShowHide=function(n,t,i){var f=n.find(r.couponDescription),e=f.find(r.descriptionToggleShowMore);i.ShowFullDescription===!0||t.shortDescription===t.midLevel?(u.showMoreDescription(f,i),e.hide()):u.showLessDescription(f,i.ExpandDescriptionText)};u.parseQueryString=function(){var r=this,n,o,s,i,u;if(t.location.search)for(i=t.location.search.substring(1).split("&"),n=0,s=i.length;n<s;n++)o=i[n].split("=")[0],u=i[n].split("=")[1],o===e.param.clippedCoupons&&(r.checkCoupons(u.split(",")),r.insertInCookie(),f.couponsReady&&r.initPrint(u.split(","),!0))};u.populateCounts=function(t,i,u,f,e){function s(n){return"("+n+")"}var o,h;h=t+i+u;o=n(r.availableCouponsTodayContainer).html();o=o.replace("#TotalCoupons#",h);n(r.availableCouponsTodayContainer).html(o);n(r.currentSavingsTotalNumber).html(h);n(r.activeCouponCount).text(s(t));n(r.partnerCouponCount).text(s(i));n(r.printedCouponCount).text(s(f));n(r.expiredCouponCount).text(s(e))};u.populateCurrentTotal=function(){var t=this,i=n(r.clippedBtn).length;n(r.currentSavingsNumber).html(i);t.populateCurrentSavings()};u.populateCurrentSavings=function(){var i=0;n(r.clippedBtn).each(function(){i+=Number(n(this).attr("accesskey"))});n(r.currentSavingsAmount).html(t.formatCurrency(i))};u.populateTotals=function(){var u=this,f=u.getTotalSavings(),i;i=n(r.availableCouponsTodayContainer).html();i=i.replace("#TotalSavings#",t.formatCurrency(f));n(r.availableCouponsTodayContainer).html(i)};u.populateYtdSavings=function(i,u){var f;f=n(r.ytdSavingsContainer).html();f=f.replace("#YtdSavings#",t.formatCurrency(i));f=f.replace("#YtdTotal#",t.formatCurrency(u));n(r.ytdSavingsContainer).html(f)};u.removeCoupons=function(){var t=" li",i=[r.activeCouponListContainer+t,r.partnerCouponListContainer+t,r.printedCouponListContainer+t,r.expiredCouponListContainer+t];n(i.join(",")).remove()};u.showErrorDialog=function(t){var u=n(r.couponErrorDialog),i;t&&(t.responseText&&(t=JSON.parse(t.responseText)),i=t.Message||t.message||t.description||t.toString(),i&&(u.find(r.couponErrorText).show().text(i),u.dialog({dialogClass:o.couponErrorDialog,resizable:!1,modal:!0,width:280})))};u.startSpinner=function(){n(r.loadingContainer).show();f.couponsReady=!1};u.stopSpinner=function(){n(r.loadingContainer).hide();f.couponsReady=!0};u.toggleClass=function(t,i,u){var s=this,h=n(t),e,o;t.className===i?(e=u,o=f.ClippedButtonText,n(r.couponErrorText).hide()):(e=i,o=f.ClipButtonText,n(r.clipAllInput).attr("checked",!1));t.className=e;h.find(r.btnText).text(o);s.insertInCookie();s.populateCurrentTotal()};u.toggleDescriptionShowMore=function(t,i){var f=n(t).parents(r.couponDescription),e=f.find(r.descriptionFull);e.css("display")==="none"?u.showMoreDescription(f,i.CollapseDescriptionText):u.showLessDescription(f,i.ExpandDescriptionText)};u.showMoreDescription=function(n,t){var i=n.find(r.descriptionFull),u=n.find(r.descriptionShort),f=n.find(r.descriptionToggleShowMore);i.show();u.hide();f.html(t)};u.showLessDescription=function(n,t){var i=n.find(r.descriptionFull),u=n.find(r.descriptionShort),f=n.find(r.descriptionToggleShowMore);i.hide();u.show();f.html(t)};u.toggleClipAll=function(t){var s=this,h=n(r.clipAllInput),u;n(r.couponErrorText).hide();t.attr("checked")?(h.attr("checked","checked"),u=n(r.clipBtn),u.attr("class",o.clippedBtn),u.find(r.btnText).text(f.ClippedButtonText),s.insertInCookie(),i.Analytics.raiseEvent({EventType:"CouponClipAll"})):(h.removeAttr("checked"),u=n(r.clippedBtn),u.attr("class",o.clipBtn),u.find(r.btnText).text(f.ClipButtonText),s.removeCookie(e.cookie.clipAllInput),s.removeCookie(e.cookie.checkedArr));s.populateCurrentTotal()};u.viewNoCouponsContainer=function(){n(r.noCouponsContainer).show();n(r.couponGlobalHeader).hide();n(r.couponHomeContainer).hide()};u.viewPrintingContainer=function(){n(r.printingContainer).show();n(r.couponGlobalHeader).hide();n(r.couponHomeContainer).hide();t.scroll(0,0)};u.hidePrintingContainer=function(){n(r.couponGlobalHeader).show();n(r.couponHomeContainer).show();n(r.printingContainer).hide()};u.viewSentConfirmation=function(){var u=this,s=n(r.clippedBtn),h=u.buildCheckedArr();i.Analytics.raiseEvent({DisplayType:"CouponGallery",EventType:"Email",CouponBrandName:u.buildBrandArr(),CouponId:h,OfferCode:u.buildClippedOfferCodes(),CouponOfferCount:h.length});t.location.href=f.EmailThankYouPageUrl;s.attr("class",o.clipBtn);s.find(r.btnText).text(f.ClipButtonText);u.removeCookie(e.cookie.checkedArr);u.removeCookie(e.cookie.printClicked);u.removeCookie(e.cookie.clipAllInput)};u.post=function(t,i,r,u){var f=this;n.ajax({type:"POST",url:t+"/"+i,data:r,contentType:"application/json; charset=utf-8",success:u.bind(f),error:f.showErrorDialog.bind(f),dataType:"json"})};u.getJson=function(t,i,r,u){var f=this;n.ajax({type:"GET",contentType:"application/json; charset=UTF-8",dataType:"json",url:t+"/"+i,data:r,success:u.bind(f),error:f.showErrorDialog.bind(f)})};u.setCookie=function(n,i,r){var u=new Date,f=n+"="+t.escape(i);!r||(u.setDate(u.getDate()+r),f+=";expires="+u.toUTCString());f+=";path=/";document.cookie=f};u.getCookie=function(n){var i,r;return document.cookie.length>0&&(i=document.cookie.indexOf(n+"="),i!==-1)?(i=i+n.length+1,r=document.cookie.indexOf(";",i),r===-1&&(r=document.cookie.length),t.unescape(document.cookie.substring(i,r))):""};u.removeCookie=function(n){this.setCookie(n,null,-1e3)};t.formatCurrency=function(n){return n=isNaN(n)||n===""||n===null?0:n,"$"+parseFloat(n).toFixed(2)};t.formatDate=function(n){var t=Date(n)?Date(n):null;return t?new Date(t).toLocaleDateString():n};t._tmplCache={};t.parseTemplate=function(n,i){var r=t._tmplCache[n],u;return r||(u="var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").replace(/'(?=[^#]*#>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<#=(.+?)#>/g,"',$1,'").split("<#").join("');").split("#>").join("p.push('")+"');}return p.join('');",r=new Function("obj",u),t._tmplCache[n]=r),r(i)}}(window.jQuery,window,window.GeneralMills||(window.GeneralMills={}));jQuery(document).ready(function(){jQuery("#brickCouponViewContainer").dialog({autoOpen:!1,closeOnEscape:!1,draggable:!1,resizable:!1,modal:!0,width:"720",height:"auto",dialogClass:"VariableWidth VariableWidth-ui-dialog brickCouponDialog"});jQuery(".OneOfCouponView a.dialogBoxCoupon").bind("click",function(n){n.preventDefault();var t=jQuery("#brickCouponIframe"),i=jQuery(this).attr("href");t[0]&&(updateIframeStyle(i),jQuery(t).attr("src",i),jQuery("#brickCouponViewContainer").dialog("open"))})});updateIframeStyle=function(n){if(n!=""){var t=getURLParam(n),i=0;heightPaddingContent=10;lastHeight=0;lastWidth=0;topPosition=0;i=t.length;lastHeight=parseInt(t[i-2],10);lastWidth=parseInt(t[i-1],10);lastHeight>0&&lastWidth>0&&(topPosition=(jQuery(window).height()-lastHeight)/2+"px",jQuery(".brickCouponDialog").css({height:heightPaddingContent+lastHeight+"px",width:lastWidth+"px",top:topPosition}).find("#brickCouponIframe").css({height:lastHeight+"px",width:lastWidth+"px"}))}};getURLParam=function(n){var r=[],u,i,t,f;if(n.indexOf("?")>-1)for(u=n.substr(n.indexOf("?")).toLowerCase(),i=u.split("&"),t=0;t<i.length;t++)f=i[t].split("="),r[t]=f[1];return r},function(n,t){(function(){(function(i){dataSourceItem="/sitecore/content/Data/Shared/Coupons/Coupon View/Coupon Listing";i.linkBoxClass="LinkBox";i.savingsSummaryContainer="#SavingsSummary";i.savingsBoxes="#SavingsSummary .SavingsBox";i.monthlySavingsContainer="#SavingsSummary #MonthlySavings";i.yearlySavingsContainer="#SavingsSummary #YearlySavings";i.callToActionButtonContainer="#SavingsSummary #MonthlySavings #CallToActionButton";i.countOfMonthlyCouponsRemainingContainer="#SavingsSummary #MonthlySavings #MonthlyCouponsAvailable";i.countOfMonthlyCouponsAvailableMessageContainer="#SavingsSummary #MonthlySavings #MonthlyCouponsAvailableMessage";i.totalMonthlySavingsRemainingContainer="#SavingsSummary #MonthlySavings #MonthlySavingsAvailable";i.totalMonthlySavingsAvailableMessageContainer="#SavingsSummary #MonthlySavings #MonthlySavingsAvailableMessage";i.totalUserPrintedYearlySavingsContainer="#SavingsSummary #YearlySavings #YearlySavingsPrinted";i.totalUserPrintedYearlySavingsOuterContainer="#SavingsSummary #YearlySavingsPrintedOuter";i.totalAvailableYearlySavingsContainer="#SavingsSummary #YearlySavings #YearlySavingsTotal";i.yearlySavingsProgressBarContainer="#SavingsSummary #YearlySavings #YearlySavingsProgressBar";i.Urls={getCoupons:"/api/Coupons/GetCoupons"};i.getCouponsSuccess=function(t){i.render(n.Utils.dFix(t))};i.render=function(n){var i=t(this.monthlySavingsContainer);if(this.populateMonthlySavingsSummary(n.countOfAvailableMonthlyCoupons,n.countOfUserPrintedMonthlyCoupons,n.totalAvailableMonthlySavings,n.totalUserPrintedMonthlySavings),i.show(),this.config.CtaVisible){i.addClass(this.linkBoxClass);i.on("click",function(){return window.location=i.find("a").attr("href"),!1})}n.isKnown&&n.totalAvailableYearlySavings!==null&&n.totalUserPrintedYearlySavings!==null&&(this.populateYearlySavingsSummary(n.totalAvailableYearlySavings,n.totalUserPrintedYearlySavings),t(this.yearlySavingsContainer).show(),this.drawProgressBar(n.totalAvailableYearlySavings,n.totalUserPrintedYearlySavings),this.drawSavingsSummaryDivider())};i.drawProgressBar=function(n,i){var r=i/n*100,u=r>100?100:r;t(this.yearlySavingsProgressBarContainer).progressbar({value:u});t(this.totalUserPrintedYearlySavingsOuterContainer).css("margin-right",100-u+"%")};i.drawSavingsSummaryDivider=function(){var n=t(this.yearlySavingsContainer),i;n.is(":visible")&&(i=t(this.savingsSummaryContainer).outerWidth(),i>=this.config.SavingsSummaryLayoutBreakpoint||i===0?n.css("border-left")!==this.config.DividerStyle&&(n.css("border-left",this.config.DividerStyle),n.css("border-top",""),t(this.savingsBoxes).addClass("Split")):n.css("border-top")!==this.config.DividerStyle&&(n.css("border-top",this.config.DividerStyle),n.css("border-left",""),t(this.savingsBoxes).removeClass("Split")))};i.populateMonthlySavingsSummary=function(i,r,u,f){var e,o,s,h,c,l;i!==null?(e=r!==null?i-r:i,t(this.countOfMonthlyCouponsRemainingContainer).html(e),o=t(this.countOfMonthlyCouponsRemainingContainer).detach()[0].outerHTML,s=e>1?this.config.AvailableCouponsPlural.replace(/\{0\}/,o):this.config.AvailableCouponsSingular.replace(/\{0\}/,o),t(this.countOfMonthlyCouponsAvailableMessageContainer).html(s)):t(this.countOfMonthlyCouponsAvailableMessageContainer).hide();u!==null&&f!==null&&(h=u-f,t(this.totalMonthlySavingsRemainingContainer).html(n.Utils.formatCurrency(h)),c=t(this.totalMonthlySavingsRemainingContainer).detach()[0].outerHTML,l=this.config.MonthlySavings.replace(/\{0\}/,c),t(this.totalMonthlySavingsAvailableMessageContainer).html(l))};i.populateYearlySavingsSummary=function(i,r){t(this.totalAvailableYearlySavingsContainer).html(n.Utils.formatCurrency(i));t(this.totalUserPrintedYearlySavingsContainer).html(n.Utils.formatCurrency(r))}})(window.GeneralMills.Coupons.SavingsSummary=window.GeneralMills.Coupons.SavingsSummary||{})})(window.GeneralMills.Coupons=window.GeneralMills.Coupons||{}),function(n){n.now=Date.now||function(){return(new Date).getTime()};n.throttle=function(t,i,r){var u,f,s,e=null,o=0,h;return r||(r={}),h=function(){o=r.leading===!1?0:n.now();e=null;s=t.apply(u,f);u=f=null},function(){var c=n.now(),l;return o||r.leading!==!1||(o=c),l=i-(c-o),u=this,f=arguments,l<=0?(clearTimeout(e),e=null,o=c,s=t.apply(u,f),u=f=null):e||r.trailing===!1||(e=setTimeout(h,l)),s}};n.dFix=function(n){return n.hasOwnProperty("d")?n.d:n};n.formatCurrency=function(n){return n=isNaN(n)||n===""||n===null?0:n,"$"+parseFloat(n).toFixed(2)};n.getJson=function(n,t,i){jQuery.ajax({type:"GET",url:n,data:t,contentType:"application/json; charset=utf-8",success:i,dataType:"json"})}}(window.GeneralMills.Utils=window.GeneralMills.Utils||{})}(window.GeneralMills=window.GeneralMills||{},jQuery);jQuery(document).ready(function(){if(typeof ci_vUserCode!="undefined"){var n={deviceId:ci_vUserCode,printId:null,dataSourceItem:dataSourceItem,primaryFeaturedCouponId:"",secondaryFeaturedCouponId:"",featuredContentId:null};GeneralMills.Utils.getJson(GeneralMills.Coupons.SavingsSummary.Urls.getCoupons,n,GeneralMills.Coupons.SavingsSummary.getCouponsSuccess)}jQuery(window).resize(GeneralMills.Utils.throttle(function(){GeneralMills.Coupons.SavingsSummary.drawSavingsSummaryDivider.call(GeneralMills.Coupons.SavingsSummary)},500))}),function(n){GeneralMills.PandoSites=GeneralMills.PandoSites||{};GeneralMills.PandoSites.ProductDetailTab=GeneralMills.PandoSites.ProductDetailTab||{};GeneralMills.PandoSites.ProductDetailTab=function(){var t={};return t.initialize=function(t){n(".productTabs .product-detail-tab [data-product-has-details='true']").length>0?t.tabs():t.hide()},t}();var t=n(".productTabs");GeneralMills.PandoSites.ProductDetailTab.initialize(t)}(jQuery),function(n,t){window.GeneralMills=window.GeneralMills||{};GeneralMills.AskBetty={};GeneralMills.AskBetty.QuestionSubmit={};GeneralMills.AskBetty.QuestionSubmit.Constants={koRootSelector:".askBettyQuestionSubmit",cookieName:"askBettyQuestionSubmit",regFormSelector:".ui-dialog-titlebar-close",apiUrl:"/api/askbettyquestion",errorParameter:"?error=1",searchBoxSelector:".askBettySearchBox .search-box",searchBoxWatermarkAttribute:"data-defaulttext",analyticsEventName:"SendQuestion"};GeneralMills.AskBetty.QuestionSubmit.Initialize=function(i){var r=GeneralMills.AskBetty.QuestionSubmit.Constants,f=GeneralMills.AskBetty.QuestionSubmit.Util(r),u=GeneralMills.AskBetty.QuestionSubmit.ViewModel(i,f,r);n.applyBindings(u,t(r.koRootSelector)[0]);u.init();t("body").on("click",r.regFormSelector,function(){u.onRegistrationDialogCanceled()})};GeneralMills.AskBetty.QuestionSubmit.ViewModel=function(i,r,u){var e={},f={};return i.testMode&&(e.internal=f),e.postInProgress=n.observable(!1),f.config=t.extend({regAction:"",esrc:"",isKnownUser:!1,hasScreenName:!1,thankYouUrl:"/",testMode:!1},i),e.submitQuestion=function(){f.config.isKnownUser?f.config.hasScreenName?f.postQuestion():f.openScreenNameDialog():f.openRegistrationDialog()},e.onRegistrationDialogCanceled=function(){r.clearCookieValue()},f.postQuestion=function(){if(e.postInProgress()!==!0){var n=f.getQuestionText();if(!n||n.length===0){r.redirect(i.thankYouUrl+u.errorParameter);return}e.postInProgress(!0);r.httpPost(u.apiUrl,n).done(function(){r.redirect(i.thankYouUrl)}).fail(function(){r.redirect(i.thankYouUrl+u.errorParameter)}).always(function(){r.raiseAnalyticsEvent();e.postInProgress(!1)})}},f.getQuestionText=function(){var n=r.getCookieValue()||r.getSearchBoxValue()||r.getQueryString().term;return r.clearCookieValue(),n},f.openScreenNameDialog=function(){r.openScreenNameDialog(function(n){n&&n.screenName&&f.postQuestion()})},f.openRegistrationDialog=function(){var n={returnUrl:window.location,isAuthenticated:!1,isRegistrationFirstStep:!0,isScreenNameSet:!1,RegAction:f.config.regAction,Esrc:f.config.esrc};r.setCookieValue(r.getSearchBoxValue()||r.getQueryString().term);r.openRegistrationDialog(n)},e.init=function(){r.cookieHasValue()===!0&&e.submitQuestion()},e};GeneralMills.AskBetty.QuestionSubmit.Util=function(n){var i={};return i.redirect=function(n){window.location=n},i.httpPost=function(n,i){return t.ajax({type:"POST",dataType:"json",url:n,contentType:"application/json; charset=utf-8",data:JSON.stringify(i)})},i.setCookieValue=function(i){i&&t.cookie(n.cookieName,encodeURIComponent(i))},i.getCookieValue=function(){if(i.cookieHasValue())return decodeURIComponent(t.cookie(n.cookieName))},i.cookieHasValue=function(){var i=t.cookie(n.cookieName);return i&&i!=="null"?!0:!1},i.clearCookieValue=function(){t.cookie(n.cookieName,null)},i.openRegistrationDialog=function(n){n&&window.reg&&window.reg.userRegistration&&window.reg.userRegistration.openRegistrationDialog(n)},i.openScreenNameDialog=function(n){n&&GeneralMills&&GeneralMills.ScreenNameUpdater&&GeneralMills.ScreenNameUpdater.open(n)},i.raiseAnalyticsEvent=function(){GeneralMills.Analytics.raiseEvent({EventType:n.analyticsEventName})},i.getQueryString=function(){var n=window.location.search;return function(n){var r,t,i;if(n==="")return{};for(r={},t=0;t<n.length;++t)(i=n[t].split("="),i.length==2)&&(r[i[0].replace(/^\?/,"")]=decodeURIComponent(i[1].replace(/\+/g," ")));return r}(n.split("&"))},i.getSearchBoxValue=function(){var r=t(n.searchBoxSelector),i=r.val(),u=r.attr(n.searchBoxWatermarkAttribute)||"";if(i&&i!==u)return t.trim(i)},i}}(ko,jQuery),function(n,t,i){i.GeneralMills=i.GeneralMills||{};GeneralMills.Cellfire=GeneralMills.Cellfire||{};GeneralMills.Cellfire.Utilities=function(){var t={};return t.elementExists=function(t){return n(t).length},t.setDocumentLocationHref=function(n){document.location.href=n},t.getCookie=function(t){return n.cookie(t)},t.setCookie=function(t,i){n.cookie(t,i,{path:"/"})},t.clearCookie=function(n){t.setCookie(n,null)},t.getJson=function(t,i,r,u){n.ajax({contentType:"application/json; charset=UTF-8",dataType:"json",url:t,data:i,success:r,error:u})},t.postJson=function(t,i,r,u){n.ajax({contentType:"application/json; charset=UTF-8",type:"POST",dataType:"json",url:t,data:i,success:r,error:u})},t.isLoggedIn=function(){return t.getCookie(GeneralMills.Cellfire.Constants.loggedInCookie)},t.isTopOfElementABelowBottomOfElementB=function(n,t){if(!n.length||!t.length)return null;var i=n.offset().top,r=t.outerHeight()+t.offset().top;return i>r},t.reloadPage=function(){document.location.reload(!1)},t.getCurrentUrl=function(){return document.location.href},t.getCurrentQueryString=function(){return document.location.search},t.debounce=function(n,t,i){var r,u;return function(){var f=this,e=arguments,o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r;return clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}},t.createCardValidationField=function(n,t,i,r){return{ValidationId:n,Name:t,ValidationRegex:i,Value:r}},t.createLoyaltyCard=function(n,t){var i={MerchantId:n.Id,RetailerName:n.Name,RetailerLoyaltyName:n.LoyaltyName,RetailerLoyaltyCaption:n.Name+" "+n.LoyaltyName,PrimaryLoyaltyField:null,SecondaryLoyaltyField:null,ValidationFields:t};return t!=null&&t.length>0&&(i.PrimaryLoyaltyField=t[0],t.length>1&&(i.SecondaryLoyaltyField=t[1])),i},t.getLoyaltyCardCssClass=function(n){var t="cardNumberEntry ";return n&&(t+=n),t.trim()},t.getLoyaltyCardInputType=function(n){switch(n){case 2:return"tel";case 3:return"number";default:return"text"}},t.testValueAgainstRegEx=function(n,t){var i=new RegExp(n);return i.test(t)},t.validateLoyaltyCardValues=function(n,i,r){var f=[],u=n.PrimaryValidationFieldRegex;if(n.HasOneInputForMultipleFields){if(t.testValueAgainstRegEx(u,i))return f.push(t.createCardValidationField(n.PrimaryValidationFieldId,n.PrimaryValidationFieldName,u,i)),f;if(u=n.SecondaryValidationFieldRegex,t.testValueAgainstRegEx(u,i))return f.push(t.createCardValidationField(n.SecondaryValidationFieldId,n.SecondaryValidationFieldName,u,i)),f}else if(t.testValueAgainstRegEx(u,i))if(f.push(t.createCardValidationField(n.PrimaryValidationFieldId,n.PrimaryValidationFieldName,u,i)),n.HasMultipleValidationFields){if(u=n.SecondaryValidationFieldRegex,t.testValueAgainstRegEx(u,r))return f.push(t.createCardValidationField(n.SecondaryValidationFieldId,n.SecondaryValidationFieldName,u,r)),f}else return f;return[]},t.getShortDescriptionFromDescription=function(n,t){var i=n+t;return i&&i.length>=50?i.substring(0,40):i},t.getRemainderDescriptionFromDescription=function(n,t){var i=n+t;return i&&i.length>=50?i.substring(40,i.length):""},t}();GeneralMills.Cellfire.Constants={loggedInCookie:"IsLoggedIn",preclipCookie:"cellfire.preclip",addToCardCookie:"cellfire.addToCard",regSettingsOverrideCookie:"cellfire.regSettingsOverride",recipeReturnUrlCookie:"cellfire.recipeReturnUrl",addingCardCookie:"cellfire.addingCard",anonymousSessionProfileId:"cellfire.anonymous",upgradeAnonymousToProfile:"cellfire.upgradeAnonymousToProfile",delayInMillisecondsBeforeRedirecting:500};t.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}}}(jQuery,ko,window),function(n,t,i){i.GeneralMills=i.GeneralMills||{};GeneralMills.Cellfire=GeneralMills.Cellfire||{};GeneralMills.Cellfire.Retailers=GeneralMills.Cellfire.Retailers||{};GeneralMills.Cellfire.Retailers.ViewModel=function(n,r,u){var f={};return f.settings=n,f.location=t.observable(),f.noLocation=t.observable(!1),f.loading=t.observable(!1),f.isInitialRetailerSearch=!0,f.errorLoadingRetailers=t.observable(!1),f.elevatedRetailers=t.observableArray(),f.savedRetailers=t.observableArray(),f.nearbyRetailers=t.observableArray(),f.noNearbyRetailers=t.observable(!1),f.otherRetailers=t.observableArray(),f.elevatedOffer=t.observable(),f.elevatedOfferError=t.observable(u),f.cellfireLocationCookieName="cellfire.location",f.dealsNearMeLocationCookieName="DNMselectedZipCode",f.offerItem=function(n){var i={};return i.offerId=n.OfferId,i.faceValue=n.FaceValue,i.brandName=n.BrandName,i.imageUrl=n.ImageUrl,i.description=GeneralMills.Cellfire.Utilities.getShortDescriptionFromDescription(n.Description,n.LongDescription),i.longDescription=GeneralMills.Cellfire.Utilities.getRemainderDescriptionFromDescription(n.Description,n.LongDescription),i.showLongDescription=t.observable(!1),i.moreButtonText=t.computed(function(){return i.showLongDescription()?f.settings.ShowLessText:f.settings.ShowMoreText}),i.toggleLongDescription=function(){i.showLongDescription(!i.showLongDescription())},i.name=n.Name,i},r&&f.elevatedOffer(f.offerItem(r)),f.getLocation=function(){f.loading(!0);GeneralMills.Cellfire.Utilities.getCookie(f.cellfireLocationCookieName)?(f.location(GeneralMills.Cellfire.Utilities.getCookie(f.cellfireLocationCookieName)),f.getRetailers()):GeneralMills.Cellfire.Utilities.getCookie(f.dealsNearMeLocationCookieName)?(f.location(GeneralMills.Cellfire.Utilities.getCookie(f.dealsNearMeLocationCookieName)),f.getRetailers()):f.settings.DetectLocation?GeneralMills.Geolocation.getZipCode(f.onDetectLocationComplete):(f.noLocation(!0),f.getRetailers())},f.onDetectLocationComplete=function(n){n&&f.location(n);f.getRetailers()},f.updateLocationCookies=function(n){n&&GeneralMills.Cellfire.Utilities.setCookie(f.cellfireLocationCookieName,n);/^\d{5}$/.test(n)&&GeneralMills.Cellfire.Utilities.setCookie(f.dealsNearMeLocationCookieName,n)},f.getRetailers=function(){f.loading(!0);f.errorLoadingRetailers(!1);f.noLocation(!1);f.noNearbyRetailers(!1);var n={location:f.location(),elevatedOfferId:f.elevatedOffer()?f.elevatedOffer().offerId:""};GeneralMills.Cellfire.Utilities.getJson("/api/retailers",n,f.onGetRetailersSuccess,f.onGetRetailersError);f.isInitialRetailerSearch||GeneralMills.Analytics.raiseEvent({EventType:"RetailerSearch",SiteSearchPhrase:f.location()});f.isInitialRetailerSearch=!1},f.onGetRetailersSuccess=function(n){f.updateLocationCookies(f.location());f.loading(!1);f.errorLoadingRetailers(!1);f.savedRetailers.removeAll();f.nearbyRetailers.removeAll();f.otherRetailers.removeAll();f.elevatedRetailers.removeAll();for(var t=0;t<n.length;t++)n[t].hasElevatedOffer&&f.elevatedRetailers.push(n[t]),n[t].saved?f.savedRetailers.push(n[t]):n[t].nearby?f.nearbyRetailers.push(n[t]):f.otherRetailers.push(n[t]);f.location()?f.nearbyRetailers().length===0&&f.noNearbyRetailers(!0):f.noLocation(!0);f.savedRetailers.sort(f.compareRetailerNames);f.nearbyRetailers.sort(f.compareRetailerNames);f.otherRetailers.sort(f.compareRetailerNames);f.elevatedRetailers.sort(f.compareRetailerNames)},f.onGetRetailersError=function(){f.loading(!1);f.errorLoadingRetailers(!0)},f.selectRetailer=function(n){GeneralMills.Cellfire.Utilities.setCookie(f.settings.SelectedRetailerCookieName,n.id);var t={EventType:"RetailerSelect",RetailerId:n.id,RetailerName:n.name};(f.elevatedOffer()||f.elevatedOfferError())&&(t.EventType="RetailerSelectDEC");GeneralMills.Analytics.raiseEvent(t);i.setTimeout(function(){GeneralMills.Cellfire.Utilities.setDocumentLocationHref(f.settings.OffersPage)},GeneralMills.Cellfire.Constants.delayInMillisecondsBeforeRedirecting)},f.compareRetailerNames=function(n,t){return n.name.toLowerCase().localeCompare(t.name.toLowerCase())},f};GeneralMills.Cellfire.Retailers.initialize=function(n,r,u,f){var e=GeneralMills.Cellfire.Retailers.ViewModel(n,u,f);t.applyBindings(e,i.document.getElementById(r));e.getLocation()}}(jQuery,ko,window),function(n,t,i,r){r.GeneralMills=r.GeneralMills||{};GeneralMills.Cellfire=GeneralMills.Cellfire||{};GeneralMills.Cellfire.AddCardModal=function(){var i={};return i.Constants={domElementId:"cellfireAddCardModal"},i.ViewModel=function(n){var u={};return u.settings=n,u.loyaltyValue1=t.observable(),u.loyaltyValue2=t.observable(),u.addCardError=t.observable(!1),u.cardAdded=t.observable(!1),u.loading=t.observable(!1),u.addCard=function(){var n,t;if(u.addCardError(!1),u.loading(!0),n=GeneralMills.Cellfire.Utilities.validateLoyaltyCardValues(u.settings.Retailer,u.loyaltyValue1(),u.loyaltyValue2()),!n||n.length===0){u.onAddCardError();return}t=GeneralMills.Cellfire.Utilities.createLoyaltyCard(u.settings.Retailer,n);GeneralMills.Cellfire.Utilities.postJson("/api/card/add",JSON.stringify(t),u.onAddCardSuccess,u.onAddCardError)},u.onAddCardSuccess=function(){u.cardAdded(!0);u.loading(!1);GeneralMills.Analytics.raiseEvent({EventType:"AddCard",RetailerId:[i.settings.Retailer.Id.toString()],RetailerName:[i.settings.Retailer.Name]})},u.onAddCardError=function(){u.addCardError(!0);u.loading(!1)},u.closeDialog=function(){u.dialog.close();GeneralMills.Analytics.raiseEvent({EventType:"ConfirmCard",RetailerId:[i.settings.Retailer.Id.toString()],RetailerName:[i.settings.Retailer.Name]})},u.onDialogClose=function(){u.cardAdded()?r.setTimeout(function(){i.reload()},500):(GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.addToCardCookie),GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.addingCardCookie),GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.preclipCookie))},u.getCssClass=function(n){return GeneralMills.Cellfire.Utilities.getLoyaltyCardCssClass(n)},u.getInputType=function(n){return GeneralMills.Cellfire.Utilities.getLoyaltyCardInputType(n)},u.dialog=GeneralMills.Cellfire.AddCardModal.createDialog(i.Constants.domElementId,u.onDialogClose),u},i.createDialog=function(t,i){var r=n("#"+t),f=r.data(),u=r.dialog(f);if(typeof i=="function")r.on("dialogclose",i);return u.open=function(){u.dialog("open")},u.close=function(){u.dialog("close")},r.parent().find(".ui-dialog-titlebar .ui-dialog-titlebar-close").attr("id","gmi_cf_"+r.dialog("option","dialogClass")+"_closeButton"),u},i.reload=function(){document.location.reload()},i.getCurrentUrl=function(){return document.location.href},i.open=function(){GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.addingCardCookie);r.setTimeout(function(){i.viewModelInstance.dialog.open()},1500)},i.initialize=function(n){i.settings=n;i.viewModelInstance=GeneralMills.Cellfire.AddCardModal.ViewModel(n);t.applyBindings(i.viewModelInstance,r.document.getElementById(i.Constants.domElementId))},i}()}(jQuery,ko,reg,window),function(n,t,i){function u(n,t,i){var u=n+"?overrideRedirect=true";return t!=r&&(u+="&contentId="+t),i!="0"&&(u+="&offerId="+i),u}function f(){var t=function(){var t=n(".offersFooter"),i=n(".offer:first");t.show();t.toggle(GeneralMills.Cellfire.Utilities.isTopOfElementABelowBottomOfElementB(t,i))};t();n(i).on("scroll",function(){GeneralMills.Cellfire.Utilities.debounce(t(),80)})}i.GeneralMills=i.GeneralMills||{};GeneralMills.Cellfire=GeneralMills.Cellfire||{};GeneralMills.Cellfire.Offers=GeneralMills.Cellfire.Offers||{};var r="00000000-0000-0000-0000-000000000000";GeneralMills.Cellfire.Offers.ViewModel=function(f,e,o,s,h,c,l){var a={},p={},v,y;return a.offersList=t.observableArray([]),a.elevatedCoupon=t.observable(),a.settings=f,a.showMoreText=f.ShowMoreText,a.showLessText=f.ShowLessText,a.currency=f.Currency,a.version=f.Version,a.myAccountPage=f.MyAccountPage,a.thankYouPage=f.ThankYouPage,a.elevatedCouponNotFound=t.observable(l),a.cellfireError=s,a.onTooltipClick=function(n,t){t.stopImmediatePropagation();GeneralMills.Cellfire.Utilities.elementExists(".tooltip-help")?(n.tooltip("close"),n.removeClass("tooltip-open")):(n.tooltip("open"),n.addClass("tooltip-open"))},n(".retailer-help-icon").tooltip({content:f.RetailerHelpTooltipText,items:"span",show:!1,tooltipClass:"tooltip-help retailer-tooltip-help"}),n(".footer-help-icon .help-icon").tooltip({content:f.FooterHelpTooltipText,items:"span",show:!1,tooltipClass:"tooltip-help footer-tooltip-help"}),a.shouldPreclip=function(){return GeneralMills.Cellfire.Utilities.getCookie(GeneralMills.Cellfire.Constants.preclipCookie)!=null},a.shouldAddCard=function(){return GeneralMills.Cellfire.Utilities.getCookie(GeneralMills.Cellfire.Constants.addingCardCookie)},a.shouldAddToCard=function(){return GeneralMills.Cellfire.Utilities.getCookie(GeneralMills.Cellfire.Constants.addToCardCookie)},a.preclip=function(n,t){t===a.version&&a.offersList().forEach(function(t){n.some(function(n){return t.couponId===n})&&t.state()===f.AvailableState&&t.state(f.ClippedState)})},a.setPreclipCookie=function(){var n={CouponIdsToAdd:a.user.clippedOffers().map(function(n){return n.couponId}),Version:a.version};GeneralMills.Cellfire.Utilities.setCookie(GeneralMills.Cellfire.Constants.preclipCookie,JSON.stringify(n))},a.setSavingCardToProfileCookie=function(){var n=a.user.temporarySessionProfileId();if(!n)throw new Error("Unable to upgrade profile without existing session profile id.");GeneralMills.Cellfire.Utilities.setCookie(GeneralMills.Cellfire.Constants.upgradeAnonymousToProfile,n)},a.initFromCookies=function(){if(a.shouldPreclip()){var n=JSON.parse(GeneralMills.Cellfire.Utilities.getCookie(GeneralMills.Cellfire.Constants.preclipCookie));a.preclip(n.CouponIdsToAdd,n.Version);a.user.hasCard()&&GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.preclipCookie)}a.shouldAddCard()&&GeneralMills.Cellfire.AddCardModal?GeneralMills.Cellfire.AddCardModal.open():a.shouldAddToCard()&&(GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.addToCardCookie),a.user.addToCard())},a.user=function(){var n={};return n.addToCardButtonText=f.AddToCardButtonText,n.cardNumberPretext=f.CardNumberPretext,n.cardNumber=t.observable(f.CardNumber),n.totalSavingsText=f.TotalUserSavingsText,n.totalClippedText=f.TotalUserClippedText,n.clippedOffers=t.computed(function(){return t.utils.arrayFilter(a.offersList(),function(n){return n.state()===f.ClippedState})}),n.totalSavings=t.computed(function(){var i=0;return t.utils.arrayForEach(n.clippedOffers(),function(n){i+=n.faceValue}),i}),n.addToCard=function(){var t={CouponIdsToAdd:n.clippedOffers().map(function(n){return n.couponId}),Version:a.version};if(t.CouponIdsToAdd.length>0){if(!n.cardNumber()){GeneralMills.Cellfire.Utilities.setCookie(GeneralMills.Cellfire.Constants.preclipCookie,JSON.stringify(t));GeneralMills.Cellfire.Utilities.setCookie(GeneralMills.Cellfire.Constants.addToCardCookie,1);GeneralMills.Cellfire.AddCardModal.open();return}GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.preclipCookie);GeneralMills.Cellfire.Utilities.postJson("/api/Offers/AddToCard",JSON.stringify(t),n.onClipSuccess)}},n.hasCard=function(){return n.cardNumber()},n.isAuthenticated=t.computed(function(){return GeneralMills.Cellfire.Utilities.isLoggedIn()}),n.temporarySessionProfileId=function(){return GeneralMills.Cellfire.Utilities.getCookie(GeneralMills.Cellfire.Constants.anonymousSessionProfileId)},n.onClipSuccess=function(t){var r,u;t.status==="Error"?(a.thankYou.toggle(),a.thankYou.clipMessage(t.message),a.thankYou.clipFailed(!0)):t.status==="Success"?(a.thankYou.clipFailed(!1),r={DisplayType:"CouponGallery",EventType:"AddCoupon",RetailerId:[a.settings.MerchantId.toString()],RetailerName:[a.settings.RetailerName],CouponBrandName:n.clippedOffers().map(function(n){return n.brandName}),CouponId:n.clippedOffers().map(function(n){return n.couponId.toString()}),OfferId:n.clippedOffers().map(function(n){return n.offerId.toString()}),OfferCode:n.clippedOffers().map(function(n){return n.offerCode}),CouponOfferCount:n.clippedOffers().length},a.elevatedCoupon()&&(u=n.clippedOffers().filter(function(n){return n.offerId===a.elevatedCoupon().offerId||n.contentId===a.elevatedCoupon().contentId}).length>0,u&&(r.EventType="AddCouponDEC")),GeneralMills.Analytics.raiseEvent(r),i.setTimeout(function(){GeneralMills.Cellfire.Utilities.setDocumentLocationHref(a.thankYouPage)},500)):t.status==="Reload"&&GeneralMills.Cellfire.Utilities.reloadPage()},n}(),a.thankYou=function(){var n={};return n.returnToOffersText=f.ReturnToOffersText,n.show=t.observable(!1),n.toggle=function(){n.show(!n.show())},n.clipMessage=t.observable(""),n.clipFailed=t.observable(!1),n.clipFailedText=f.ClipFailedText,n.reloadPage=GeneralMills.Cellfire.Utilities.reloadPage,n.helpText=f.ThankYouHelpLinkText,n.helpUrl=f.ThankYouHelpLinkUrl,n}(),a.retailer=function(){var n={};return n.addCardText=f.AddLoyaltyCardButtonText,n.totalOffersText=f.TotalRetailerCouponsText,n.changeRetailerText=f.ChangeRetailerText,n.changeRetailerUrl=u(f.RetailerSelectionPage,h,c),n.retailerName=o.Name,n.imageUrl=o.Image,n.loyaltyCardImage=o.CardImage,n.editCardNumberText=f.EditCardNumberText,n.saveCardToProfileText=f.SaveCardToProfileText,n.addStoreText=f.AddLoyaltyCardHelperText,n.totalSavingsText=f.TotalRetailerSavingsText,n.totalSavings=t.computed(function(){var n=0;return t.utils.arrayForEach(a.offersList(),function(t){n+=t.faceValue}),n}),n.addCard=function(){GeneralMills.Cellfire.AddCardModal.open()},n.openRegistrationDialog=function(){if(!a.user.isAuthenticated()){a.setPreclipCookie();a.setSavingCardToProfileCookie();var n={returnUrl:GeneralMills.Cellfire.Utilities.getCurrentUrl(),isRegistrationFirstStep:!1,RegAction:"COUPON"};reg.userRegistration.openRegistrationDialog(n)}},n}(),p.offerViewModel=function(n){var i={};return i.couponId=n.CouponId,i.offerId=n.OfferId,i.offerCode=n.OfferCode,i.state=t.observable(n.State),i.buttonText=t.computed(function(){return i.state()===f.AddedToCardState?f.AddedToCardText:i.state()===f.AvailableState?f.AvailableText:i.state()===f.ClippedState?f.ClippedText:void 0}),i.buttonPrefix=t.computed(function(){return i.state()===f.AddedToCardState?f.ControlIds.AddedToCardPrefix:i.state()===f.AvailableState?f.ControlIds.AvailablePrefix:i.state()===f.ClippedState?f.ControlIds.ClippedPrefix:void 0}),i.stateText=t.computed(function(){return i.state()===f.AddedToCardState?"addedToCard":i.state()===f.AvailableState?"available":i.state()===f.ClippedState?"clipped":void 0}),i.faceValue=n.FaceValue,i.brandName=n.BrandName,i.imageUrl=n.ImageUrl,i.description=GeneralMills.Cellfire.Utilities.getShortDescriptionFromDescription(n.Description,n.LongDescription),i.longDescription=GeneralMills.Cellfire.Utilities.getRemainderDescriptionFromDescription(n.Description,n.LongDescription),i.showLongDescription=t.observable(!1),i.moreButtonText=t.computed(function(){return i.showLongDescription()?a.showLessText:a.showMoreText}),i.toggleLongDescription=function(){i.showLongDescription(!i.showLongDescription())},i.clip=function(){i.state()===f.AvailableState?i.state(f.ClippedState):i.state()===f.ClippedState&&i.state(f.AvailableState)},i.expiryDate=new Date(n.ExpiryDate).toDateString(),i.expiryDateText=f.ExpiryDateText,i.displayBeforeDate=new Date(n.DisplayBeforeDate).toDateString(),i.displayBeforeDateText=f.DisplayBeforeDateText,i.beforeRetailerText=f.BeforeRetailerText,i.name=n.Name,i.contentId=n.ContentId,i},t.utils.arrayForEach(e,function(n){a.offersList.push(p.offerViewModel(n))}),c!=="0"&&l===""?(v=t.utils.arrayFirst(a.offersList(),function(n){return n.offerId.toString()===c}),v&&v.state()===f.AvailableState&&v.state(f.ClippedState),a.elevatedCoupon(v)):h!=null&&h!==r&&l===""&&(y=t.utils.arrayFirst(a.offersList(),function(n){return n.contentId===h}),y&&y.state()===f.AvailableState&&y.state(f.ClippedState),a.elevatedCoupon(y)),a};GeneralMills.Cellfire.Offers.initializeTooltipEvents=function(){n(".help-icon").off().on("click",function(t){i.GeneralMills.Cellfire.Offers.vm.onTooltipClick(n(this),t);n(".retailer-tooltip-help .ui-tooltip-content").attr("id","gmi_cf_offers_retailerHelp_tooltip");n(".footer-tooltip-help .ui-tooltip-content").attr("id","gmi_cf_offers_footerHelp_tooltip")}).on("mouseleave",function(n){n.stopImmediatePropagation()});n(document).on("click",function(){n(".tooltip-help").length&&(n(".help-icon").tooltip("close"),n(".help-icon").removeClass("tooltip-open"))})};GeneralMills.Cellfire.Offers.initialize=function(n,r,u,f,e,o,s,h){var l=GeneralMills.Cellfire.Offers.ViewModel(n,u,f,e,o,s,h),v,c;for(t.applyBindings(l,i.document.getElementById(r)),i.GeneralMills.Cellfire.Offers.vm=l,GeneralMills.Cellfire.Offers.initializeTooltipEvents(),l.initFromCookies(),v=l.offersList(),c=0;c<v.length;){var y=v.length-c,p=y<10?y:10,a=v.slice(c,c+p);GeneralMills.Analytics.raiseEvent({DisplayType:"CouponGallery",EventType:"ViewCoupon",RetailerId:[l.settings.MerchantId.toString()],RetailerName:[l.settings.RetailerName],CouponBrandName:a.map(function(n){return n.brandName}),CouponId:a.map(function(n){return n.couponId.toString()}),OfferId:a.map(function(n){return n.offerId.toString()}),OfferCode:a.map(function(n){return n.offerCode}),CouponOfferCount:a.length});c=c+p}};document.addEventListener("DOMContentLoaded",f)}(jQuery,ko,window),function(n,t,i){i.GeneralMills=i.GeneralMills||{};GeneralMills.Cellfire=GeneralMills.Cellfire||{};GeneralMills.Cellfire.ManageCards=GeneralMills.Cellfire.ManageCards||{};GeneralMills.Cellfire.ManageCards.ViewModel=function(n,i,r,u){var f={};return f.settings=n,f.cards=r&&r.length!=0?t.observableArray(r):t.observableArray([]),f.cardsPendingRemoval=t.observableArray(),f.enteringCard=t.observable(!1),f.selectedRetailer=t.observable(),f.loyaltyValue1=t.observable(),f.loyaltyValue2=t.observable(),f.addCardError=t.observable(!1),f.removeCardError=t.observable(!1),f.loading=t.observable(!1),f.cellfireError=u,f.retailers=i&&i.length!=0?t.observableArray(i):t.observableArray([]),f.unusedRetailers=t.computed(function(){return t.utils.arrayFilter(f.retailers(),function(n){return!f.cards().some(function(t){return t.MerchantId.toString()===n.Id.toString()})})}),f.selectedRetailerHasMultipleValidationFields=function(){if(f.selectedRetailer())return f.selectedRetailer().HasMultipleValidationFields},f.primaryValidationFieldCssClass=function(){if(f.selectedRetailer())return GeneralMills.Cellfire.Utilities.getLoyaltyCardCssClass(f.selectedRetailer().PrimaryValidationFieldType)},f.primaryValidationFieldInputType=function(){if(f.selectedRetailer())return GeneralMills.Cellfire.Utilities.getLoyaltyCardInputType(f.selectedRetailer().PrimaryValidationFieldId)},f.primaryValidationFieldName=function(){if(f.selectedRetailer())return f.selectedRetailer().PrimaryValidationFieldName},f.secondaryValidationFieldCssClass=function(){if(f.selectedRetailer())return GeneralMills.Cellfire.Utilities.getLoyaltyCardCssClass(f.selectedRetailer().SecondaryValidationFieldType)},f.secondaryValidationFieldInputType=function(){if(f.selectedRetailer())return GeneralMills.Cellfire.Utilities.getLoyaltyCardInputType(f.selectedRetailer().SecondaryValidationFieldId)},f.secondaryValidationFieldName=function(){if(f.selectedRetailer())return f.selectedRetailer().SecondaryValidationFieldName},f.enterCard=function(){f.enteringCard(!0)},f.addCard=function(){var n,t,i;if(f.selectedRetailer()){if(f.addCardError(!1),f.loading(!0),n=GeneralMills.Cellfire.Utilities.validateLoyaltyCardValues(f.selectedRetailer(),f.loyaltyValue1(),f.loyaltyValue2()),!n||n.length==0){f.onAddCardError();return}t=GeneralMills.Cellfire.Utilities.createLoyaltyCard(f.selectedRetailer(),n);i=function(){f.onAddCardSuccess(t)};GeneralMills.Cellfire.Utilities.postJson("/api/card/add",JSON.stringify(t),i,f.onAddCardError)}},f.onAddCardSuccess=function(n){GeneralMills.Analytics.raiseEvent({EventType:"AddCard",RetailerId:[f.selectedRetailer().Id.toString()],RetailerName:[f.selectedRetailer().Name]});GeneralMills.Analytics.raiseEvent({EventType:"ProfileUpdate"});f.cards.push(n);f.loading(!1);f.enteringCard(!1);f.selectedRetailer(undefined);f.loyaltyValue1("");f.loyaltyValue2("")},f.onAddCardError=function(){f.addCardError(!0);f.loading(!1)},f.cardIsPendingRemoval=function(n){return f.cardsPendingRemoval().indexOf(n)>=0},f.removeCard=function(n){f.cardsPendingRemoval.push(n)},f.cancelRemoveCard=function(n){f.cardsPendingRemoval.remove(n)},f.confirmRemoveCard=function(n){f.removeCardError(!1);f.loading(!0);var t=function(){f.onRemoveCardSuccess(n)};GeneralMills.Cellfire.Utilities.postJson("/api/card/remove",JSON.stringify(n),t,f.onRemoveCardError)},f.onRemoveCardSuccess=function(n){GeneralMills.Analytics.raiseEvent({EventType:"ProfileUpdate"});f.cards.remove(n);f.loading(!1)},f.onRemoveCardError=function(){f.removeCardError(!0);f.loading(!1)},f};GeneralMills.Cellfire.ManageCards.initialize=function(n,r,u,f,e){var o=GeneralMills.Cellfire.ManageCards.ViewModel(n,r,u,e);t.applyBindings(o,i.document.getElementById(f))}}(jQuery,ko,window),function(n,t,i){i.GeneralMills=i.GeneralMills||{};GeneralMills.Cellfire=GeneralMills.Cellfire||{};GeneralMills.Cellfire.ThankYou=GeneralMills.Cellfire.ThankYou||{};GeneralMills.Cellfire.ThankYou.ViewModel=function(n){var t={};return t.settings=n,t.recipeReturnUrl=GeneralMills.Cellfire.Utilities.getCookie(GeneralMills.Cellfire.Constants.recipeReturnUrlCookie),GeneralMills.Cellfire.Utilities.clearCookie(GeneralMills.Cellfire.Constants.recipeReturnUrlCookie),t};GeneralMills.Cellfire.ThankYou.initialize=function(n,r){var u=GeneralMills.Cellfire.ThankYou.ViewModel(n);t.applyBindings(u,i.document.getElementById(r));i.GeneralMills.Cellfire.ThankYou.vm=u}}(jQuery,ko,window),function(n,t,i){i.SubscriptionCenter=function(r){var u=this;this.serviceEndpoints={SIGN_OUT:"/Shared/MyAccount/Services/MyAccountService.svc/SignOut",UNSUBSCRIBE_ALL:"/Shared/MyAccount/Services/MyAccountService.svc/UnsubscribeToNewsletters"};this.newsletterViewModels=[];this.errorMessage=t.observable("");this.showUnsubscribeFromAllLink=t.observable(!0);this.showUnsubscribeFromAllVerification=t.observable(!1);this.showUnsubscribeFromAllConfirmation=t.observable(!1);this.showUnsubscribeFromAllTopLink=t.observable(!0);this.showUnsubscribeFromAllTopVerification=t.observable(!1);this.showUnsubscribeFromAllTopConfirmation=t.observable(!1);this.subscriberPosition=r.isEmbedded===!0?"MyAccount":"SubscriptionCtr";this.unsubscribeFromAll=function(t){var i=JSON.stringify({request:{Source:"MyAccount"}});n.ajax({url:u.serviceEndpoints.UNSUBSCRIBE_ALL,data:i,dataType:"json",contentType:"application/json; charset=UTF-8",type:"POST",success:u.onUnsubscribeFromAllSuccess(t),error:u.onRequestError})};this.onUnsubscribeFromAllSuccess=function(n){u.errorMessage("");i.Analytics.raiseEvent({EventType:"ProfileUpdate",SubscriberPosition:u.subscriberPosition});u.newsletterViewModels.forEach(function(n){n.userIsSubscribed(!1);n.resetSelectedDeliveryOption()});n?(u.closeUnsubscribeFromAllTopVerification(),u.openUnsubscribeFromAllTopConfirmation()):(u.closeUnsubscribeFromAllVerification(),u.openUnsubscribeFromAllConfirmation())};this.openUnsubscribeFromAllTopVerification=function(){this.showUnsubscribeFromAllTopVerification(!0);this.showUnsubscribeFromAllTopLink(!1)};this.closeUnsubscribeFromAllTopVerification=function(){this.showUnsubscribeFromAllTopVerification(!1);this.showUnsubscribeFromAllTopLink(!0)};this.openUnsubscribeFromAllTopConfirmation=function(){this.showUnsubscribeFromAllTopConfirmation(!0);this.showUnsubscribeFromAllTopLink(!1)};this.closeUnsubscribeFromAllTopConfirmation=function(){this.showUnsubscribeFromAllTopConfirmation(!1);this.showUnsubscribeFromAllTopLink(!0)};this.openUnsubscribeFromAllVerification=function(){this.showUnsubscribeFromAllVerification(!0);this.showUnsubscribeFromAllLink(!1)};this.closeUnsubscribeFromAllVerification=function(){this.showUnsubscribeFromAllVerification(!1);this.showUnsubscribeFromAllLink(!0)};this.openUnsubscribeFromAllConfirmation=function(){this.showUnsubscribeFromAllConfirmation(!0);this.showUnsubscribeFromAllLink(!1)};this.closeUnsubscribeFromAllConfirmation=function(){this.showUnsubscribeFromAllConfirmation(!1);this.showUnsubscribeFromAllLink(!0)};this.notMeSignOut=function(){n.ajax({url:u.serviceEndpoints.SIGN_OUT,dataType:"json",contentType:"application/json; charset=UTF-8",type:"POST",success:u.onNotMeSignOutSuccess,error:u.onRequestError})};this.onNotMeSignOutSuccess=function(){r.window.location.href=r.promoUrl};this.onRequestError=function(n,t,i){u.errorMessage("An error occurred, please try again: "+i)};this.showErrorMessage=t.computed(function(){return u.errorMessage()!==""});r.newsletters.forEach(function(n){var t=new i.SubscriptionCenterNewsletter(n,u.subscriberPosition);u.newsletterViewModels.push(t)});t.applyBindings(u,r.subCenterElement)};i.SubscriptionCenterNewsletter=function(r,u){var f=this,e=r.ListId;this.serviceEndpoints={UNSUBSCRIBE:"/Shared/MyAccount/Services/MyAccountService.svc/UnsubscribeToNewsletter",UPDATE_SUBSCRIPTION:"/Shared/MyAccount/Services/MyAccountService.svc/UpdateNewsletterSubscription"};this.errorMessage=t.observable("");this.name=r.Name;this.thumbnailImage=r.ThumbnailImagePath;this.description=r.Description;this.previewUrl=r.PreviewUrl;this.showPreviewLink=r.PreviewUrl!=="";this.userIsSubscribed=t.observable(r.UserIsSubscribed);this.subscribeButtonText=r.SubscribeButtonText;this.deliveryOptions=r.DeliveryOptions||[];this.showDeliveryOptions=r.DeliveryOptions&&r.DeliveryOptions.length>0;this.hasValidDeliveryOption=this.deliveryOptions.filter(function(n){return n.ProfileDeliveryCode===r.SubscribedDeliveryOption}).length>0;this.selectedDeliveryOption=t.observable(r.SubscribedDeliveryOption);this.showUnsubscribeConfirmation=t.observable(!1);this.showDeliveryOptionConfirmation=t.observable(!1);this.deliveryOptionConfirmationMessage=t.observable("");this.subscribe=function(){var t=JSON.stringify({request:{NewsletterGuid:e}});n.ajax({url:f.serviceEndpoints.UPDATE_SUBSCRIPTION,data:t,dataType:"json",contentType:"application/json; charset=UTF-8",type:"POST",success:f.onSubscribeSuccess,error:f.onRequestError})};this.onSubscribeSuccess=function(){f.errorMessage("");i.Analytics.raiseEvent({EventType:"ProfileUpdate",SubscriberPosition:u});i.Analytics.raiseEvent({EventType:"NewsletterOptIn",NewsletterTitle:[f.name],NewsletterId:[e],SubscriberPosition:u});f.userIsSubscribed(!0)};this.unsubscribe=function(){var t=JSON.stringify({request:{NewsletterGuid:e,Source:"MyAccount"}});n.ajax({url:f.serviceEndpoints.UNSUBSCRIBE,data:t,dataType:"json",contentType:"application/json; charset=UTF-8",type:"POST",success:f.onUnsubscribeSuccess,error:f.onRequestError})};this.onUnsubscribeSuccess=function(){f.errorMessage("");i.Analytics.raiseEvent({EventType:"ProfileUpdate",SubscriberPosition:u});f.resetSelectedDeliveryOption();f.userIsSubscribed(!1);f.showUnsubscribeConfirmation(!0)};this.resetSelectedDeliveryOption=function(){f.showDeliveryOptions&&f.selectedDeliveryOption(r.DeliveryOptions[0].ProfileDeliveryCode)};this.updateDeliveryOption=function(){if(f.selectedDeliveryOption()&&f.userIsSubscribed()&&(f.hasValidDeliveryOption||!(f.deliveryOptions.length>0)||f.selectedDeliveryOption()!==f.deliveryOptions[0].ProfileDeliveryCode)){this.hasValidDeliveryOption=!0;var t=f.selectedDeliveryOption(),i=JSON.stringify({request:{NewsletterGuid:e,DeliveryOption:t}});n.ajax({url:f.serviceEndpoints.UPDATE_SUBSCRIPTION,data:i,dataType:"json",contentType:"application/json; charset=UTF-8",type:"POST",success:f.onUpdateDeliveryOptionSuccess,error:f.onRequestError})}};this.onUpdateDeliveryOptionSuccess=function(){f.errorMessage("");i.Analytics.raiseEvent({EventType:"ProfileUpdate",SubscriberPosition:u,FrequencyChange:f.selectedDeliveryOption()});f.showDeliveryOptionConfirmation(!0)};this.closeUnsubscribeConfirmation=function(){f.showUnsubscribeConfirmation(!1)};this.closeDeliveryOptionConfirmation=function(){f.showDeliveryOptionConfirmation(!1)};this.onRequestError=function(n,t,i){f.errorMessage("An error occurred, please try again: "+i)};this.showErrorMessage=t.computed(function(){return f.errorMessage()!==""});t.computed(function(){var n=f.selectedDeliveryOption();f.deliveryOptions.forEach(function(t){t.ProfileDeliveryCode===n&&f.deliveryOptionConfirmationMessage(t.UpdateMessage)})})}}(jQuery,ko,window.GeneralMills||(window.GeneralMills={}));jaaulde=window.jaaulde||{};jaaulde.utils=jaaulde.utils||{};jaaulde.utils.cookies=function(){var i,u,r,n,t={expiresAt:null,path:"/",domain:null,secure:!1};return i=function(n){var i,r;return typeof n!="object"||n===null?i=t:(i={expiresAt:t.expiresAt,path:t.path,domain:t.domain,secure:t.secure},typeof n.expiresAt=="object"&&n.expiresAt instanceof Date?i.expiresAt=n.expiresAt:typeof n.hoursToLive=="number"&&n.hoursToLive!==0&&(r=new Date,r.setTime(r.getTime()+n.hoursToLive*36e5),i.expiresAt=r),typeof n.path=="string"&&n.path!==""&&(i.path=n.path),typeof n.domain=="string"&&n.domain!==""&&(i.domain=n.domain),n.secure===!0&&(i.secure=n.secure)),i},u=function(n){return n=i(n),(typeof n.expiresAt=="object"&&n.expiresAt instanceof Date?"; expires="+n.expiresAt.toGMTString():"")+"; path="+n.path+(typeof n.domain=="string"?"; domain="+n.domain:"")+(n.secure===!0?"; secure":"")},r=function(){for(var r={},i,u,n,f=document.cookie.split(";"),e,t=0;t<f.length;t=t+1){i=f[t].split("=");u=i[0].replace(/^\s*/,"").replace(/\s*$/,"");try{n=decodeURIComponent(i[1])}catch(o){n=i[1]}if(typeof JSON=="object"&&JSON!==null&&typeof JSON.parse=="function")try{e=n;n=JSON.parse(n)}catch(s){n=e}r[u]=n}return r},n=function(){},n.prototype.get=function(n){var t,u,i=r();if(typeof n=="string")t=typeof i[n]!="undefined"?i[n]:null;else if(typeof n=="object"&&n!==null){t={};for(u in n)t[n[u]]=typeof i[n[u]]!="undefined"?i[n[u]]:null}else t=i;return t},n.prototype.filter=function(n){var t,i={},u=r();typeof n=="string"&&(n=new RegExp(n));for(t in u)t.match(n)&&(i[t]=u[t]);return i},n.prototype.set=function(n,t,i){if((typeof i!="object"||i===null)&&(i={}),typeof t=="undefined"||t===null)t="",i.hoursToLive=-8760;else if(typeof t!="string")if(typeof JSON=="object"&&JSON!==null&&typeof JSON.stringify=="function")t=JSON.stringify(t);else throw new Error("cookies.set() received non-string value and could not serialize.");var r=u(i);document.cookie=n+"="+encodeURIComponent(t)+r},n.prototype.del=function(n,t){var r={},i;(typeof t!="object"||t===null)&&(t={});typeof n=="boolean"&&n===!0?r=this.get():typeof n=="string"&&(r[n]=!0);for(i in r)typeof i=="string"&&i!==""&&this.set(i,null,t)},n.prototype.test=function(){var t=!1,n="cT",i="data";return this.set(n,i),this.get(n)===i&&(this.del(n),t=!0),t},n.prototype.setOptions=function(n){typeof n!="object"&&(n=null);t=i(n)},new n}(),function(){window.jQuery&&function(n){n.cookies=jaaulde.utils.cookies;var t={cookify:function(t){return this.each(function(){var f,e=["name","id"],u,i=n(this),r;for(f in e)if(!isNaN(f)&&(u=i.attr(e[f]),typeof u=="string"&&u!=="")){i.is(":checkbox, :radio")?i.attr("checked")&&(r=i.val()):r=i.is(":input")?i.val():i.html();(typeof r!="string"||r==="")&&(r=null);n.cookies.set(u,r,t);break}})},cookieFill:function(){return this.each(function(){for(var u,e=["name","id"],r,t=n(this),i,f=function(){return u=e.pop(),!!u};f();)if(r=t.attr(u),typeof r=="string"&&r!==""){i=n.cookies.get(r);i!==null&&(t.is(":checkbox, :radio")?t.val()===i?t.attr("checked","checked"):t.removeAttr("checked"):t.is(":input")?t.val(i):t.html(i));break}})},cookieBind:function(t){return this.each(function(){var i=n(this);i.cookieFill().change(function(){i.cookify(t)})})}};n.each(t,function(t){n.fn[t]=this})}(window.jQuery)}(),function(n){var t=0;n.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{}},_create:function(){var t=this.element.hide(),i=this.options,r;this.speed=n.fx.speeds._default;this._isOpen=!1;t=(this.button=n('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"><\/span><\/button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(i.classes).attr({title:t.attr("title"),"aria-haspopup":!0,tabIndex:t.attr("tabIndex")}).insertAfter(t);(this.buttonlabel=n("<span />")).html(i.noneSelectedText).appendTo(t);t=(this.menu=n("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(i.classes).appendTo(document.body);r=(this.header=n("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(t);(this.headerLinkContainer=n("<ul />")).addClass("ui-helper-reset").html(function(){return!0===i.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"><\/span><span>'+i.checkAllText+'<\/span><\/a><\/li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"><\/span><span>'+i.uncheckAllText+"<\/span><\/a><\/li>":"string"==typeof i.header?"<li>"+i.header+"<\/li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"><\/span><\/a><\/li>').appendTo(r);(this.checkboxContainer=n("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(t);this._bindEvents();this.refresh(!0);i.multiple||t.addClass("ui-multiselect-single")},_init:function(){!1===this.options.header&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(i){var u=this.element,f=this.options,s=this.menu,h=this.checkboxContainer,e=[],r="",o=u.attr("id")||t++;u.find("option").each(function(t){n(this);var u=this.parentNode,c=this.innerHTML,a=this.title,v=this.value,t="ui-multiselect-"+(this.id||o+"-option-"+t),s=this.disabled,l=this.selected,h=["ui-corner-all"],y=(s?"ui-multiselect-disabled ":" ")+this.className,i;"OPTGROUP"===u.tagName&&(i=u.getAttribute("label"),-1===n.inArray(i,e)&&(r+='<li class="ui-multiselect-optgroup-label '+u.className+'"><a href="#">'+i+"<\/a><\/li>",e.push(i)));s&&h.push("ui-state-disabled");l&&!f.multiple&&h.push("ui-state-active");r+='<li class="'+y+'">';r+='<label for="'+t+'" title="'+a+'" class="'+h.join(" ")+'">';r+='<input id="'+t+'" name="multiselect_'+o+'" type="'+(f.multiple?"checkbox":"radio")+'" value="'+v+'" title="'+c+'"';l&&(r+=' checked="checked"',r+=' aria-selected="true"');s&&(r+=' disabled="disabled"',r+=' aria-disabled="true"');r+=" /><span>"+c+"<\/span><\/label><\/li>"});h.html(r);this.labels=s.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();i||this._trigger("refresh")},update:function(){var t=this.options,r=this.inputs,u=r.filter(":checked"),i=u.length,t=0===i?t.noneSelectedText:n.isFunction(t.selectedText)?t.selectedText.call(this,i,r.length,u.get()):/\d/.test(t.selectedList)&&0<t.selectedList&&i<=t.selectedList?u.map(function(){return n(this).next().html()}).get().join(", "):t.selectedText.replace("#",i).replace("#",r.length);return this.buttonlabel.html(t),t},_bindEvents:function(){function r(){return t[t._isOpen?"close":"open"](),!1}var t=this,i=this.button;i.find("span").bind("click.multiselect",r);i.bind({click:r,keypress:function(n){switch(n.which){case 27:case 38:case 37:t.close();break;case 39:case 40:t.open()}},mouseenter:function(){i.hasClass("ui-state-disabled")||n(this).addClass("ui-state-hover")},mouseleave:function(){n(this).removeClass("ui-state-hover")},focus:function(){i.hasClass("ui-state-disabled")||n(this).addClass("ui-state-focus")},blur:function(){n(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(i){n(this).hasClass("ui-multiselect-close")?t.close():t[n(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();i.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(i){i.preventDefault();var r=n(this),u=r.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),f=u.get(),r=r.parent().text();!1!==t._trigger("beforeoptgrouptoggle",i,{inputs:f,label:r})&&(t._toggleChecked(u.filter(":checked").length!==u.length,u),t._trigger("optgrouptoggle",i,{inputs:f,label:r,checked:f[0].checked}))}).delegate("label","mouseenter.multiselect",function(){n(this).hasClass("ui-state-disabled")||(t.labels.removeClass("ui-state-hover"),n(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(i){i.preventDefault();switch(i.which){case 9:case 27:t.close();break;case 38:case 40:case 37:case 39:t._traverse(i.which,this);break;case 13:n(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(i){var u=n(this),f=this.value,r=this.checked,e=t.element.find("option");this.disabled||!1===t._trigger("click",i,{value:f,text:this.title,checked:r})?i.preventDefault():(u.focus(),u.attr("aria-selected",r),e.each(function(){this.value===f?this.selected=r:t.options.multiple||(this.selected=!1)}),t.options.multiple||(t.labels.removeClass("ui-state-active"),u.closest("label").toggleClass("ui-state-active",r),t.close()),t.element.trigger("change"),setTimeout(n.proxy(t.update,t),10))});n(document).bind("mousedown.multiselect",function(i){!t._isOpen||n.contains(t.menu[0],i.target)||n.contains(t.button[0],i.target)||i.target===t.button[0]||t.close()});n(this.element[0].form).bind("reset.multiselect",function(){setTimeout(n.proxy(t.refresh,t),10)})},_setButtonWidth:function(){var n=this.element.outerWidth(),t=this.options;/\d/.test(t.minWidth)&&n<t.minWidth&&(n=t.minWidth);this.button.width(n)},_setMenuWidth:function(){var n=this.menu,t=this.button.outerWidth()-parseInt(n.css("padding-left"),10)-parseInt(n.css("padding-right"),10)-parseInt(n.css("border-right-width"),10)-parseInt(n.css("border-left-width"),10);n.width(t||this.button.outerWidth())},_traverse:function(t,i){var r=n(i),u=38===t||37===t,r=r.parent()[u?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[u?"last":"first"]();r.length?r.find("label").trigger("mouseover"):(r=this.menu.find("ul").last(),this.menu.find("label")[u?"last":"first"]().trigger("mouseover"),r.scrollTop(u?r.height():0))},_toggleState:function(n,t){return function(){this.disabled||(this[n]=t);t?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(t,i){var r=i&&i.length?i:this.inputs,f=this,u;r.each(this._toggleState("checked",t));r.eq(0).focus();this.update();u=r.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&-1<n.inArray(this.value,u)&&f._toggleState("selected",t).call(this)});r.length&&this.element.trigger("change")},_toggleDisabled:function(t){this.button.attr({disabled:t,"aria-disabled":t})[t?"addClass":"removeClass"]("ui-state-disabled");var i=this.menu.find("input"),i=t?i.filter(":enabled").data("ech-multiselect-disabled",!0):i.filter(function(){return!0===n.data(this,"ech-multiselect-disabled")}).removeData("ech-multiselect-disabled");i.attr({disabled:t,"arial-disabled":t}).parent()[t?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:t,"aria-disabled":t})},open:function(){var i=this.button,r=this.menu,f=this.speed,t=this.options,e=[];if(!(!1===this._trigger("beforeopen")||i.hasClass("ui-state-disabled")||this._isOpen)){var s=r.find("ul").last(),u=t.show,o=i.offset();n.isArray(t.show)&&(u=t.show[0],f=t.show[1]||this.speed);u&&(e=[u,f]);s.scrollTop(0).height(t.height);n.ui.position&&!n.isEmptyObject(t.position)?(t.position.of=t.position.of||i,r.show().position(t.position).hide()):r.css({top:o.top+i.outerHeight(),left:o.left});n.fn.show.apply(r,e);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");i.addClass("ui-state-active");this._isOpen=!0;this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var t=this.options,i=t.hide,r=this.speed,u=[];n.isArray(t.hide)&&(i=t.hide[0],r=t.hide[1]||this.speed);i&&(u=[i,r]);n.fn.hide.apply(this.menu,u);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){return n.Widget.prototype.destroy.call(this),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(t,i){var r=this.menu;switch(t){case"header":r.find("div.ui-multiselect-header")[i?"show":"hide"]();break;case"checkAllText":r.find("a.ui-multiselect-all span").eq(-1).text(i);break;case"uncheckAllText":r.find("a.ui-multiselect-none span").eq(-1).text(i);break;case"height":r.find("ul").last().height(parseInt(i,10));break;case"minWidth":this.options[t]=parseInt(i,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[t]=i;this.update();break;case"classes":r.add(this.button).removeClass(this.options.classes).addClass(i);break;case"multiple":r.toggleClass("ui-multiselect-single",!i);this.options.multiple=i;this.element[0].multiple=i;this.refresh()}n.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery)