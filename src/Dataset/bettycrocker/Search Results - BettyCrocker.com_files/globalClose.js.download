var RecipeStory,RecipeStoryReportAbuse;jQuery.noConflict(),function(n,t){GeneralMills=t.GeneralMills=t.GeneralMills||{};GeneralMills.PandoSites=GeneralMills.PandoSites||{};GeneralMills.PandoSites.SimpleNavigationChild=GeneralMills.PandoSites.SimpleNavigationChild||{};GeneralMills.PandoSites.SimpleNavigationChild.initialize=function(i){var r={},u=!1,f="opened",e="expanded",s=200,o;i&&i.length!==0||(i=n("<ul><\/ul>"));r.MobileExpand=function(){u=!0;i.addClass(f)};r.MobileCollapse=function(){u=!1;i.removeClass(f)};r.DesktopExpand=function(){i.addClass(e)};r.DesktopCollapse=function(){i.removeClass(e)};r.OnToggleClick=function(n){n.stopPropagation();u?r.MobileCollapse():r.MobileExpand()};r.OnElementHoverOver=function(){o=t.setTimeout(r.DesktopExpand,s)};r.OnElementHoverOff=function(){t.clearTimeout(o);r.DesktopCollapse()};i.on("click",r.OnToggleClick);i.hover(r.OnElementHoverOver,r.OnElementHoverOff);i.find("a").on("click",function(n){n.stopPropagation()});return r}}(jQuery,window);jQuery.noConflict(),function(n,t){GeneralMills=t.GeneralMills=t.GeneralMills||{};GeneralMills.PandoSites=GeneralMills.PandoSites||{};GeneralMills.PandoSites.SimpleNavigation=GeneralMills.PandoSites.SimpleNavigation||{};GeneralMills.PandoSites.SimpleNavigation.initialize=function(t,i,r){var u={},o=!1,s=!1,f="opened",e,h;t&&t.length!==0||(t=n("body"));i&&i.length!==0||(i=t.find("#simpleNavigation"));r&&r.length!==0||(r=t.find(".simpleNavToggle"));e=t.find(".headerMyAccount");h=e.find("a.myaccount");i.find(".simpleNavItems").children().each(function(){GeneralMills.PandoSites.SimpleNavigationChild.initialize(n(this))});u.NavOpen=function(){o=!0;i.addClass(f);r.addClass(f)};u.NavClose=function(){o=!1;i.removeClass(f);r.removeClass(f)};u.NavToggleClick=function(n){n.stopPropagation();o?u.NavClose():(u.NavOpen(),u.MyAccountClose())};r.on("click",u.NavToggleClick);u.MyAccountOpen=function(){s=!0;e.addClass(f)};u.MyAccountClose=function(){s=!1;e.removeClass(f)};u.MyAccountToggleClick=function(n){n.stopPropagation();s?u.MyAccountClose():(u.MyAccountOpen(),u.NavClose())};h.on("click",u.MyAccountToggleClick);t.on("click",function(){u.MyAccountClose();u.NavClose()});return u}}(jQuery,window),function(n,t){t.Contrib=t.Contrib||{};t.Contrib.ChannelLinks=t.Contrib.ChannelLinks||{};t.Contrib.ChannelLinks.ViewModel=function(i){var r={};return r.sendAnalyticsEvent=function(n){var i=n.currentTarget;t.Analytics.raiseEvent({EventType:"ChannelLink",LinkPosition:parseInt(i.getAttribute("data-position")),LinkUrl:i.href,LinkTitle:i.innerText})},r.init=function(){n("#"+i.controlId).on("click","a",r.sendAnalyticsEvent)},r};t.Contrib.ChannelLinks.Initialize=function(n){var i=t.Contrib.ChannelLinks.ViewModel(n);i.init()}}(jQuery,window.GeneralMills||(window.GeneralMills={}));jQuery.cookie=function(n,t,i){var f,r,e,o,u,s;if(typeof t!="undefined"){i=i||{};t===null&&(t="",i.expires=-1);f="";i.expires&&(typeof i.expires=="number"||i.expires.toUTCString)&&(typeof i.expires=="number"?(r=new Date,r.setTime(r.getTime()+i.expires*864e5)):r=i.expires,f="; expires="+r.toUTCString());var h=i.path?"; path="+i.path:"",c=i.domain?"; domain="+i.domain:"",l=i.secure?"; secure":"";document.cookie=[n,"=",encodeURIComponent(t),f,h,c,l].join("")}else{if(e=null,document.cookie&&document.cookie!="")for(o=document.cookie.split(";"),u=0;u<o.length;u++)if(s=jQuery.trim(o[u]),s.substring(0,n.length+1)==n+"="){e=decodeURIComponent(s.substring(n.length+1));break}return e}},function(n,t,i){var u="watermark",f="watermarkClass",h="watermarkFocus",s="watermarkSubmit",c="watermarkMaxLength",e="watermarkPassword",r="watermarkText",o=/\r/g,p=/^(button|checkbox|hidden|image|radio|range|reset|submit)$/i,y="input:data("+u+"),textarea:data("+u+")",l=":watermarkable",a=["Page_ClientValidate"],v=!1,w="placeholder"in document.createElement("input");n.watermark=n.watermark||{version:"3.1.4",runOnce:!0,options:{className:"watermark",useNative:!0,hideBeforeUnload:!0},hide:function(t){n(t).filter(y).each(function(){n.watermark._hide(n(this))})},_hide:function(n,i){var h=n[0],y=(h.value||"").replace(o,""),l=n.data(r)||"",a=n.data(c)||0,v=n.data(f),u,s;l.length&&y==l&&(h.value="",n.data(e)&&(n.attr("type")||"")==="text"&&(u=n.data(e)||[],s=n.parent()||[],u.length&&s.length&&(s[0].removeChild(n[0]),s[0].appendChild(u[0]),n=u)),a&&(n.attr("maxLength",a),n.removeData(c)),i&&(n.attr("autocomplete","off"),t.setTimeout(function(){n.select()},1)));v&&n.removeClass(v)},show:function(t){n(t).filter(y).each(function(){n.watermark._show(n(this))})},_show:function(t){var a=t[0],p=(a.value||"").replace(o,""),i=t.data(r)||"",y=t.attr("type")||"",w=t.data(f),u,s,l;p.length!=0&&p!=i||t.data(h)?n.watermark._hide(t):(v=!0,t.data(e)&&y==="password"&&(u=t.data(e)||[],s=t.parent()||[],u.length&&s.length&&(s[0].removeChild(t[0]),s[0].appendChild(u[0]),t=u,t.attr("maxLength",i.length),a=t[0])),(y==="text"||y==="search")&&(l=t.attr("maxLength")||0,l>0&&i.length>l&&(t.data(c,l),t.attr("maxLength",i.length))),w&&t.addClass(w),a.value=i)},hideAll:function(){v&&(n.watermark.hide(l),v=!1)},showAll:function(){n.watermark.show(l)}};n.fn.watermark=n.fn.watermark||function(i,c){if(!this.length)return this;var v=!1,a=typeof i=="string";return a&&(i=i.replace(o,"")),typeof c=="object"?(v=typeof c.className=="string",c=n.extend({},n.watermark.options,c)):typeof c=="string"?(v=!0,c=n.extend({},n.watermark.options,{className:c})):c=n.watermark.options,typeof c.useNative!="function"&&(c.useNative=c.useNative?function(){return!0}:function(){return!1}),this.each(function(){var y=n(this),d,p,b,k;if(y.is(l)){if(y.data(u))(a||v)&&(n.watermark._hide(y),a&&y.data(r,i),v&&y.data(f,c.className));else{if(w&&c.useNative.call(this,y)&&(y.attr("tagName")||"")!=="TEXTAREA"){a&&y.attr("placeholder",i);return}y.data(r,a?i:"");y.data(f,c.className);y.data(u,1);(y.attr("type")||"")==="password"?(d=y.wrap("<span>").parent(),p=n(d.html().replace(/type=["']?password["']?/i,'type="text"')),p.data(r,y.data(r)),p.data(f,y.data(f)),p.data(u,1),p.attr("maxLength",i.length),p.focus(function(){n.watermark._hide(p,!0)}).bind("dragenter",function(){n.watermark._hide(p)}).bind("dragend",function(){t.setTimeout(function(){p.blur()},1)}),y.blur(function(){n.watermark._show(y)}).bind("dragleave",function(){n.watermark._show(y)}),p.data(e,y),y.data(e,p)):y.focus(function(){y.data(h,1);n.watermark._hide(y,!0)}).blur(function(){y.data(h,0);n.watermark._show(y)}).bind("dragenter",function(){n.watermark._hide(y)}).bind("dragleave",function(){n.watermark._show(y)}).bind("dragend",function(){t.setTimeout(function(){n.watermark._show(y)},1)}).bind("drop",function(n){var t=y[0],i=n.originalEvent.dataTransfer.getData("Text");(t.value||"").replace(o,"").replace(i,"")===y.data(r)&&(t.value=i);y.focus()});this.form&&(b=this.form,k=n(b),k.data(s)||(k.submit(n.watermark.hideAll),b.submit?(k.data(s,b.submit),b.submit=function(t,i){return function(){var r=i.data(s);n.watermark.hideAll();r.apply?r.apply(t,Array.prototype.slice.call(arguments)):r()}}(b,k)):(k.data(s,1),b.submit=function(t){return function(){n.watermark.hideAll();delete t.submit;t.submit()}}(b))))}n.watermark._show(y)}})};n.watermark.runOnce&&(n.watermark.runOnce=!1,n.extend(n.expr[":"],{data:n.expr.createPseudo?n.expr.createPseudo(function(t){return function(i){return!!n.data(i,t)}}):function(t,i,r){return!!n.data(t,r[3])},watermarkable:function(n){var t,i=n.nodeName;return i==="TEXTAREA"?!0:i!=="INPUT"?!1:(t=n.getAttribute("type"),!t||!p.test(t))}}),function(t){n.fn.val=function(){var f=Array.prototype.slice.call(arguments),e;return this.length?f.length?(t.apply(this,f),n.watermark.show(this),this):this.data(u)?(e=(this[0].value||"").replace(o,""),e===(this.data(r)||"")?"":e):t.apply(this):f.length?this:i}}(n.fn.val),a.length&&n(function(){for(var i,r,u=a.length-1;u>=0;u--)i=a[u],r=t[i],typeof r=="function"&&(t[i]=function(t){return function(){return n.watermark.hideAll(),t.apply(null,Array.prototype.slice.call(arguments))}}(r))}),n(t).bind("beforeunload",function(){n.watermark.options.hideBeforeUnload&&n.watermark.hideAll()}))}(jQuery,window),function(n){"use strict";window.GeneralMills=window.GeneralMills||{};GeneralMills.Geolocation=function(){var t={},i;return t.getSearch=function(){return window.location.search},i=typeof GeneralMills.getGlobalSetting=="function"&&GeneralMills.getGlobalSetting("userPrivacy_FunctionalEnabled")==0,t.getZipCode=function(r){if(i)return r&&r(""),t;n.ajax({type:"GET",url:"/api/geolocation"+this.getSearch(),contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(n){var t="";n&&n.postal_code&&(t=n.postal_code);r&&r(t)})},t}();window.gsapi=window.gsapi||{};gsapi.grocery=gsapi.grocery||{};gsapi.grocery.getZipCode=GeneralMills.Geolocation.getZipCode}(jQuery),function(n,t,i,r){t.NumericAutoTabBinding=function(n){function f(n,t){var u=t.index(n),r=t.get(u+1);return r?i(r):null}var t,r=this,u=[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];this.init=function(u,f){var e=f?f():Number.MAX_SAFE_INTEGER;t=n.find("input");i(u).on("keyup",function(n){r.handleKeyUp(n,e)})};this.handleKeyUp=function(n,r){var e,s,o;u.indexOf(n.keyCode)>=0&&(e=n.target,s=i(e).val(),s.length===r&&(o=f(e,t),o&&o.focus()))}};r.bindingHandlers.numericAutoTab=new t.NumericAutoTabBinding(i("body"))}(window,window.GeneralMills||(window.GeneralMills={}),jQuery,ko),function(){window.GeneralMills=window.GeneralMills||{};GeneralMills.PandoSites=GeneralMills.PandoSites||{};GeneralMills.PandoSites.debounce=function(n,t,i){var r,u;return function(){var f=this,e=arguments,o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r;return clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}}}(jQuery),function(){window.GeneralMills=window.GeneralMills||{};window.GeneralMills.AdhesiveAd=function(n){var i={},t={domContentLoaded:!1,deferralExecuteActionTriggered:!1},r={adFixedClass:"adhesiveHeaderAdFixed",simpleObserverOptions:{root:null,rootMargin:"1000px 0px 0px 0px",threshold:[0,1]},simpleObserverRatioTreshold:1};return n=n||{},t.config={adFixedClass:n.adFixedClass||r.adFixedClass,testMode:!!n.testMode,simpleObserverOptions:n.simpleObserverOptions||r.simpleObserverOptions,simpleObserverRatioTreshold:n.simpleObserverRatioTreshold||r.simpleObserverRatioTreshold},t.toggleAdFixedClass=function(){document.body.classList.contains(t.config.adFixedClass)?document.body.classList.remove(t.config.adFixedClass):document.body.classList.add(t.config.adFixedClass)},t.handleSimpleIntersectionEvent=function(n){if(n.forEach(function(n){n.intersectionRatio<t.config.simpleObserverRatioTreshold&&(t.deferralExecuteActionTriggered=!0)}),t.deferralExecuteActionTriggered===!0){if(!document.querySelector(".headerAdSpacing").classList.contains("visible"))return;t.toggleAdFixedClass()}},t.logMessage=function(n,t){(i.debugMode||t)&&console.log("[AdhesiveAd] "+n)},t.isIntersectionObserverSupported=function(){return!!(window.IntersectionObserver&&window.IntersectionObserverEntry)},t.createSimpleIntersectionObserver=function(){if(!t.isIntersectionObserverSupported()){t.logMessage("IntersectionObserver is not available in this browser");return}var n=new window.IntersectionObserver(t.handleSimpleIntersectionEvent,t.config.simpleObserverOptions),i=document.querySelector(".aspNetHidden")||document.querySelector("div")||document.body;n.observe(i)},t.onDOMContentLoaded=function(){t.domContentLoaded=!0;t.createSimpleIntersectionObserver()},t.initialize=function(){t.config.testMode===!0&&(i.internal=t);document.addEventListener("DOMContentLoaded",t.onDOMContentLoaded)},t.initialize(),i};window.GeneralMills.AdhesiveAds=window.GeneralMills.AdhesiveAds||{};window.GeneralMills.AdhesiveAds.Initialize=function(){var n,t,r,u,i;if(document.body.classList.contains("adhesiveHeaderAd")&&(n=document.getElementsByClassName("adAboveSiteHeader"),n.length>0&&n[0].children.length>0)){for(t="adhesiveHeaderAdFixed",r=document.querySelector(".headerAdSpacing"),r.classList.add("visible"),document.body.classList.add(t),u=n[0].getElementsByClassName("closeAdButton"),i=0;i<u.length;i++)u[i].onclick=function(){r.classList.remove("visible");document.body.classList.remove(t)};GeneralMills.AdhesiveAd.Header=new GeneralMills.AdhesiveAd({adFixedClass:t})}};window.GeneralMills.AdhesiveAds.Initialize()}(),function(){window.GeneralMills=window.GeneralMills||{};window.GeneralMills.ActionToolBarObserver=function(n){var i={},t;return n=n||{},t={isFirstIntersect:!0,MobileToolbarObserverOptions:{root:null,rootMargin:"0px 0px 0px 0px",threshold:[.5]},NonRDPMobileToolbarObserverOptions:{root:null,rootMargin:"1000px 0px 0px 0px",threshold:[0]},DesktopDockObserverOptions:null,DesktopBottomObserverOptions:null,noAdDesktopDockObserverOptions:null,isNonRDP:!0,RDPMobileTargetClass:".recipeIngredients",nonRDPMobileTargetClass:".aspNetHidden",pageContainerTargetClass:".pageContainer",RDPMobileTarget:null,nonRDPMobileTarget:null,pageContainerTarget:null,actionToolBar:null,floatingBox:null,adhesiveHeaderAd:"adhesiveHeaderAd",adhesiveBottomAd:null,desktopDockObserver:null,isAdClosed:!1},t.config={actionToolBarClass:"stickyBottom",testMode:!!n.testMode,anchoredTopClass:"anchorTop",anchoredBottomClass:"anchorBottom",adhesiveBottomAdClass:".adhesiveAd"},i.initialize=function(){var n,r;if(t.config.testMode===!0&&(i.internal=t),t.actionToolBar=document.querySelector(".floatingBox .actionToolbar"),t.actionToolBar!=null){t.RDPMobileTarget=document.querySelector(t.RDPMobileTargetClass);t.nonRDPMobileTarget=document.querySelector(t.nonRDPMobileTargetClass);t.pageContainerTarget=document.querySelector(t.pageContainerTargetClass);t.adhesiveBottomAd=document.querySelector(t.config.adhesiveBottomAdClass);document.body.classList.contains("adhesiveHeaderAd")&&(n=document.getElementsByClassName("adAboveSiteHeader"),n.length>0&&n[0].children.length>0&&(r=n[0].getElementsByClassName("closeAdButton"),r[0].onclick=function(){var n=document.querySelector(".headerAdSpacing");n.classList.remove("visible");document.body.classList.remove("adhesiveHeaderAdFixed");t.handleHeaderAdClose()}));var u=window.innerHeight,s=document.body.classList.contains(t.adhesiveHeaderAd)?130:0,h=t.actionToolBar.offsetHeight,f=document.querySelector(".channelLinks").offsetHeight,e=u*window.devicePixelRatio+f-s,o=u*window.devicePixelRatio+f;t.DesktopDockObserverOptions={root:null,rootMargin:e.toString()+"px 0px "+(-e).toString()+"px 0px",threshold:[0,.05]};t.noAdDesktopDockObserverOptions={root:null,rootMargin:o.toString()+"px 0px "+(-o).toString()+"px 0px",threshold:[0,.05]};t.DesktopBottomObserverOptions={root:null,rootMargin:(-h).toString()+"px 0px 0px 0px",threshold:[0,.05]};document.querySelector(".recipeIngredients")!=null&&(t.isNonRDP=!1);t.createMobileIntersectionObserver();t.createDesktopDockIntersectionObserver();t.createDesktopBottomIntersectionObserver()}},t.createMobileIntersectionObserver=function(){if(!t.isIntersectionObserverSupported()){t.logMessage("IntersectionObserver is not available in this browser");return}var n,i;t.isNonRDP?(n=new window.IntersectionObserver(t.handleNonRDPMobileIntersectionEvent,t.NonRDPMobileToolbarObserverOptions),i=t.nonRDPMobileTarget):(n=new window.IntersectionObserver(t.handleMobileIntersectionEvent,t.MobileToolbarObserverOptions),i=t.RDPMobileTarget);n.observe(i)},t.handleMobileIntersectionEvent=function(n){n.forEach(function(n){if(t.isFirstIntersect){t.isFirstIntersect=!1;t.toggleAdhesiveBottomAd(!0);n.boundingClientRect.bottom<n.rootBounds.bottom&&t.toggleToolBarClass();return}n.boundingClientRect.bottom<n.rootBounds.bottom||(n.isIntersecting?t.enableToolBarClass():t.disableToolBarClass())})},t.handleNonRDPMobileIntersectionEvent=function(n){n.forEach(function(n){(n.intersectionRatio!=1||n.boundingClientRect.bottom<=-800&&n.boundingClientRect.bottom>=-1e3)&&t.toggleToolBarClass()})},t.createDesktopDockIntersectionObserver=function(){var n,i;if(!t.isIntersectionObserverSupported()){t.logMessage("IntersectionObserver is not available in this browser");return}n=t.isAdClosed?t.noAdDesktopDockObserverOptions:t.DesktopDockObserverOptions;t.desktopDockObserver=new window.IntersectionObserver(t.handleDesktopDockIntersectionEvent,n);i=t.pageContainerTarget;t.desktopDockObserver.observe(i)},t.handleDesktopDockIntersectionEvent=function(n){n.forEach(function(n){n.intersectionRatio>0?t.addAnchoredTopClass():t.removeAnchoredTopClass()})},t.createDesktopBottomIntersectionObserver=function(){if(!t.isIntersectionObserverSupported()){t.logMessage("IntersectionObserver is not available in this browser");return}var n=new window.IntersectionObserver(t.handleDesktopBottomIntersectionEvent,t.DesktopBottomObserverOptions),i=t.pageContainerTarget;n.observe(i)},t.handleDesktopBottomIntersectionEvent=function(n){n.forEach(function(n){n.intersectionRatio==0?(t.removeAnchoredTopClass(),t.addAnchorBottomClass()):n.intersectionRatio<.1&&n.boundingClientRect.top<0&&t.addAnchoredTopClass()})},t.isIntersectionObserverSupported=function(){return!!(window.IntersectionObserver&&window.IntersectionObserverEntry)},t.toggleToolBarClass=function(){t.actionToolBar.classList.contains(t.config.actionToolBarClass)?t.disableToolBarClass():t.enableToolBarClass()},t.enableToolBarClass=function(){t.actionToolBar.classList.add(t.config.actionToolBarClass);setTimeout(function(){t.toggleAdhesiveBottomAd(!1)},300)},t.disableToolBarClass=function(){t.actionToolBar.classList.remove(t.config.actionToolBarClass);t.toggleAdhesiveBottomAd(!0)},t.addAnchoredTopClass=function(){t.actionToolBar.classList.contains(t.config.anchoredBottomClass)&&t.actionToolBar.classList.remove(t.config.anchoredBottomClass);t.actionToolBar.classList.add(t.config.anchoredTopClass)},t.removeAnchoredTopClass=function(){t.actionToolBar.classList.contains(t.config.anchoredTopClass)&&t.actionToolBar.classList.remove(t.config.anchoredTopClass)},t.addAnchorBottomClass=function(){t.actionToolBar.classList.add(t.config.anchoredBottomClass)},t.toggleAdhesiveBottomAd=function(n){t.adhesiveBottomAd!=null&&t.adhesiveBottomAd.children.length!==0&&(t.adhesiveBottomAd.style.display=n?"block":"none")},t.handleHeaderAdClose=function(){t.desktopDockObserver!=null&&t.desktopDockObserver.disconnect();t.isAdClosed=!0;t.createDesktopDockIntersectionObserver()},t.logMessage=function(n,t){(i.debugMode||t)&&console.log("[ActionToolBarObserver] "+n)},i.initialize(),i};document.addEventListener("DOMContentLoaded",function(){GeneralMills.ActionToolBarObserver.observer=new GeneralMills.ActionToolBarObserver})}();!jQuery("html.lt-ie9")&&Function.prototype.bind&&(typeof console=="object"||typeof console=="function")&&typeof console.log=="object"&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(n){console[n]=this.call(console[n],console)},Function.prototype.bind);window.log||(window.log=function(){var n=arguments,u=!1,i,r,t;if(log.history=log.history||[],log.history.push(arguments),log.detailPrint&&log.needDetailPrint&&(i=navigator.userAgent,r=/Windows\sNT\s(\d+\.\d+)/,console&&console.log&&/MSIE\s(\d+)/.test(i)&&r.test(i)&&parseFloat(r.exec(i)[1])>=6.1&&(u=!0)),u||typeof console!="undefined"&&typeof console.log=="function")if(log.detailPrint&&log.needDetailPrint&&log.needDetailPrint())for(console.log("-----------------"),n=log.detailPrint(n),t=0;t<n.length;)console.log(n[t]),t++;else Array.prototype.slice.call(n).length===1&&typeof Array.prototype.slice.call(n)[0]=="string"?console.log(Array.prototype.slice.call(n).toString()):console.log(Array.prototype.slice.call(n));else if(Function.prototype.bind||typeof console=="undefined"||typeof console.log!="object"){if(Function.prototype.bind&&typeof console!="undefined"&&typeof console.log=="object")if(log.detailPrint)for(Function.prototype.call.call(console.log,console,Array.prototype.slice.call(["-----------------"])),n=log.detailPrint(n),t=0;t<n.length;)Function.prototype.call.call(console.log,console,Array.prototype.slice.call([n[t]])),t++;else Function.prototype.call.call(console.log,console,Array.prototype.slice.call(n))}else if(log.detailPrint)for(Function.prototype.call.call(console.log,console,Array.prototype.slice.call(["-----------------"])),n=log.detailPrint(n),t=0;t<n.length;)Function.prototype.call.call(console.log,console,Array.prototype.slice.call([n[t]])),t++;else Function.prototype.call.call(console.log,console,Array.prototype.slice.call(n))});!function(n){var t={};n.trafficCop=function(i,r){var u,f=i,e;if(2===arguments.length&&(f=n.extend(!0,r,{url:i})),(u=JSON.stringify(f))in t)for(e in{success:1,error:1,complete:1})t[u][e](f[e]);else t[u]=n.ajax(f).always(function(){delete t[u]});return t[u]}}(jQuery),function(n,t,i){var e={templates:{},storeTemplate:function(n,t){this.templates[n]=t},getTemplate:function(n){return this.templates[n]},purge:function(){this.templates={}}},s={templateIds:[],storeTemplate:function(n,t){var i=document.getElementById(n);null===i&&(this.templateIds.push(n),(i=document.createElement("script")).type="text/html",i.id=n,document.body.appendChild(i));i.text=t},getTemplate:function(n){return document.getElementById(n)},purge:function(){for(var n=0;n<this.templateIds.length;n++)document.body.removeChild(document.getElementById(this.templateIds[n]));this.templateIds=[]}},f=function(n,t,i){return"<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}<\/a> could not be loaded. {STATUS}<\/div>".replace("{STATUS}",n).replace("{TEMPLATEID}",t).replace("{TEMPLATEURL}",i)},u=[],h=window.GLOBAL_BUILD_VERSION?window.GLOBAL_BUILD_VERSION:(new Date).toISOString().slice(0,10).replace(/-/g,""),o=function(n){var t=n.templatePrefix+n.templateId+n.templateSuffix;return(n.templateUrl===i||""===n.templateUrl?t:n.templateUrl+"/"+t)+"?cv="+h},c=function(n,t){return function(i){r.store.storeTemplate(n,i);t(r.store.getTemplate(n))}},l=function(t,i,e){return function(o){-1===n.inArray(t,u)&&u.push(t);var s=f("HTTP Status code: "+o.status,t,i);r.store.storeTemplate(t,s);e(r.store.getTemplate(t))}},r={storageOptions:{hash:e,script:s},store:e,defaults:{templateUrl:"",templateSuffix:".html",templatePrefix:"",ajax:{async:!0,dataType:"html",type:"GET"},target:function(n){return"#"+n},loadingTemplate:{content:'<div class="infuser-loading">Loading...<\/div>',transitionIn:function(t,i){var r=n(t);r.hide();r.html(i);r.fadeIn()},transitionOut:function(t){n(t).html("")}},postRender:function(){},preRender:function(){},render:function(t,i){var r=n(t);0===r.children().length?r.append(n(i)):r.children().replaceWith(n(i))},bindingInstruction:function(n){return n},useLoadingTemplate:!0},get:function(t,i){var e,f=n.extend({},r.defaults,"object"==typeof t?t:{templateId:t});f.ajax.url=o(f);(e=r.store.getTemplate(f.ajax.url))&&-1===n.inArray(f.ajax.url,u)?i(e):(f.ajax.success=c(f.ajax.url,i),f.ajax.error=l(f.templateId,f.ajax.url,i),n.trafficCop(f.ajax))},getSync:function(t){var s,e,i=n.extend({},r.defaults,"object"==typeof t?t:{templateId:t},{ajax:{async:!1}});return i.ajax.url=o(i),(s=r.store.getTemplate(i.ajax.url))&&-1===n.inArray(i.ajax.url,u)||(e=null,i.ajax.success=function(n){e=n},i.ajax.error=function(){-1===n.inArray(i.ajax.url)&&u.push(i.ajax.url);e=f("HTTP Status code: exception.status",i.templateId,i.ajax.url)},n.ajax(i.ajax),null===e?e=f("An unknown error occurred.",i.templateId,i.ajax.url):(r.store.storeTemplate(i.ajax.url,e),s=r.store.getTemplate(i.ajax.url))),s},infuse:function(t,u){var f=n.extend({},r.defaults,"object"==typeof t?t:u,"string"==typeof t?{templateId:t}:i),e="function"==typeof f.target?f.target(t):f.target;f.useLoadingTemplate&&f.loadingTemplate.transitionIn(e,f.loadingTemplate.content);r.get(f,function(n){var t=n;f.preRender(e,t);t=f.bindingInstruction(t,f.model);f.useLoadingTemplate&&f.loadingTemplate.transitionOut(e);f.render(e,t);f.postRender(e)})}};t.infuser=r}(jQuery,window),function(n,t,i,r){var f=function(n,i){var f,u=this;u.templateId=n;u.loaded=!1;u.template=t.observable(r.defaults.useLoadingTemplate?r.defaults.loadingTemplate.content:void 0);u.template.data={};u.options=t.utils.extend({},i);u.options.templateId=n;u.options&&u.options.afterRender&&(f=u.options.afterRender,u.options.afterRender=function(){u.loaded&&f.apply(u.options,arguments)})},u;t.utils.extend(f.prototype,{data:function(n,t){if(1===arguments.length)return"precompiled"===n&&this.template(),this.template.data[n];this.template.data[n]=t},text:function(){if(this.loaded||this.getTemplate(),0===arguments.length)return this.template();this.template(arguments[0])},getTemplate:function(){var n=this;r.get(n.options,function(t){n.data("precompiled",null);n.template(t);n.loaded=!0})}});u=function(n){var i=n?new n:new t.nativeTemplateEngine;return i.templates={},i.makeTemplateSource=function(n,r,u){if("string"==typeof n){var e=document.getElementById(n);return e?new t.templateSources.domElement(e):(i.templates[n]||(i.templates[n]=new f(n,u)),i.templates[n])}if(1==n.nodeType||8==n.nodeType)return new t.templateSources.anonymousTemplate(n)},i.renderTemplate=function(n,t,r){var u=i.makeTemplateSource(n,t,r);return i.renderTemplateSource(u,t,r)},i};t.KoExternalTemplateEngine=u;i.tmpl&&i.tmpl.tag.tmpl.open.toString().indexOf("__")>=0?t.setTemplateEngine(new u(t.jqueryTmplTemplateEngine)):t.setTemplateEngine(new u)}(window,ko,jQuery,infuser),function(n){"use strict";n.picturefill=function(t){var h=n.document,f,r,i,l,o,s,e,a,c,u;for(t&&(f=t,typeof t=="string"?f=h.getElementById(t):t.jquery&&t.length===1&&(f=t[0]),f&&typeof f.getElementsByTagName=="function"&&(h=f)),r=h.getElementsByTagName("div"),i=0,l=r.length;i<l;i++)if(r[i].getAttribute("data-picture")!==null){for(o=r[i].getElementsByTagName("div"),s=[],e=0,a=o.length;e<a;e++)c=o[e].getAttribute("data-media"),(!c||n.matchMedia&&n.matchMedia(c).matches)&&s.push(o[e]);u=r[i].getElementsByTagName("img")[0];s.length?(u||(u=n.document.createElement("img"),u.alt=r[i].getAttribute("data-alt"),r[i].appendChild(u)),u.src=s.pop().getAttribute("data-src")):u&&r[i].removeChild(u)}};n.addEventListener&&n.addEventListener("resize",n.picturefill,!1)}(this),function(n){var t=n({});n.subscribe||(n.subscribe=function(){t.bind.apply(t,arguments)});n.unsubscribe||(n.unsubscribe=function(){t.unbind.apply(t,arguments)});n.publish||(n.publish=function(){t.trigger.apply(t,arguments)})}(jQuery),function(n){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("knockout"),exports):typeof define=="function"&&define.amd?define(["knockout","exports"],n):n(ko,ko.actions={})}(function(n,t){var i="ko_delegated_",r=function(r,u){return function(f){var o,e,h,l,v,c,y,s=f.target||f.srcElement,a=n.contextFor(s),p="data-"+r,w=i+r;if(a){while(!e&&s)e=s.getAttribute(p)||n.utils.domData.get(s,w),e||(s=s!==u?s.parentNode:null);e&&(a=n.contextFor(s),a&&(o=a.$data,typeof e=="string"?(e in t?(c=t[e],c&&(h=typeof c=="function"?c:c.action,l=c.owner||o)):o&&o[e]&&typeof o[e]=="function"&&(h=o[e],l=o),h||(v=n.utils.arrayFirst(a.$parents,function(n){return n[e]&&typeof n[e]=="function"}),h=v&&v[e],l=v)):typeof e=="function"&&(h=e,l=o)),h&&(y=h.call(l,o,f),y!==!0&&(f.preventDefault?f.preventDefault():f.returnValue=!1)))}}},u=function(t){var r;t&&(r="delegated"+t.substr(0,1).toUpperCase()+t.slice(1));n.bindingHandlers[r]||(n.bindingHandlers[r]={init:function(r,u){var f=u();n.utils.domData.set(r,i+t,f)}})};n.bindingHandlers.delegatedHandler={init:function(t,i){var f=n.utils.unwrapObservable(i())||[];typeof f=="string"&&(f=[f]);n.utils.arrayForEach(f,function(i){u(i);n.utils.registerEventHandler(t,i,r(i,t))})}}}),function(n,t,i,r){var o;i.ContentLists=i.ContentLists||{};i.ContentLists.Utilities=i.ContentLists.Utilities||{};i.SearchResults=i.SearchResults||{};i.Services=i.Services||{};i.PageUtility=i.PageUtility||{};var s=i.Services.Http=function(){var t=function(t,i,r){return n.ajax({type:"POST",dataType:"json",headers:i,url:t,contentType:"application/json; charset=utf-8",data:r})},i=function(t,i,r){return n.ajax({type:"GET",dataType:"json",headers:i,url:t,contentType:"application/json; charset=utf-8",data:r})};return{POST:t,GET:i}}(),f=i.PageUtility=function(){var r=function(t){for(var r=0,i=0;t!=null;)r+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent,n("html, body").animate({scrollTop:i},1500)},u=function(n){var t="ev=AddToFavorites&ActionType=Save&FavContentName="+n.Title;n.ContentTypeLower=="recipe"&&(t+="&RecipeID="+n.Id+"&RecipeTitle="+n.Title);i.Analytics.raiseEvent({EventType:"AddToFavorites",ContentId:n.Id,ContentTitle:n.Title,RecordType:i.ContentLists.Utilities.toPascalCase(n.ContentType),ContentType:i.ContentLists.Utilities.toPascalCase(n.ContentType)})},f=function(){return t.reg&&t.reg.userRegistration?!0:!1},e=function(){return t.ContentBase?t.ContentBase.RelatedContentSearchPhrase:""},o=function(){return t.ContentBase?t.ContentBase.ContentId:""},s=function(){return n.getQueryString(t.location.search).term},h=function(){return n.getQueryString(t.location.search).showdate},c=function(n){t.location=n},l=function(){return t.location.pathname},a=function(){return{"X-Content-RelatedSearchPhrase":i.PageUtility.GetRelatedSearchPhrase(),"X-Content-Id":i.PageUtility.GetContentId(),"X-Content-SearchPhrase":i.PageUtility.GetSearchPhrase()}},v=function(n){var r=n.searchResultSettings,i={resultsPerAd:-1,resultsBeforeFirstAd:-1,ads:[]};return t.matchMedia(n.MediaQueryLarge).matches?(i.resultsBeforeFirstAd=r.SearchResultsBeforeFirstAdDesktop,i.resultsPerAd=r.SearchResultsBetweenAdsDesktop,i.ads=r.AdsForDesktop):t.matchMedia(n.MediaQueryMedium).matches?(i.resultsBeforeFirstAd=r.SearchResultsBeforeFirstAdTablet,i.resultsPerAd=r.SearchResultsBetweenAdsTablet,i.ads=r.AdsForMobileAndTablet):t.matchMedia(n.MediaQuerySmall).matches&&(i.resultsBeforeFirstAd=r.SearchResultsBeforeFirstAdMobile,i.resultsPerAd=r.SearchResultsBetweenAdsMobile,i.ads=r.AdsForMobileAndTablet),i},y=function(t,i){return n(t).find(i)},p=function(){return t.location.hash},w=function(n){return t.matchMedia(n).matches};return{ScrollToElement:r,AddFavoriteTag:u,HasRegistration:f,GetRelatedSearchPhrase:e,GetContentId:o,GetSearchPhrase:s,getShowDate:h,setWindowLocation:c,getLocationPathname:l,getLocationHash:p,getHeadersForSearch:a,getAdSettings:v,getDescendants:y,matchMedia:w}}(),e={KO_TEMPLATES:{URL:"/Shared/SearchNx/Sublayouts/Web/KO_Templates",SUFFIX:".tmpl.html"}},u={before:"before.searchnx",done:"done.searchnx",error:"error.searchnx",render:"render.searchnx",sort:"sort.searchnx",filter:"filter.searchnx",facet:"facet.searchnx"};i.ContentLists.contentListViewModel=function(h){var c={},l={},v=[],a,y;return c.id=h.Id,c.settingsId=h.SettingsId,c.listDataSourceSettingsIds=h.ListDataSourceSettingsIds,c.isInPageEditor=h.IsInPageEditor,c.isDoneRendering=ko.observable(!1),c.items=ko.observableArray([]),c.MediaQuerySmall=h.MediaQuerySmall,c.MediaQueryMedium=h.MediaQueryMedium,c.MediaQueryLarge=h.MediaQueryLarge,c.MediaQueryExtraLarge=h.MediaQueryExtraLarge,c.MediaQueryHero=h.MediaQueryHero,c.RenderingParams=h.RenderingParams,c.currentPageNumber=ko.observable(1),c.searchResultsTotal=ko.observable(0).extend({notify:"always"}),c.selectedContentFilters=ko.observableArray([]),c.selectedSort=ko.observable(h.ListSettings.DefaultSort),c.settings=ko.observable(h.ListSettings),c.showMoreButton=ko.observable(h.ListSettings.ShowMoreButton),c.showEndCap=ko.observable(!1),c.showEndCapAboveList=ko.observable(!1),c.initialized=!1,c.IsError=h.IsError,c.fatalErrorMessage=ko.observable(h.ErrorMessage),c.isFetching=ko.observable(!1),c.useInfiniteScrolling=ko.observable(h.ListSettings.UseInfiniteScrolling),c.renderingCompletedSuccessfully=ko.observable(!1),c.moreButtonUrl=ko.observable(""),c.loadingMessage=h.LoadingMessage,c.noResultMessage=h.ListSettings.NoResultsMessage,c.showNoResultMessage=ko.observable(!1),c.dataSourceId=c.settings().DataSourceId,c.templateUrl=e.KO_TEMPLATES.URL,c.templateSuffix=e.KO_TEMPLATES.SUFFIX,c.NativeAdsCampaignData=ko.observable(h.NativeAdsCampaignData),c.showAllChildren=ko.observable(!h.ListSettings.MaxChildren),c.showContentTypeLabel=ko.observable(h.ListSettings.ShowContentTypeLabel),typeof h.ListSettings.MaxChildren!="undefined"&&(i.PageUtility.matchMedia(c.MediaQueryLarge)?c.MaxChildren=h.ListSettings.MaxChildren:i.PageUtility.matchMedia(c.MediaQueryMedium)?c.MaxChildren=h.ListSettings.TabletMaxChildren:i.PageUtility.matchMedia(c.MediaQuerySmall)&&(c.MaxChildren=h.ListSettings.MobileMaxChildren),(c.MaxChildren===null||c.MaxChildren===0)&&(c.MaxChildren=h.ListSettings.MaxChildren)),c.toggleShowAllChildren=function(){c.showAllChildren(!c.showAllChildren())},c.browsePathButtonText=ko.computed(function(){return c.showAllChildren()?c.settings().LessButtonText:c.settings().MoreButtonText}),c.htmlTemplateClass=ko.computed(function(){var n=c.settings().HtmlTemplateName||"";return n.replace(/[^a-zA-Z0-9]/g,"")}),c.listItemLayoutClass=ko.computed(function(){var n=c.settings();return!n||!n.ListItemLayout?"list-item":"list-item-"+n.ListItemLayout.toLowerCase()}),c.hasTwoColSmClass=ko.computed(function(){var n=c.listItemLayoutClass();return n!==null&&n!==r&&n.indexOf("two-col-sm")>-1}),c.endCapClass=ko.computed(function(){var n=c.settings();return!n||!n.EndCap?"end-cap":"end-cap-"+n.EndCap.Class}),c.endCapBgImage=ko.computed(function(){var n=c.settings();return!n||!n.EndCap||!n.EndCap.Image||!n.EndCap.Image.Src?"":"url("+n.EndCap.Image.Src+")"}),c.HighlightItem=function(n){var t=c.settings();return t&&t.ShowHighlight&&n&&n.length?n[0]:null},c.HighlightItemList=function(n){var t=c.settings(),i;return t&&t.ShowHighlight&&h.highlightSettings&&h.highlightSettings.splitHighlightFromList&&n&&n.length&&(i=n.shift()),n},c.PrimaryProperties=function(n){return ko.computed({read:function(){var i=[],t;if(n)for(t=0;t<n.length;t++)n[t].Template!=="RatingPropertyView"&&n[t].Template!=="ReviewPropertyView"&&i.push(n[t]);return i}})},c.RatingsAndReviews=function(n){return ko.computed({read:function(){var i=[],t;if(n)for(t=0;t<n.length;t++)(n[t].Template==="RatingPropertyView"||n[t].Template==="ReviewPropertyView")&&i.push(n[t]);return i}})},c.IsCurrentlyFeatured=function(n){return ko.computed({read:function(){if(n)for(var t=0;t<n.length;t++)if(n[t].Template==="DefaultPropertyView"&&n[t].Name==="Is Currently Featured")return n[t].Value==="1"?!0:!1;return!1}})},c.ShowTitleSection=function(){return ko.computed({read:function(){var n=c.RenderingParams,t=c.settings();return n&&n["Show Title"]&&c.ListTitle||n&&n["Show Description"]&&t&&t.SlideshowDescription}})},c.ListTitle=ko.computed(function(){var t=c.RenderingParams,n;return t&&t.Title?t.Title:(n=c.settings(),n&&n.Title)?n.Title:""}),c.ShowProperties=function(){return ko.computed({read:function(){var n=c.RenderingParams;return n&&(n["Show Primary"]||n["Show Secondary"])}})},c.VisibleThumbnails=function(n){var t=c.RenderingParams,i;return!t||!t["Visible Thumbnails"]?n:(i=parseInt(t["Visible Thumbnails"]),i>n?c.items().length:i)},c.navigateToContent=function(r){if(c.isInPageEditor)return!1;var u={ContentId:r.Id,ContentTitle:r.Title,ContentType:i.ContentLists.Utilities.toPascalCase(r.ContentType),RecordType:i.ContentLists.Utilities.toPascalCase(r.ContentType),ContentListName:c.settings().Name,Language:r.Language};return c.settings().ActiveDataSourceType===4?(u.EventType="SearchHighlight",u.SearchSortType=c.selectedSort().SortKey,u.SearchItemRank=r.ItemRank.toString(),u.SearchRelevancyScore=r.RelevancyScore.toString(),u.SiteSearchPhrase=c.settings().SearchTerm||n.getQueryString(t.location.search).term,u.TemplateName=c.settings().HighlightTemplateName):(u.EventType="ContentResult",u.TemplateName=c.settings().HtmlTemplateName),i.Analytics.raiseEvent(u),i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramContentClick",c.NativeAdsCampaignData(),"Content List",c.settings().Name),r.Link.Target==="_self"&&i.PageUtility.setWindowLocation(r.Link.Url),!0},c.programSponsorClick=function(){return i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramSponsorClick",c.NativeAdsCampaignData(),"Content List",c.settings().Name),!0},c.isInitialized=function(){return c.initialized},c.onSortResultsDone=function(){n.publish(u.sort,[c]);t.console&&t.console.log("[SearchNx] Published '"+u.sort+"' event")},c.sortResults=function(n){return c.selectedSort(n),c.getContentSearch(!0).done(c.onSortResultsDone)},c.onFilterResultsDone=function(){n.publish(u.filter,[c]);t.console&&t.console.log("[SearchNx] Published '"+u.filter+"' event")},c.onSelectedContentFiltersChanged=function(){c.initialized&&c.getContentSearch(!0).then(c.onFilterResultsDone)},c.selectedContentFilters.subscribe(c.onSelectedContentFiltersChanged),c.getMoreItems=function(){return c.currentPageNumber(c.currentPageNumber()+1),c.getContentSearch()},c.onDoSearchDone=function(r){c.facetModel.updateFacetCounts(r.d.FacetCounts);c.settings().ActiveDataSourceType===4&&(c.NativeAdsCampaignData(r.d.NativeAdsCampaignData),c.NativeAdsCampaignData()!=null&&c.NativeAdsCampaignData().RenderMode!=2&&i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramContentImpression",c.NativeAdsCampaignData(),"Search Highlight",c.settings().Name));n.publish(u.done,[r,c]);t.console&&t.console.log("[SearchNx] Published '"+u.done+"' event")},c.onDoSearchError=function(i,r,f){n.publish(u.error,[i,r,f,c]);t.console&&t.console.log("[SearchNx] Published '"+u.error+"' event")},c.doSearch=function(i){var e={contentId:c.settings().Id,listDataSourceSettingsIds:c.listDataSourceSettingsIds,pageIndex:i?i:c.currentPageNumber(),sortOption:{sortKey:c.selectedSort()?c.selectedSort().SortKey:null,sortDirection:c.selectedSort()?c.selectedSort().SortDirection:null},orProperties:c.getOrProperties(),navigationValues:c.facetModel.selectedFacetValues(),getAllPages:i?!0:!1,requestMetadata:h.RequestMetadata,language:h.Language},r;return(n.publish(u.before,[c]),t.console&&t.console.log("[SearchNx] Published '"+u.before+"' event"),!c.initialized&&h.ServerSearchResponse&&c.currentPageNumber()==1)?(r=jQuery.Deferred(),r.done(c.onDoSearchDone),r.resolve({d:h.ServerSearchResponse,requestOrigin:"config.ServerSearchResponse pre-calculated search results"}),r):(r=h.IsAuthenticated?s.POST("/Shared/SearchNx/services/searchServiceNx.asmx/GetContentByPage",f.getHeadersForSearch(),ko.toJSON({searchParams:e})):s.GET("/Shared/SearchNx/services/searchServiceNxA.asmx/GetContentByPage",f.getHeadersForSearch(),"searchParams="+ko.toJSON(e)),r.done(c.onDoSearchDone),r.error(c.onDoSearchError),r)},c.updateMoreButtonState=function(n){if(c.getHashbangVariable("pageNumber")&&c.updateCanonicalLink(i.PageUtility.getLocationPathname()+i.PageUtility.getLocationHash()),!c.settings().ShowMoreButton&&!c.settings().UseInfiniteScrolling||n.Results.length===0||n.IsLastPage){c.showMoreButton(!1);return}c.showMoreButton(!0);var t=c.currentPageNumber()+1;c.moreButtonUrl(i.PageUtility.getLocationPathname()+"#!pageNumber="+t+"&listToPage="+c.settings().Id)},c.updateInfiniteScrollingState=function(n){c.useInfiniteScrolling(c.settings().UseInfiniteScrolling&&!c.settings().ShowMoreButton&&!n.IsLastPage&&n.Results.length>0)},c.getContentSearch=function(n,i){function r(n){c.isFetching(!1);t.console&&console.log("error requesting content results. configuration:"+h.ListSettings.Id+" error:");t.console&&console.log(JSON.stringify(n,null,"\t"));c.fatalErrorMessage(n.statusText)}function u(t){for(var i=t.d,r=0;r<i.Results.length;r++)i.Results[r].IsFavorite=ko.observable(i.Results[r].IsFavorite);return n&&c.items.removeAll(),c.items.push.apply(c.items,i.Results),i.BrowseResult&&c.items.push(i.BrowseResult),i}return n&&c.currentPageNumber(1),c.isFetching(!0),c.showNoResultMessage(!1),c.doSearch(i).then(u,r).then(c.loadSettings)},c.loadSettings=function(n){return c.updateInfiniteScrollingState(n),c.updateMoreButtonState(n),c.showEndCap(n.IsLastPage&&c.settings().EndCap&&c.settings().EndCap.Template!==null),c.showEndCapAboveList(c.settings().EndCap&&c.settings().EndCap.Template!==null),c.searchResultsTotal(n.Count),c.showNoResultMessage(n.IsLastPage&&n.Count==0),c.isFetching(!1),n},l.triggerScroll=function(t,i,u,e){if(u===c.settingsId){var o=n("#"+t+c.settingsId)[0];o!==r&&(f.ScrollToElement(o),e())}else e()},c.initialize=function(t){var r,u;if(c.IsError)return null;if(c.currentPageNumber(l.getCurrentPageNumberFromHashbang()),r=c.settings().DefaultContentFilter,(!r||r.length<1)&&(r=c.settings().ContentFilter),c.selectedContentFilters(n.map(r,function(n){return n.Name})),i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramContentImpression",c.NativeAdsCampaignData(),"Content List",c.settings().Name),u=c.favorites.tryRestoreSavedState(t,l.triggerScroll),u)c.initialized=!0;else return c.getContentSearch().then(function(){c.initialized=!0}).then(t)},c.additionalAfterRender=function(){},c.afterTemplateRender=function(t){({}).toString.call(c.additionalAfterRender)=="[object Function]"&&c.additionalAfterRender(t);var i=n(t).filter("li").get();ko.utils.arrayPushAll(v,i);l.debouncedAfterRender()},c.getOrProperties=function(){var t=n.grep(c.settings().ContentFilter,function(n){return c.selectedContentFilters().indexOf(n.Name)!==-1});return n.map(t,function(n){return{propertyName:"Content Type",PropertyValue:n.Name}})},a=h.ListSettings,a.isInitialized=function(){return c.initialized},a.getContentSearch=c.getContentSearch,c.facetModel=i.ContentLists.FacetContainer(a),y={favoriteTemplateName:c.settings().FavoriteTemplateName,isAuthenticated:h.IsAuthenticated,registrationParameters:c.settings().RegParams,selectedContentFilters:c.selectedContentFilters,currentPageNumber:c.currentPageNumber,loadedItems:c.items,settingsId:c.settings().Id,dataSourceId:c.dataSourceId,selectedSort:c.selectedSort,selectedFacetValues:c.facetModel.selectedFacetValues,setSelectedFacets:c.facetModel.setSelectedFacets,getContentSearch:c.getContentSearch,triggerScroll:l.triggerScroll},c.favorites=i.ContentLists.Favorites(y),c.toggleFavorite=c.favorites.toggleFavorite,l.debouncedAfterRender=o(function(){n.publish(u.render,[v,c]);t.console&&t.console.log("[SearchNx] Published '"+u.render+"' event");c.renderingCompletedSuccessfully(!0);i.applyPictureFill(c.id);v=[];n(t).trigger("scroll.searchnx."+c.id)},80),c.updateCanonicalLink=function(t){n("link[rel=canonical]").attr("href",t)},l.getCurrentPageNumberFromHashbang=function(){var n=c.getHashbangVariable("pageNumber"),i=c.getHashbangVariable("listToPage"),t;return i===c.settings().Id&&typeof n!="undefined"&&(t=/^\d+$/,t.test(n))?parseInt(n):1},c.getHashbangVariable=function(n){var u,t,f;if(i.PageUtility.getLocationHash().substring(0,2)!=="#!")return r;for(u=i.PageUtility.getLocationHash().substring(2).split("&"),t=0;t<u.length;t++)if(f=u[t].split("="),decodeURIComponent(f[0])===n)return decodeURIComponent(f[1]);return r},c};i.SearchResults=function(){var h=function(h,c){var l={},a={},y=[],v,p;return l.id=c,l.seeMoreButtonText=ko.observable(h.ShowMoreText),l.errorMessage=ko.observable(h.ErrorMessage),l.filterLabelText=h.FilterLabelText,l.searchResultsTitle=h.SearchResultsTitle,l.noResultMessage=ko.observable(h.NoResultsMessage),l.useInfiniteScroller=ko.observable(h.UseInfiniteScroller),l.showNoResultMessage=ko.observable(!1),l.showErrorMessage=ko.observable(!1),l.loadingMessage=ko.observable(h.loadingMessage),l.searchResultSettings=h,l.showDates=ko.observable(!1),l.isFetching=ko.observable(!1),l.MediaQuerySmall=h.MediaQuerySmall,l.MediaQueryMedium=h.MediaQueryMedium,l.MediaQueryLarge=h.MediaQueryLarge,l.MediaQueryExtraLarge=h.MediaQueryExtraLarge,l.MediaQueryHero=h.MediaQueryHero,l.initialized=!1,l.dataSourceId=l.searchResultSettings.DataSourceId,l.templateUrl=e.KO_TEMPLATES.URL,l.templateSuffix=e.KO_TEMPLATES.SUFFIX,l.nativeAdsCampaignData={},l.nativeAdsTealiumConstants={ContentListName:"Search-Highlight",programCreativeType:"Sponsored Search Result"},l.searchTerm=ko.observable(n.getQueryString(t.location.search).term),l.currentSearchPage=ko.observable(1),l.pageSize=h.PageSize,l.selectedSort=ko.observable(h.SortOptions[0]),l.searchType=ko.observable(""),l.shouldAppendResult=ko.observable(!1),l.searchResults=ko.observableArray(),l.notLastpage=ko.observable(!0),l.searchResultsTotal=ko.observable(-1),l.sortBy=h.SortBy,l.sortOptions=ko.observableArray(h.SortOptions),l.programSponsorClick=function(){return i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramSponsorClick",l.nativeAdsCampaignData,l.nativeAdsTealiumConstants.programCreativeType,l.nativeAdsTealiumConstants.ContentListName),!0},l.getPropertyTemplate=function(n){return n.Template},l.afterListRender=function(t){var i=n(t).filter("li").get();ko.utils.arrayPushAll(y,i);a.debouncedAfterRender()},l.searchTrack=function(n){return n.IsSponsored&&i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramContentClick",l.nativeAdsCampaignData,l.nativeAdsTealiumConstants.programCreativeType,l.nativeAdsTealiumConstants.ContentListName),i.Analytics.raiseEvent({EventType:"SearchResult",ContentId:n.Id,ContentTitle:n.Title,Language:n.Language,RecordType:n.ContentType,ContentType:n.ContentType,SearchRelevancyScore:n.RelevancyScore.toString(),SearchItemRank:n.ItemRank.toString(),SearchSortType:l.selectedSort().SortName,FacetFilter:ko.utils.arrayMap(l.facetModel.selectedFacets(),function(n){return n.name}),SiteSearchPhrase:l.searchTerm()}),!0},l.sortResults=function(i){return l.selectedSort(i),l.currentSearchPage(1),l.shouldAppendResult(!1),n.publish(u.sort,[l]),t.console&&t.console.log("[SearchNx] Published '"+u.sort+"' event"),l.performSearch()},l.performSearch=function(r,f){r&&l.shouldAppendResult(!1);var e={searchTerm:l.searchTerm(),pageIndex:f?f:l.currentSearchPage(),pageSize:l.pageSize,sortKey:l.selectedSort()?l.selectedSort().SortKey:"Best Match",sortDirection:l.selectedSort()?l.selectedSort().SortDirection:null,searchType:l.searchType(),NavigationValues:l.facetModel.selectedFacetValues(),GetAllPages:f?!0:!1,DataSource:h.DataSourceId};return n.publish(u.before,[l]),t.console&&t.console.log("[SearchNx] Published '"+u.before+"' event"),l.isFetching(!0),s.POST("/Shared/SearchNx/Services/SearchServiceNx.asmx/GetSearchResults",i.PageUtility.getHeadersForSearch(),ko.toJSON({searchQuery:e})).done(l._onSearchDone).fail(a._onSearchFail)},l.moreSearch=function(){return l.shouldAppendResult(!0),l.currentSearchPage(l.currentSearchPage()+1),l.performSearch()},v=h,v.isInitialized=function(){return l.initialized},v.getContentSearch=l.performSearch,l.facetModel=i.ContentLists.FacetContainer(v),l.triggerScroll=function(t,i,u,e){if(l.dataSourceId===i){var o=n("#"+t)[0];o!==r&&(f.ScrollToElement(o),e())}e()},l.getCurrentAd=function(n){var t=i.PageUtility.getAdSettings(l),r=t.resultsBeforeFirstAd===-1?t.resultsPerAd:t.resultsBeforeFirstAd;return n===0&&(n=r),t.ads[parseInt((n-r)/t.resultsPerAd)]},l.shouldShowAd=function(n){n++;var t=i.PageUtility.getAdSettings(l),r=t.resultsBeforeFirstAd===-1?t.resultsPerAd:t.resultsBeforeFirstAd,u=l.getCurrentAd(n),f=n<=r;return n===0&&(n=r),f?n%r==0&&typeof u!="undefined"&&u!==null:(n=n-r,n%t.resultsPerAd==0&&typeof u!="undefined"&&u!==null)},p={favoriteTemplateName:l.searchResultSettings.FavoriteTemplateName,isAuthenticated:h.IsAuthenticated,registrationParameters:l.searchResultSettings.RegParams,selectedContentFilters:function(){return new Array(0)},currentPageNumber:l.currentSearchPage,loadedItems:l.searchResults,settingsId:l.searchResultSettings.Id,dataSourceId:l.dataSourceId,selectedSort:l.selectedSort,selectedFacetValues:l.facetModel.selectedFacetValues,setSelectedFacets:l.facetModel.setSelectedFacets,getContentSearch:l.performSearch,triggerScroll:a.triggerScroll},l.favorites=i.ContentLists.Favorites(p),l.toggleFavorite=l.favorites.toggleFavorite,l._onSearchDone=function(r){l.isFetching(!1);l.showNoResultMessage(l.currentSearchPage()===1&&r.d.Results.length==0);l.notLastpage(!r.d.IsLastPage);l.searchResultsTotal(r.d.Count);l.setSortAndFilterCookie();l.showDates(l._processShowDateParameter());r.d.NativeAdsCampaignData&&(l.nativeAdsCampaignData=r.d.NativeAdsCampaignData,i.ContentLists.Utilities.TriggerNativeAdsEvent("ProgramContentImpression",l.nativeAdsCampaignData,l.nativeAdsTealiumConstants.programCreativeType,l.nativeAdsTealiumConstants.ContentListName));i.Analytics.raiseEvent({EventType:"SearchAction",SiteSearchPhrase:l.searchTerm(),SearchResultCount:r.d.Count.toString(),SearchSortType:l.selectedSort().SortName,ContentType:"Search",RecordType:"Search"});var f=ko.utils.arrayMap(r.d.Results,function(n){return n.IsFavorite=ko.observable(n.IsFavorite),n});l.shouldAppendResult()?l.searchResults.push.apply(l.searchResults,f):(l.searchResults(f),l.currentSearchPage(1));l.facetModel.updateFacetCounts(r.d.FacetCounts);n.publish(u.done,[r,l]);t.console&&t.console.log("[SearchNx] Published '"+u.done+"' event")},a._onSearchFail=function(i,r,f){l.isFetching(!1);l.showErrorMessage(!0);l.notLastpage(!1);n.publish(u.error,[i,r,f,l]);t.console&&t.console.log("[SearchNx] Published '"+u.error+"' event")},a.debouncedAfterRender=o(function(){n.publish(u.render,[y,l]);t.console&&t.console.log("[SearchNx] Published '"+u.render+"' event");i.applyPictureFill(l.id);y=[]},80),l._processShowDateParameter=function(){return l.getShowDateCookie()||i.PageUtility.getShowDate()?(l.setShowDateCookie(),!0):!1},l.setShowDateCookie=function(){n.cookie("GMI.searchNxShowDateCookie-"+l.dataSourceId,i.PageUtility.getShowDate())},l.setSortAndFilterCookie=function(){var t=l.selectedSort();n.cookie("GMI.searchNxSortAndFilterCookie-"+l.dataSourceId,JSON.stringify({SortKey:t.SortKey,SortName:t.SortName,SortDirection:t.SortDirection,NavigationValues:l.facetModel.selectedFacetValues()}))},l.getShowDateCookie=function(){return n.cookie("GMI.searchNxShowDateCookie-"+l.dataSourceId)},l.getSortAndFilterCookie=function(){return JSON.parse(n.cookie("GMI.searchNxSortAndFilterCookie-"+l.dataSourceId))},l.applySavedSearchAndFilterOptions=function(){var n=l.getSortAndFilterCookie();n&&(l.facetModel.setSelectedFacets(n.NavigationValues),l.selectedSort({SortName:n.SortName,SortKey:n.SortKey,SortDirection:n.SortDirection}))},l.initializeState=function(){var n=l.favorites.tryRestoreSavedState(null,l.triggerScroll);return l.initialized=!0,n?void 0:(l.applySavedSearchAndFilterOptions(),l.performSearch())},l},c=function(t,i){var r=h(t,i);ko.applyBindings(r,n("#"+i).get(0));n(".searchTextBox")&&n(".searchTextBox").val(r.searchTerm());r.initializeState()};return{Init:c,ViewModel:h}}();ko.bindingHandlers.uiSlider={init:function(t,i,r,u,f){var e=f.$data,s=e.facets();n(t).slider({value:e.selectedFacetIndex(),min:0,max:s.length-1,step:1,slide:o(function(n,t){var i=t.value,r=s[i];f.$parent.setSingleSelectedFacet(r,e)},250)})}};ko.bindingHandlers.contentListDropdown={init:function(t){n(t).on("click.contentListDropdown.searchNx",function(i){var r=n(t).parent().hasClass("expanded");n(".contentListDropdown").removeClass("expanded");r||n(t).parent().toggleClass("expanded");i.stopImmediatePropagation()});n("html").on("click.contentListDropdown.searchNx",function(){n(t).parent().removeClass("expanded")});n(t).parent().find(".contentListDropdownContainer.searchFacets").on("click.contentListDropdownContainer.searchNx",function(n){n.stopPropagation()})}};ko.bindingHandlers.infiniteScroll=function(){var i=n(t),r=function(t,r,u,f){return function(){!f.$data.isFetching()&&n(u).is(":visible")&&o(function(){u.getBoundingClientRect().bottom<=i.height()?f.$data.isFetching()||t.call(r):f.$data.showMoreButton&&f.$data.showMoreButton(!1)},150)()}};return{update:function(n,t,u,f,e){var o=t(),s=ko.utils.unwrapObservable(o.enable),h=ko.utils.unwrapObservable(o.scroll);if(s)i.on("scroll.searchnx."+n.id,r(h,f,n,e));else i.off("scroll.searchnx."+n.id)}}}();ko.bindingHandlers.bindDoubleClick={init:function(n,t,r,u,f){var s=t()+1,e=f.$root.getCurrentAd(s),o;return typeof e!="undefined"&&e!==null&&(o=i.PageUtility.getDescendants(n,".searchNxDoubleClickAdElement")[0],o.id=e.DoubleClickAdContainerId,e.RelevantMetadata.push(f.$root.searchTerm()),i.DoubleClick.init(e)),{controlsDescendantBindings:!0}}};n.extend({getQueryString:function(n){return function(n){var r,t,i;if(n=="")return{};for(r={},t=0;t<n.length;++t)i=n[t].split("="),r[i[0].replace(/^\?/,"")]=i.length===2?decodeURIComponent(i[1].replace(/\+/g," ")):!0;return r}(n.split("&"))}});o=function(n,t,i){var r,u;return function(){var f=this,e=arguments,o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r;return clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}};ko.toFormattedJSON=function(n){return ko.toJSON(n).prettyJson()};Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=this.length>>>0,t=Number(arguments[1])||0;for(t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=i);t<i;t++)if(t in this&&this[t]===n)return t;return-1});String.prototype.prettyJson=function(){for(var r=this,t="",o=["{","}","[","]",",",":"],u=!1,f=0,e=function(){t+="\r\n";for(var n=0;n<f;n++)t+="  "},n,i=0;i<r.length;i++){if(n=r.charAt(i),n==='"'&&r.charAt(i-1)!=="\\"&&(u=!u),u||o.indexOf(n)===-1){t+=n;continue}n==="{"||n==="["||n===","?(n!==","&&f++,t+=n,e()):n==="}"||n==="]"?(f--,e(),t+=n):n===":"&&(t+=n+" ")}return t};i.ContentLists.Utilities=function(){var n={};return n.toPascalCase=function(n){return n==null?null:n.replace(/(\w)(\w*)/g,function(n,t,i){return t.toUpperCase()+i.toLowerCase()})},n.TriggerNativeAdsEvent=function(n,t,r,u){if(n&&t&&!(t.ProgramNumber<=0)){var f={EventType:n,ProgramNumber:t.ProgramNumber,ContentListName:u,ProgramCreativeType:r};t.ProgramName&&(f.ProgramName=t.ProgramName);t.ProgramBrand&&(f.ProgramBrand=t.ProgramBrand);t.ProgramDivision&&(f.ProgramDivision=t.ProgramDivision);i.Analytics.raiseEvent(f)}},n}();i.applyPictureFill=function(i){n("html").hasClass("lt-ie9")||typeof t.picturefill=="function"&&i&&(t.console&&t.console.log("[SearchNx] Applying picturefill to '"+i+"'"),t.picturefill(i))};i.ContentLists.FacetContainer=function(t){var i={},r={};return t.FacetGroups||(t.FacetGroups=[]),i.groups=ko.observableArray([]),i.showCounts=t.DisplayFacetCount,i.templateUrl=e.KO_TEMPLATES.URL,i.templateSuffix=e.KO_TEMPLATES.SUFFIX,i.facetsSelected=ko.observable(!1),i.isVisible=ko.computed(function(){var n=!1;return ko.utils.arrayForEach(i.groups(),function(t){t.isVisible()&&(n=!0)}),n}),i.selectedFacets=ko.computed(function(){return[].concat.apply([],ko.utils.arrayMap(i.groups(),function(n){return n.selectedFacets()}))}),i.selectedFacetValues=ko.computed(function(){return ko.utils.arrayMap(i.selectedFacets(),function(n){return n.value}).join(" ")}),i.updateFacetCounts=function(n){ko.utils.arrayForEach(i.groups(),function(t){t.updateFacetCounts(n)})},i.setSelectedFacets=function(n){ko.utils.arrayForEach(i.groups(),function(t){t.setSelectedFacets(n)})},i.setSingleSelectedFacet=function(n,t){n.value!=="-1"&&i.pauseFacetSearch();ko.utils.arrayForEach(t.facets(),function(n){n.isSelected(!1)});n.value!=="-1"&&(i.resumeFacetSearch(),n.isSelected(!0))},i.label=ko.computed(function(){return t.FacetLabelSelected?i.selectedFacets()&&i.selectedFacets().length>0?t.FacetLabelSelected:t.FacetLabel:t.FacetLabel}),i.resumeFacetSearch=function(){r.beginFacetSearch()},i.pauseFacetSearch=function(){r.facetSearchSubscription&&r.facetSearchSubscription.dispose()},r.group=function(t){var i={},r={};return i.name=t.DisplayName,i.value=t.GroupValue,i.facets=ko.observableArray([]),i.isDynamic=t.IsDynamic,i.isExpanded=ko.observable(t.Expanded),i.template=t.Template,i.selectedFacets=ko.computed(function(){return ko.utils.arrayFilter(i.facets(),function(n){return n.isSelected()})}),i.isVisible=ko.computed(function(){var n=!1;return ko.utils.arrayForEach(i.facets(),function(t){t.isVisible()&&(n=!0)}),n}),i.selectedFacetIndex=ko.computed(function(){var n=i.facets().indexOf(i.selectedFacets()[0]);return n>=0?n:i.facets().length-1}),i.updateFacetCounts=function(n){ko.utils.arrayForEach(i.facets(),function(t){t.count(n[t.value]||0)})},i.setSelectedFacets=function(n){ko.utils.arrayForEach(i.facets(),function(t){t.isSelected(n.indexOf(t.value)>=0)})},r.facet=function(n){var t={};return t.isSelected=ko.observable(!1),t.count=ko.observable(n.Count),t.name=n.Name,t.value=n.Value,t.isVisible=ko.computed(function(){return t.count()>0||!n.isDynamic}),t.percentFromLeft=function(){return n.facetPositionInGroup*100/(n.totalFacetsInGroup===1?1:n.totalFacetsInGroup-1)+"%"},t},t.Facets=t.Facets||[],n.each(t.Facets,function(n,u){u.isDynamic=i.isDynamic;u.totalFacetsInGroup=t.Facets.length;u.facetPositionInGroup=n;i.facets.push(r.facet(u))}),i},r.beginFacetSearch=function(){r.facetSearchSubscription=i.selectedFacets.subscribe(function(){t.isInitialized()&&(i.facetsSelected=!0,t.getContentSearch(!0,1))})},r.beginFacetSearch(),n.each(t.FacetGroups,function(n,t){i.groups.push(r.group(t))}),i};i.ContentLists.Favorites=function(i){var r={};return r.hasRegistration=function(){return f.HasRegistration()},r.getFavoriteTemplate=function(){return i.favoriteTemplateName},r.setCookie=function(t){var r={dataSourceId:i.dataSourceId,listSettingsId:i.settingsId,currentPage:i.currentPageNumber(),loadedItems:i.loadedItems().length,selectedContentFilters:i.selectedContentFilters(),selectedSort:i.selectedSort(),selectedFacetValues:i.selectedFacetValues(),itemId:t.Id,itemTitle:t.Title,itemContentType:t.ContentType};n.cookie("searchNxPosition",JSON.stringify(r))},r.toggleFavorite=function(n){if(i.isAuthenticated||r.hasRegistration()&&typeof t.reg.userRegistration.openRegistrationDialog!="undefined"){if(i.isAuthenticated)return s.POST(n.IsFavorite()?"/Shared/SearchNx/Services/SearchServiceNx.asmx/RemoveFavorite":"/Shared/SearchNx/Services/SearchServiceNx.asmx/AddFavorite",{},ko.toJSON({contentId:n.Id})).success(function(){n.IsFavorite(!n.IsFavorite());n.IsFavorite()&&f.AddFavoriteTag(n)});r.setCookie(n);var u={};i.registrationParameters.length>0&&(u=JSON.parse(i.registrationParameters));u.returnUrl=u.returnUrl||t.location.href;t.reg.userRegistration.openRegistrationDialog(u)}},r.getCookieData=function(){var t=decodeURI(n.cookie("searchNxPosition"))||"{}";return n.parseJSON(t)},r.tryRestoreSavedState=function(t,u){var e=r.getCookieData(),o,s,h;return!e||e.dataSourceId!==i.dataSourceId?!1:(e.itemId&&e.itemTitle&&f.AddFavoriteTag({Id:e.itemId,Title:e.itemTitle,ContentType:e.itemContentType}),o=e.currentPage,i.selectedSort(e.selectedSort),i.setSelectedFacets(e.selectedFacetValues),i.selectedContentFilters&&i.selectedContentFilters(e.selectedContentFilters),s=function(){u(e.itemId,e.dataSourceId,e.listSettingsId,h)},h=function(){n.unsubscribe("render.searchnx",s)},n.subscribe("render.searchnx",s),i.getContentSearch(!0,o).then(function(){i.currentPageNumber(o);typeof t=="function"&&t()}),n.cookie("searchNxPosition",null),!0)},r};ko.bindingHandlers.dynamicObservable={init:function(n,t,i,r){var u=ko.utils.unwrapObservable(t());u&&u.propertyName&&u.initialValue&&(ko.isWriteableObservable(r[u.propertyName])||(r[u.propertyName]=ko.observable()),r[u.propertyName](u.initialValue))}};ko.bindingHandlers.toggleDelegated={init:function(n,t){var i=t();i&&ko.isWriteableObservable(data[i])&&ko.applyBindingsToNode(n,{delegatedClick:function(){i(!i())}})}}}(jQuery,window,window.GeneralMills||(window.GeneralMills={}));this.JSON||(JSON=function(){function t(n){return n<10?"0"+n:n}function n(t,r){var e,u,f,s,h=/["\\\x00-\x1f\x7f-\x9f]/g,o;switch(typeof t){case"string":return h.test(t)?'"'+t.replace(h,function(n){var t=i[n];return t?t:(t=n.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+t+'"';case"number":return isFinite(t)?String(t):"null";case"boolean":case"null":return String(t);case"object":if(!t)return"null";if(typeof t.toJSON=="function")return n(t.toJSON());if(e=[],typeof t.length=="number"&&!t.propertyIsEnumerable("length")){for(s=t.length,u=0;u<s;u+=1)e.push(n(t[u],r)||"null");return"["+e.join(",")+"]"}if(r)for(s=r.length,u=0;u<s;u+=1)f=r[u],typeof f=="string"&&(o=n(t[f],r),o&&e.push(n(f)+":"+o));else for(f in t)typeof f=="string"&&(o=n(t[f],r),o&&e.push(n(f)+":"+o));return"{"+e.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"Z"};var i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:n,parse:function(text,filter){function walk(n,t){var i,r;if(t&&typeof t=="object")for(i in t)Object.prototype.hasOwnProperty.apply(t,[i])&&(r=walk(i,t[i]),r!==undefined&&(t[i]=r));return filter(n,t)}var j;if(/^[\],:{}\s]*$/.test(text.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof filter=="function"?walk("",j):j;throw new SyntaxError("parseJSON");}}}()),function(n,t){var i=t.ContentLists=t.ContentLists||{};i.configureList=function(n){var t=i.contentListViewModel(n);return t.additionalAfterRender=i.initGalleryControls(),i.bindAndInitializeList(n,t)};i.configureScroller=function(n){var t=i.contentListViewModel(n);return t.additionalAfterRender=i.applyCyclePlugin(n,t),i.bindAndInitializeList(n,t)};i.configureSearchHighlight=function(n){return i.configureScroller(n)};i.configureSlideshow=function(n){var t=i.contentListViewModel(n);return t.additionalAfterRender=i.initSlideshowControls(n,t),t.afterCarouselRender=i.initCarouselControls(n,t),t.cycleSlideshowComplete=ko.observable(!1),t.cycleCarouselComplete=ko.observable(!1),i.bindAndInitializeList(n,t)};i.bindAndInitializeList=function(n,t){return t.initialize(function(){i.bindList(n,t)})};i.bindList=function(t,i){var u,r;window.viewModels=window.viewModels||{};u="content-list-view-"+t.Id;window.viewModels[u]=i;r=n("#"+t.Id).get(0);r&&window.ko.applyBindings(i,r)};i.applyCyclePlugin=function(n,t){return function(r){i.cycle(r,n,t)}};i.initGalleryControls=function(){n(".sortAnchor").die().live("click",function(){n(".sortResultView li").addClass("hideSort");n(".sortResultView").toggle()});n(".sortResultView li a").die().live("click",function(){n(".sortResultView li").removeClass("selected");n(this).parent("li").addClass("selected");n(".sortResultView").toggle()});n(document).live("click",function(t){n(t.target).parents(".sortingViewResult").length==0&&n(".sortResultView").hide()})};i.initSlideshowControls=function(t,r){return function(u){var e=n("#"+t.Id+" .slideshow ul"),f;if(e){e.on("cycle-initialized",function(){r.cycleSlideshowComplete(!0)});if(f=e.find(".img-wrapper img").first(),f){f.one("load",function(){i.cycle(u,t,r)});n("html").hasClass("lt-ie9")&&f.attr("src",f.attr("slide-src"))}e.on("cycle-next cycle-prev cycle-pager-activated",function(i,r){var u=n("#"+t.Id+" .carousel ul");u&&(u.data("cycle.API")?u.cycle("goto",r.currSlide):u.cycle({startingSlide:r.currSlide}))});if(n("html").hasClass("lt-ie9"))e.on("cycle-before",function(t,i){var r=i.nextSlide;r=r>i.slideCount-1?i.slideCount-1:r<0?0:r;f=n(i.slides[r]).find(".img-wrapper img").first();f&&f.attr("src",f.attr("slide-src"))})}}};i.initCarouselControls=function(t,r){return function(u){var f=n("#"+t.Id+" .carousel ul"),e;if(f){e=r.VisibleThumbnails(r.items().length);f.on("cycle-initialized",function(t,i){r.cycleCarouselComplete(!0);n(i.slides[0]).addClass("cycle-slide-active");i.currSlide===0?n(i.prev).addClass("disabled"):n(i.prev).removeClass("disabled");i.currSlide+e>=i.slideCount&&n(i.next).addClass("disabled")});t.slideshowSettings={carouselVisible:e};i.cycle(u,t,r);f.on("cycle-after",function(i,r){var f=n("#"+t.Id+" .slideshow ul"),u;f&&(u=f.data("cycle.API"),u&&(n(r.slides).removeClass("cycle-slide-active"),n(r.slides[u.opts().currSlide]).addClass("cycle-slide-active")));r.nextSlide===0||r.slideCount<=e?n(r.prev).addClass("disabled"):n(r.prev).removeClass("disabled");r.nextSlide+e>=r.slideCount?n(r.next).addClass("disabled"):n(r.next).removeClass("disabled")});f.on("cycle-prev",function(n,t){var r=t.slideCount-e,i;t.nextSlide>r&&(i=r-1,f.data("cycle.API")?f.cycle("goto",i):f.cycle({startingSlide:i}))});n("li.cycle-slide",f).click(function(){var u=n(this).parents("ul").data("cycle.API"),i=u.getSlideIndex(this),e=u.opts().slideCount,r;i>e&&(i=i%e);f.cycle("goto",i);r=n("#"+t.Id+" .slideshow ul");r&&(r.data("cycle.API")?r.cycle("goto",i):r.cycle({startingSlide:i}),n(u.opts().slides).removeClass("cycle-slide-active"),n(u.opts().slides[i]).addClass("cycle-slide-active"))})}}};i.cycle=function(t,i,r){for(var u,e,o,f=0;f<t.length;f++)if((u=n(t[f]),typeof u.data("cycle.API")!="object")&&(u.hasClass("list-item")||(u=n(".list-item",u)),e=n("li",u),e.length)){i&&i.scrollerSettings?r.renderingCompletedSuccessfully()===!0?u.slick(i.scrollerSettings):o=r.renderingCompletedSuccessfully.subscribe(function(n){n===!0&&(u.slick(i.scrollerSettings),o.dispose())}):i&&i.slideshowSettings?u.cycle(i.slideshowSettings):u.cycle();break}}}(jQuery,window.GeneralMills||(window.GeneralMills={})),function(n,t,i){i.SearchBox=i.SearchBox||{};i.SearchBox=function(){var u,f=function(u){var f=this,e;f.settings=u;f.searchBoxText=ko.observable("");f.placeholderText=u.SearchDefaultText;f.searchBoxEnable=ko.observable(!0);f.searchBoxHasFocus=ko.observable(!1);f.showHints=ko.observable(!1);f.searchHintsHtml=ko.observable();f.getSearchTermForDataSource=function(){var n=r.getSearchTerm(),t=r.getSearchTermDataSource();return t===u.DataSourceId?n:"undefined"};f.OnSearchButtonClick=function(){var e=n.trim(f.searchBoxText()),t=encodeURIComponent(e),o=f.getSearchTermForDataSource(),i;if(t==""){f.searchBoxText("");f.searchBoxHasFocus(!0);return}t!==o&&(i=f.settings.AutocompleteSearchPath+"?term="+t+"&termDataSource="+u.DataSourceId,f.searchBoxEnable(!1),r.setHref(i));f.searchBoxHasFocus(!0)};f.getDataSourceType=function(){n("#"+u.Id).find(".search-box").autocomplete({source:function(t){var i=n.trim(t.term).toLowerCase();if(i!==""){var e=this.element,r=this.element.data("autocompleteCache")||{},u=!1;(result=[],n.each(r,function(t,r){if(i.indexOf(t)>0&&r.length>0){n.each(r,function(n,t){actVal=t.toLowerCase();actVal.indexOf(i)===0&&result.push(t)});u=!0;return}}),u)||f.doSearch(i,function(n){r[i]=n;e.data("autocompleteCache",r);n.indexOf("ul")>-1?(f.searchHintsHtml(n),f.showHints(!0)):f.showHints(!1)})}},minLength:f.settings.MinimumSearchHintCharacters,search:function(n){var t=n.which;return t===i.DOWN||t===i.UP?!1:!0}})};f.doSearch=function(t,i){return n.ajax({type:"Post",url:"SearchHints.ashx?searchterm="+t+"&contentType="+u.ContentTypeFilter+"&language="+u.Language+"&disableSearchTerms="+!u.EnableSearchTerms,success:function(n){n.indexOf("<div class='searchHints'>")==0&&i(n)}})};f.parseAutoCompleteResultsByLimit=function(n){var t=n,i=[];return i[0]={data:[t],value:t,result:[t]},i};f.hideHints=function(t){n(t.target).parents(".search-box-hints").length||f.showHints(!1)};o();n("html").on("click",f.hideHints);n(".search-box-hints").off().on("keyup",function(t){var f=t.which;if(f!==i.DOWN&&f!==i.UP)return!0;var e=n(this),r=e.find(".searchHints ul li"),u=r.filter(".selected"),o=r.index(u);(n(".searchHints ul li").removeClass("selected"),r.length)&&(f===i.DOWN?u.length?u.is(r.last())?e.find(".search-box").focus():r.eq(o+1).addClass("selected"):r.first().addClass("selected"):f===i.UP&&(u.length?u.is(r.first())?e.find(".search-box").focus():r.eq(o-1).addClass("selected"):r.last().addClass("selected")),t.preventDefault())});n(".search-box-container").off().on("keypress",function(r){if(r.which===i.ENTER){r.preventDefault();var u=n(this),f=u.find(".selected");if(f.length){t.location.href=f.find("a:first").attr("href");return}r.which===i.ENTER&&u.find(".SearchLinkButton").click()}});e=f.getSearchTermForDataSource();e!=="undefined"&&f.searchBoxText(e)},e=function(n){u=new f(n);ko.applyBindings(u,document.getElementById(n.Id))},r=function(){var i={};return i.getSearchTerm=function(){return decodeURIComponent(n.parseQueryStringExcludingHash().term).replace(/\+/g," ")},i.getSearchTermDataSource=function(){return decodeURIComponent(n.parseQueryStringExcludingHash().termDataSource).replace(/\+/g," ")},i.setHref=function(n){t.location.href=n},i}(),o=function(){n.extend({parseQueryStringExcludingHash:function(){var i={},r=t.location.search.replace("?",""),u=t.location.hash,f=r.replace(u,"").split("&");return n.each(f,function(n,t){var r=t.split("=");i[r[0]]=r[1]}),i}})},i={UP:38,DOWN:40,ENTER:13};return{init:e,viewModel:f,utils:r}}()}(jQuery,window,window.GeneralMills||(window.GeneralMills={})),function(n){n.DoubleClick=n.DoubleClick||{};var t=!1,i=function(i){i.MinPageWidth=i.MinPageWidth||i.DefaultMinPageWidth;i.MaxPageWidth=i.MaxPageWidth||i.DefaultMaxPageWidth;var r={adSlotSettings:{}},u={};return i=i||{},i.testMode&&(u.internal=r),r.constants={defaultLyticsWaitTime:9999,refreshTargetingKey:"refresh",refreshTargetingValue:"true"},u.settings=i,u.userClosedAd=ko.observable(!1),r.parseAdSizeArray=function(n){try{return JSON.parse(n)}catch(t){return console.log(t),null}},r.renderAdSlot=function(i){n.DoubleClick.Utilities.startTimer(r.adSlotSettings.adContainerId,"adDisplayRequested");window.googletag.cmd.push(function(){t&&console.log("[DoubleClick] Render requested. AdId: "+r.adSlotSettings.adId);var u=r.adSlotSettings.networkCode+r.adSlotSettings.adId,n=window.googletag.defineSlot(u,r.adSlotSettings.adSize,r.adSlotSettings.adContainerId);if(!n){t&&console.log("[DoubleClick] Unexpected null slot returned from GPT. Unable to render ad. AdId: "+r.adSlotSettings.adId);return}n.addService(window.googletag.pubads());i&&i.key&&(n.setTargeting(i.key,i.segments),t&&console.log("[DoubleClick] Rendering ad with personalization. AdId: "+r.adSlotSettings.adId));r.adSlotSettings.refresh&&(n.setTargeting(r.constants.refreshTargetingKey,r.constants.refreshTargetingValue),t&&console.log("[DoubleClick] Rendering ad with refresh enabled. AdId: "+r.adSlotSettings.adId));window.googletag.display(r.adSlotSettings.adContainerId);window.googletag.pubads().refresh([n])})},r.subscribeToLyticsLoadEvent=function(){if(!window.liosetup.addEntityLoadedCallback){t&&console.log("[DoubleClick] Invalid liosetup callback interface. Bypassing Lytics integration.");r.prepareLyticsAd(null);return}r.lyticsAdContext={adDisplayed:!1,lyticsWaitTimeThreshold:i.LyticsWaitTimeThreshold||r.constants.defaultLyticsWaitTime};window.liosetup.addEntityLoadedCallback(r.handleLyticsLoadEvent);window.setTimeout(r.cancelLyticsWaitAndRenderAd,r.lyticsAdContext.lyticsWaitTimeThreshold)},r.cancelLyticsWaitAndRenderAd=function(){r.lyticsAdContext.adDisplayed||(t&&console.log("[DoubleClick] Lytics wait-time threshold expired. AdId: "+r.adSlotSettings.adId),r.lyticsAdContext.adDisplayed=!0,r.prepareLyticsAd(null))},r.handleLyticsLoadEvent=function(){if(r.lyticsAdContext&&r.lyticsAdContext.adDisplayed!==!0){if(!window.lio){t&&console.log("[DoubleClick] Invalid Lytics API. Unable to display ad.");return}t&&console.log("[DoubleClick] Lytics load event complete. AdId: "+r.adSlotSettings.adId);r.lyticsAdContext.adDisplayed=!0;r.prepareLyticsAd(window.lio.data)}},r.prepareLyticsAd=function(i){n.DoubleClick.Utilities.startTimer(r.adSlotSettings.adContainerId,"lyticsLoaded");var u=null;i&&i.segments&&(u={key:"LyticsSegments",segments:i.segments});u||t&&console.log("[DoubleClick] Missing Lytics segment data. Bypassing integration. AdId: "+r.adSlotSettings.adId);r.renderAdSlot(u)},r.initializeLyticsAd=function(){if(n.DoubleClick.Utilities.startTimer(r.adSlotSettings.adContainerId,"lyticsDataRequested"),t&&console.log("[DoubleClick] Ad render waiting for Lytics. AdId: "+r.adSlotSettings.adId),window.lio&&window.lio.loaded){t&&console.log("[DoubleClick] Lytics already loaded. AdId: "+r.adSlotSettings.adId);r.prepareLyticsAd(window.lio.data);return}r.subscribeToLyticsLoadEvent()},u.showAd=ko.computed(function(){return n.DoubleClick.Utilities.windowWidth()>=Number(i.MinPageWidth)&&n.DoubleClick.Utilities.windowWidth()<=Number(i.MaxPageWidth)&&!u.userClosedAd()}),u.closeAd=function(){u.userClosedAd(!0)},u.loadAd=function(){if(r.adSlotSettings={adId:i.AdId,adContainerId:i.AdContainerId,adSize:r.parseAdSizeArray(i.Size),networkCode:i.NetworkCode,refresh:i.RefreshWhenViewed},n.DoubleClick.Utilities.enableGoogleServicesForPage(i),n.DoubleClick.Utilities.enableLyticsServicesForPage(i),n.DoubleClick.Utilities.createStopWatch(r.adSlotSettings.adContainerId),!u.showAd()||!r.adSlotSettings.adSize){t&&console.log("[DoubleClick] Ad not enabled, bypassing render. AdId: "+r.adSlotSettings.adId);return}i.EnableLyticsIntegration?r.initializeLyticsAd():r.renderAdSlot()},u},r=function(){var r={googleServicesEnabled:!1},i={stopWatches:{}};return i.windowWidth=ko.observable(window.innerWidth),r.constants={refreshTargetingKey:"refresh",refreshTargetingValue:"true",refreshDelaySeconds:30},r.userHasRestrictionCookie=function(){var n=document.cookie.match("(^|[^;]+)\\s*DoubleClickRestrictDataProcessing\\s*=\\s*([^;]+)");return n&&n.pop()==="1"?!0:!1},r.PrivacyOptOut=typeof n.getGlobalSetting=="function"&&n.getGlobalSetting("userPrivacy_TargetingEnabled")==0,r.initializeGoogleTagApi=function(){window.googletag=window.googletag||{};window.googletag.cmd=window.googletag.cmd||[];window.googletag.cmd.push(function(){window.googletag.pubads().disableInitialLoad();window.googletag.pubads().enableAsyncRendering();(r.PrivacyOptOut||r.userHasRestrictionCookie())&&googletag.pubads().setPrivacySettings({restrictDataProcessing:!0})});r.subscribeToGoogleTagImpressionEvent();t&&r.subscribeToGoogleTagEvents()},i.enableGoogleServicesForPage=function(n){r.googleServicesEnabled||(r.googleServicesEnabled=!0,window.googletag.cmd.push(function(){n.RelevantMetadata&&n.RelevantMetadata.length>0&&window.googletag.pubads().setTargeting("keywords",n.RelevantMetadata);window.googletag.enableServices();t&&console.log("[DoubleClick] GPT services enabled for page.")}))},i.enableLyticsServicesForPage=function(n){n.EnableLyticsIntegration&&(window.liosetup=window.liosetup||{},window.liosetup.callback=window.liosetup.callback||[])},r.showTimingData=function(n){if(n){var u=n.getSlotElementId(),f=n.getAdUnitPath(),t=i.stopWatches[u];if(t){var e=i.getTimeSpan(t.adDisplayRequested,t.adLoaded),o=i.getTimeSpan(t.lyticsDataRequested,t.lyticsLoaded)||"NA",r="[DoubleClick][GPT] Ad load complete(contents loaded): "+f+"\r\nLoad Time(ms): "+e;t.lyticsDataRequested&&(r+=", Lytics Wait Time(ms): "+o);console.log(r)}}},r.subscribeToGoogleTagEvents=function(){window.googletag.cmd.push(function(){window.googletag.pubads().addEventListener("slotRenderEnded",function(i){if(i&&i.slot){var r=i.slot.getAdUnitPath(),u=i.slot.getSlotElementId();n.DoubleClick.Utilities.startTimer(u,"adSlotRendered");t&&console.log("[DoubleClick][GPT] Slot is ready(contents loading): "+r)}});window.googletag.pubads().addEventListener("slotOnload",function(i){if(i&&i.slot){var u=i.slot.getSlotElementId();n.DoubleClick.Utilities.startTimer(u,"adLoaded");t&&r.showTimingData(i.slot)}});window.googletag.pubads().addEventListener("slotVisibilityChanged",function(n){if(n&&n.slot){var i=n.slot.getAdUnitPath();t&&console.log("[DoubleClick][GPT] Slot on-screen visibility changed: "+i)}})})},r.subscribeToGoogleTagImpressionEvent=function(){window.googletag.cmd.push(function(){window.googletag.pubads().addEventListener("impressionViewable",function(n){var i,u;n&&n.slot&&(i=n.slot.getAdUnitPath(),t&&console.log("[DoubleClick][GPT] Ad impression officially viewable: "+i),u=n.slot,u.getTargeting(r.constants.refreshTargetingKey).indexOf(r.constants.refreshTargetingValue)>-1&&(t&&console.log("[DoubleClick][GPT] Refresh targeting detected, setting refresh timeout: "+i),setTimeout(function(){t&&console.log("[DoubleClick][GPT] Ad refresh initiated: "+i);googletag.pubads().refresh([u])},r.constants.refreshDelaySeconds*1e3)))})})},i.createStopWatch=function(n){return i.stopWatches[n]?i.stopWatches[n]:(i.stopWatches[n]={adDisplayRequested:0,adSlotRendered:0,adLoaded:0,lyticsDataRequested:0,lyticsLoaded:0},i.stopWatches[n])},i.startTimer=function(n,t){i.stopWatches[n]||i.createStopWatch(n);i.stopWatches[n][t]=Date.now()},i.getTimeSpan=function(n,t){return t-n},i.initialize=function(u){t=!!n.debugDoubleClickComponent||!!window.location.search.match(/debugDoubleClickComponent=true/i);t&&console.log("[DoubleClick] Initializing DoubleClick for page...");i.stopWatches={};r.initializeGoogleTagApi();window.addEventListener("resize",function(){i.windowWidth(window.innerWidth)});u&&u.testMode&&(i.internal=r)},i},u=function(t){var i=new n.DoubleClick.ViewModel(t);n.DoubleClick[t.DoubleClickAdContainerId]=i;ko.applyBindings(i,document.getElementById(t.DoubleClickAdContainerId));i.loadAd()};n.DoubleClick={init:u,ViewModel:i,Utilities:new r};n.DoubleClick.Utilities.initialize()}(window.GeneralMills||(window.GeneralMills={})),function(n){typeof define=="function"&&define.amd?define(["jquery"],n):typeof exports=="object"?n(require("jquery")):n(jQuery)}(function(n,t){function f(t,i){this.element=n(t);this.wrapperElement=n();this.toggleElement=n();this.init(i)}var i="plugin_hideShowPassword",r=["show","innerToggle"],u=32,e=13,o=function(){var n=document.body,t=document.createElement("input"),i=!0;n||(n=document.createElement("body"));t=n.appendChild(t);try{t.setAttribute("type","text")}catch(r){i=!1}return n.removeChild(t),i}(),s={show:"infer",innerToggle:!1,enable:o,className:"hideShowPassword-field",initEvent:"hideShowPasswordInit",changeEvent:"passwordVisibilityChange",props:{autocapitalize:"off",autocomplete:"off",autocorrect:"off",spellcheck:"false"},toggle:{element:'<button type="button">',className:"hideShowPassword-toggle",touchSupport:typeof Modernizr=="undefined"?!1:Modernizr.touchevents,attachToEvent:"click.hideShowPassword",attachToTouchEvent:"touchstart.hideShowPassword mousedown.hideShowPassword",attachToKeyEvent:"keyup",attachToKeyCodes:!0,styles:{position:"absolute"},touchStyles:{pointerEvents:"none"},position:"infer",verticalAlign:"middle",offset:0,attr:{role:"button","aria-label":"Show Password",title:"Show Password",tabIndex:0}},wrapper:{element:"<div>",className:"hideShowPassword-wrapper",enforceWidth:!0,styles:{position:"relative"},inheritStyles:["display","verticalAlign","marginTop","marginRight","marginBottom","marginLeft"],innerElementStyles:{marginTop:0,marginRight:0,marginBottom:0,marginLeft:0}},states:{shown:{className:"hideShowPassword-shown",changeEvent:"passwordShown",props:{type:"text"},toggle:{className:"hideShowPassword-toggle-hide",content:"Hide",attr:{"aria-pressed":"true",title:"Hide Password"}}},hidden:{className:"hideShowPassword-hidden",changeEvent:"passwordHidden",props:{type:"password"},toggle:{className:"hideShowPassword-toggle-show",content:"Show",attr:{"aria-pressed":"false",title:"Show Password"}}}}};f.prototype={init:function(t){if(this.update(t,s)){if(this.element.addClass(this.options.className),this.options.innerToggle&&(this.wrapElement(this.options.wrapper),this.initToggle(this.options.toggle),typeof this.options.innerToggle=="string")){this.toggleElement.hide();this.element.one(this.options.innerToggle,n.proxy(function(){this.toggleElement.show()},this))}this.element.trigger(this.options.initEvent,[this])}},update:function(n,t){return this.options=this.prepareOptions(n,t),this.updateElement()&&this.element.trigger(this.options.changeEvent,[this]).trigger(this.state().changeEvent,[this]),this.options.enable},toggle:function(n){return n=n||"toggle",this.update({show:n})},prepareOptions:function(t,i){var r=t||{},f=[],o;if(i=i||this.options,t=n.extend(!0,{},i,t),r.hasOwnProperty("wrapper")&&r.wrapper.hasOwnProperty("inheritStyles")&&(t.wrapper.inheritStyles=r.wrapper.inheritStyles),t.enable&&(t.show==="toggle"?t.show=this.isType("hidden",t.states):t.show==="infer"&&(t.show=this.isType("shown",t.states)),t.toggle.position==="infer"&&(t.toggle.position=this.element.css("text-direction")==="rtl"?"left":"right"),!n.isArray(t.toggle.attachToKeyCodes))){if(t.toggle.attachToKeyCodes===!0){o=n(t.toggle.element);switch(o.prop("tagName").toLowerCase()){case"button":case"input":break;case"a":if(o.filter("[href]").length){f.push(u);break}default:f.push(u,e)}}t.toggle.attachToKeyCodes=f}return t},updateElement:function(){return!this.options.enable||this.isType()?!1:(this.element.prop(n.extend({},this.options.props,this.state().props)).addClass(this.state().className).removeClass(this.otherState().className),this.updateToggle(),!0)},isType:function(n,i){return i=i||this.options.states,n=n||this.state(t,t,i).props.type,i[n]&&(n=i[n].props.type),this.element.prop("type")===n},state:function(n,i,r){return r=r||this.options.states,n===t&&(n=this.options.show),typeof n=="boolean"&&(n=n?"shown":"hidden"),i&&(n=n==="shown"?"hidden":"shown"),r[n]},otherState:function(n){return this.state(n,!0)},wrapElement:function(t){var i=t.enforceWidth,r;return this.wrapperElement.length||(r=this.element.outerWidth(),n.each(t.inheritStyles,n.proxy(function(n,i){t.styles[i]=this.element.css(i)},this)),this.element.css(t.innerElementStyles).wrap(n(t.element).addClass(t.className).css(t.styles)),this.wrapperElement=this.element.parent(),i===!0&&(i=this.wrapperElement.outerWidth()===r?!1:r),i!==!1&&this.wrapperElement.css("width",i)),this.wrapperElement},initToggle:function(t){if(!this.toggleElement.length){if(this.toggleElement=n(t.element).attr(t.attr).addClass(t.className).css(t.styles).appendTo(this.wrapperElement),this.updateToggle(),this.positionToggle(t.position,t.verticalAlign,t.offset),t.touchSupport){this.toggleElement.css(t.touchStyles);this.element.on(t.attachToTouchEvent,n.proxy(this.toggleTouchEvent,this))}else this.toggleElement.on(t.attachToEvent,n.proxy(this.toggleEvent,this));if(t.attachToKeyCodes.length)this.toggleElement.on(t.attachToKeyEvent,n.proxy(this.toggleKeyEvent,this))}return this.toggleElement},positionToggle:function(n,t,i){var r={};r[n]=i;switch(t){case"top":case"bottom":r[t]=i;break;case"middle":r.top="50%";r.marginTop=this.toggleElement.outerHeight()/-2}return this.toggleElement.css(r)},updateToggle:function(n,t){var i,r;return this.toggleElement.length&&(i="padding-"+this.options.toggle.position,n=n||this.state().toggle,t=t||this.otherState().toggle,this.toggleElement.attr(n.attr).addClass(n.className).removeClass(t.className).html(n.content),r=this.toggleElement.outerWidth()+this.options.toggle.offset*2,this.element.css(i)!==r&&this.element.css(i,r)),this.toggleElement},toggleEvent:function(n){n.preventDefault();this.toggle()},toggleKeyEvent:function(t){n.each(this.options.toggle.attachToKeyCodes,n.proxy(function(n,i){if(t.which===i)return this.toggleEvent(t),!1},this))},toggleTouchEvent:function(n){var t=this.toggleElement.offset().left,i,r,u;t&&(i=n.pageX||n.originalEvent.pageX,this.options.toggle.position==="left"?(t+=this.toggleElement.outerWidth(),r=i,u=t):(r=t,u=i),u>=r&&this.toggleEvent(n))}};n.fn.hideShowPassword=function(){var t={};return n.each(arguments,function(i,u){var f={};if(typeof u=="object")f=u;else if(r[i])f[r[i]]=u;else return!1;n.extend(!0,t,f)}),this.each(function(){var r=n(this),u=r.data(i);u?u.update(t):r.data(i,new f(this,t))})};n.each({show:!0,hide:!1,toggle:"toggle"},function(t,i){n.fn[t+"Password"]=function(n,t){return this.hideShowPassword(i,n,t)}})}),function(n,t,i,r){t.HideShowPasswordBinding=function(){if(typeof i.fn.hideShowPassword!="function")throw"HideShowPasswordBinding requires the jQuery hideShowPassword plugin.";this.init=function(n){i(n).hideShowPassword({show:"infer",innerToggle:!0,toggle:{element:"<span>",verticalAlign:"top",attr:{tabIndex:-1}},wrapper:{enforceWidth:!1,inheritStyles:[],innerElementStyles:[]}})}};r.bindingHandlers.hideShowPassword=new t.HideShowPasswordBinding}(window,window.GeneralMills||(window.GeneralMills={}),jQuery,ko),function(n,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var i=this.length,t=Number(arguments[1])||0;for(t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=i);t<i;t++)if(t in this&&this[t]===n)return t;return-1});Date.prototype.toMSJSON=function(){return"/Date("+this.getTime()+")/"};String.prototype.prettyJson||(String.prototype.prettyJson=function(){for(var r=this,t="",o=["{","}","[","]",",",":"],u=!1,f=0,e=function(){t+="\r\n";for(var n=0;n<f;n++)t+="  "},n,i=0;i<r.length;i++){if(n=r.charAt(i),n==='"'&&r.charAt(i-1)!=="\\"&&(u=!u),u||o.indexOf(n)===-1){t+=n;continue}n==="{"||n==="["||n===","?(n!==","&&f++,t+=n,e()):n==="}"||n==="]"?(f--,e(),t+=n):n===":"&&(t+=n+" ")}return t});n.bindingHandlers.cssClass={init:function(n,i){var r=i();r&&t(n).addClass(r)},update:function(n,i){var r=i();r&&t(n).removeClass(r).addClass(r)}};n.bindingHandlers.watermark={init:function(n,i){var r=i();r&&t(n).watermark(r)},update:function(n,i){var r=i();r&&t(n).watermark(r)}};n.toFormattedJSON=function(t){return n.toJSON(t).prettyJson()};n.bindingHandlers.enterKey={init:function(t,i,r,u){n.utils.registerEventHandler(t,"keyup",function(r){return r.keyCode===13&&(n.utils.triggerEvent(t,"change"),i().call(u,u,r)),!0})}};n.validation.rules.pattern.message="This field is required.";n.validation.configure({registerExtenders:!0,messagesOnModified:!0,errorsAsTitleOnModified:!1,messageTemplate:"customMessageTemplate",insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateElement:!1,errorClass:null,errorElementClass:"",errorMessageClass:"",grouping:{deep:!0,observable:!0}});n.validation.registerExtenders()}(ko,jQuery),function(n,t,i,r){n.reg={userRegistration:{closeRegistartionDialog:function(){n.console&&console.log("no longer used by Registration")},invokeModalResize:function(){n.console&&console.log("no longer used by Registration")},getURLParam:function(){n.console&&console.log("no longer used by Registration")},openRegistrationDialog:function(t){n.reg.userRegistration.modalRequestedParams=t}},sendMessageToiFrames:function(){n.console&&console.log("no longer used by Registration")},listenForMessage:function(){n.console&&console.log("no longer used by Registration")}};i.ModalDialogRegistration=function(u){var f=this,e={},s=t(u),o;this.Init=function(){f.FlowId=s.find(".RegistrationFlowContainer").attr("id");f.Flow=n.RegistrationFlowData[f.FlowId]||{};i.Registration.FullPageRedirect(f.Flow.registrationFlowObj);e=i.Registration.processRegFlow(f.Flow.registrationFlowObj);f.BindModalLinks("[data-reg-popup]");n.reg.userRegistration.openRegistrationDialog=f.BeginRegistration;n.reg.userRegistration.modalRequestedParams&&f.BeginRegistration(n.reg.userRegistration.modalRequestedParams)};this.BindModalLinks=function(n){t(n).live("click",function(n){n.preventDefault();var i=f.ParseRegParams(t(this));f.BeginRegistration(i)})};this.ParseRegParams=function(n){var t=n.attr("data-url-params"),i={};return t&&(i=JSON.parse(t)),i};this.SetupBindings=function(){f.setupBindingsComplete=!0;r.applyBindings(e,u)};this.BeginRegistration=function(n){f.setupBindingsComplete||f.SetupBindings();o||(o=f.CreateModalDialog(s));f.UpdateFlowParameters(n);e.beginRegistration();setTimeout(function(){o.dialog("open")},0)};this.UpdateFlowParameters=function(n){n=n||{};e.IsModalWindow=!0;typeof n.returnUrl!="undefined"&&(e.FullPageToRedirectTo=n.returnUrl);typeof n.isRegistrationFirstStep!="undefined"&&(e.IsRegistrationFirstStep=n.isRegistrationFirstStep);typeof n.RegAction!="undefined"&&(e.RegAction=n.RegAction);typeof n.esrc!="undefined"&&(e.EsrcCode=n.esrc);n&&n.values&&(r.utils.arrayForEach(e.LoginStepFields,function(t){r.utils.arrayForEach(n.values,function(n){t.Id===n.fieldGuid&&t.Value(n.value)})}),r.utils.arrayForEach(e.RegistrationSteps,function(t){r.utils.arrayForEach(t.RegistrationFields(),function(t){r.utils.arrayForEach(n.values,function(n){t.Id===n.fieldGuid&&t.Value(n.value)})})}))};this.CreateModalDialog=function(n){return n.dialog({autoOpen:!1,closeOnEscape:!0,draggable:!1,resizable:!1,modal:!0,width:"auto",height:"auto",open:function(){t(".ui-dialog").css("z-index",1002);t(".ui-widget-overlay").css("z-index",1001)},position:{my:"center top+10",at:"center top"},dialogClass:"registrationDialogClass"})}}}(window,jQuery,window.GeneralMills||(window.GeneralMills={}),ko),function(n,t,i,r){t.Registration=t.Registration||{};t.Registration.Settings={defaultGuid:"00000000-0000-0000-0000-000000000000",confirmPasswordTemplateName:"_registration.passwordconfirm.tmpl",msQuestionTemplateName:"_registration.questionMultiSelect.tmpl",dateOfBirthFieldId:"50e0a718-c5df-49c8-a864-f58906e28330",isLoggedInCookieName:"IsLoggedIn",notEligibleCookieName:"NotEligible",progressBarClassList:["progressBarStep","currentStep","previousStep","futureStep","firstStep","lastStep"],emailFieldId:"20548f2e-3d18-44d0-902c-59b941ded6dd",unicaTagParameters:["RegAction","esrc"],minimumAgeRule:"minimum.age.rule",loginViewName:"LoginView",socialRegViewName:"SocialRegView",socialLinkViewName:"SocialLinkView",validAgeErrorViewName:"ValidAgeErrorView",resetPasswordViewName:"PasswordResetView",registrationViewName:"RegistrationView",anonymousSubscriberErrorId:"isanonymoussubscriber",showNewslettersAmount:3};window.gigya=window.gigya||{};var u={switchToLogin:"switchToLogin.registration",switchToRegistration:"switchToRegistration.registration",switchToForgotPassword:"switchToForgotPassword.registration",login:"login.registration",step:"step.registration",register:"register.registration",reset:"reset.registration"};t.Registration.processRegFlow=function(f){var e=f,o;return e.IsAnonymousSubscriber=i.observable(e.IsAnonymousSubscriber),e.CurrentStep=i.observable(0),e.CurrentView=i.observable(),e.RegActionCTAText=i.observable(e.RegActionCTAText),e.RegActionCTAHeadline=i.observable(e.RegActionCTAHeadline),e.RegActionCTAImageUrl=i.observable(e.RegActionCTAImageUrl),e.RegActionCTAVisible=i.observable(!1),e.RegActionDefaultText=i.computed(function(){return e.CurrentView()===t.Registration.Settings.registrationViewName&&e.RegistrationSteps[e.CurrentStep()]&&e.RegistrationSteps[e.CurrentStep()].CTAText.trim()!==""?e.RegistrationSteps[e.CurrentStep()].CTAText:e.LargeCTAText}),e.registrationSubmitted=!1,o={},o.isInitialViewSet=!1,o.maximumCompletedStep=-1,e.isDateFieldValid=function(n){var t=(n.MonthPart.isModified?n.MonthPart.isModified():!1)&&(n.YearPart.isModified?n.YearPart.isModified():!1)&&(n.DayPart.isModified?n.DayPart.isModified():!1),i=n.YearPart()!==e.GlobalConfiguration.YearWatermarkText&&n.YearPart()&&n.DayPart()!==e.GlobalConfiguration.DayWatermarkText&&n.DayPart()&&n.MonthPart()!==e.GlobalConfiguration.MonthWatermarkText&&n.MonthPart(),r=n.YearPart()&&n.YearPart().toString().length==4;return!t||i&&r},e.isDateFieldFutureOrCurrent=function(n){var t=e.isDateFieldValid(n),i,u,f;return n.Value()===r||(t=!0,i=Date.parse(n.Value()),isNaN(i)===!1&&(u=new Date,f=new Date(n.YearPart(),n.MonthPart()-1,n.DayPart()),f.setHours(0,0,0,0)>=u.setHours(0,0,0,0)&&(t=!1))),t},o.prepareFields=function(n,r){i.utils.arrayForEach(n,function(n){var u,o;if(n.StepNumber=r,n.Value=i.observable(),n.Error=i.observable(""),u=n.Value,n.ViewTemplateName===t.Registration.Settings.confirmPasswordTemplateName)n.ConfirmFieldText=f.GlobalConfiguration.ConfirmPasswordLabelText,n.ConfirmPassword=i.observable(),n.ConfirmPassword.extend({validation:{validator:function(){return n.Error(""),n.Value()===n.ConfirmPassword()},message:e.GlobalConfiguration.ConfirmPasswordErrorMessage}}),n.Value.extend({validation:{validator:function(){return n.Error(""),n.Value()&&n.Value()!==n.PlaceholderText},message:e.GlobalConfiguration.RequiredFieldErrorMessage}}),n.ConfirmPassword.extend({validation:{validator:function(){return n.Error(""),n.ConfirmPassword()&&n.ConfirmPassword()!==n.PlaceholderText},message:e.GlobalConfiguration.RequiredFieldErrorMessage}});else if(n.Id===t.Registration.Settings.dateOfBirthFieldId){for(n.MonthSelectOptions=i.observableArray(f.GlobalConfiguration.MonthNames),n.DaySelectOptions=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],n.YearSelectOptions=[],n.getDatePartsForValidation=function(){var t={month:-1,day:-1,year:-1,isDropDown:!1};return!isNaN(parseFloat(n.MonthPart()))&&isFinite(n.MonthPart())?(t.month=parseFloat(n.MonthPart()),t.day=parseFloat(n.DayPart()),t.year=parseFloat(n.YearPart())):(t.isDropDown=!0,t.month=n.MonthSelectOptions().indexOf(n.MonthPart()),t.day=n.DayPart(),t.year=n.YearPart()),t},n.MonthPart=i.observable(),n.DayPart=i.observable(),n.YearPart=i.observable(),n.YearPart.extend({validation:[{validator:function(){return n.Error(""),e.isDateFieldValid(n)},message:e.GlobalConfiguration.InvalidDateErrorMessage},{validator:function(){return n.Error(""),e.isDateFieldFutureOrCurrent(n)},message:e.GlobalConfiguration.FutureBirthdateErrorMessage}]}),n.Value=i.computed(function(){var t=n.getDatePartsForValidation();return t.month+(t.isDropDown?1:0)+"/"+t.day+"/"+t.year}),o=(new Date).getFullYear();o>=1900;o--)n.YearSelectOptions.push(o);n.forceUpdate=function(){n.DayPart.valueHasMutated();n.MonthPart.valueHasMutated();n.YearPart.valueHasMutated()};u=n.YearPart}n.IsMandatory&&n.Value.extend({validation:{validator:function(){return n.Error(""),n.Value()&&n.Value()!==n.PlaceholderText},message:e.GlobalConfiguration.RequiredFieldErrorMessage}});n.CssClass=i.computed(function(){var t=(n.FieldName||"").replace(" ","");return(u&&u.isValid&&u.isModified&&!u.isValid()&&u.isModified()||n.Error())&&(t+=" error"),t},n);e.setValueFromUrlHash(n)})},e.setValueFromUrlHash=function(n){var u=t.Registration.Utils.getHashParameterByName(n.Id),r,i;if(n.Id===t.Registration.Settings.dateOfBirthFieldId){if(r=Date.parse(u),isNaN(r))return;i=new Date(r);n.ViewTemplateName==="_registration.dateofbirthdropdown.tmpl"?n.MonthPart(n.MonthSelectOptions()[i.getUTCMonth()]):n.MonthPart(i.getUTCMonth()+1);n.DayPart(i.getUTCDate());n.YearPart(i.getUTCFullYear())}else typeof n.Value=="function"&&n.Value(u)},o.prepareSteps=function(n,r){i.utils.arrayForEach(n,function(n){o.prepareFields(n.RegistrationFields,n.StepNumber);n.errors=i.validation.group(i.observableArray(n.RegistrationFields),{deep:!0});n.IsCurrentStep=i.computed(function(){return e.CurrentStep()===n.StepNumber});n.progressBarClass=i.computed(function(){var i=[],r=n.StepNumber;return i.push(t.Registration.Settings.progressBarClassList[0]),n.IsCurrentStep()?i.push(t.Registration.Settings.progressBarClassList[1]):r<e.CurrentStep()?i.push(t.Registration.Settings.progressBarClassList[2]):r>e.CurrentStep()&&i.push(t.Registration.Settings.progressBarClassList[3]),r===0?i.push(t.Registration.Settings.progressBarClassList[4]):r===e.RegistrationSteps.length-1&&i.push(t.Registration.Settings.progressBarClassList[5]),i.join(" ")});n.gigyaContainerId="gigyaLogin_"+e.Id+"_"+r+n.StepNumber;n.RegistrationFields=i.observableArray(n.RegistrationFields)})},o.publishEvent=function(t){var i=[];if(t===u.step){if(o.maximumCompletedStep>=e.CurrentStep())return o;i.push(e.CurrentStep());i.push(e.RegistrationSteps[e.CurrentStep()].StepName)}return n.publish(t,i),window.console&&window.console.log("[Registration] Published '"+t+"' event"),o},e.registeredEmail="",e.gigyaResponse=r,e.initialProfileResponse=r,e.LoginStepFields=[{Id:"20548f2e-3d18-44d0-902c-59b941ded6dd",FieldName:"Email-TextBox",Label:e.UsernameLabel,IsMandatory:!0,FieldSize:0,NewsletterLink:null,HintText:null,CssClass:"Email-TextBox",FieldLabelLinkName:"8efbedd2-b10c-4a41-afcf-c75e78cef861",ViewTemplateName:"_registration.email.tmpl",PlaceholderText:null,SelectOptions:[]},{Id:"9be899c2-2bc3-4626-a443-416ea7ef39bd",FieldName:"Password-Password",Label:e.PasswordLabel,IsMandatory:!0,FieldSize:0,NewsletterLink:null,HintText:null,CssClass:"Password-Password",FieldLabelLinkName:"eb36e3a5-3ec3-4997-8109-560bcc6bb9a6",ViewTemplateName:"_registration.password.tmpl",PlaceholderText:null,SelectOptions:[]},{Id:"1fff8f9d-4004-4d75-8a0c-5579da00d78a",FieldName:"RememberMe-Checkbox",Label:e.RememberMeLabel,IsMandatory:!1,FieldSize:0,NewsletterLink:null,HintText:null,CssClass:"RememberMe-Checkbox",FieldLabelLinkName:"fcb00308-1808-42ee-b486-3c50b2783bd5",ViewTemplateName:"_registration.checkbox.tmpl",PlaceholderText:null,SelectOptions:[]}],e.FederatedCurrentUserDisplayFields=[{Id:"20548f2e-3d18-44d0-902c-59b941ded6dd",FieldName:"Email-TextBox",Label:e.FederatedCurrentUserEmailLabel,IsMandatory:!0,FieldSize:0,NewsletterLink:null,HintText:null,CssClass:"Email-TextBox",FieldLabelLinkName:"293951c3-dd02-4753-8fc4-19c94147101c",ViewTemplateName:"_registration.email.tmpl",PlaceholderText:null,SelectOptions:[]},{Id:"9be899c2-2bc3-4626-a443-416ea7ef39bd",FieldName:"Password-Password",Label:e.FederatedCurrentUserPasswordLabel,IsMandatory:!0,FieldSize:0,NewsletterLink:null,HintText:null,CssClass:"Password-Password",FieldLabelLinkName:"28dc928a-fc1e-4167-981d-efadc60520fc",ViewTemplateName:"_registration.password.tmpl",PlaceholderText:null,SelectOptions:[]}],e.PasswordResetFields=[{Id:"20548f2e-3d18-44d0-902c-59b941ded6dd",FieldName:"Email-TextBox",Label:e.UsernameLabel,IsMandatory:!0,FieldSize:0,NewsletterLink:null,HintText:null,CssClass:"Email-TextBox",FieldLabelLinkName:"0d176262-fa07-4111-9a66-707117f4d8de",ViewTemplateName:"_registration.email.tmpl",PlaceholderText:null,SelectOptions:[]}],e.PasswordResetButtons=[{Id:"PasswordResetButton"+e.Id,Action:"PasswordReset",DisplayText:e.GlobalConfiguration.ResetPasswordButtonText}],o.prepareFields(e.LoginStepFields,0),o.prepareFields(e.LoginStepNewsletterFields,0),o.prepareFields(e.FederatedCurrentUserDisplayFields,0),o.prepareFields(e.PasswordResetFields,0),o.prepareSteps(e.RegistrationSteps,t.Registration.Settings.registrationViewName),o.prepareSteps(e.SocialRegistrationSteps,t.Registration.Settings.socialRegViewName),e.registeredUnicaTags=i.observableArray(),e.error=i.observable(),e.gigyaContainerId="gigyaLogin_"+e.Id+"_"+t.Registration.Settings.loginViewName,e.loginStepId="gmi"+e.Id+"_"+t.Registration.Settings.loginViewName+"_",e.SwitchToLoginView=function(){e.error("");e.CurrentStep(0);e.CurrentView(t.Registration.Settings.loginViewName);o.isInitialViewSet&&o.publishEvent(u.switchToLogin)},e.SwitchToRegistrationView=function(){if(e.error(""),e.readCookie(t.Registration.Settings.notEligibleCookieName)){e.SwitchToValidAgeErrorView();return}e.CurrentStep(0);e.CurrentView(t.Registration.Settings.registrationViewName);o.isInitialViewSet&&o.publishEvent(u.switchToRegistration);e.createGigyaLoginUI(e.RegistrationSteps[0].gigyaContainerId)},e.SwitchToValidAgeErrorView=function(){e.CurrentStep(0);e.createCookie(t.Registration.Settings.notEligibleCookieName,t.Registration.Settings.notEligibleCookieName);e.CurrentView(t.Registration.Settings.validAgeErrorViewName)},e.SwitchToForgotPasswordView=function(){e.error("");e.CurrentStep(0);e.CurrentView(t.Registration.Settings.resetPasswordViewName);o.publishEvent(u.switchToForgotPassword)},e.SwitchToSocialRegistrationView=function(){e.error("");e.CurrentStep(0);i.utils.arrayForEach(e.SocialRegistrationSteps,function(n){i.utils.arrayForEach(n.RegistrationFields(),function(n){n.Id===t.Registration.Settings.emailFieldId&&n.Value(e.gigyaResponse.user.email)})});e.CurrentView(t.Registration.Settings.socialRegViewName)},e.SwitchToSocialConfirmAccountViewView=function(n){e.error("");e.CurrentStep(0);e.FederatedCurrentUserDisplayFields[0].Value(n?n:e.gigyaResponse.user.email);e.CurrentView(t.Registration.Settings.socialLinkViewName)},e.regRedirectUrl=function(n){var i=t.Registration.Utils.getCurrentHrefWithoutHash(),r=t.Registration.Utils.getParameterByName("returnUrl"),u=t.Registration.Utils.getParameterByName("RefUrl"),f;e.oAuthRedirectUrl?i=e.oAuthRedirectUrl:u?i=u:r?i=r:n?i=n:e.RegistrationRedirectUrl&&(i=e.RegistrationRedirectUrl);e.CurrentView()===t.Registration.Settings.registrationViewName&&e.ThankYouEnabled&&e.ThankYouRedirectUrl&&(f=e.ThankYouRedirectUrl.indexOf("?")!==-1?"&":"?",i=e.ThankYouRedirectUrl+f+"redirectUrl="+i);try{(i.toLowerCase().startsWith("javascript:")||new URL(i).protocol=="javascript:")&&(i="")}catch(o){}return decodeURIComponent(i)},e.redirectAction=function(n){typeof n!="string"&&(n="");var t=e.regRedirectUrl(n);setTimeout(function(){window.location.href=t},1e3)},e.HasErrors=function(n){var t=i.validation.group(i.observableArray(n),{deep:!0});return t().length===0?!1:(t.showAllMessages(),!0)},e.Login=function(){var r,f;e.HasErrors(e.LoginStepFields)||(r=[],i.utils.arrayForEach(e.LoginStepNewsletterFields,function(n){n.Value()&&r.push({Name:n.Id,Value:n.Value()})}),f=JSON.stringify({requestData:{Password:e.LoginStepFields[1].Value(),Email:e.LoginStepFields[0].Value(),RememberMe:e.LoginStepFields[2].Value()?e.LoginStepFields[2].Value():!1,FederatedToken:"",RequestUrl:t.Registration.Utils.getCurrentHrefWithoutHash(),IsModal:e.IsModalWindow,SelectedNewsletters:r}}),e.IsAnonymousSubscriber(!1),n.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/Shared/Registration/Services/RegistrationService.asmx/Authenticate",data:f,dataType:"json",cache:!1,success:function(n){n.d.IsValid?(e.createCookie(t.Registration.Settings.isLoggedInCookieName,1),t.Analytics.raiseEvent({EventType:"Login",UserId:n.d.ProfileUserId,UserStatus:n.d.AccessLevel}),e.raiseNewsletterLoginEvent(),o.publishEvent(u.login),n.d.OauthRedirectUrl&&(e.oAuthRedirectUrl=n.d.OauthRedirectUrl),e.redirectAction(e.LoginRedirectUrl)):n.d.Messages&&n.d.Messages.length>0&&n.d.Messages[0].RuleId==t.Registration.Settings.anonymousSubscriberErrorId?(e.IsAnonymousSubscriber(!0),e.SwitchToRegistrationView()):e.LoginErrorText?e.error(e.LoginErrorText):n.d.Messages.length>0?e.error(n.d.Messages[0].Message):e.error("invalid email or password")},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}}))},e.raiseNewsletterLoginEvent=function(){var n=e.LoginStepNewsletterFields.filter(function(n){return n.Value()}),t=n.map(function(n){return n.Label}),i=n.map(function(n){return n.Id});i.length>0&&t.length>0&&e.fireNewsletterOptInEvent({newsletterNames:t,newsletterIds:i})},e.ButtonClick=function(n,i){switch(i.Action){case"Sign Up":e.CurrentView()===t.Registration.Settings.socialLinkViewName?e.FederatedLink():e.SwitchToRegistrationView();break;case"Cancel":o.setDefaultView();break;case"Login":e.Login();break;case"Next":e.ValidateAndMoveToNextStep(n);break;case"Back":e.MoveToPreviousStep(n);break;case"Subscribe":e.SubscriptionEvent(n);break;case"Answer":e.AnswerEvent(n);break;case"Submit":e.SubmitAction(n);break;case"PasswordReset":e.ResetPassword()}},e.isStepValid=function(n){i.utils.arrayForEach(n.RegistrationFields(),function(n){n.forceUpdate&&n.forceUpdate()});var t=i.validation.group(i.observableArray(n.RegistrationFields()),{deep:!0});return t().length===0?!0:(n.errors.showAllMessages(),!1)},e.IsEmailInUse=function(t,i){var r=JSON.stringify({email:i});n.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/Shared/Registration/Services/RegistrationService.asmx/IsEmailInUse",data:r,dataType:"json",cache:!1,success:function(n){n.d?(e.initialProfileResponse="IdentityConflict",e.SwitchToSocialConfirmAccountViewView(i)):e.SubmitRegistration(t)},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})},o.hideFieldErrors=function(){i.utils.arrayForEach(e.CurrentViewSteps(),function(n){i.utils.arrayForEach(n.RegistrationFields(),function(n){n.Error("")})})},e.ShowThankYouStep=i.computed(function(){return e.ThankYouEnabled&&!e.ThankYouRedirectUrl&&e.ThankYouContent&&e.CurrentStep()===-1}),e.newsletterFields=function(){return e.CurrentViewSteps().reduce(function(n,t){return n.concat(t.RegistrationFields())},[]).filter(function(n){return n.IsNewsletter})},e.getSubscribedNewsletters=function(){return e.newsletterFields().filter(function(t){return n("#"+t.FieldLabelLinkName).prop("checked")})},e.SubmitRegistration=function(i){var f=e.gigyaResponse?"/Shared/Registration/Services/RegistrationService.asmx/SubmitFederatedRegistrationForm":"/Shared/Registration/Services/RegistrationService.asmx/SubmitRegistrationForm",s=e.gigyaResponse?e.SocialRegistrationSteps:e.RegistrationSteps,r={nvps:i,requestUrl:location.href,isModal:e.IsModalWindow};e.gigyaResponse&&(r.credentials={UId:e.gigyaResponse.UID,UIdSig:e.gigyaResponse.UIDSig,SocialEmail:e.gigyaResponse.user.email,Timestamp:e.gigyaResponse.timestamp,LinkCredentials:null,LoginProvider:e.gigyaResponse.user.loginProvider,LoginProviderUId:e.gigyaResponse.user.loginProviderUID});n.ajax({type:"POST",url:f,data:JSON.stringify(r),contentType:"application/json",dataType:"json",cache:!1,success:function(n){o.hideFieldErrors();n.d.Errors.length>0?e.DisplayStepFieldErrors(n.d.Errors):(e.registrationSubmitted=!0,e.registeredEmail=n.d.Email||e.registeredEmail,e.createCookie(t.Registration.Settings.isLoggedInCookieName,1),e.raiseNewsletterSubscriptionEvent(),e.raiseAnalyticsEventForStep(n.d),o.publishEvent(u.step).publishEvent(u.register),n.d.OauthRedirectUrl&&(e.oAuthRedirectUrl=n.d.OauthRedirectUrl),e.MoveToNextStep(s[e.CurrentStep()]))},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})},e.FederatedLink=function(){var r=i.validation.group(i.observableArray(e.FederatedCurrentUserDisplayFields),{deep:!0}),f;if(r().length!==0){r.showAllMessages();return}f=JSON.stringify({request:{UId:e.gigyaResponse.UID,UIdSig:e.gigyaResponse.UIDSig,SocialEmail:e.gigyaResponse.user.email,Timestamp:e.gigyaResponse.timestamp,LinkCredentials:{UserName:e.FederatedCurrentUserDisplayFields[0].Value(),Password:e.FederatedCurrentUserDisplayFields[1].Value()},LoginProvider:e.gigyaResponse.user.loginProvider,LoginProviderUId:e.gigyaResponse.user.loginProviderUID}});n.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/Shared/Registration/Services/RegistrationService.asmx/FederatedLink",data:f,dataType:"json",cache:!1,success:function(n){switch(n.d.Result){case"Success":e.createCookie(t.Registration.Settings.isLoggedInCookieName,1);t.Analytics.raiseEvent({EventType:"Login",UserId:n.d.ProfileUserId,UserStatus:n.d.AccessLevel});o.publishEvent(u.login);e.redirectAction();break;default:e.error(e.GlobalConfiguration.GeneralErrorMessage)}},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})},e.CurrentViewSteps=i.computed(function(){return e.CurrentView()===t.Registration.Settings.registrationViewName?e.RegistrationSteps:e.CurrentView()===t.Registration.Settings.socialRegViewName?e.SocialRegistrationSteps:[]}),e.SubmitAction=function(n){if(e.isStepValid(n)){var u=[],f=r;i.utils.arrayForEach(e.CurrentViewSteps(),function(n){n.StepNumber<=e.CurrentStep()&&i.utils.arrayForEach(n.RegistrationFields(),function(n){n.ViewTemplateName===t.Registration.Settings.msQuestionTemplateName?i.utils.arrayForEach(n.SelectOptions,function(n){u.push({Name:n.DataValue,Value:n.Selected})}):(n.Id===t.Registration.Settings.emailFieldId&&(f=n.Value()),u.push({Name:n.Id,Value:n.Value()?n.Value():""}))})});e.gigyaResponse?e.initialProfileResponse==="NotFound"?e.IsEmailInUse(u,f):e.FederatedLink():e.SubmitRegistration(u)}},e.MoveToPreviousStep=function(n){e.IsModalWindow||t.Registration.Utils.scrollTop();e.CurrentViewSteps().indexOf(n)>0&&e.CurrentStep(n.StepNumber-1);e.CurrentStep()===0&&e.createGigyaLoginUI(e.RegistrationSteps[0].gigyaContainerId)},e.IsLastStep=i.computed(function(){return e.CurrentStep()===e.CurrentViewSteps().length-1},this),e.SubscriptionEvent=function(n){e.registrationSubmitted?e.SubscribeToSelectedNewsletters(n):e.MoveToNextStep(n)},e.AnswerEvent=function(n){e.registrationSubmitted?e.SaveQuestionAnswers(n):e.MoveToNextStep(n)},e.DisplayStepFieldErrors=function(n){var s=i.observableArray([]),u=100,h=!1,c=[],f,r,o;for(i.utils.arrayForEach(e.CurrentViewSteps(),function(n){n.StepNumber<=e.CurrentStep()&&i.utils.arrayForEach(n.RegistrationFields(),function(n){s.push(n)})}),f=0;f<n.length;f++)if(r=n[f],o=!1,r.RuleId===t.Registration.Settings.minimumAgeRule){h=!0;e.SwitchToValidAgeErrorView();break}else i.utils.arrayFirst(s(),function(n){n.Id===r.FieldId&&(o=!0,n.Error(r.Message),n.StepNumber<u&&(u=n.StepNumber))}),o?e.error(""):c.push(r);h||(c.length>0&&e.error(e.GlobalConfiguration.GeneralErrorMessage),e.CurrentStep(u===100?0:u))},e.SubscribeToSelectedNewsletters=function(t){var r,u;e.registeredEmail&&(r=[],i.utils.arrayForEach(t.RegistrationFields(),function(n){r.push({Name:n.Id,Value:n.Value()})}),u=JSON.stringify({email:e.registeredEmail,nvps:r}),n.ajax({type:"POST",url:"/Shared/Registration/Services/RegistrationService.asmx/NewsletterSubscribe",data:u,contentType:"application/json",dataType:"json",success:function(){e.raiseNewsletterSubscriptionEvent();e.MoveToNextStep(t)},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}}))},e.SaveQuestionAnswers=function(t){var r=[],u;i.utils.arrayForEach(t.RegistrationFields(),function(n){i.utils.arrayForEach(n.SelectOptions,function(n){r.push({Name:n.DataValue,Value:n.Selected})})});u=JSON.stringify({nvps:r});n.ajax({type:"POST",url:"/Shared/Registration/Services/RegistrationService.asmx/SaveQuestionAnswers",data:u,contentType:"application/json",dataType:"json",success:function(){e.MoveToNextStep(t)},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})},e.ValidateAndMoveToNextStep=function(r){var u,f;e.isStepValid(r)&&(u=[],i.utils.arrayForEach(r.RegistrationFields(),function(n){u.push({Name:n.Id,Value:n.Value()})}),f=JSON.stringify({nvps:u}),n.ajax({type:"POST",url:"/Shared/Registration/Services/RegistrationService.asmx/ValidateFields",data:f,contentType:"application/json",dataType:"json",success:function(n){var u,f;if(o.hideFieldErrors(),n.d.Errors.length>0)for(u=0;u<n.d.Errors.length;u++)f=n.d.Errors[u],i.utils.arrayFirst(r.RegistrationFields(),function(n){f.RuleId===t.Registration.Settings.minimumAgeRule&&e.SwitchToValidAgeErrorView();n.Id===f.FieldId&&n.Error(f.Message)});else e.MoveToNextStep(r)},error:function(n){e.error(n)}}))},e.MoveToNextStep=function(n){e.CurrentViewSteps()[e.CurrentStep()].RegistrationStepButtons.some(function(n){return n.Action==="Submit"||n.Action=="Login"})||e.raiseAnalyticsEventForStep();e.IsLastStep()?e.ThankYouEnabled&&!e.ThankYouRedirectUrl?e.CurrentStep(-1):e.redirectAction():(e.IsModalWindow||t.Registration.Utils.scrollTop(),o.publishEvent(u.step),o.maximumCompletedStep=Math.max(o.maximumCompletedStep,e.CurrentStep()),n.StepNumber<e.CurrentViewSteps().length&&e.CurrentStep(n.StepNumber+1))},e.RegistrationEnterKeyPress=function(n,t){var r=e.CurrentViewSteps()[e.CurrentStep()];i.utils.arrayForEach(r.RegistrationStepButtons,function(n){(n.Action==="Next"||n.Action==="Submit"||n.Action==="Subscribe"||n.Action==="Answer")&&t.target.tagName.toLowerCase()!=="button"&&e.ButtonClick(r,n)})},e.readCookie=function(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1,t.length);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return null},e.createCookie=function(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString());document.cookie=n+"="+t+u+"; domain="+location.hostname.substring(location.hostname.indexOf("."))+"; path=/"},e.oAuthOnError=function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)},e.oAuthOnLogin=function(i){e.gigyaResponse=i;var r=JSON.stringify({request:{UId:e.gigyaResponse.UID,UIdSig:e.gigyaResponse.UIDSig,SocialEmail:e.gigyaResponse.user.email,Timestamp:e.gigyaResponse.timestamp,LinkCredentials:null,LoginProvider:e.gigyaResponse.user.loginProvider,LoginProviderUId:e.gigyaResponse.user.loginProviderUID}});n.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/Shared/Registration/Services/RegistrationService.asmx/FederatedLogin",data:r,dataType:"json",cache:!1,success:function(n){e.initialProfileResponse=n.d.Result;e.initialProfileResponse==="Success"?(e.createCookie(t.Registration.Settings.isLoggedInCookieName,1),t.Analytics.raiseEvent({EventType:"Login",UserId:n.d.ProfileUserId,UserStatus:n.d.AccessLevel}),o.publishEvent(u.login),e.redirectAction(e.LoginRedirectUrl)):e.initialProfileResponse==="IdentityConflict"?e.SwitchToSocialConfirmAccountViewView():e.initialProfileResponse==="NotFound"?e.SwitchToSocialRegistrationView():e.error(e.GlobalConfiguration.GeneralErrorMessage)},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})},e.raiseNewsletterSubscriptionEvent=function(){var n=e.getSubscribedNewsletters(),t=n.map(function(n){return n.Label}),i=n.map(function(n){return n.Id});i.length>0&&t.length>0&&e.fireNewsletterOptInEvent({newsletterNames:t,newsletterIds:i})},e.fireNewsletterOptInEvent=function(n){var t={EventType:"NewsletterOptIn",NewsletterTitle:n.newsletterNames,NewsletterId:n.newsletterIds},i=o.getRegAction();return i&&(t.RegAction=i),GeneralMills.Analytics.raiseEvent(t),!1},e.raiseAnalyticsEventForStep=function(n){var r=e.IsModalWindow?"Modal":"NonModal",u=n?"Complete":"Step"+Number(e.CurrentStep()+1),f="/registration/"+e.getCurrentStepDescription()+"/"+r.toLowerCase()+"/"+u,i={EventType:"Registration"+u,Page:f,PageType:"Other",EsrcCode:e.EsrcCode?e.EsrcCode.toString():null,RegDisplayType:r,RegAction:e.RegAction};e.CurrentView()===t.Registration.Settings.socialRegViewName&&e.gigyaResponse&&(i.SocialNetwork=e.titleCaseSocialProviderName(e.gigyaResponse.provider));n&&(i.UserId=n.ProfileUserId,i.UserStatus=n.AccessLevel);t.Analytics.raiseEvent(i,{virtualPageView:!0})},e.titleCaseSocialProviderName=function(n){var t=["googleplus","twitter","facebook"].indexOf(n);return t>=0?["GooglePlus","Twitter","Facebook"][t]:n},e.getCurrentStepDescription=function(){var i=[{id:"Email",name:"email"},{id:"Birth Date",name:"dob"},{id:"PostalCode",name:"postal"},{id:"SchoolCode",name:"school"},{name:"newsletter"}],u=e.getSubscribedNewsletters().map(function(n){return n.Label}),f=e.getCurrentRegistrationStep().RegistrationFields().map(function(n){return n.FieldName}),n,r;if(e.CurrentView()===t.Registration.Settings.socialRegViewName)return"social";for(n=0;n<i.length;n++)if(i[n].name==="newsletter"){for(r=0;r<u.length;r++)if(f.some(function(t){return t[n].indexOf(u[r])}))return i[n].name}else if(f.some(function(t){return t.indexOf(i[n].id)===0}))return i[n].name;return"other"},e.getCurrentRegistrationStep=function(){return e.RegistrationSteps[e.CurrentStep()]},o.setDefaultView=function(){e.IsRegistrationFirstStep?e.SwitchToRegistrationView():e.SwitchToLoginView();e.gigyaResponse=r;o.isInitialViewSet=!0},e.PasswordResetSuccessMessage=i.observable(""),e.ResetPassword=function(){if(e.error(""),e.PasswordResetSuccessMessage(""),!e.HasErrors(e.PasswordResetFields)){var i=JSON.stringify({requestData:{Email:e.PasswordResetFields[0].Value(),RememberMe:!1,RequestUrl:e.regRedirectUrl(e.LoginRedirectUrl)}});e.IsAnonymousSubscriber(!1);n.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/Shared/Registration/Services/RegistrationService.asmx/ResetPasswordRequest",data:i,dataType:"json",cache:!1,success:function(n){n.d.IsValid?(e.PasswordResetSuccessMessage(e.ResetPasswordSuccessMessage),o.publishEvent(u.reset)):n.d.Messages&&n.d.Messages.length>0&&n.d.Messages[0].RuleId==t.Registration.Settings.anonymousSubscriberErrorId?(e.IsAnonymousSubscriber(!0),e.SwitchToRegistrationView()):e.error(e.ResetPasswordEmailNotFoundMessage)},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})}},e.SetRegAction=function(n){e.RegAction=n},e.SetSourceCode=function(t){n.ajax({type:"GET",data:{esrc:t},url:"/Shared/Registration/Services/RegistrationService.asmx/VisitSourceCode",cache:!1})},o.gigyaLoginSettings={hideGigyaLink:"true",showTermsLink:"false",facepilePosition:"none",enabledProviders:e.GlobalConfiguration.GigyaLoginProviders,width:e.GigyaLoginControlDisplayWidth,height:e.GigyaLoginControlDisplayHeight,onError:e.oAuthOnError,buttonsStyle:e.GigyaLoginControlButtonStyle,headerText:e.GigyaLoginControlHeaderText,showWhatsThis:e.GigyaLoginShowWhatsThisLink,whatsThisText:e.GigyaLoginWhatsThisText,showTooltips:e.GigyaLoginShowToolTips,connectWithoutLoginBehavior:"alwaysLogin"},o.setGigyaLoginSettings=function(){e.GigyaLoginIsEnabled&&window.gigya.isReady&&(t.Registration.Utils.gigyaLoginEventHandlerRegistered||(window.gigya.socialize.addEventHandlers({onLogin:e.oAuthOnLogin}),t.Registration.Utils.gigyaLoginEventHandlerRegistered=!0),e.createGigyaLoginUI(e.gigyaContainerId))},e.createGigyaLoginUI=function(t){if(e.GigyaLoginIsEnabled&&window.gigya.isReady){var i=n.extend(o.gigyaLoginSettings,{containerID:t});window.gigya.socialize.showLoginUI(i)}},e.DatePattern={HasYearBeforeMonthAndDay:function(){var n=f.GlobalConfiguration.DatePattern.toLowerCase();return n.indexOf("y")<n.indexOf("m")},HasMonthBeforeDay:function(){var n=f.GlobalConfiguration.DatePattern.toLowerCase();return n.indexOf("m")<n.indexOf("d")}},o.refreshSubscriptions=function(){n.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/Shared/Registration/Services/RegistrationService.asmx/GetSubscriptions",dataType:"json",cache:!1,success:function(n){e.RemoveRegistrationFields(n.d)},error:function(){e.error(e.GlobalConfiguration.GeneralErrorMessage)}})},o.setRetrievedEmailAddress=function(n){(e.SelectedNewsletterId!==t.Registration.Settings.defaultGuid||n!=="")&&(i.utils.arrayForEach(e.RegistrationSteps.concat(e.SocialRegistrationSteps),function(r){i.utils.arrayForEach(r.RegistrationFields(),function(i){i.Id===e.SelectedNewsletterId&&i.Value(!0);i.Id===t.Registration.Settings.emailFieldId&&i.Value(n)})}),i.utils.arrayForEach(e.LoginStepFields,function(i){i.Id===t.Registration.Settings.emailFieldId&&i.Value(n)}))},o.setRetrievedEmailAddress(e.EmailAddress),o.setCtaFields=function(){var t=o.getRegAction(),n=null;e.RegistrationActionCTAs&&(n=i.utils.arrayFirst(e.RegistrationActionCTAs,function(n){return n.Name===t}));e.RegActionCTAVisible(!1);n&&(n.Text||n.Headline||n.ImageUrl)&&(e.RegActionCTAText(n.Text),e.RegActionCTAHeadline(n.Headline),e.RegActionCTAImageUrl(n.ImageUrl));(e.RegActionCTAText()||e.RegActionCTAHeadline()||e.RegActionCTAImageUrl())&&e.RegActionCTAVisible(!0)},o.getRegAction=function(){return e.RegAction?e.RegAction:t.Registration.Utils.getParameterByName("RegAction")},e.RemoveRegistrationFields=function(n){i.utils.arrayForEach(e.RegistrationSteps,function(r){var u=!1;n.length>0&&i.utils.arrayForEach(n,function(n){for(var t=r.RegistrationFields().length-1;t>=0;t--)r.RegistrationFields()[t].Id===n&&(r.RegistrationFields().splice(t,1),u=!0)});var e=r.RegistrationFields().filter(function(n){return n.IsNewsletter==!0}),o=r.RegistrationFields().filter(function(n){return n.IsNewsletter!=!0}),s=e.splice(0,t.Registration.Settings.showNewslettersAmount),f=o.concat(s);f.length!=r.RegistrationFields().length&&(r.RegistrationFields(f),u=!0);u&&r.RegistrationFields.valueHasMutated()})},o.prepareRegistration=function(){o.refreshSubscriptions();o.setGigyaLoginSettings();o.setCtaFields();o.setDefaultView();e.EsrcCode&&e.SetSourceCode(e.EsrcCode.toString())},e.beginRegistration=function(){window.gigya.isReady||!e.GigyaLoginIsEnabled?o.prepareRegistration():(n.subscribe("gigyaServiceReady.pando",o.prepareRegistration),window.onGigyaServiceReady=window.onGigyaServiceReady||function(){n.publish("gigyaServiceReady.pando")})},e};t.Registration.FullPageRedirect=function(n){var r=t.Registration.Utils,i;n.IsModalWindow&&n.FullPageToRedirectTo&&(i=r.getSearchQuery(),n.FullPageToRedirectTo.indexOf("?")>=0&&(i="&"+i.substring(1,i.length)),r.redirectPage(n.FullPageToRedirectTo+i))};t.Registration.Utils=function(){var n={};return n.redirectPage=function(n){window.location.href=n},n.getCurrentHrefWithoutHash=function(){return n.getCurrentHref().replace(/#.*/,"")},n.getCurrentHref=function(){return window.location.href},n.getHash=function(){return window.location.hash},n.getSearchQuery=function(){return window.location.search},n.getParameterByName=function(t,i){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var u=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=u.exec(n.getCurrentHref());return r?r[1]:i},n.getHashParameterByName=function(t,i){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var u=new RegExp("[&#]"+t+"=([^&]*)","i"),r=u.exec(decodeURIComponent(n.getHash()));return r?r[1]:i},n.scrollTop=function(){window.scrollTo(0,0)},n.userIsAuthenticatedOrAnonymousSubscriber=function(){var n,t;if(window.utag_data&&window.utag_data.UserStatus!=="Anonymous")return!0;if(!window.RegistrationFlowData)return null;n=!1;for(t in window.RegistrationFlowData)if(window.RegistrationFlowData.hasOwnProperty(t)&&window.RegistrationFlowData[t].registrationFlowObj.IsAnonymousSubscriber()===!0){n=!0;break}return n},n.gigyaLoginEventHandlerRegistered=!1,n}()}(jQuery,window.GeneralMills||(window.GeneralMills={}),ko),function(n,t,i,r){var u=i.MyAccount=i.MyAccount||{};u.configureNewsletter=function(i){var r=u.InitializeViewModel(i),e,f;t.viewModels=t.viewModels||{};e="newsletterCtaVm-"+i.Id;t.viewModels[e]=r;f=n("#"+i.Id).get(0);f&&ko.applyBindingsWithValidation(r,f,{insertMessages:!1,decorateElement:!0,errorElementClass:"alert-error"});n("body").on("click",i.RegistrationModalCancelSelector,function(){r.onRegistrationDialogCanceled()})};u.InitializeViewModel=function(t){var f={};if(f.id=t.Id,f.showMemberView=t.ShowMemberView,f.inPageEditorMode=t.InPageEditorMode,f.htmlTemplateName=t.HtmlTemplateName,f.hidden=ko.observable(!1),f.hideForSessionLinkText=t.HideForSessionLinkText,f.newsletterId=t.NewsletterId,f.backgroundImageUrl=t.BackgroundImageUrl,f.backgroundAltText=t.BackgroundAlternateText,f.emailLabel=t.EmailLabel,f.emailAddressText=ko.observable(""),f.emailAddressWaterMarkText=t.EmailAddressText,f.registrationUrl=t.RegistrationUrl,f.useRegistrationModal=t.UseRegistrationModal,f.signUpText=t.SignUpText,f.signUpTextClassName=t.SignUpTextClassName,f.knownThankYouContent=t.KnownThankYouContent,f.knownThankYouContentClassName=t.KnownThankYouContentClassName,f.alreadySubscribedText=t.AlreadySubscribedText,f.thankYouForJoiningContent=t.ThankYouForJoiningContent,f.birthdayRequired=t.BirthdayRequired,f.birthdayLabel=t.BirthdayLabel,f.birthdayDropdown=t.BirthdayAsDropdown,f.yearWatermarkText=t.YearWatermarkText,f.dayWatermarkText=t.DayWatermarkText,f.monthWatermarkText=t.MonthWatermarkText,f.birthdateTemplateName="",f.profileQuestion=t.ProfileQuestion,f.profileQuestionSelection=ko.observable(r),f.anonymousHeaderText=t.AnonymousHeaderText,f.anonymousSubHeaderText=t.AnonymousSubHeaderText,f.anonymousThankYouContent=t.AnonymousThankYouContent,f.fullSubscriptionContent=t.FullSubscriptionContent,f.youAreSubscribedText=t.YouAreSubscribedText,f.termsAndConditions=t.TermsAndConditions,f.joinLinkText=t.JoinLinkText,f.previewLinkText=t.PreviewLinkText,f.suppressMemberView=t.HideMemberView,f.memberHeaderText=t.MemberHeaderText,f.memberSubHeaderText=t.MemberSubHeaderText,f.myAccountSubscriptionUrl=t.MyAccountSubscriptionUrl,f.emailRequiredError=t.EmailRequiredError,f.invalidDateErrorMessage=t.InvalidDateError,f.errorMessage=ko.observable(""),f.isServerFailure=ko.observable(!1),f.notEligibleCookieName=t.NotEligibleCookieName,f.hideForSessionCookieName=t.HideNewsletterCTACookiePrefix+t.SettingsId,f.hideForSessionCookieExpiration=t.HideNewsletterCTACookieExpiration,f.showThankYouContent=ko.observable(!1),f.showFullSubscriptionContent=ko.observable(!1),f.ControlIds=t.ControlIds,f.registrationStateCookieName=t.RegistrationStateCookieName,f.displayThanksForJoiningContent=n.cookie(f.registrationStateCookieName)?!0:!1,n.cookie(f.registrationStateCookieName,null),f.showMemberView?(n.each(t.Newsletters,function(){this.signUpEnabled=ko.observable(!0);this.newsletterPreviewText=t.PreviewText;this.newsletterSignUpButtonText=ko.observable(t.SignUpText);this.newsletterSignUpCss=ko.observable(t.SignUpTextClassName);this.subscriptionListId=ko.observable(this.SubscribedToListId);this.listId=ko.observable(this.ListId)}),f.newsletters=ko.observableArray(t.Newsletters)):t.Newsletter&&(f.Newsletter=ko.observable(t.Newsletter),f.Newsletter().previewText=t.PreviewText,f.Newsletter().signUpEnabled=ko.observable(!0),f.Newsletter().subscriptionListId=ko.observable(t.Newsletter.SubscribedToListId),f.Newsletter().listId=ko.observable(t.Newsletter.ListId)),f.getPreviewImageLinkId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_newsletterImage_link"},f.getPreviewImageId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_previewImage_image"},f.getNewsLetterSignUpButtonLinkId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_SignUpButton_link"},f.getNewsLetterSignUpButtonSpanId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_SignUpButton_span"},f.getPreviewUrlId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_previewUrl_link"},f.getNewsletterPreviewTextId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_newsletterPreview_text"},f.getThumbnailImageLinkId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_thumbnailImage_link"},f.getThumbnailImageId=function(n){return"gmi_ma_nwCTA_"+f.id+"_newsletterId_"+n+"_thumbnailImage_image"},f.invalidDateOfBirthCookie=function(){return n.cookie(f.notEligibleCookieName)?!0:!1},!f.showMemberView){if(f.emailAddressText.extend({validation:{validator:function(n){if(f.isServerFailure())return f.isServerFailure(!1),!1;f.invalidDateOfBirthCookie()||f.errorMessage("");var t=n.lastIndexOf("."),i=n.indexOf("@");return n&&n!==f.emailAddressWaterMarkText&&t!==-1&&i!==-1&&t<n.length-2&&t>i},message:f.emailRequiredError}}),f.birthdayRequired)for(f.birthdateTemplateName=f.birthdayDropdown?"_newsletterCta.dateofbirthdropdown.tmpl":"_newsletterCta.dateofbirthtextbox.tmpl",f.birthDate={},f.birthDate.day=ko.observable(),f.birthDate.month=ko.observable(),f.birthDate.year=ko.observable(),f.birthDate.Error=ko.observable(""),f.MonthSelectOptions=ko.observableArray(t.MonthNames),f.DaySelectOptions=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],f.YearSelectOptions=[],f.getDatePartsForValidation=function(){var n={month:-1,day:-1,year:-1,isDropDown:!1};return!isNaN(parseFloat(f.MonthPart()))&&isFinite(f.MonthPart())?(n.month=parseFloat(f.MonthPart()),n.day=parseFloat(f.DayPart()),n.year=parseFloat(f.YearPart())):(n.isDropDown=!0,n.month=f.MonthSelectOptions().indexOf(f.MonthPart()),n.day=f.DayPart(),n.year=f.YearPart()),n},f.YearPart=ko.observable().extend({validation:{validator:function(n){f.invalidDateOfBirthCookie()||f.errorMessage("");return n&&n!==f.yearWatermarkText&&f.DayPart()&&f.DayPart()!==f.dayWatermarkText&&f.MonthPart()&&f.MonthPart()!==f.monthWatermarkText},message:f.invalidDateErrorMessage}}),f.MonthPart=ko.observable().extend({validation:{validator:function(n){f.invalidDateOfBirthCookie()||f.errorMessage("");return n&&n!==f.monthWatermarkText&&f.DayPart()&&f.DayPart()!==f.dayWatermarkText&&f.YearPart()&&f.YearPart()!==f.yearWatermarkText}},message:f.invalidDateErrorMessage}),f.DayPart=ko.observable().extend({validation:{validator:function(n){f.invalidDateOfBirthCookie()||f.errorMessage("");return n&&n!==f.dayWatermarkText&&f.MonthPart()&&f.MonthPart()!==f.monthWatermarkText&&f.YearPart()&&f.YearPart()!==f.yearWatermarkText}},message:f.invalidDateErrorMessage}),f.birthDate.Value=ko.computed(function(){var n=f.getDatePartsForValidation();return n.month+(n.isDropDown?1:0)+"/"+n.day+"/"+n.year}),year=(new Date).getFullYear();year>=1900;year--)f.YearSelectOptions.push(year);f.profileQuestionSelection.extend({required:{message:"You must select a value",onlyIf:function(){return f.profileQuestion!=r}}})}return f.hideForSession=ko.computed(function(){return f.hidden()||(n.cookie(f.hideForSessionCookieName)?!0:!1)}),f.haveNewsletters=ko.computed(function(){return f.inPageEditorMode||f.newsletters&&f.newsletters()&&f.newsletters().length>0?!0:!1}),f.availableNewsletters=ko.computed(function(){return f.newsletters?f.newsletters():[]}),f.anonymousSignupEnabled=ko.computed(function(){return f.Newsletter&&f.Newsletter().signUpEnabled()?!0:!1}),f.newsletterName=ko.computed(function(){return f.Newsletter?f.Newsletter().Name:""}),f.newsletterPreviewUrl=ko.computed(function(){return f.Newsletter?f.Newsletter().PreviewUrl:""}),f.newsletterThumbnailImagePath=ko.computed(function(){return f.Newsletter?f.Newsletter().ThumbnailImagePath:""}),f.containerClassName=ko.computed(function(){return"newsletterCtaContainer "+(f.showMemberView?"newsletterCtaKnown":"newsletterCtaUnknown")}),f.backgroundImageSrc=ko.computed(function(){return"url("+f.backgroundImageUrl+")"}),f.DatePattern={HasYearBeforeMonthAndDay:function(){var n=t.DatePattern.toLowerCase();return n.indexOf("y")<n.indexOf("m")},HasMonthBeforeDay:function(){var n=t.DatePattern.toLowerCase();return n.indexOf("m")<n.indexOf("d")}},f.submitButtonClass=ko.computed(function(){return f.showMemberView?"":"signUpText"+(!f.emailAddressText.isValid()||f.YearPart&&!f.YearPart.isValid()?" disabled":"")}),f.displayAnonymousView=function(){return!f.invalidDateOfBirthCookie()&&!f.showMemberView&&!f.hideForSession()},f.displayMemberView=function(){return f.showMemberView&&!f.suppressMemberView&&!f.displayAlreadySubscribedView()},f.displayAlreadySubscribedView=function(){return!f.anonymousSignupEnabled()&&!f.haveNewsletters()&&!f.showThankYouContent()&&f.alreadySubscribedText!==""},f.displaySubscribeView=function(){return f.displayAnonymousView()||f.displayMemberView()},f.displayEmailLabel=function(){return f.emailLabel.length>0},f.displayBirthdayLabel=function(){return f.birthdayLabel.length>0},f.displayPreviewLink=function(){return f.previewLinkText.length>0},f.displayTermsAndConditions=function(){return f.termsAndConditions.length>0},f.displayProfileQuestion=function(){return f.profileQuestion?!0:!1},f.hide=function(){return f.hidden(!0),n.cookie(f.hideForSessionCookieName,f.hideForSessionCookieName,{expires:f.hideForSessionCookieExpiration,path:"/"}),!1},f.subscribe=function(t){if(!t.signUpEnabled())return!1;var i={NewsletterGuid:t.listId()},r=JSON.stringify({request:i});return n.ajax({type:"POST",url:"/Shared/MyAccount/Services/MyAccountService.svc/UpdateNewsletterSubscription",data:r,success:function(){t.subscriptionListId(t.listId());t.newsletterSignUpButtonText(f.knownThankYouContent);t.newsletterSignUpCss(f.knownThankYouContentClassName);t.signUpEnabled(!1)},dataType:"json",contentType:"application/json; charset=UTF-8"}),f.raiseAnalyticsEvent("NewsletterOptIn",t),!1},f.anonymousSubscribe=function(){var i,t,r;return f.invalidDateOfBirthCookie()?!1:(f.errorMessage(""),f.showThankYouContent(!1),f.showFullSubscriptionContent(!1),!f.Newsletter||!f.Newsletter().signUpEnabled())?!1:(i=ko.validation.group(f,{deep:!0}),i().length!==0)?(i.showAllMessages(),!1):(t={NewsletterGuid:f.Newsletter().listId(),Email:f.emailAddressText()},f.birthdayRequired&&(t.BirthDate=f.birthDate.Value()),f.profileQuestion&&f.profileQuestionSelection()&&(t.ProfileQuestionId=f.profileQuestion.SiteQuestionID,t.ProfileQuestionAnswerId=f.profileQuestionSelection()),r=JSON.stringify({request:t}),n.ajax({type:"POST",url:"/Shared/MyAccount/Services/MyAccountService.svc/AnonymousSubscribeToNewsletter",data:r,cache:!1,success:function(t){t.Success?(f.errorMessage(""),f.Newsletter().subscriptionListId(f.Newsletter().listId()),f.Newsletter().signUpEnabled(!1),f.showFullSubscriptionContent(t.ShowSubscribedToAll),f.showThankYouContent(t.ShowThankYou),t.PreviouslySubscribed?f.raiseAnalyticsEvent("DuplicateSubscriptions",f.Newsletter()):f.raiseAnalyticsEvent("NewsletterOptIn",f.Newsletter())):(f.isServerFailure(!0),f.errorMessage(t.ErrorMessage),t.LegalAgeError&&n.cookie(f.notEligibleCookieName,f.notEligibleCookieName))},dataType:"json",contentType:"application/json; charset=UTF-8"}),!1)},f.raiseAnalyticsEvent=function(n,r){var u={EventType:n,NewsletterTitle:[r.Name],NewsletterId:[r.listId()]},f=i.MyAccount.GetParameterByName("RegAction");return f!==""&&(u.RegAction=f),t.Location&&(u.SubscriberPosition=t.Location),i.Analytics.raiseEvent(u),!1},f.goToRegistration=function(){f.goToLoginRegistration(!1)},f.goToLoginRegistration=function(t){var e=t?f.myAccountSubscriptionUrl:u.GetParameterByName("parentUrl"),h="?",r,o,c,l,s;return(e&&(e.indexOf("?")>0&&(h="&"),f.newsletterId&&f.Newsletter&&f.Newsletter().signUpEnabled()&&(e=e+h+"newsletterId="+f.newsletterId)),r=f.registrationUrl,o="?",r.indexOf("?")>0&&(o="&"),r.indexOf("isRegistrationFirstStep")===-1&&(r=r+o+"isRegistrationFirstStep="+(t?"false":"true"),o="&"),f.emailAddressText()!==""&&(r=r+o+"email="+f.emailAddressText()),r.indexOf("RegAction")>=0&&(c=u.GetParameterByName("RegAction",r)),r.indexOf("esrc")>=0&&(l=u.GetParameterByName("esrc",r)),r=r+o+"returnUrl=",s={isRegistrationFirstStep:!t,returnUrl:e,redirectUrl:r+e,RegAction:c,esrc:l,values:[{fieldGuid:"20548f2e-3d18-44d0-902c-59b941ded6dd",value:f.emailAddressText()}]},f.thankYouForJoiningContent&&!t&&n.cookie(f.registrationStateCookieName,f.registrationStateCookieName),f.useRegistrationModal)?(u.showLoginModal(s)||i.Common.OpenRegistrationModal(s),!1):(u.RedirectParentPage(r+e),!1)},f.goToMySubscriptions=function(t,i){var r=n(i.target);return r.is("li.newsletter")||r.parents("li.newsletter").length>0?!0:(f.myAccountSubscriptionUrl&&u.RedirectParentPage(f.myAccountSubscriptionUrl),!1)},f.onRegistrationDialogCanceled=function(){n.cookie(f.registrationStateCookieName,null)},f};u.hasLoginModal=function(){return t.reg&&t.reg.userRegistration&&typeof t.reg.userRegistration.openRegistrationDialog=="function"};u.showLoginModal=function(n){return u.hasLoginModal()?(t.reg.userRegistration.openRegistrationDialog(n),!0):!1};u.GetWindowLocationSearch=function(){return t.location.search};u.GetParameterByName=function(n,t){t||(t=u.GetWindowLocationSearch());n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r="[\\?&]"+n+"=([^&#]*)",f=new RegExp(r),i=f.exec(t);return i===null?"":decodeURIComponent(i[1].replace(/\+/g," "))};u.RedirectParentPage=function(n){document.domain=document.location.hostname;t.top.location.href=n};ko.bindingHandlers.watermark={init:function(t,i,r){var e=i(),o=r(),f=ko.utils.unwrapObservable(e),u=n(t);setTimeout(function(){u.val(f)},0);u.focus(function(){u.val()===f&&u.val("")}).blur(function(){u.val()===""&&u.val(f)})}};ko.bindingHandlers.newsletterCtaSubscribedClass={update:function(n,t){n.__ko__previousClassValue__&&ko.utils.toggleDomNodeCssClass(n,n.__ko__previousClassValue__,!1);var i=ko.utils.unwrapObservable(t());ko.utils.toggleDomNodeCssClass(n,i,!0);n.__ko__previousClassValue__=i}};ko.bindingHandlers.enterkey={init:function(t,i,r,u){var f=r();n(t).on("keypress","input, textarea, select",function(n){var r=n.which||n.keyCode,i;return r!==13?!0:(i=n.target,i.blur(),f.enterkey.call(u,u,i,t),!1)})}}}(jQuery,window,window.GeneralMills||(window.GeneralMills={})),function(){GeneralMills=typeof GeneralMills=="undefined"?{}:GeneralMills;GeneralMills.Common=typeof GeneralMills.Common=="undefined"?{}:GeneralMills.Common;typeof GeneralMills.Common.OpenRegistrationModal=="undefined"&&(GeneralMills.Common.OpenRegistrationModal=function(n){window.parent.postMessage(JSON.stringify(n),"*")})}(jQuery),function(n){GeneralMills=typeof GeneralMills=="undefined"?{}:GeneralMills;GeneralMills.Common=typeof GeneralMills.Common=="undefined"?{}:GeneralMills.Common;typeof GeneralMills.Common.PostDimensionsToParentWindow=="undefined"&&(GeneralMills.Common.PostDimensionsToParentWindow=function(){var n={source:window.location.href,width:document.body.offsetWidth,height:document.body.offsetHeight};window.parent.postMessage(JSON.stringify(n),"*")},n(window).load(function(){GeneralMills.Common.PostDimensionsToParentWindow()}))}(jQuery),function(n,t,i){i.ProfileScreenName=i.ProfileScreenName||{};i.ProfileScreenName.ProfileScreenNameViewModel=function(r){var u={};return u.isPublicProfileView=t.observable(r.IsPublicProfileView),u.showPublicProfileLink=t.observable(!r.IsPublicProfileView&&r.PublicProfileUrlLink!==""),u.showSuccess=t.observable(!1),u.showValidation=t.observable(!1),u.showError=t.observable(!1),u.createMode=t.observable(!0),u.profileScreenName=t.observable(r.CurrentUserScreenName),u.currentScreenName=t.observable(""),u.profileScreenNameTitle=r.ProfileScreenNameTitle,u.profileScreenNameInstruction=r.ProfileScreenNameInstruction,u.createScreenNameLinkText=r.CreateScreenNameLinkText,u.updateScreenNameLinkText=r.UpdateScreenNameLinkText,u.publicProfileBaseUrl=r.PublicProfileBaseUrl,r.PublicProfileBaseUrl&&r.PublicProfileBaseUrl.substr(-1)!=="/"&&(u.publicProfileBaseUrl+="/"),u.publicProfileUrlLink=t.computed(function(){return u.publicProfileBaseUrl+u.profileScreenName()}),u.profileScreenNameModalTitle=r.ProfileScreenNameModalTitle,u.profileScreenNameMessage=r.ProfileScreenNameMessage,u.profileScreenNameLabel=r.ProfileScreenNameLabel,u.profileScreenNameSuccessText=r.ProfileScreenNameSuccessText,u.profileScreenNameValidation=r.ProfileScreenNameValidation,u.profileScreenNameModalInstruction=r.ProfileScreenNameModalInstruction,u.genericErrorText=r.GenericErrorText,u.errors=t.observableArray([]),u.clearErrors=function(){u.showValidation(!1);u.showSuccess(!1);u.errors.removeAll()},r.CurrentUserScreenName?(u.currentScreenName(r.CurrentUserScreenName),u.createMode(!1)):u.showPublicProfileLink(!1),u.getDialog=function(){u.clearErrors();u.profileScreenName(u.currentScreenName());n(".profileScreenNameModal").dialog({buttons:[{id:"button-save",text:r.SaveButtonText,click:function(){u.saveScreenname()}},{id:"button-cancel",text:r.CancelButtonText,click:function(){n(".profileScreenNameModal").dialog("close")}},{id:"button-close",text:r.CloseButtonText,click:function(){n(".profileScreenNameModal").dialog("close")}}],dialogClass:"profileScreenNameDialog",modal:!0});n("#button-close.ui-button").hide()},u.saveScreenname=function(){var t,r;u.clearErrors();t=u.profileScreenName();t?(r=JSON.stringify({screenName:t}),n.ajax({type:"POST",url:"/Shared/MyAccount/Services/MyAccountService.svc/CreateScreenName",data:r,contentType:"application/json; charset=UTF-8",dataType:"json",success:function(r){if(r&&r.length<1)u.showSuccess(!0),u.showValidation(!1),n("#button-close.ui-button").show(),n("#button-cancel.ui-button").hide(),n("#button-save.ui-button").hide(),u.currentScreenName(t),u.profileScreenName(t),u.createMode(!1),u.showPublicProfileLink(!0),i.Analytics.raiseEvent({EventType:"ProfileUpdate"});else if(u.showValidation(!0),r===null)u.errors.push(u.genericErrorText);else for(var f=0;f<r.length;f++)u.errors.push(r[f].Message)},error:function(n,t,i){u.errors.push(i);u.showValidation(!0)}})):(u.errors.push(u.genericErrorText),u.showValidation(!0))},u.getUniqueId=function(n){return r.Id+"_profileScreenName_"+n},u.updateScreenNameLinkTrackID=u.getUniqueId("updateScreenNameLinkText"),u.createScreenNameLinkTrackID=u.getUniqueId("createScreenNameLinkText"),u};i.ProfileScreenName.configureProfileScreenName=function(r){var u=n("#profileScreenName-"+r.viewId)[0];t.applyBindings(i.ProfileScreenName.ProfileScreenNameViewModel(r.spec),u)}}(jQuery,ko,window.GeneralMills||(window.GeneralMills={})),function(n,t,i,r){function s(n,t,i){var r=new Date(n+"/"+t+"/"+i);return r.getMonth()+1==n&&r.getDate()==t&&r.getFullYear()==i}var e;i.ProfileInfo=i.ProfileInfo||{};var h=function(n,t,i){this.provinceName=n;this.provinceCode=t;this.provinceCountryCode=i},o=function(n,t){this.countryName=t;this.countryIsoCode=n},u={success:"alert-success",error:"alert-error",info:"alert-info"},f=function(n,t){this.message=n;this.type=t};i.ProfileInfo.AvailableCountries=[];i.ProfileInfo.Provinces=[];e=function(n,t){return n==t()};i.ProfileInfo.ProfileInfoViewModel=function(c){var l={},a={},v,b,y,p,w;a.invalidBirthDateMessage=new f(c.InvalidBirthDateMessage,u.error);a.emailsDoNotMatchMessage=new f(c.EmailsDoNotMatchMessage,u.error);a.invalidEmailAddressMessage=new f(c.InvalidEmailAddressMessage,u.error);l.messages=t.observableArray([]);l.editMode=t.observable(!1);for(v in c.CountryDictionary)v!=="$type"&&(v=="US"||v=="CA"?i.ProfileInfo.AvailableCountries.unshift(new o(v,c.CountryDictionary[v])):i.ProfileInfo.AvailableCountries.push(new o(v,c.CountryDictionary[v])));for(b in c.StateProvinceInformation)y=c.StateProvinceInformation[b],i.ProfileInfo.Provinces.push(new h(y.Key,y.Phrase,y.Country));return l.CountryDictionary=c.CountryDictionary,l.Title=c.Title,l.HeaderInstructions=c.HeaderInstructions,l.FirstName=t.persistentObservable(c.FirstName),l.MiddleName=t.persistentObservable(c.MiddleName),l.LastName=t.persistentObservable(c.LastName),l.NameSuffix=t.persistentObservable(c.NameSuffix),l.Salutation=t.persistentObservable(c.Salutation),l.Gender=t.persistentObservable(c.Gender===""?null:c.Gender),l.EmailFormat=t.persistentObservable(c.EmailFormat),l.Email=t.persistentObservable(c.Email),l.EmailConfirm=t.persistentObservable(c.Email),l.Email.extend({required:{message:c.InvalidEmailAddressMessage}}).extend({validation:{validator:e,message:c.EmailsDoNotMatchMessage,params:l.EmailConfirm}}),l.EmailConfirm.extend({validation:{validator:e,message:c.EmailsDoNotMatchMessage,params:l.Email}}),l.Address1=t.persistentObservable(c.Address1),l.Address2=t.persistentObservable(c.Address2),l.Address3=t.persistentObservable(c.Address3),l.City=t.persistentObservable(c.City),l.CountryCode=t.persistentObservable(c.CountryCode),l.CountryName=t.persistentObservable(c.CountryName),l.Phone=t.persistentObservable(c.Phone),l.PhoneType=t.persistentObservable(c.PhoneType),l.PostalCode=t.persistentObservable(c.PostalCode),l.Province=t.persistentObservable(c.Province),l.countryGeneralOptionText=c.CountryGeneralOptionText,l.genderGeneralOptionText=c.GenderGeneralOptionText,l.provinceGeneralOptionText=c.ProvinceGeneralOptionText,l.StateOrProvinceValidationError=t.observable(!1),l.CountryValidationError=t.observable(!1),l.BirthDayValidationError=t.observable(!1),l.BirthMonthValidationError=t.observable(!1),l.BirthYearValidationError=t.observable(!1),l.EmailValidationError=t.observable(!1),l.EmailConfirmValidationError=t.observable(!1),l.GenderOptions=c.GenderOptions?t.observableArray(c.GenderOptions):t.observableArray(["F","M","Not Specified"]),l.BirthDay=t.persistentObservable(),l.BirthMonth=t.persistentObservable(),l.BirthYear=t.persistentObservable(),l.BirthDate=t.computed({read:function(){var t=jQuery(".validationMessage.BirthDate"),i=new Date,n=new Date(l.BirthMonth()+"/"+l.BirthDay()+"/"+l.BirthYear());return n.setYear(parseInt(l.BirthYear())+18),n.setDate(n.getDate()+1),n>i||!s(l.BirthMonth(),l.BirthDay(),l.BirthYear())?t.text(c.InvalidBirthDateMessage):t.text(""),l.BirthMonth()+"/"+l.BirthDay()+"/"+l.BirthYear()},write:function(n){if(n){var t=n.match(/([0-9]{4})-([0-9]{2})-([0-9]{2})T[0-9]{2}:[0-9]{2}:[0-9]{2}/i);t.length===4&&(l.BirthYear(t[1]),l.BirthMonth(parseInt(t[2],10).toString()),l.BirthDay(parseInt(t[3],10).toString()))}}}),l.BirthDate(c.BirthDate),l.BirthYear.commit(),l.BirthMonth.commit(),l.BirthDay.commit(),l.availableCountries=t.observableArray(i.ProfileInfo.AvailableCountries),l.selectedCountry=t.persistentObservable(),l.selectedCountryName=t.computed(function(){return l.selectedCountry()?l.selectedCountry().countryName:l.CountryCode()}),l.isUSorCanada=function(){var n=l.selectedCountry();return n&&(n.countryIsoCode==="US"||n.countryIsoCode==="CA")},l.showProvinceLabel=t.computed(function(){return l.editMode()&&l.isUSorCanada()?!0:!1}),l.showProvinceTextLabel=t.computed(function(){var n=l.CountryCode();return n&&(n==="US"||n==="CA")?!0:!1}),l.availableStates=t.observableArray(i.ProfileInfo.Provinces),l.filteredAvailableStates=t.computed(function(){return l.selectedCountry()?t.utils.arrayFilter(l.availableStates(),function(n){return l.selectedCountry().countryName===n.provinceCountryCode}):[]}),l.selectedProvince=t.persistentObservable(),p=t.utils.arrayFirst(l.availableCountries(),function(n){return n.countryIsoCode===c.CountryCode}),p&&(l.selectedCountry(p),l.selectedCountry.commit()),w=t.utils.arrayFirst(l.availableStates(),function(n){return n.provinceCode===c.Province}),w&&(l.selectedProvince(w),l.selectedProvince.commit()),l.hasTitle=t.computed(function(){return l.Title&&l.Title.length>0}),l.hasInstructions=t.computed(function(){return l.HeaderInstructions&&l.HeaderInstructions.length>0}),l.IsCountryVisible=t.computed(function(){return c.DisplayedFields.indexOf("CountryName")>-1||c.DisplayedFields.indexOf("CountryCode")>-1}),l.IsProvinceVisible=t.computed(function(){return c.DisplayedFields.indexOf("Province")>-1}),l.IsEmailVisible=t.computed(function(){return c.DisplayedFields.indexOf("Email")>-1}),l.IsBirthdateVisible=t.computed(function(){return c.DisplayedFields.indexOf("BirthDate")>-1}),l.setEditMode=function(n,t){l.editMode(n);t&&l.messages.removeAll()},l.toGMTDate=function(n){return new Date(n+" 00:00:00 GMT+0000")},l.saveInfo=function(){var n,r,o,e;(l.messages.removeAll(),n=t.toJS(l),r=!1,l.IsProvinceVisible()?l.isUSorCanada()?l.selectedProvince()?(n.Province=l.selectedProvince().provinceCode,l.Province(n.Province),l.StateOrProvinceValidationError(!1)):(l.messages.push(new f(c.ProvinceValidationMessage,u.error)),l.StateOrProvinceValidationError(!0),r=!0):n.Province="":n.Province="",l.IsCountryVisible()&&(n.selectedCountry?(n.CountryCode=n.selectedCountry.countryIsoCode,l.CountryCode(n.CountryCode),l.CountryValidationError(!1)):(l.messages.push(new f(c.CountryValidationMessage,u.error)),l.CountryValidationError(!0),r=!0)),l.IsBirthdateVisible()?n.BirthDate&&(l.validateBirthDate()?(n.BirthDate=l.toGMTDate(n.BirthDate).toMSJSON(),l.messages.remove(a.invalidBirthDateMessage),l.BirthDayValidationError(!1),l.BirthMonthValidationError(!1),l.BirthYearValidationError(!1)):(l.messages.push(a.invalidBirthDateMessage),l.BirthDayValidationError(!0),l.BirthMonthValidationError(!0),l.BirthYearValidationError(!0),r=!0)):n.BirthDate=l.toGMTDate(n.BirthDate).toMSJSON(),l.IsEmailVisible()&&(l.matchConfirmationEmail()?(l.messages.remove(a.emailsDoNotMatchMessage),l.EmailValidationError(!1),l.EmailConfirmValidationError(!1),l.validateEmail()?(l.messages.remove(a.invalidEmailAddressMessage),l.EmailValidationError(!1)):(l.messages.push(a.invalidEmailAddressMessage),l.EmailValidationError(!0),r=!0)):(l.messages.push(a.emailsDoNotMatchMessage),l.EmailValidationError(!0),l.EmailConfirmValidationError(!0),r=!0)),r)||(delete n.availableCountries,o={Info:n},e=!0,l.updateProfileInfoAjaxCall(o).success(function(n){if(n===null||n.length<1)i.Analytics.raiseEvent({EventType:"ProfileUpdate"}),t.utils.commitChanges(l);else for(var r=0;r<n.length;r++)l.messages.push(new f(n[r].Message,u.error)),e=!1}).fail(function(){l.messages.push(new f(c.GeneralProfileFailureMessage,u.error));e=!1}).done(function(){e&&l.messages.push(new f(c.SuccessfulSaveMessage,u.success));l.setEditMode(!e,!1)}))},l.updateProfileInfoAjaxCall=function(t){return n.ajax({url:"/Shared/MyAccount/Services/MyAccountService.svc/UpdatePersonalInformation",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({personalInfo:t}),headers:{RequestVerificationToken:c.AntiCSRFToken},cache:!1})},l.editInfo=function(){l.setEditMode(!0,!0)},l.cancel=function(){t.utils.cancelChanges(l);l.EmailValidationError(!1);l.EmailConfirmValidationError(!1);l.setEditMode(!1,!0)},l.validateBirthDate=function(){return s(l.BirthMonth(),l.BirthDay(),l.BirthYear())},l.matchConfirmationEmail=function(){return l.EmailConfirm()==l.Email()},l.validateEmail=function(){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l.Email())},l.selectedCountry.subscribe(function(){l.isUSorCanada()||(l.selectedProvince(r),l.PostalCode(r))}),l};i.ProfileInfo.configureProfileInfo=function(r){var u=n("#profileInfo-"+r.viewId)[0];t.applyBindings(i.ProfileInfo.ProfileInfoViewModel(r.spec),u)}}(jQuery,ko,window.GeneralMills||(window.GeneralMills={})),function(n,t,i){i.ProfileChangePassword=i.ProfileChangePassword||{};i.ProfileChangePassword.changePasswordViewModel=function(r){var u={};return u.email=n('input[name="currentUserEmail"]').val(),u.changePasswordError=t.observable(!1),u.updatedPasswordError=t.observable(!1),u.updatedPasswordValidationError=t.observable(!1),u.currentPasswordError=t.observable(!1),u.confirmPasswordError=t.observable(!1),u.confirmPasswordMatchError=t.observable(!1),u.changePasswordSuccess=t.observable(!1),u.updatedPassword=t.observable(""),u.currentPassword=t.observable(""),u.confirmUpdatedPassword=t.observable(""),u.ChangePasswordTitle=r.ChangePasswordTitle,u.ChangePasswordMessage=r.ChangePasswordMessage,u.PasswordLabelText=r.PasswordLabelText,u.InlinePasswordError=r.InlinePasswordValidation,u.UpdatedPasswordLabelText=r.UpdatedPasswordLabelText,u.InlineUpdatedPasswordError=r.InlineUpdatedPasswordValidation,u.PasswordValidationError=r.InlinePasswordValidation,u.ConfirmPasswordLabelText=r.ConfirmPasswordLabelText,u.InlineConfirmPasswordError=r.InlineConfirmPasswordValidation,u.InlineConfirmPasswordMatchError=r.InlineConfirmPasswordMatchValidation,u.ChangePasswordSuccessMessage=r.ChangePasswordSuccessMessage,u.PasswordValidationErrorMessage=r.PasswordValidationErrorMessage,u.changePassword=function(){var i,r,f;u.clearAllErrors();u.changePasswordSuccess(!1);i=n.parseJSON('{"Email":"","Password":"", "UpdatedPassword":""}');u.validateForm()&&(r=t.toJS(u),i.Email=r.email,i.UpdatedPassword=r.updatedPassword,i.Password=r.currentPassword,f=JSON.stringify({request:i}),f?n.ajax({url:"/Shared/MyAccount/Services/MyAccountService.svc/ChangePassword",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:f,cache:!1,success:u.handleSuccessResult,error:function(n){if(n&&n.Errors&&n.Errors.length>0)for(var t=0;t<n.Errors.length;t++)u.addError(n.Errors[t].Message);else u.addError()}}):u.changePasswordError(!0))},u.handleSuccessResult=function(n){if(n&&n.Errors&&n.Errors.length>0)for(var t=0;t<n.Errors.length;t++)u.addError(n.Errors[t].Message);else u.clearForm(),u.changePasswordSuccess(!0),i.Analytics.raiseEvent({EventType:"ProfileUpdate"})},u.clearAllErrors=function(){u.changePasswordError(!1);u.confirmPasswordError(!1);u.confirmPasswordMatchError(!1);u.currentPasswordError(!1);u.updatedPasswordError(!1);u.updatedPasswordValidationError(!1);u.clearErrors()},u.clearForm=function(){u.updatedPassword("");u.currentPassword("");u.confirmUpdatedPassword("")},u.validateForm=function(){var i=t.toJS(u),r=!0,f,e,o;return i.email==""&&(r=!1),i.currentPassword==""&&(u.currentPasswordError(!0),r=!1),i.updatedPassword==""?(u.updatedPasswordError(!0),r=!1):(f=n.trim(i.updatedPassword),f.length>=6?(e=f.match(/[A-z]/g),o=f.match(/[0-9]/g),(!e||!o||e.length<1||o.length<1)&&(u.updatedPasswordValidationError(!0),r=!1)):(u.updatedPasswordValidationError(!0),r=!1)),i.confirmUpdatedPassword==""&&(u.confirmPasswordError(!0),r=!1),i.confirmUpdatedPassword!=""&&i.updatedPassword!=""&&i.confirmUpdatedPassword!=i.updatedPassword&&(u.confirmPasswordMatchError(!0),r=!1),r},u.currentPasswordErrorClassEnabled=t.computed(function(){return u.currentPasswordError()}),u.updatedPasswordErrorClassEnabled=t.computed(function(){var n=!1;return(u.updatedPasswordError()||u.updatedPasswordValidationError())&&(n=!0),n}),u.confirmPasswordErrorClassEnabled=t.computed(function(){var n=!1;return(u.confirmPasswordError()||u.confirmPasswordMatchError())&&(n=!0),n}),u.clearErrors=function(){n("#profileChangePasswordError").css("display","none");var t=n("#profileChangePasswordError");t.children()&&t.children().remove()},u.addError=function(t){n("#profileChangePasswordError").css("display","block");t?n("#profileChangePasswordError").append("<span>"+t+"<\/span>"):n("#profileChangePasswordError").append("<span>"+r.UnknownErrorMessage+"<\/span>")},u.getUniqueId=function(n){return r.Id+"_profileChangePassword_"+n},u.changePasswordTrackId=u.getUniqueId("changePassword"),u};i.ProfileChangePassword.configureProfileChangePassword=function(r){var u=n("#profileChangePassword-"+r.viewId)[0],f=new i.ProfileChangePassword.changePasswordViewModel(r.spec);t.applyBindings(f,u)}}(jQuery,ko,window.GeneralMills||(window.GeneralMills={})),function(n,t){t.MyAccount=t.MyAccount||{};t.MyAccount.SocialLinkerViewModel=function(i,r){var u={};return u.EnabledProviders=i.enabledProviders,u.FederationFailureMessage=i.federationFailureMessage,u.OnConnectionAdded=function(i){var r=JSON.stringify({request:{UID:i.user.UID,UIDSig:i.user.UIDSig,Timestamp:i.user.timestamp,LoginProvider:i.user.loginProvider,LoginProviderUID:i.user.loginProviderUID}});n.ajax({url:"/Shared/MyAccount/Services/MyAccountService.svc/SocialLinkerConnectionAdded",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:r,cache:!1,success:function(n){t.Analytics.raiseEvent({EventType:"ProfileUpdate"});n!=!0&&alert(u.FederationFailureMessage)}})},u.OnConnectionRemoved=function(){t.Analytics.raiseEvent({EventType:"ProfileUpdate"})},gigya.socialize.addEventHandlers({onConnectionAdded:u.OnConnectionAdded,onConnectionRemoved:u.OnConnectionRemoved}),gigya.socialize.showAddConnectionsUI({showTermsLink:!1,hideGigyaLink:!0,enabledProviders:u.EnabledProviders,containerID:r,connectWithoutLoginBehavior:"alwaysLogin",requiredCapabilities:"login"}),u};n(function(){n("[data-profile-social-linker]").each(function(){var n=window.SocialLinkerData[this.id]||{},i=t.MyAccount.SocialLinkerViewModel(n,this.id);ko.applyBindings(i,this)})})}(jQuery,window.GeneralMills||(window.GeneralMills={})),function(n,t,i){function u(n){var t,i,r,u;return i=n.split(",")[0].split("."),t=i[i.length-1],r=n.split(",")[0],u=r.substring(0,r.length-t.length-1),t+":#"+u}var r="00000000-0000-0000-0000-000000000000";i.MyAccount=i.MyAccount||{};i.MyAccount.QuestionViewModel=function(n){var f={},e;return f.__type=u(n.$type),f.SiteQuestionID=n.SiteQuestionID,f.Text=n.Text,f.Code=n.Code,f.Description=n.Description,f.TypeOfQuestion=n.TypeOfQuestion,f.IsRequired=n.IsRequired,f.IsValid=t.observable(!0),n.Choices&&(e=1,f.Choices=t.persistentObservableArray(t.utils.arrayMap(n.Choices,function(t){return t.UITrackingId=n.UITrackingId+"_answer"+e,e++,i.MyAccount.AnswerViewModel(t)}))),n.Selection&&(f.SelectedIds=t.persistentObservableArray(t.utils.arrayMap(n.Selection,function(n){return n.Value})),f.Selection=t.computed(function(){return t.utils.arrayMap(f.SelectedIds(),function(n){return t.utils.arrayFirst(f.Choices(),function(t){return t.Value()===n})})})),n.Choices&&n.Answer&&(f.PlaceholderText="",n.Answer.Value===r?(f.PlaceholderText=" ",f.SelectedId=t.persistentObservable()):f.SelectedId=t.persistentObservable(n.Answer.Value),f.Answer=t.computed(function(){return t.utils.arrayFirst(f.Choices(),function(t){return t.Value()===f.SelectedId()?(t.UITrackingId=n.UITrackingId+"_answer",!0):!1})})),n.Answer&&!f.Answer&&(n.Answer.UITrackingId=n.UITrackingId+"_answer",f.Answer=t.persistentObservable(i.MyAccount.AnswerViewModel(n.Answer))),f};i.MyAccount.AnswerViewModel=function(n){var i={};return i.__type=u(n.$type),i.ID=n.ID,i.IsNoChoice=n.IsNoChoice,i.Value=t.persistentObservable(n.Value),i.UITrackingId=n.UITrackingId,n.Sequence&&(i.Sequence=n.Sequence),n.Text&&(i.Text=n.Text),i};i.MyAccount.ProfileQuestionsViewModel=function(u){function o(){u.editModeOnly||(f.editMode(!1),f.errorMessages.removeAll(),t.utils.arrayForEach(f.questions(),function(n){n.IsValid(!0)}))}function s(){t.utils.commitChanges(f)}function h(){t.utils.cancelChanges(f)}var f={},e;return f.editMode=t.observable(u.editModeOnly),f.editModeOnly=u.editModeOnly,f.displayEdit=u.displayEdit&&!f.editMode(),f.publicProfileView=u.publicProfileView,f.errorMessages=t.observableArray([]),f.successMessage=t.observable(),u.questions?(e=[],n.each(u.questions,function(n,t){t.UITrackingId=u.id+"_profileQuestions_question"+(n+1);e.push(i.MyAccount.QuestionViewModel(t))}),f.questions=t.persistentObservableArray(e)):f.questions=t.persistentObservableArray([]),f.isValid=t.computed(function(){return t.utils.arrayFirst(f.questions(),function(n){return!n.IsValid()})===null&&f.errorMessages().length<=0}),f.getQuestionTemplate=function(n){return"ProfileAnswerTemplate-"+n.TypeOfQuestion},f.getSimpleText=function(n){return n.Answer().Value()===""?u.genericUnansweredText:n.Answer().Value()},f.getSingleSelectText=function(n){return!n.Answer()||n.Answer().Value===r||n.Answer().IsNoChoice?u.genericUnansweredText:n.Answer().Text},f.getBooleanText=function(n){return n.Answer().ID===r?u.genericUnansweredText:n.Answer().Value()?u.booleanTrueAnswerText:u.booleanFalseAnswerText},f.getMultiSelectText=function(n){var i=n.Selection();return(i=t.utils.arrayFilter(i,function(n){return!n.IsNoChoice}),i.length===0)?u.genericUnansweredText:t.utils.arrayMap(i,function(n){return n.Text}).join(", ")},f.isChecked=function(n,t){return t.Selection&&t.Selection.indexOf(n)>-1},f.selectChoice=function(n,t){f.isChecked(n,t)?t.Selection.remove(n):t.Selection.push(n)},f.saveAnswers=function(){if(f.validateQuestions(),f.areQuestionsValid()){var i={QuestionColl:f.questions()},r=t.toJSON({collection:i});n.ajax({url:"/Shared/MyAccount/Services/MyAccountService.svc/UpdatePersonalQuestions",type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:r,cache:!1,success:f.handleSuccessResult,error:function(n){n.responseText!=undefined?f.errorMessages.push(n.responseText):f.errorMessages.push(n)}})}},f.validateQuestions=function(){return t.utils.arrayForEach(f.questions(),function(n){if(n.IsRequired){if(n.IsValid(!0),n.Answer||n.Selection)if(!n.Answer||n.Answer()||n.Selection)if(n.Answer||n.Selection||n.Selection()){if(n.Answer&&!n.Answer()&&!n.Selection&&!n.Selection())return n.IsValid(!1)}else return n.IsValid(!1);else return n.IsValid(!1);else return n.IsValid(!1);if(n.TypeOfQuestion===0&&(!n.Answer().Value()||n.Answer().Value()==="")||n.Answer&&n.Answer()&&n.Answer().IsNoChoice===!0||n.Selection&&n.Selection()&&t.utils.arrayFirst(n.Selection(),function(n){return n.IsNoChoice===!0})!==null||n.Selection&&n.Selection().length<=0||n.Answer&&n.Answer.hasOwnProperty("Value")&&!n.Answer.Value||n.Answer&&n.Answer.hasOwnProperty("Text")&&!n.Answer.Text)return n.IsValid(!1)}})},f.areQuestionsValid=function(){return t.utils.arrayFirst(f.questions(),function(n){return!n.IsValid()})===null},f.beginEdit=function(){f.editMode(!0);f.errorMessages.removeAll()},f.cancelEdit=function(){h();o()},f.handleSuccessResult=function(n){n&&n.length>0?t.utils.arrayForEach(n,function(n){var i=t.utils.arrayFirst(f.questions(),function(t){return t.SiteQuestionID===n.FieldId});i?i.IsValid(!1):f.errorMessages.push(n.Message||u.unknownErrorMessage)}):(s(),o(),i.Analytics.raiseEvent({EventType:"ProfileUpdate"}),f.questions.valueHasMutated(),f.successMessage(u.successMessage))},f.getEditButtonUniqueId=function(){return u.id+"_profileQuestions_edit"},f.getSaveButtonUniqueId=function(){return u.id+"_profileQuestions_save"},f.getCancelButtonUniqueId=function(){return u.id+"_profileQuestions_cancel"},f};n(function(){n("[data-profile-questions]").each(function(){var n=window.QuestionData[this.id]||{},r=i.MyAccount.ProfileQuestionsViewModel(n);t.applyBindings(r,this)})})}(jQuery,ko,window.GeneralMills||(window.GeneralMills={}));window.GeneralMills||(window.GeneralMills={}),function(n,t,i){"use strict";i.NativeAds=i.NativeAds||{};i.NativeAds.BrandingHeader=function(){var r={};return r.Initialize=function(n,t,i){n&&(r.ApplyPictureFill(),t&&r.ApplyContentClickEvent(),i&&r.ApplySponsorClickEvent())},r.ApplyPictureFill=function(){var n=document.getElementById("nativeAdsBrandingHeader");typeof t.picturefill=="function"&&n?(r.LogMessage("Applying picturefill to 'nativeAdsBrandingHeader'"),t.picturefill("nativeAdsBrandingHeader"),r.RaiseEvent("ProgramContentImpression")):r.LogMessage("picturefill not a function or nativeAdsBrandingHeader element not found in DOM")},r.ApplyContentClickEvent=function(){n(".nativeAdsBrandingHeaderLink","#nativeAdsBrandingHeader").click(function(){r.RaiseEvent("ProgramContentClick")})},r.ApplySponsorClickEvent=function(){n(".nativeAdsSponsorLink","#nativeAdsBrandingHeader").click(function(){r.RaiseEvent("ProgramSponsorClick")})},r.RaiseEvent=function(n){if(!n){r.LogMessage("Aborting RaiseEvent because eventType is not defined");return}var t={EventType:n,ProgramCreativeType:"Branding Header"};i.Analytics.raiseEvent(t)},r.LogMessage=function(n){n&&t.console&&t.console.log("[NativeAds - BrandingHeader] "+n)},r}}(jQuery,window,window.GeneralMills),function(n,t,i){i.GeneralMills=i.GeneralMills||{};GeneralMills.ActionToolbar=GeneralMills.ActionToolbar||{};GeneralMills.ActionToolbar.Util={};GeneralMills.ActionToolbar.Actions={};GeneralMills.ActionToolbar.debugMode=GeneralMills.ActionToolbar.debugMode||!1;var r=GeneralMills.ActionToolbar.debugMode;GeneralMills.ActionToolbar.initialize=function(n){var i=GeneralMills.ActionToolbar.ViewModel(n);t.applyBindings(i,document.getElementById(n.ControlIds.ToolbarId));i.init()};GeneralMills.ActionToolbar.ViewModel=function(u){var f={},e={};return u=n.extend({Id:"",ControlIds:{},FavoriteButtonId:"a4fff957-6f0a-4e2f-820f-3f2cfbceef64",IsFavoriteItem:!1,NamePassedToEvents:"",Buttons:[],ESourceCode:"",LessButtonText:"",MoreButtonText:"",RegAction:"",RegistrationUrl:"",IsCurrentUserAnonymous:!0,UseModalRegistration:!1,RecaptchaPublicKey:"",PageUrl:"",DialogSettings:{},TestMode:!1,PrivacyOptOut:!1},u),u.TestMode&&(r=!0,e.internal=f,f.config=u),f.constants={buttonTypeCustom:"custom",cookieName:"actionToolbar_initialState_",eSourceCode:"&esrc=",expandedClass:"expanded",regAction:"?regAction=",regFirstStep:"&isRegistrationFirstStep=",returnUrl:"&returnUrl=",$Id:"#"},f.actions=new GeneralMills.ActionToolbar.Actions(e,u.TestMode),f.cookieName=f.constants.cookieName+u.Id,e.messageDialog=new GeneralMills.ActionToolbar.MessageDialog,e.toolbarName=u.NamePassedToEvents,e.emailDialog=new GeneralMills.ActionToolbar.EmailDialog({id:u.Id,pageUrl:u.PageUrl,recaptchaKey:u.RecaptchaPublicKey,displaySettings:u.DialogSettings,confirmationDialog:e.messageDialog,toolbarName:e.toolbarName}),e.isFavoriteItem=t.observable(u.IsFavoriteItem),e.isExpanded=t.observable(!1),e.isPrivacyOptedOut=u.PrivacyOptOut,e.expandCollapseText=t.observable(u.MoreButtonText),e.performAction=function(n){r&&console.log("Perform action: "+n);var t=f.findButton(n),e="",o=[];if(!t){r&&console.log("Button not found["+n+"]");return}if(e=t.Type.toLowerCase(),u.IsCurrentUserAnonymous&&!t.AllowedForAnonymousUsers){f.setCookie(n,t);f.openRegistration();return}if(e===f.constants.buttonTypeCustom&&(f.actions[e]=GeneralMills.ActionToolbar.Util.getFunctionByName(t.JavaScriptFunctionName,i)),o.push(t),!f.actions[e]){r&&console.log("Button type missing or invalid ["+n+", "+t.Type+"]");return}i.utag_data||r&&console.log("Missing utag data");r&&console.log("Invoking: "+e);f.actions[e].apply(this,o);f.incrementShareCount(n)},e.toggleExpanded=function(){var n=!e.isExpanded();e.isExpanded(n);e.expandCollapseText(n?u.LessButtonText:u.MoreButtonText)},e.preventDefaultClick=function(n){n.preventDefault()},e.init=function(){var n=f.getCookieData();f.isAutoFavorite()&&!u.IsFavorite?e.performAction(u.FavoriteButtonId):n&&n.buttonId&&n.buttonId===u.FavoriteButtonId?u.IsFavorite||e.performAction(n.buttonId):n&&n.buttonId&&e.performAction(n.buttonId);f.deleteCookie()},f.openRegistration=function(){var t=i.reg,r,n={returnUrl:i.location,isAuthenticated:!1,isRegistrationFirstStep:!1,isScreenNameSet:!1,RegAction:u.RegAction,esrc:u.ESourceCode};u.UseModalRegistration&&t?t.userRegistration.openRegistrationDialog(n):u.RegistrationUrl&&(r=[u.RegistrationUrl,f.constants.regAction+n.RegAction,f.constants.eSourceCode+n.esrc,f.constants.regFirstStep+n.isRegistrationFirstStep,f.constants.returnUrl+encodeURIComponent(n.returnUrl)],f.redirect(r.join("")))},f.setCookie=function(t){t&&n.cookie(f.cookieName,JSON.stringify({buttonId:t}))},f.getCookieData=function(){var t=decodeURI(n.cookie(f.cookieName))||"{}";return n.parseJSON(t)},f.deleteCookie=function(){n.cookie(f.cookieName,null)},f.redirect=function(n){i.location=n},f.findButton=function(n){return t.utils.arrayFirst(u.Buttons,function(t){return t.Id===n})},f.isAutoFavorite=function(){return GeneralMills.ActionToolbar.Util.getQueryString().AutoOpen==="AddToFavorites"},f.incrementShareCount=function(t){var i=n(".atButton[data-button-id='"+t+"'] .atbCount");i.each(function(){var t=n(this),i=t.text();isNaN(i)||t.text(parseInt(i,10)+1)})},r&&console.log(u),e};GeneralMills.ActionToolbar.MessageDialog=function(){var n={};return n.isVisible=t.observable(!1),n.message=t.observable(),n.show=function(){n.isVisible(!0)},n.hide=function(){n.isVisible(!1)},n};GeneralMills.ActionToolbar.EmailDialog=function(i){var u={eventType:"Email",sendEmailUrl:"/api/actionToolbarEmail/Send",recaptchaWidget:null,recaptchaToken:null,recaptchaLoadSubscription:null,constants:{recaptchaErrorMessage:"We're sorry. Email validation is down at this time. Please try again later."}},f={};return(i.testMode&&(r=!0,f.internal=u),!i.id||!i.confirmationDialog||!i.recaptchaKey||!i.displaySettings)?(r&&console.log("Missing or invalid email dialog configuration values"),r&&console.log(i),f):(f.requiredFieldText=i.displaySettings.RequiredFieldText,f.sendToText=i.displaySettings.SendToText,f.emailAddressesLabel=i.displaySettings.EmailAddressesLabel,f.emailInstructionText=i.displaySettings.EmailInstructionText,f.fromText=i.displaySettings.FromText,f.senderEmailAddressLabel=i.displaySettings.SenderEmailAddressLabel,f.firstNameLabel=i.displaySettings.SenderFirstNameLabel,f.copyToSenderLabel=i.displaySettings.CopyToSenderLabel,f.cancelButtonText=i.displaySettings.CancelButtonText,f.sendButtonText=i.displaySettings.SendButtonText,f.privacyPolicyText=i.displaySettings.PrivacyPolicyText,f.isVisible=t.observable(!1),f.heading=t.observable(""),u.recaptchaKey=i.recaptchaKey,u.emailCode="",u.buttonName="",u.emailAttributes=[],u.toolbarName=i.toolbarName,f.dialogId="emailDialog_"+i.id,f.validationMessages=t.observableArray(),f.hasMessages=t.computed(function(){return f.validationMessages().length>0}),f.toEmailAddressesDelimited=t.observable(),f.senderEmailAddress=t.observable(""),f.senderFirstName=t.observable(""),f.sendCopyToSender=t.observable(!1),f.hide=function(){u.recaptchaLoadSubscription&&u.recaptchaLoadSubscription.dispose&&u.recaptchaLoadSubscription.dispose();f.isVisible(!1)},f.show=function(n){r&&console.log("Opening email dialog...");u.initializeForm();u.initializeRecaptchaForDialog();f.heading(n.DialogHeading);u.emailCode=n.EmailCode;u.buttonName=n.NamePassedToEvents;u.emailAttributes=GeneralMills.ActionToolbar.Util.getEmailAttributes(i.id);f.isVisible(!0)},u.clearValidationMessages=function(){f.validationMessages.removeAll()},u.initializeForm=function(){u.clearValidationMessages();f.toEmailAddressesDelimited("");f.senderEmailAddress("");f.senderFirstName("");f.sendCopyToSender(!1)},u.initializeRecaptchaForDialog=function(){if(u.recaptchaToken=null,!GeneralMills.ActionToolbar.Recaptcha.recaptchaLoaded()){r&&console.log("Recaptcha API did not load. Listen for load event to fire...");u.recaptchaLoadSubscription=GeneralMills.ActionToolbar.Recaptcha.recaptchaLoaded.subscribe(u.renderRecaptchaForEmail);return}u.recaptchaWidget===null?(r&&console.log("Recaptcha loaded, but no widget yet. Calling render..."),u.renderRecaptchaForEmail()):(r&&console.log("Stale recaptcha widget already exists, Calling reset: "+u.recaptchaWidget),GeneralMills.ActionToolbar.Recaptcha.reset(u.recaptchaWidget))},u.renderRecaptchaForEmail=function(){var n=u.findRecaptchaContainerElement(),t;if(!n)throw new Error("Recaptcha container not available in DOM for render.");t={sitekey:u.recaptchaKey,size:"invisible",callback:u.handleRecaptchaTokenChanged};u.recaptchaWidget=GeneralMills.ActionToolbar.Recaptcha.render(n,t);r&&console.log("Widget rendered: "+u.recaptchaWidget)},u.findRecaptchaContainerElement=function(){var n=document.getElementById(f.dialogId);return n.querySelector(".invisibleRecaptchaContainer")},u.handleRecaptchaTokenChanged=function(n){if(!n||n.length===0){r&&console.log("Invalid token returned from Recaptcha API.");return}r&&console.log("Recaptcha token changed for this dialog: "+u.recaptchaWidget);u.recaptchaToken=n;u.sendEmailRequest()},f.send=function(){if(u.clearValidationMessages(),!GeneralMills.ActionToolbar.Recaptcha.recaptchaLoaded()){r&&console.log("Unable to send. Recaptcha API did not load.");f.validationMessages.push(u.constants.recaptchaErrorMessage);return}if(!u.recaptchaToken){r&&console.log("Send clicked: Token is null, calling execute: "+u.recaptchaWidget);GeneralMills.ActionToolbar.Recaptcha.execute(u.recaptchaWidget);return}r&&console.log("Send clicked: Using existing token...");u.sendEmailRequest()},u.sendEmailRequest=function(){var n,t;if(u.clearValidationMessages(),!u.recaptchaToken){r&&console.log("Unable to send. Recaptcha token not available.");f.validationMessages.push(u.constants.recaptchaErrorMessage);return}n={EmailAddresses:u.toEmailAddressesList(),SenderEmailAddress:f.senderEmailAddress(),SenderFirstName:f.senderFirstName(),SendCopyToSender:f.sendCopyToSender(),CaptchaResponse:u.recaptchaToken,PageUrl:i.pageUrl,EmailCode:u.emailCode,Attributes:u.emailAttributes};r&&console.log(n);t=GeneralMills.ActionToolbar.Util.http.POST(u.sendEmailUrl,JSON.stringify(n));t.success(u.onEmailSent);t.error(u.onEmailError)},u.toEmailAddressesList=function(){return GeneralMills.ActionToolbar.Util.splitCommaDelimitedString(f.toEmailAddressesDelimited())},u.parseResultMessages=function(t,i){if(!t){f.validationMessages.push(i);return}var r=t.message||i;f.validationMessages.push(r);n.isPlainObject(t.validationMessages)&&n.each(t.validationMessages,function(n){f.validationMessages.push(t.validationMessages[n])})},u.onEmailSent=function(n){if(n==null||n.status===null||n.status===-1)u.parseResultMessages(n,"The specified values failed at least one validation. Email was not sent.");else if(n.status===1){var t=n.message||"Email sent successfully.";f.hide();i.confirmationDialog.message(t);i.confirmationDialog.show();GeneralMills.Analytics.raiseEvent({EventType:u.eventType,Position:u.toolbarName+"."+u.buttonName})}else u.parseResultMessages(n,"Unable to send email at this time. Please try again later.")},u.onEmailError=function(){u.initializeForm();f.validationMessages.push("There was a problem sending the email")},f)};GeneralMills.ActionToolbar.Actions=function(t,u){var e={},f={addFavoriteUrl:"/api/actionToolbarFavorite/add/",removeFavoriteUrl:"/api/actionToolbarFavorite/remove/",positionParameter:"&position="};return u&&(r=!0,e.internal=f),e.print=function(n){r&&console.log(n);var i=t.toolbarName+"."+n.NamePassedToEvents;n.LayoutParameter?GeneralMills.ActionToolbar.Util.appendToQueryString(decodeURIComponent(n.LayoutParameter),f.positionParameter+i):(GeneralMills.ActionToolbar.Util.print(),GeneralMills.Analytics.raiseEvent({EventType:"Print",Position:i}))},e.email=function(n){r&&console.log(n);t.emailDialog.show(n)},e.favorite=function(n){var e,o,u;r&&console.log(n);e=t.isFavoriteItem();o=e?f.removeFavoriteUrl:f.addFavoriteUrl;f.onFavoriteRequestSuccess=function(){var r=!t.isFavoriteItem();t.isFavoriteItem(r);r&&GeneralMills.Analytics.raiseEvent({EventType:"AddToFavorites",ContentId:i.utag_data.ContentId,ContentTitle:i.utag_data.ContentTitle,ContentType:i.utag_data.ContentType,RecordType:i.utag_data.RecordType,Position:t.toolbarName+"."+n.NamePassedToEvents})};f.onFavoriteRequestError=function(){var i=!t.isFavoriteItem(),r=i?n.AddFavoriteErrorMessage:n.RemoveFavoriteErrorMessage;t.messageDialog.message(r);t.messageDialog.show()};u=GeneralMills.ActionToolbar.Util.http.POST(o+i.utag_data.ContentId);u.success(f.onFavoriteRequestSuccess);u.error(f.onFavoriteRequestError)},e.social=function(i){var s,h,f,c;if(r&&console.log(i),t.isPrivacyOptedOut){r&&console.log("User is opted out of social sharing functionality");t.messageDialog.message(i.PrivacyOptOutMessage);t.messageDialog.show();return}if(!gigya||!gigya.socialize){r&&console.log("Gigya namespace not found");return}if(!i.ProviderName){r&&console.log("Social network provider name missing or invalid");return}var u=n('meta[property="og:description"]').attr("content"),l=n('meta[property="og:image"]').attr("content"),o=n('meta[property="og:title"]').attr("content"),e=n('meta[property="og:url"]').attr("content");if(!o||!e){r&&console.log("At least one required open graph tag value was not found ["+o+", "+e+"]");return}u&&u.length>499&&(u=u.substring(0,496),s=u.lastIndexOf(" "),u=u.substring(0,s)+"...");h={type:"image",src:l,href:e};f=new gigya.socialize.UserAction;f.setLinkBack(e);f.setTitle(o);f.setDescription(u);f.addMediaItem(h);c={provider:i.ProviderName,url:e,userAction:f,cid:i.ProviderName+" share from ActionToolbar",shortURLs:"never",description:u,title:o};gigya.socialize.postBookmark(c);GeneralMills.Analytics.raiseEvent({EventType:"SocialShare",SocialNetwork:i.ProviderNamePassedToEvents,Position:t.toolbarName+"."+i.NamePassedToEvents})},e};GeneralMills.ActionToolbar.Recaptcha=function(){var n={};return n.recaptchaLoaded=t.observable(!1),n.recaptchaOnloadComplete=function(){r&&console.log("Recaptcha onload callback fired.");n.recaptchaLoaded(!0)},n.render=function(n,t){return r&&console.log("grecaptcha.render()..."),i.grecaptcha.render(n,t)},n.execute=function(n){r&&console.log("grecaptcha.execute()...");i.grecaptcha.execute(n)},n.reset=function(n){r&&console.log("grecaptcha.reset()...");i.grecaptcha.reset(n)},i.recaptchaOnloadComplete=n.recaptchaOnloadComplete,n}();GeneralMills.ActionToolbar.Util=function(){var t={};return t.print=function(){i.print()},t.appendToQueryString=function(n,t){var r=i.location.search;i.location.search=r.length===0?"?"+n+t:r+"&"+n+t},t.getFunctionByName=function(n,t){var i,u,r;if(!n||!t)return null;for(i=n.split("."),u=i.pop(),r=0;r<i.length;r++)t=t[i[r]];return t[u]},t.getQueryString=function(){var n=i.location.search;return function(n){var r,t,i;if(n==="")return{};for(r={},t=0;t<n.length;++t)(i=n[t].split("="),i.length==2)&&(r[i[0].replace(/^\?/,"")]=decodeURIComponent(i[1].replace(/\+/g," ")));return r}(n.split("&"))},t.getEmailAttributes=function(t){return n("#gmi_actionToolbar_"+t).data("emailAttributes")||[]},t.splitCommaDelimitedString=function(n){var t=[];return!n||typeof n!="string"?t:(n.split(",").forEach(function(n){n&&t.push(n.trim())}),t)},t.http=function(){var t=function(t,i){return n.ajax({type:"POST",dataType:"json",url:t,contentType:"application/json; charset=utf-8",data:i})},i=function(t,i){return n.ajax({type:"GET",dataType:"json",url:t,contentType:"application/json; charset=utf-8",data:i})};return{POST:t,GET:i}}(),t}();t.bindingHandlers.delegatedAction={init:function(t,i,r,u){n(t).on("click","li[data-button-id]",function(){var t=n(this).data("buttonId");u.performAction(t)})}};t.bindingHandlers.jqDialog={init:function(r,u,f){var e=t.utils.unwrapObservable(u())||{};setTimeout(function(){e.close=function(){f().jqDialogVisible(!1)};e=n.extend({position:{my:"top",at:"center top+140",collision:"none",of:i}},e);n(r).dialog(e)},0);t.utils.domNodeDisposal.addDisposeCallback(r,function(){n(r).dialog("destroy")})},update:function(i,r,u){var e=t.utils.unwrapObservable(u().jqDialogVisible),f=n(i),o=f.data("ui-dialog")||f.data("dialog");o&&f.dialog(e?"open":"close")}}}(jQuery,ko,window),function(n){window.GeneralMills=window.GeneralMills||{};GeneralMills.PandoSites=GeneralMills.PandoSites||{};n(function(){var t={},r=n(".recipeDetail").length>0,i;r&&(t={contentType:"recipe"});i=GeneralMills.PandoSites.EmailAttributes(t);i.init()});GeneralMills.PandoSites.EmailAttributes=function(t){var r={},i={};return t.testMode&&(r.internal=i),i.config=n.extend({contentType:"article",attributeSeparator:"%%"},t),i.emailAttributes=[],r.init=function(){i.pageHasToolbars()&&(i.addAttribute("TITLE",i.getAttribute("title")),i.addAttribute("DESCRIPTION",i.getAttribute("description")),i.addAttribute("IMAGE",i.getAttribute("image")),i.addAttribute("CONTENT_TYPE",i.config.contentType),i.applyEmailAttributes(i.emailAttributes))},i.addAttribute=function(n,t){var r=t?t:" ";n&&i.emailAttributes.push(n+i.config.attributeSeparator+r)},i.getAttribute=function(t){return n('meta[property="og:'+t+'"]').attr("content")},i.pageHasToolbars=function(){var t=n(".actionToolbar");return t.length>0},i.applyEmailAttributes=function(t){var i=n(".actionToolbar");i.each(function(){n(this).data("emailAttributes",t)})},r}}(jQuery),function(n,t){"use strict";t.GeneralMills=t.GeneralMills||{};GeneralMills.Coupons=GeneralMills.Coupons||{};var i=function(){return GeneralMills.Coupons.debugMode||!1};GeneralMills.Coupons.PrintControl3LegacyWrapper=function(){var r={},n={key:"new",sslFlag:!0,isInitialized:!1};return r.initialize=function(){if(i()&&console.log("PrintControl3LegacyWrapper.initialize()..."),n.legacyPrintControl=t.COUPONSINC&&t.COUPONSINC.printcontrol,!n.legacyPrintControl||!n.legacyPrintControl.init)throw new Error("COUPONSINC Legacy printcontrol not available. Was printcontrol_v3.js loaded?");return n.isInitialized=!0,n.legacyPrintControl.init(n.key,n.sslFlag)},r.printCoupons=function(t){return n.legacyPrintControl.printCoupons(t)},r.isEnabled=function(){return n.isInitialized&&n.legacyPrintControl.isPrintControlInstalled()},r}();GeneralMills.Coupons.PrintIdServiceWrapper=function(){var r={},u={};return r.constants={printIdIframeId:"PrintIdIframe",printCouponsDialogId:"PrintCouponsDialog",printCouponsIframeId:"PrintCouponsIframe",quotientUnregisteredId:"G",printWindowCloseDelay:1500},u.initialize=function(t){if(i()&&console.log("PrintIdServiceWrapper.initialize()..."),!t||!t.AffiliateId||!t.PropertyId||!t.NId||!t.ZId)throw new Error("Required Print ID config not defined.");return i()&&t.printWindowDelayOverride&&(r.constants.printWindowCloseDelay=t.printWindowDelayOverride),r.config=t,r.printId=null,r.closingForPrintResponse=null,r.printIdDeferred=n.Deferred(),r.printUtility=GeneralMills.Coupons.PrintUtility,u.initializePrintIdIframe(t),r.printIdDeferred.promise()},u.setPrintId=function(n){r.printId=n&&n.length>0&&n!==r.constants.quotientUnregisteredId?n:null},u.getPrintId=function(){return r.printId},u.isEnabled=function(){return!!(r.printIdDeferred&&r.printIdDeferred.state()==="resolved")},u.initializePrintIdIframe=function(n){var f=r.printUtility.buildGetPrintIdPageUrl(n),i=document.getElementById(r.constants.printIdIframeId);if(t.addEventListener("message",u.quotientWindowMessageHandler),i)i.src=f,i.onload=u.printIdIframeLoaded;else throw new Error("Required PrintID iframe not available.");},u.printIdIframeLoaded=function(n){if(i()&&console.log("printIdIframe loaded..."),!n||!n.target||!n.target.contentWindow)throw new Error("Unable to communicate with Quotient 'getSecurePrintID' window via iframe.");var t=n.target.contentWindow,u=JSON.stringify({method:"getSecurePrintID"});t.postMessage(u,r.printUtility.quotientBaseUrl())},u.quotientWindowMessageHandler=function(n){if(n&&n.data&&n.origin===r.printUtility.quotientBaseUrl()){var t=JSON.parse(n.data);i()&&console.log("quotient message received: "+JSON.stringify(n.data));t.action&&(t.action==="getSecurePrintID"?u.handleGetPrintIdMessage(t):t.action==="securePrintCoupons"&&u.handlePrintCouponsMessage(t))}else i()&&console.log("Unexpected window message received: "+n.origin+", data: "+JSON.stringify(n.data))},u.handleGetPrintIdMessage=function(n){n&&n.guid?(i()&&console.log("PrintID/DeviceID received from Quotient: "+n.guid),u.setPrintId(n.guid),r.printIdDeferred&&r.printIdDeferred.resolve({printId:u.getPrintId()})):(i()&&console.log("Unexpected PrintID response from Quotient: "+JSON.stringify(n)),r.printIdDeferred.reject())},u.handlePrintCouponsMessage=function(n){if(!n||!n.guid){u.closePrintWindow(!0);r.couponPrintDeferred&&r.couponPrintDeferred.reject("Failed with an invalid print response.");return}u.setPrintId(n.guid);var t=n.status,f=null;u.closePrintWindow(!0,function(){t===0?r.couponPrintDeferred.resolve(n):(f=t=="50"?"Print failed due to print restrictions! Error Status: "+t+", printId: "+u.getPrintId():"Unknown print failure! Error Status: "+t+", printId: "+u.getPrintId(),i()&&console.log(f),r.couponPrintDeferred.reject(n))})},u.printCoupons=function(i){r.couponPrintDeferred&&r.couponPrintDeferred.state()==="pending"&&r.couponPrintDeferred.reject("Cancel existing print to initiate new print");r.couponPrintDeferred=n.Deferred();var f=r.printUtility.buildPrintUrl(r.config,i);return r.printUtility.browserSupportsPopupWindow(t.navigator.userAgent)?u.showPrintPopup(f):u.showPrintIframeModal(f),r.couponPrintDeferred.promise()},u.showPrintPopup=function(n){i()&&console.log("Initiating print request via window url: "+n);r.quotientPrintWindow=t.open(n,"_blank","width=660,height=500");var f=setInterval(function(){r.quotientPrintWindow&&r.quotientPrintWindow.closed&&(clearInterval(f),u.handleUserCanceledPrint())},500)},u.handleUserCanceledPrint=function(){r.closingForPrintResponse!==!0&&(r.closingForPrintResponse=null,r.couponPrintDeferred&&r.couponPrintDeferred.state()==="pending"&&r.couponPrintDeferred.reject("Print canceled by user."))},u.showPrintIframeModal=function(n){i()&&console.log("Initiating print request via iframe modal: "+n);var f=r.printUtility.createIframe(r.constants.printCouponsIframeId,n),t=document.getElementById(r.constants.printCouponsDialogId);t.appendChild(f);r.quotientIframeModal=r.printUtility.createJqueryDialog(t,{dialogClass:"print-coupons-dialog-container",resizable:!1,modal:!0,width:500,close:u.handlePrintIframeModalClosing})},u.handlePrintIframeModalClosing=function(){u.handleUserCanceledPrint();u.closePrintWindow(!1)},u.closePrintWindow=function(n,t){r.closingForPrintResponse=!!n;r.quotientPrintWindow&&setTimeout(function(){r.quotientPrintWindow.close();i()&&console.log("Print popup window closed.");t&&t.apply(this)},r.constants.printWindowCloseDelay);r.quotientIframeModal&&(r.quotientIframeModal.find("iframe").remove(),r.quotientIframeModal.dialog("isOpen")&&(i()&&console.log("Closing print modal for IE..."),r.quotientIframeModal.dialog("close"),t&&t.apply(this)))},u}();GeneralMills.Coupons.PrintUtility=function(){var i={},r={};return r.constants={quotientBaseUrl:"https://www.coupons.com",quotientPrintIdPath:"/clippartner/getsecureprintid",quotientPrintCouponsPath:"/clippartner/secureprint",couponsService:"/api/Coupons"},i.quotientBaseUrl=function(){return r.constants.quotientBaseUrl},i.buildGetPrintIdPageUrl=function(n){var i=t.encodeURIComponent(n.PropertyId),u=t.encodeURIComponent(n.NId),f=t.encodeURIComponent(n.ZId),e=r.constants.quotientBaseUrl+r.constants.quotientPrintIdPath;return e+"?pid="+i+"&nid="+u+"&zid="+f},i.buildPrintUrl=function(n,u){var f=t.encodeURIComponent(n.AffiliateId),e=t.encodeURIComponent(n.PropertyId),o=t.encodeURIComponent(n.NId),s=t.encodeURIComponent(n.ZId),h=i.flattenArray(u),c=r.constants.quotientBaseUrl+r.constants.quotientPrintCouponsPath;return c+"?pid="+e+"&nid="+o+"&zid="+s+"&affiliate-id="+f+"&authprint-clipped-coupons-list="+h},i.flattenArray=function(n){var i="";return Array.isArray(n)&&n.forEach(function(n,r){r>0&&(i+=",");i+=t.encodeURIComponent(n)}),i},i.servicePost=function(t,i){return n.ajax({type:"POST",url:r.constants.couponsService+"/"+encodeURIComponent(t),data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json"})},i.createIframe=function(n,t){var i=document.createElement("iframe");return i.id=n,i.name=n,i.frameBorder="0",i.scrolling="no",i.setAttribute("src",t),i},i.createJqueryDialog=function(t,i){return n(t).dialog(i)},i.browserSupportsPopupWindow=function(n){var t=n.indexOf("MSIE")>=0||n.indexOf("Trident")>=0;return!t},i}();GeneralMills.Coupons.PrintAdapter=function(t){var r={},i={config:t,printUtility:GeneralMills.Coupons.PrintUtility,legacyPrintWrapper:GeneralMills.Coupons.PrintControl3LegacyWrapper,printIdServiceWrapper:GeneralMills.Coupons.PrintIdServiceWrapper,recordPrintResultAction:"RecordPrintResult"};return r.initializePrintIdService=function(){return i.printIdServiceWrapper.initialize(i.config)},r.initializeLegacyPrintControl=function(){return t.IsLegacyPrintModeEnabled===!0?i.legacyPrintWrapper.initialize():n.Deferred().reject()},r.isLegacyPrintingEnabled=function(){return i.legacyPrintWrapper.isEnabled()},r.isPrintIdServiceEnabled=function(){return i.printIdServiceWrapper.isEnabled()},r.getPrintId=function(){return i.printIdServiceWrapper.getPrintId()},r.printCoupons=function(t){var r=null,u;return t&&(t.legacyPrintToken?r=i.legacyPrintWrapper.printCoupons(t.legacyPrintToken):t.couponList&&(r=i.printIdServiceWrapper.printCoupons(t.couponList))),r||(u=n.Deferred().reject("Unable to print because the print request was not valid"),r=u.promise()),r},r.recordPrintResult=function(t){if(t){var r={statusCode:t.statusCode,legacyPrintToken:t.legacyPrintToken||null,printIdUserToken:t.printIdUserToken||null,couponList:t.couponList||null};return i.printUtility.servicePost(i.recordPrintResultAction,r)}return n.Deferred().reject("Invalid printResult").promise()},r}}(jQuery,window);jQuery(function(){jQuery("#fb-root").length===0&&jQuery("body").prepend('<div id="fb-root"><\/div>')});jQuery("document").ready(function(){jQuery("#recipeStoryForm").dialog({autoOpen:!1,modal:!0,width:280});jQuery("#reportAbuseForm").dialog({autoOpen:!1,modal:!0,width:280});jQuery("#reportAbuseForm a").click(function(){jQuery("#reportAbuseForm").dialog("close")});jQuery('#reportAbuseForm input[type="button"]').click(function(){RecipeStoryReportAbuse.submit()});jQuery('#reportAbuseForm input[name="reason"]').click(function(){RecipeStoryReportAbuse.setSubmitButtonStatus()});jQuery('#reportAbuseForm input[type="text"]').keyup(function(){RecipeStoryReportAbuse.setSubmitButtonStatus()});jQuery("#reportAbuseForm div.errorMessage").hide();jQuery("#reportAbuseForm div.thankYouMessage").hide()});RecipeStory=function(){};RecipeStory.OpenStory=function(){jQuery("#recipeStoryForm").dialog("open")};RecipeStoryReportAbuse=function(){};RecipeStoryReportAbuse.setSubmitButtonStatus=function(){var n=jQuery('#reportAbuseForm input[name="reason"]:checked').attr("value"),t;n==="Other"&&(t=jQuery('#reportAbuseForm input[name="otherReason"]').val(),n=t!==undefined&&t!==""?"Other: "+t:"");n!==undefined&&n!==""?jQuery("#reportAbuseForm .reportAbuseSubmitButton").removeAttr("disabled"):jQuery("#reportAbuseForm .reportAbuseSubmitButton").attr("disabled","disabled")};RecipeStoryReportAbuse.openReportAbuse=function(n,t,i){jQuery("#reportAbuseFormContentId").val(n);jQuery("#reportAbuseFormUrl").val(t);jQuery("#reportAbuseFormContentType").val(i);jQuery('#reportAbuseForm input[name="reason"]:checked').removeAttr("checked");jQuery('#reportAbuseForm input[name="otherReason"]').val("");jQuery("#reportAbuseForm div.errorMessage").hide();jQuery("#reportAbuseForm div.thankYouMessage").hide();jQuery("#reportAbuseForm").dialog("open")};RecipeStoryReportAbuse.closeReportAbuse=function(){jQuery("#reportAbuseForm").dialog("close")};RecipeStoryReportAbuse.submit=function(){var r=jQuery("#reportAbuseFormContentId").val(),u=jQuery("#reportAbuseFormUrl").val(),f=jQuery("#reportAbuseFormContentType").val(),t=jQuery('#reportAbuseForm input[name="reason"]:checked').attr("value"),n,i;t==="Other"&&(n=jQuery('#reportAbuseForm input[name="otherReason"]').val(),n!==undefined&&n!==""&&(t="Other: "+n));i={itemId:r,url:u,contentType:f,comment:t};jQuery.ajax({type:"POST",url:"/Shared/Common/Services/ReportAbuse.asmx/SubmitReportAbuse",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json",success:function(){jQuery("#reportAbuseForm div.thankYouMessage").show();setTimeout("RecipeStoryReportAbuse.closeReportAbuse()",3500)},error:function(){jQuery("#reportAbuseForm div.errorMessage").show()}})};jQuery(document).ready(function(){jQuery("span.recipePartBadgesDesc",jQuery(".recipePartBadgeList")).filter(function(){return jQuery.trim(jQuery(this).text())===""}).removeClass("recipePartBadgesDesc");jQuery(".recipePartBadgeListSec li a img").addClass("popTrigger");jQuery(".recipePartBadgeListSec li").each(function(){var n=jQuery(this).find("img.popTrigger").width(),t=jQuery(this).find("img.popTrigger").height();jQuery(this).find("div.recipePartsHoldPanl").css("width",n);jQuery(this).find("span.recipePartBadgesDesc").css("left",n/2-37);jQuery(this).find("span.recipePartBadgesDesc").css("bottom",t/2+5)});jQuery(".popTrigger",jQuery(".recipePartBadgeList")).hover(function(){jQuery(this).parent("a").next("span.recipePartBadgesDesc").css("display","block")},function(){jQuery(this).parent("a").next("span.recipePartBadgesDesc").css("display","none")});jQuery("span.recipePartBadgesDesc",jQuery(".recipePartBadgeList")).hover(function(){jQuery(this).css("display","block")},function(){jQuery(this).css("display","none")})});window.chicoryViewEventHasFired=!1,function(n){window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.ExpandableParts=GeneralMills.RecipeParts.ExpandableParts||{};window.GeneralMills.RecipeParts.ExpandableParts=function(){var t={};return t.initialize=function(){var i={expandableElement:n(".expandableRecipePart"),isToggleElementVisible:!0,callback:function(n){var t=n.data("tip-category");t&&GeneralMills.Analytics.raiseEvent({EventType:"TipExpand",TipCategoryName:t})}},t;n(".expandableRecipePartToggle").expandToggle(i);t={expandableElement:n(".recipePartSteps"),isToggleElementVisible:n("ul.recipePartStepsList li.recipePartStep .recipePartStepImage").length>0,callback:function(n,t){var i=t.data("showtext"),r=t.data("hidetext");n.hasClass("expanded")?t.text(i):t.text(r)}};n(".recipePartToggleImages").expandToggle(t)},n.fn.expandToggle=function(t){var i=n.extend({isToggleElementVisible:!1,expandableElement:this.parent(),expandedClassName:"expanded",callback:function(){}},t);return i.isToggleElementVisible?this.show().click(function(){var t=n(this),r=t.closest(i.expandableElement);r.toggleClass(i.expandedClassName);i.callback(r,t)}):this},t}();window.GeneralMills.RecipeParts.Ingredients=function(){var t={};return t.initialize=function(){var i=n(".recipeDetail").length>0,r=window.location.href.indexOf("/products/")>-1||window.location.href.indexOf("/brands/")>-1,t=i?"_recipe":r?"_product":"_CTC";window.addEventListener("chicory.view_button",function(){window.chicoryViewEventHasFired||(window.chicoryViewEventHasFired=!0,GeneralMills.Analytics.raiseEvent({EventType:"Buy_view",VendorExperience:"Chicory"+t}))});window.addEventListener("chicory.click_button",function(){GeneralMills.Analytics.raiseEvent({EventType:"Buy_click",VendorExperience:"Chicory"+t})})},t}();window.GeneralMills.RecipeParts.StepShots=function(){var n={};return n.initialize=function(){var r=document.querySelector("ul.recipePartStepsList"),t,n,i;if(r!=null)for(t=r.querySelectorAll(".recipePartStepImage img"),n=0;n<t.length;n++)i=t[n].getAttribute("data-src"),i!=null&&t[n].setAttribute("src",i)},n}(),function(){window.GeneralMills.RecipeParts.Ingredients.initialize()}();n(function(){window.GeneralMills.RecipeParts.ExpandableParts.initialize()})}(jQuery);window.matchMedia=window.matchMedia||function(n){var u,i=n.documentElement,f=i.firstElementChild||i.firstChild,r=n.createElement("body"),t=n.createElement("div");return t.id="mq-test-1",t.style.cssText="position:absolute;top:-100em",r.appendChild(t),function(n){return t.innerHTML='&shy;<style media="'+n+'"> #mq-test-1 { width: 42px; }<\/style>',i.insertBefore(r,f),u=t.offsetWidth==42,i.removeChild(r),{matches:u,media:n}}}(document),function(n,t){var i=t(n,n.document);n.lazySizes=i;typeof module=="object"&&module.exports&&(module.exports=i)}(window,function(n,t){"use strict";if(t.getElementsByClassName){var c,i,f=t.documentElement,e=n.Date,et=n.HTMLPictureElement,o="addEventListener",r="getAttribute",s=n[o],u=n.setTimeout,ot=n.requestAnimationFrame||u,d=n.requestIdleCallback,it=/^picture$/i,st=["load","error","lazyincluded","_lazyloaded"],p={},ht=Array.prototype.forEach,l=function(n,t){return p[t]||(p[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),p[t].test(n[r]("class")||"")&&p[t]},w=function(n,t){l(n,t)||n.setAttribute("class",(n[r]("class")||"").trim()+" "+t)},g=function(n,t){var i;(i=l(n,t))&&n.setAttribute("class",(n[r]("class")||"").replace(i," "))},a=function(n,t,i){var r=i?o:"removeEventListener";i&&a(n,t);st.forEach(function(i){n[r](i,t)})},v=function(n,i,r,u,f){var e=t.createEvent("Event");return r||(r={}),r.instance=c,e.initEvent(i,!u,!f),e.detail=r,n.dispatchEvent(e),e},nt=function(t,u){var f;!et&&(f=n.picturefill||i.pf)?(u&&u.src&&!t[r]("srcset")&&t.setAttribute("srcset",u.src),f({reevaluate:!0,elements:[t]})):u&&u.src&&(t.src=u.src)},h=function(n,t){return(getComputedStyle(n,null)||{})[t]},rt=function(n,t,r){for(r=r||n.offsetWidth;r<i.minSize&&t&&!n._lazysizesWidth;)r=t.offsetWidth,t=t.parentNode;return r},y=function(){var n,i,r=[],s=[],f=r,e=function(){var t=f;for(f=r.length?s:r,n=!0,i=!1;t.length;)t.shift()();n=!1},o=function(r,o){n&&!o?r.apply(this,arguments):(f.push(r),i||(i=!0,(t.hidden?u:ot)(e)))};return o._lsFlush=e,o}(),b=function(n,t){return t?function(){y(n)}:function(){var t=this,i=arguments;y(function(){n.apply(t,i)})}},ct=function(n){var r,f=0,h=i.throttleDelay,t=i.ricTimeout,o=function(){r=!1;f=e.now();n()},s=d&&t>49?function(){d(o,{timeout:t});t!==i.ricTimeout&&(t=i.ricTimeout)}:b(function(){u(o)},!0);return function(n){var i;((n=n===!0)&&(t=33),r)||(r=!0,i=h-(e.now()-f),i<0&&(i=0),n||i<9?s():u(s,i))}},ut=function(n){var t,r,i=99,f=function(){t=null;n()},o=function(){var n=e.now()-r;n<i?u(o,i-n):(d||f)(f)};return function(){r=e.now();t||(t=u(o,i))}};(function(){var t,r={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};i=n.lazySizesConfig||n.lazysizesConfig||{};for(t in r)t in i||(i[t]=r[t]);n.lazySizesConfig=i;u(function(){i.init&&k()})})();var ft=function(){var vt,rt,gt,ft,ni,ti,ii,et,ot,st,lt,kt,yt,dt,ei=/^img$/i,oi=/^iframe$/i,si="onscroll"in n&&!/(gle|ing)bot/.test(navigator.userAgent),hi=0,at=0,k=0,d=-1,pt=function(n){k--;n&&n.target&&a(n.target,pt);(!n||k<0||!n.target)&&(k=0)},ci=function(n,i){var u,r=n,e=h(t.body,"visibility")=="hidden"||h(n.parentNode,"visibility")!="hidden"&&h(n,"visibility")!="hidden";for(et-=i,lt+=i,ot-=i,st+=i;e&&(r=r.offsetParent)&&r!=t.body&&r!=f;)e=(h(r,"opacity")||1)>0,e&&h(r,"overflow")!="visible"&&(u=r.getBoundingClientRect(),e=st>u.left&&ot<u.right&&lt>u.top-1&&et<u.bottom+1);return e},ri=function(){var y,n,o,s,a,e,v,l,p,u=c.elements;if((ft=i.loadMode)&&k<8&&(y=u.length)){for(n=0,d++,yt==null&&("expand"in i||(i.expand=f.clientHeight>500&&f.clientWidth>500?500:370),kt=i.expand,yt=kt*i.expFactor),at<yt&&k<1&&d>2&&ft>2&&!t.hidden?(at=yt,d=0):at=ft>1&&d>1&&k<6?kt:hi;n<y;n++)if(u[n]&&!u[n]._lazyRace){if(!si){wt(u[n]);continue}if((l=u[n][r]("data-expand"))&&(e=l*1)||(e=at),p!==e&&(ti=innerWidth+e*dt,ii=innerHeight+e,v=e*-1,p=e),o=u[n].getBoundingClientRect(),(lt=o.bottom)>=v&&(et=o.top)<=ii&&(st=o.right)>=v*dt&&(ot=o.left)<=ti&&(lt||st||ot||et)&&(i.loadHidden||h(u[n],"visibility")!="hidden")&&(rt&&k<3&&!l&&(ft<3||d<4)||ci(u[n],e))){if(wt(u[n]),a=!0,k>9)break}else!a&&rt&&!s&&k<4&&d<4&&ft>2&&(vt[0]||i.preloadAfterLoad)&&(vt[0]||!l&&(lt||st||ot||et||u[n][r](i.sizesAttr)!="auto"))&&(s=vt[0]||u[n])}s&&!a&&wt(s)}},p=ct(ri),ui=function(n){w(n.target,i.loadedClass);g(n.target,i.loadingClass);a(n.target,fi);v(n.target,"lazyloaded")},li=b(ui),fi=function(n){li({target:n.target})},ai=function(n,t){try{n.contentWindow.location.replace(t)}catch(i){n.src=t}},vi=function(n){var t,u=n[r](i.srcsetAttr);(t=i.customMedia[n[r]("data-media")||n[r]("media")])&&n.setAttribute("media",t);u&&n.setAttribute("srcset",u)},yi=b(function(n,t,f,e,o){var s,h,l,c,p,b;(p=v(n,"lazybeforeunveil",t)).defaultPrevented||(e&&(f?w(n,i.autosizesClass):n.setAttribute("sizes",e)),h=n[r](i.srcsetAttr),s=n[r](i.srcAttr),o&&(l=n.parentNode,c=l&&it.test(l.nodeName||"")),b=t.firesLoad||"src"in n&&(h||s||c),p={target:n},b&&(a(n,pt,!0),clearTimeout(gt),gt=u(pt,2500),w(n,i.loadingClass),a(n,fi,!0)),c&&ht.call(l.getElementsByTagName("source"),vi),h?n.setAttribute("srcset",h):s&&!c&&(oi.test(n.nodeName)?ai(n,s):n.src=s),o&&(h||c)&&nt(n,{src:s}));n._lazyRace&&delete n._lazyRace;g(n,i.lazyClass);y(function(){(!b||n.complete&&n.naturalWidth>1)&&(b?pt(p):k--,ui(p))},!0)}),wt=function(n){var f,t=ei.test(n.nodeName),e=t&&(n[r](i.sizesAttr)||n[r]("sizes")),u=e=="auto";(u||!rt)&&t&&(n[r]("src")||n.srcset)&&!n.complete&&!l(n,i.errorClass)&&l(n,i.lazyClass)||(f=v(n,"lazyunveilread").detail,u&&tt.updateElem(n,!0,n.offsetWidth),n._lazyRace=!0,k++,yi(n,f,u,e,t))},bt=function(){if(!rt){if(e.now()-ni<999){u(bt,999);return}var n=ut(function(){i.loadMode=3;p()});rt=!0;i.loadMode=3;p();s("scroll",function(){i.loadMode==3&&(i.loadMode=2);n()},!0)}};return{_:function(){ni=e.now();c.elements=t.getElementsByClassName(i.lazyClass);vt=t.getElementsByClassName(i.lazyClass+" "+i.preloadClass);dt=i.hFac;s("scroll",p,!0);s("resize",p,!0);n.MutationObserver?new MutationObserver(p).observe(f,{childList:!0,subtree:!0,attributes:!0}):(f[o]("DOMNodeInserted",p,!0),f[o]("DOMAttrModified",p,!0),setInterval(p,999));s("hashchange",p,!0);["focus","mouseover","click","load","transitionend","animationend","webkitAnimationEnd"].forEach(function(n){t[o](n,p,!0)});/d$|^c/.test(t.readyState)?bt():(s("load",bt),t[o]("DOMContentLoaded",p),u(bt,2e4));c.elements.length?(ri(),y._lsFlush()):p()},checkElems:p,unveil:wt}}(),tt=function(){var n,f=b(function(n,t,i,r){var f,u,e;if(n._lazysizesWidth=r,r+="px",n.setAttribute("sizes",r),it.test(t.nodeName||""))for(f=t.getElementsByTagName("source"),u=0,e=f.length;u<e;u++)f[u].setAttribute("sizes",r);i.detail.dataAttr||nt(n,i.detail)}),r=function(n,t,i){var r,u=n.parentNode;u&&(i=rt(n,u,i),r=v(n,"lazybeforesizes",{width:i,dataAttr:!!t}),r.defaultPrevented||(i=r.detail.width,i&&i!==n._lazysizesWidth&&f(n,u,r,i)))},e=function(){var t,i=n.length;if(i)for(t=0;t<i;t++)r(n[t])},u=ut(e);return{_:function(){n=t.getElementsByClassName(i.autosizesClass);s("resize",u)},checkElems:u,updateElem:r}}(),k=function(){k.i||(k.i=!0,tt._(),ft._())};return c={cfg:i,autoSizer:tt,loader:ft,init:k,uP:nt,aC:w,rC:g,hC:l,fire:v,gW:rt,rAF:y}}}),function(n,t,i){t.GeneralMills=t.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.Utilities=function(){var r={};return r.getCookie=function(t){return n.cookie(t)},r.setCookie=function(t,i){n.cookie(t,i,{path:"/"})},r.getJson=function(t,i,r,u,f){n.ajax({contentType:"application/json; charset=UTF-8",dataType:"json",url:t,headers:i,data:r,success:u,error:f})},r.postJson=function(t,i,r,u,f){n.ajax({contentType:"application/json; charset=UTF-8",type:"POST",dataType:"json",url:t,headers:i,data:typeof r=="object"?JSON.stringify(r):r,success:u,error:f})},r.createDialog=function(t,i){var f=n("#"+t),u=f.data(),r;return u.zIndex=10005,typeof i=="function"&&(u.close=i),r=f.dialog(u),r.open=function(){r.dialog("open")},r.close=function(){r.dialog("close")},r.reposition=function(){r.dialog({position:{}})},r.isOpen=function(){return r.dialog("isOpen")},r},r.listenForMessage=function(n,i){var r=function(t){var r;try{r=JSON.parse(t.data);r.name&&r.name===n&&i(r.value)}catch(t){}};t.addEventListener("message",r,!1)},r.mapAndFlatten=function(n,t){return Array.prototype.concat.apply([],n.map(t))},r.scrollUpUntilTopIsVisible=function(t,u){var f=i.getElementById(t).getBoundingClientRect().top,e,o;f<0&&(e=r.getPageYOffset()+f,o=r.getViewportHeight()*u/100,n("html, body").animate({scrollTop:e-o}))},r.getPageYOffset=function(){return t.pageYOffset},r.getViewportHeight=function(){return t.innerHeight},r.removeDuplicates=function(n,t){for(var r=[],f,u,i=0;i<n.length;i++){for(f=!1,u=0;u<r.length;u++)if(t(n[i],r[u])){f=!0;break}f||r.push(n[i])}return r},r.checkForValue=function(n,t){return t.some(function(t){return n.indexOf(t)>-1})},r.getDocumentLocationHref=function(){return i.location.href},r.setDocumentLocationHref=function(n){i.location.href=n},r.setDocumentLocationHref=function(n){i.location.href=n},r.redirectAfterDelay=function(n,i){t.setTimeout(function(){r.setDocumentLocationHref(n)},i)},r.redirectInNewTab=function(n){t.open(n,"_blank")},r.formatExpirationDateString=function(n){if(Date.parse(n)){var t=new Date(n);return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()%100}return""},r.truncatedDescription=function(n,t){if(!t||t.length<n)return t;var i=t.substr(0,n-1);return i.substr(0,i.lastIndexOf(" "))},r.getShortDescriptionFromDescription=function(n,t){var i=n+t;return i&&i.length>=50?i.substring(0,40):i},r.getRemainderDescriptionFromDescription=function(n,t){var i=n+t;return i&&i.length>=50?i.substring(40,i.length):""},r.showCheckmark=function(n){typeof n=="function"&&(n(!0),setTimeout(function(){n(!1)},2e3))},r}();GeneralMills.RecipeParts.Savings.Retailers=function(n){var t={};return t.getMasterRetailers=function(t,i,r){var u={cellfireRetailerIds:t.join(","),myGroceryDealsChainIds:i.join(",")};n.getJson("/api/retailer/getMasterRetailers",null,u,function(n){if(n){r(n);return}r([])},function(n){console.log(n);r([])})},t}(GeneralMills.RecipeParts.Savings.Utilities);GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes=function(){var n={};return n.Any={name:"Any",sort:0,compare:function(n,t){return n.metadataSort<t.metadataSort?-1:n.metadataSort>t.metadataSort?1:n.contentType.sort<t.contentType.sort?-1:n.contentType.sort>t.contentType.sort?1:n.compareAmount>t.compareAmount?-1:n.compareAmount<t.compareAmount?1:0}},n.Cellfire={name:"Cellfire",template:"cellfire",sort:2,compare:function(n,t){return n.metadataSort<t.metadataSort?-1:n.metadataSort>t.metadataSort?1:n.formattedFaceValue>t.formattedFaceValue?-1:n.formattedFaceValue<t.formattedFaceValue?1:0}},n.CouponsInc={name:"Coupons Inc",template:"couponsinc",sort:1,compare:function(n,t){return n.metadataSort<t.metadataSort?-1:n.metadataSort>t.metadataSort?1:n.DollarSavingAmount>t.DollarSavingAmount?-1:n.DollarSavingAmount<t.DollarSavingAmount?1:0}},n.DealsNearMe={name:"Deals Near Me",template:"dealsnearme",sort:3,compare:function(n,t){return t.compareAmount-n.compareAmount}},n.NoCoupons={name:"No Coupons",sort:4},n.GetByName=function(t){return t==="Any"?n.Any:t==="Cellfire"?n.Cellfire:t==="Coupons Inc"?n.CouponsInc:t==="Deals Near Me"?n.DealsNearMe:n.NoCoupons},n}()}(jQuery,window,document),function(n,t){window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.Geolocation=function(){var i={};return i.cellfireLocationCookieName="cellfire.location",i.dealsNearMeLocationCookieName="DNMselectedZipCode",i.locationChangeSubscribers=[],i.subscribeToLocationChanges=function(n){i.locationChangeSubscribers.push(n)},i.getLocation=function(){var r=n.getCookie(i.dealsNearMeLocationCookieName);r?i.notifyLocationChangeSubscribers(r):t.getZipCode(i.locationRetrievedCallback)},i.locationRetrievedCallback=function(n){n&&i.saveLocation(n)},i.saveLocation=function(t){n.setCookie(i.cellfireLocationCookieName,t);n.setCookie(i.dealsNearMeLocationCookieName,t);i.notifyLocationChangeSubscribers(t)},i.notifyLocationChangeSubscribers=function(n){i.locationChangeSubscribers.forEach(function(t){t(n)})},i}()}(GeneralMills.RecipeParts.Savings.Utilities,GeneralMills.Geolocation),function(n,t){window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.MyGroceryDeals=function(){var r={},i={};return i.apiBaseUrl="https://api.mygrocerydeals.com/v2/",r.setTestMode=function(n){r.internal=n?i:undefined},r.selectedRetailerCookieName="DNMselectedRetailerId",r.getRecipeDeals=function(t,r,u,f,e){var o=i.apiBaseUrl+"recipes/"+f,s={"x-api-key":t},h={from:0,size:100,filter:{location:{zip:r}}};n.postJson(o,s,h,function(n){i.processRecipeResponse(n,u,e)},function(n){typeof e=="function"&&n&&n.status&&n.statusText&&(console.log("MyGroceryDeals API Error: Recipe search failed ("+n.status+":"+n.statusText+")"),e([]))})},r.getSearchTermDeals=function(t,r,u,f,e){var o=i.apiBaseUrl+"deals/search/",s={"x-api-key":t},h={from:0,size:100,ingredients:f,filter:{location:{zip:r}}};n.postJson(o,s,h,function(n){i.processSearchTermResponse(n,u,e)},function(n){typeof e=="function"&&n&&n.status&&n.statusText&&(console.log("MyGroceryDeals API Error: Deals search failed ("+n.status+":"+n.statusText+")"),e([]))})},i.processRecipeResponse=function(n,t,r){if(typeof r=="function"){if(n){if(n.recipes){var u=i.parseRecipeResults(n,t);r(u);return}if(n.status==="ERROR"&&n.message){console.log("MyGroceryDeals API Error: "+n.message);r([]);return}console.log("MyGroceryDeals API Error: Incorrect recipe data");r([]);return}console.log("MyGroceryDeals API Error: Failed to retrieve recipe data");r([])}},i.processSearchTermResponse=function(n,t,r){if(typeof r=="function"){if(n){if(n.status==="SUCCESS"){var u=i.parseSearchTermResults(n,t);r(u);return}if(n.status==="ERROR"){console.log("MyGroceryDeals API Error: "+n.message);r([]);return}console.log("MyGroceryDeals API Error: Incorrect search term data");r([]);return}console.log("MyGroceryDeals API Error: Failed to retrieve search term data");r([])}},i.parseSearchTermResults=function(i,r){var u=[];return i.groups?(i.groups.forEach(function(i){i.results.forEach(function(i){var o,f,e;i&&i.chain&&(o=parseInt(i.chain.id),f=u.filter(function(n){return n.id===o}),f.length===0?(f={id:o,offers:[]},u.push(f)):f=f[0],i.display_sale_end=n.formatExpirationDateString(i.sale_end),i.display_name=i.brand?i.brand+" "+i.name:i.name,i.display_additional=i.additional,i.remainder_display_additional=t.observable(i.additional),e="",i.size!==""&&(e=i.size,i.uom!==""&&(e=e+" "+i.uom)),i.display_package_size=e,i.contentId=i.id,i.contentType=GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes.DealsNearMe,i.metadataSort=999,i.compareAmount=0,i.truncatedDescription=t.computed(function(){if(i.display_additional.length>=50){var t=n.truncatedDescription(40,i.display_additional);return i.remainder_display_additional(i.remainder_display_additional().replace(t,"")),t}return i.remainder_display_additional(i.display_additional),i.display_additional}),i.showDescriptionLengthToggle=t.computed(function(){return i.display_additional!==i.remainder_display_additional()}),i.isShowingLongerDescription=t.observable(!1),i.toggleDescriptionLength=function(){i.isShowingLongerDescription(!i.isShowingLongerDescription())},i.descriptionLengthToggleText=t.computed(function(){return i.isShowingLongerDescription()?r.TextForShowingShorterDescription:r.TextForShowingLongerDescription}),f.offers.push(i))})}),u):u},i.parseRecipeResults=function(i,r){var u=[];return!i.recipes||!i.recipes[0].deals.groups?u:(i.recipes[0].deals.groups.forEach(function(i){var e,f;i&&i.group&&i.results&&((e=parseInt(i.group.id),isNaN(e))||(f={id:e,chains:[]},u.push(f),i.results.forEach(function(i){var o,u,e;i&&i.chain&&i.type==="special"&&(o=parseInt(i.chain.id),u=f.chains.filter(function(n){return n.id===o}),u.length===0?(u={id:o,offers:[]},f.chains.push(u)):u=u[0],i.display_sale_end=n.formatExpirationDateString(i.sale_end),i.display_name=i.brand?i.brand+" "+i.name:i.name,i.display_additional=i.additional,i.remainder_display_additional=t.observable(i.additional),e="",i.size!==""&&(e=i.size,i.uom!==""&&(e=e+" "+i.uom)),i.display_package_size=e,i.truncatedDescription=t.computed(function(){if(i.display_additional.length>=50){var t=n.truncatedDescription(40,i.display_additional);return i.remainder_display_additional(i.remainder_display_additional().replace(t,"")),t}return i.remainder_display_additional(i.display_additional),i.display_additional}),i.showDescriptionLengthToggle=t.computed(function(){return i.display_additional!==i.remainder_display_additional()}),i.isShowingLongerDescription=t.observable(!1),i.toggleDescriptionLength=function(){i.isShowingLongerDescription(!i.isShowingLongerDescription())},i.descriptionLengthToggleText=t.computed(function(){return i.isShowingLongerDescription()?r.TextForShowingShorterDescription:r.TextForShowingLongerDescription}),u.offers.push(i))})))}),u)},r}()}(GeneralMills.RecipeParts.Savings.Utilities,ko),function(n){window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.Cellfire=function(){var r="/api/offers/getOffersByFlavorFormat",t={},i;return t.selectedRetailerCookieName="cellfire.selectedRetailer",t.locationCookieName="cellfire.location",i=window.globalCellfireDisable||!1,t.getSavings=function(u,f){var e={flavorFormatMetadataGuids:u.join(","),lastViewedRetailerId:GeneralMills.RecipeParts.Savings.Utilities.getCookie(t.selectedRetailerCookieName)||0,location:GeneralMills.RecipeParts.Savings.Utilities.getCookie(t.locationCookieName)||""};if(i){f([]);return}n.getJson(r,null,e,function(n){f(n)},function(n){console.log(n);f([])})},t.addSavingToCard=function(t,i,r,u){n.postJson("/api/offers/addToCard",null,{couponIdsToAdd:[t],version:i},r,u)},t}()}(GeneralMills.RecipeParts.Savings.Utilities),function(n){window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.CouponsInc=GeneralMills.RecipeParts.Savings.CouponsInc||{};var t=GeneralMills.RecipeParts.Savings.CouponsInc,i="/api/Coupons/GetCouponsByFlavorFormat",r="/api/Coupons/SendClippedCouponsEmail",u="/api/Coupons/GetPrintToken";t.deviceId="";t.printId="";t.initialized=!1;t.canPrint=!0;t.loadCoupons=function(r,u,f){var e,o;if(!Array.isArray(r))throw new Error("argument 'flavorFormatMetadataIds' must be an array.");if(typeof u!="function")throw new Error("argument 'success' must be a function.");if(typeof f!="function")throw new Error("argument 'failure' must be a function.");e=t.deviceId;e===""&&(e=0);r=r.join(",");o={flavorFormatMetadataIds:r,deviceId:e,printId:t.printId};n.getJson(i,null,o,u,f)};t.printCoupons=function(i,r,f){if(!Array.isArray(i))throw new Error("argument 'coupons' must be an array.");if(typeof r!="function")throw new Error("argument 'success' must be a function.");if(typeof f!="function")throw new Error("argument 'failure' must be a function.");if(t.deviceId==="")t.printAdapter.printCoupons({couponList:i}).done(function(){t.handlePrintResponse(this,null,i,r)}).fail(function(){f()});else{var e={deviceId:t.deviceId,couponList:i};n.postJson(u,null,e,function(n){t.onGetTokenSuccess(n,i,r,f)},f)}};t.onGetTokenSuccess=function(n,i,r,u){var f=n;t.printAdapter.printCoupons({legacyPrintToken:f}).done(function(){t.handlePrintResponse(this,f,i,r)}).fail(function(){u()})};t.handlePrintResponse=function(n,i,r,u){var f={statusCode:n.statusCode};t.printAdapter.isPrintIdServiceEnabled()?(f.printIdUserToken=t.printAdapter.getPrintId(),f.couponList=r):t.printAdapter.isLegacyPrintingEnabled()&&(f.legacyPrintToken=i);t.printAdapter.recordPrintResult(f).always(function(){u()})};t.emailCoupons=function(t,i,u,f){if(!Array.isArray(t))throw new Error("argument 'couponNumbers' must be an array.");if(typeof i!="function")throw new Error("argument 'success' must be a function.");if(typeof u!="function")throw new Error("argument 'failure' must be a function.");t=t.join(",");var e={emailAddress:f||null,clippedCoupons:t};n.postJson(r,null,e,i,u)};t.initialize=function(n,i){if(t.initialized){i();return}t.printAdapter=new GeneralMills.Coupons.PrintAdapter(n);t.printAdapter.initializeLegacyPrintControl().done(function(){t.handleLegacyPrintControlInitialized(this,i)}).fail(function(){t.handleLegacyPrintControlFailed(i)})};t.handleLegacyPrintControlInitialized=function(n,i){n&&n.deviceId&&(t.deviceId=n.deviceId);t.initialized=!0;i()};t.handleLegacyPrintControlFailed=function(n){t.printAdapter.initializePrintIdService().done(function(){t.printId=t.printAdapter.getPrintId();t.initialized=!0;n()}).fail(function(){t.initialized=!0;t.canPrint=!1;n()})}}(GeneralMills.RecipeParts.Savings.Utilities,jQuery),function(){window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.Analytics=function(){var n={};return n.constants={delayInMillisecondsBeforeRedirecting:500,recordType:"Coupon",contentTypes:{Cellfire:"CardCoupon",CouponsInc:"PrintedCoupon",MyGroceryDeals:"InStoreSales",All:"AllDeals"},eventTypes:{email:"Email",print:"Print",seeAllSales:"SeeAllSales",addCoupon:"AddCoupon",retailerSearch:"RetailerSearch",retailerSelect:"RetailerSelect",viewCoupon:"ViewCoupon",expandSavings:"ExpandSavings",collapseSavings:"CollapseSavings",changeStore:"ChangeStore",cancel:"Cancel",proceed:"Proceed",showHelpOnError:"ViewHelpOnError",closeShowcaseModal:"CloseShowcaseModal"},displayTypes:{savingsShowcase:"SavingsShowcase",savingsByIngredient:"SavingsByIngredient",modal:"SavingsIndicator",nonmodal:"SavingsWidget"}},n.raiseSeeAllSalesEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.seeAllSales,ContentType:t,RecordType:n.constants.recordType})},n.raiseSeeHelpOnErrorEvent=function(t){GeneralMills.Analytics.raiseEvent({EventType:n.constants.eventTypes.showHelpOnError,ContentType:t,RecordType:n.constants.recordType})},n.raisePrintEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.print,RecordType:n.constants.recordType,ContentType:n.constants.contentTypes.CouponsInc,CouponBrandName:[t.brand],CouponId:[String(t.number)],OfferCode:[t.offerCode]})},n.raiseExpandSavingsEvent=function(t){GeneralMills.Analytics.raiseEvent({EventType:n.constants.eventTypes.expandSavings,RecordType:n.constants.recordType,DisplayType:t})},n.raiseCollapseSavingsEvent=function(t){GeneralMills.Analytics.raiseEvent({EventType:n.constants.eventTypes.collapseSavings,RecordType:n.constants.recordType,DisplayType:t})},n.raiseAddCouponEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.addCoupon,RecordType:n.constants.recordType,ContentType:n.constants.contentTypes.Cellfire,RetailerId:[String(t.merchantId)],RetailerName:[t.merchantName],CouponBrandName:[t.brandName],CouponId:[String(t.couponId)],OfferId:[String(t.offerId)],OfferCode:[t.offerCode]})},n.raiseChangeStoreEvent=function(t){GeneralMills.Analytics.raiseEvent({EventType:n.constants.eventTypes.changeStore,RecordType:n.constants.recordType,ContentType:n.constants.contentTypes.Cellfire,DisplayType:t})},n.raiseRetailerSearchEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.retailerSearch,RecordType:n.constants.recordType,SiteSearchPhrase:t})},n.raiseCancelEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.cancel,RecordType:n.constants.recordType,ContentType:t})},n.raiseEmailEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.email,RecordType:n.constants.recordType,ContentType:n.constants.contentTypes.CouponsInc,CouponBrandName:[t.brand],CouponId:[String(t.number)],OfferCode:[t.offerCode]})},n.raiseViewCouponEventForCellfireSavings=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.viewCoupon,ContentType:n.constants.contentTypes.Cellfire,RecordType:n.constants.recordType,RetailerId:t.map(function(n){return String(n.merchantId)}),RetailerName:t.map(function(n){return n.merchantName}),CouponBrandName:t.map(function(n){return n.brandName}),CouponId:t.map(function(n){return String(n.couponId)}),OfferId:t.map(function(n){return String(n.offerId)}),OfferCode:t.map(function(n){return n.offerCode}),CouponOfferCount:t.length})},n.raiseViewCouponEventForMyGroceryDealsSavings=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.viewCoupon,ContentType:n.constants.contentTypes.MyGroceryDeals,RecordType:n.constants.recordType,RetailerId:t.map(function(n){if(n.chain)return String(n.chain.id)}),RetailerName:t.map(function(n){if(n.chain)return n.chain.name}),CategoryId:t.map(function(n){if(n.major_category)return String(n.major_category.id)}),CategoryName:t.map(function(n){if(n.major_category)return n.major_category.name}),CouponBrandName:t.map(function(n){if(n.brand)return n.brand}),OfferId:t.map(function(n){return String(n.id)}),CouponOfferCount:t.length})},n.raiseViewCouponEventForCouponsIncSavings=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.viewCoupon,ContentType:n.constants.contentTypes.CouponsInc,RecordType:n.constants.recordType,CouponBrandName:t.map(function(n){return n.brand}),CouponId:t.map(function(n){return String(n.number)}),OfferCode:t.map(function(n){return n.offerCode}),CouponOfferCount:t.length})},n.raiseProceedEvent=function(t,i){GeneralMills.Analytics.raiseEvent({DisplayType:i,EventType:n.constants.eventTypes.proceed,RecordType:n.constants.recordType,ContentType:t})},n.raiseCloseShowcaseModalEvent=function(){GeneralMills.Analytics.raiseEvent({EventType:n.constants.eventTypes.closeShowcaseModal,RecordType:n.constants.recordType})},n.raiseRetailerSelectEvent=function(t){GeneralMills.Analytics.raiseEvent({EventType:n.constants.eventTypes.retailerSelect,RetailerId:t.id,RetailerName:t.name,RecordType:n.constants.recordType})},n}()}(),function(n,t,i,r,u,f,e,o,s,h,c){c.GeneralMills=c.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.ViewModel=function(o){var h={};return h.configuration=o,h.location=s.observable(),h.activeView=s.observable(),h.ingredients=s.observableArray(),h.activeIngredients=s.observableArray(),h.preferredMyGroceryDealsChainId=s.observable(),h.isDisplayingAllSavings=s.observable(!1),h.isSavingsListCollapsed=s.observable(!1),h.cellfireSavingsHaveBeenRetrieved=s.observable(!1),h.couponsIncSavingsHaveBeenRetrieved=s.observable(!1),h.myGroceryDealsSavingsHaveBeenRetrieved=s.observable(!1),h.customEmailAddress=s.observable(),h.activeSaving=s.observable(),h.isViewVisible=s.observable(!1),h.pendingSavingsRequestCount=s.observable(0),h.showLocationButtonClicked=s.observable(!1),h.minimumDescriptionCharacterCount=s.observable(50),h.nearbyGroceryDealChains=s.observableArray(),h.nearbyCellfireRetailers=s.observableArray(),h.savedCellfireRetailers=s.observableArray([]),h.masterRetailers=s.observableArray([]),h.selectedMasterRetailer=s.observable(0),h.currentMasterRetailer=s.observable(0),h.isShowingFilteredCheck=s.observable(!1),h.listButtonAvailableClass="savings-list-button-available",h.listButtonCompletedClass="savings-list-button-completed",h.views={list:1,email:2,noCard:5,noPrinter:6,changeCellfireRetailer:7,addToCardError:8,printError:9,printing:10,emailError:11,noSavings:12},h.getMyGroceryDealsData=function(){var n=h.configuration.Settings.MyGroceryDealsApiKey,t=h.location(),i=c.ContentBase.ContentId;u.getRecipeDeals(n,t,o.Settings,i,h.processMyGroceryDealsData);h.pendingSavingsRequestCount(h.pendingSavingsRequestCount()+1)},h.processMyGroceryDealsData=function(n){var u,r,i,t,f,e;for(h.nearbyGroceryDealChains([]),u=h.ingredients(),r=0;r<u.length;r++){if(i=u[r],!i)return;for(i.AllMyGroceryDealsSavings([]),t=0;t<n.length;t++)if(n[t].id===i.sortOrder){i.AllMyGroceryDealsSavings(n[t].chains);f=n[t].chains.map(function(n){return n.id});e=h.nearbyGroceryDealChains().concat(f.filter(function(n){return h.nearbyGroceryDealChains().indexOf(n)<0}));h.nearbyGroceryDealChains(e);break}}h.myGroceryDealsSavingsHaveBeenRetrieved(!0);h.onSavingsRetrieved();h.showViewIfAnySavingsAreAvailable()},h.filterGroceryDealsSavings=function(n){for(var i=h.ingredients(),t=0;t<i.length;t++)i[t].filterGroceryDealsData(n)},h.myGroceryDealsSavingsForActiveIngredients=s.computed(function(){return n.mapAndFlatten(h.activeIngredients(),function(n){return n.myGroceryDealsSavings()})}),h.getCellfireSavings=function(){i.getSavings(h.getFlavorFormatMetadataIds(),h.setCellfireSavings);h.pendingSavingsRequestCount(h.pendingSavingsRequestCount()+1)},h.setCellfireSavings=function(n){h.ingredients().forEach(function(n){n.AllCellfireSavings([])});h.nearbyCellfireRetailers([]);var t=[],i=[];h.ingredients().forEach(function(r){r.flavorFormatMetadataIds.forEach(function(u){n[u]&&n[u].forEach(function(n){var u=h.CellfireSavingViewModel(n);r.AllCellfireSavings.push(u);h.nearbyCellfireRetailers().indexOf(u.merchantId)<0&&t.indexOf(u.merchantId)<0&&t.push(u.merchantId);u.merchantHasCard&&h.savedCellfireRetailers().indexOf(u.merchantId)<0&&i.indexOf(u.merchantId)<0&&i.push(u.merchantId)})})});h.nearbyCellfireRetailers(h.nearbyCellfireRetailers().concat(t));h.savedCellfireRetailers(h.savedCellfireRetailers().concat(i));h.cellfireSavingsHaveBeenRetrieved(!0);h.onSavingsRetrieved()},h.filterCellfireSavings=function(n){for(var i=h.ingredients(),t=0;t<i.length;t++)i[t].filterCellfireData(n)},h.cellfireSavingsForActiveIngredients=s.computed(function(){var t=n.mapAndFlatten(h.activeIngredients(),function(n){return n.cellfireSavings()});return n.removeDuplicates(t,function(n,t){return n.offerId===t.offerId})}),h.cellfireRetailerName=s.computed(function(){var n=h.cellfireSavingsForActiveIngredients()[0];return n?n.merchantName:null}),h.changeCellfireRetailer=function(){h.activeView(h.views.changeCellfireRetailer);f.raiseChangeStoreEvent()},h.getCouponsIncSavings=function(){var n={IsLegacyPrintModeEnabled:o.Settings.PrintAdapterIsLegacyPrintModeEnabled,ZId:o.Settings.PrintAdapterZId,NId:o.Settings.PrintAdapterNId,PropertyId:o.Settings.PrintAdapterPropertyId,AffiliateId:o.Settings.PrintAdapterAffiliateId};r.initialize(n,h.loadCouponsIncSavings)},h.loadCouponsIncSavings=function(){h.getFlavorFormatMetadataIds().length&&(r.loadCoupons(h.getFlavorFormatMetadataIds(),h.onLoadCouponsIncSavingsSuccess,h.onLoadCouponsIncSavingsError),h.pendingSavingsRequestCount(h.pendingSavingsRequestCount()+1))},h.onLoadCouponsIncSavingsSuccess=function(n){h.ingredients().forEach(function(t){t.flavorFormatMetadataIds.forEach(function(i){n[i].forEach(function(n){var i=h.CouponsIncSavingViewModel(n);t.couponsIncSavings.push(i)})})});h.raiseViewCouponEventForCouponsIncSavings();h.couponsIncSavingsHaveBeenRetrieved(!0);h.onSavingsRetrieved()},h.onLoadCouponsIncSavingsError=function(){h.couponsIncSavingsHaveBeenRetrieved(!0);h.onSavingsRetrieved()},h.couponsIncSavingsForActiveIngredients=s.computed(function(){var t=n.mapAndFlatten(h.activeIngredients(),function(n){return n.couponsIncSavings()});return n.removeDuplicates(t,function(n,t){return n.number===t.number})}),h.getMasterRetailers=function(){h.nearbyCellfireRetailers().length>0||h.nearbyGroceryDealChains().length>0?e.getMasterRetailers(h.nearbyCellfireRetailers(),h.nearbyGroceryDealChains(),h.setMasterRetailers):h.setMasterRetailers([])},h.setMasterRetailers=function(n){var i=n.sort(function(n,t){return t.name<n.name?1:-1}),t;h.masterRetailers(i);t=h.getDefaultRetailer();h.selectedMasterRetailer(t.id);h.currentMasterRetailer(t.id);h.filterGroceryDealsSavings(t.mappedGroceryDealsChainIds);h.isDisplayingAllSavings()&&(h.filterCellfireSavings(t.mappedCellfireRetailerIds),h.raiseViewCouponEvents());h.showViewIfAnySavingsAreAvailable()},h.getDefaultRetailer=function(){var a=n.getCookie(u.selectedRetailerCookieName),r=[],s,e,o,t,l;a&&(r=a.toString().split(",").map(function(n){return parseInt(n,10)}));s=n.getCookie(i.selectedRetailerCookieName);e=0;s&&(e=parseInt(s,10));var v=h.preferredMyGroceryDealsChainId(),f=h.savedCellfireRetailers(),c=h.masterRetailers().slice(0);for(o=0;o<c.length;o++)t=c[o],t.priority=0,r.length>0&&n.checkForValue(r,t.mappedGroceryDealsChainIds)?(t.priority+=20,r.length>1&&t.mappedGroceryDealsChainIds.indexOf(r[r.length-1])>-1&&(t.priority+=1)):e>0&&t.mappedCellfireRetailerIds.indexOf(e)>-1?t.priority+=20:v>0&&t.mappedGroceryDealsChainIds.indexOf(v)>-1?t.priority+=10:f.length>0&&n.checkForValue(f,t.mappedCellfireRetailerIds)&&(t.priority+=10,f.length>1&&t.mappedCellfireRetailerIds.indexOf(f[f.length-1])>-1&&(t.priority+=1)),t.dualMapped&&(t.priority+=5),t.mappedGroceryDealsChainIds.length>0&&(t.priority+=2);return(l=c.sort(function(n,t){return t.priority-n.priority}),l.length>0)?l[0]:{id:0,mappedCellfireRetailerIds:[],mappedGroceryDealsChainIds:[]}},h.updateMasterRetailer=function(){if(h.selectedMasterRetailer()!==h.currentMasterRetailer()){h.currentMasterRetailer(h.selectedMasterRetailer());var t=h.masterRetailers().filter(function(n){return n.id===h.selectedMasterRetailer()})[0];f.raiseRetailerSelectEvent(t);t.mappedCellfireRetailerIds.length>0&&n.setCookie(i.selectedRetailerCookieName,t.mappedCellfireRetailerIds[0]);t.mappedGroceryDealsChainIds.length>0&&n.setCookie(u.selectedRetailerCookieName,t.mappedGroceryDealsChainIds);h.isDisplayingAllSavings()?(h.filterGroceryDealsSavings(t.mappedGroceryDealsChainIds),h.filterCellfireSavings(t.mappedCellfireRetailerIds)):h.displayAllSavings();n.showCheckmark(h.isShowingFilteredCheck)}},h.onLocationChangeFromGeolocationLibrary=function(n){h.location(n);o.EnableCellfireSavings&&h.isDisplayingAllSavings()&&h.getCellfireSavings();o.Settings.EnableMyGroceryDealsSavings&&h.getMyGroceryDealsData();h.activeView(h.views.list)},h.saveLocation=function(){t.saveLocation(h.location());h.isDisplayingAllSavings(!0);f.raiseRetailerSearchEvent(h.location(),f.constants.displayTypes.savingsByIngredient);n.showCheckmark(h.showLocationButtonClicked)},h.isLocationRequired=function(){return o.EnableCellfireSavings||o.Settings.EnableMyGroceryDealsSavings},h.isLocationVisible=s.computed(function(){return h.isLocationRequired()&&!h.isSavingsListCollapsed()}),h.onSavingsRetrieved=function(){h.pendingSavingsRequestCount(h.pendingSavingsRequestCount()-1);h.switchToNoSavingsViewIfNecessary();o.UseModalMode&&h.modal.isOpen()&&h.modal.reposition();h.pendingSavingsRequestCount()===0&&h.getMasterRetailers()},h.onDisplayAllSavingsClick=function(){h.displayAllSavings();f.raiseExpandSavingsEvent()},h.displayAllSavings=function(){h.isDisplayingAllSavings()||(o.EnableCellfireSavings&&h.getCellfireSavings(),o.EnableCouponsIncSavings&&h.getCouponsIncSavings(),h.isDisplayingAllSavings(!0))},h.isDisplayAllSavingsButtonVisible=s.computed(function(){var t,n;if(h.isDisplayingAllSavings())return!1;for(t=h.activeIngredients(),n=0;n<t.length;n++)if(o.EnableCellfireSavings&&t[n].hasCellfireSavingsInSearchIndex||o.EnableCouponsIncSavings&&t[n].hasCouponsIncSavingsInSearchIndex)return!0;return!1}),h.showViewIfAnySavingsAreAvailable=function(){h.numberOfIngredientsWithSavings()>0&&h.isViewVisible(!0)},h.switchToNoSavingsViewIfNecessary=function(){var t,n;if(h.isDisplayingAllSavings()&&(!o.EnableCellfireSavings||h.cellfireSavingsHaveBeenRetrieved())&&(!o.EnableCouponsIncSavings||h.couponsIncSavingsHaveBeenRetrieved())&&(!o.Settings.EnableMyGroceryDealsSavings||h.myGroceryDealsSavingsHaveBeenRetrieved())){for(t=h.activeIngredients(),n=0;n<t.length;n++)if(t[n].hasSavings())return;h.activeView(h.views.noSavings)}},h.getSavingsIndicatorClickHandler=function(n){return function(){h.activeIngredients([h.findIngredient(n)]);h.activeView(h.views.list);h.modal.open();f.raiseExpandSavingsEvent();h.isDisplayingAllSavings()&&h.raiseViewCouponEvents();h.displayAllSavings()}},h.isLoggedIn=function(){return n.getCookie("IsLoggedIn")==="1"},h.hideSavings=function(){o.UseModalMode?h.closeModal():(n.scrollUpUntilTopIsVisible(o.DivId,o.PercentagePastTopToScrollWhenRepositioning),h.isSavingsListCollapsed(!0),f.raiseCollapseSavingsEvent())},h.closeModal=function(){h.modal.close()},h.toggleSavingsListCollapse=function(){h.isSavingsListCollapsed()?(h.isSavingsListCollapsed(!1),h.displayAllSavings()):h.isSavingsListCollapsed(!0)},h.findIngredient=function(n){return s.utils.arrayFirst(h.ingredients(),function(t){return t.id===n})},h.singleActiveIngredientName=s.computed(function(){var n=h.activeIngredients();return n.length!==1?null:n[0].name}),h.getHasSavingsComputed=function(n){return h.findIngredient(n).hasSavings},h.numberOfIngredientsWithSavings=s.computed(function(){return h.ingredients().filter(function(n){return n.hasSavings()}).length}),h.getFlavorFormatMetadataIds=function(){return n.mapAndFlatten(h.ingredients(),function(n){return n.flavorFormatMetadataIds})},h.isNoMyGroceryDealsSavingsContentVisible=s.computed(function(){return h.myGroceryDealsSavingsForActiveIngredients().length===0&&h.isDisplayAllSavingsButtonVisible()}),h.printGateway=function(n){h.activeSaving(n);r.canPrint?r.deviceId===""&&r.printId===null?h.activeView(h.views.printGateway):h.print():h.activeView(h.views.noPrinter)},h.print=function(){var n=h.activeSaving();r.printCoupons([n.number],h.onPrintSuccess,h.onPrintError);h.activeView(h.views.printing)},h.onPrintSuccess=function(){var n=h.activeSaving();n.hasBeenPrinted(!0);h.activeView(h.views.list);f.raisePrintEvent(n,f.constants.displayTypes.savingsByIngredient)},h.onPrintError=function(){h.activeView(h.views.printError)},h.onEmailSuccess=function(){var n=h.activeSaving();n.hasBeenEmailed(!0);h.activeView(h.views.list);f.raiseEmailEvent(n,f.constants.displayTypes.savingsByIngredient);h.customEmailAddress("")},h.onEmailError=function(){h.activeView(h.views.emailError)},h.emailToExistingAddress=function(){r.emailCoupons([h.activeSaving().number],h.onEmailSuccess,h.onEmailError)},h.emailToCustomAddress=function(){h.customEmailAddress()?r.emailCoupons([h.activeSaving().number],h.onEmailSuccess,h.onEmailError,h.customEmailAddress()):h.onEmailError()},h.switchToEmailViewWithActiveSaving=function(n){h.activeSaving(n);h.switchToEmailView()},h.switchToEmailView=function(){h.activeView(h.views.email)},h.switchToListView=function(){h.activeView(h.views.list)},h.onAddToCardSuccess=function(){var n=h.activeSaving();n.hasBeenAddedToCard(!0);h.markCellfireSavingAsAdded(n);f.raiseAddCouponEvent(n,f.constants.displayTypes.savingsByIngredient)},h.onAddToCardError=function(){h.activeView(h.views.addToCardError)},h.addToCard=function(t){h.activeSaving(t);n.setCookie(i.selectedRetailerCookieName,t.merchantId);t.merchantHasCard?i.addSavingToCard(t.couponId,t.version,h.onAddToCardSuccess,h.onAddToCardError):h.activeView(h.views.noCard)},h.markCellfireSavingAsAdded=function(n){var t=n;h.ingredients().forEach(function(n){n.AllCellfireSavings().map(function(n){n.couponId===t.couponId&&n.hasBeenAddedToCard(!0)})})},h.redirectToCellfireOffersPageWithIntentToAddCard=function(){if(o.Settings.LinkToCellfireOffersPage){n.setCookie("cellfire.preclip",JSON.stringify({CouponIdsToAdd:[h.activeSaving().couponId],Version:h.activeSaving().version}));n.setCookie("cellfire.recipeReturnUrl",n.getDocumentLocationHref());n.setCookie("cellfire.addingCard",1);var t=o.Settings.LinkToCellfireOffersPage.concat("?contentId=",h.activeSaving().contentId);f.raiseProceedEvent(f.constants.contentTypes.Cellfire,f.constants.displayTypes.savingsByIngredient);n.redirectInNewTab(t)}},h.redirectToCouponsIncPageWithIntentToInstallPrinter=function(){n.setCookie("InstallClicked",1);h.redirectToCouponsIncPage()},h.redirectToCouponsIncPage=function(){if(o.Settings.LinkToCouponsIncPage){n.setCookie("checkedArr",h.activeSaving().number);n.setCookie("coupons.recipeReturnUrl",n.getDocumentLocationHref());var t=o.Settings.LinkToCouponsIncPage.concat("?contentId=",h.activeSaving().contentId);f.raiseProceedEvent(f.constants.contentTypes.CouponsInc,f.constants.displayTypes.savingsByIngredient);n.redirectAfterDelay(t,f.constants.delayInMillisecondsBeforeRedirecting)}},h.redirectToCouponsIncPrintHelpPage=function(){o.Settings.LinkToCouponsIncPrintHelpPage&&n.setDocumentLocationHref(o.Settings.LinkToCouponsIncPrintHelpPage)},h.cancelCellfireAction=function(){h.cancelAction(f.constants.contentTypes.Cellfire)},h.cancelCouponsIncAction=function(){h.cancelAction(f.constants.contentTypes.CouponsInc)},h.cancelAction=function(n){h.switchToListView();f.raiseCancelEvent(n,f.constants.displayTypes.savingsByIngredient)},h.redirectToCellfireRetailersPage=function(){f.raiseProceedEvent(f.constants.contentTypes.Cellfire,f.constants.displayTypes.savingsByIngredient);n.redirectAfterDelay(o.LinkForChangingCellfireRetailer,f.constants.delayInMillisecondsBeforeRedirecting)},h.onDialogClose=function(){f.raiseCollapseSavingsEvent()},h.onActiveViewChange=function(){n.scrollUpUntilTopIsVisible(o.DivId,o.PercentagePastTopToScrollWhenRepositioning)},h.raiseViewCouponEventForCellfireSavings=function(){if(!o.UseModalMode||h.modal.isOpen()){var n=h.cellfireSavingsForActiveIngredients();n.length&&f.raiseViewCouponEventForCellfireSavings(n,f.constants.displayTypes.savingsByIngredient)}},h.raiseViewCouponEventForCouponsIncSavings=function(){if(!o.UseModalMode||h.modal.isOpen()){var n=h.couponsIncSavingsForActiveIngredients();n.length&&f.raiseViewCouponEventForCouponsIncSavings(n,f.constants.displayTypes.savingsByIngredient)}},h.raiseViewCouponEventForMyGroceryDealsSavings=function(){if(!o.UseModalMode||h.modal.isOpen()){var n=h.myGroceryDealsSavingsForActiveIngredients();n.length&&f.raiseViewCouponEventForMyGroceryDealsSavings(n,f.constants.displayTypes.savingsByIngredient)}},h.redirectWithSeeAllSalesEvent=function(t,i){f.raiseSeeAllSalesEvent(t,f.constants.displayTypes.savingsByIngredient);n.redirectAfterDelay(i,f.constants.delayInMillisecondsBeforeRedirecting)},h.redirectToCellfireOffersPageWithSeeAllSalesEvent=function(){h.redirectWithSeeAllSalesEvent(f.constants.contentTypes.Cellfire,o.Settings.LinkToCellfireOffersPage)},h.redirectToCouponsIncPageWithSeeAllSalesEvent=function(){h.redirectWithSeeAllSalesEvent(f.constants.contentTypes.CouponsInc,o.Settings.LinkToCouponsIncPage)},h.redirectToMyGroceryDealsPageWithSeeAllSalesEvent=function(){h.redirectWithSeeAllSalesEvent(f.constants.contentTypes.MyGroceryDeals,o.Settings.LinkToMyGroceryDealsPage)},h.raiseViewCouponEvents=function(){h.raiseViewCouponEventForCellfireSavings();h.raiseViewCouponEventForCouponsIncSavings();h.raiseViewCouponEventForMyGroceryDealsSavings()},h.CellfireSavingViewModel=function(t){var i={};return i.couponId=t.couponId,i.contentId=t.contentId,i.version=t.version,i.imageUrl=t.imageUrl,i.name=t.name,i.description=n.getShortDescriptionFromDescription(t.description,t.longDescription),i.longDescription=n.getRemainderDescriptionFromDescription(t.description,t.longDescription),i.merchantId=t.merchantId,i.merchantName=t.merchantName,i.merchantHasCard=t.merchantHasCard,i.brandName=t.brandName,i.offerId=t.offerId,i.offerCode=t.offerCode,i.formattedExpirationDate="",t.expiryDate&&(i.formattedExpirationDate=new Date(t.expiryDate).toDateString()),i.formattedDisplayBeforeDate="",t.displayBeforeDate&&(i.formattedDisplayBeforeDate=new Date(t.displayBeforeDate).toDateString()),i.formattedFaceValue=(t.faceValue||0).toFixed(2),i.hasBeenAddedToCard=s.observable(!1),i.isShowingLongerDescription=s.observable(!1),i.toggleDescriptionLength=function(){i.isShowingLongerDescription(!i.isShowingLongerDescription())},i.descriptionLengthToggleText=s.computed(function(){return i.isShowingLongerDescription()?o.Settings.TextForShowingShorterDescription:o.Settings.TextForShowingLongerDescription}),i.addToCardButtonText=s.computed(function(){return i.hasBeenAddedToCard()?o.Settings.ButtonTextAfterAddingToCard:o.Settings.ButtonTextForAddingToCard}),i.addToCardButtonClass=s.computed(function(){return i.hasBeenAddedToCard()?h.listButtonCompletedClass:h.listButtonAvailableClass}),i},h.CouponsIncSavingViewModel=function(t){var i={};return i.number=t.number,i.contentId=t.contentId,i.imageUrl=t.imageUrl,i.summary=t.summary,i.description=t.midLevel,i.remainderDescription=s.observable(t.midLevel),i.brand=t.brand,i.offerCode=t.offerCode,i.hasBeenEmailed=s.observable(!1),i.hasBeenPrinted=s.observable(!1),i.isShowingLongerDescription=s.observable(!1),i.toggleDescriptionLength=function(){i.isShowingLongerDescription(!i.isShowingLongerDescription())},i.descriptionCharacterCount=function(){return i.description?i.description.length:0},i.truncatedDescription=s.computed(function(){if(i.descriptionCharacterCount()>=h.minimumDescriptionCharacterCount()){var t=n.truncatedDescription(h.minimumDescriptionCharacterCount()-10,i.description);return i.remainderDescription(i.remainderDescription().replace(t,"")),t}return i.remainderDescription(i.description),i.description}),i.showDescriptionLengthToggle=s.computed(function(){return i.description!==i.remainderDescription()}),i.descriptionLengthToggleText=s.computed(function(){return i.isShowingLongerDescription()?o.Settings.TextForShowingShorterDescription:o.Settings.TextForShowingLongerDescription}),i.toggleDescriptionLength=function(){i.isShowingLongerDescription(!i.isShowingLongerDescription())},i.emailButtonText=s.computed(function(){return i.hasBeenEmailed()?o.Settings.ButtonTextAfterEmailing:o.Settings.ButtonTextForEmailing}),i.emailButtonClass=s.computed(function(){return i.hasBeenEmailed()?h.listButtonCompletedClass:h.listButtonAvailableClass}),i.printButtonText=s.computed(function(){return i.hasBeenPrinted()?o.Settings.ButtonTextAfterPrinting:o.Settings.ButtonTextForPrinting}),i.printButtonClass=s.computed(function(){return i.hasBeenPrinted()?h.listButtonCompletedClass:h.listButtonAvailableClass}),i},h.IngredientViewModel=function(t){var i={};return i.id=t.Id,i.name=t.Name,i.externalId=t.ExternalId,i.flavorFormatMetadataIds=t.FlavorFormatMetadataIds,i.hasCellfireSavingsInSearchIndex=t.HasCellfireSavingsInSearchIndex,i.hasCouponsIncSavingsInSearchIndex=t.HasCouponsIncSavingsInSearchIndex,i.upcs=t.Upcs,i.sortOrder=t.SortOrder,i.AllCellfireSavings=s.observableArray(),i.AllMyGroceryDealsSavings=s.observableArray(),i.cellfireSavings=s.observableArray(),i.couponsIncSavings=s.observableArray(),i.myGroceryDealsSavings=s.observableArray(),i.hasSavings=s.computed(function(){return this.cellfireSavings().length?!0:!h.cellfireSavingsHaveBeenRetrieved()&&this.hasCellfireSavingsInSearchIndex&&o.EnableCellfireSavings?!0:this.couponsIncSavings().length?!0:!h.couponsIncSavingsHaveBeenRetrieved()&&this.hasCouponsIncSavingsInSearchIndex&&o.EnableCouponsIncSavings?!0:this.myGroceryDealsSavings().length?!0:!1},i),i.filterCellfireData=function(t){i.cellfireSavings([]);i.AllCellfireSavings().length>0&&(i.AllCellfireSavings().forEach(function(n){t.indexOf(n.merchantId)>-1&&i.cellfireSavings.push(n)}),i.cellfireSavings(n.removeDuplicates(i.cellfireSavings(),function(n,t){return n.offerId===t.offerId})))},i.filterGroceryDealsData=function(t){var r,u;if(i.myGroceryDealsSavings([]),i.AllMyGroceryDealsSavings().length>0){for(r=0;r<i.AllMyGroceryDealsSavings().length;r++)u=i.AllMyGroceryDealsSavings()[r],t.indexOf(u.id)>-1&&i.myGroceryDealsSavings(i.myGroceryDealsSavings().concat(u.offers));i.myGroceryDealsSavings(n.removeDuplicates(i.myGroceryDealsSavings(),function(n,t){return n.id===t.id}))}},i},h};GeneralMills.RecipeParts.Savings.Tooltips=function(){var n={},i="recipeParts-savings-tooltip",t="tooltip-open";return n.openTooltip=function(n){n.tooltip("open");n.addClass(t)},n.closeTooltip=function(n){n.tooltip("close");n.removeClass(t)},n.toggleTooltip=function(i,r){r.stopImmediatePropagation();i.closest("."+t).length?n.closeTooltip(i):n.openTooltip(i)},n.initialize=function(t){var r;o(".help-icon-cellfire").tooltip({content:t.Settings.TooltipContentForCellfire,items:"*",show:!1,tooltipClass:i,position:{my:"left+10 top-10",at:"right center",collision:"flipfit"}});o(".help-icon-couponsInc").tooltip({content:t.Settings.TooltipContentForCouponsInc,items:"*",show:!1,tooltipClass:i,position:{my:"left+10 top-10",at:"right center",collision:"flipfit"}});r=o(".help-icon");r.off();r.on("click",function(t){n.toggleTooltip(o(this),t)});r.on("mouseleave",function(n){n.stopImmediatePropagation()});o(h).on("click",function(){n.closeTooltip(r)})},n}();GeneralMills.RecipeParts.Savings.initializeDom=function(t,i){s.applyBindings(i,h.getElementById(t.ContainerDivId));t.UseModalMode&&(i.modal=n.createDialog(t.DivId,i.onDialogClose),Array.prototype.forEach.call(h.getElementsByClassName("recipePartIngredients"),function(n){s.applyBindings(i,n)}))};GeneralMills.RecipeParts.Savings.initialize=function(n){var i=GeneralMills.RecipeParts.Savings.ViewModel(n),r;GeneralMills.RecipeParts.Savings[n.DivId]=i;r=n.Ingredients.map(i.IngredientViewModel);i.ingredients(r);i.activeIngredients(r);i.showViewIfAnySavingsAreAvailable();i.activeView(i.views.list);i.activeView.subscribe(i.onActiveViewChange);i.preferredMyGroceryDealsChainId(n.Settings.PreferredMyGroceryDealsRetailerId);i.isLocationRequired()&&(t.subscribeToLocationChanges(i.onLocationChangeFromGeolocationLibrary),t.getLocation());GeneralMills.RecipeParts.Savings.initializeDom(n,i);GeneralMills.RecipeParts.Savings.Tooltips.initialize(n)}}(GeneralMills.RecipeParts.Savings.Utilities,GeneralMills.RecipeParts.Savings.Geolocation,GeneralMills.RecipeParts.Savings.Cellfire,GeneralMills.RecipeParts.Savings.CouponsInc,GeneralMills.RecipeParts.Savings.MyGroceryDeals,GeneralMills.RecipeParts.Savings.Analytics,GeneralMills.RecipeParts.Savings.Retailers,jQuery,ko,document,window),function(n,t,i,r,u,f,e,o,s,h,c){"use strict";c.GeneralMills=c.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.Savings=GeneralMills.RecipeParts.Savings||{};GeneralMills.RecipeParts.Savings.Showcase=GeneralMills.RecipeParts.Savings.Showcase||{};GeneralMills.RecipeParts.Savings.Showcase=function(h){var c={},l={};return h=o.extend({testMode:!1},h),h.testMode===!0&&(c.internal=l),l.minimumDescriptionCharacterCount=s.observable(50),l.UseModalMode=!1,l.PercentagePastTopToScrollWhenRepositioning=30,l.preferredMyGroceryDealsChainId=h.PreferredGroceryServerRetailerId,l.offerTypes=GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes,l.nearbyGroceryDealChains=s.observableArray(),l.nearbyCellfireRetailers=s.observableArray(),l.savedCellfireRetailers=s.observableArray([]),c.configuration=h,c.location=s.observable(),c.activeView=s.observable(),c.activeModalView=s.observable(),c.customEmailAddress=s.observable(),c.activeSaving=s.observable(),c.pendingSavingsRequestCount=s.observable(0),c.showLocationButtonClicked=s.observable(!1),c.listButtonAvailableClass="savings-list-button-available",c.listButtonCompletedClass="savings-list-button-completed",c.positionCollection=s.observable(),c.masterRetailers=s.observableArray([]),c.selectedMasterRetailer=s.observable(0),l.currentMasterRetailer=s.observable(0),c.isShowingFilteredCheck=s.observable(!1),c.views={list:1,email:2,loginRequiredForCellfire:3,loginRequiredForCouponsInc:4,noCard:5,noPrinter:6,addToCardError:7,printError:8,printing:9,emailError:10,noSavings:11,printGateway:12},c.KO_TEMPLATES={URL:"/Shared/RecipeParts/Sublayouts/Web/Savings/KO_Templates",SUFFIX:".tmpl.html"},l.getMyGroceryDealsData=function(){var n=c.configuration.Settings.MyGroceryDealsApiKey,t=c.location();c.positionCollection().showcasePositions().forEach(function(i){if(i.AuthoredOfferType===l.offerTypes.DealsNearMe||i.AuthoredOfferType===l.offerTypes.Any){var f=i.SearchTerms.split(",").map(Function.prototype.call,String.prototype.trim),r=f.filter(function(n){return!(n===null||n==="")});r.length&&(u.getSearchTermDeals(n,t,c.configuration.Settings,r,function(n){l.processMyGroceryDealsData(n,i)}),c.pendingSavingsRequestCount(c.pendingSavingsRequestCount()+1))}})},l.processMyGroceryDealsData=function(n,t){if(t.AllMyGroceryDealsSavings(n),n.length>0){var i=n.map(function(n){return n.id}),r=l.nearbyGroceryDealChains().concat(i.filter(function(n){return l.nearbyGroceryDealChains().indexOf(n)<0}));l.nearbyGroceryDealChains(r)}l.onSavingsRetrieved()},l.redirectWithSeeAllSalesEvent=function(t,i){f.raiseSeeAllSalesEvent(t,f.constants.displayTypes.savingsShowcase);n.redirectAfterDelay(i,f.constants.delayInMillisecondsBeforeRedirecting)},c.redirectToMyGroceryDealsPageWithSeeAllSalesEvent=function(){l.redirectWithSeeAllSalesEvent(f.constants.contentTypes.MyGroceryDeals,h.Settings.LinkToMyGroceryDealsPage)},l.getCellfireSavings=function(){c.positionCollection().showcasePositions().forEach(function(n){n.flavorFormatMetadataIds.length&&(n.AuthoredOfferType===l.offerTypes.Cellfire||n.AuthoredOfferType===l.offerTypes.Any)&&(i.getSavings(n.flavorFormatMetadataIds,function(t){l.setCellfireSavings(t,n)}),c.pendingSavingsRequestCount(c.pendingSavingsRequestCount()+1))})},l.setCellfireSavings=function(n,t){t.AllCellfireSavings([]);var i=[],r=[];t.flavorFormatMetadataIds.forEach(function(u){var f=u;n[u]&&n[u].forEach(function(n){var u=l.CellfireSavingViewModel(n,t.flavorFormatMetadataIds.indexOf(f));t.AllCellfireSavings.push(u);l.nearbyCellfireRetailers().indexOf(u.merchantId)<0&&i.indexOf(u.merchantId)<0&&i.push(u.merchantId);u.merchantHasCard&&l.savedCellfireRetailers().indexOf(u.merchantId)<0&&r.indexOf(u.merchantId)<0&&r.push(u.merchantId)})});l.nearbyCellfireRetailers(l.nearbyCellfireRetailers().concat(i));l.savedCellfireRetailers(l.savedCellfireRetailers().concat(r));l.onSavingsRetrieved()},c.onAddToCardSuccess=function(){var n=c.activeSaving();n.hasBeenAddedToCard(!0);c.positionCollection().markCellfireSavingAsAdded(n);f.raiseAddCouponEvent(n,f.constants.displayTypes.savingsShowcase)},c.onAddToCardError=function(){c.activeModalView(c.views.addToCardError)},c.addToCard=function(t){c.activeSaving(t);n.setCookie(i.selectedRetailerCookieName,t.merchantId);t.merchantHasCard?i.addSavingToCard(t.couponId,t.version,c.onAddToCardSuccess,c.onAddToCardError):(c.activeModalView(c.views.noCard),c.modal.open())},c.redirectToCellfireOffersPageWithIntentToAddCard=function(){n.setCookie("cellfire.preclip",JSON.stringify({CouponIdsToAdd:[c.activeSaving().couponId],Version:c.activeSaving().version}));n.setCookie("cellfire.recipeReturnUrl",n.getDocumentLocationHref());n.setCookie("cellfire.addingCard",1);var t=c.configuration.Settings.LinkToCellfireOffersPage;c.configuration.Settings.LinkToCellfireOffersPage&&(t=c.configuration.Settings.LinkToCellfireOffersPage.concat("?contentId=",c.activeSaving().contentId));f.raiseProceedEvent(f.constants.contentTypes.Cellfire,f.constants.displayTypes.savingsShowcase);n.redirectInNewTab(t)},l.getCouponsIncSavings=function(){c.positionCollection().showcasePositions().forEach(function(n){n.flavorFormatMetadataIds.length&&(n.AuthoredOfferType===l.offerTypes.CouponsInc||n.AuthoredOfferType===l.offerTypes.Any)&&c.pendingSavingsRequestCount(c.pendingSavingsRequestCount()+1)});var n={IsLegacyPrintModeEnabled:h.Settings.PrintAdapterIsLegacyPrintModeEnabled,ZId:h.Settings.PrintAdapterZId,NId:h.Settings.PrintAdapterNId,PropertyId:h.Settings.PrintAdapterPropertyId,AffiliateId:h.Settings.PrintAdapterAffiliateId};r.initialize(n,l.loadCouponsIncSavings)},l.loadCouponsIncSavings=function(){c.positionCollection().showcasePositions().forEach(function(n){n.flavorFormatMetadataIds.length&&(n.AuthoredOfferType===l.offerTypes.CouponsInc||n.AuthoredOfferType===l.offerTypes.Any)&&r.loadCoupons(n.flavorFormatMetadataIds,function(t){l.onGetCouponsIncSavingsSuccess(t,n)},function(){l.onGetCouponsIncSavingsError(n)})})},l.onGetCouponsIncSavingsSuccess=function(t,i){i.couponsIncSavings([]);i.flavorFormatMetadataIds.forEach(function(n){var r=n;t[n].forEach(function(n){var t=l.CouponsIncSavingViewModel(n,i.flavorFormatMetadataIds.indexOf(r));i.couponsIncSavings.push(t)})});i&&i.couponsIncSavings().length&&i.couponsIncSavings(n.removeDuplicates(i.couponsIncSavings(),function(n,t){return n.offerCode===t.offerCode}));l.onSavingsRetrieved()},l.onGetCouponsIncSavingsError=function(n){n.couponsIncSavings([]);l.onSavingsRetrieved()},c.redirectToCouponsIncPageWithIntentToInstallPrinter=function(){n.setCookie("InstallClicked",1);c.redirectToCouponsIncPage()},c.redirectToCouponsIncPage=function(){n.setCookie("checkedArr",c.activeSaving().number);n.setCookie("coupons.recipeReturnUrl",n.getDocumentLocationHref());f.raiseProceedEvent(f.constants.contentTypes.CouponsInc,f.constants.displayTypes.savingsShowcase);var t=c.configuration.Settings.LinkToCouponsIncPage;c.configuration.Settings.LinkToCouponsIncPage&&(t=c.configuration.Settings.LinkToCouponsIncPage.concat("?contentId=",c.activeSaving().contentId));n.redirectAfterDelay(t,f.constants.delayInMillisecondsBeforeRedirecting)},c.redirectToCouponsIncPrintHelpPage=function(){c.configuration.Settings.LinkToCouponsIncPrintHelpPage&&n.setDocumentLocationHref(c.configuration.Settings.LinkToCouponsIncPrintHelpPage)},l.getDefaultRetailer=function(){var v=n.getCookie(u.selectedRetailerCookieName),r=[],s,e,o,t,a;v&&(r=v.toString().split(",").map(function(n){return parseInt(n,10)}));s=n.getCookie(i.selectedRetailerCookieName);e=0;s&&(e=parseInt(s,10));var y=l.preferredMyGroceryDealsChainId,f=l.savedCellfireRetailers(),h=c.masterRetailers().slice(0);for(o=0;o<h.length;o++)t=h[o],t.priority=0,r.length>0&&n.checkForValue(r,t.mappedGroceryDealsChainIds)?(t.priority+=20,r.length>1&&t.mappedGroceryDealsChainIds.indexOf(r[r.length-1])>-1&&(t.priority+=1)):e>0&&t.mappedCellfireRetailerIds.indexOf(e)>-1?t.priority+=20:y>0&&t.mappedGroceryDealsChainIds.indexOf(y)>-1?t.priority+=10:f.length>0&&n.checkForValue(f,t.mappedCellfireRetailerIds)&&(t.priority+=10,f.length>1&&t.mappedCellfireRetailerIds.indexOf(f[f.length-1])>-1&&(t.priority+=1)),t.dualMapped&&(t.priority+=5),t.mappedGroceryDealsChainIds.length>0&&(t.priority+=2);return(a=h.sort(function(n,t){return t.priority-n.priority}),a.length>0)?a[0]:{id:0,mappedCellfireRetailerIds:[],mappedGroceryDealsChainIds:[]}},l.getMasterRetailers=function(){l.nearbyCellfireRetailers().length>0||l.nearbyGroceryDealChains().length>0?e.getMasterRetailers(l.nearbyCellfireRetailers(),l.nearbyGroceryDealChains(),l.setMasterRetailers):l.setMasterRetailers([])},l.setMasterRetailers=function(n){var i=n.sort(function(n,t){return t.name<n.name?1:-1}),t;if(c.masterRetailers(i),t=l.getDefaultRetailer(),c.selectedMasterRetailer(t.id),l.currentMasterRetailer(t.id),c.positionCollection().filterSavingsData(t.mappedCellfireRetailerIds,t.mappedGroceryDealsChainIds),c.positionCollection().setShowcasePositionOffers(),l.doDisplayableSavingsExist()){c.activeView(c.views.list);return}c.activeView(c.views.noSavings)},c.updateMasterRetailer=function(){if(c.selectedMasterRetailer()!==l.currentMasterRetailer()){l.currentMasterRetailer(c.selectedMasterRetailer());var t=c.masterRetailers().filter(function(n){return n.id===c.selectedMasterRetailer()})[0];f.raiseRetailerSelectEvent(t);t.mappedCellfireRetailerIds.length>0&&n.setCookie(i.selectedRetailerCookieName,t.mappedCellfireRetailerIds[0]);t.mappedGroceryDealsChainIds.length>0&&n.setCookie(u.selectedRetailerCookieName,t.mappedGroceryDealsChainIds);c.positionCollection().filterSavingsData(t.mappedCellfireRetailerIds,t.mappedGroceryDealsChainIds);c.positionCollection().setShowcasePositionOffers();n.showCheckmark(c.isShowingFilteredCheck)}},l.onSavingsRetrieved=function(){c.pendingSavingsRequestCount(c.pendingSavingsRequestCount()-1);c.pendingSavingsRequestCount()||l.getMasterRetailers()},c.saveLocation=function(){t.saveLocation(c.location());f.raiseRetailerSearchEvent(c.location(),f.constants.displayTypes.savingsShowcase);n.showCheckmark(c.showLocationButtonClicked)},c.onLocationChangeFromGeolocationLibrary=function(n){c.location(n);c.positionCollection().resetDisplayedOffers();l.nearbyCellfireRetailers([]);l.nearbyGroceryDealChains([]);l.getCellfireSavings();l.getMyGroceryDealsData();l.getCouponsIncSavings()},l.isLoggedIn=function(){return n.getCookie("IsLoggedIn")==="1"},l.doSavingsExist=function(){return l.hasPositions()&&c.positionCollection().showcasePositions().some(function(n){return n.hasSavings&&n.hasSavings()===!0})?!0:!1},l.doDisplayableSavingsExist=function(){return l.hasPositions()&&c.positionCollection().showcasePositions().some(function(n){return n.hasDisplayableOffer&&n.hasDisplayableOffer()===!0})?!0:!1},l.hasPositions=function(){return c.positionCollection&&c.positionCollection()},l.isEmpty=function(n){return!n||0===n.length},l.onDialogClose=function(){f.raiseCloseShowcaseModalEvent()},c.printGateway=function(n){c.activeSaving(n);r.canPrint?r.deviceId===""&&r.printId===null?c.activeModalView(c.views.printGateway):c.print():c.activeModalView(c.views.noPrinter);c.modal.open()},c.print=function(){var n=c.activeSaving();r.printCoupons([n.number],l.onPrintSuccess,l.onPrintError);c.activeModalView(c.views.printing)},c.showWidget=s.computed(function(){return l.doDisplayableSavingsExist()||!!c.pendingSavingsRequestCount()||!l.isEmpty(c.configuration.Settings.ContentWhenNoSavingsAreAvailable)}),l.onPrintSuccess=function(){var n=c.activeSaving();n.hasBeenPrinted(!0);c.modal.close();c.activeView(c.views.list);f.raisePrintEvent(n,f.constants.displayTypes.savingsShowcase)},l.onPrintError=function(){c.activeModalView(c.views.printError)},l.onEmailSuccess=function(){var n=c.activeSaving();n.hasBeenEmailed(!0);c.activeView(c.views.list);f.raiseEmailEvent(n,f.constants.displayTypes.savingsShowcase);c.customEmailAddress("");c.modal.close()},l.onEmailError=function(){c.activeModalView(c.views.emailError)},l.onActiveViewChange=function(){n.scrollUpUntilTopIsVisible(c.configuration.DivId,l.PercentagePastTopToScrollWhenRepositioning)},c.redirectToViewAllPromotions=function(){f.raiseSeeAllSalesEvent(f.constants.contentTypes.All,f.constants.displayTypes.savingsShowcase);n.redirectAfterDelay(c.configuration.ViewAllLink,f.constants.delayInMillisecondsBeforeRedirecting)},c.redirectToHelpPageOnAddToCardError=function(){l.redirectToHelpPage(f.constants.contentTypes.Cellfire)},c.redirectToHelpPageOnCouponsPrintError=function(){l.redirectToHelpPage(f.constants.contentTypes.CouponsInc)},l.redirectToHelpPage=function(t){f.raiseSeeHelpOnErrorEvent(t);n.redirectInNewTab(c.configuration.Settings.SavingsHelpLink)},c.emailToExistingAddress=function(){r.emailCoupons([c.activeSaving().number],l.onEmailSuccess,l.onEmailError)},c.emailToCustomAddress=function(){c.customEmailAddress()?r.emailCoupons([c.activeSaving().number],l.onEmailSuccess,l.onEmailError,c.customEmailAddress()):l.onEmailError()},c.cancelCellfireAction=function(){c.cancelAction(f.constants.contentTypes.Cellfire)},c.cancelCouponsIncAction=function(){c.cancelAction(f.constants.contentTypes.CouponsInc)},c.cancelAction=function(n){c.switchToListView();f.raiseCancelEvent(n,f.constants.displayTypes.savingsShowcase);c.modal.close()},c.switchToEmailViewWithActiveSaving=function(n){c.activeSaving(n);c.switchToEmailView()},c.switchToEmailView=function(){c.activeModalView(c.views.email);c.modal.open()},c.switchToListView=function(){c.activeView(c.views.list)},l.CellfireSavingViewModel=function(t,i){var r={};return r.contentType=l.offerTypes.Cellfire,r.couponId=t.couponId,r.contentId=t.contentId,r.version=t.version,r.imageUrl=t.imageUrl,r.name=t.name,r.description=n.getShortDescriptionFromDescription(t.description,t.longDescription),r.longDescription=n.getRemainderDescriptionFromDescription(t.description,t.longDescription),r.merchantId=t.merchantId,r.merchantName=t.merchantName,r.merchantHasCard=t.merchantHasCard,r.brandName=t.brandName,r.offerId=t.offerId,r.offerCode=t.offerCode,r.formattedExpirationDate="",t.expiryDate&&(r.formattedExpirationDate=new Date(t.expiryDate).toDateString()),r.formattedDisplayBeforeDate="",t.displayBeforeDate&&(r.formattedDisplayBeforeDate=new Date(t.displayBeforeDate).toDateString()),r.formattedFaceValue=(t.faceValue||0).toFixed(2),r.hasBeenAddedToCard=s.observable(!1),r.isShowingLongerDescription=s.observable(!1),r.toggleDescriptionLength=function(){r.isShowingLongerDescription(!r.isShowingLongerDescription())},r.descriptionLengthToggleText=s.computed(function(){return r.isShowingLongerDescription()?c.configuration.Settings.TextForShowingShorterDescription:c.configuration.Settings.TextForShowingLongerDescription}),r.addToCardButtonText=s.computed(function(){return r.hasBeenAddedToCard()?c.configuration.Settings.ButtonTextAfterAddingToCard:c.configuration.Settings.ButtonTextForAddingToCard}),r.addToCardButtonClass=s.computed(function(){return r.hasBeenAddedToCard()?c.listButtonCompletedClass:c.listButtonAvailableClass}),r.metadataSort=i,r.compareAmount=r.formattedFaceValue,r},l.CouponsIncSavingViewModel=function(t,i){var r={};return r.contentType=l.offerTypes.CouponsInc,r.number=t.number,r.contentId=t.contentId,r.imageUrl=t.imageUrl,r.summary=t.summary,r.description=t.midLevel,r.remainderDescription=s.observable(t.midLevel),r.brand=t.brand,r.offerCode=t.offerCode,r.DollarSavingAmount=t.dollarSavingsAmount,r.descriptionCharacterCount=function(){return r.description?r.description.length:0},r.truncatedDescription=s.computed(function(){if(r.descriptionCharacterCount()>=l.minimumDescriptionCharacterCount()){var t=n.truncatedDescription(l.minimumDescriptionCharacterCount()-10,r.description);return r.remainderDescription(r.remainderDescription().replace(t,"")),t}return r.remainderDescription(r.description),r.description}),r.showDescriptionLengthToggle=s.computed(function(){return r.description!==r.remainderDescription()}),r.hasBeenEmailed=s.observable(!1),r.hasBeenPrinted=s.observable(!1),r.isShowingLongerDescription=s.observable(!1),r.toggleDescriptionLength=function(){r.isShowingLongerDescription(!r.isShowingLongerDescription())},r.descriptionLengthToggleText=s.computed(function(){return r.isShowingLongerDescription()?c.configuration.Settings.TextForShowingShorterDescription:c.configuration.Settings.TextForShowingLongerDescription}),r.emailButtonText=s.computed(function(){return r.hasBeenEmailed()?c.configuration.Settings.ButtonTextAfterEmailing:c.configuration.Settings.ButtonTextForEmailing}),r.emailButtonClass=s.computed(function(){return r.hasBeenEmailed()?c.listButtonCompletedClass:c.listButtonAvailableClass}),r.printButtonText=s.computed(function(){return r.hasBeenPrinted()?c.configuration.Settings.ButtonTextAfterPrinting:c.configuration.Settings.ButtonTextForPrinting}),r.printButtonClass=s.computed(function(){return r.hasBeenPrinted()?c.listButtonCompletedClass:c.listButtonAvailableClass}),r.metadataSort=i,r.compareAmount=r.DollarSavingAmount,r},c.activeView(c.views.list),c.activeView.subscribe(l.onActiveViewChange),c.modal=n.createDialog(h.ContainerDivId+"-modal",null),c};GeneralMills.RecipeParts.Savings.Showcase.PositionCollection=function(n){var t={};return t.showcasePositions=s.observableArray(n),t.offerTypes=GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes,t.filterSavingsData=function(n,i){for(var r=0;r<t.showcasePositions().length;r++)t.showcasePositions()[r].filterCellfireData(n),t.showcasePositions()[r].filterGroceryDealsData(i)},t.setShowcasePositionOffers=function(){var n=[],i=[];t.showcasePositions().forEach(function(t){if(t.hasSavings()){var r=t.getNextValidOffer(i);r!=null&&(n.push(r),i.push(r.contentId))}});t.fireOfferViewEvents(n)},t.resetDisplayedOffers=function(){t.showcasePositions().forEach(function(n){n.DisplayedOffer(null)})},t.fireOfferViewEvents=function(n){for(var i=[],r=[],u=[],t=0;t<n.length;t++)n[t].contentType===GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes.Cellfire?i.push(n[t]):n[t].contentType===GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes.CouponsInc?r.push(n[t]):n[t].contentType===GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes.DealsNearMe&&u.push(n[t]);i.length>0&&f.raiseViewCouponEventForCellfireSavings(i,f.constants.displayTypes.savingsShowcase);r.length>0&&f.raiseViewCouponEventForCouponsIncSavings(r,f.constants.displayTypes.savingsShowcase);u.length>0&&f.raiseViewCouponEventForMyGroceryDealsSavings(u,f.constants.displayTypes.savingsShowcase)},t.markCellfireSavingAsAdded=function(n){var i=n;t.showcasePositions().forEach(function(n){n.AllCellfireSavings().map(function(n){n.couponId===i.couponId&&n.hasBeenAddedToCard(!0)})})},t};GeneralMills.RecipeParts.Savings.Showcase.PositionModel=function(t){var i={},r=GeneralMills.RecipeParts.Savings.ShowcaseOfferTypes;return i.id=t.Id,i.name=t.Name,i.externalId=t.ExternalId,i.flavorFormatMetadataIds=t.MetadataGroups,i.AuthoredOfferType=r.GetByName(t.OfferType),i.SearchTerms=t.SearchTerms,i.AllCellfireSavings=s.observableArray(),i.AllMyGroceryDealsSavings=s.observableArray(),i.cellfireSavings=s.observableArray(),i.couponsIncSavings=s.observableArray(),i.myGroceryDealsSavings=s.observableArray(),i.DisplayedOffer=s.observable(null),i.anySavings=function(){return i.cellfireSavings().concat(i.couponsIncSavings()).concat(i.myGroceryDealsSavings())},i.hasSavings=s.computed(function(){return i.AllCellfireSavings().length>0||i.couponsIncSavings().length>0||i.AllMyGroceryDealsSavings().length>0}),i.hasDisplayableOffer=s.computed(function(){return i.DisplayedOffer()!==null}),i.DisplayedOfferTemplate=s.computed(function(){return i.DisplayedOffer()!==null?i.DisplayedOffer().contentType.template:""}),i.filterCellfireData=function(t){i.cellfireSavings([]);i.AllCellfireSavings().length>0&&(i.AllCellfireSavings().forEach(function(n){t.indexOf(n.merchantId)>-1&&i.cellfireSavings.push(n)}),i.cellfireSavings(n.removeDuplicates(i.cellfireSavings(),function(n,t){return n.offerId===t.offerId})))},i.filterGroceryDealsData=function(t){var r,u;if(i.myGroceryDealsSavings([]),i.AllMyGroceryDealsSavings().length>0){for(r=0;r<i.AllMyGroceryDealsSavings().length;r++)u=i.AllMyGroceryDealsSavings()[r],t.indexOf(u.id)>-1&&i.myGroceryDealsSavings(i.myGroceryDealsSavings().concat(u.offers));i.myGroceryDealsSavings(n.removeDuplicates(i.myGroceryDealsSavings(),function(n,t){return n.id===t.id}))}},i.getNextValidOffer=function(n){var t=[],u;switch(i.AuthoredOfferType){case r.Any:t=i.anySavings();break;case r.CouponsInc:t=i.couponsIncSavings();break;case r.Cellfire:t=i.cellfireSavings();break;case r.DealsNearMe:t=i.myGroceryDealsSavings()}return t.length&&(t=t.sort(i.AuthoredOfferType.compare).filter(function(t){return n.indexOf(t.contentId)<0})),u=t.length?t[0]:null,i.DisplayedOffer(u),u},i};GeneralMills.RecipeParts.Savings.Showcase.initialize=function(n){var i=GeneralMills.RecipeParts.Savings.Showcase(n),r=n.Positions.map(GeneralMills.RecipeParts.Savings.Showcase.PositionModel);i.positionCollection(new GeneralMills.RecipeParts.Savings.Showcase.PositionCollection(r));GeneralMills.RecipeParts.Savings.Showcase[n.DivId]=i;t.subscribeToLocationChanges(i.onLocationChangeFromGeolocationLibrary);t.getLocation();s.applyBindings(i,h.getElementById(n.ContainerDivId));s.applyBindings(i,h.getElementById(n.ContainerDivId+"-modal"))}}(GeneralMills.RecipeParts.Savings.Utilities,GeneralMills.RecipeParts.Savings.Geolocation,GeneralMills.RecipeParts.Savings.Cellfire,GeneralMills.RecipeParts.Savings.CouponsInc,GeneralMills.RecipeParts.Savings.MyGroceryDeals,GeneralMills.RecipeParts.Savings.Analytics,GeneralMills.RecipeParts.Savings.Retailers,jQuery,ko,document,window),function(n,t){t.RelatedContent=t.RelatedContent||{};t.RelatedContent.RelatedContentList=function(i){var u={},r={};return i=n.extend({isCurrentUserAnonymous:!0,useModalRegistration:!0,testMode:!1},i),i.testMode===!0&&(u.internal=r,r.config=i),r.cookieName="relatedContentFavorite_initialState_"+i.id,u.raiseContentViewAnalyticsEvent=function(n,t,i){n&&t&&i&&r.raiseAnalyticsEvent(n,t,i,"ContentResult")},u.toggleFavorite=function(n,t,u,f){n&&t&&u&&(i.isCurrentUserAnonymous?(r.setCookie(n,t,u),r.openRegistration()):r.toggleFavorite(n,t,u,f))},u.initialize=function(){var n;i.isCurrentUserAnonymous||(n=r.getCookieData(),n)&&n.contentId&&n.contentType&&n.title&&(r.toggleFavorite(n.contentId,n.contentType,n.title,!1),r.deleteCookie(),typeof i.afterRegistrationCallback=="function"&&i.afterRegistrationCallback(n.contentId))},r.openRegistration=function(){var t=window.reg,n,u;n={returnUrl:window.location,isAuthenticated:!1,isRegistrationFirstStep:!1,isScreenNameSet:!1,regAction:i.regAction,esrc:i.esrc};i.useModalRegistration&&t?t.userRegistration.openRegistrationDialog(n):i.regFullPageUrl&&(u=[i.regFullPageUrl,"?regAction="+n.regAction,"&esrc="+n.esrc,"&isRegistrationFirstStep="+n.isRegistrationFirstStep,"&returnUrl="+encodeURIComponent(n.returnUrl)],r.redirect(u.join("")))},r.toggleFavorite=function(t,u,f,e){e=!e;var o=e?"/api/relatedContentFavorite/add/":"/api/relatedContentFavorite/remove/";n.ajax({type:"POST",dataType:"json",url:o+t,contentType:"application/json; charset=utf-8"}).success(function(){e&&r.raiseAnalyticsEvent(t,u,f,"AddToFavorites");typeof i.afterFavoriteChangeCallback=="function"&&i.afterFavoriteChangeCallback(t,e)})},r.raiseAnalyticsEvent=function(n,i,u,f){if(n&&i&&u&&f){var e={EventType:f,ContentId:n,ContentTitle:u,ContentType:r.toPascalCase(i),RecordType:r.toPascalCase(i)};f==="ContentResult"&&(e.ContentListName=e.TemplateName="RelatedContent");t.Analytics.raiseEvent(e)}},r.setCookie=function(n,t,u){if(n&&t&&u&&i.id){var f={contentId:n,contentType:t,title:u};r.callJquerySetCookieFunction(r.cookieName,JSON.stringify(f))}},r.getCookieData=function(){var t=decodeURI(r.callJqueryGetCookieFunction(r.cookieName))||"{}";return n.parseJSON(t)},r.deleteCookie=function(){r.callJquerySetCookieFunction(r.cookieName,null)},r.callJquerySetCookieFunction=function(t,i){n.cookie(t,i)},r.callJqueryGetCookieFunction=function(t){return n.cookie(t)},r.toPascalCase=function(n){return n==null?null:n.replace(/(\w)(\w*)/g,function(n,t,i){return t.toUpperCase()+i.toLowerCase()})},r.redirect=function(n){window.location=n},u}}(jQuery,window.GeneralMills||(window.GeneralMills={})),function(n,t,i){t.PandoSites=n.GeneralMills.PandoSites||{};t.PandoSites.RelatedContentList=function(n){var r={};(n=i.extend({id:"",itemSelector:"",favoriteSelector:"",favoriteIndicatorClass:"",isCurrentUserAnonymous:!0,useModalRegistration:!0,regFullPageUrl:"",regAction:"",esrc:""},n),n.id&&n.itemSelector&&n.favoriteSelector&&n.favoriteIndicatorClass)&&(r.relatedContentList=t.RelatedContent.RelatedContentList({id:n.id,afterFavoriteChangeCallback:function(t,i){var u=r.getItemElement(t);u.attr("data-isFavorite",!i);u.toggleClass(n.favoriteIndicatorClass)},afterRegistrationCallback:function(n){var t=r.getItemElement(n);setTimeout(function(){r.scrollToElement(t)},500)},isCurrentUserAnonymous:n.isCurrentUserAnonymous,useModalRegistration:n.useModalRegistration,regFullPageUrl:n.regFullPageUrl,regAction:n.regAction,esrc:n.esrc}),r.bindEvents=function(t){i(t).on("click",n.favoriteSelector,function(){var u=i(this).closest(n.itemSelector),t=r.getData(u);return t&&r.relatedContentList.toggleFavorite(t.contentId,t.contentType,t.title,t.isFavorite),!1});i(t).on("click",n.itemSelector,function(){var n=r.getData(this);n&&r.relatedContentList.raiseContentViewAnalyticsEvent(n.contentId,n.contentType,n.title)});i("img[data-src]",t).each(function(){var n=i(this);n.attr("src",n.data("src"))})},r.init=function(){var t=i("#"+n.id);t&&(r.bindEvents(t),i(n.itemSelector+'[data-isfavorite="True"]',t).addClass(n.favoriteIndicatorClass),r.relatedContentList.initialize())},r.getItemElement=function(t){return i(n.itemSelector+"[data-contentid="+t+"]",i("#"+n.id))},r.getData=function(n){var t=i(n),r={};return t&&(r={contentId:t.data("contentid")||"",contentType:t.data("contenttype")||"",title:t.data("title")||"",isFavorite:t.attr("data-isFavorite").toLowerCase()==="true"}),r},r.scrollToElement=function(n){for(var t=n[0],u=0,r=0;t!=null;)u+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent,i("html, body").animate({scrollTop:r},1500)},r.init())}}(window,window.GeneralMills||(window.GeneralMills={}),jQuery),function(){window.EventTarget=function(){this._listeners={}};window.EventTarget.prototype={constructor:EventTarget,addListener:function(n,t){typeof this._listeners[n]=="undefined"&&(this._listeners[n]=[]);this._listeners[n].push(t)},fire:function(n){var i,t,r;if(typeof n=="string"&&(n={type:n}),n.target||(n.target=this),!n.type)throw new Error("Event object missing 'type' property.");if(this._listeners[n.type]instanceof Array)for(i=this._listeners[n.type],t=0,r=i.length;t<r;t++)i[t].call(this,n)},removeListener:function(n,t){var r,i,u;if(this._listeners[n]instanceof Array)for(r=this._listeners[n],i=0,u=r.length;i<u;i++)if(r[i]===t){r.splice(i,1);break}}}}(),function(n){"use strict";n.GeneralMills=n.GeneralMills||{};n.GeneralMills.RatingAndReview=n.GeneralMills.RatingAndReview||{};n.GeneralMills.RatingAndReview.settings={ratingViewElementID:"ratingDiv",reviewViewElementID:"reviewDiv",events:{screenNameRequiredEvent:"ratingAndReview.screenNameRequiredEvent"}};var t=function(){n.EventTarget.call(this)};t.prototype=new n.EventTarget;t.prototype.constructor=n.GeneralMills.RatingAndReview.events;n.GeneralMills.RatingAndReview.events=new t}(window),function(n,t,i,r){"use strict";n.GeneralMills=n.GeneralMills||{};n.GeneralMills.RatingAndReview=n.GeneralMills.RatingAndReview||{};n.GeneralMills.RatingAndReview.settings=n.GeneralMills.RatingAndReview.settings||{};var u={containerID:n.GeneralMills.RatingAndReview.settings?n.GeneralMills.RatingAndReview.settings.ratingViewElementID:"",categoryID:r,streamID:r,linkedCommentsUI:n.GeneralMills.RatingAndReview.settings?n.GeneralMills.RatingAndReview.settings.reviewViewElementID:"",onError:r,onAddReviewClicked:r,connectWithoutLoginBehavior:"alwaysLogin"};n.GeneralMills.RatingAndReview.RatingsView=function(){var i={},r=u;return i.settings=function(n){return r=t.extend(u,n),r.onError=i.onError,r.onAddReviewClicked=i.onAddReviewClicked,r},i.displayUI=function(){n.gigya.comments.showRatingUI(r)},i.onError=function(n){t("#ratingDiv-error").text(n.errorMessage)},i.onAddReviewClicked=function(){n.location.href="#reviewDiv"},i};t(function(){t('[data-ratingandreview="ratings"]').first().is(function(){var u=t("#"+n.GeneralMills.RatingAndReview.settings.ratingViewElementID),i,f,r;if(typeof n.GigyaRatingOverrideSettings!="undefined")try{f=t.parseJSON(n.GigyaRatingOverrideSettings)||{};i=t.extend({},u.data("options"),f)}catch(e){i=t.extend({},u.data("options"))}else i=t.extend({},u.data("options"));r=n.GeneralMills.RatingAndReview.RatingsView();r.settings(i);n.gigya.isReady?r.displayUI():(t.subscribe("gigyaServiceReady.pando",r.displayUI),n.onGigyaServiceReady=n.onGigyaServiceReady||function(){t.publish("gigyaServiceReady.pando")})})})}(window,jQuery,gigya),function(n){n.GeneralMills=n.GeneralMills||{};n.GeneralMills.RatingAndReview=n.GeneralMills.RatingAndReview||{};n.GeneralMills.RatingAndReview.CustomSettings=function(){var n={};return n.ApplySettings=function(n){n.customLang.show_more_reviews="Show More Reviews"},n}()}(window,jQuery),function(n,t,i,r){"use strict";function a(){var n=l();return n&&n.streamID?n.streamID:""}function l(){var i,r;if(typeof n.GigyaReviewOverrideSettings!="undefined")try{r=t.parseJSON(n.GigyaReviewOverrideSettings)||{};i=t.extend({},u.data("options"),r)}catch(f){i=t.extend({},u.data("options"))}else i=t.extend({},u.data("options"));return i}var h,c;n.GeneralMills=n.GeneralMills||{};n.GeneralMills.RatingAndReview=n.GeneralMills.RatingAndReview||{};var f={containerID:n.GeneralMills.RatingAndReview.settings?n.GeneralMills.RatingAndReview.settings.reviewViewElementID:"",categoryID:"",streamID:"",useSiteLogin:!0,onLoad:r,onError:r,onBeforeCommentSubmitted:r,onCommentSubmitted:r,onCommentVoted:r,onSiteLoginClicked:r,version:2,connectWithoutLoginBehavior:"alwaysLogin"},s={returnUrl:n.location.href,isAuthenticated:!1,isScreenNameSet:!1},u=t("#"+f.containerID),e=l(),o="gmi.review.state."+a(e);if(n.GeneralMills.RatingAndReview.Utilities=function(){var i={};return i.debounce=function(n,t,i){var r,u;return function(){var f=this,e=arguments,o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r;return clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}},i.isInViewPort=function(i){return t(i)[0].getBoundingClientRect().bottom<=t(n).height()},i.setCookieValue=function(n,i){i&&t.cookie(n,encodeURIComponent(i))},i.cookieHasValue=function(n){var i=t.cookie(n);return i&&i!=="null"?!0:!1},i.getCookieValue=function(n){if(i.cookieHasValue(n))return decodeURIComponent(t.cookie(n))},i.deleteCookie=function(n){t.cookie(n,null)},i.setScrollTop=function(i){t(n).scrollTop(i)},i}(),n.GeneralMills.RatingAndReview.StateManager=function(){var i={},t=n.GeneralMills.RatingAndReview.Utilities;return i.initialize=function(n){var i=t.getCookieValue(n);i&&(t.setScrollTop(i),t.deleteCookie(n))},i}(),n.GeneralMills.RatingAndReview.ReviewView=function(){function c(n){var t="0";return n==="pos"?t="1":n==="neg"&&(t="-1"),t}function l(n){var t=n.charAt(0).toUpperCase()+n.substring(1);return t==="Googleplus"?t="GooglePlus":t==="Stumbleupon"&&(t="StumbleUpon"),t}var i={POST_ACTIVE_CLASS:"post-active",POST_INACTIVE_CLASS:"post-inactive"},u=f,r=s,a=n.publicProfileLink,e={composebox:'<div class="gig-composebox-header"><div class="gig-composebox-ratings"><\/div><\/div><div class="gig-composebox-data"><div id="RatingAndReviewCommentBox" class="RatingAndReviewCommentBox"><div class="gig-composebox-editor"><\/div><\/div><div class="gig-composebox-footer"><div class="gig-composebox-post">Post<\/div><\/div><\/div><div class="gig-composebox-error"><\/div>',header:'<span class="gig-comments-count"><\/span><span class="gig-comments-subscribe"><\/span><div class="gig-comments-sort"><\/div>',comment:'<div class="gig-comment-data"><div class="gig-comment-self-data"><div class="gig-comment-content"><div class="gig-comment-header"><span class="gig-comment-username"><\/span><span class="gig-comment-time"><\/span><div class="gig-comment-title"><\/div><div class="gig-comment-header-left"><\/div><\/div><div class="gig-comment-body"><\/div><\/div><div class="gig-comment-footer"><div class="actions"><span class="reply"><a class="gig-comment-replyLink">$reply<\/a><\/span><span class="share"><a class="gig-comment-shareLink">$share<\/a><\/span><span class="replies"><a class="gig-comment-repliesArrow"><span class="gig-comment-repliesArrow-text"><\/span><span class="gig-comment-repliesArrow-img"><\/span><\/a><\/span><\/div><div class="feedback"><span class="vote"><a class="gig-comment-vote-pos"><\/a><\/span><span class="flag"><a class="gig-comment-flag"><\/a><\/span><\/div><\/div><\/div><div class="gig-comment-replybox"><\/div><div class="gig-comment-replies"><\/div><\/div>'},h={composebox:'<div class="gig-composebox-header"><div class="gig-composebox-ratings"><\/div><\/div><div class="gig-composebox-data"><div id="RatingAndReviewCommentBox" class="RatingAndReviewCommentBox"><div class="gig-composebox-editor"><\/div><\/div><div class="gig-composebox-footer"><div class="gig-composebox-post">Post<\/div><\/div><\/div><div class="gig-composebox-error"><\/div>',header:'<span class="gig-comments-count"><\/span><span class="gig-comments-subscribe"><\/span><div class="gig-comments-sort"><\/div>',comment:'<div class="gig-comment-data"><div class="gig-comment-self-data"><div class="gig-comment-content"><div class="gig-comment-header"><span class="gig-comment-username"><\/span><span class="gig-comment-time"><\/span><div class="gig-comment-title"><\/div><div class="gig-comment-header-left"><\/div><\/div><div class="gig-comment-body"><\/div><\/div><div class="gig-comment-footer"><div class="actions"><span class="reply"><a class="gig-comment-replyLink">$reply<\/a><\/span><span class="delete"><a class="gig-comment-deleteLink">$delete<\/a><\/span><span class="share"><a class="gig-comment-shareLink">$share<\/a><\/span><span class="replies"><a class="gig-comment-repliesArrow"><span class="gig-comment-repliesArrow-text"><\/span><span class="gig-comment-repliesArrow-img"><\/span><\/a><\/span><\/div><div class="feedback"><span class="vote"><a class="gig-comment-vote-pos"><\/a><\/span><span class="flag"><a class="gig-comment-flag"><\/a><\/span><\/div><\/div><\/div><div class="gig-comment-replybox"><\/div><div class="gig-comment-replies"><\/div><\/div>'};return i.loginSettings=function(n){return r=t.extend(s,n)},i.settings=function(o){return u=t.extend(f,o),u.templates=r.isAuthenticated&&r.isScreenNameSet?h:e,u.onLoad=i.onLoad,u.onError=i.onError,u.onBeforeCommentSubmitted=i.onBeforeCommentSubmitted,u.onCommentSubmitted=i.onCommentSubmitted,u.onCommentVoted=i.onCommentVoted,u.onSiteLoginClicked=i.onSiteLoginClicked,u.customLang={write_a_review:o.waterMark||"&nbsp;",write_a_comment:o.waterMark||"&nbsp;"},n.GeneralMills.RatingAndReview.CustomSettings&&n.GeneralMills.RatingAndReview.CustomSettings.ApplySettings&&n.GeneralMills.RatingAndReview.CustomSettings.ApplySettings(u),u},i.onLoad=function(u){if(!r.isAuthenticated||!r.isScreenNameSet)t("#RatingAndReviewCommentBox a").on("click",function(n){n.preventDefault()});i.initPostButton(t("#reviewDiv"));t("#reviewDiv .gig-comments-more").on("click",u.sourceData,function(n){i.onMoreReviewsClicked(n.data)});t("#reviewDiv .gig-comment-header").each(function(){var n=t(this),r=n.find(".gig-comment-username").text(),i=n.html();i=i.replace(/\$username/g,r);n.html(i)});t(document.body).on("click","#RatingAndReviewCommentBox",function(){var t=n.GeneralMills.RatingAndReview.Utilities;r.isAuthenticated?r.isScreenNameSet||(t.setCookieValue(o,jQuery(n).scrollTop()),n.GeneralMills.RatingAndReview.events.fire(n.GeneralMills.RatingAndReview.settings.events.screenNameRequiredEvent,function(n){r.isScreenNameSet=n})):n.reg&&(t.setCookieValue(o,jQuery(n).scrollTop()),n.reg.userRegistration.openRegistrationDialog(r))})},i.displayUI=function(){var t=navigator.userAgent.indexOf("MSIE 8")>0;t||n.gigya.comments.showCommentsUI(u)},i.initPostButton=function(n){var t=n.find(".gig-composebox-post"),u=n.find(".gig-composebox-textarea"),r=n.find(".gig-composebox-rating-value");if(t.addClass(i.POST_INACTIVE_CLASS),r.length>0)r.on("click",function(){t.addClass(i.POST_ACTIVE_CLASS).removeClass(i.POST_INACTIVE_CLASS)});else u.on("focus",function(){t.addClass(i.POST_ACTIVE_CLASS).removeClass(i.POST_INACTIVE_CLASS)})},i.onError=function(n){t("#reviewDiv-error").text(n.errorMessage)},i.onBeforeCommentSubmitted=function(t){return r.isAuthenticated&&!r.isScreenNameSet?(n.GeneralMills.RatingAndReview.events.fire(n.GeneralMills.RatingAndReview.settings.events.screenNameRequiredEvent,function(n){r.isScreenNameSet=n}),!1):(t.tags=t.commentText?"fullReview":"ratingOnly",!0)},i.onCommentSubmitted=function(n){if(n.comment.parentID&&GeneralMills.Analytics.raiseEvent({EventType:"ReviewReply"}),n.ratings&&n.ratings._overall&&GeneralMills.Analytics.raiseEvent({EventType:"Rate",Rating:n.ratings._overall.toString()}),n.commentText!==""&&n.comment&&!n.comment.parentID&&GeneralMills.Analytics.raiseEvent({EventType:"Review"}),n.providerPostIDs){var t;for(t in n.providerPostIDs)GeneralMills.Analytics.raiseEvent({EventType:"SocialShare",SocialNetwork:l(t)})}},i.onCommentVoted=function(n){GeneralMills.Analytics.raiseEvent({EventType:"RateReview",Rating:c(n.vote)})},i.onSiteLoginClicked=function(){n.reg&&n.reg.userRegistration.openRegistrationDialog(r)},i.onMoreReviewsClicked=function(){GeneralMills.Analytics.raiseEvent({EventType:"MoreReviews"})},i},h=function(){t('[data-ratingandreview="review"]').first().is(function(){var i=n.GeneralMills.RatingAndReview.ReviewView();i.loginSettings(u.data("loginoptions"));i.settings(e);n.gigya.isReady?i.displayUI():(t.subscribe("gigyaServiceReady.pando",i.displayUI),n.onGigyaServiceReady=n.onGigyaServiceReady||function(){t.publish("gigyaServiceReady.pando")});t(n).off("scroll.ratingAndReview ready.ratingAndReview")})},c=function(t,i){return n.GeneralMills.RatingAndReview.Utilities.debounce(function(){var r=GeneralMills.RatingAndReview.Utilities,u=n.GeneralMills.RatingAndReview.StateManager;u.initialize(o);r.isInViewPort(t)&&i.call(this)},150)},e.renderReviewsForSEO===!1)t(n).on("scroll.ratingAndReview ready.ratingAndReview",c('[data-ratingandreview="review"]',h))}(window,jQuery,gigya),function(n,t,i){n.GeneralMills=n.GeneralMills||{};n.GeneralMills.RatingAndReview=n.GeneralMills.RatingAndReview||{};n.GeneralMills.RatingAndReview.ScreenNameFormViewModel=function(r,u){function o(){return e.find(".reviewProfileScreenNameModal").dialog({autoOpen:!1,buttons:[{id:"button-save",text:f.saveButtonText,click:function(){f.saveScreenname()}}],dialogClass:"reviewProfileScreenNameModal",modal:!0})}var f={},e=t(u);return f.$modalDialog=null,f.errors=i.observableArray([]),f.profileScreenName=i.observable(""),f.genericErrorText=r.GenericError,f.profileScreenNameModalTitle=r.ModalTitle,f.profileScreenNameMessage=r.Description,f.profileScreenNameLabel=r.InputLabel,f.profileScreenNameValidation=r.ScreenNameUnavailableError,f.saveButtonText=r.SaveButtonText,f.clearErrors=function(){f.errors.removeAll()},f.showValidation=i.computed(function(){return f.errors().length>0}),f.getDialog=function(){f.clearErrors();f.$modalDialog||(f.$modalDialog=o());f.$modalDialog.dialog("open")},f.reloadPage=function(){n.location.reload()},f.saveScreenname=function(){var n,i;f.clearErrors();n=f.profileScreenName();n?(i=JSON.stringify({screenName:n}),t.ajax({type:"POST",url:"/Shared/MyAccount/Services/MyAccountService.svc/CreateScreenName",data:i,contentType:"application/json; charset=UTF-8",dataType:"json",success:function(n){if(n&&n.length<1)f.reloadPage();else if(n===null)f.errors.push(f.genericErrorText);else for(var t=0;t<n.length;t++)f.errors.push(n[t].Message)},error:function(n,t,i){f.errors.push(i)}})):f.errors.push(f.genericErrorText)},n.GeneralMills.RatingAndReview.events.addListener(n.GeneralMills.RatingAndReview.settings.events.screenNameRequiredEvent,function(){f.getDialog()}),f};n.GeneralMills.RatingAndReview.ConfigureScreenNameForm=function(r){var u=t("#reviewProfileScreenNameContainer")[0],f=n.GeneralMills.RatingAndReview.ScreenNameFormViewModel(r,u);i.applyBindings(f,u)}}(window,jQuery,ko,window.GeneralMills||(window.GeneralMills={})),function(n,t){t(function(){t(".recipePartDrawer").each(function(){GeneralMills.RecipeParts.RecipeDrawer.Init(t(this))})});window.GeneralMills=window.GeneralMills||{};GeneralMills.RecipeParts=GeneralMills.RecipeParts||{};GeneralMills.RecipeParts.RecipeDrawer={};GeneralMills.RecipeParts.RecipeDrawer.Init=function(t){var u=t.children.length>1,i=t.data("recipe-drawer"),r;u&&i&&i.analyticsEventExpand&&i.analyticsEventCollapse&&(r=GeneralMills.RecipeParts.RecipeDrawer.ViewModel(i.analyticsEventExpand,i.analyticsEventCollapse,i.expandedByDefault),n.applyBindings(r,t[0]))};GeneralMills.RecipeParts.RecipeDrawer.ViewModel=function(t,i,r){var u={};return u.isExpanded=n.observable(r===!0),u.toggleState=function(){u.isExpanded(!u.isExpanded());var n=u.isExpanded()?t:i;n&&GeneralMills.Analytics.raiseEvent({EventType:n})},u}}(ko,jQuery),function(n){n(".nutrition-nutrients dd").each(function(){var t=n(this);t.text()===""&&t.html("&nbsp;")})}(jQuery),function(n){n(function(){n.fn.expandToggle=function(t){var i=n.extend({isToggleElementVisible:!1,expandableElement:this.parent(),expandedClassName:"expanded",callback:function(){}},t);return i.isToggleElementVisible?this.show().click(function(){var t=n(this),r=t.closest(i.expandableElement);r.toggleClass(i.expandedClassName);i.callback(r,t)}):this};n(".expandToggle").expandToggle({isToggleElementVisible:!0})})}(jQuery),function(n){window.GeneralMills=window.GeneralMills||{};GeneralMills.PandoSites=GeneralMills.PandoSites||{};GeneralMills.PandoSites.SocialFollow={};n(function(){n(".footerSocial").on("click","a",function(){GeneralMills.PandoSites.SocialFollow.raiseEvent(n(this).attr("href"))})});GeneralMills.PandoSites.SocialFollow.raiseEvent=function(n){if(n){var t;n=n.toLowerCase();n.indexOf("www.facebook.com")>-1?t="Facebook":n.indexOf("pinterest.com")>-1?t="Pinterest":n.indexOf("twitter.com")>-1?t="Twitter":n.indexOf("youtube.com")>-1?t="YouTube":n.indexOf("instagram.com")>-1&&(t="Instagram");t&&GeneralMills.Analytics.raiseEvent({EventType:"SocialFollow",SocialNetwork:t})}}}(jQuery),function(n){n.GeneralMills=n.GeneralMills||{};GeneralMills.PandoSites=GeneralMills.PandoSites||{};GeneralMills.PandoSites.ExternalContent=GeneralMills.PandoSites.ExternalContent||{};GeneralMills.PandoSites.ExternalContent=function(){var n={};return n.createScriptElement=function(n,t){var i=document.createElement("script");return i.type="text/javascript",i.src=n,t&&(i.async=!0),i},n.initialize=function(t,i){var r=n.createScriptElement(i,!0),u="external-content-container-"+t,f=document.getElementById(u);f.appendChild(r)},n}()}(window),function(){window.GeneralMills=window.GeneralMills||{};GeneralMills.ExpandableText={};GeneralMills.ExpandableText.initialize=function(){var f;var n=function(n){n&&n.style&&(n.style.display="none")},i=function(n){n&&n.style&&(n.style.display="inline")},s=document.getElementsByClassName("expandableText");for(f=0;f<s.length;f++){var e=s[f],t=e.querySelector(".fullText"),r=e.querySelector(".shortText"),u=e.querySelector(".expandLink"),o=e.querySelector(".collapseLink"),h=t&&t.textContent?t.textContent:"";n(o);h.length>300&&r?(r.textContent=h.substring(0,270)+"...",n(t),i(u)):(n(r),n(u));u.onclick=function(){i(t);i(o);n(r);n(u)};o.onclick=function(){i(r);i(u);n(t);n(o)}}};document.addEventListener("DOMContentLoaded",function(){GeneralMills.ExpandableText.initialize()})}()