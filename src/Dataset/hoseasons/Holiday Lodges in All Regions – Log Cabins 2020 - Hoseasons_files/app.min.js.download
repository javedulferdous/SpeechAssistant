// 'View Accommodation Options' Button

var isLandal = window.location.host.indexOf('landal') > -1;

toggleAccommodations = function () {
	$('a[href="#lodge__accommodations"]:visible').click();
	$(window).scrollTop(0);
};

// Set up an object for all GET variables
var queryDict = {};
location.search.substr(1).split("&").forEach(function (item) {
	queryDict[item.split("=")[0]] = item.split("=")[1];
});

// Variables to be used throughout the site if server tags aren't present
$(document).ready(function () {
	if (typeof queryDict.nights !== "undefined") {
		$('.stay-duration').html("For " + queryDict.nights + " Nights");
	}
});

// Dropdown Slider
function showSlider(slider) {
	slider.on('click', function (e) {
		var t = $(this);
		if (t.hasClass('is-active')) {
			t.removeClass('is-active').next().removeClass('reveal-slider');
		} else {
			t.addClass('is-active').next().addClass('reveal-slider');
		}
	});
}

var slider = $('.toggle__tab--menu');
showSlider(slider);

// What's on site - back to accommodation
var initBackToAccomm = function (accommName, accommSite, accommImage, currentUrl) {
	if (accommName.indexOf('Ref:') > -1) {
		accommName = accommName.replace('Ref:', '').trim();
	}
	localStorage.setItem('backToAccommodation-accommName', accommName);
	localStorage.setItem('backToAccommodation-accommSite', accommSite);
	localStorage.setItem('backToAccommodation-accommImage', accommImage);
	localStorage.setItem('backToAccommodation-currentUrl', currentUrl);
};

var triggerBackToAccomm = function (ref, currentUrl) {
	if ((localStorage.getItem('backToAccommodation-currentUrl') === ref || localStorage.getItem('backToAccommodation-currentUrl') === localStorage.getItem('backToAccommodation-fakeRef')) && window.location.href.indexOf('cottages') < 0) {
		$('body').append('<div class="backtoaccommodation-offer"><div class="main-content"><a class="btn btn--medium btn--primary desktop-cta" href="' + currentUrl + '">Continue Booking ' + localStorage.getItem('backToAccommodation-accommName') + '</a></div></div>');

		$('.backtoresults').html('Back to ' + localStorage.getItem('backToAccommodation-accommName')).attr('href', currentUrl);
		localStorage.setItem('backToAccommodation-fakeRef', ref);
	}
};

$('.acccomTrue #sitetab').on('click', function () {
	if (!$('body').hasClass('park-page')) {
		if ($('.banner-location a').length) {
			var siteNameToUse = $('.banner-location a').html().trim();
		} else {
			var siteNameToUse = $('.banner-location').html().trim();
		}
		initBackToAccomm($('h2.banner-title:visible').text().trim(), siteNameToUse, $('#site-gallery .simple-gallery-item:first-of-type img').attr('src'), document.location.href);
	}
});

$(document).ready(function () {
	if ($('body').hasClass('park-page') && $('h2.banner-title:visible').text().trim() === localStorage.getItem('backToAccommodation-accommSite')) {
		triggerBackToAccomm(document.referrer, localStorage.getItem('backToAccommodation-currentUrl'));
	}
});

$(window).on('load', function () {
	$('.backtoaccommodation-offer').addClass('active');
});

// Jump to ID
$(".quicklinks__anchor__item").on('click', function (e) {
	e.preventDefault();

	var defaultSpanOffset = 0;

	var span = $(this).attr('data-jump');

	var spanOffset = $('#' + span).attr('data-jump');
	if (!spanOffset) {
		spanOffset = defaultSpanOffset;
	}

	$('html,body').animate({
		scrollTop: $('#' + span).offset().top - spanOffset
	}, 500);
});

// Hide quick links if they aren't applicable
hideUnusedQuickLinks = function () {
	if ($('.mainsitetab').hasClass('is-active')) {
		$(".quicklinks__anchor__item").each(function () {
			var scrollToElement = '#' + $(this).attr('data-jump');
			if (!$(scrollToElement).is(':visible')) {
				$(this).hide();
			}
		});
	}
}

$('body').on('click', '#sitetab', function (e) {
	hideUnusedQuickLinks();
});
$(window).on('load', function () {
	hideUnusedQuickLinks();
});

$('#thisArea a.accordion__heading').on('click', function () {
	LoadMap();

});

$("#readmoredest").on('click', function () {
	if ($(this).text() == "Read more") {
		$("#lodge__info").show();
		$('html, body').animate({ scrollTop: 500 }, 1000);
		LoadMap();
		$('#sitetab').click();

	}
});

function setCookie(cname, cvalue, exdays, path) {
	var d = new Date();
	d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
	var expires = "expires=" + d.toUTCString();
	var path = "path=" + path;
	document.cookie = cname + "=" + cvalue + "; " + expires + "; " + path;
}

function getCookie(cname) {
	var name = cname + "=";
	var ca = document.cookie.split(';');
	for (var i = 0; i < ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0) == ' ') c = c.substring(1);
		if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
	}
	return "";
}

$(document).ready(function () {

	// Lowest price guarantee popup
	$('.lowest-price-guarantee-popup').on('click', function () {
		openSimpleLightbox('/lowest-price-guarantee-iframe-content', false, false);
		setTimeout(function () {
			$('iframe[src="/lowest-price-guarantee-iframe-content"]').parents('.lightbox-container').addClass('lowest-price-guarantee-popup-iframe');
		}, 10);

		function updateDateText() {
			var dateValue = $('#hidden-date').val(),
				durationValue,
				dateText = '';

			if ($('#hos_nights_city-breaks').is(':visible')) {
				durationValue = $('#hos_nights_city-breaks').val();
			} else {
				durationValue = $('#hos_nights').val();
			}

			if (dateValue) {
				dateText = dateValue + ' for ' + durationValue + ' nights';
			} else {
				dateText = durationValue + ' nights';
			}

			$('#date-and-duration').attr('placeholder', dateText);
		}

		$('#tabs--menu--mob').click(function () {
			if (!$(this).hasClass('is-active') && $('.tabs__content-wrapper').is(':visible')) {
				$('.tabs__content-wrapper').hide();
			}
		});

		if (document.location.href.indexOf('/boat-holidays/') > -1) {
			// Begin fix for read more view accomm button
			$('#interestedin a').click(function () {
				if (!$('.tabs__title__link.toggle-link.lodge__accommodations-link:first-of-type').hasClass('is-active')) {

					$('.tabs__title__link.toggle-link.lodge__accommodations-link:first-of-type').trigger('click');

				}
			});

			// Begin fix for icons not appearing in product details
			$('.themetypeicons li').each(function () {
				if ($(this).find('img').css('display') == "block" || $(this).find('img').css('display') == "inline-block" || $(this).find('img').css('display') == "inline") {
					$('.themetypeicons').fadeIn();
				}
			});

			// Begin Constantia fix to Villa
			if (document.location.href.indexOf('voic') > 0) {
				$('#boat--plan--details').remove();
				$('.listing__actions__profile em:contains("Narrowboat")').text('Villa');
				$('.tabs__title__link.toggle-link:contains("New to boating?")').remove();
				$('#boats--info--showmore').remove();
				$('#SelectedAccommodationtype em:contains("Narrowboat")').text('Villa');
				$('body').append('<h4 style="position:fixed;width:100%;bottom:0;left:0;right:0;text-align:center;background:rgba(51, 99, 41, 0.91);color:#fff;padding:0.5%;z-index:100;">PLEASE NOTE: Constantia is a Villa, and not a boat. Please call us for any queries.</h4>');
				$('.accordion__heading.toggle-link:contains("Boat facilities")').text('Villa Facilities');
				$('.accordion__heading.toggle-link:contains("All the boats at this location")').text('At this location..');
				$('#accom--essentials b:contains("Steering position:")').parent('li').remove();
				$('#accommodation-title').text('Villas at this location');
				$('.tabs__title .lodge__accommodations-link').text('Constantia');
			}

			// Fix for boat plan popup box
			$('#boat--plan--img--cont').on('click', function () {
				var clonedboat = $(this).clone();
				clonedboat.attr('id', 'cloned-boatplan');
				if (!$('#cloned-boatplan').length) {
					$('body').append(clonedboat);
				}
				var boatplan_img_link = $('#cloned-boatplan img').attr('src');
				boatplan_img_link = boatplan_img_link.replace('400', '840');
				$('#cloned-boatplan img').attr('src', boatplan_img_link);
				openSimpleLightbox($('#cloned-boatplan'), true);
				$('.lightbox-content').css({ 'background': '#fff', 'min-height': '0' });
				$('#cloned-boatplan').hide();

			});
		}

		if (document.location.href.indexOf('/cottages/') > -1) {
			if (!$('.srDestinationImg').is(':visible') || $('.srDestinationImg').attr('style') == "background-image: url(/cottages/assets/);") {
				if ($('body').hasClass('cottages search-results')) {
					$("#main--sr--nodestination--hero").show();
					$("#main--sr--nodestination--cont").show();
					$(".srDestinationImg").hide();

					if ($('body').hasClass('map-results')) {
						var h1_map = $("h2").text(); // should only be one
						$(".heronew--inner").find('h1').text(h1_map);
						$('h2').hide();
					}
				}
			}
		} else {
			if ($('body').attr('id') == "body_searchresults") {
				if (!$('.srDestinationImg').is(':visible')) {
					$("#main--sr--nodestination--hero").show();
					$("#main--sr--nodestination--cont").show();
				}
			}
		}

		$(".box-close").click(function () {
			if ($(window).width() < 380) {
				$('html, body').animate({ scrollTop: 50 }, 500);
			}
		});
	});

	$(window).load(function () {
		$("#activitylocation").append('<div class="MapTapCTA"><div class="inner"><span>BROWSE THE AREA</span><span>TAP TO VIEW</span></div></div>');

		if ($("#MoreAccomodationRevoo").length > -1) {
			$("#MoreAccomodationRevoo").append('<div class="MoreAccomodationRevoo--TapCTA"><div class="inner"><span>SEE CUSTOMER REVIEWS</span><span>TAP TO VIEW</span></div></div>');
		}

		$(".MoreAccomodationRevoo--TapCTA").on('click', function () {
			$(this).hide();
			$("#MoreAccomodationRevoo").css('overflow-y', 'scroll');
		});

		$(".MapTapCTA").on('click', function () {
			$(this).hide();
		});

		if ($(".bookhol").hasClass('true')) {
			$("#accomhero--ctabuttons .book").html('Book now');
		} else {
			$("#accomhero--ctabuttons .book").html('Book now');
			$("#accomhero--ctabuttons .book").removeAttr('href');
		}
	});

	// Cookie policy
	var cookie = getCookie('cookie-policy'),
		$cookieContainer = $('.cookie-container');
	if (!cookie && !$('body').hasClass('booking') && GlobalJS.isNotLandal()) {
		$cookieContainer.fadeIn('medium');
		setCookie('cookie-policy', '1', 360, '/');
	} else {
		$cookieContainer.hide();
	}

	$(document).on('click', '#closeCookiePolicy', function (event) {
		event.preventDefault();
		$('.cookie-container').fadeOut(function () {
			$(this).remove();
		});
		return false;
	});

	// Low deposit pop-up
	var ldp_cookie = getCookie('ldp-cookie');
	if (!ldp_cookie && $('body').attr('id') == "body_searchresults") {
		$("#ldp--bar").addClass('active');
		setCookie('ldp-cookie', '1', 360, '/');
	}

	$(document).on('click', '#ldp--bar .close', function (event) {
		$('#ldp--bar').remove();
		return false;
	});

	var getUrlParameter = function getUrlParameter(sParam) {
		var sPageURL = decodeURIComponent(window.location.search.substring(1)),
			sURLVariables = sPageURL.split('&'),
			sParameterName,
			i;

		for (i = 0; i < sURLVariables.length; i++) {
			sParameterName = sURLVariables[i].split('=');

			if (sParameterName[0] === sParam) {
				return sParameterName[1] === undefined ? true : sParameterName[1];
			}
		}
	};

	$("#accomhero--ctabuttons .book").click(function () {

		if ($(".bookhol").hasClass('true')) {
			var modal = $("#booknow--modal");
			var site = $(".accomhero .hero__subheading").html();
			var accom = $(".accomhero .hero__heading").html();
			var price = $("#AvailabilityDetails").find('.accommNowPrice').html();
			price = price.substring(5);
			var dates = $("#AvailabilityDetails").find('.selecteddate').html();
			dates = dates.substring(10);
			var nights = getUrlParameter('nights');
			var adults = getUrlParameter('adult');
			var children = getUrlParameter('child');
			var infant = getUrlParameter('infant');
			var pets = getUrlParameter('pets');

			modal.find('h4').find('p:first-of-type').html(site); // Site
			modal.find('h4').find('p:last-of-type').html(dates); // Date range
			modal.find('ul').find('li').eq(0).find('span').html(accom); // Accommodation
			modal.find('ul').find('li').eq(1).find('span').html(nights); // Nights
			modal.find('ul').find('li').eq(2).find('span').html(adults); // Adults
			modal.find('ul').find('li').eq(3).find('span').html(children); // Children
			modal.find('ul').find('li').eq(4).find('span').html(infant); // Infants
			modal.find('ul').find('li').eq(5).find('span').html(pets); // Pets
			modal.find('h5').find('span').html(price); // Total price

			$(".overlay").fadeIn(300);
			modal.addClass('active');
			modal.fadeIn(300);

			$("#booknow--modal ul li").each(function () {
				var span = $(this).find('span');
				if (span.html() == "") {
					$(this).remove();
				}
			});
		} else {
			$('html, body').animate({ scrollTop: $("#availability__service").offset().top }, 1);
		}

	});

	$(".booknow--modal--btncont .goback").click(function () {
		$(".overlay").fadeOut(300);
		$("#booknow--modal").fadeOut(300);
	});

	$(".overlay").click(function () {
		if ($("#booknow--modal").hasClass('active')) {
			$("#booknow--modal").removeClass('active');
			$("#booknow--modal").fadeOut(300);
			$(this).fadeOut(300);
		}
	});

	$(".booknow--modal--otherdates").click(function () {
		$("#booknow--modal").removeClass('active');
		$("#booknow--modal").fadeOut(300);
		$(".overlay").fadeOut(300);
		$('html, body').animate({ scrollTop: $("#availability-calendar").offset().top - 50 }, 1000);
	});

	$("#availability-calendar tr td").click(function () {
		if (!$(this).hasClass('ui-datepicker-unselectable')) {
			$('html, body').animate({ scrollTop: $(".selection-content").offset().top - 50 }, 700);
		}
	});
});

if (!$(".specialdeposit").html() == "") {
	$("#lowdepositinfo--linkcont").show();
}

if (document.location.href.indexOf('/city-breaks/') > -1) {
	$("#lowdepositinfo--linkcont").remove();
}

// Various booking scrolling stuff
$(window).load(function () {
	if ($('body').hasClass('paymentdetails')) {
		if ($("#SagePayController_ifrcarddetails").is(':visible')) {
			$('html, body').animate({ scrollTop: $("#SelectedCardContainer").offset().top + 0 }, 1000);
		} else if ($("#ctl13_ctl00").attr('checked') == 'checked') {
			$('html, body').animate({ scrollTop: $("#booking-conditions").offset().top - 20 }, 1000);
		}
	}
});

$("#calendar--changesearchbtn").on("click", function (e) {
	if (!$(this).hasClass('active')) //does not
	{
		$(this).html('CLOSE SEARCH');
		$(this).addClass('active');
		$("#AvailabilitySearch1").show();
	} else {
		$(this).html('CHANGE YOUR BOOKING');
		$(this).removeClass('active');
		$("#AvailabilitySearch1").hide();
	}
});

if (($("#divOverseasInsurance").html() == "") || ($("#divOverseasInsurance").html() == " ")) {
	$("#divOverseasInsurance").hide();
}

$(document).on("click", '#readmoredest, #readlessdest, #readmoredest--mob', function (e) {
	e.preventDefault();
	var more = $("#hero--regioncontent--more");
	if (!more.hasClass('regioncontent--more--active')) {

		if ($("#main--regioncontent").length > 0) {
			$('html, body').animate({ scrollTop: $("#main--regioncontent").offset() - 30 }, 1500);
		}

		more.slideDown(500);
		setTimeout(function () {
			$("#hero--regioncontent--more").find('h2').addClass("more--visible");
		}, 1000);
		setTimeout(function () {
			$("#hero--regioncontent--more").find('i, a').addClass("more--visible");
		}, 1800);
		more.addClass('regioncontent--more--active');
	} else {
		more.slideUp(500);
		more.removeClass('regioncontent--more--active');
		$("#readmoredest, #readmoredest--mob").text("Read more");
	}
});

$("#accommodation--mobdesc--changesearch").on('click', function () {
	$(".global__search.gs").show();
	$('html, body').animate({ scrollTop: 0 }, 1000);
});

var listcount = $("#resultcount").text();
if (listcount <= 11) {
	$(".pagination").hide();
} else {
	$(".pagination").show();
}

// About us slideshow
$(window).on('load resize', function () {
	var ss_width = $("#history--slideshow").width() + 1;
	var ss_width2 = parseInt(ss_width) * 8; // 8 slides at time of build
	$("#history--slideshow--inner").width(ss_width2);
	$(".slide").each(function () {
		$(this).width(ss_width);
	});
});

$("#history--slideshow--toggles li").on('click', function (e) {
	var eq = $(this).index();
	$("#history--slideshow--toggles li").removeClass('active');
	$(this).addClass('active');
	$("#history--slideshow--inner").css('left', '-' + eq + '00%');
});

var brandtype = 'PROPERTIES'; // fallback for listed
// landal inheritance, keeping seperate for visibility sake
if (isLandal) {
	brandType = 'LODGES';
}

// If search results equal 0
if ((document.location.href.indexOf('/boat-holidays/') > -1) || (document.location.href.indexOf('/boat-holidays?') > -1)) {
	brandtype = "BOATS";
} else if ((document.location.href.indexOf('/holiday-parks/') > -1) || (document.location.href.indexOf('/holiday-parks?') > -1)) {
	brandtype = "HOLIDAY PARKS";
} else if ((document.location.href.indexOf('/lodges/') > -1) || (document.location.href.indexOf('/lodges?') > -1)) {
	brandtype = "LODGES";
} else if ((document.location.href.indexOf('/cottages/') > -1) || (document.location.href.indexOf('/cottages?') > -1)) {
	brandtype = "COTTAGES";
} else if ((document.location.href.indexOf('/holiday-parks-in-europe/') > -1) || (document.location.href.indexOf('/holiday-parks-in-europe?') > -1)) {
	brandtype = "HOLIDAY PARKS IN EUROPE";
} else if ((document.location.href.indexOf('/city-breaks/') > -1) || (document.location.href.indexOf('/city-breaks?') > -1)) {
	brandtype = "CITY BREAKS";
}

if ($("#resultcount").html() === '0') {
	$('#sort-bar').hide();
	$('#global__search--main .global__search.gs, #global__search--main.global__search.gs').css('margin-bottom', '2%');

	if (document.location.href.indexOf('/holiday-parks/') > -1 ||
		document.location.href.indexOf('/lodges/') > -1 ||
		document.location.href.indexOf('/cottages/') > -1 ||
		isLandal) { //checking landal here too
		$('section.main').css('overflow', 'visible');

		if(isLandal) {
			document.getElementById('SortMobile').style.display = 'none';
			document.getElementById('mapResultsLinkButtonMobile').style.display = 'none';

			$("#resultcount--h2").html("We couldnâ€™t find any availability matching your search");
			$("#resultcount--h2").after("<p class='no-results-found'>Try adjusting your filters as we might have other accommodation available for the date you selected.</p>");

			$("#form1").prepend('<a onclick="toggleSearchButton()"><div class="btn btn--medium btn--primary large-hide" style="float: none;"><span>Amend search</span></div></a>')

			if(window.location.href.indexOf('europe') > -1)	$('.no-results-found').after('<a href="/uk/all-regions'+ window.location.search + '"><div class="btn btn--medium btn--primary"><span>Search UK</span></div></a>')
		} else {
			$("#resultcount--h2").html("SORRY, THERE ARE NO " + brandtype + " AVAILABLE THAT MATCH YOUR SEARCH");
			$("#resultcount--h2").after("<p class='no-results-found'>Please try changing date, duration or flexibility. We also might have other accommodation for the date you selected:</p>");
			$(".no-results-found").after('<div class=\'other-brand-search\'><ul></ul> </div>');
			$('.other-brand-search').hide();
		}

		var viewParks = '<li class="view-parks"><a href="javascript:;">Search Parks</a></li>';
		var viewLodges = '<li class="view-lodges"><a href="javascript:;">Search Lodges</a></li>';
		var viewCottages = '<li class="view-cottages"><a href="javascript:;">Search Cottages</a></li>';
		var searchQuery = "";
		var getSearchQuery = function (searchbrand) {
			var currenturl = document.location.href;
			if (searchbrand == "holiday-parks") {
				var searchstring = currenturl.substring(currenturl.indexOf('holiday-parks') + 14, currenturl.length);
				$('.other-brand-search .view-lodges a').attr('href', '/lodges/' + searchstring);
				// Set to all regions as we can't map L&P RHS to cottages
				$('.other-brand-search .view-cottages a').attr('href', '/cottages/all-regions');
			}
			if (searchbrand == "lodges") {
				var searchstring = currenturl.substring(currenturl.indexOf('lodges') + 7, currenturl.length);
				$('.other-brand-search .view-parks a').attr('href', '/holiday-parks/' + searchstring);
				// Set to all regions as we can't map L&P RHS to cottages
				$('.other-brand-search .view-cottages a').attr('href', '/cottages/all-regions');
			}
			if (searchbrand == "cottages") {
				var searchstring = currenturl.substring(currenturl.indexOf('cottages') + 9, currenturl.length);
				$('.other-brand-search .view-parks a').attr('href', '/holiday-parks/all-regions');
				$('.other-brand-search .view-lodges a').attr('href', '/lodges/all-regions');
			}
			if (window.location.host.indexOf('partners') > -1) {
				$('.other-brand-search .view-cottages a').hide();
			}
		}

		switch (brandtype) {
			case "COTTAGES":
				$('.other-brand-search ul').append(viewParks);
				$('.other-brand-search ul').append(viewLodges);
				getSearchQuery("cottages"); // Get the query string and set it
				break;
			case "LODGES":
				$('.other-brand-search ul').append(viewParks);
				$('.other-brand-search ul').append(viewCottages);
				getSearchQuery("lodges"); // Get the query string and set it
				break;
			case "HOLIDAY PARKS":
				$('.other-brand-search ul').append(viewCottages);
				$('.other-brand-search ul').append(viewLodges);
				getSearchQuery("holiday-parks"); // Get the query string and set it
				break;
			default:
		}
	} else if (document.location.href.indexOf('/city-breaks/') > -1 ||
		document.location.href.indexOf('/holiday-parks-in-europe/') > -1 || document.location.href.indexOf('/boat-holidays/') > -1) {
		$("#resultcount--h2").html("SORRY, THERE ARE NO ACCOMMODATIONS AVAILABLE");
		$("#resultcount--h2").after("<p>Sorry, there are no accommodations available that match your search. Please try another date or location or call us to speak to one of our specialist advisors.</p>");
	}
}

if ($('.other-brand-search ul').find('li')) {
	$('.other-brand-search').fadeIn();
}

// Various PD content toggling functions
$("#toplinks--mob a").on("click", function (e) {
	var x = $(this).attr('href');
	var act = 'is-active';
	var eq = $(this).index();
	$("#toplinks--mob a").removeClass('active');
	$(".tabs__title__link").removeClass(act);
	$(".tabs__title").eq(eq).find('.tabs__title__link').addClass(act);
	$(this).addClass('active');
	if (x == "#lodge__accommodations") {
		$(".tabs__content.toggle-content, .accordion__item").removeClass(act);
		$("#accom-list-multi").addClass(act);
		$("#lodge__accommodations-link").addClass(act);
		$('html, body').animate({ scrollTop: 350 }, 500);
		return false;
	} else if (x == "#lodge__info__mob") {
		$("#lodge__info").addClass(act);
		$("#section_about").find('.toggle-link').addClass(act);
		$("#sitetab").addClass(act);
		$("#lodges__about-content").addClass(act);
		$('html, body').animate({ scrollTop: 350 }, 500);
		return false;
	} else if (x == "#tab__gallery") {
		$(".tab_gallery").addClass(act);
		$("a[href*=tab_gallery]").addClass(act);
		return false;
	} else {
		return false;
	}

});

$(window).on('load resize', function (oEvent) {
	if ($(window).width() < 640) {
		$("#recently__service, #lodges__otherlocations").addClass('tabs__content toggle-content');
	} else {
		$("#recently__service, #lodges__otherlocations").removeClass('tabs__content toggle-content');
	}
});

if ($("#accommodation").is(':visible')) {
	$("#media--toggles").hide();
}

$("#siteinfo--readytobook").on('click', function () {
	var act = 'is-active';
	$("#toplinks--mob a").removeClass('active');
	$(".tabs__title__link").removeClass(act);
	$(".tabs__content.toggle-content").removeClass(act);
	$("#accom-list-multi").addClass(act);
	$("#lodge__accommodations-link").addClass(act);
	$("a[href*=lodge__accommodations]").addClass('is-active active');
	$("#lodge__accommodations-link").addClass(act);
});

$("#readytobook--checkavailability").on('click', function () {
	var act = 'is-active';
	var avail = $("a[href*=availability__service]");
	$(".accordion__heading.toggle-link").removeClass(act);
	$(".accordion__content.toggle-content").removeClass(act);
	avail.addClass(act);
	$(".accordion__content.toggle-content.availability__service").addClass(act);
	$('html, body').stop().animate({ scrollTop: $(".availability__service").offset().top - 70 }, 1000);
});

// Global search - various functions
$("#gs--searchtype a").click(function () {
	$("#gs--searchtype a").removeClass('active');
	$(this).addClass('active');
});

$('#gs--searchtype a').click(function (oEvent) {
	oEvent.preventDefault();
	oEvent.stopPropagation();
	oEvent.stopImmediatePropagation();
	var targetdiv = $('.global__search__cont').find('.targetDiv');
	var eq = $(this).index();
	eq = parseInt(eq) + 1;
	targetdiv.hide();
	$("#searchcontainer" + eq).show();
	if ($(window).width() < 640) {
		$('html, body').stop().animate({ scrollTop: 0 }, 500);
	}
	return false;
});

$("#QuickSearchqsRegionAnchor").click(function () {
	if ($(window).width() < 640) {
		if (!$('#QuickSearchqsRegionDropDown').hasClass('appended')) {
			$('#QuickSearchqsRegionDropDown').addClass('appended');
			$('#QuickSearchqsRegionDropDown').find('.nav__group').first().append('<li id="QuickSearch--mobclose">Close, back to top</li>');
		}
	}
});

// Sandbox the jQuery object to the $
(function ($) {
	var Ho = Ho || function () { };

	// Fancy scroll on filter selection
	var scrollToArea = function (el, ms) {
		var speed = (ms) ? ms : 600;
		$('html,body').animate({
			scrollTop: $(el).offset().top
		}, speed);
	}

	// specify id of element and optional scroll speed as arguments
	$('#more').click(function () {
		if ($(this).text() == "Hide Filters") { // Text will change to Hide Filters after click, so inverted logic
			scrollToArea($(this), 600);
		}
	});

	// anchor search controls when region link clicked
	$(function () {
		var page = $("html, body");
		$('#QuickSearchqsRegionAnchor').click(function () {
			$('#QuickSearchqsRegionDropDown a').click(function () {
				if (!$('body').hasClass('product--home')) {
					if(window.location.host.indexOf('landal') > -1) return false; //returning if the site is landal

					$('html, body').animate({
						scrollTop: $(".gs").offset().top
					}, 500);
				} else {
					if ($(window).width() < 1025) {
						$('html, body').animate({
							scrollTop: $(".gs").offset().top - 50
						}, 500);
					} else {
						$('html, body').animate({
							scrollTop: 0
						}, 500);
					}
				}
			});
			page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function () {
				page.stop();
			});
		});
	});

	// Hide Logged in message if user isn't logged in
	if ($('#Login').text() == "Log in to your account" && $('#Login').is(':visible')) {
		$('#GuestLoginDetail_MyAreaLogin_LblCustomerRegisteredMsg').hide()
	}

	// Remove certain 'essential info' rows if no data available
	$(".listing--essentialinfo").each(function () {
		if ($(this).children('.petsnumber').find('.listing--essentialinfo--title').html() == "Up to 0 pets allowed") {
			$(this).children('.petsnumber').find('.listing--essentialinfo--title').html("No pets allowed");
		} else if ($(this).children('li').find('.accomprice').html() == "") {
			$(this).children('li').find('.accomprice').remove();
		}
	});

	$(".shortdesc").each(function () {
		if ($(this).html() == "<i></i>") {
			$(this).remove();
		}
	})

	// Hide 'Was'/'Save'/'Now' boxes if non-dated search
	$(".listing__actions__price").each(function () {
		if ($(this).find('em').html() == "-") {
			$(this).parent('.listing__actions').hide();
		}
	});

	// Add class to cottages USPs due to fusion...
	$(".cottagesusps li").each(function () {
		$(this).addClass("listing--essentialinfo--title");
	});

	// Hiding sub-heading if Site Name is unavailable
	if ($(".hero__subheading").length) {
		if ($(".hero__subheading").text() == "") {
			$(".hero__subheading").hide();
		}
	}

	// FAQ - Heading toggling
	$(".faq--heading").click(function () {
		if (!$(this).hasClass('active')) // does not
		{
			$(".faq--heading").removeClass('active');
			$(".faq--answer").stop().slideUp(300);
			$(this).addClass('active');
			$(this).next('.faq--answer').stop().slideDown(300);
		} else {
			$(".faq--heading").removeClass('active');
			$(".faq--answer").stop().slideUp(300);
		}
	});

	// Hide FROM label in search results if empty jc
	$('.pricefromFalse').each(function () {
		if ($(this).text() == "From ") { $(this).hide(); }
	});

	$(window).on('load', function (e) {
		if ($('body').hasClass('city')) {
			$(".listing__features ul").each(function () {
				$(this).addClass('list list--checked');
			});
		}

		$("#ServiceReviewsFrom").change(function () {
			$('#MoreAccomodationRevoo').animate({ scrollTop: 0 }, 1);
		});
	});

	// New tab toggling, because the last one was an overengineered load of pants
	$(".tabs--menu .toggle-link").click(function (e) {
		var cur = $(this);
		var tab = $(".tabs__title__link");
		var act = 'is-active';
		var cont = $(".tabs__content.toggle-content");
		var id = this.id;
		var href = $(this).attr('href');
		var charat = href.charAt(0);
		var href = href.slice(1);
		if (charat == '#') {
			// For main tab toggling
			if ($(this).hasClass('tabs__title__link')) {
				if (href == 'tab_gallery') {
					if ($("#lodge__accommodations").hasClass(act)) {
						$("#lodge__accommodations").addClass(act);
					} else if ($("#accom-list-multi").hasClass(act)) {
						$("#lodge__accommodations").addClass(act);
						$("#accom-list-multi").addClass(act);
					} else if ($("#lodge__info").hasClass(act)) {
						$("#lodge__accommodations").addClass(act);
						$("#accom-list-multi").addClass(act);
					}
				} else if (href == 'tab_routes') {
					tab.removeClass(act);
					cont.removeClass(act);
					cur.addClass(act);
					$("#" + href).addClass(act);
					$(this).addClass(act);
					$("#tab_routes").addClass(act);
					$("#accom-list-multi").addClass(act);
				} else if (href == 'boat_info') {
					tab.removeClass(act);
					cont.removeClass(act);
					cur.addClass(act);
					$("#" + href).addClass(act);
					$(this).addClass(act);
					$("#accom-list-multi").addClass(act);
					$("#boat_info").addClass(act);
				} else if (href === 'activities') {
					if (window.innerWidth < 640 && this.classList.contains(act)) {
						tab.removeClass(act);
						cont.removeClass(act);
					} else {
						tab.removeClass(act);
						cont.removeClass(act);
						this.classList.add(act);
						document.querySelector('#activities').classList.add(act);
					}
				} else {
					tab.removeClass(act);
					cont.removeClass(act);
					cur.addClass(act);
					$("#" + href).addClass(act);
					$(this).addClass(act);
					$("#lodge__accommodations").addClass(act);
					$("#accom-list-multi").addClass(act);
				}

				// For top links
				if (href == "lodge__accommodations") {
					$("#toplinks--mob a").removeClass('active');
					$("#toplinks--mob a").eq(0).addClass('active');
				} else if (href == "lodge__info") {
					$("#toplinks--mob a").removeClass('active');
					$("#toplinks--mob a").eq(1).addClass('active');
				}
			} else if ($(this).hasClass('accordion__heading')) {
				if (cur.hasClass(act)) {
					cur.removeClass(act);
					cur.next('.accordion__content.toggle-content').removeClass(act);
				} else {
					cur.addClass(act);
					cur.next('.accordion__content.toggle-content').addClass(act);
				}
			} else {
				// For content toggling unrelated to tabs
				$(".activitiesTable.toggle-content").removeClass(act);
				cur.next('.activitiesTable.toggle-content').addClass(act);
			}
			e.preventDefault();//Stop the tab jumping
		} else {
			// normal anchor link
		}
	});

	// Tabs on mobile
	$(".accordion__heading").on('click', function (e) {
		if ($(window).width() < 640) {
			var cur = $(this);
			var act = 'is-active';
			if (cur.hasClass(act)) {
				cur.removeClass(act);
				cur.next('.accordion__content.toggle-content').removeClass(act);
			} else {
				cur.addClass(act);
				cur.next('.accordion__content.toggle-content').addClass(act);
			}
			e.preventDefault();//Stop the tab jumping
		} else {
			return false;
		}
	});

	// Go active & cruising routes
	$(".goCopy .toggle-link").on('click', function (e) {
		var cur = $(this);
		var act = 'is-active';
		if (cur.hasClass(act)) {
			cur.removeClass(act);
			cur.next('.activitiesTable.toggle-content').removeClass(act);
		} else {
			cur.addClass(act);
			cur.next('.activitiesTable.toggle-content').addClass(act);
		}
		e.preventDefault();//Stop the tab jumping
	});

	// Products datepicker front-end validation
	function dpValidate() {
		$(".form__field--datepicker").append('<div id="dp--validate">Please enter a date</div>');
	}

	$("#QuickSearch_searchBtnLnk").on('click', function (e) {
		var x = $("input[id='datepickerdatepicker']").val();
		if (x == "(Optional)") {
			e.preventDefault();
			dpValidate();
		} else {
			$("#dp--validate").fadeOut(300);
		}
	});

	//MANAGE NAVIGATION TOGGLES
	Ho.prototype.toggleButtons = function() {
		$('.toggle').on('click', function() {
			//MAIN SEARCH
			if ($(this).hasClass('toggle--search')) {
				if (window.SRFooterScripts && window.SRFooterScripts.hasOwnProperty('FiltersUIHandler')) {
					// toggle behavious on search results pages
					SRFooterScripts.FiltersUIHandler.handleSearchUI();
				} else {
					// default toggle behaviour on all other pages
					$(this).toggleClass('active');
					if (document.scrollingElement) {
						document.scrollingElement.scrollTo(0, 0);
					} else {
						document.documentElement.scrollTo(0, 0);
					}
					$('body').toggleClass('search--is-active');
					$('body').removeClass('nav--is-active');
					$(".global__search--new").toggleClass('active');
					$("#gs--searchtype").toggleClass('active');
					$(".global__search__cont").toggleClass('active');

					if (!$("#hero__searchnowbtn").hasClass('active')) {
						$("#hero__searchnowbtn").addClass('active');
						$("#hero__searchnowbtn").html("CLOSE SEARCH");
					} else {
						$("#hero__searchnowbtn").removeClass('active');
						$("#hero__searchnowbtn").html("SEARCH NOW");
					}
				}
			}
			return false;
		});
	};

	$("#nav--close").on('click', function (e) {
		$('body').removeClass('nav--is-active');
		$('body').removeClass('search--is-active');
		$('#QuickSearchqsRegionDropDown').hide().prev().removeClass('is-active');
	})

	// Product datepicker validation - border colour
	$("#QuickSearch_searchBtnLnk").click(function () {
		setTimeout(function () {
			if ($("#QuickSearch_searchError").is(':visible')) {
				$("#datepickerdatepicker").addClass('error');
			}
		}, 20);
	});

	// NEW Gateway hero functions
	$("#global__search--new--moreoptions--toggle").click(function () {
		var opts = $("#global__search--new--moreoptions");
		if (opts.hasClass('active')) {
			opts.removeClass('active');
			$(this).removeClass('active-toggle').html("More search options");
		} else {
			opts.addClass('active');
			$(this).addClass('active-toggle').html("Less search options");
		}
	});

	var ctaExtra = function () {
		$('.toggle-cta').on('click', function (e) {
			e.preventDefault();
			if ($(this).hasClass('open')) {
				$(this).removeClass('open').next('.cta-extra').slideUp();
			} else {
				$(this).addClass('open').next('.cta-extra').slideDown();
			}
		});
	}
	ctaExtra();
	Ho.prototype.toggleButtons();

})(jQuery);

$(document).ready(function () {
	$('.gs').each(function () {
		var $this = $(this);
		if (!$this.hasClass('availability__search')) {
			regionList = function () {
				// Get width and left position of GLOBAL SEARCH and DESTINATION INPUT
				var gSearchWidth = $this.outerWidth();
				leftAlign = $this.offset().left - $('#QuickSearchqsRegionAnchor').offset().left - 1;
				$('.region-list-wrapper').outerWidth(gSearchWidth).css({
					left: leftAlign
				});
				return false;

			}
		}
	});

	$(".accommsaveAmmount:contains('-')").hide();
	$(".accommWasPrice:contains('-')").hide();

	function listToggle() {
		$("#MoreFilters .form__fieldlist .form__label").click(function () {
			$(this).next('.form__input-list').toggle();
		});
	}

	$("#MoreFilters .form__fieldlist .form__label").click(function () {
		if ($(window).width() < 480) {
			$(this).parent('.form__field').find('ol').toggle();
		}
	});
	setBackToResultsHref();
});

function setBackToResultsHref() {
	/* If the backtoresults div is present then update the href with the url of the last stored search in hoseasonsStore*/
	var oBackToResults = $('.backtoresults');
	if (oBackToResults.length > 0) {
		var sr_href = null,
			oRegExp = new RegExp('#', 'g'); // regex to remove any hash tags in the string
		if (hoseasonsStore) {
			var oaRecentlySearched = hoseasonsStore('hoseasons_data').getItem('recently_searched');
			if (oaRecentlySearched && oaRecentlySearched.length > 0) {
				sr_href = oaRecentlySearched[oaRecentlySearched.length - 1].url;
				if (!isBrandInURL(sr_href)) {
					// Stored brand is not the same, use fallback
					sr_href = null;
				}
			}
		}
		if (!sr_href) {
			// Fallback to all regions, previously used breadcrumbs to find location, removed as this was throwing errors on certain pages
			if (document.location.href.indexOf('/boat-holidays/') > -1) {
				sr_href = '/boat-holidays/all-regions/';
			} else if (document.location.href.indexOf('/holiday-parks/') > -1) {
				sr_href = '/holiday-parks/all-regions/';
			} else if (document.location.href.indexOf('/lodges/') > -1) {
				sr_href = '/lodges/all-regions/';
			} else if (document.location.href.indexOf('/cottages/') > -1) {
				sr_href = '/cottages/all-regions/';
			} else if (document.location.href.indexOf('/holiday-parks-in-europe/') > -1) {
				sr_href = '/holiday-parks-in-europe/all-regions/';
			} else if (document.location.href.indexOf('/city-breaks/') > -1) {
				sr_href = '/city-breaks/all-regions/';
			} else if (window.location.host.indexOf('landal') > -1) {
				if (window.location.href.indexOf('/uk/') > -1) {
					sr_href = '/uk/all-regions';
				} else if (window.location.href.indexOf('/europe/') > -1) {
					sr_href = '/europe/all-regions';
				} else {
					// Landal companions
					sr_href = '';
				}
			}
		}
		sr_href = sr_href.replace(oRegExp, "");
		oBackToResults.attr('href', sr_href);
	}
}

function isBrandInURL(sURL) {
	switch (GlobalJS.getBrand()) {
		case "lodges":
			if (sURL.indexOf('/lodges') > -1) {
				return true;
			}
			break;
		case "holiday parks":
			if (sURL.indexOf('/holiday-parks-in-europe') > -1) {
				return false;
			} else if (sURL.indexOf('/holiday-parks') > -1) {
				return true;
			}
			break;
		case "boats":
			if (sURL.indexOf('/boat-holidays') > -1) {
				return true;
			}
			break;
		case "cottages":
			if (sURL.indexOf('/cottages') > -1) {
				return true;
			}
			break;
		case "holiday parks in europe":
			if (sURL.indexOf('/holiday-parks-in-europe') > -1) {
				return true;
			}
			break;
		case "city breaks":
			if (sURL.indexOf('/city-breaks') > -1) {
				return true;
			}
			break;
	}
	return false;
}

$(document).ready(function () {

	// CHECK AVAILABILITY (Quick solution)
	$("#check-availability-btn").click(function () {
		$(".check-availability").fadeOut("", function () {
		});
		$(".youarebooking").fadeIn("", function () {
		});
	});

	// })// Check is GLOBAL SEARCH is on the page
	if ($('.gs').length) {
		if (_websiteRoute === "cottages/") {
			if ($("body").hasClass("product--home")) {
				$('#QuickSearchqsRegionDropDown [data-regioncode="22070"]').trigger('click');
				$(document).trigger('click');
			}
		}

		$('#QuickSearchqsRegionAnchor').click(function (e) {
			if ($('.gs .nav__group').length) {
			} else {
				$urlPath = (window.location.pathname.split("/")[1].trim().substring(0, 4));

				if ($urlPath == 'agen') {
					$urlPath = (window.location.pathname.split("/")[2].trim().substring(0, 4));
				}

				$(this).addClass($urlPath);
				$('<ul class="nav__group nav__group--2">').prependTo('#QuickSearchqsRegionDropDown');
				// Create lists for region list
				$('.parentRegion').each(function (i) {
					$(this).addClass('toggle-link');
					$(this).wrap('<li class="nav__link parent__link parent' + i + '">');
					$('<ul class="nav__group nav__group--3 parentGroup' + i + '">').insertAfter(this);
					$($(this).parent().nextUntil('.parentRegion')).each(function () {
						$(this).wrap('<li class="nav__link child__link child' + i + '">');
						$('.child' + i + '').appendTo('.parentGroup' + i + '');
					});
				});
				$('.parent__link').prependTo('.gs .nav__group--2');
				if ($(this).hasClass('boat')) {
					$('.parent0, .parent7 .regionLevel0').remove();
					$('.parent4').prependTo('.gs .nav__group--2');
					$('.parent7').prependTo('.gs .nav__group--2');
					$('<li class="nav__link parent__link parent8"><ul class="nav__group nav__group--3 parentGroup8"/></li>').insertAfter('.parent7');
					$('.parentGroup7 > li').each(function (i) {
						if (i > 7) {
							$(this).appendTo('.parentGroup8');
						}
					});
					$("a[title='The Broads']").addClass("broadslnk");
					$("a[title='Canals And Rivers']").addClass("canalslnk");

					// Hide Obselete DD Locations
					$('#QuickSearchqsRegionDropDown a[title="River Thames Houseboats"]').parent().remove();
					// End Hide Obselete DD Locations
				}
				if ($(this).hasClass('city')) {
					$('.parent0').remove();
					$('<ul class="nav__group nav__group--3 parentGroup1 parentGroup2nd"/>').insertAfter('.parentGroup1');
					$('.parentGroup1 > li').each(function (i) {
						if (i > 8) {
							$(this).appendTo('.parentGroup2nd');
						}
					});

				// Hide Obselete DD Locations
				$('#QuickSearchqsRegionDropDown a[title=London]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title="London Central & West"]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title="London City & Tower Bridge"]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title="London Docklands & East"]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title=Liverpool]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title=Manchester]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title="Leamington Spa"]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title=Leeds]').parent().remove();
				$('#QuickSearchqsRegionDropDown a[title=Chester]').parent().remove();
				// End Hide Obselete DD Locations

				// Re-parent other locations
				$('#QuickSearchqsRegionDropDown a[title=Lincoln]').parent().appendTo('#QuickSearchqsRegionDropDown .nav__group.nav__group--3.parentGroup1:not(.parentGroup2nd)');
				$('#QuickSearchqsRegionDropDown a[title=York]').parent().appendTo('#QuickSearchqsRegionDropDown .nav__group.nav__group--3.parentGroup1:not(.parentGroup2nd)');
				// End re-parent other locations

				}
				if ($(this).hasClass('cott')) {
					$('.parent0').remove();
					$('<ul class="nav__group nav__group--3 parentGroup2 parentGroup2nd"/>').insertAfter('.parentGroup2');
					$('.parentGroup2 > li').each(function (i) {
						if (i > 25) {
							$(this).appendTo('.parentGroup2nd');
						}
					});
				}

				if ($(this).hasClass('holi')) {
					if ($("body").hasClass('euro')) {
						$('.lastRegion, .parent0').remove();
						$('.parent10').prependTo('.gs .nav__group--2');
						$('.parent6').prependTo('.gs .nav__group--2');
						$('.parent9').prependTo('.gs .nav__group--2');
						$('.parent4').prependTo('.gs .nav__group--2');
						$('.parent8').prependTo('.gs .nav__group--2');
						$(".parent4").wrap('<li class="nav__link child__link isregions">');
						$('.parent6').appendTo(".isregions");
						$(".parent10").wrap('<li class="nav__link child__link finalregions">');
						$('.parent1, .parent2, .parent3, .parent5 , .parent7 ,  .parent9').appendTo(".finalregions");
						$(".parent9 > ul , .parent10 > ul").remove();
						$('.parent1').prependTo('.gs .nav__group--2');
						$('.parent2').prependTo('.gs .nav__group--2');
						$('.parent4').prependTo('.gs .nav__group--2');
						$('.parent6').prependTo('.gs .nav__group--2');
						$('.parent8').prependTo('.gs .nav__group--2');
						$('.parent9').prependTo('.gs .nav__group--2');
						$('.parent5').prependTo('.gs .nav__group--2');
						$('.parent3').prependTo('.gs .nav__group--2');
						$('.parent7').prependTo('.gs .nav__group--2');
						$('.parent5').css('clear', 'none');
						$('.parent0').hide();

						// Put all destinations with no children at the ends of the list
						$("#QuickSearchqsRegionDropDown ul.nav__group--2 li.parent__link").each(function(e) {
							if($(this).find("ul").children().length == 0) {
								$("ul.nav__group.nav__group--2").append($(this).detach());
							}
						});
					}
					if (!$(this).hasClass('eu-parks')) {
						$('.parent0, .parentGroup7 .regionLevel2').remove();

					}
				}
				if ($(this).hasClass('lodg')) {
					$('.parent0, .parentGroup7 .regionLevel2').remove();

				}
			}
			regionList();
		});
	}
});

// AJAX LOADER
$body = $("body");

$(document).on({
	ajaxStart: function () { $body.addClass("loading"); },
	ajaxStop: function () { $body.removeClass("loading"); }
});

(function ($) {
	$.promotionalBanner = function (options) {
		var settings = $.extend({
			originalContentId: '',   // '#promo-banner, .promo-banners'
			replacementContentId: '',   // '#replacement-content, .replacement-contents' Can be empty
			expiryDateTime: '',   // '2015-12-04T15:20:00' ISO Date format
		}, options);

		var currentDateTimeObj = new Date(),
			expiryDateTimeObj = new Date(settings.expiryDateTime),
			originalContent = $(settings.originalContentId),
			replacementContent = $(settings.replacementContentId);

		if (currentDateTimeObj >= expiryDateTimeObj) {
			originalContent.hide();
			replacementContent.show();
		} else {
			originalContent.show();
		}

		return this;
	};
}(jQuery));

$(function () {
	if ($("#checkAvailability").length) {
		$('#checkAvailability').on("click", $("#checkAvailability"), function (e) {
			e.preventDefault();
			var searchQs = GetAvailabilityCalendarOptions();

			// check qs items isn't empty
			if (searchQs.length > 0) {
				// Go to new Url
				window.location = BuildNewUrl(searchQs) + "#accom-list-multi";
			}
		});
	}
});