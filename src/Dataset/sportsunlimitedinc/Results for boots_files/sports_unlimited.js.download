function __checkAndInitialize(e){triggermail.__tm_initialized||e>100||(triggermail.__initializeWithoutJQuery||window.jQuery?(triggermail.initialize(),triggermail.__tm_initialized=!0):setTimeout(__checkAndInitialize,100,e+1))}if(!window.hasOwnProperty("__tmClass")){!function(){var e=!1,t=/var xyz/.test(function(){})?/\b_super\b/:/[\D|\d]*/;this.__tmClass=function(){},window.__tmClass=this.__tmClass,__tmClass.extend=function(r){function i(){!e&&this.init&&this.init.apply(this,arguments)}var n=this.prototype;e=!0;var a=new this;e=!1;for(var o in r)a[o]="function"==typeof r[o]&&"function"==typeof n[o]&&t.test(r[o])?function(e,t){return function(){var r=this._super;this._super=n[e];var i=t.apply(this,arguments);return this._super=r,i}}(o,r[o]):r[o];return i.prototype=a,i.prototype.constructor=i,i.extend=arguments.callee,window.__tmClass=i,i}}(),window._c2pService=window._c2pService||[],window.triggermail={config:{eventSource:"custom_integration",encodeCookie:!1}},window.console?void 0===window.console.debug&&(console.debug=function(){}):console={debug:function(){},error:function(){},log:function(){}},window.TM_API_HOST="api.bluecore.com/api",window.triggermail.lytics=[],triggermail.lytics.__SV=1.2,function(e){function t(){t.done||(t.done=!0,S=!0,h=!1,b.each(j,function(e){e._dom_loaded()}))}function r(){try{s.documentElement.doScroll("left")}catch(e){return void setTimeout(r,1)}t()}var i=Array.prototype,n=Object.prototype,a=i.slice,o=n.toString,c=n.hasOwnProperty,l=window.console,u=window.navigator,s=window.document,p=u.userAgent,d=["__mps","__mpa","__mpap","$people_distinct_id","__alias"],g=!1;try{var g=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}var m="https:"==s.location.protocol?"https://":"http://",f=e&&e.__SV||0,y=g,h=!y&&-1==p.indexOf("MSIE"),b={},v=!1,_={api_host:m+TM_API_HOST,cross_subdomain_cookie:!0,cookie_name:window.triggermail.custom_cookie_name||"",loaded:function(){},store_google:!1,save_referrer:!0,test:!1,verbose:!1,img:!1,track_pageview:!0,debug:!1,live_demo:!1,track_links_timeout:300,cookie_expiration:365,upgrade:!1,disable_cookie:!1,ip:!0},S=!1;!function(){var e=i.forEach,t=i.indexOf,r=Array.isArray,n={},l=b.each=function(t,r,i){if(null!=t)if(e&&t.forEach===e)t.forEach(r,i);else if(t.length===+t.length){for(var a=0,o=t.length;a<o;a++)if(a in t&&r.call(i,t[a],a,t)===n)return}else for(var l in t)if(c.call(t,l)&&r.call(i,t[l],l,t)===n)return};b.addEvent=function(e,t,r,i){function n(e,t){return e?e.matches(t)?e:n(e.parentElement,t):null}if(window.jQuery)jQuery(e).on&&i?jQuery(e).on(t,i,r):jQuery(e)[t](r);else{Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);var a;e.attachEvent?(a=e.attachEvent,t="on"+t):a=e.addEventListener;var o;o="string"==typeof e?s.querySelectorAll(e):[e];for(var c=0;c<o.length;c++)i?a.apply(o[c],[t,function(e){var t=e||window.event,a=n(t.target||t.srcElement,i);a&&r.call(a,e)}]):a.apply(o[c],[t,r.bind(o[c])])}},b.getJSON=function(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){if(r.status>=200&&r.status<400){var e=JSON.parse(r.responseText);t(e)}},r.send()},b.removeEvent=function(e,t,r){e.detachEvent?e.detachEvent("on"+t,r):e.removeEventListener(t,r)},b.extend=function(e){return l(a.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e},b.isArray=r||function(e){return"[object Array]"===o.call(e)},b.isFunction=function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},b.isArguments=function(e){return!(!e||!c.call(e,"callee"))},b.toArray=function(e){return e?e.toArray?e.toArray():b.isArray(e)?a.call(e):b.isArguments(e)?a.call(e):b.values(e):[]},b.values=function(e){var t=[];return null==e?t:(l(e,function(e){t[t.length]=e}),t)},b.identity=function(e){return e},b.include=function(e,r){var i=!1;return null==e?i:t&&e.indexOf===t?-1!=e.indexOf(r):(l(e,function(e){if(i||(i=e===r))return n}),i)},b.includes=function(e,t){return-1!==e.indexOf(t)}}();var C=function(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,i){return e.call(t,r,i)};case 3:return function(r,i,n){return e.call(t,r,i,n)};case 4:return function(r,i,n,a){return e.call(t,r,i,n,a)}}return function(){return e.apply(t,arguments)}},w=Math.pow(2,53)-1,T=function(e){return function(t){return null==t?void 0:t[e]}}("length"),k=function(e){var t=T(e);return"number"==typeof t&&t>=0&&t<=w},I=function(e,t,r){return null==e?b.identity:b.isFunction(e)?C(e,t,r):b.isObject(e)?b.matcher(e):b.property(e)};b.map=b.collect=function(e,t,r){t=I(t,r);for(var i=!k(e)&&b.keys(e),n=(i||e).length,a=Array(n),o=0;o<n;o++){var c=i?i[o]:o;a[o]=t(e[c],c,e)}return a},b.inherit=function(e,t){return e.prototype=new t,e.prototype.constructor=e,e.superclass=t.prototype,e},b.isObject=function(e){return e===Object(e)&&!b.isArray(e)},b.isEmptyObject=function(e){if(b.isObject(e)){for(var t in e)if(c.call(e,t))return!1;return!0}return!1},b.isUndefined=function(e){return void 0===e},b.isString=function(e){return"[object String]"==o.call(e)},b.isDate=function(e){return"[object Date]"==o.call(e)},b.isNumber=function(e){return"[object Number]"==o.call(e)},b.encodeDates=function(e){return b.each(e,function(t,r){b.isDate(t)?e[r]=b.formatDate(t):b.isObject(t)&&(e[r]=b.encodeDates(t))}),e},b.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())},b.strip_empty_properties=function(e){var t={};return b.each(e,function(e,r){b.isString(e)&&e.length>0&&(t[r]=e)}),t},b.truncate=function(e,t){var r;return"string"==typeof e?r=e.slice(0,t):b.isArray(e)?(r=[],b.each(e,function(e){r.push(b.truncate(e,t))})):b.isObject(e)?(r={},b.each(e,function(e,i){r[i]=b.truncate(e,t)})):r=e,r},b.trim=function(e){return String.prototype.trim?String(e).trim():this.replace(/^\s+|\s+$/g,"")},b.JSONEncode=function(){return function(e){var t=e,r=function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return t.lastIndex=0,t.test(e)?'"'+e.replace(t,function(e){var t=r[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},i=function(e,t){var n="",a=0,l="",u="",s=0,p=n,d=[],g=t[e];switch(typeof g){case"string":return r(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"null":return String(g);case"object":if(!g)return"null";if(n+="    ",d=[],"[object Array]"===o.apply(g)){for(s=g.length,a=0;a<s;a+=1)d[a]=i(a,g)||"null";return u=0===d.length?"[]":n?"[\n"+n+d.join(",\n"+n)+"\n"+p+"]":"["+d.join(",")+"]",n=p,u}for(l in g)c.call(g,l)&&(u=i(l,g))&&d.push(r(l)+(n?": ":":")+u);return u=0===d.length?"{}":n?"{"+d.join(",")+p+"}":"{"+d.join(",")+"}",n=p,u}};return i("",{"":t})}}(),b.JSONDecode=function(){var e,t,r,i,n={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},a=function(t){throw{name:"SyntaxError",message:t,at:e,text:r}},o=function(i){return i&&i!==t&&a("Expected '"+i+"' instead of '"+t+"'"),t=r.charAt(e),e+=1,t},c=function(){var e,r="";for("-"===t&&(r="-",o("-"));t>="0"&&t<="9";)r+=t,o();if("."===t)for(r+=".";o()&&t>="0"&&t<="9";)r+=t;if("e"===t||"E"===t)for(r+=t,o(),"-"!==t&&"+"!==t||(r+=t,o());t>="0"&&t<="9";)r+=t,o();if(e=+r,isFinite(e))return e;a("Bad number")},l=function(){var e,r,i,c="";if('"'===t)for(;o();){if('"'===t)return o(),c;if("\\"===t)if(o(),"u"===t){for(i=0,r=0;r<4&&(e=parseInt(o(),16),isFinite(e));r+=1)i=16*i+e;c+=String.fromCharCode(i)}else{if("string"!=typeof n[t])break;c+=n[t]}else c+=t}a("Bad string")},u=function(){for(;t&&t<=" ";)o()},s=function(){switch(t){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}a("Unexpected '"+t+"'")},p=function(){var e=[];if("["===t){if(o("["),u(),"]"===t)return o("]"),e;for(;t;){if(e.push(i()),u(),"]"===t)return o("]"),e;o(","),u()}}a("Bad array")},d=function(){var e,r={};if("{"===t){if(o("{"),u(),"}"===t)return o("}"),r;for(;t;){if(e=l(),u(),o(":"),Object.hasOwnProperty.call(r,e)&&a('Duplicate key "'+e+'"'),r[e]=i(),u(),"}"===t)return o("}"),r;o(","),u()}}a("Bad object")};return i=function(){switch(u(),t){case"{":return d();case"[":return p();case'"':return l();case"-":return c();default:return t>="0"&&t<="9"?c():s()}},function(n){var o;return r=n,e=0,t=" ",o=i(),u(),t&&a("Syntax error"),o}}(),b.base64Encode=function(e){var t,r,i,n,a,o,c,l,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,p=0,d="",g=[];if(!e)return e;e=b.utf8Encode(e);do{t=e.charCodeAt(s++),r=e.charCodeAt(s++),i=e.charCodeAt(s++),l=t<<16|r<<8|i,n=l>>18&63,a=l>>12&63,o=l>>6&63,c=63&l,g[p++]=u.charAt(n)+u.charAt(a)+u.charAt(o)+u.charAt(c)}while(s<e.length);switch(d=g.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d},b.utf8Encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t,r,i,n="",a=0;for(t=r=0,a=e.length,i=0;i<a;i++){var o=e.charCodeAt(i),c=null;o<128?r++:c=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),null!==c&&(r>t&&(n+=e.substring(t,r)),n+=c,t=r=i+1)}return r>t&&(n+=e.substring(t,e.length)),n},b.UUID=function(){var e=function(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)},t=function(){return Math.random().toString(16).replace(".","")},r=function(e){function t(e,t){var r,i=0;for(r=0;r<t.length;r++)i|=a[r]<<8*r;return e^i}var r,i,n=p,a=[],o=0;for(r=0;r<n.length;r++)i=n.charCodeAt(r),a.unshift(255&i),a.length>=4&&(o=t(o,a),a=[]);return a.length>0&&(o=t(o,a)),o.toString(16)};return function(){var i=(screen.height*screen.width).toString(16);return e()+"-"+t()+"-"+r()+"-"+i+"-"+e()}}(),b.isBlockedUA=function(){return!!/(google web preview|baiduspider|yandexbot)/i.test(p)},b.HTTPBuildQuery=function(e,t){var r,i,n=[];return void 0===t&&(t="&"),b.each(e,function(e,t){r=encodeURIComponent(e.toString()),i=encodeURIComponent(t),n[n.length]=i+"="+r}),n.join(t)},b.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r="[\\?&]"+t+"=([^&#]*)",i=new RegExp(r),n=i.exec(e);return null===n||n&&"string"!=typeof n[1]&&n[1].length?"":decodeURIComponent(n[1]).replace(/\+/g," ")},b.cookie={get:function(e){for(var t=e+"=",r=s.cookie.split(";"),i=0;i<r.length;i++){for(var n=r[i];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t)){var a=n.substring(t.length,n.length);return triggermail.config.encodeCookie?b.cookie.decode(a):decodeURIComponent(a)}}return null},parse:function(e){var t;try{t=b.JSONDecode(b.cookie.get(e))||{}}catch(e){}return t},set:function(e,t,r,i){var n="",a="";if(i){var o=s.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),c=o?o[0]:"";n=c?"; domain=."+c:""}if(r){var l=new Date;l.setTime(l.getTime()+24*r*60*60*1e3),a="; expires="+l.toGMTString()}t=triggermail.config.encodeCookie?b.cookie.encode(t):encodeURIComponent(t),s.cookie=e+"="+t+a+"; path=/"+n},remove:function(e,t){b.cookie.set(e,"",-1,t)},encode:function(e){return e=b.cookie._encoder.encode(e),e=e.replace(/=/g,""),e=encodeURIComponent(e),e.replace(/%/g,"-")},decode:function(e){return/^%7B%22.*%22%7D$/.test(e)?decodeURIComponent(e):(e=e.replace(/-/g,"%"),e=decodeURIComponent(e),e=b.cookie._encoder.decode(e))},_encoder:function(){function e(e){var t,i,n,a,o,c;for(n=e.length,i=0,t="";i<n;){if(a=255&e.charCodeAt(i++),i==n){t+=r.charAt(a>>2),t+=r.charAt((3&a)<<4),t+="==";break}if(o=e.charCodeAt(i++),i==n){t+=r.charAt(a>>2),t+=r.charAt((3&a)<<4|(240&o)>>4),t+=r.charAt((15&o)<<2),t+="=";break}c=e.charCodeAt(i++),t+=r.charAt(a>>2),t+=r.charAt((3&a)<<4|(240&o)>>4),t+=r.charAt((15&o)<<2|(192&c)>>6),t+=r.charAt(63&c)}return t}function t(e){var t,r,n,a,o,c,l;for(c=e.length,o=0,l="";o<c;){do{t=i[255&e.charCodeAt(o++)]}while(o<c&&-1==t);if(-1==t)break;do{r=i[255&e.charCodeAt(o++)]}while(o<c&&-1==r);if(-1==r)break;l+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(o++)))return l;n=i[n]}while(o<c&&-1==n);if(-1==n)break;l+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(a=255&e.charCodeAt(o++)))return l;a=i[a]}while(o<c&&-1==a);if(-1==a)break;l+=String.fromCharCode((3&n)<<6|a)}return l}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);return{encode:e,decode:t}}()},b.register_event=function(){function e(e,r,i){return function(n){var a=n;n=n||t(window.event);var o,c;void 0!==n&&(c=r.call(e,n)),b.isFunction(i)&&(o=i(a));var l=!0;return!1!==o&&!1!==c||(l=!1),l}}function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation),e}var r=function(t,r,i,n){if(!t)return void O.error("No valid element provided to register_event");if(t.addEventListener&&!n)t.addEventListener(r,i,!1);else{var a="on"+r,o=t[a];t[a]=e(t,i,o)}};return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},r}(),b.dom_query=function(){function e(e){return e.all?e.all:e.getElementsByTagName("*")}function t(e,t){var r=" "+t+" ";return(" "+e.className+" ").replace(i," ").indexOf(r)>=0}function r(r){if(!s.getElementsByTagName)return new Array;for(var i,n=r.split(" "),a=new Array(s),o=0;o<n.length;o++)if(i=n[o].replace(/^\s+/,"").replace(/\s+$/,""),i.indexOf("#")>-1){var c=i.split("#"),l=c[0],u=c[1],p=s.getElementById(u);if(!p||l&&p.nodeName.toLowerCase()!=l)return new Array;a=new Array(p)}else if(i.indexOf(".")>-1){var c=i.split("."),l=c[0],d=c[1];l||(l="*");for(var g=new Array,m=0,f=0;f<a.length;f++){var y;y="*"==l?e(a[f]):a[f].getElementsByTagName(l);for(var h=0;h<y.length;h++)g[m++]=y[h]}a=new Array;for(var v=0,_=0;_<g.length;_++)g[_].className&&b.isString(g[_].className)&&t(g[_],d)&&(a[v++]=g[_])}else if(i.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){var l=RegExp.$1,S=RegExp.$2,C=RegExp.$3,w=RegExp.$4;l||(l="*");for(var g=new Array,m=0,f=0;f<a.length;f++){var y;y="*"==l?e(a[f]):a[f].getElementsByTagName(l);for(var h=0;h<y.length;h++)g[m++]=y[h]}a=new Array;var T,v=0;switch(C){case"=":T=function(e){return e.getAttribute(S)==w};break;case"~":T=function(e){return e.getAttribute(S).match(new RegExp("\\b"+w+"\\b"))};break;case"|":T=function(e){return e.getAttribute(S).match(new RegExp("^"+w+"-?"))};break;case"^":T=function(e){return 0==e.getAttribute(S).indexOf(w)};break;case"$":T=function(e){return e.getAttribute(S).lastIndexOf(w)==e.getAttribute(S).length-w.length};break;case"*":T=function(e){return e.getAttribute(S).indexOf(w)>-1};break;default:T=function(e){return e.getAttribute(S)}}a=new Array,v=0;for(var _=0;_<g.length;_++)T(g[_])&&(a[v++]=g[_])}else{l=i;for(var g=new Array,m=0,f=0;f<a.length;f++)for(var y=a[f].getElementsByTagName(l),h=0;h<y.length;h++)g[m++]=y[h];a=g}return a}var i=/[\t\r\n]/g;return r}(),b.info={campaignParams:function(){var e="utm_source utm_medium utm_campaign utm_content utm_term".split(" "),t="",r={};return b.each(e,function(e){t=b.getQueryParam(s.URL,e),t.length&&(r[e]=t)}),r},searchEngine:function(e){return 0===e.search("https?://(.*)google.([^/?]*)")?"google":0===e.search("https?://(.*)bing.com")?"bing":0===e.search("https?://(.*)yahoo.com")?"yahoo":0===e.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchInfo:function(e){var t=b.info.searchEngine(e),r="yahoo"!=t?"q":"p",i={};if(null!==t){i.g_search_engine=t;var n=b.getQueryParam(e,r);n.length&&(i.mp_keyword=n)}return i},browser:function(){var e=p,t=u.vendor||"";return window.opera?b.includes(e,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":b.includes(e,"Chrome")?"Chrome":b.includes(t,"Apple")?b.includes(e,"Mobile")?"Mobile Safari":"Safari":b.includes(e,"Android")?"Android Mobile":b.includes(e,"Konqueror")?"Konqueror":b.includes(e,"Firefox")?"Firefox":b.includes(e,"MSIE")?"Internet Explorer":b.includes(e,"Gecko")?"Mozilla":""},os:function(){var e=p;return/Windows/i.test(e)?/Phone/.test(e)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":""},device:function(){var e=p;return/iPhone/.test(e)?"iPhone":/iPad/.test(e)?"iPad":/iPod/.test(e)?"iPod Touch":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Windows Phone/i.test(e)?"Windows Phone":/Android/.test(e)?"Android":""},referringDomain:function(e){var t=e.split("/");return t.length>=3?t[2]:""},properties:function(){return b.strip_empty_properties({os:b.info.os(),browser:b.info.browser(),device:b.info.device(),mp_lib:"web"})},people_properties:function(){return b.strip_empty_properties({$os:b.info.os(),$browser:b.info.browser()})},pageviewInfo:function(e){return b.strip_empty_properties({mp_page:e,mp_referrer:s.referrer,mp_browser:b.info.browser(),mp_platform:b.info.os()})}};var O={log:function(){if((v||triggermail.util.cookie.get("_bc_platform_debug"))&&!b.isUndefined(l)&&l)try{l.log.apply(l,arguments)}catch(e){b.each(arguments,function(e){l.log(e)})}},error:function(){if((v||triggermail.util.cookie.get("_bc_platform_debug"))&&!b.isUndefined(l)&&l){var e=["Bluecore error:"].concat(b.toArray(arguments));try{l.error.apply(l,e)}catch(t){b.each(e,function(e){l.error(e)})}}},critical:function(){if(!b.isUndefined(l)&&l){var e=["Bluecore error:"].concat(b.toArray(arguments));try{l.error.apply(l,e)}catch(t){b.each(e,function(e){l.error(e)})}}}},A=function(){};A.prototype.create_properties=function(){},A.prototype.event_handler=function(){},A.prototype.after_track_handler=function(){},A.prototype.init=function(e){return this.mp=e,this},A.prototype.track=function(e,t,r,i){var n=this,a=b.dom_query(e);return 0==a.length?void O.error("The DOM query ("+e+") returned 0 elements"):(b.each(a,function(e){b.register_event(e,this.override_event,function(e){var a={},o=n.create_properties(r,this),c=n.mp.get_config("track_links_timeout");n.event_handler(e,this,a),window.setTimeout(n.track_callback(i,o,a,!0),c),n.mp.track(t,o,n.track_callback(i,o,a))})},this),!0)},A.prototype.track_callback=function(e,t,r,i){i=i||!1;var n=this;return function(){r.callback_fired||(r.callback_fired=!0,e&&!1===e(i,t)||n.after_track_handler(t,r,i))}},A.prototype.create_properties=function(e,t){return"function"==typeof e?e(t):b.extend({},e)};var x=function(){this.override_event="click"};b.inherit(x,A),x.prototype.create_properties=function(e,t){var r=x.superclass.create_properties.apply(this,arguments);return t.href&&(r.url=t.href),r},x.prototype.event_handler=function(e,t,r){r.new_tab=2===e.which||e.metaKey||"_blank"===t.target,r.href=t.href,r.new_tab||e.preventDefault()},x.prototype.after_track_handler=function(e,t,r){t.new_tab||setTimeout(function(){window.location=t.href},0)};var E=function(){this.override_event="submit"};b.inherit(E,A),E.prototype.event_handler=function(e,t,r){r.element=t,e.preventDefault()},E.prototype.after_track_handler=function(e,t,r){setTimeout(function(){t.element.submit()},0)};var D=function(e){this.props={},this.campaign_params_saved=!1,e.cookie_name?this.name="mp_"+e.cookie_name:this.name="mp_"+e.token+"_mixpanel",this.load(),this.update_config(e),this.upgrade(e),this.save()};D.prototype.properties=function(){var e={};return b.each(this.props,function(t,r){b.include(d,r)||(e[r]=t)}),e},D.prototype.load=function(){if(!this.disabled){var e=b.cookie.parse(this.name);e&&(this.props=b.extend({},e))}},D.prototype.upgrade=function(e){var t,r,i=e.upgrade;i&&(t="mp_super_properties","string"==typeof i&&(t=i),r=b.cookie.parse(t),b.cookie.remove(t),b.cookie.remove(t,!0),r&&(this.props=b.extend(this.props,r.all,r.events))),e.cookie_name||"mixpanel"===e.name||(t="mp_"+e.token+"_"+e.name,(r=b.cookie.parse(t))&&(b.cookie.remove(t),b.cookie.remove(t,!0),this.register_once(r)))},D.prototype.save=function(){this.disabled||b.cookie.set(this.name,b.JSONEncode(this.props),this.expire_days,this.cross_subdomain)},D.prototype.remove=function(){b.cookie.remove(this.name,!1),b.cookie.remove(this.name,!0)},D.prototype.clear=function(){this.remove(),this.props={}},D.prototype.register_once=function(e,t,r){return!!b.isObject(e)&&(void 0===t&&(t="None"),this.expire_days=void 0===r?this.default_expiry:r,b.each(e,function(e,r){this.props[r]&&this.props[r]!==t||(this.props[r]=e)},this),this.save(),!0)},D.prototype.register=function(e,t){return!!b.isObject(e)&&(this.expire_days=void 0===t?this.default_expiry:t,b.extend(this.props,e),this.save(),!0)},D.prototype.unregister=function(e){e in this.props&&(delete this.props[e],this.save())},D.prototype.update_campaign_params=function(){this.campaign_params_saved||(this.register_once(b.info.campaignParams()),this.campaign_params_saved=!0)},D.prototype.update_search_keyword=function(e){this.register(b.info.searchInfo(e))},D.prototype.update_referrer_info=function(e){this.register_once({$initial_referrer:e||"$direct",$initial_referring_domain:b.info.referringDomain(e)||"$direct"},"")},D.prototype.get_referrer_info=function(){return b.strip_empty_properties({$initial_referrer:this.props.$initial_referrer,$initial_referring_domain:this.props.$initial_referring_domain})},D.prototype.safe_merge=function(e){return b.each(this.props,function(t,r){r in e||(e[r]=t)}),e},D.prototype.update_config=function(e){this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_cookie),this.set_cross_subdomain(e.cross_subdomain_cookie)},D.prototype.set_disabled=function(e){this.disabled=e,this.disabled&&this.remove()},D.prototype.set_cross_subdomain=function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())},D.prototype.get_cross_subdomain=function(){return this.cross_subdomain},D.prototype._add_to_people_queue=function(e,t){var r=this._get_queue_key(e),i=t[e],n=this._get_or_create_queue("$set"),a=this._get_or_create_queue("$add"),o=this._get_or_create_queue("$append",[]);"__mps"===r?(b.extend(n,i),this._pop_from_people_queue("$add",i)):"__mpa"===r?b.each(i,function(e,t){t in n?n[t]+=e:(t in a||(a[t]=0),a[t]+=e)},this):"__mpap"===r&&o.push(i),O.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"),O.log(t),this.save()},D.prototype._pop_from_people_queue=function(e,t){var r=this._get_queue(e);b.isUndefined(r)||(b.each(t,function(e,t){delete r[t]},this),this.save())},D.prototype._get_queue_key=function(e){return"$set"===e?"__mps":"$add"===e?"__mpa":"$append"===e?"__mpap":void O.error("Invalid queue:",e)},D.prototype._get_queue=function(e){return this.props[this._get_queue_key(e)]},D.prototype._get_or_create_queue=function(e,t){var r=this._get_queue_key(e),t=b.isUndefined(t)?{}:t;return this.props[r]||(this.props[r]=t)};var R=function(t,r,i){var n,a="triggermail.lytics"===i?e:e[i];return a&&!b.isArray(a)?void O.error("You have already initialized "+i):(n=new P,n._init(t,r,i),n.people=new N,n.people._init(n),v=v||n.get_config("debug"),b.isUndefined(a)||(n._execute_array.call(n.people,a.people),n._execute_array(a)),n)},P=function(){};P.prototype.init=function(t,r,i){if(void 0===i)return void O.error("You must name your new library: init(token, config, name)");if("triggermail.lytics"===i)return void O.error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");var n=R(t,r,i);return e[i]=n,n._loaded(),n},P.prototype._init=function(e,t,r){this.__loaded=!0,this.config={},this.set_config(b.extend({},_,t,{name:r,token:e,callback_fn:("triggermail.lytics"===r?r:"triggermail.lytics."+r)+"._jsc"})),this._jsc=function(){},this.__dom_loaded_queue=[],this.__request_queue=[],this.__disabled_events=[],this._flags={disable_all_events:!1,identify_called:!1},this.cookie=new D(this.config),this.register_once({distinct_id:b.UUID()},"")},P.prototype._loaded=function(){this.get_config("loaded")(this),this.get_config("track_pageview")&&this.track_pageview()},P.prototype._dom_loaded=function(){b.each(this.__dom_loaded_queue,function(e){this._track_dom.apply(this,e)},this),b.each(this.__request_queue,function(e){this._send_request.apply(this,e)},this),delete this.__dom_loaded_queue,delete this.__request_queue},P.prototype._track_dom=function(e,t){if(this.get_config("img"))return O.error("You can't use DOM tracking functions with img = true."),!1;if(!S)return this.__dom_loaded_queue.push([e,t]),!1;var r=(new e).init(this);return r.track.apply(r,t)},P.prototype._prepare_callback=function(e,t){if(b.isUndefined(e))return null;if(y){return function(r){e(r,t)}}var r=this._jsc,i=""+Math.floor(1e8*Math.random()),n=this.get_config("callback_fn")+'["'+i+'"]';return r[i]=function(n){delete r[i],e(n,t)},n},P.prototype._send_request=function(e,t,r){if(h)return void this.__request_queue.push(arguments);var i=this.get_config("verbose");if(this.get_config("test")&&(t.test=1),i&&(t.verbose=1),this.get_config("img")&&(t.img=1),r&&!y&&(t.callback=r),t.ip=this.get_config("ip")?1:0,t._=(new Date).getTime().toString(),"img"in t){var n=s.createElement("img");n.src=e,s.body.appendChild(n)}else if(y){var a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.withCredentials=!0,a.onreadystatechange=function(e){if(4===a.readyState)if(200===a.status||202===a.status)r&&r(i?b.JSONDecode(a.responseText):Number(a.responseText));else{var t="Bad HTTP status: "+a.status+" "+a.statusText;O.error(t),r&&r(i?{status:0,error:t}:0)}},a.send(b.HTTPBuildQuery(t))}else{e+="?"+b.HTTPBuildQuery(t);var o=s.createElement("script");o.type="text/javascript",o.async=!0,o.defer=!0,o.src=e;var c=s.getElementsByTagName("script")[0];c.parentNode.insertBefore(o,c)}},P.prototype._execute_array=function(e){var t,r=[],i=[],n=[];b.each(e,function(e){e&&(t=e[0],"function"==typeof e?e.call(this):b.isArray(e)&&"alias"===t?r.push(e):b.isArray(e)&&-1!=t.indexOf("track")&&"function"==typeof this[t]?n.push(e):i.push(e))},this);var a=function(e,t){b.each(e,function(e){this[e[0]].apply(this,e.slice(1))},t)};a(r,this),a(i,this),a(n,this)},P.prototype.push=function(e){this._execute_array([e])},P.prototype.disable=function(e){void 0===e?this._flags.disable_all_events=!0:this.__disabled_events=this.__disabled_events.concat(e)},P.prototype.track=function(e,t,r,i){if(void 0===e)return void O.error("No event name provided to mixpanel.track");t=t||{},t.token=t.token||this.get_config("token"),triggermail.config.eventSource&&!t.event_source&&(t.event_source=triggermail.config.eventSource),this.cookie.update_search_keyword(s.referrer),this.get_config("store_google")&&this.cookie.update_campaign_params(),this.get_config("save_referrer")&&this.cookie.update_referrer_info(s.referrer),t=b.extend({},b.info.properties(),this.cookie.properties(),t),t.distinct_id=i||t.distinct_id;for(var n=["ch","bc_persist_updated"],a=0;a<n.length;a++)delete t[n[a]];(triggermail.util.strip_props_before_send||function(e){return e})(t);var o={event:e,properties:t};v&&(o.validate=1);var c=b.truncate(o,1023),l=b.JSONEncode(c),u=b.base64Encode(l);O.log("BLUECORE REQUEST:"),O.log(c);var p=u;return payload={data:p},-1!=this.get_distinct_id().indexOf("live_demo")?(payload.live_demo=!0,track_path=this.get_config("api_host")+"/templates/demo_track/"+e):-1!=this.get_distinct_id().indexOf("event_stream")?(payload.event_stream=!0,track_path=this.get_config("api_host")+"/templates/event_stream_track/"+e):track_path=this.get_config("api_host")+"/track/"+e,this._send_request(track_path,payload,this._prepare_callback(r,c)),c},P.prototype.track_pageview=function(e){void 0===e&&(e=s.location.href),this.track("mp_page_view",b.info.pageviewInfo(e))},P.prototype.track_links=function(){return this._track_dom.call(this,x,arguments)},P.prototype.track_forms=function(){return this._track_dom.call(this,E,arguments)},P.prototype.register=function(e,t){this.cookie.register(e,t)},P.prototype.register_once=function(e,t,r){this.cookie.register_once(e,t,r)},P.prototype.unregister=function(e){this.cookie.unregister(e)},P.prototype._register_single=function(e,t){var r={};r[e]=t,this.register(r)},P.prototype.identify=function(e,t,r,i){e!=this.get_distinct_id()&&e!=this.get_property("__alias")&&(this.unregister("__alias"),this._register_single("distinct_id",e)),this._flags.identify_called=!0,this.people._flush(t,r,i)},P.prototype.get_distinct_id=function(){return this.get_property("distinct_id")},P.prototype.alias=function(e,t){if(e===this.get_property("$people_distinct_id"))return O.critical("Attempting to create alias for existing People user - aborting."),-2;var r=this;return b.isUndefined(t)&&(t=this.get_distinct_id()),e!==t?(this._register_single("__alias",e),this.track("$create_alias",{alias:e,distinct_id:t},function(t){r.identify(e)})):(O.error("alias matches current distinct_id - skipping api call."),this.identify(e),-1)},P.prototype.name_tag=function(e){this._register_single("mp_name_tag",e)},P.prototype.set_config=function(e){b.isObject(e)&&(b.extend(this.config,e),this.cookie&&this.cookie.update_config(this.config),v=v||this.get_config("debug"))},P.prototype.get_config=function(e){return this.config[e]},P.prototype.get_property=function(e){return this.cookie.props[e]},P.prototype.toString=function(){var e=this.get_config("name");return"triggermail.lytics"!==e&&(e="triggermail.lytics."+e),e};var N=function(){};if(N.prototype._init=function(e){this._mixpanel=e},N.prototype.set=function(e,t,r){var i={},n={};return b.isObject(e)?(b.each(e,function(e,t){"$distinct_id"!=t&&"$token"!=t&&(n[t]=e)}),r=t):n[e]=t,this._get_config("save_referrer")&&this._mixpanel.cookie.update_referrer_info(s.referrer),n=b.extend({},b.info.people_properties(),this._mixpanel.cookie.get_referrer_info(),n),i.$set=n,this._send_request(i,r)},N.prototype.increment=function(e,t,r){var i={},n={};return b.isObject(e)?(b.each(e,function(e,t){if("$distinct_id"!=t&&"$token"!=t)return isNaN(parseFloat(e))?void O.error("Invalid increment value passed to mixpanel.people.increment - must be a number"):void(n[t]=e)}),r=t):(b.isUndefined(t)&&(t=1),n[e]=t),i.$add=n,this._send_request(i,r)},N.prototype.append=function(e,t,r){var i={},n={};return b.isObject(e)?(b.each(e,function(e,t){"$distinct_id"!=t&&"$token"!=t&&(n[t]=e)}),r=t):n[e]=t,i.$append=n,this._send_request(i,r)},N.prototype.track_charge=function(e,t,r){return!b.isNumber(e)&&(e=parseFloat(e),isNaN(e))?void O.error("Invalid value passed to mixpanel.people.track_charge - must be a number"):this.append("$transactions",b.extend({$amount:e},t),r)},N.prototype.clear_charges=function(e){return this.set("$transactions",[],e)},N.prototype.delete_user=function(){if(!this._identify_called())return void O.error("mixpanel.people.delete_user() requires you to call identify() first");var e={$delete:this._mixpanel.get_distinct_id()};return this._send_request(e)},N.prototype.toString=function(){return this._mixpanel.toString()+".people"},N.prototype._send_request=function(e,t){e.$token=this._get_config("token"),e.$distinct_id=this._mixpanel.get_distinct_id();var r=b.encodeDates(e),i=b.truncate(r,255),n=b.JSONEncode(r),a=b.base64Encode(n);return this._identify_called()?(O.log("BLUECORE PEOPLE REQUEST:"),O.log(i),this._mixpanel._send_request(this._get_config("api_host")+"/engage/",{data:a},this._mixpanel._prepare_callback(t,i)),i):(this._enqueue(e),b.isUndefined(t)||t(this._get_config("verbose")?{status:-1,error:null}:-1),i)},N.prototype._get_config=function(e){return this._mixpanel.get_config(e)},N.prototype._identify_called=function(){return!0===this._mixpanel._flags.identify_called},N.prototype._enqueue=function(e){
"$set"in e?this._mixpanel.cookie._add_to_people_queue("$set",e):"$add"in e?this._mixpanel.cookie._add_to_people_queue("$add",e):"$append"in e?this._mixpanel.cookie._add_to_people_queue("$append",e):O.error("Invalid call to _enqueue():",e)},N.prototype._flush=function(e,t,r){var i=this,n=b.extend({},this._mixpanel.cookie._get_queue("$set")),a=b.extend({},this._mixpanel.cookie._get_queue("$add")),o=this._mixpanel.cookie._get_queue("$append");if(b.isUndefined(n)||!b.isObject(n)||b.isEmptyObject(n)||(i._mixpanel.cookie._pop_from_people_queue("$set",n),this.set(n,function(t,r){0==t&&i._mixpanel.cookie._add_to_people_queue("$set",n),b.isUndefined(e)||e(t,r)})),b.isUndefined(a)||!b.isObject(a)||b.isEmptyObject(a)||(i._mixpanel.cookie._pop_from_people_queue("$add",a),this.increment(a,function(e,r){0==e&&i._mixpanel.cookie._add_to_people_queue("$add",a),b.isUndefined(t)||t(e,r)})),!b.isUndefined(o)&&b.isArray(o)&&o.length)for(var c=o.length-1;c>=0;c--){var l=o.pop();i.append(l,function(e,t){0==e&&i._mixpanel.cookie._add_to_people_queue("$append",l),b.isUndefined(r)||r(e,t)})}},b.toArray=b.toArray,b.isObject=b.isObject,b.JSONEncode=b.JSONEncode,b.JSONDecode=b.JSONDecode,b.isEmptyObject=b.isEmptyObject,P.prototype.init=P.prototype.init,P.prototype.disable=P.prototype.disable,P.prototype.track=P.prototype.track,P.prototype.track_links=P.prototype.track_links,P.prototype.track_forms=P.prototype.track_forms,P.prototype.track_pageview=P.prototype.track_pageview,P.prototype.register=P.prototype.register,P.prototype.register_once=P.prototype.register_once,P.prototype.unregister=P.prototype.unregister,P.prototype.identify=P.prototype.identify,P.prototype.alias=P.prototype.alias,P.prototype.name_tag=P.prototype.name_tag,P.prototype.set_config=P.prototype.set_config,P.prototype.get_config=P.prototype.get_config,P.prototype.get_property=P.prototype.get_property,P.prototype.get_distinct_id=P.prototype.get_distinct_id,P.prototype.toString=P.prototype.toString,D.prototype.properties=D.prototype.properties,D.prototype.update_search_keyword=D.prototype.update_search_keyword,D.prototype.update_referrer_info=D.prototype.update_referrer_info,D.prototype.get_cross_subdomain=D.prototype.get_cross_subdomain,D.prototype.clear=D.prototype.clear,N.prototype.set=N.prototype.set,N.prototype.increment=N.prototype.increment,N.prototype.append=N.prototype.append,N.prototype.track_charge=N.prototype.track_charge,N.prototype.clear_charges=N.prototype.clear_charges,N.prototype.delete_user=N.prototype.delete_user,N.prototype.toString=N.prototype.toString,b.isUndefined(e))return void O.critical("'mixpanel' object not initialized. Ensure you are using the latest version of the Mixpanel JS Library along with the snippet we provide.");if(e.__loaded||e.config&&e.cookie)return void O.error("Mixpanel library has already been downloaded at least once.");if(f<1.1)return void O.critical("Version mismatch; please ensure you're using the latest version of the Mixpanel code snippet.");var j={};b.each(e._i,function(e){var t,r;e&&b.isArray(e)&&(t=e[e.length-1],r=R.apply(this,e),j[t]=r)});var B=function(){b.each(j,function(t,r){"triggermail.lytics"!==r&&(e[r]=t)}),e._=b};if(e.init=function(t,r,i){if(i)e[i]||(e[i]=j[i]=R(t,r,i),e[i]._loaded());else{var n=e;j["triggermail.lytics"]?n=j["triggermail.lytics"]:t&&(n=R(t,r,"triggermail.lytics")),window["triggermail.lytics"]=e=n,B()}},e.init(),b.each(j,function(e){e._loaded()}),s.addEventListener)"complete"==s.readyState?t():s.addEventListener("DOMContentLoaded",t,!1);else if(s.attachEvent){s.attachEvent("onreadystatechange",t);var Q=!1;try{Q=null==window.frameElement}catch(e){}s.documentElement.doScroll&&Q&&r()}b.register_event(window,"load",t,!0)}(window.triggermail.lytics),function(){!function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}(triggermail,function(){var e=function(e,t){var r=e.obem;if(void 0!==r&&""!==r){void 0===triggermail.lytics.get_property("obem")&&(triggermail.persist.write_prop("obem",r),triggermail.track("identify",{customer:e}))}var i=e.email,n=e.coom;if((void 0!==i&&""!==i||n)&&(!0===t||(i=triggermail.core.sanitizer.sanitize("email",i)))){var a=triggermail.util.hashCode(i||n);return a!==triggermail.persist.read_prop("bc_id")&&(triggermail.persist.write_prop("bc_id",a),triggermail.track("identify",{customer:e})),e}};return{EMAIL_ADDRESS_PROPERTY:"email_address",PAGE_VIEW:"page_view",MAX_PROPERTY_LENGTH:1024,track:function(e,t,r){var i=triggermail.lytics._.extend({},t),n=triggermail.persist.props();triggermail.lytics._.extend(t,n);try{t.url=window.location.href.slice(0,899),t.url.indexOf("s.thebrighttag")>-1&&delete t.url}catch(e){}if("unsubscribe"==e||"optin"==e||"resubscribe"==e){if(!i.email)return;t.email=i.email}try{t.integration_version=1603098417}catch(e){}"page_view"!==e&&triggermail.lytics.track(e,t,void 0,r),triggermail.lytics.get_distinct_id()&&(t.distinct_id=triggermail.lytics.get_distinct_id());try{!0===triggermail.integ.debug&&console.debug(e,t)}catch(e){}},add_to_cart:function(e){return this.track("add_to_cart",{products:[e]})},remove_from_cart:function(e){return this.track("remove_from_cart",{products:[e]})},wishlist:function(e){return this.track("wishlist",{products:[e]})},view_cart:function(e){return this.track("viewed_cart",e)},stop:function(e){return this.track("stop",e)},page:function(e){return this.track("page_view",e)},purchase:function(e){var t=triggermail.lytics._.extend({},e);return triggermail.util.isValidEmail(t.email)||(t.distinct_id=triggermail.lytics.get_distinct_id(),delete t.email),this.track("purchase",t)},checkout_start:function(e){return this.track("checkout_start",e)},view:function(e,t){triggermail.integ.salt_products&&(e.salt=Math.random().toString(36).replace(".",""));var r=triggermail.lytics._.extend(t||{},{products:[e]});return this.track("viewed_product",r)},view_content:function(e,t){triggermail.integ.salt_products&&(e.salt=Math.random().toString(36).replace(".",""));var r=triggermail.lytics._.extend(t||{},{contents:[e]});return this.track("viewed_content",r)},search:function(e){return this.track("search",e)},browse_category:function(e){return this.track("browse_category",{browse_properties:e})},identify:function(t,r){return e(t,r)},subscribe:function(t){return t.source="newsletter",e(t)},unsubscribe:function(e){return this.track("unsubscribe",e)},resubscribe:function(e){return this.track("resubscribe",e)},optin:function(e){return this.track("optin",e)},customer_patch:function(e){return this.track("customer_patch",{customer:e})},patch:function(e){return this.track("patch",e)},merge:function(e){return this.track("merge",e)},custom:function(e,t){return this.track(e,t)},init:function(e){},exception:function(e){var t={};triggermail.lytics._.extend(t,triggermail.lytics._.info.properties());try{t.url=window.location.href,t.url.indexOf("s.thebrighttag")>-1&&delete t.url,t.message=e.message}catch(e){}t.error=e,this.track("exception",t)},anonymous_track:function(e,t,r){var i=r||triggermail.lytics._.UUID();return this.track(e,t,i),i}}}())}(),triggermail.identifySource=function(){return{ACCOUNT_REGISTER:"account register",ACCOUNT_LOGIN:"account login",EMAIL_CAPTURE_POPUP:"email capture popup",EMAIL_SIGNUP:"email signup",SITE_VARIABLE:"site variable",CHECKOUT_FLOW:"checkout flow",CUSTOM:"custom",ESP_EMAIL_APPEND:"esp email append",OBEM_EMAIL_APPEND:"obem email append",JUSTUNO:"justuno",BLUECORE_PURCHASE_PIXEL:"bluecore purchase pixel"}}(),triggermail.util=function(){return{price:function(e){var t=String(e).replace(/[^0-9\.]/g,"").split("."),r=t[0],i=(t[1]||"").slice(0,2),n=r+"."+i;return parseFloat(n)},unique:function(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return triggermail.lytics._.map(t,function(e,t){return t})},slugify:function(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")},serializeForm:function(e){var t={},r=e.serializeArray();return $.each(r,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},getUrlParam:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",r=new RegExp(t),i=r.exec(window.location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},isMobile:function(){var e=!1,t=["iphone","ipad","android","blackberry","nokia","opera mini","windows mobile","windows phone","iemobile"];for(var r in t)navigator.userAgent.toLowerCase().indexOf(t[r].toLowerCase())>0&&(e=!0);return e},getParamFromQueryString:function(e,t){return decodeURI((RegExp(t+"=(.+?)(&|$)").exec(e)||[,null])[1])},trimString:function(e,t){return triggermail.lytics._.trim(e).substring(0,t)},htmlToText:function(e){var t=document.createElement("p");return t.innerHTML=e,t.textContent||t.innerText||""},isAnonymousUser:function(){var e=triggermail.lytics.get_property(triggermail.core.EMAIL_ADDRESS_PROPERTY);return!this.isValidEmail(e)},emRegex:/\S+@\S+\.\S+/,isValidEmail:function(e){return triggermail.util.emRegex.test(e)},validateAndIdentify:function(e,t,r,i){var n=(e||"").trim();this.isValidEmail(n)&&(triggermail.identify({email:n,source:t,source_detail:r}),i&&triggermail.optin({email:n}))},findEmail:function(e,t){try{return void 0===t&&(t=triggermail.util.emRegex),t.exec(e).pop()}catch(e){}},hashCode:function(e){var t,r,i=0;if(0===e.length)return i;for(t=0;t<e.length;t++)r=e.charCodeAt(t),i=(i<<5)-i+r,i&=i;return i},productHash:function(e){var t=this.sanitizeProductName(e[TriggerMail.PRODUCT_NAME_PROPERTY]);return this.hashCode(t)},_getbyte64:function(e,t){_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var r=_ALPHA.indexOf(e.charAt(t));if(-1===r)throw"Cannot decode base64";return r},b64decode:function(e){var t,r,i=0,n=e.length,a=[];if(e=String(e),0===n)return e;if(n%4!=0)throw"Cannot decode base64";for("="===e.charAt(n-1)&&(i=1,"="===e.charAt(n-2)&&(i=2),n-=4),t=0;t<n;t+=4)r=this._getbyte64(e,t)<<18|this._getbyte64(e,t+1)<<12|this._getbyte64(e,t+2)<<6|this._getbyte64(e,t+3),a.push(String.fromCharCode(r>>16,r>>8&255,255&r));switch(i){case 1:r=this._getbyte64(e,t)<<18|this._getbyte64(e,t+1)<<12|this._getbyte64(e,t+2)<<6,a.push(String.fromCharCode(r>>16,r>>8&255));break;case 2:r=this._getbyte64(e,t)<<18|this._getbyte64(e,t+1)<<12,a.push(String.fromCharCode(r>>16))}return a.join("")},wrapEvent:function(e){var t=Array.prototype.slice.call(arguments,1);return function(){try{return e.apply(this,t.concat(Array.prototype.slice.call(arguments,0)))}catch(e){triggermail.exception(e)}}},removeURLParam:function(e,t){return triggermail.util.updateURLParams(e,t,!1)},keepURLParam:function(e,t){return triggermail.util.updateURLParams(e,t,!0)},updateURLParams:function(e,t,r){var i,n=e.split("?")[0],a=[],o=-1!==e.indexOf("?")?e.split("?")[1]:"";if(""!==o){a=o.split("&");for(var c=a.length-1;c>=0;c-=1)i=a[c].split("=")[0],r?triggermail.lytics._.isArray(t)?-1===t.indexOf(i)&&a.splice(c,1):i!==t&&a.splice(c,1):triggermail.lytics._.isArray(t)?t.indexOf(i)>-1&&a.splice(c,1):i===t&&a.splice(c,1);n+=a.length>0?"?"+a.join("&"):""}return n},getArrayElementFromQueryString:function(e,t){var r=[];e||(e=location.href),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");for(var i=t+"=([^&#]+)",n=new RegExp(i,"ig");;){var a=n.exec(e);if(!a||!a[1])break;r.push(a[1])}return r.length?1===r.length?r[0]:r:null},executeOnLoad:function(e,t,r,i,n,a){var o=void 0===r?3:r,c=i||500,l=n||!1,u=a||function(){},s=function(e,t){try{var r=t.shift();if(void 0!==e[r]&&e[r])return t.length>0?s(e[r],t):e[r]}catch(e){}return null};if(l&&triggermail.lytics._.dom_query(e).length>0||s(window,e.split(".")))try{t()}catch(e){}else if(o>0)try{o-=1,setTimeout(function(){triggermail.util.wrapEvent(function(){triggermail.util.executeOnLoad(e,t,o,i,l)},e,t,o,c,l)()},c)}catch(e){}else try{u()}catch(e){}},sanitizeSearchTerm:function(e){return e.replace(/[^a-z\d\s:]+/gi,"")},registerAndMergeOpaqueId:function(e){if(void 0!==e&&e){if(!triggermail.persist.read_prop("tm_merged")){var t=triggermail.persist.read_prop("distinct_id");triggermail.track("merge",{merge:{source:t,destination:e}}),triggermail.persist.write_prop("tm_merged",!0),triggermail.persist.write_prop("distinct_id",e)}}},cookie:triggermail.lytics._.cookie,encode:triggermail.lytics._.JSONEncode,decode:triggermail.lytics._.JSONDecode,walk:function(e,t){var r=e;for(t(r),r=r.firstChild;r;)walk(e,t),r=r.nextSibling},walkUntil:function(e,t,r){var i=e;if(ret=t(i),!0===r(ret))return ret;for(i=i.firstChild;i;)walk(i,t),i=i.nextSibling}}}(),triggermail.demo=function(){var e=triggermail.lytics.get_distinct_id();-1===e.indexOf("live_demo")&&(triggermail.persist.write_prop("distinct_id","live_demo_"+e),e=triggermail.lytics.get_distinct_id()),triggermail.lytics.cookie.update_config({live_demo:!0,cookie_expiration:1});var t=triggermail.Partner.keys.lytics.p,r="http://www.bluecore.com/api/templates/live_demo/"+t+"/"+e;window.open(r)},triggermail.event_stream=function(){var e=triggermail.lytics.get_distinct_id();if(-1===e.indexOf("event_stream")){var t="event_stream_"+triggermail.persist.read_prop("distinct_id");triggermail.persist.write_prop("distinct_id",t),e=t}triggermail.lytics.cookie.update_config({event_stream:!0,cookie_expiration:1});var r=triggermail.Partner.keys.lytics.p,i="http://www.bluecore.com/api/templates/event_stream/"+r+"/"+e;window.open(i)},triggermail.insanetiego=function(){return{inject_div:function(){$("body").append('<div id="insanetiego" style="position:fixed;bottom:0;width:100%;background:#D8E7ED;height:300px;overflow:scroll;z-index:2000;border-top-style:solid;border-top-width:5px;"></div>')},remove_div:function(){$("#insanetiego").remove()},debug:function(){triggermail.util.cookie.set("tm_debug",!0),triggermail.integ.debug=!0,this.inject_div()},undebug:function(){triggermail.util.cookie.set("tm_debug",!1),triggermail.integ.debug=!1}}}(),triggermail.core={},triggermail.core.sanitizer=function(){function e(e){return t(e)?e:null}function t(e){return/\S+@\S+\.\S+/.test(e)}return{sanitize:function(t,r){return"email"===t?e(r):"string"==typeof r?r.trim():r||""}}}(),triggermail.persist=function(){var e="LOCAL_STORAGE",t=function(e){return"COOKIE_ONLY"===e||"LOCAL_STORAGE"===e},r=function(){return triggermail.lytics.cookie.props||{}},i=function(){try{return JSON.parse(localStorage.getItem("bc_persist_props"))||{}}catch(e){return{}}},n=function(e){try{var t=e.email;if(t){var r=triggermail.lytics._.extend({},e);return delete r.email,r.bc_id=triggermail.util.hashCode(t),r}}catch(e){}return e},a=function(){var e=Date.now();l("bc_persist_updated",e);var t=r();t=n(t),localStorage.setItem("bc_persist_props",JSON.stringify(t))},o=function(e,t){var r=e.distinct_id;try{t.distinct_id&&t.distinct_id!==r&&triggermail.track("merge",{merge:{source:t.distinct_id,destination:r}}),t.email&&triggermail.util.isValidEmail(t.email)&&triggermail.track("merge",{merge:{source:t.email,destination:r}})}catch(e){}},c=function(e,t,r){var i={},a=Date.now(),o=r?e:t,c=r?t:e;i=triggermail.lytics._.extend(i,o),i=triggermail.lytics._.extend(i,c),i=n(i),i.bc_persist_updated=a,i.distinct_id=e.distinct_id,triggermail.lytics.cookie.props=i,triggermail.lytics.cookie.save(),localStorage.setItem("bc_persist_props",JSON.stringify(i))},l=function(e,t){triggermail.lytics.cookie.props[e]=t,triggermail.lytics.cookie.save()},u=function(e,t){var r=JSON.parse(localStorage.getItem("bc_persist_props"));r[e]=t,r=n(r),r.bc_persist_updated=Date.now(),localStorage.setItem("bc_persist_props",JSON.stringify(r))},s=function(e){delete triggermail.lytics.cookie.props[e],triggermail.lytics.cookie.save()},p=function(e){var t=JSON.parse(localStorage.getItem("bc_persist_props"));delete t[e],t.bc_persist_updated=Date.now(),localStorage.setItem("bc_persist_props",JSON.stringify(t))},d=!0;return{setMode:function(r){t(r)&&(e=r)},setSendMergeEvents:function(e){"boolean"==typeof e&&(d=e)},sync:function(){if("COOKIE_ONLY"!==e){var t=r(),n=t.bc_persist_updated||0,l=i(),u=l.bc_persist_updated;if(!u||triggermail.lytics._.isEmptyObject(l))return void a();if(!function(e,t){return JSON.stringify(e,Object.keys(e).sort())===JSON.stringify(t,Object.keys(t).sort())}(t,l)){c(l,t,!n||n>u),!0===d&&o(l,t)}}},props:function(){return"COOKIE_ONLY"===e?r():i()},read_prop:function(t){var n;return n="COOKIE_ONLY"===e?r()[t]:i()[t],void 0!==n?n:null},write_prop:function(t,r){"COOKIE_ONLY"===e?l(t,r):(u(t,r),this.sync())},remove_prop:function(t){"COOKIE_ONLY"===e?s(t):(s(t),p(t))}}}(),triggermail.util=triggermail.util||{},triggermail.lytics._.extend(triggermail.util,{getNestedProp:function(e,t){try{if("string"!=typeof e)return;var r=t||window,i=e.split(".");if(0===i.length)return;for(var n=0,a={};n<i.length&&void 0!==a;)a=function(e,t,i){var n=t[i];return 0===i?r[n]:e[n]}(a,i,n),n+=1;return a}catch(e){}},listenAndIdentify:function(e,t,r,i,n,a){try{jQuery(document).on(i||"focusout",e,function(){var e=this;triggermail.util.wrapEvent(function(){var i=jQuery(n||e).val(),o=triggermail.identifySource[t];o&&(triggermail.util.validateAndIdentify(i,o,a),r&&triggermail.custom("welcome_qualifier",{source:o}))})()})}catch(e){}},executeOnTruthy:function(e,t,r,i,n){if("function"!=typeof e)throw"first argument should be a function to evaluate";if("function"!=typeof t)throw"second argument should be a function to execute if the first function evaluates to truthy";var a;a="number"==typeof r&&r>=1&&Math.floor(r)===r?r:3;var o;o="number"==typeof i&&i>100?i:500;var c;c="function"==typeof n?n:function(){},function r(i){var n=i;setTimeout(function(){e()?t():--n?r(n):c()},o)}(a)},registerCoom:function(e){var t=triggermail.persist.read_prop("tm_coom"),r=triggermail.persist.read_prop("email");if(!(triggermail.persist.read_prop("bc_id")||t||r&&triggermail.util.isValidEmail(r)))return triggermail.persist.write_prop("tm_coom",!0),triggermail.track("identify",{customer:e}),e},getDataLayerObj:function(e,t,r){var i=window[t]||window.dataLayer;if(void 0!==i&&void 0!==e&&(void 0===r||"boolean"==typeof r))for(var n=function(e,t){return t?e.length-1:0}(i,r);function(e,t,r){return r?e>=0:e<t.length}(n,i,r);n=function(e,t){return t?e-1:e+1}(n,r)){var a=i[n];if(void 0!==a[e])return a}},euroPrice:function(e){try{var t=e.replace(/[^0-9.,]/g,"");if(/[0-9]+,[0-9]{2}$/.test(t)){var r=t.substr(0,t.length-3).replace(/\./g,"")+"."+t.substr(t.length-2);return parseFloat(r)}return parseFloat(t.replace(/,/g,""))}catch(e){}},handleS7Image:function(e,t,r,i){var n=e,a="wid="+(t||"920"),o="qlt="+(r||"90"),c=[a,o,"op_sharpen=1"];return"object"==typeof i&&i.length>0&&(c=c.concat(i)),-1===n.indexOf("?")&&(n+="?"),-1===n.indexOf("$")&&(n+="$"),n.replace(/\$.*/g,c.join("&"))},emailListener:function(e){try{jQuery(document).on(e.event||"click",e.event_object,function(){try{var t="function"==typeof e.email?e.email().trim():jQuery(e.email).val().trim(),r=triggermail.identifySource[e.source],i=e.source_detail,n={email:t,source:r,source_detail:i},a=e.customer_attributes?e.customer_attributes.static:{},o={};e.customer_attributes&&e.customer_attributes.dynamic&&Object.keys(e.customer_attributes.dynamic).map(function(t,r){var i="function"==typeof e.customer_attributes.dynamic[t]?e.customer_attributes.dynamic[t]():jQuery(e.customer_attributes.dynamic[t]).val().trim();o[t]=i});var c=Object.assign(n,a,o);if(e.consent){var l;switch(typeof e.consent){case"function":l="boolean"==typeof e.consent()&&e.consent();break;case"string":l="checkbox"===jQuery(e.consent).attr("type")&&jQuery(e.consent).is(":checked");break;case"boolean":l=e.consent}}triggermail.util.isValidEmail(t)&&(l?(triggermail.identify(c),triggermail.anonymous_track("optin",n,t)):triggermail.identify(c))}catch(e){}})}catch(e){}},getOlapicMedia:function(e,t,r,i,n,a){try{var o="https://photorankapi-a.akamaihd.net/customers/"+e+"/streams/bytag/"+r+"?version=v2.2&auth_token="+t,c=new XMLHttpRequest;c.open("Get",o),c.send(),c.onreadystatechange=function(){try{if(4===c.readyState&&200===c.status){var e=JSON.parse(c.responseText).data.id,r="https://photorankapi-a.akamaihd.net/streams/"+e+"/media/"+(a||"recent")+"?version=v2.2&auth_token="+t,o=new XMLHttpRequest;o.open("Get",r),o.send(),o.onreadystatechange=function(){try{if(4===o.readyState&&200===o.status){var e=JSON.parse(o.responseText),t={id:(new triggermail.fetcher).id()};if(void 0!==e.data._embedded)for(var r=e.data._embedded.media.length,a=0;a<r;a++)if(a<(i||3)){var c=e.data._embedded.media[a];switch(n||"normal"){case"mobile":t["olapic_image_"+a]=c.images.mobile;break;case"square":t["olapic_image_"+a]=c.images.square;break;case"thumbnail":t["olapic_image_"+a]=c.images.thumbnail;break;case"original":t["olapic_image_"+a]=c.images.original;break;default:t["olapic_image_"+a]=c.images.normal}t["olapic_uploader_name_"+a]=c._embedded.uploader.name}triggermail.patch({products:[t]})}}catch(e){}}}}catch(e){}}}catch(e){}}}),triggermail.integ=function(){return{init:function(){if(!triggermail.util.getUrlParam("bluecore_do_not_track")){void 0!==triggermail.Partner.init?triggermail.Partner.init():triggermail.integ.partnerInit();try{triggermail.integ.checkLoop()}catch(e){}}},partnerInit:function(e){var t=triggermail.Partner;if(void 0!==e||!triggermail.lytics._.dom_query(".translated-rtl, .translated-rtl, #goog-gt-tt").length&&!triggermail.lytics._.dom_query('meta[http-equiv="X-Translated-By"]').length){try{t.trackProductView()}catch(e){e.location="trackProductView",triggermail.exception(e)}try{t.trackAddToCart()}catch(e){e.location="trackAddToCart",triggermail.exception(e)}try{t.trackCheckout()}catch(e){e.location="trackCheckout",triggermail.exception(e)}try{t.watchEmail()}catch(e){e.location="watchEmail",triggermail.exception(e)}if(t.hasOwnProperty("trackRemoveFromCart"))try{t.trackRemoveFromCart()}catch(e){e.location="trackRemoveFromCart",triggermail.exception(e)}if(t.hasOwnProperty("trackCheckoutStart"))try{t.trackCheckoutStart()}catch(e){e.location="trackCheckoutStart",triggermail.exception(e)}if(t.hasOwnProperty("trackUnsubscribe"))try{t.trackUnsubscribe()}catch(e){e.location="trackUnsubscribe",triggermail.exception(e)}if(t.hasOwnProperty("trackSubscribe"))try{t.trackSubscribe()}catch(e){e.location="trackSubscribe",triggermail.exception(e)}if(t.hasOwnProperty("trackSearch"))try{t.trackSearch()}catch(e){e.location="trackSearch",triggermail.exception(e)}if(t.hasOwnProperty("trackBrowseCategory"))try{t.trackBrowseCategory()}catch(e){e.location="trackBrowseCategory",triggermail.exception(e)}if(t.hasOwnProperty("trackWishlist"))try{t.trackWishlist()}catch(e){e.location="trackWishlist",triggermail.exception(e)}if(t.hasOwnProperty("trackContentView"))try{t.trackContentView()}catch(e){e.location="trackContentView",triggermail.exception(e)}if(t.hasOwnProperty("trackStop"))try{t.trackStop()}catch(e){e.location="trackStop",triggermail.exception(e)}if(triggermail.Partner.hasOwnProperty("trackCustom"))try{triggermail.Partner.trackCustom()}catch(e){triggermail.exception(e)}}},checkLoop:function(){if(void 0===triggermail.Partner.disableEmailAppendPickup||0==triggermail.Partner.disableEmailAppendPickup){for(var e=window.location.search.split("&"),t=0;t<e.length;t++){try{var r=triggermail.util.b64decode(decodeURIComponent(e[t].split("=").slice(1).join("=")))}catch(e){}if(r&&/^(([^<>{}()\[\]\.,;:\s@\"]+(\.[^<>{}()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>{}()[\]\.,;:\s@\"]+\.)+[^<>{}()[\]\.,;:\s@\"]{2,})/.test(r)&&triggermail.util.isValidEmail(r))return void triggermail.identify({email:r,source:triggermail.identifySource.ESP_EMAIL_APPEND,source_detail:"encoded"})}var i=triggermail.util.getUrlParam("tme");if(i.length>0)return void triggermail.identify({email:i,source:triggermail.identifySource.ESP_EMAIL_APPEND,source_detail:"tme"},!0);var i=decodeURIComponent(location.search).match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi)||decodeURIComponent(location.hash).match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);if(i&&triggermail.util.isValidEmail(i[0]))return void triggermail.identify({email:i[0],source:triggermail.identifySource.ESP_EMAIL_APPEND,source_detail:"plain text"})}var n=triggermail.util.getUrlParam("obem");if(void 0!==n&&""!=n&&triggermail.identify({obem:n,source:triggermail.identifySource.OBEM_EMAIL_APPEND}),triggermail.lytics._.dom_query("#bluecore_purchase_pixel").length>0&&void 0!==triggermail.lytics._.dom_query("#bluecore_purchase_pixel")[0]){var a=triggermail.lytics._.dom_query("#bluecore_purchase_pixel")[0].src,i=triggermail.util.getParamFromQueryString(a,"email");triggermail.identify({email:i,source:triggermail.identifySource.BLUECORE_PURCHASE_PIXEL})}triggermail.lytics._.addEvent(document,"bc:identify",triggermail.util.wrapEvent(function(e,t){triggermail.util.isValidEmail(t.email)&&triggermail.identify({email:t.email,source:triggermail.identifySource.CUSTOM,source_detail:"dom event"})}))}}}(),triggermail.integ.ProductFetcher=__tmClass.extend({name:function(){return this._name},readOg:function(e){},category:function(){return this._category},color:function(){return this._color},size:function(){return this._size},price:function(){return this._price},brand:function(){return this._brand},id:function(){return this._id},image:function(){return this._image},url:function(){return this._url},out_of_stock:function(){return!1},tags:function(){return this._tags},to_dict:function(){try{var e={name:triggermail.core.sanitizer.sanitize("name",this.name()),category:triggermail.core.sanitizer.sanitize("category",this.category()),size:triggermail.core.sanitizer.sanitize("size",this.size()),price:triggermail.core.sanitizer.sanitize("price",this.price()),brand:triggermail.core.sanitizer.sanitize("brand",this.brand()),id:triggermail.core.sanitizer.sanitize("id",this.id()),image:triggermail.core.sanitizer.sanitize("image",this.image()),url:triggermail.core.sanitizer.sanitize("url",this.url()),out_of_stock:this.out_of_stock(),tags:this.tags(),color:triggermail.core.sanitizer.sanitize("color",this.color())};for(var t in e)""!==e[t]&&0!=e[t]||"out_of_stock"==t||delete e[t];return triggermail.lytics._.extend(e,this.extra_props()),e}catch(e){e.location="product_fetcher",triggermail.exception(e)}},extra_props:function(){return{}},fetch:function(){return this.to_dict()}}),triggermail.integ.ContentFetcher=__tmClass.extend({name:function(){return this._name},id:function(){return this._id},image:function(){return this._image},url:function(){return this._url},title:function(){return this._title},to_dict:function(){try{var e={id:triggermail.core.sanitizer.sanitize("id",this.id()),image:triggermail.core.sanitizer.sanitize("image",this.image()),name:triggermail.core.sanitizer.sanitize("name",this.name()),title:triggermail.core.sanitizer.sanitize("title",this.title()),url:triggermail.core.sanitizer.sanitize("url",this.url())};for(var t in e)""!==e[t]&&0!=e[t]||delete e[t];return triggermail.lytics._.extend(e,this.extra_props()),e}catch(e){e.location="content_fetcher",triggermail.exception(e)}},extra_props:function(){return{}},fetch:function(){return this.to_dict()}}),triggermail.integ.initServices=function(){triggermail.lytics.init(triggermail.integ.keys.lytics),triggermail.lytics=window["triggermail.lytics"],triggermail.lytics.set_config({save_referrer:!1,store_google:!1,debug:triggermail.integ.debug}),triggermail.persist.sync()},triggermail.fetcher=triggermail.integ.ProductFetcher.extend({name:function(){try{return jQuery("#pagename").text().trim()}catch(e){}},category:function(){try{return jQuery("#last-crumb").text().trim()}catch(e){}},id:function(){try{var e=/images\/(.+)_mainProductImage/;return jQuery("#kwmx-item-image-wrapper").find("img").attr("src").match(e)[1]}catch(e){}},url:function(){try{return window.location.href.split("?")[0]}catch(e){}},brand:function(){try{return triggermail.Helpers.grabSpec("Brand")}catch(e){}},image:function(){try{return(jQuery("#mainitemimage").attr("src")||jQuery(".mz-figure").find("img").attr("src")).replace("mainProductImage_MediumLarge","mainProductImage_Large")}catch(e){}},price:function(){try{var e;return jQuery("#kwmx-subskuprice").text().indexOf("-")>-1?(e=jQuery("#kwmx-subskuprice").text().split(" - "),triggermail.util.price(e[0])):jQuery("#kwmx-subskuprice").text().indexOf(" ")>-1?(e=jQuery("#kwmx-subskuprice").text().trim().split(" "),triggermail.util.price(e[1])):triggermail.util.price(jQuery("#kwmx-subskuprice").text().trim())}catch(e){}},out_of_stock:function(){try{return jQuery("#cf-avail").text().indexOf("unavailable")>-1}catch(e){}},extra_props:function(){var e={};try{e.original_price=triggermail.util.price(jQuery("span.strike").text().trim())||this.price(),e.on_sale=e.original_price>this.price()}catch(e){}try{e.star_rating=parseFloat(jQuery(".pdPrSummaryOverallRatingNum").text().trim()),e.review_count=parseInt(jQuery("div.pdPrSummaryOverallRatingCount span").text().trim())}catch(e){}try{e.league=triggermail.Helpers.grabSpec("League"),e.team=triggermail.Helpers.grabSpec("Team")}catch(e){}try{e.p_color=triggermail.Helpers.grabSKU("Color"),e.p_size=triggermail.Helpers.grabSKU("Size")}catch(e){}return e}}),triggermail.Helpers={grabSpec:function(e){var t;return jQuery(".itemspecsli").each(function(r,i){jQuery(i).text().trim().split(": ")[0].toLowerCase()===e.toLowerCase()&&(t=jQuery(i).text().trim().split(": ")[1])}),t},grabSKU:function(e){try{var t;return jQuery(".option-head").each(function(r,i){jQuery(i).text().indexOf(e)>-1&&"Not Selected"!==jQuery(i).find(".kwmx-selected-options").text().trim()&&(t=jQuery(i).find(".kwmx-selected-options").text().trim())}),t}catch(e){}},fireFetcherAndView:function(){try{var e=new triggermail.fetcher;if(e.id()){triggermail.view(e.to_dict());try{_c2pService.push(["view",e.to_dict()])}catch(e){}}}catch(e){}},fireFetcherAndViewC2P:function(){try{var e=new triggermail.fetcher;if(e.id())try{_c2pService.push(["view",e.to_dict()])}catch(e){}}catch(e){}}},triggermail.Partner=function(){return{trackProductView:function(){try{jQuery("#kwmx-item-body").length>0&&0===jQuery(".option-head").length?triggermail.Helpers.fireFetcherAndView():jQuery("#kwmx-item-body").length>0&&triggermail.Helpers.fireFetcherAndViewC2P()}catch(e){}try{1===jQuery(".option-head").length&&(jQuery(document).on("click",".optionavail",function(){try{setTimeout(function(){triggermail.Helpers.fireFetcherAndView()},1e3)}catch(e){}}),jQuery(document).on("change",".styled-select",function(){try{setTimeout(function(){triggermail.Helpers.fireFetcherAndView()},1e3)}catch(e){}}))}catch(e){}try{if(jQuery(".option-head").length>=2){try{jQuery(document).on("click",".optionavail.color-option",function(){try{void 0!==triggermail.Helpers.grabSKU("Color")&&void 0!==triggermail.Helpers.grabSKU("Size")&&triggermail.Helpers.fireFetcherAndView()}catch(e){}})}catch(e){}try{jQuery(document).on("click",".optionavail.size-option",function(){try{void 0!==triggermail.Helpers.grabSKU("Color")&&void 0!==triggermail.Helpers.grabSKU("Size")&&triggermail.Helpers.fireFetcherAndView()}catch(e){}})}catch(e){}}}catch(e){}},trackAddToCart:function(){try{jQuery(document).on("click","#kwmx-item-atc",function(){try{var e=new triggermail.fetcher,t=e.id();if(t){triggermail.add_to_cart({id:t});try{_c2pService.push(["addtocart",{id:t}])}catch(e){}}}catch(e){}})}catch(e){}},trackRemoveFromCart:function(){try{jQuery(document).on("click","a.ysco_remove_link img",function(){try{var e=jQuery("a.ysco_remove_link img").index(this),t=ids[e];t&&triggermail.remove_from_cart({id:t})}catch(e){}})}catch(e){}},trackCheckout:function(){},trackBrowseCategory:function(){},trackSearch:function(){var e=triggermail.util.getUrlParam("query");if(""!==e){triggermail.search({search_term:e});try{_c2pService.push(["search",{search_term:e}])}catch(e){}}try{var t="";if((jQuery("#category-name").length>0||jQuery("#kwmx-headline").length>0)&&(t=jQuery("#category-name").text().trim().toLowerCase()||jQuery("#kwmx-headline").text().trim().toLowerCase()),""!==t){triggermail.search({search_term:t});try{_c2pService.push(["search",{search_term:t}])}catch(e){}}}catch(e){}},watchEmail:function(){try{var e=triggermail.util.getUrlParam("smtrctid")||triggermail.util.getUrlParam("evg_anon_id")
;""!==e&&triggermail.util.registerAndMergeOpaqueId(e)}catch(e){}},trackSubscribe:function(){var e=[{tag:"#kwmx-newsletter-email",source:triggermail.identifySource.EMAIL_SIGNUP,source_detail:"email signup"},{tag:"#landingReturningCustomersEmail",source:triggermail.identifySource.ACCOUNT_LOGIN,source_detail:"account login"},{tag:"#pdReg-email",source:triggermail.identifySource.ACCOUNT_REGISTER,source_detail:"account register"},{tag:"#billing-email",source:triggermail.identifySource.CHECKOUT_FLOW,source_detail:"checkout flow"},{tag:"#cod_newsemail",source:triggermail.identifySource.EMAIL_CAPTURE_POPUP,source_detail:"email capture popup"}];try{e.forEach(function(e){try{jQuery(document).on("focusout",e.tag,function(){try{var t=jQuery(this).val();triggermail.util.validateAndIdentify(t,e.source,e.source_detail)}catch(e){}})}catch(e){}})}catch(e){}},trackWishlist:function(){},trackCustom:function(){},trackUnsubscribe:function(){},env:function(){return window.location.href.indexOf("sportsunlimitedinc.com")>-1?"p":"d"},keys:{lytics:{d:"dev",p:"sports_unlimited"}}}}();var syncUserAudiences=function(){var e=triggermail.util.cookie.get("__bc_audience_sync");e=e?JSON.parse(e):{};var t=+(e.lastSyncTime||0);+new Date-t>36e5&&function(){var e=function(e){var t=e.target;if(t.readyState===XMLHttpRequest.DONE){var r,i=function(e){triggermail.util.cookie.get(e)||triggermail.util.cookie.set(e,"true",void 0,triggermail.lytics.cookie.get_cross_subdomain())},n=function(e){triggermail.util.cookie.get(e)&&triggermail.util.cookie.remove(e,triggermail.lytics.cookie.get_cross_subdomain())},a=[],o=!!t.responseText,c={};try{c=o?JSON.parse(t.responseText):{}}catch(e){}o&&triggermail.lytics._.each(c,function(e,t){a.push(t),i(t)}),r=triggermail.util.cookie.get("__bc_audience_sync"),r=r?JSON.parse(r):{},triggermail.lytics._.each(r.audiences||[],function(e){-1===a.indexOf(e)&&n(e)}),r={lastSyncTime:+new Date,audiences:a},function(e){triggermail.util.cookie.set("__bc_audience_sync",JSON.stringify(e),void 0,triggermail.lytics.cookie.get_cross_subdomain())}(r)}},t=new XMLHttpRequest,r="//bluecore.com/api/audiences/get_audience_info";r+="?namespace="+encodeURIComponent(triggermail.integ.keys.lytics),r+="&customer_alias="+encodeURIComponent(triggermail.lytics.get_distinct_id()),r+="&_"+(new Date).getTime(),t.open("GET",r),t.onreadystatechange=e,t.send()}()};triggermail.initialize=function(){triggermail.integ.keys={};var e=triggermail.Partner.env();triggermail.integ.keys.lytics=triggermail.Partner.keys.lytics[e],triggermail.integ.debug=!1,triggermail.integ.initServices(),triggermail.init(),["124_rivington","lucy","nat_geo","servermonkey","vans"].indexOf(triggermail.integ.keys.lytics)>-1&&syncUserAudiences();var t=triggermail.util.getUrlParam("__distinct_id_override__");""!==t&&triggermail.persist.write_prop("distinct_id",t);var r=triggermail.util.getUrlParam("mc_eid"),i=triggermail.persist.read_prop("distinct_id");r&&-1===r.toLowerCase().indexOf("uniqid")&&i!==r&&(r="mceid_"+r,i!==r&&(triggermail.merge({merge:{source:i,destination:r},customer:{distinct_id:r}}),triggermail.persist.write_prop("distinct_id",r),triggermail.persist.write_prop("mc_eid",r))),triggermail.integ.init();var n=triggermail.util.getUrlParam("__auto_demo__");""!==n&&(triggermail.demo(),triggermail.identify({email:n}));try{var a=triggermail.persist.read_prop("bc_persist_updated"),o=triggermail.persist.read_prop("distinct_id");o.indexOf("event_stream")>-1&&Date.now()-a>=864e5&&(o=o.replace("event_stream_",""),triggermail.persist.write_prop("distinct_id",o))}catch(e){}},__checkAndInitialize(0);var host_path="storage.googleapis.com/bluecore_addons/",token=triggermail.lytics.config?triggermail.lytics.config.token:null,constant=triggermail.Partner.keys.lytics?triggermail.Partner.keys.lytics.p:null;if(partner=token||constant,partner){var script=document.createElement("script");script.type="text/javascript",script.setAttribute("data-cfasync","false"),script.src=("https:"===document.location.protocol?"https://":"http://")+host_path+partner+".ju.js";var firstScript=document.getElementsByTagName("script")[0];firstScript.parentNode.insertBefore(script,firstScript)}var bluecoreSitePublic=function(){};window.__INIT_ONSITE=function(e){if(!("number"!=typeof e||e>500))if("object"==typeof window.triggermail&&"object"==typeof window.triggermail.Partner&&"function"==typeof triggermail.lytics.get_config){var t={set:function(e,t){try{if(g.validateKey(e))return!!g.validateKey(window.Storage)&&(localStorage.setItem(e,t),!0)}catch(e){return!1}},get:function(e){try{if(g.validateKey(e)&&g.validateKey(localStorage.getItem(e)))return localStorage.getItem(e)}catch(e){return!1}},remove:function(e){try{if(g.validateKey(e)&&g.validateKey(localStorage.getItem(e)))return localStorage.removeItem(e),!0}catch(e){return!1}}},r=null,i={set:function(e,t){try{if(g.validateKey(e))return!!g.validateKey(window.Storage)&&(sessionStorage.setItem(e,t),!0)}catch(e){return!1}},get:function(e){try{if(g.validateKey(e)&&g.validateKey(sessionStorage.getItem(e)))return sessionStorage.getItem(e)}catch(e){return!1}},remove:function(e){try{if(g.validateKey(e)&&g.validateKey(sessionStorage.getItem(e)))return sessionStorage.removeItem(e),!0}catch(e){return!1}}},n={set:function(e,r,i,n){try{g.checkStorage()?t.set(e,r):a.set(e,r,i,n)}catch(t){a.set(e,r,i,n)}},get:function(e){try{return g.checkStorage()?g.validateKey(t.get(e))?t.get(e):"":g.validateKey(a.get(e))?a.get(e):""}catch(t){return g.validateKey(a.get(e))?a.get(e):""}},remove:function(e){try{g.checkStorage()?t.remove(e):a.remove(e)}catch(e){}},checkExpire:function(e,r){try{var i=g.checkVariableType(t.get(e))?t.get(e):"";if(g.checkVariableType(i)){i=bcQuery.parseJSON(i);var n=parseInt(i.t);return"Number"===g.checkVariableType(n)?(Date.now()-n)/1e3/60>=r?(t.remove(e),{data:"",flag:!1}):{data:i.d,flag:!0}:(t.remove(e),{data:"",flag:!1})}return t.remove(e),{data:"",flag:!1}}catch(r){return t.remove(e),{data:"",flag:!1}}},checkJourneyExpire:function(e,r){function i(e,t){return{data:t||"",flag:e}}try{var n=g.getDataFromLocalStorage(e);if("String"===g.checkVariableType(n)){n=bcQuery.parseJSON(n);var a=n[r];if(!a)return i(!1,null);if(-1===parseInt(a.expireDaysCount))return i(!0,a.journeyId);var o=parseInt(a.expireTime);return"Number"===g.checkVariableType(o)?Date.now()>=o?(delete n[r],t.set(e,JSON.stringify(n),0,5e5),i(!1,null)):i(!0,a.journeyId):(delete n[r],t.set(e,JSON.stringify(n),0,5e5),i(!1,null))}return i(!1,null)}catch(a){return n[r]&&(delete n[r],t.set(e,JSON.stringify(n),0,5e5)),i(!1,null)}}},a={set:function(e,t,r,i,a){try{var o="",c=i,u=new Date;if(c?u.setMinutes(u.getMinutes()+c):u.setDate(u.getDate()+r),a){var s=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),p=s?s[0]:"";o=p?"; domain=."+p:"",n.set(e,JSON.stringify({d:t,t:Date.now()}),0,5e5)}var d=escape(t)+(null===r?"":"; expires="+u.toGMTString())+"; path=/"+o;document.cookie=e+"="+d}catch(e){v.d("bluecoreSite_cookies set "+e,l.warning)}},get:function(e){try{var t=null,r=null,i=null,n=document.cookie.split(";");for(t=0;t<n.length;t++)if(r=n[t].substr(0,n[t].indexOf("=")),i=n[t].substr(n[t].indexOf("=")+1),(r=g.trimStr(r))===e)return unescape(i)}catch(e){v.d("bluecoreSite_cookies get "+e,l.warning)}},remove:function(e){try{a.set(e,"",0,-1)}catch(e){v.d("bluecoreSite_cookies remove "+e,l.warning)}}},o={DB_MODE:{READ_ONLY:"readonly",READ_WRITE:"readwrite",DBVERSION:2},DBNAME:"bc-"+triggermail.lytics.get_config("token"),DBConnectionObject:null,clientSchema:{sessionDetails:[],userLifeTime:[],campaignDetails:[]},util:{oneTimeTable:["sessionDetails","userLifeTime","campaignDetails"],keys:["sessionId","userId","campaignId"],SingleTableDataLimit:100},initDB:function(){return new Promise(function(e,t){try{o.makeDBConnection()&&(r.onerror=function(e){},r.onsuccess=function(t){try{o.DBConnectionObject=t.target.result,e(1)}catch(e){}},r.onupgradeneeded=function(e){try{o.DBConnectionObject=e.target.result;var t=null,r=null,i=null;if(0!==e.oldVersion){for(var n=o.DBConnectionObject.objectStoreNames,a={},c=0;c<n.length;c++){t=e.currentTarget.transaction.objectStore(n.item(c));var l=t.indexNames;a[n.item(c)]=[];for(var u=0;u<l.length;u++)"timestamp"!==l.item(u)&&a[n.item(c)].push(l.item(u))}var s=Object.keys(a),p=Object.keys(o.clientSchema),d=s.filter(function(e){return!g.includes(e,p)}),m=p.filter(function(e){return!g.includes(e,s)});for(var f in d)"String"===g.checkVariableType(d[f])&&o.DBConnectionObject.deleteObjectStore(d[f]);for(var y in m)"String"===g.checkVariableType(m[y])&&(r="campaignDetails"!==m[y]?o.DBConnectionObject.createObjectStore(m[y],{keyPath:o.util.keys[y],autoIncrement:!0}):o.DBConnectionObject.createObjectStore(m[y],{keyPath:o.util.keys[y]}),o.clientSchema[m[y]].length>0&&(i=o.clientSchema[m[y]],i.map(function(e){r.createIndex(e,e,{unique:!1})})));for(var h in o.clientSchema)if("Array"===g.checkVariableType(o.clientSchema[h])&&void 0!==a[h]){var b=a[h].filter(function(e){return!g.includes(e,o.clientSchema[h])}),v=o.clientSchema[h].filter(function(e){return!g.includes(e,a[h])});b.forEach(function(r){t=e.currentTarget.transaction.objectStore(h),t.deleteIndex(r)}),v.forEach(function(r){t=e.currentTarget.transaction.objectStore(h),t.createIndex(r,r)})}}else for(var _ in o.util.oneTimeTable)"String"===g.checkVariableType(o.util.oneTimeTable[_])&&(r="campaignDetails"!==o.util.oneTimeTable[_]?o.DBConnectionObject.createObjectStore(o.util.oneTimeTable[_],{keyPath:o.util.keys[_],autoIncrement:!0}):o.DBConnectionObject.createObjectStore(o.util.oneTimeTable[_],{keyPath:o.util.keys[_]}),o.clientSchema[o.util.oneTimeTable[_]].length>0&&(i=o.clientSchema[o.util.oneTimeTable[_]],i.map(function(e){r.createIndex(e,e,{unique:!1})})))}catch(e){}})}catch(e){}})},getData:function(e,t,r,i,n,a,c){var l=t||null,u=r||null,s=i||null,p=n||null,d=a||null,m=c||null,f=null;return new Promise(function(t,i){try{var n=o.DBConnectionObject.transaction([e],o.DB_MODE.READ_ONLY),a=n.objectStore(e),c=[];if(g.validateKey(l))if(null!==d)f=IDBKeyRange.lowerBound(l),a.openCursor(f).onsuccess=function(e){try{var r=e.target.result;r?(c.push(r.value),r.continue()):t(c)}catch(e){t(!1)}};else if(null!==m)f=IDBKeyRange.upperBound(l),a.openCursor(f).onsuccess=function(e){try{var r=e.target.result;r?(c.push(r.value),r.continue()):t(c)}catch(e){t(!1)}};else{var y=a.get(l);y.onsuccess=function(e){try{c=y.result,null!==r?(Object.keys(c).forEach(function(e){!1===g.includes(e,u)&&delete c[e]}),t(c)):t(c)}catch(e){t(!1)}}}else if(g.validateKey(s))a.openCursor(null,"prev").onsuccess=function(e){try{var r=e.target.result,i=null;r&&(i=r.value),g.validateKey(u)&&g.validateKey(i)?(Object.keys(i).forEach(function(e){!1===g.includes(e,u)&&delete i[e]}),t(i)):t(i)}catch(e){t(!1)}};else if(g.validateKey(p))a.openCursor().onsuccess=function(e){try{var r=e.target.result,i=null;r&&(i=r.value),g.validateKey(u)?(Object.keys(i).forEach(function(e){!1===g.includes(e,u)&&delete i[e]}),t(i)):t(i)}catch(e){t(!1)}};else{var h=[];a.openCursor().onsuccess=function(e){try{var r=e.target.result,i=null;r?(i=r.value,g.validateKey(u)?(Object.keys(i).forEach(function(e){!1===g.includes(e,u)&&delete i[e]}),h.push(i)):h.push(i),r.continue()):t(h)}catch(e){t(!1)}}}}catch(e){}})},setData:function(e,t,r,i){try{var n=r||null,a=i||null,c=o.DBConnectionObject.transaction([e],o.DB_MODE.READ_WRITE),l=c.objectStore(e);if(g.validateKey(n)){var u=l.get(a);u.onsuccess=function(e){try{var r=u.result;"Object"===g.checkVariableType(r)&&(Object.keys(r).forEach(function(e,i){g.includes(e,n)&&(r[e]=t[e])}),l.put(r),r=null)}catch(e){}}}else{l.put(t).onsuccess=function(t){try{o.deleteDataBasedOnLimit(e)}catch(e){}}}}catch(e){}},deleteDataBasedOnLimit:function(e){try{var t=o.DBConnectionObject.transaction([e],o.DB_MODE.READ_WRITE),r=t.objectStore(e),i=r.count();i.onsuccess=function(t){try{if(i.result>o.util.SingleTableDataLimit){var n=i.result-o.util.SingleTableDataLimit-1;r.openCursor().onsuccess=function(t){try{var r=t.target.result;r&&(o.deleteByKey(e,r.key),0!==n&&(n--,r.continue()))}catch(e){}}}}catch(e){}}}catch(e){}},deleteByKey:function(e,t){try{var r=o.DBConnectionObject.transaction([e],o.DB_MODE.READ_WRITE),i=r.objectStore(e);t&&i.delete(t)}catch(e){}},makeDBConnection:function(){try{return r=window.indexedDB.open(o.DBNAME,o.DB_MODE.DBVERSION),!0}catch(e){return!1}}},c={_user_agent:window.navigator.userAgent.toLowerCase(),ios_bluecore:function(){return c.iphone_bluecore()||c.ipod_bluecore()||c.ipad_bluecore()},iphone_bluecore:function(){return c._find_bluecore("iphone")},ipod_bluecore:function(){return c._find_bluecore("ipod")},ipad_bluecore:function(){return c._find_bluecore("ipad")},android_bluecore:function(){return c._find_bluecore("android")},androidTablet_bluecore:function(){return c.android_bluecore()&&!c._find_bluecore("mobile")},windows_bluecore:function(){return c._find_bluecore("windows")},windowsPhone_bluecore:function(){return c.windows_bluecore()&&c._find_bluecore("phone")},windowsTablet_bluecore:function(){return c.windows_bluecore()&&c._find_bluecore("touch")},portrait_bluecore:function(){return window.innerHeight/window.innerWidth>1},landscape_bluecore:function(){return window.innerHeight/window.innerWidth<1},_find_bluecore:function(e){return-1!==c._user_agent.indexOf(e)},getDeviceInfo_bluecore:function(){return c.ios_bluecore()?c.ipad_bluecore()?"tablet":c.iphone_bluecore()?"phone":c.ipod_bluecore()?"phone":void 0:c.android_bluecore()?c.androidTablet_bluecore()?"tablet":"phone":c.windows_bluecore()?c.windowsTablet_bluecore()?"tablet":c.windowsPhone_bluecore()?"phone":"desktop":"desktop"},deviceName:function(){try{return c.getDeviceInfo_bluecore()||"onName"}catch(e){v.d("deviceName "+e,l.warning)}},systemInfo:function(){try{var e,t=navigator.appVersion,r=!!/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(t);return screen.width&&(e=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")),{screen:e||"",browser:triggermail.lytics._.info.browser(),mobile:r,os:triggermail.lytics._.info.os(),device:c.deviceName()||"",landscape:c.landscape_bluecore()||"",portrait:c.portrait_bluecore()||""}}catch(e){return{screen:"no_name",browser:"no_name",mobile:!1,os:"no_name",device:"no_name"}}}},l={critical:"critical",error:"error",warning:"warning",info:"info",debug:"debug"},u={mobile:"mobile",desktop:"desktop"},s={view:"view",click:"click",close:"close"},p={partnerNamespace:triggermail.lytics.get_config("token")||"",userDistinctId:triggermail.lytics.get_property("distinct_id")||"",userInputEmail:null,logLimit:30,source_detail:"bluecore_site",event_source:"onsite",apiCacheTime:60,templateTypes:{popup:!0,prefcenter:!0,fullPage:!0,infoBar:!0,AB:!1,popupShow:!1,fullPageShow:!1},hasNotSeenAnyCampaign:!0,isActionTriggerCampaign:!1,activeCampaignArray:{prefcenter:[],popup:[],infoBar:[],fullPage:[],AB:[]},bluecorePopupDisplayView:"bluecoreUpperLeftPopup",bluecoreInfobarDisplayView:"bluecore-top-sticky-widget",bluecoreDeviceInfo:{},isLoadingComplete:!0,isSiteDataLoaded:!0,commonCssFlag:!0,loadEnable:!1,targetingConditionSingleResult:[],targetingConditionJoinResult:[],suppressionConditionJoinResult:[],globalSessionDetailCurrent:null,globalSessionDetail:null,globalLifetimeDetail:null,globalCampaignDetail:null,ABExpiryDate:new Date,viewedCampaignListThisPage:[],location:{ip:"",state:"",country:"",countryCode:"",city:""},audience:{audience:[],Product:[]},campaignAttributeMapping:{},campaignTargetingResult:{},technologyTimeCriteria:null,technologyTimerIteration:26,technologyTimerMaxLimit:5,retryFailThreshold:null,timeToWait:null,isRegisterUniteHandler:!1,globalCampaignId:null,globalType:null,recsProductClickId:"",abGoalId:"4ba1",supportedCampaignType:["popup","fullpage","inline","infobar","prefcenter"],campaignPublicEvents:["views","clicks","close"],targetingUrlExpireTime:10,sendRequest:function(e,t,r,i){return new Promise(function(n,a){try{bcQuery.ajax({url:e,data:t,type:i||"GET",timeout:r||1e3,success:function(e){n(e)},error:function(e){a(!1)}})}catch(e){a(!1)}})}},d={API:{recs:"/recs",p2p:"/p2p",campaignJson:"/dj",randomizer:"/randomizer",duplicateEmail:"/duplicate_email",fetchpromo:"/fetchpromo"},GCS_ENDPOINT:"https://storage.googleapis.com/site_campaigns/",ENDPOINT:"https://onsite.bluecore.com",ONSITE_CAMPAIGN_STATS:"https://onsitestats.bluecore.com/analytics",ONSITE_ERROR:"https://onsitestats.bluecore.com/log",ONSITE_TARGETING_URL:"https://storage.googleapis.com/bluecore_onsite/"+p.partnerNamespace+"_onsite.json",ONSITE_AB_TARGETING_URL:"https://storage.googleapis.com/bluecore_onsite/"+p.partnerNamespace+"/journey/",ONSITE_IP_LOCATION:"https://onsite.bluecore.com/location",ONSITE_AUDIENCE:"https://onsite.bluecore.com/audience",ONSITE_BCQUERY:"https://cdn.bluecore.com/falcon/assets/targeting/bcQuery.js",WELCOME_EMAIL:"https://api.bluecore.com/api/email/welcome_series/",PROJECTSETTINGDATA:{},INSTANCENAME:"bluecore-v2.0 ",APIURL:function(e){try{return this.ENDPOINT+this.API[e]}catch(e){}},GCSURL:function(e){try{return this.GCS_ENDPOINT+p.partnerNamespace+"/campaigns/"+e+".json"}catch(e){}}},g={operators:{greaterThan:"greaterThan",lessThan:"lessThan",equalTo:"equalTo",notEqual:"notEqual",contains:"contains",notContains:"notContains",between:"between",onBefore:"onBefore",onAfter:"onAfter",exists:"exists",notExist:"notExist",isTrue:"isTrue",isFalse:"isFalse"},plugins:{emailCapture:"email_capture",recs:"recs"},invalidateUrlCache:function(e,t,r){try{var i="bc_invalidateUrlCache_"+t,n=a.get(i);if(n)e+="?"+n.toString();else{var o=+new Date;a.set(i,o,0,r),e+="?"+o.toString()}return e}catch(e){v.d("invalidateUrlCache "+e)}},eventDataBuilder:function(e,t,r,i){try{var n={};return n.email=triggermail.lytics.get_property("email")||p.userInputEmail||null,n.campaignID=e||"",n.journeyID=p.campaignAttributeMapping[e].journeyId||"",n.abID=p.campaignAttributeMapping[e].abId||"",n.customerData=t||{},n.couponCode=p.campaignAttributeMapping[e].coupon_code||"",n.campaignName=p.campaignAttributeMapping[e].campaignName||"",n.ipAddress=p.location.ip||"",n.countryCode=p.location.countryCode||"",n.screenChangeFrom=r||"",n.screenChangeTo=i||"",n}catch(e){v.d("eventDataBuilder "+e,l.warning)}},trackCTAClick:function(e){bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureButton").one("click",function(){g.custom_event_record("CTAEngaged",g.eventDataBuilder(e,null,null,null))})},copyToClipboardRegister:function(e){var t=!0;bcQuery("[referenceId="+e+"] .bluecoreCouponCTC").off("click").on("click",function(r){try{if(t){t=!1,g.copyToClipboard(bcQuery("[referenceId="+e+"] .bluecoreCouponBox")[0]);var i=bcQuery("[referenceId="+e+"] .bluecoreCouponBox").text();bcQuery("[referenceId="+e+"] .bluecoreCouponBox").text("copied!"),setTimeout(function(){t=!0,bcQuery("[referenceId="+e+"] .bluecoreCouponBox").text(i)},1e3)}}catch(e){}})},screenTransitionListener:function(e,t){bcQuery("[referenceId="+e+"] .bluecoreIntroScreen .bluecoreEmailCaptureIntroSubmit").one("click",function(r){S.processCouponCode(e,null,".bluecoreActionScreen",null,t).then(function(t){t&&bcQuery("[referenceId="+e+"] .bluecoreIntroScreen").fadeOut(1e3,function(){bcQuery("[referenceId="+e+"] .bluecoreActionScreen").fadeIn(1e3,function(){g.copyToClipboardRegister(e)}),bcQuery("[referenceId="+e+"] .bluecoreIntroScreen").remove()})}).catch(function(e){}),g.custom_event_record("screenChange",g.eventDataBuilder(e,null,"bluecoreIntroScreen","bluecoreActionScreen"))}),bcQuery("[referenceId="+e+"] .bluecoreActionScreen .bluecoreEmailCaptureIntroSubmit").one("click",function(r){S.processCouponCode(e,null,".bluecoreConfirmationScreen",null,t).then(function(t){t&&(bcQuery("[referenceId="+e+"] .bluecoreActionScreen").fadeOut(1e3,function(){bcQuery("[referenceId="+e+"] .bluecoreConfirmationScreen").fadeIn(1e3,function(){g.copyToClipboardRegister(e)}),bcQuery("[referenceId="+e+"] .bluecoreActionScreen").remove()}),g.custom_event_record("screenChange",g.eventDataBuilder(e,null,"bluecoreActionScreen","bluecoreConfirmationScreen")))}).catch(function(e){})}),bcQuery("[referenceId="+e+"] .bluecoreConfirmationScreen .bluecoreEmailCaptureIntroSubmit").one("click",function(t){bcQuery("[referenceId="+e+"] .bluecoreConfirmationScreen").fadeOut(1e3,function(){bcQuery("[referenceId="+e+"] .bluecoreCloseButton").trigger("click")}),g.custom_event_record("screenChange",g.eventDataBuilder(e,null,"bluecoreConfirmationScreen","bluecoreCloseScreen"))})},closeCampaignOnEscape:function(e){bcQuery(document).on("keyup",function(t){if("Escape"===t.key&&bcQuery(e).length){var r=bcQuery(e).attr("referenceId");bcQuery("[referenceId="+r+"] .bluecoreCloseButton").length&&bcQuery("[referenceId="+r+"] .bluecoreCloseButton").trigger("click")}})},daysToHours:function(e){try{var t=Number(e);return t>0&&"Number"===g.checkVariableType(t)?24*e:0}catch(e){return v.d("daysToHours "+e,l.warning),0}},arrangePriority:function(e){try{return"Array"===g.checkVariableType(e)?e.sort(function(e,t){return e.priority-t.priority}):[]}catch(e){v.d("arrangePriority "+e,l.warning)}},millisecondToHour:function(e){try{var t=parseInt(e);return t>0&&"Number"===g.checkVariableType(t)?(Date.now()-parseInt(e))/1e3/60/60:0}catch(e){v.d("millisecondToHour "+e,l.warning)}},millisecondToMinutes:function(e){try{var t=parseInt(e);return t>0&&"Number"===g.checkVariableType(t)?(Date.now()-parseInt(e))/1e3/60:0}catch(e){v.d("millisecondToHour "+e,l.warning)}},getTimeStampWithTime:function(e){try{if("String"===g.checkVariableType(e)){var t=new Date(e),r=new Date;return r.setHours(t.getHours()),r.setMinutes(t.getMinutes()),r.setSeconds(t.getSeconds()),r.valueOf()}return(new Date).valueOf()}catch(e){v.d("getTimeStampWithTime "+e,l.warning)}},mergeObject:function(){try{for(var e={},t=arguments.length,r=0;r!==t;){var i=arguments[r];for(var n in i)""!==i[n]&&"undefined"!==i[n]&&null!==i[n]&&(e[n]=i[n]);r++}return e}catch(e){v.d("mergeObject "+e,l.warning)}},validateKey:function(e){return void 0!==e&&"undefined"!==e&&null!==e&&""!==e},trimStr:function(e){try{return g.validateKey(e)&&"String"===g.checkVariableType(e)?"Function"===g.checkVariableType(e.trim)?e.trim():e.replace(/^\s+|\s+$/g,""):""}catch(e){return""}},checkVariableType:function(e){try{return Object.prototype.toString.call(e).split(" ")[1].slice(0,-1)}catch(e){return!1}},isJsonString:function(e){try{return"Object"===g.checkVariableType(e)||"String"===g.checkVariableType(e)&&(JSON.parse(e),!0)}catch(e){return!1}},includes:function(e,t){try{for(var r=t.length,i=0;i<r;i++)if(t[i]===e)return!0;return!1}catch(e){return!1}},getReferrer:function(e){try{return e?document.referrer.match(document.location.host)?String(document.referrer):"direct":String(document.referrer)||"direct"}catch(e){return!1}},getSessionCount:function(){try{return new Promise(function(e,t){o.getData("sessionDetails").then(function(t){e(g.validateKey(t)&&t.length>0?t.length||1:1)})})}catch(e){resolve(1)}},getVisitCount:function(){return new Promise(function(e,t){try{o.getData("userLifeTime",null,null,!0,null).then(function(t){g.validateKey(t)&&!g.isEmptyObject(t)?"yes"===i.get("bluecoreSiteFirstVisit")?(a.set("bluecoreNV","false",0,5e5),e(parseInt(t.totalVisitCount)+1||1)):e(parseInt(t.totalVisitCount)||1):e(1),i.set("bluecoreSiteFirstVisit","no")})}catch(t){v.d("getVisitCount "+t,l.warning),e(null)}})},getPageViewCount:function(){return new Promise(function(e,t){try{o.getData("userLifeTime",null,null,!0,null).then(function(t){e(g.validateKey(t)&&!g.isEmptyObject(t)?t.totalPageViewCount?t.totalPageViewCount?t.totalPageViewCount+1:1:0===t.totalPageViewCount?t.totalPageViewCount+1:1:1)})}catch(t){v.d("getPageViewCount "+t,l.warning),e(1)}})},getTimeSpan:function(){return new Promise(function(e,t){try{o.getData("userLifeTime",null,null,!0,null).then(function(t){if(g.validateKey(t)&&!g.isEmptyObject(t))if(g.validateKey(n.get("bluecoreSiteT"))){var r=parseInt(n.get("bluecoreSiteT"))?(parseInt(n.get("bluecoreSiteT"))||0)+(parseInt(t.totalTimeSpan)||0):parseInt(t.totalTimeSpan)||0;n.set("bluecoreSiteT",0,0,5e5),e(r)}else e(t.totalTimeSpan||0);else n.set("bluecoreSiteT",0,0,5e5),e(0)})}catch(t){v.d("getTimeSpan "+t,l.warning),e(0)}})},checkStorage:function(){return"localStorage"in window&&null!==localStorage},isEmail:function(e){try{return/^\w+([A-Za-z0-9(\.!#$%&'*+\-\/?^_`{|}~)]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,6})+$/.test(e)}catch(e){return!1}},getObem:function(){try{var e=triggermail.util.getUrlParam("obem");return g.validateKey(e)?e:""}catch(e){return""}},commonCssLoad:function(){try{p.commonCssFlag&&(g.addStyleSheet(),p.commonCssFlag=!1)}catch(e){v.d("commonCssLoad "+e,l.warning)}},addStyleSheet:function(){try{bcQuery("body").append('<style class="bluecoreApiCss">.bluecore_prefcenter{border:0;width:100%;height:100%;position:fixed;top:0;left:0;z-index:30;background-color:transparent}.bluecoreInlinePreferenceCenter{border:0;width:100%;height:100%;position:relative;z-index:30;background-color:transparent}.bcore-ctaBox{position:relative!important;clear:both}.bluecoreRecomInline{position:relative;width:100%;padding:0;margin:0;display:inline-block;clear:both}.boutSlider_ms-touch.slider{overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;-ms-scroll-chaining:none;-ms-scroll-snap-type:mandatory;-ms-scroll-snap-points-x:snapInterval(0%,100%)}.boutSlider_animate{transition:transform .3s ease-out}.bluecoreOverlay{background-color:transparent;height:100%!important;left:0!important;opacity:.8;position:fixed!important;right:0!important;width:100%!important;z-index:9999999!important;top:0!important}.bluecoreCloseButton{float:right;margin-right:2%;position:relative;transform:translateX(-50%);cursor:pointer}.bluecore-top-sticky-widget{height:auto;position:fixed;width:100%;z-index:999998;top:0;left:0;right:0;text-align:center}.bluecore-bottom-sticky-widget{height:auto;position:fixed;width:100%;z-index:999998;bottom:0;left:0;right:0;text-align:center}.bluecore-top-sticky-preWidget{height:50px;position:fixed;width:100%;z-index:99998;top:-99em;left:-99em}.bluecore-top-sticky-widget .bluecoreCloseButton{top:25%}.bluecore-bottom-sticky-widget .bluecoreCloseButton{top:25%}.bluecore-center{text-align:center;margin:0 5%}.bluecoreFullScreen .bluecore-center{padding-top:5%}.bluecoreFullScreen{position:fixed;width:100%;height:100vh;background:transparent;z-index:9999999;top:0;left:0;right:0;bottom:0;}.bluecore-full-preScreen{position:absolute;width:100%;height:100vh;background:transparent!important;z-index:100;padding-top:2%;left:-99em;top:-999em;}.bluecoreUpperLeftPopup{z-index:99999999;position:fixed;top:0;left:0}.bluecoreUpperMiddlePopup{z-index:99999999;position:fixed;top:0;left:50%;transform:translateX(-50%)}.bluecoreUpperRightPopup{z-index:99999999;position:fixed;top:0;right:0}.bluecoreLowerLeftPopup{z-index:99999999;position:fixed;bottom:0;left:0}.bluecoreLowerRightPopup{z-index:99999999;bottom:0;right:0;position:fixed}.bluecoreMiddleCenterPopup{z-index:99999999;position:fixed;transform:translate(-50%,-50%);top:50%;left:50%}.bluecoreMiddleRightPopup{z-index:99999999;top:50%;right:0;position:fixed;transform:translateY(-50%)}.bluecoreMiddleLeftPopup{z-index:99999999;top:50%;left:0;position:fixed;transform:translateY(-50%)}.bluecoreLowerMiddlePopup{z-index:99999999;bottom:0;left:50%;position:fixed;transform:translateX(-50%)}</style>')}catch(e){v.d("addStyleSheet "+e,l.warning)}},isEmptyObject:function(e){try{if("Object"===g.checkVariableType(e)){var t;for(t in e)return!1;return!0}return!0}catch(e){v.d("isEmptyObject "+e,l.warning)}},addJavascript:function(e,t){try{if(-1!==e.indexOf("bcQuery.js")&&"function"==typeof bcQuery)t();else{var r=document.createElement("script");r.type="application/javascript",r.src=e,r.onload=function(){t()},document.body.appendChild(r)}}catch(e){v.d("addJavascript "+e,l.warning)}},calculateSingleRuleResult:function(e,t,r){try{var i=t.join("");if(r){if(0===i.length)return"AND"===r?1:0;if("AND"===e)return i.indexOf(0)>=0?0:1;if("OR"===e)return i.indexOf(1)>=0?1:0}if("AND"===e)return 0===i.length?1:i.indexOf(0)>=0?0:1;if("OR"===e)return 0===i.length||i.indexOf(1)>=0?1:0}catch(e){return 0}},evaluateExpression:function(e){try{var t="var res = "+e+";return res";return new Function(t)}catch(e){return v.d("evaluateExpression "+e,l.warning),""}},fetchLocation:function(){try{var e=n.checkExpire("bluecoreSiteUserLocation",p.apiCacheTime),t=!1;if(e.flag&&g.isJsonString(e.data)?(e=e.data,p.location.city=e.city||"",p.location.countryCode=e.country_code||"",p.location.state=e.subdivision||"",p.location.ip=e.ip||""):t=!0,t){var r=g.mergeObject({ns:p.partnerNamespace},b.getUser());p.sendRequest(d.ONSITE_IP_LOCATION,r).then(function(e){try{var t=bcQuery.parseJSON(e);if(g.isJsonString(t.data,"fetchTargetingBase")){var r=t.data;p.location.city=r.city||"",p.location.countryCode=r.country_code||"",p.location.state=r.subdivision||"",p.location.ip=r.ip||"",n.set("bluecoreSiteUserLocation",JSON.stringify({d:r,t:Date.now()}),0,5e5)}}catch(e){v.d("error in location Get "+e)}}).catch(function(e){})}}catch(e){v.d("error in location Get "+e,l.warning),p.location.city="",p.location.countryCode="",p.location.state="",p.location.ip=""}},fetchAudience:function(){try{var e=n.checkExpire("bluecoreSiteAudience",p.apiCacheTime),t=!1;if(e.flag&&g.isJsonString(e.data)?(e=e.data,p.audience.audience=e.data.audience||"",p.audience.Product=e.data.Product||""):t=!0,t){var r=g.mergeObject({ns:p.partnerNamespace},b.getUser());p.sendRequest(d.ONSITE_AUDIENCE,r).then(function(e){try{if(g.isJsonString(e)){var t=e;200===t.request_status&&(p.audience.audience=t.data.audience||"",p.audience.Product=t.data.Product||"",n.set("bluecoreSiteAudience",JSON.stringify({d:t,t:Date.now()}),0,5e5))}_.projectSetting()}catch(e){v.d("fetchAudience ONSITE_AUDIENCE Details "+e)}}).catch(function(e){})}else _.projectSetting()}catch(e){p.audience.audience="",p.audience.Product="",v.d("error in audience Get "+e,l.warning)}},fetchJourney:function(e,t){try{var r=n.checkJourneyExpire(e,t);return r.flag?r.data:""}catch(e){return v.d("error in fetch journey Get "+e,l.warning),""}},stampJourney:function(e,r,i,n){try{var a=g.getDataFromLocalStorage(e),o={};o.journeyId=i,o.expireTime=Date.now()+24*n*60*60*1e3,o.expireDaysCount=n,void 0!==a?(a=bcQuery.parseJSON(a),a[r]=o):(a={},a[r]=o),t.set("bluecoreSiteJourney",JSON.stringify(a),0,5e5)}catch(e){v.d("error in stamp journey Get "+e,l.warning)}},updateJourneyExpiryDate:function(e,r,i,n){try{var a=g.getDataFromLocalStorage(e);if(void 0===a||""===a)return void g.stampJourney(e,r,i,n);a=JSON.parse(a);var o=a[r].expireTime,c=a[r].expireDaysCount;"Object"===g.checkVariableType(a)&&(o-=24*c*60*60*1e3,o+=24*n*60*60*1e3,a[r].expireTime=o,a[r].expireDaysCount=n),t.set("bluecoreSiteJourney",JSON.stringify(a),0,5e5)}catch(e){v.d("updateJourneyExpiryDate "+e,l.warning)}},getDeviceType:function(){try{return p.bluecoreDeviceInfo.mobile?"mobile":"desktop"}catch(e){return"desktop"}},fetchEndPointName:function(e,t,r,i){if(e)return d.APIURL(e);var n=t;if("Array"===g.checkVariableType(n)){if(g.includes(g.plugins.recs,n)){var a=p.campaignAttributeMapping[i].recType;return!!a&&d.APIURL("recs")+"/"+a}return"static"===r?d.GCSURL(i):d.APIURL("campaignJson")}return"static"===r?d.GCSURL(i):d.APIURL("campaignJson")},campaignShowWithInADay:function(e){try{var t={startTime:new Date((new Date).setHours(0,0,0,0)).valueOf(),endTime:new Date((new Date).setHours(23,59,59,99)).valueOf()},r=p.globalCampaignDetail;if("Array"===g.checkVariableType(r)&&r.length){var i=null,n=r.filter(function(t){if(void 0!==t)return t.campaignId===String(e)});if(n.length>0&&void 0!==n[0]&&g.validateKey(n[0].campaignId)&&(i=n[0].showSessionId||[]),i&&i.length>0){var a=t.startTime,o=t.endTime,c=0;return i.forEach(function(e){a<e&&o>e&&c++}),c}return 0}return 0}catch(e){return 0}},custom_event_record:function(e,t){try{"function"==typeof bluecore_custom_event&&(t.eventName=e,bluecore_custom_event(t))}catch(e){}},copyToClipboard:function(e){try{var t,r,i="_hiddenCopyText_",n="INPUT"===e.tagName||"TEXTAREA"===e.tagName;if(n)a=e,t=e.selectionStart,r=e.selectionEnd;else{
if(!(a=document.getElementById(i))){var a=document.createElement("textarea");a.style.position="absolute",a.style.left="-9999px",a.style.top="0",a.id=i,document.body.appendChild(a)}a.textContent=e.textContent}var o=document.activeElement;a.focus(),a.setSelectionRange(0,a.value.length);var c;try{c=document.execCommand("copy")}catch(e){c=!1}return o&&"function"==typeof o.focus&&o.focus(),n?e.setSelectionRange(t,r):a.textContent="",bcQuery("#"+i).remove(),c}catch(e){}},stampingABJourney:function(e){},dateSchedule:function(e,t,r,i){try{var n=new Date(e).valueOf(),a=new Date(t).valueOf();if(r===g.operators.greaterThan)n<a?h.saveSuppressionRuleCondition(1):h.saveSuppressionRuleCondition(0);else if(r===g.operators.lessThan)a<n?h.saveSuppressionRuleCondition(1):h.saveSuppressionRuleCondition(0);else if(r===g.operators.equalTo)n===a?h.saveSuppressionRuleCondition(1):h.saveSuppressionRuleCondition(0);else if(r===g.operators.between){var o=Date.now();if("String"===g.checkVariableType(e)&&"String"===g.checkVariableType(t)){var c=new Date(e),u=new Date(t),s=new Date,p=new Date;s.setHours(c.getHours()),s.setMinutes(c.getMinutes()),s.setSeconds(c.getSeconds()),p.setHours(u.getHours()),p.setMinutes(u.getMinutes()),p.setSeconds(u.getSeconds());var d=s.valueOf(),m=p.valueOf();o>d&&o<m?h.saveSuppressionRuleCondition(1):h.saveSuppressionRuleCondition(0)}else h.saveSuppressionRuleCondition(0)}else h.saveSuppressionRuleCondition(0)}catch(e){h.saveSuppressionRuleCondition(0),v.d("dateSchedule "+e,l.warning)}},campaignInteracted:function(e,t,r){try{var i=t||null,n=p.globalCampaignDetail,a=!1;if(n&&n.length>0){if(null===i){for(var o=0;o<n.length;o++){var c=g.millisecondToHour(n[o][r]);if(e.operator===g.operators.greaterThan){if(c>g.daysToHours(e.value)){a=!0;break}}else if(e.operator===g.operators.lessThan){if(c<g.daysToHours(e.value)){a=!0;break}}else if(e.operator===g.operators.equalTo&&c===g.daysToHours(e.value)){a=!0;break}}a?h.saveRuleCondition(1):h.saveRuleCondition(0)}else if(g.validateKey(i)){var u=n.filter(function(e){return e.campaignId===String(i)});if(1===u.length){u=u[0];var c=g.millisecondToHour(u[r]);e.operator===g.operators.greaterThan?c>g.daysToHours(e.value)?h.saveRuleCondition(1):h.saveRuleCondition(0):e.operator===g.operators.lessThan?c<g.daysToHours(e.value)?h.saveRuleCondition(1):h.saveRuleCondition(0):e.operator===g.operators.equalTo&&(c===g.daysToHours(e.value)?h.saveRuleCondition(1):h.saveRuleCondition(0))}else h.saveRuleCondition(0)}}else h.saveRuleCondition(0)}catch(e){v.d("CampaignInteracted "+e,l.error),h.saveRuleCondition(0)}},keyOccurrencesInArray:function(e){try{var t={};return"Array"===g.checkVariableType(e)&&e.length>0?(e.forEach(function(e){void 0!==t[e]?t[e]=t[e]+1||0:t[e]=1}),t):null}catch(e){return null}},getCampaignsInThisSession:function(e){try{var t={viewed:"showSessionId",closed:"closeSessionId",engaged:"clickSessionId"},r=p.globalSessionDetailCurrent.sessionId,i=p.globalCampaignDetail,n=[],a=[],o={};return t[e]&&"Array"===g.checkVariableType(i)&&i.length&&(n=i.filter(function(i){if(g.includes(r,i[t[e]]))return i}),n.forEach(function(i){void 0!==i&&(a=g.keyOccurrencesInArray(i[t[e]]),o[i.campaignId]=a[r]||0)})),o}catch(e){}},getCampaignsAllTime:function(e){try{var t={viewed:"showCount",closed:"closeCount",engaged:"clickCount"},r=p.globalCampaignDetail,i={};return"Array"===g.checkVariableType(r)&&r.length&&t[e]&&r.map(function(r){void 0!==r&&g.validateKey(r.campaignId)&&(i[r.campaignId]=r[t[e]])}),i}catch(e){}},getCampaignsInThisVisit:function(e){try{var t={viewed:"totalShow",closed:"totalClose",engaged:"totalClick"},r={viewed:"campaignShowArr",closed:"campaignCloseArr",engaged:"campaignClickArr"},i=S.getVisit(),n={};if(t[e]){i[r[e]].map(function(r){n[r]=i[r][t[e]]})}return n}catch(e){v.d("getCampaignsInThisVisit "+e,l.error)}},getCampaignsInLastNDays:function(e,t){try{var r={viewed:{time:"showTime",count:"showCount"},closed:{time:"closeTime",count:"closeCount"},engaged:{time:"clickTime",count:"clickCount"}},i=p.globalCampaignDetail,n=[],a={};return r[e]&&(n=i.filter(function(i){if(g.millisecondToHour(i[r[e].time])/24<=t)return i}),n.map(function(t){a[t.campaignId]=t[r[e].count]})),a}catch(e){}},objectKeyMapping:function(e,t){var r={};if("Array"===g.checkVariableType(e)){for(var i in e)void 0!==e[i][t]&&(r[e[i][t]]=e[i]);return r}return e},campaignViewInASession:function(e,t,r){var i=this.objectKeyMapping(p.globalCampaignDetail,"campaignId"),n=null,a={},o=0;return e.forEach(function(e){if(n=i[e],o=0,"Object"===g.checkVariableType(n))for(var c in n[r])g.includes(n[r][c],t)&&(a[e]=++o)}),a},getCampaignsInLastNSessions:function(e,t){try{var r={viewed:"showSessionId",closed:"closeSessionId",engaged:"clickSessionId"},i=[],n=[],a=p.globalSessionDetail;return t+=1,a.length>=t&&(a=a.slice(-1*t)),a.map(function(e){n.push(e.sessionId),e.campaignId.map(function(e){g.includes(e,i)||i.push(e)})}),this.campaignViewInASession(i,n,r[e])}catch(e){v.d("getCampaignsInLastNSessions "+e,l.error)}},bluecoreDuplicateEmailCheck:function(e,t){return new Promise(function(r,i){var n={ns:p.partnerNamespace,customer_id:e,campaign_id:t};p.sendRequest(d.APIURL("duplicateEmail"),n,2e3).then(function(e){200===e.request_status?i(!1):r(!0)}).catch(function(){i(!1)})})},addCouponInCampaignAttributes:function(e){try{var t=bcQuery("[referenceId="+e+"] .bluecoreCouponBox");"text"===t.prop("type")?p.campaignAttributeMapping[e].coupon_code=bcQuery.trim(t.val())||"":p.campaignAttributeMapping[e].coupon_code=bcQuery.trim(t.text())||""}catch(e){v.d("addCouponInCampaignAttributes "+e,l.warning)}},getDataFromLocalStorage:function(e){return g.checkVariableType(t.get(e))?t.get(e):""},verifyCampaignResponse:function(e,t){return!(200!==e.campaign_status||e.template_type!==t.templateType||e.device_type!==t.deviceType||!g.validateKey(e.html))},allowCampaignAttribution:function(e){try{var t=bcQuery(e);return!(t.hasClass("bluecoreSliderPrev")||t.hasClass("bluecoreSliderNext"))}catch(e){}},calculateAttributionValue:function(e,t){try{var r=t.plugins||[],i=bcQuery("[referenceId='"+e+"'] [campaignAttribution]").attr("campaignAttribution"),n=g.includes(g.plugins.emailCapture,r),a=g.includes(g.plugins.recs,r),o=!1;return o=!(!n||!a)||!n,i="true"===i||"false"!==i&&void 0,g.validateKey(i)?i:o}catch(e){}},registerClickCall:function(e,t,r,i,n){try{if("Array"===g.checkVariableType(e)){var a=g.includes(g.plugins.emailCapture,e),o=g.includes(g.plugins.recs,e);a&&o||o?bcQuery("[referenceId="+t+"] .bluecoreSliderBox").off("mousedown").on("mousedown",function(e){try{p.recsProductClickId=bcQuery(this).closest(".bluecoreSliderBox").find(".bluecore_recs_productId").val()||"",g.allowCampaignAttribution(e.target)&&_.campaignStats(t,"clicks",r,i,n)}catch(e){}}):a||bcQuery("[referenceId="+t+"]").one("click",function(e){try{_.campaignStats(t,"clicks",r,i,n)}catch(e){}})}}catch(e){}},isInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},removeBlankKeyInObject:function(e){try{var t={};if("Object"===g.checkVariableType(e))return Object.keys(e).forEach(function(r,i){e[r]&&(t[r]=e[r])}),{payload:t,flag:!0}}catch(e){return{payload:t,flag:!1}}}},m={isLanguageDrawerClosed:function(){try{return!m.isEnterpriseCustomer()||!(NikeDotcomNav.vanilla.objects.languageMenu.state.open||bcQuery(".active-modal.active-overlay").length>0)}catch(e){return!1}},isEnterpriseCustomer:function(){try{return!("nike"!==p.partnerNamespace&&!/^nike_/.test(p.partnerNamespace))}catch(e){return!1}},checkUserState:function(e){try{var t=e.rule.attributes,r=e.interBlockOperator,i=[];for(var n in t)if("Object"===g.checkVariableType(t[n])&&t[n].ruleBlock.length>0){var a=t[n].ruleBlock,o=a[0];for(var c in a)"Object"===g.checkVariableType(a[c])&&"bluecoreAudienceCriteria"===a[c].criteriaKey&&"userType"===a[c].audienceBase&&i.push(f[o.audienceOperator](o.userType,b.type()))}var l=g.calculateSingleRuleResult(r,i);return i=[],!!l}catch(e){return!1}},makeIdentifyCallInUniteForm:function(e,t,r){try{if(p.globalCampaignId=e,p.globalType=t,!p.isRegisterUniteHandler&&g.includes("email_capture",r.plugins)){p.isRegisterUniteHandler=!0;var i=function(e){NikeDotcomNav.api.closeModal();var t="nike"===triggermail.lytics.get_config("token")&&e&&e.contact&&e.contact.email&&e.contact.email.address||"";g.isEmail(t)?triggermail.identify({email:t,source:triggermail.identifySource.CUSTOM,source_detail:p.source_detail}):triggermail.lytics.register({bc_id:Math.floor(1e9*Math.random())}),g.validateKey(p.globalCampaignId)&&(_.sendEmailCaptureEvent(p.globalCampaignId,""),g.custom_event_record("emailCaptured",g.eventDataBuilder(p.globalCampaignId,null,null,null))),_.campaignStats(p.globalCampaignId,"clicks",p.globalType,"",""),a.set("bluecore_uniteSubmit","true",!1,525600,!0)};window.nike&&nike.unite&&nike.unite.on&&nike.unite.on.emailOnlyJoin&&nike.unite.on.emailOnlyJoin.success.addHandler(i)}}catch(e){v.d("makeIdentifyCallInUniteForm "+e,l.error)}},registerUniteCloseEvent:function(e,t,r){setTimeout(function(){try{var i=!0;m.unRegisterUniteCloseEvent(),m.makeIdentifyCallInUniteForm(e,t,r),bcQuery("#bluecoreSite_openUnitForm").on("click",function(){try{NikeDotcomNav.api.openModal("unite","emailOnlyJoin"),bcQuery("[referenceId='"+e+"'] .bluecoreCloseButton").trigger("click")}catch(e){}}),bcQuery(document).on("click",".hf-modal-btn-close",function(r){try{i&&(i=!1,_.campaignStats(e,"close",t),bcQuery("[referenceId="+e+"]").remove())}catch(r){v.d("registerUniteCloseEvent "+r,l.error)}})}catch(e){v.d("registerUniteCloseEvent "+e,l.error)}},1e3)},unRegisterUniteCloseEvent:function(){try{bcQuery(document).off("click",".hf-modal-btn-close")}catch(e){v.d("registerUniteCloseEvent "+e,l.error)}}},f={equalTo:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&t==e?1:0}catch(e){return v.d("equalTo "+e,l.warning),0}},notEqual:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&t!=e?1:0}catch(e){return v.d("not equalTo "+e,l.warning),0}},greaterThan:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&Number(t)>Number(e)?1:0}catch(e){return v.d("greaterThan "+e,l.warning),0}},lessThan:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&Number(t)<Number(e)?1:0}catch(e){return v.d("lessThan "+e,l.warning),0}},onAfter:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&e<=t?1:0}catch(e){return v.d("onAfter "+e,l.warning),0}},onBefore:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&e>=t?1:0}catch(e){return v.d("onBefore "+e,l.warning),0}},contains:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&-1!==String(t).indexOf(String(e))?1:0}catch(e){return v.d("contains "+e,l.warning),!1}},notContains:function(e,t){try{return g.validateKey(e)&&g.validateKey(t)&&-1===String(t).indexOf(String(e))?1:0}catch(e){return v.d("not contains "+e,l.warning),!1}},exists:function(e,t){try{return g.validateKey(t)?1:0}catch(e){return v.d("exists "+e,l.warning),!1}},notExist:function(e,t){try{return g.validateKey(t)?0:1}catch(e){return v.d("notExist "+e,l.warning),!1}},isTrue:function(e,t){try{return!0===t?1:0}catch(e){return v.d("isTrue "+e,l.warning),!1}},isFalse:function(e,t){try{return!1===t?1:0}catch(e){return v.d("notExist "+e,l.warning),!1}}},y={userType:function(e){try{h.saveRuleCondition(f[e.audienceOperator](e.userType,b.type()))}catch(e){h.saveRuleCondition(0)}},bluecoreAudience:function(e){try{var t=p.audience.audience;if("Array"===g.checkVariableType(t)&&t.length>0){var r=isNaN(Number(e.bluecoreAudience.audienceId))?0:Number(e.bluecoreAudience.audienceId);e.audienceOperator===g.operators.equalTo?g.includes(r,t)?h.saveRuleCondition(1):h.saveRuleCondition(0):e.audienceOperator===g.operators.notEqual?g.includes(r,t)?h.saveRuleCondition(0):h.saveRuleCondition(1):h.saveRuleCondition(0)}else h.saveRuleCondition(0)}catch(e){h.saveRuleCondition(0)}},current:function(e){try{h.saveRuleCondition(f[e.urlOperator](e.urlValue,String(document.location.href)))}catch(e){h.saveRuleCondition(0)}},referring:function(e){try{"direct"!==g.getReferrer(!0)?h.saveRuleCondition(f[e.urlOperator](e.urlValue,g.getReferrer())):h.saveRuleCondition(0)}catch(e){h.saveRuleCondition(0)}},previousDomain:function(e){try{var t=f[e.urlOperator](e.urlValue,g.getReferrer());0===t||1===t?h.saveRuleCondition(t):h.saveRuleCondition(0)}catch(e){h.saveRuleCondition(0)}},first:function(e){try{var t="";if("allTime"===e.urlDuration){t=p.globalLifetimeDetail.firstVisit}else if("currentVisit"===e.urlDuration){var r=S.getVisit();t=r.startPageUrl}else if("currentSession"===e.urlDuration){var i=p.globalSessionDetailCurrent;t=i.firstVisitThisSession}h.saveRuleCondition(f[e.urlOperator](e.urlValue,String(t)))}catch(e){h.saveRuleCondition(0)}},ipAddress:function(e){try{h.saveRuleCondition(f[e.deviceOperator](e.deviceValue,String(p.location.ip)))}catch(e){h.saveRuleCondition(0)}},browser:function(e){try{var t="String"===g.checkVariableType(e.deviceBrowser)?e.deviceBrowser.toLowerCase():e.deviceBrowser;h.saveRuleCondition(f[e.deviceOperator](t.toLowerCase(),String(p.bluecoreDeviceInfo.browser).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},device:function(e){try{var t="String"===g.checkVariableType(e.deviceType)?e.deviceType.toLowerCase():e.deviceType;h.saveRuleCondition(f[e.deviceOperator](t.toLowerCase(),String(p.bluecoreDeviceInfo.device).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},os:function(e){try{var t="String"===g.checkVariableType(e.deviceOs)?e.deviceOs.toLowerCase():e.deviceOs;h.saveRuleCondition(f[e.deviceOperator](t.toLowerCase(),String("Mac OS X"===p.bluecoreDeviceInfo.os?"mac":p.bluecoreDeviceInfo.os).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},country:function(e){try{var t="String"===g.checkVariableType(e.geoCountry)?e.geoCountry.toLowerCase():e.geoCountry;h.saveRuleCondition(f[e.operator](t.toLowerCase(),String(p.location.countryCode).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},state:function(e){try{var t="String"===g.checkVariableType(e.geoStates)?e.geoStates.toLowerCase():e.geoStates;h.saveRuleCondition(f[e.operator](t.toLowerCase(),String(p.location.state).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},language:function(e){try{var t="String"===g.checkVariableType(e.geoLanguages)?e.geoLanguages.toLowerCase():e.geoLanguages;h.saveRuleCondition(f[e.operator](t.toLowerCase(),String(navigator.language||navigator.userLanguage).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},timeSpent:function(e){try{var t="";if("currentSession"===e.spentDuration){var r=p.globalSessionDetailCurrent.sessionStartTime,i=0;r&&(i=g.millisecondToMinutes(r)),t=i}else if("currentVisit"===e.spentDuration){var n=S.getVisit(),i=0;n&&(i=g.millisecondToMinutes(n.startTime)),t=i}else if("allTime"===e.spentDuration){var a=p.globalLifetimeDetail.totalTimeSpan||0;a/=60,t=a}h.saveRuleCondition(f[e.spentOperator](e.spentValue,t))}catch(e){h.saveRuleCondition(0)}},localDay:function(e){try{var t=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"],r=(new Date).getDay()||0;h.saveRuleCondition(f[e.dayOperator](String(e.dayValue).toLowerCase(),String(t[r]).toLowerCase()))}catch(e){h.saveRuleCondition(0)}},localDate:function(e){try{var t=(new Date).getDate();h.saveRuleCondition(f[e.timeOperator](e.dateValue,t))}catch(e){h.saveRuleCondition(0)}},localTime:function(e){try{var t=g.getTimeStampWithTime(e.timeValue);h.saveRuleCondition(f[e.timeOperator](t,(new Date).valueOf()))}catch(e){h.saveRuleCondition(0)}},visits:function(e){try{h.saveRuleCondition(f[e.frequencyOperator](e.frequencyValue,Number(p.globalLifetimeDetail.totalVisitCount||0)))}catch(e){h.saveRuleCondition(0)}},sessions:function(e){try{h.saveRuleCondition(f[e.frequencyOperator](e.frequencyValue,Number(p.globalLifetimeDetail.totalSessionCount||0)))}catch(e){h.saveRuleCondition(0)}},pageViews:function(e){try{"allTime"===e.frequencyPageviews?h.saveRuleCondition(f[e.frequencyOperator](e.frequencyValue,Number(p.globalLifetimeDetail.totalPageViewCount||0))):"currentVisit"===e.frequencyPageviews?g.validateKey(S.getVisit())?h.saveRuleCondition(f[e.frequencyOperator](e.frequencyValue,Number(S.getVisit().pageViews||0))):h.saveRuleCondition(0):"currentSession"===e.frequencyPageviews?h.saveRuleCondition(f[e.frequencyOperator](e.frequencyValue,Number(p.globalSessionDetailCurrent.pageViews||1))):h.saveRuleCondition(0)}catch(e){h.saveRuleCondition(0)}},currentVisit:function(e,t){try{var r=e.engagementType;"specificCampaign"===e.engagementCampaign&&(t=e.engagementCampaignValue.campaignId);var i=g.getCampaignsInThisVisit(r),n=0;if("anyCampaign"!==e.engagementCampaign)t in i&&(n=i[t]),h.saveRuleCondition(f[e.timeOperator](e.timeValue,n));else{var a=0;for(var o in i)"Number"===g.checkVariableType(i[o])&&(a+=i[o]);h.saveRuleCondition(f[e.timeOperator](e.timeValue,a))}}catch(e){h.saveRuleCondition(0)}},inThisSession:function(e,t){try{var r=e.engagementType;"specificCampaign"===e.engagementCampaign&&(t=e.engagementCampaignValue.campaignId);var i=g.getCampaignsInThisSession(r),n=0;if("anyCampaign"!==e.engagementCampaign)t in i&&(n=i[t]),h.saveRuleCondition(f[e.timeOperator](e.timeValue,n));else{var a=0;for(var o in i)"Number"===g.checkVariableType(i[o])&&(a+=i[o]);h.saveRuleCondition(f[e.timeOperator](e.timeValue,a))}}catch(e){h.saveRuleCondition(0)}},allTime:function(e,t){try{var r=e.engagementType;"specificCampaign"===e.engagementCampaign&&(t=e.engagementCampaignValue.campaignId);var i=g.getCampaignsAllTime(r),n=0;if("anyCampaign"!==e.engagementCampaign)t in i&&(n=i[t]),h.saveRuleCondition(f[e.timeOperator](e.timeValue,n));else{var a=0;for(var o in i)"Number"===g.checkVariableType(i[o])&&(a+=i[o]);h.saveRuleCondition(f[e.timeOperator](e.timeValue,a))}}catch(e){h.saveRuleCondition(0)}},last:function(e,t){try{var r={days:"getCampaignsInLastNDays",sessions:"getCampaignsInLastNSessions"},i=e.engagementType;"specificCampaign"===e.engagementCampaign&&(t=e.engagementCampaignValue.campaignId);var n=g[r[e.durationTime]](i,e.durationValue),a=null;if("anyCampaign"!==e.engagementCampaign)a=t in n?n[t]||0:0,h.saveRuleCondition(f[e.timeOperator](e.timeValue,a));else{var o=0;for(var c in n)"Number"===g.checkVariableType(n[c])&&(o+=n[c]);h.saveRuleCondition(f[e.timeOperator](e.timeValue,o))}}catch(e){h.saveRuleCondition(0)}}},h={technologyCriteriaMapping:{},validate:function(e){try{var t=[],r=e.campaignId;this.technologyCriteriaMapping[r]={blockResult:[],blockOperator:[]};var i=e.rule,n=i.completedTime,a=i.startTime,o=i.displayTime,c=i.suppressionRules;h.validateStartDate(a,g.operators.greaterThan),h.validateEndDate(n,g.operators.lessThan),h.validateDisplayTime(o),h.validateSuppressionRules(c,g.operators.lessThan,r);var u=i.attributes;for(var s in u)"Object"===g.checkVariableType(u[s])&&u[s].ruleBlock.length>=0&&(this.technologyCriteriaMapping[r].blockOperator.push(u[s].intraBlockOperator),h.evaluateBlockCriteria(u[s],r,e.interBlockOperator));var d=g.calculateSingleRuleResult("AND",p.suppressionConditionJoinResult),m=g.calculateSingleRuleResult(e.interBlockOperator,p.targetingConditionJoinResult);p.campaignTargetingResult[r]=g.keyOccurrencesInArray(p.targetingConditionJoinResult)[1]>1?1:0,p.targetingConditionJoinResult=[],p.suppressionConditionJoinResult=[],t.push(d),t.push(m);var f=g.calculateSingleRuleResult("AND",t);return t=[],f}catch(e){return v.d("targeting validate "+e,l.error),!1}},saveRuleCondition:function(e){try{p.targetingConditionSingleResult.push(e)}catch(e){p.targetingConditionSingleResult.push(0)}},saveSuppressionRuleCondition:function(e){try{p.suppressionConditionJoinResult.push(e)}catch(e){p.suppressionConditionJoinResult.push(0)}},validateStartDate:function(e,t){try{"Object"===g.checkVariableType(e)&&("immediate"===e.startCampaignOn?h.saveSuppressionRuleCondition(1):"specificTime"===e.startCampaignOn?g.dateSchedule(e.startOn,new Date,t):h.saveSuppressionRuleCondition(0))}catch(e){h.saveSuppressionRuleCondition(0)}},validateSuppressionRules:function(e,t,r){try{if("Object"===g.checkVariableType(e)){var i=r||null,n=p.globalCampaignDetail||null,a=null,o=p.globalSessionDetailCurrent.sessionId;if("showAlways"===e.campaignEngagement)h.saveSuppressionRuleCondition(1);else if("tillSpecificTime"===e.campaignEngagement){var c=e.timePerSession,l=g.campaignShowWithInADay(r),u=e.timesPerDay;if(null!==i&&g.validateKey(n)&&n.length>0&&(a=n.filter(function(e){return!(void 0===e||!g.validateKey(e.campaignId))&&e.campaignId===String(r)})),g.validateKey(a)){var s={};if(a.length>0&&(a=a[0],s=a.showSessionId.reduce(function(e,t){return g.validateKey(e[t])?e[t]+=1:e[t]=1,e},{})),l<u)if(s[o]&&s[o]>=c)if("every"===e.repeat){var d=a.showTime;if(g.validateKey(d)){var m=g.millisecondToHour(d);m<g.daysToHours(e.repeatCadenceDays)?h.saveSuppressionRuleCondition(0):h.saveSuppressionRuleCondition(1)}else h.saveSuppressionRuleCondition(1)}else e.repeat,h.saveSuppressionRuleCondition(0);else"never"===e.repeat&&0===s[o]?h.saveSuppressionRuleCondition(0):h.saveSuppressionRuleCondition(1);else h.saveSuppressionRuleCondition(0)}else h.saveSuppressionRuleCondition(1)}else"untilEvent"===e.campaignEngagement&&(null!==i&&g.validateKey(n)&&n.length>0?"engaged"===e.eventType?(a=n.filter(function(e){return void 0!==e&&e.campaignId===String(r)}),a=a[0],"Object"===g.checkVariableType(a)&&a.closeCount>0&&g.millisecondToHour(a.closeTime)<g.daysToHours(e.repeatCadenceDays)?h.saveSuppressionRuleCondition(0):h.saveSuppressionRuleCondition(1)):"engagementWithCampaign"===e.eventType?(a=n.filter(function(t){return(void 0!==t||void 0!==e)&&t.campaignId===String(e.campaignId)}),a=a[0],"Object"===g.checkVariableType(a)&&a.clickCount>0&&g.includes(o,a.clickSessionId)?h.saveSuppressionRuleCondition(0):h.saveSuppressionRuleCondition(1)):h.saveSuppressionRuleCondition(1):h.saveSuppressionRuleCondition(1))}}catch(e){}},validateDisplayTime:function(e){try{if("Object"===g.checkVariableType(e))if("daily"===e.showCampaign)"fullDay"===e.startCampaignOn?h.saveSuppressionRuleCondition(1):"specificTime"===e.startCampaignOn?g.dateSchedule(e.fromTime,e.toTime,g.operators.between,"validateDisplayTime"):h.saveSuppressionRuleCondition(0);else if("weekly"===e.showCampaign){var t=e.dayOfWeek,r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=new Date,n=r[i.getDay()],a=!1;for(var o in t)"String"===g.checkVariableType(t[o])&&t[o]===n&&(a=!0);a?"fullDay"===e.startCampaignOn?h.saveSuppressionRuleCondition(1):"specificTime"===e.startCampaignOn?g.dateSchedule(e.fromTime,e.toTime,g.operators.between):h.saveSuppressionRuleCondition(0):h.saveSuppressionRuleCondition(0)}else h.saveSuppressionRuleCondition(0)}catch(e){v.d("validateDisplayTime "+e,l.warning),h.saveSuppressionRuleCondition(0)}},validateEndDate:function(e,t){try{"Object"===g.checkVariableType(e)&&("keepRunning"===e.endCampaignOn?h.saveSuppressionRuleCondition(1):"specificTime"===e.endCampaignOn?g.dateSchedule(e.endOn,new Date,t):h.saveSuppressionRuleCondition(0))}catch(e){v.d("validateEndDate "+e,l.error),h.saveSuppressionRuleCondition(0)}},evaluateBlockCriteria:function(e,t,r){try{var i=e.ruleBlock,n=[];for(var a in i)"Object"===g.checkVariableType(i[a])&&("technologyCriteria"===i[a].criteriaKey?n.push(0):n.push(1),this[i[a].criteriaKey](i[a],t));this.technologyCriteriaMapping[t].blockResult.push(p.targetingConditionSingleResult);var o=g.calculateSingleRuleResult(e.intraBlockOperator,p.targetingConditionSingleResult,r);p.targetingConditionJoinResult.push(o),p.targetingConditionSingleResult=[]}catch(e){h.saveRuleCondition(0)}},urlBasedCriteria:function(e,t){try{g.validateKey(e.urlBase)&&y[e.urlBase](e,t)}catch(e){h.saveRuleCondition(0)}},deviceTargetingCriteria:function(e,t){try{g.validateKey(e.deviceBase)&&y[e.deviceBase](e,t)}catch(e){h.saveRuleCondition(0)}},geoLocationCriteria:function(e,t){try{g.validateKey(e.geoBase)&&y[e.geoBase](e,t)}catch(e){h.saveRuleCondition(0)}},dateTimeCriteria:function(e,t){try{g.validateKey(e.timeBase)&&y[e.timeBase](e,t)}catch(e){h.saveRuleCondition(0)}},bluecoreAudienceCriteria:function(e,t){try{g.validateKey(e.audienceBase)&&y[e.audienceBase](e,t)}catch(e){h.saveRuleCondition(0)}},visitFrequencyCriteria:function(e,t){try{g.validateKey(e.frequencyBase)&&y[e.frequencyBase](e,t)}catch(e){h.saveRuleCondition(0)}},userEngagementCriteria:function(e,t){try{g.validateKey(e.engagementDuration)&&y[e.engagementDuration](e,t)}catch(e){h.saveRuleCondition(0)}},technologyCriteria:function(e,t){try{g.validateKey(e.technologyBase)&&(h.saveRuleCondition(1),this.technologyCriteriaMapping[t].technologyCriteria=!0)}catch(e){}}},b={type:function(){try{return g.isEmail(triggermail.lytics.get_property("email"))||g.validateKey(triggermail.lytics.get_property("OBFUSCATED_EMAIL_PROPERTY"))||g.validateKey(triggermail.lytics.get_property("bc_id"))||g.validateKey(triggermail.lytics.get_property("tm_merged"))||g.validateKey(triggermail.lytics.get_property("ch"))?"known":"true"===a.get("bluecoreNV")?"new":"returning"}catch(e){return"new"}},getUser:function(){try{return triggermail.lytics.get_property("email")?{distinct_id:p.userDistinctId,email:triggermail.lytics.get_property("email"),obem:triggermail.util.getUrlParam("obem"),nqe:triggermail.util.getUrlParam("nqe")||""}:{distinct_id:p.userDistinctId,obem:triggermail.util.getUrlParam("obem"),nqe:triggermail.util.getUrlParam("nqe")||""}}catch(e){return{distinct_id:"",obem:"",email:"",nqe:""}}},getProductId:function(){try{return(new triggermail.fetcher).id()||"1"}catch(e){return"1"}}},v={d:function(e,t){try{if(p.logLimit>0){p.logLimit--;var r=g.mergeObject({ns:p.partnerNamespace,data:window.btoa(encodeURI(e))||"",log_level:t||"info",request:encodeURI(window.location.href),details:encodeURI(JSON.stringify(p.bluecoreDeviceInfo))||""},b.getUser());p.sendRequest(d.ONSITE_ERROR,r,5e3).then(function(e){}).catch(function(e){})}}catch(e){}},campaignTargetingTraces:function(e,t,r,i,n){try{if("function"==typeof bluecore_custom_campaign_targeting_debug){var a=null;if(e){var o=[];r.forEach(function(e,t){o.push({campaignRule:i[t],result:e})}),a=n?n+" = ":"",bluecore_custom_campaign_targeting_debug(a+t,o,"")}else{var c=i||"",l=r||"";a=n?n+" = ":"",bluecore_custom_campaign_targeting_debug(a+t,l,c)}}}catch(e){}}},_={initialiseBluecoreOnsite:function(){g.addJavascript(d.ONSITE_BCQUERY,function(){try{p.bluecoreDeviceInfo=c.systemInfo(),_.init(),function(){bcQuery.fn.bluecoreSite_DSlider=function(e){try{var t,r,i=bcQuery.extend({},bcQuery.fn.bluecoreSite_DSlider.defaults,e),n=i.selector,a=!0,o=!0,c=0,p=!0,d=null,m=!0,f=function(){bcQuery(n+" "+i.singleBoxSelector).css("display","inline-block");var e=bcQuery(n+" "+i.boxContainerSelector).outerWidth();e-=bcQuery(i.slidePrevious).width()+bcQuery(i.slideNext).width(),d=parseInt(bcQuery(n+" "+i.boxContainerSelector).data("slide"))||3;var l=bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector+":first").outerWidth();t=parseInt(e/l),d=t<d?t:d;var b=parseInt(bcQuery(n+" "+i.boxContainerSelector+" "+i.singleBoxSelector).length)||1,v=parseInt(bcQuery(n+" "+i.boxContainerSelector+" "+i.singleBoxSelector).length)||1;bcQuery(n+" "+i.boxContainerSelector).css({height:bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector+":first").outerHeight(),overflow:"hidden"});var _=bcQuery(n+" "+i.singleBoxSelector).length;if(_<5)bcQuery(n+" "+i.boxContainerSelector).addClass("bci_slider_container"),bcQuery(n+" "+i.slideNext+", "+n+" "+i.slidePrevious).remove();else{if(b*l>e&&(l=e/t,bcQuery(n+" "+i.singleBoxSelector).css({width:l}),bcQuery(n+" "+i.boxContainerSelector).css({width:e})),o){o=!1;var S=[];bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector).each(function(e){S.push(bcQuery(this).clone())});for(var C=1===t?_:t,w=0;w<d;w++)bcQuery(n+" "+i.boxOuterSelector).prepend(S[C]),C++}if(v*l>e){var T=g.getDeviceType()===u.mobile?"touchstart":"click";if(T===s.click){bcQuery("body").delegate(n+" "+i.slideNext,T,function(){m&&(m=!1,p=!0,y()),setTimeout(function(){m=!0},230)}),bcQuery("body").delegate(n+" "+i.slidePrevious,T,function(){m&&(m=!1,p=!1,y()),setTimeout(function(){m=!0},230)}),bcQuery("body").delegate(n+" "+i.boxContainerSelector,"mouseenter",function(){h()}),bcQuery("body").delegate(n+" "+i.boxContainerSelector,"mouseleave",function(){clearInterval(c),c=setInterval(function(){y()},i.autoRotationTime)}),"auto"==i.rotation?(i.autoRotationTime=1e3,c=setInterval(function(){y()},i.autoRotationTime)):"no"==i.rotation?i.autoRotationTime=5e5:"custom"==i.rotation?c=setInterval(function(){y()},i.autoRotationTime):(i.autoRotationTime=1e3,c=setInterval(function(){y()},i.autoRotationTime));var l=bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector).outerWidth();bcQuery(n+" "+i.boxOuterSelector).css({left:"-"+l*d+"px"})}else a&&(a=!1,bcQuery("body").bluecoreSite_MSlider({numberOfTotalProduct:v-1,widgetParentSelector:n,slideNext:i.slideNext,slidePrevious:i.slidePrevious}))}else bcQuery(n+" "+i.slideNext+", "+n+" "+i.slidePrevious).remove();T===s.click&&bcQuery(window).resize(function(){clearTimeout(r),r=setTimeout(function(){bcQuery(n+" "+i.singleBoxSelector+","+n+" "+i.boxOuterSelector+","+n+" "+i.boxContainerSelector).removeAttr("style"),bcQuery("body").undelegate(n+" "+i.slideNext,"touchstart click"),bcQuery("body").undelegate(n+" "+i.slidePrevious,"touchstart click"),bcQuery("body").undelegate(n+" "+i.boxContainerSelector,"mouseenter mouseleave"),f()},250)})}},y=function(){p?b():_()},h=function(){clearInterval(c)},b=function(){var e=bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector).outerWidth(),t=parseInt(bcQuery(n+" "+i.boxOuterSelector).css("left"))-e*d;bcQuery(n+" "+i.boxOuterSelector).animate({left:t},i.rotationDelay,function(){for(var t=0;t<d;t++)bcQuery(n+" "+i.boxOuterSelector).append(bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector+":first"));bcQuery(n+" "+i.boxOuterSelector).css({left:"-"+e*d+"px"})})},_=function(){var e=bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector).outerWidth(),t=parseInt(bcQuery(n+" "+i.boxOuterSelector).css("left"))+e*d;bcQuery(n+" "+i.boxOuterSelector).animate({left:t},i.rotationDelay,function(){for(var t=0;t<d;t++)bcQuery(n+" "+i.boxOuterSelector).prepend(bcQuery(n+" "+i.boxOuterSelector+" "+i.singleBoxSelector+":last"));bcQuery(n+" "+i.boxOuterSelector).css({left:"-"+e*d+"px"})})};f()}catch(e){v.d("bluecoreSite_DSlider "+e,l.error)}},bcQuery.fn.bluecoreSite_DSlider.defaults={singleBoxSelector:".bluecoreSliderBox",boxOuterSelector:".bluecoreSliderOuter",boxContainerSelector:".bluecoreSliderContainer",slideNext:".bluecoreSliderNext",slidePrevious:".bluecoreSliderPrev",rotationDelay:500,rotationDelayMobile:200,rotation:"no",autoRotationTime:1e3}}(),function(){bcQuery.fn.bluecoreSite_MSlider=function(e){try{var t=bcQuery.extend({},bcQuery.fn.bluecoreSite_MSlider.defaults,e),r=!0,i=t.widgetParentSelector+" "+t.slideNext,n=t.widgetParentSelector+" "+t.slidePrevious;!function(){if(navigator.msMaxTouchPoints)bcQuery(t.widgetParentSelector+" "+t.boxContainerSelector).addClass("boutSlider_ms-touch"),bcQuery(t.widgetParentSelector+" "+t.boxContainerSelector).on("scroll",function(){bcQuery(t.singleBoxSelector).css("transform","translate3d(-"+(100-bcQuery(this).scrollLeft()/6)+"px,0,0)")});else{var e=!0,a={el:{slider:bcQuery(t.widgetParentSelector+" "+t.boxContainerSelector),holder:bcQuery(t.widgetParentSelector+" "+t.boxOuterSelector),imgSlide:bcQuery(t.widgetParentSelector+" "+t.singleBoxSelector),panxLimit:bcQuery(t.widgetParentSelector+" "+t.singleBoxSelector).width()*t.numberOfTotalProduct-bcQuery(t.widgetParentSelector+" "+t.singleBoxSelector).width(),maxScrollLimit:bcQuery(t.widgetParentSelector+" "+t.singleBoxSelector).width()*t.numberOfTotalProduct},slideWidth:bcQuery(t.widgetParentSelector+" "+t.boxContainerSelector).width(),touchstartx:void 0,touchmovex:void 0,movex:void 0,index:0,longTouch:void 0,init:function(){this.bindUIEvents()},bindUIEvents:function(){try{this.el.holder.on("touchstart",function(t){try{e=!1,a.start(t)}catch(e){}}),this.el.holder.on("touchmove",function(t){try{e=!1,a.move(t)}catch(e){}}),this.el.holder.on("touchend",function(t){try{e=!0,a.end(t)}catch(e){}}),this.addClickEvent(),bcQuery(i).show()
}catch(e){v.d("bluecoreSite_MSlider_bindUIEvents"+e,l.error)}},start:function(e){try{this.longTouch=!1,setTimeout(function(){a.longTouch=!0},1),this.touchstartx=e.originalEvent.touches[0].pageX,bcQuery(".boutSlider_animate").removeClass("boutSlider_animate")}catch(e){}},move:function(e){try{this.touchmovex=e.originalEvent.touches[0].pageX,this.movex=this.index*this.slideWidth+(this.touchstartx-this.touchmovex);var t=100-this.movex/6;this.movex<this.el.maxScrollLimit&&this.el.holder.css("transform","translate3d(-"+this.movex+"px,0,0)"),t<this.el.panxLimit&&this.el.imgSlide.css("transform","translate3d(0px,0,0)")}catch(e){}},end:function(r){try{var a=Math.abs(this.index*this.slideWidth-this.movex);"next"===r&&(a=this.slideWidth+10,this.movex=this.index*this.slideWidth+10),"prev"===r&&(a=this.slideWidth-10,this.movex=this.index*this.slideWidth-10),a>30&&(a>this.slideWidth/2||!1===this.longTouch)&&(this.movex>this.index*this.slideWidth&&this.index<t.numberOfTotalProduct?this.index++:this.movex<this.index*this.slideWidth&&this.index>0&&this.index--),this.index===t.numberOfTotalProduct?(bcQuery(i).hide(),bcQuery(n).show()):0===this.index?(bcQuery(i).show(),bcQuery(n).hide()):bcQuery(n+", "+i).show(),e&&(this.el.holder.addClass("boutSlider_animate").css("transform","translate3d(-"+this.index*this.slideWidth+"px,0,0)"),this.el.imgSlide.addClass("boutSlider_animate").css("transform","translate3d(-100"-50*this.index+"px,0,0)"))}catch(e){}},addClickEvent:function(){var e="ontouchstart"in document.documentElement?"touchstart":"click";bcQuery("body").delegate(t.widgetParentSelector+" "+t.slideNext,e,function(){r&&(r=!1,a.end("next")),setTimeout(function(){r=!0},230)}),bcQuery("body").delegate(t.widgetParentSelector+" "+t.slidePrevious,e,function(){r&&(r=!1,a.end("prev")),setTimeout(function(){r=!0},230)})}};a.init()}}()}catch(e){v.d("bluecoreSite_MSlider "+e,l.error)}},bcQuery.fn.bluecoreSite_MSlider.defaults={singleBoxSelector:".bluecoreSliderBox",boxOuterSelector:".bluecoreSliderOuter",boxContainerSelector:".bluecoreSliderContainer",slideNext:"",slidePrevious:"",numberOfTotalProduct:1}}(),function(){bcQuery.fn.bluecoreSite_cookiesWatcher=function(e){function t(){try{var e=a.get(r.metaData.cookieKey),l=0;l=f[r.metaData.evaluateOperator](r.metaData.cookieValue,e),0!==l&&1!==l||o(l),n++,n<c&&!g.includes(i,p.viewedCampaignListThisPage)&&(r.watchTime<p.technologyTimerMaxLimit&&++r.watchTime,setTimeout(t,1e3*r.watchTime))}catch(e){}}try{var r=bcQuery.extend({},bcQuery.fn.bluecoreSite_cookiesWatcher.defaults,e),i=r.campaignId,n=0,o=function(e){p.loadEnable&&r.callback(r.blockIndex,r.ruleIndex,e)},c=r.technologyTimerIteration||p.technologyTimerIteration;setTimeout(t,1e3*r.watchTime)}catch(e){v.d("bcQuery.fn.bluecoreSite_cookiesWatcher "+e,l.error)}},bcQuery.fn.bluecoreSite_cookiesWatcher.defaults={watchTime:1,metaData:!1,blockIndex:0,ruleIndex:0,technologyTimerIteration:0,callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_evaluateJsWatcher=function(e){function t(){try{c||(c=g.evaluateExpression(r.metaData.evaluateJs));var e=c(),u=f[r.metaData.evaluateOperator](r.metaData.evaluateJsValue,e);0!==u&&1!==u||a(u),n++,n<o&&!g.includes(i,p.viewedCampaignListThisPage)&&(r.watchTime<p.technologyTimerMaxLimit&&++r.watchTime,setTimeout(t,1e3*r.watchTime))}catch(e){v.d("evaluateJs "+e,l.error)}}try{var r=bcQuery.extend({},bcQuery.fn.bluecoreSite_evaluateJsWatcher.defaults,e),i=r.campaignId,n=0,a=function(e){p.loadEnable&&r.callback(r.blockIndex,r.ruleIndex,e)},o=r.technologyTimerIteration||p.technologyTimerIteration,c=null;setTimeout(t,1e3*r.watchTime)}catch(e){v.d("bcQuery.fn.bluecoreSite_evaluateJs "+e,l.error)}},bcQuery.fn.bluecoreSite_evaluateJsWatcher.defaults={watchTime:1,metaData:!1,blockIndex:0,ruleIndex:0,technologyTimerIteration:0,callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_timeSpent=function(e){try{var t=bcQuery.extend({},bcQuery.fn.bluecoreSite_timeSpent.defaults,e),r=function(e){try{p.loadEnable&&t.callback(t.blockIndex,t.ruleIndex,e)}catch(e){}};setTimeout(function(){r(1)},1e3*t.watchTime)}catch(e){v.d("bcQuery.fn.bluecoreSite_timeSpent "+e,l.error)}},bcQuery.fn.bluecoreSite_timeSpent.defaults={watchTime:0,metaData:!1,callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_exitIntent=function(e){try{var t=bcQuery.extend({},bcQuery.fn.bluecoreSite_exitIntent.defaults,e),r=t.campaignId;g.getDeviceType()!==u.mobile&&function(e){try{bcQuery("html").on("mouseleave.body",function(i){try{if(i.clientY>t.sensitivity)return;if(t.flag)return;p.loadEnable&&!g.includes(r,p.viewedCampaignListThisPage)&&(t.flag=!1,t.callback(t.blockIndex,t.ruleIndex,e))}catch(i){}})}catch(e){}}(1)}catch(e){v.d("bcQuery.fn.bluecoreSite_exitIntent "+e,l.error)}},bcQuery.fn.bluecoreSite_exitIntent.defaults={sensitivity:0,flag:!1,callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_pageScroll=function(e){try{var t=bcQuery.extend({},bcQuery.fn.bluecoreSite_pageScroll.defaults,e),r=t.campaignId;!function(){var e=null,i=null,n=null,a=null,o=0,c=function(){try{var c=bcQuery(this).scrollTop();if(g.includes(r,p.viewedCampaignListThisPage))return void window.removeEventListener("scroll",l);if("pixels"===t.scrollType&&p.loadEnable){var u=t.metaData.scrollValue||t.scrollValue;o=f[t.metaData.technologyOperator](u,c),t.flag&&o&&(a=c,t.callback(t.blockIndex,t.ruleIndex,1))}else if("percentage"===t.scrollType&&p.loadEnable){e=bcQuery(document).height(),i=bcQuery(window).height(),n=c/(e-i)*100;var u=t.metaData.scrollValue||t.scrollValue;o=f[t.metaData.technologyOperator](u,n),t.flag&&n>t.scrollValue&&(a=c,t.callback(t.blockIndex,t.ruleIndex,1))}}catch(e){}},l=bcQuery(window).scroll(c)}()}catch(e){v.d("bcQuery.fn.bluecoreSite_pageScroll "+e,l.error)}},bcQuery.fn.bluecoreSite_pageScroll.defaults={scrollValue:0,flag:!0,scrollType:"pixels",metaData:null,callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_userIdle=function(e){try{var t,r=bcQuery.extend({},bcQuery.fn.bluecoreSite_userIdle.defaults,e),i=function(){try{n++,n>a&&r.flag&&(r.flag=!1,r.callback(r.blockIndex,r.ruleIndex,1),clearInterval(t))}catch(e){}},n=0,a=r.idleTime;bcQuery(document).click(function(){n=0}),bcQuery(document).scroll(function(){n=0}),bcQuery(document).keypress(function(){n=0}),t=setInterval(function(){p.loadEnable&&i()},1e3)}catch(e){v.d("bcQuery.fn.bluecoreSite_userIdle "+e,l.error)}},bcQuery.fn.bluecoreSite_userIdle.defaults={flag:!0,metaData:!1,idleTime:"0",callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_elementWatcher=function(e){function t(){try{var e=bcQuery(i.metaData.matchingElementValue).length;1!==e&&0!==e||c(e),a++,a<o&&!g.includes(n,p.viewedCampaignListThisPage)&&(i.watchTime<p.technologyTimerMaxLimit&&++i.watchTime,setTimeout(t,1e3*i.watchTime))}catch(e){}}function r(){try{var e=bcQuery(i.metaData.matchingElementValue).length;1!==e&&0!==e||c(-1*(e-1)),a++,a<o&&!g.includes(n,p.viewedCampaignListThisPage)&&(i.watchTime<p.technologyTimerMaxLimit&&++i.watchTime,setTimeout(r,1e3*i.watchTime))}catch(e){}}try{var i=bcQuery.extend({},bcQuery.fn.bluecoreSite_elementWatcher.defaults,e),n=i.campaignId,a=0,o=i.technologyTimerIteration||p.technologyTimerIteration;if("clicked"===i.operator)bcQuery(i.metaData.matchingElementValue).one("click",function(){g.includes(n,p.viewedCampaignListThisPage)||i.callback(i.blockIndex,i.ruleIndex,1)});else if("exists"===i.operator){var c=function(e){p.loadEnable&&i.callback(i.blockIndex,i.ruleIndex,e)};setTimeout(t,1e3*i.watchTime)}else if("notExist"===i.operator){var c=function(e){p.loadEnable&&i.callback(i.blockIndex,i.ruleIndex,e)};setTimeout(r,1e3*i.watchTime)}}catch(e){v.d("bcQuery.fn.bluecoreSite_elementWatcher "+e,l.error)}},bcQuery.fn.bluecoreSite_elementWatcher.defaults={watchTime:1,metaData:!1,blockIndex:0,ruleIndex:0,technologyTimerIteration:0,callback:function(e){return e}}}(),function(){bcQuery.fn.bluecoreSite_mobileIntent=function(e){try{var t=bcQuery.extend({},bcQuery.fn.bluecoreSite_mobileIntent.default,e);!function(){var e=bcQuery(window).scrollTop(),r=null,i=null,n=null,a=null,o=!1;bcQuery(window).scroll(function(){r&&window.clearTimeout(r);var c=bcQuery(this).scrollTop();i=bcQuery(document).height(),n=bcQuery(window).height(),a=c/(i-n)*100,a>80&&(o=!0),c>e?e=c:r=setTimeout(function(){try{var r=e-c;o?r>t.speed&&0!==c&&t.flag&&(t.flag=!1,t.callback(t.blockIndex,t.ruleIndex,1)):r>t.speed&&t.flag&&(t.flag=!1,t.callback(t.blockIndex,t.ruleIndex,1)),e=c}catch(e){v.d("setTimeout ",e)}},100)}),m.isEnterpriseCustomer()||window.matchMedia("(max-width: 2048px)").matches&&(setTimeout(function(){try{window.addEventListener("popstate",function(e){e.state&&"bluecoreSiteMobileIntent"===e.state.bluecoreSiteMobileIntent&&t.flag&&(t.flag=!1,t.callback(t.blockIndex,t.ruleIndex,1))})}catch(e){v.d("window.matchMedia setTimeout "+e)}},100),window.history.state&&"bluecoreSiteNormalIntent"===window.history.state.bluecoreSiteMobileIntent||(window.history.replaceState({bluecoreSiteMobileIntent:"bluecoreSiteMobileIntent"},""),window.history.pushState({bluecoreSiteMobileIntent:"bluecoreSiteNormalIntent"},"")))}()}catch(e){v.d("bluecoreSite_mobileIntent "+e,l.error)}},bcQuery.fn.bluecoreSite_mobileIntent.default={flag:!0,speed:250,callback:function(e){return e}}}()}catch(e){v.d("initialiseBluecoreOnsite "+e,l.warning)}})},campaignStats:function(e,t,r,i,n,a){try{var c=e,u=t,s=p.campaignAttributeMapping[e];if("Object"!==g.checkVariableType(s))return v.d("campaignStats campaign details not found in "+e,l.error),!1;if(_.allowCampaignEvent(s,t,r,a)){S.setCampaignDetails(c,u,r),"views"===t&&("inline"!==r&&(p.hasNotSeenAnyCampaign=!1,p.isActionTriggerCampaign&&(p.isActionTriggerCampaign=!1)),o.getData("campaignDetails",null,null,null,null).then(function(e){g.validateKey(e)&&e.length>0&&(p.globalCampaignDetail=e)}),triggermail.custom("viewed_onsite",{coupon_code:s.coupon_code||"",site_campaign_name:s.campaignName||"",source_detail:p.source_detail,event_source:p.event_source,campaign_id:e}));var m=!1;if("clicks"===t&&(m=g.calculateAttributionValue(c,p.campaignAttributeMapping[c]),s.engaged_onsite)){s.engaged_onsite=!1;var f=g.removeBlankKeyInObject({site_campaign_name:s.campaignName||"",source_detail:p.source_detail,event_source:p.event_source,coupon_code:s.coupon_code||"",campaign_id:e,email:s.user_email||""});f.flag&&triggermail.custom("engaged_onsite",f.payload)}var y=g.mergeObject({event_type:u,attribution:m,visitor_type:b.type(),referral:g.getReferrer(),session_id:p.globalSessionDetailCurrent.sessionId,page_url:window.location.href,coupon_code:s.coupon_code||"",goal_id:s.goalId,product_id:p.recsProductClickId||"",request_id:p.campaignAttributeMapping[e].request_id||""},b.getUser()),h=g.mergeObject({ns:p.partnerNamespace,campaign_id:c,ab_id:i||"",journey_id:n||"",stats_type:window.btoa(JSON.stringify(y)),device_type:g.getDeviceType()},b.getUser());p.sendRequest(d.ONSITE_CAMPAIGN_STATS,h,5e3).then(function(e){}).catch(function(e){});var C=p.globalSessionDetailCurrent.campaignId;g.includes(e,C)||(C.push(e),p.globalSessionDetailCurrent.campaignId=C,o.setData("sessionDetails",{campaignId:C},["campaignId"],p.globalSessionDetailCurrent.sessionId)),g.custom_event_record(t,g.eventDataBuilder(e))}}catch(e){v.d("campaignStats "+e,l.error)}},allowCampaignEvent:function(e,t,r,i){try{var n=g.includes(r,p.supportedCampaignType),a=g.includes(t,p.campaignPublicEvents);return!!(i&&n&&a)||!(e.hasOwnProperty("allowCampaignEvents")&&!e.allowCampaignEvents[t])}catch(e){}},holdOutStats:function(e,t,r){try{if("Object"===g.checkVariableType(e)){var i=g.mergeObject({event_type:"hold_out",attribution:!0,visitor_type:b.type(),referral:g.getReferrer(),session_id:p.globalSessionDetailCurrent.sessionId,page_url:window.location.href,goal_id:e.goalId},b.getUser()),a=g.mergeObject({ns:p.partnerNamespace,campaign_id:e.abId,ab_id:e.abId,journey_id:e.journeyId,stats_type:window.btoa(JSON.stringify(i)),device_type:g.getDeviceType()},b.getUser());p.sendRequest(d.ONSITE_CAMPAIGN_STATS,a,5e3).then(function(i){try{if(r&&(t=t||{},!g.isEmptyObject(t))){var a=e.successEvent;t[e.abId].successEventPending=!0===a?"yes":"n/a",t[e.abId].holdOutCallToBeFired=!0,n.set("bluecoreSiteJourney",JSON.stringify(t)),a&&n.set("lastHoldOutId",e.abId)}}catch(e){v.d("holdOutStats sendRequest ",l.warning)}}).catch(function(e){})}else v.d("holdOutStats not fired because campaignData is not an Object",l.warning)}catch(e){v.d("holdOutStats "+e,l.error)}},dispatchedInlineWidget:function(e,t,r,i,a){try{S.processCouponCode(e,t.html,null,null,r).then(function(c){if(c)if(t.html=c,r.holdOut){var l=n.get("bluecoreSiteJourney"),u=!1;if(""!==l&&(l=JSON.parse(l),u=!l[e].hasOwnProperty("holdOutCallToBeFired"),!!u||l[e].holdOutCallToBeFired)){_.holdOutStats(r,l,u),S.setCampaignDetails(e,"views","inline"),o.getData("campaignDetails",null,null,null,null).then(function(e){g.validateKey(e)&&e.length>0&&(p.globalCampaignDetail=e)});var s=p.globalSessionDetailCurrent.campaignId;g.includes(e,s)||(s.push(e),p.globalSessionDetailCurrent.campaignId=s,o.setData("sessionDetails",{campaignId:s},["campaignId"],p.globalSessionDetailCurrent.sessionId))}}else{var d="<div referenceId="+e+" class='bluecoreRecomInline'>"+t.html+"</div>";bcQuery(a)[i](d),g.validateKey(t.js)&&bcQuery("[referenceId="+e+"]").append("<script>"+t.js+"<\/script>"),g.validateKey(t.css)&&bcQuery("[referenceId="+e+"]").append("<style>"+t.css+"</style>"),g.screenTransitionListener(e,r),g.trackCTAClick(e),_.campaignStats(e,"views","inline",r.abId,r.journeyId),g.addCouponInCampaignAttributes(e);var m=r.plugins||[];_.mappedPluginEvent(e,m,r),g.registerClickCall(m,e,"inline",r.abId,r.journeyId)}}).catch(function(e){v.d("processCouponCode timeout in inlineWidget "+l.info)})}catch(e){v.d("dispatchedInlineWidget "+e,l.error)}},c2pFetcher:function(e,t){try{if(setTimeout(function(){_c2pService.push(["executeRule",e.recipe,t])},50),!e.hasOwnProperty("recipe"))return!1;var r={},i={},n={},a="",o=null,c={set:function(e,t,i){if(r=i.result,a=i.campaignId,o=i.selector,"error"===t)n=g.mergeObject({ns:p.partnerNamespace,campaign_id:a,rec_key:b.getProductId(),error:window.btoa(r)},b.getUser()),p.sendRequest(d.ONSITE_ERROR,n,5e3).then(function(e){}).catch(function(e){});else if("attribution"===t){var c=g.mergeObject({event_type:"idb_add_to_carts",visitor_type:b.type(),referral:g.getReferrer(),session_id:p.globalSessionDetailCurrent.sessionId,page_url:window.location.href,goal_id:p.campaignAttributeMapping[a].goalId||""},b.getUser(),r);n=g.mergeObject({ns:p.partnerNamespace,campaign_id:a,stats_type:window.btoa(JSON.stringify(c))},b.getUser()),p.sendRequest(d.ONSITE_CAMPAIGN_STATS,n).then(function(e){}).catch(function(e){})}else{var l=i.supportedObject.callback;l(i)}}};window._c2pResponse||(window._c2pResponse=new Proxy(i,c))}catch(e){}},inlineC2P:function(e){var t=e.supportedObject,r=g.mergeObject({ns:p.partnerNamespace,campaign_id:t.campaignId,rec_key:b.getProductId(),selector:t.selector,position:t.innerPosis,data:window.btoa(JSON.stringify(e.result)),device_type:g.getDeviceType()},b.getUser());1===bcQuery(t.selector).length&&p.sendRequest(t.targetUrl,r).then(function(e){try{var r=JSON.parse(e);if(200===r.campaignStatus&&g.validateKey(r.html)){p.campaignAttributeMapping[t.campaignId].request_id=r.request_id||"";var i=r.position||t.innerPosis;_.userInteractionEventRegister(r.campaign_id,r,t.resp,t.technologyCriteria,"Inline",i,r.selector),_c2pService.push(["addAttribution",r.campaign_id,t.resp.recipe.queryname,p.globalSessionDetailCurrent.referrer])}}catch(e){v.d("inlineWidget Ajax Error else attribution"+e)}}).catch(function(e){})},inlineWidget:function(e,t,r){try{var i=e.campaignId,n=r,a=e.plugins||[],o="static"===e.htmlPathType?"static":"dynamic";if("replace"===n&&(n="html"),n=n||"append",""!==t&&"0"!==t){if(0===bcQuery(t).length)return!1;var c=g.fetchEndPointName(null,a,o,i),u=n,s=e.rule.attributes||null;if(!0===e.c2p&&c.indexOf("recs")>-1)_.c2pFetcher(e,{targetUrl:c,technologyCriteria:s,campaignId:i,resp:e,selector:t,innerPosis:n,callback:_.inlineC2P});else{var d=1e3,m=null;if("static"===o?d=5e3:m=g.mergeObject({type:"inline",ns:p.partnerNamespace,campaign_id:i,device_type:g.getDeviceType(),selector:t,position:n,rec_key:b.getProductId()},b.getUser()),!0===e.holdOut)try{_.userInteractionEventRegister(i,{},e,s,"Inline")}catch(e){}else p.sendRequest(c,m,d).then(function(r){try{g.verifyCampaignResponse(r,e)&&_.userInteractionEventRegister(i,r,e,s,"Inline",u,t)}catch(e){v.d("inlineWidget Ajax "+e)}}).catch(function(e){})}}}catch(e){v.d("inlineWidget "+e,l.warning)}},init:function(){try{_.fetchTargetingBase()}catch(e){v.d("init "+e,l.warning)}},initCampaignExecution:function(){try{p.templateTypes.AB?_.categorizedABWidget():(_.categorizedPopupWidget(),_.categorizedprefcenterWidget(),_.categorizedinfoBarWidget(),_.categorizedfullPageWidget())}catch(e){v.d("initCampaignExecution "+e,l.warning)}},registerActionTriggerEvent:function(e,t){try{if(e&&e.selector&&e.event){var r=!0;"click"===e.event&&bcQuery(e.selector).removeAttr("href"),bcQuery(e.selector).on(e.event,function(){try{r&&(r=!1,window.bluecore_action_trigger(t),setTimeout(function(){r=!0},1e3))}catch(e){}})}}catch(e){}},loadWidget:function(e){try{for(var t in e)if((parseInt(t)||0===parseInt(t))&&""!==e[t]){var r=e[t];if(p.campaignAttributeMapping[r.campaignId]=r,p.campaignAttributeMapping[r.campaignId].engaged_onsite=!0,e[t].actionTrigger)_.registerActionTriggerEvent(r.actionTriggerRules,r.campaignId);else if(!(r.deviceType===u.desktop&&g.getDeviceType()===u.mobile||r.deviceType===u.mobile&&g.getDeviceType()===u.desktop))if("prefcenter"===r.templateType)h.validate(r)&&p.activeCampaignArray.prefcenter.push(r);else if("popup"===r.templateType)h.validate(r)&&p.activeCampaignArray.popup.push(r);else if("infobar"===r.templateType)h.validate(r)&&p.activeCampaignArray.infoBar.push(r);else if("fullpage"===r.templateType)h.validate(r)&&p.activeCampaignArray.fullPage.push(r);else if("inline"===r.templateType&&h.validate(r)){g.commonCssLoad();var i="",n="",a=null;a=g.getDeviceType()===u.mobile?r.mobileSelector:r.desktopSelector,g.validateKey(a.element)&&(i=a.element),g.validateKey(a.type)&&(n=a.type),_.inlineWidget(r,i,n)}}_.initCampaignExecution()}catch(e){v.d("loadWidget "+e,l.error)}},preLoadABWidget:function(e){try{for(var t in e)if((parseInt(t)||0===parseInt(t))&&""!==e[t]){var r=e[t];r.deviceType===u.desktop&&g.getDeviceType()===u.mobile||r.deviceType===u.mobile&&g.getDeviceType()===u.desktop||"AB"===r.templateType&&h.validate(r)&&(p.activeCampaignArray.AB.push(r),p.campaignAttributeMapping[r.campaignId]=r,p.templateTypes.AB=!0)}!1===p.templateTypes.AB?_.loadWidget(e):!0===p.templateTypes.AB&&_.initCampaignExecution()}catch(e){v.d("loadWidget "+e,l.error)}},categorizedinfoBarWidget:function(){try{var e=p.activeCampaignArray.infoBar,t=e.length,r=[];for(var i in e)if("Object"===g.checkVariableType(e[i])){var n=e[i];g.validateKey(n.templateType)&&"infobar"===n.templateType&&r.push(n),t--,0===t&&_.showAllInfobar(r)}}catch(e){v.d("categorizedinfoBarWidget "+e,l.error)}},dispatchedInfobarWidget:function(e,t,r){try{S.processCouponCode(e,t.html,null,null,r).then(function(i){if(i){if(t.html=i,!r.holdOut){bcQuery("<div>",{class:p.bluecoreInfobarDisplayView+" bluecoreInfobarAnimation",referenceId:e,html:t.html}).appendTo("body"),g.validateKey(t.js)&&bcQuery("[referenceId="+e+"]").append("<script>"+t.js+"<\/script>"),g.validateKey(t.css)&&bcQuery("[referenceId="+e+"]").append("<style>"+t.css+"</style>");var n=r.plugins||[];g.registerClickCall(n,e,"infobar",r.abId,r.journeyId),bcQuery("[referenceId="+e+"] .bluecoreCloseButton").on("click",function(){_.campaignStats(e,"close","infobar",r.abId,r.journeyId),bcQuery("[referenceId="+e+"]").remove()}),g.closeCampaignOnEscape("[referenceId="+e+"]."+p.bluecoreInfobarDisplayView),g.screenTransitionListener(e,r),g.trackCTAClick(e)}r.hasOwnProperty("holdOut")&&g.stampingABJourney(r),_.campaignStats(e,"views","infobar",r.abId,r.journeyId),g.addCouponInCampaignAttributes(e);var n=r.plugins||[];_.mappedPluginEvent(e,n,r)}}).catch(function(e){v.d("processCouponCode timeout in infobarWidget "+l.info)})}catch(e){v.d("dispatchedInfobarWidget "+e,l.error)}},infobarC2P:function(e){var t=e.supportedObject,r=g.mergeObject({ns:p.partnerNamespace,campaign_id:t.campaignId,rec_key:b.getProductId(),data:window.btoa(JSON.stringify(e.result)),device_type:g.getDeviceType(),type:"infobar"},b.getUser());p.sendRequest(t.targetUrl,r).then(function(e){try{var r=JSON.parse(e);200===r.campaignStatus&&g.validateKey(r.html)&&(p.campaignAttributeMapping[t.campaignId].request_id=r.request_id||"",_.userInteractionEventRegister(r.campaign_id,r,t.response,t.technologyCriteria,"Infobar"))}catch(e){v.d("showAllInfobar Ajax "+e)}}).catch(function(e){})},showAllInfobar:function(e){try{var t=e;if(!p.templateTypes.infoBar)return!1;t=g.arrangePriority(t);var r=0;if(t.length>0){g.validateKey(n.get("bluecoreSiteALI"))?(r=parseInt(n.get("bluecoreSiteALI")),r++,t.length>r?n.set("bluecoreSiteALI",r,0,5e5):(r=0,n.set("bluecoreSiteALI",0,0,5e5))):n.set("bluecoreSiteALI","0",0,5e5);var i=t[r],a=i.rule.attributes||null;p.templateTypes.infobar=!1,g.commonCssLoad();var o=i.campaignId,c=i.plugins||[],u="static"===i.htmlPathType?"static":"dynamic",s=g.fetchEndPointName(null,c,u,o);if(p.bluecoreInfobarDisplayView="bluecore-top-sticky-widget"===i.displayView?"bluecore-top-sticky-widget":"bluecore-bottom-sticky-widget",!0===i.c2p&&s.indexOf("recs")>-1)_.c2pFetcher(i,{targetUrl:s,technologyCriteria:a,campaignId:o,response:i,callback:_.infobarC2P});else{var d=1e3,m=null;"static"===u?d=5e3:m=g.mergeObject({type:"infobar",ns:p.partnerNamespace,campaign_id:o,device_type:g.getDeviceType()},b.getUser()),p.sendRequest(s,m,d).then(function(e){try{g.verifyCampaignResponse(e,i)&&_.userInteractionEventRegister(o,e,i,a,"Infobar")}catch(e){v.d("showAllInfobar Ajax "+e)}}).catch(function(e){})}}}catch(e){v.d("showAllInfobar "+e,l.error)}},categorizedfullPageWidget:function(){try{var e=p.activeCampaignArray.fullPage,t=e.length,r=[];for(var i in e)if("Object"===g.checkVariableType(e[i])){var n=e[i];g.validateKey(n.templateType)&&"fullpage"===n.templateType&&r.push(n),t--,0===t&&_.showAllFullPage(r)}}catch(e){v.d("categorizedfullPageWidget "+e,l.error)}},dispatchedFullPageWidget:function(e,t,r){try{S.processCouponCode(e,t.html,null,null,r).then(function(i){if(p.templateTypes.popupShow)return!1;if(i){if(t.html=i,!r.holdOut){p.templateTypes.fullPageShow=!0,bcQuery("<div>",{class:"bluecoreFullScreen bluecoreFullPageOverlayAnimation",referenceId:e,html:t.html}).appendTo("body"),g.validateKey(t.js)&&bcQuery("[referenceId="+e+"]").append("<script>"+t.js+"<\/script>"),g.validateKey(t.css)&&bcQuery("[referenceId="+e+"]").append("<style>"+t.css+"</style>");var n=r.plugins||[];g.registerClickCall(n,e,"fullpage",r.abId,r.journeyId),bcQuery("[referenceId="+e+"] .bluecoreCloseButton").on("click",function(){_.campaignStats(e,"close","fullpage",r.abId,r.journeyId),bcQuery("[referenceId="+e+"]").remove()}),g.closeCampaignOnEscape(".bluecoreFullPageOverlayAnimation");var n=r.plugins||[];g.screenTransitionListener(e,r),g.trackCTAClick(e)}r.hasOwnProperty("holdOut")&&g.stampingABJourney(r),_.campaignStats(e,"views","fullpage",r.abId,r.journeyId),g.addCouponInCampaignAttributes(e),_.mappedPluginEvent(e,n,r)}}).catch(function(e){v.d("processCouponCode timeout in FullPageWidget "+l.info)})}catch(e){v.d("dispatchedFullPageWidget "+e,l.error)}},fullPageC2P:function(e){var t=e.supportedObject,r=g.mergeObject({ns:p.partnerNamespace,campaign_id:t.campaignId,rec_key:b.getProductId(),data:window.btoa(JSON.stringify(e.result)),device_type:g.getDeviceType(),type:"fullpage"},b.getUser());p.sendRequest(t.targetUrl,r).then(function(e){try{var r=JSON.parse(e);200===r.campaignStatus&&g.validateKey(r.html)&&(p.campaignAttributeMapping[t.campaignId].request_id=r.request_id||"",_.userInteractionEventRegister(r.campaign_id,r,t.response,t.technologyCriteria,"FullPage"))}catch(e){v.d("showAllFullPage Ajax "+e)}}).catch(function(e){})},showAllFullPage:function(e){try{var t=e;if(!p.templateTypes.fullPage)return!1;t=g.arrangePriority(t);var r=0;if(t.length>0){g.validateKey(n.get("bluecoreSiteALF"))?(r=parseInt(n.get("bluecoreSiteALF")),r++,t.length>r?n.set("bluecoreSiteALF",r,0,5e5):(r=0,n.set("bluecoreSiteALF",0,0,5e5))):n.set("bluecoreSiteALF","0",0,5e5);var i=t[r],a=i.rule.attributes||null;p.templateTypes.fullPage=!1,g.commonCssLoad();var o=i.campaignId,c=i.plugins||[],u="static"===i.htmlPathType?"static":"dynamic",s=g.fetchEndPointName(null,c,u,o);if(!0===i.c2p&&s.indexOf("recs")>-1)_.c2pFetcher(i,{campaignId:o,targetUrl:s,response:i,technologyCriteria:a,callback:_.fullPageC2P});else{var d=1e3,m=null;"static"===u?d=5e3:m=g.mergeObject({type:"fullpage",ns:p.partnerNamespace,campaign_id:o,device_type:g.getDeviceType()},b.getUser()),p.sendRequest(s,m,d).then(function(e){try{g.verifyCampaignResponse(e,i)&&_.userInteractionEventRegister(o,e,i,a,"FullPage")}catch(e){v.d("showAllFullPage Ajax "+e)}}).catch(function(e){})}}}catch(e){v.d("showAllFullpage "+e,l.error)}},categorizedABWidget:function(){try{var e=p.activeCampaignArray.AB,t=e.length,r=[];e.forEach(function(e){var i=e;g.validateKey(i.templateType)&&"AB"===i.templateType&&r.push(i),0===--t&&_.showAllAB(r)})}catch(e){v.d("categorizedABWidget "+e,l.error)}},mergeOriginalCampaignWithAB:function(e){try{var t=d.PROJECTSETTINGDATA.targeting.apps,r=t.filter(function(e,t){return"AB"!==e.templateType});e&&e.forEach(function(e){r.push(e)}),d.PROJECTSETTINGDATA.targeting.apps=r,p.templateTypes.AB=!1,_.loadWidget(d.PROJECTSETTINGDATA.targeting.apps)}catch(e){v.d("mergeOriginalCampaignWithAB "+e,l.error)}},setOrUpdateRetryRandomizer:function(){try{var e={};e.retryFailThreshold=p.retryFailThreshold,e.timeToWait=Date.now()+1e3*p.timeToWait,t.set("retryRandomizer",JSON.stringify(e))}catch(e){v.d("setOrUpdateRetryRandomizer "+e,l.error)}},retryRandomizerCheck:function(){try{var e=t.get("retryRandomizer");e&&(e=JSON.parse(e),e.retryFailThreshold-=1,e.retryFailThreshold<=0&&(e.retryFailThreshold=0),0===e.retryFailThreshold&&(e.timeToWait=Date.now()+1e3*p.timeToWait),t.set("retryRandomizer",JSON.stringify(e))),_.mergeOriginalCampaignWithAB(null)}catch(e){v.d("retryRandomizerCheck "+e,l.info)}},callRandomizer:function(e,t,r){try{p.sendRequest(e,t).then(function(e){try{if(200===e.campaignStatus&&""!==e.journeyId){var t=d.ONSITE_AB_TARGETING_URL+e.journeyId+".json";p.sendRequest(t,null,5e3).then(function(t){g.stampJourney("bluecoreSiteJourney",r,e.journeyId,t.expireDays),t.campaigns.length>0?(t.holdOut&&t.hasOwnProperty("successEvent")&&(t.campaigns[0].holdOut=t.holdOut,t.campaigns[0].successEvent=t.successEvent),_.mergeOriginalCampaignWithAB(t.campaigns)):_.mergeOriginalCampaignWithAB(null)}).catch(function(e){_.mergeOriginalCampaignWithAB(null)}),_.setOrUpdateRetryRandomizer()}else _.mergeOriginalCampaignWithAB(null)}catch(e){v.d("callRandomizer inner "+e),_.mergeOriginalCampaignWithAB(null)}}).catch(function(e){_.retryRandomizerCheck()})}catch(e){v.d("callRandomizer Ajax "+e),_.retryRandomizerCheck()}},shouldHitRandomizer:function(){try{var e=t.get("retryRandomizer");return e?(e=JSON.parse(e),e.retryFailThreshold>0||e.timeToWait<Date.now()&&(e.timeToWait=Date.now()+1e3*p.timeToWait,t.set("retryRandomizer",JSON.stringify(e)),!0)):(_.setOrUpdateRetryRandomizer(),!0)}catch(e){return!0}},showAllAB:function(e){try{var t=g.arrangePriority(e),r=0;if(t.length>0){g.validateKey(n.get("bluecoreSiteAB"))?(r=parseInt(n.get("bluecoreSiteAB")),r++,t.length>r?n.set("bluecoreSiteAB",r,0,5e5):(r=0,n.set("bluecoreSiteAB",0,0,5e5))):n.set("bluecoreSiteAB","0",0,5e5);var i=t[r],a=i.campaignId,o={},c="",u=g.fetchJourney("bluecoreSiteJourney",a);if(u){var s=d.ONSITE_AB_TARGETING_URL+u+".json";p.sendRequest(s,null,5e3).then(function(e){var t=e.winnerStatus||0;if(1===t||0===t)g.updateJourneyExpiryDate("bluecoreSiteJourney",a,u,e.expireDays),e.campaigns.length>0?(e.holdOut&&e.hasOwnProperty("successEvent")&&(e.campaigns[0].holdOut=e.holdOut,e.campaigns[0].successEvent=e.successEvent),_.mergeOriginalCampaignWithAB(e.campaigns)):_.mergeOriginalCampaignWithAB(null);else if(-1===t){g.updateJourneyExpiryDate("bluecoreSiteJourney",a,u,0);var r=_.shouldHitRandomizer();r?(c=d.APIURL("randomizer"),o=g.mergeObject({ns:p.partnerNamespace,campaign_id:a}),_.callRandomizer(c,o,a)):_.mergeOriginalCampaignWithAB(null)}else _.mergeOriginalCampaignWithAB(null)}).catch(function(e){_.mergeOriginalCampaignWithAB(null)})}else{c=d.APIURL("randomizer"),o=g.mergeObject({ns:p.partnerNamespace,campaign_id:a});_.shouldHitRandomizer()?_.callRandomizer(c,o,a):_.mergeOriginalCampaignWithAB(null)}}}catch(e){v.d("showAllAB "+e,l.error),_.mergeOriginalCampaignWithAB(null)}},categorizedPopupWidget:function(){try{var e=p.activeCampaignArray.popup,t=e.length,r=[];for(var i in e)if("Object"===g.checkVariableType(e[i])){var n=e[i];g.validateKey(n.templateType)&&"popup"===n.templateType&&r.push(n),t--,0===t&&_.showAllPopup(r)}}catch(e){v.d("categorizedPopupWidget "+e,l.error)}},updateRuleAndBlockIndex:function(e,t,r,i,n){try{void 0==n&&(n=1),t&&r&&(h.technologyCriteriaMapping[e].blockResult[t][r]=n);return g.calculateSingleRuleResult(i.interBlockOperator,function(t){var r=[];return t.blockResult.forEach(function(n,a){r.push(g.calculateSingleRuleResult(h.technologyCriteriaMapping[e].blockOperator[a],t.blockResult[a],i.interBlockOperator))}),r}(h.technologyCriteriaMapping[e]))}catch(e){return 0}},userInteractionEventRegisterCallback:function(e,t,r,i,n,a,o,c,l,u){try{var s=m.isLanguageDrawerClosed(),d=_.updateRuleAndBlockIndex(i,e,t,n,r);if(0===d&&u||u&&!s)return void(h.technologyCriteriaMapping[i].blockResult[e][t]=0);s&&m.checkUserState(n)&&d&&!g.includes(i,p.viewedCampaignListThisPage)&&(p.viewedCampaignListThisPage.push(i),m.isEnterpriseCustomer()?p.hasNotSeenAnyCampaign&&(_["dispatched"+a+"Widget"](i,o,n,c,l),m.registerUniteCloseEvent(i,n.templateType,n)):_["dispatched"+a+"Widget"](i,o,n,c,l))}catch(e){}},userInteractionEventRegister:function(e,t,r,i,n,a,o){try{if("OR"===r.interBlockOperator&&p.campaignTargetingResult[e]&&_.userInteractionEventRegisterCallback(null,null,1,e,r,n,t,a,o,!1),h.technologyCriteriaMapping[e].technologyCriteria)for(var c in i){var l=i[c].ruleBlock;if("Array"===g.checkVariableType(l))for(var s in l)"Object"===g.checkVariableType(l[s])&&"technologyCriteria"===l[s].criteriaKey&&("cookie"===l[s].technologyBase?(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,bcQuery("body").bluecoreSite_cookiesWatcher({campaignId:e,metaData:l[s],blockIndex:c,ruleIndex:s,callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!1)}})):"evaluateJs"===l[s].technologyBase?(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,bcQuery("body").bluecoreSite_evaluateJsWatcher({campaignId:e,metaData:l[s],blockIndex:c,ruleIndex:s,callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!1)}})):"hasIntentToLeave"===l[s].technologyBase?(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,g.getDeviceType()===u.mobile?bcQuery("body").bluecoreSite_mobileIntent({blockIndex:c,ruleIndex:s,callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!0)}}):bcQuery("body").bluecoreSite_exitIntent({campaignId:e,blockIndex:c,ruleIndex:s,callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!0)}})):"idle"===l[s].technologyBase?(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,bcQuery("body").bluecoreSite_userIdle({blockIndex:c,ruleIndex:s,idleTime:l[s].technologyValue||0,metaData:l[s],callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!1)}})):"pageScrolled"===l[s].technologyBase?(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,bcQuery("body").bluecoreSite_pageScroll({campaignId:e,blockIndex:c,ruleIndex:s,metaData:l[s],scrollValue:l[s].scrollValue||0,
scrollType:l[s].scrollBase,callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!1)}})):"matchingElement"===l[s].technologyBase?(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,bcQuery("body").bluecoreSite_elementWatcher({campaignId:e,operator:l[s].elementOperator,metaData:l[s],blockIndex:c,ruleIndex:s,callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!1)}})):"timeSpent"===l[s].technologyBase&&(p.loadEnable=!0,h.technologyCriteriaMapping[e].blockResult[c][s]=0,bcQuery("body").bluecoreSite_timeSpent({blockIndex:c,ruleIndex:s,watchTime:l[s].technologyValue||0,metaData:l[s],callback:function(i,c,l){_.userInteractionEventRegisterCallback(i,c,l,e,r,n,t,a,o,!1)}})))}else m.isEnterpriseCustomer()?p.hasNotSeenAnyCampaign&&(_["dispatched"+n+"Widget"](e,t,r,a,o),m.registerUniteCloseEvent(e,r.templateType,r)):_["dispatched"+n+"Widget"](e,t,r,a,o)}catch(e){}},dispatchedPrefcenterWidget:function(e,t,r,i,n){try{if(!r.holdOut){if(g.validateKey(t.html)){var a=bcQuery("<div>",{referenceId:e,class:"bluecoreInlinePreferenceCenter",html:t.html});bcQuery(n)[i](a),g.validateKey(t.js)&&bcQuery("[referenceId="+e+"]").append("<script>"+t.js+"<\/script>"),g.validateKey(t.css)&&bcQuery("[referenceId="+e+"]").append("<style>"+t.css+"</style>")}r.hasOwnProperty("holdOut")&&g.stampingABJourney(r),_.campaignStats(e,"views","prefcenter",r.abId,r.journeyId),g.addCouponInCampaignAttributes(e),g.screenTransitionListener(e,r),g.trackCTAClick(e),_.submitPreferences(e,!1)}}catch(e){v.d("dispatchedPrefcenterWidget "+e,l.error)}},dispatchedPopupWidget:function(e,t,r){try{S.processCouponCode(e,t.html,null,null,r).then(function(i){if(p.templateTypes.fullPageShow)return!1;if(i){if(t.html=i,!r.holdOut){0===bcQuery(".bluecoreOverlay").length&&bcQuery("<div>",{class:"bluecoreOverlay"}).appendTo("body"),p.templateTypes.popupShow=!0,bcQuery("<div>",{referenceId:e,class:p.bluecorePopupDisplayView+" bluecorePopupOverlayAnimation",html:t.html}).appendTo("body"),g.validateKey(t.js)&&bcQuery("[referenceId="+e+"]").append("<script>"+t.js+"<\/script>"),g.validateKey(t.css)&&bcQuery("[referenceId="+e+"]").append("<style>"+t.css+"</style>");var n=r.plugins||[];g.registerClickCall(n,e,"popup",r.abId,r.journeyId),bcQuery("body").delegate(".bluecoreOverlay","click",function(){bcQuery("[referenceId="+e+"] .bluecoreCloseButton").trigger("click")}),bcQuery("[referenceId="+e+"] .bluecoreCloseButton").on("click",function(){_.campaignStats(e,"close","popup",r.abId,r.journeyId),bcQuery(".bluecoreOverlay").remove(),bcQuery("[referenceId="+e+"]").remove()}),g.closeCampaignOnEscape(".bluecorePopupOverlayAnimation"),g.screenTransitionListener(e,r),g.trackCTAClick(e)}_.campaignStats(e,"views","popup",r.abId,r.journeyId),g.addCouponInCampaignAttributes(e);var n=r.plugins||[];_.mappedPluginEvent(e,n,r)}}).catch(function(e){v.d("processCouponCode timeout in popupWidget "+l.info)})}catch(e){v.d("dispatchedPopupWidget "+e,l.error)}},popupC2P:function(e){var t=e.supportedObject,r=g.mergeObject({ns:p.partnerNamespace,campaign_id:t.campaignId,rec_key:b.getProductId(),data:window.btoa(JSON.stringify(e.result)),device_type:g.getDeviceType(),type:"popup"},b.getUser());p.sendRequest(t.targetUrl,r).then(function(e){try{var r=JSON.parse(e);200===r.campaignStatus&&g.validateKey(r.html)&&(p.campaignAttributeMapping[t.campaignId].request_id=r.request_id||"",_.userInteractionEventRegister(r.campaign_id,r,t.response,t.technologyCriteria,"Popup"))}catch(e){v.d("showAllPopup Ajax "+e)}}).catch(function(e){})},showAllPopup:function(e){try{if(!p.templateTypes.popup)return!1;var t=g.arrangePriority(e),r=0;if(t.length>0){g.validateKey(n.get("bluecoreSiteALP"))?(r=parseInt(n.get("bluecoreSiteALP")),r++,t.length>r?n.set("bluecoreSiteALP",r,0,5e5):(r=0,n.set("bluecoreSiteALP",0,0,5e5))):n.set("bluecoreSiteALP","0",0,5e5);var i=t[r],a=i.displayView,o=i.rule.attributes||null,c={TL:"bluecoreUpperLeftPopup",TC:"bluecoreUpperMiddlePopup",TR:"bluecoreUpperRightPopup",ML:"bluecoreMiddleLeftPopup",MC:"bluecoreMiddleCenterPopup",MR:"bluecoreMiddleRightPopup",BL:"bluecoreLowerLeftPopup",BC:"bluecoreLowerMiddlePopup",BR:"bluecoreLowerRightPopup"};p.bluecorePopupDisplayView=c[a]?c[a]:"bluecoreMiddleCenterPopup",c=null,p.templateTypes.popup=!1,g.commonCssLoad();var u=i.campaignId,s=i.plugins||[],d="static"===i.htmlPathType?"static":"dynamic",m=g.fetchEndPointName(null,s,d,u);if(!0===i.c2p&&m.indexOf("recs")>-1)_.c2pFetcher(i,{targetUrl:m,campaignId:u,technologyCriteria:o,response:i,callback:_.popupC2P});else{var f=1e3,y=null;"static"===d?f=5e3:y=g.mergeObject({type:"popup",ns:p.partnerNamespace,campaign_id:u,device_type:g.getDeviceType()},b.getUser()),p.sendRequest(m,y,f).then(function(e){try{g.verifyCampaignResponse(e,i)&&_.userInteractionEventRegister(u,e,i,o,"Popup")}catch(e){v.d("showAllPopup Ajax "+e)}}).catch(function(e){})}}}catch(e){v.d("showAllPopup "+e,l.error)}},categorizedprefcenterWidget:function(){try{var e=p.activeCampaignArray.prefcenter,t=e.length,r=[];for(var i in e)if("Object"===g.checkVariableType(e[i])){var n=e[i];g.validateKey(n.templateType)&&"prefcenter"===n.templateType&&r.push(n),t--,0===t&&_.showAllPrefcenter(r)}}catch(e){v.d("categorizedprefcenterWidget "+e,l.error)}},prefcenterC2P:function(e){var t=e.supportedObject,r=g.mergeObject({ns:p.partnerNamespace,campaign_id:t.campaignId,rec_key:b.getProductId(),data:window.btoa(JSON.stringify(e.result)),device_type:g.getDeviceType(),selector:t.selector,position:t.position,type:"prefcenter"},b.getUser());1===bcQuery(t.selector).length&&p.sendRequest(t.targetUrl,r).then(function(e){try{var r=JSON.parse(e);200===r.campaignStatus&&_.userInteractionEventRegister(r.campaign_id,r,t.response,t.technologyCriteria,"Prefcenter",r.position,r.selector)}catch(e){v.d("showAllPrefcenter Ajax "+e)}}).catch(function(e){})},showAllPrefcenter:function(e){try{var t=e;if(!p.templateTypes.prefcenter)return!1;t=g.arrangePriority(t);var r=0;if(t.length>0){g.validateKey(n.get("bluecoreSiteALPF"))?(r=parseInt(n.get("bluecoreSiteALPF")),r++,t.length>r?n.set("bluecoreSiteALPF",r,0,5e5):(r=0,n.set("bluecoreSiteALPF",0,0,5e5))):n.set("bluecoreSiteALPF","0",0,5e5);var i=t[r];p.templateTypes.prefcenter=!1,g.commonCssLoad();var a=i.campaignId,o=i.rule.attributes||null,c="-no-selector-found-",s="append",d=null;d=g.getDeviceType()===u.mobile?i.mobileSelector:i.desktopSelector,g.validateKey(d.element)&&(c=d.element),g.validateKey(d.type)&&(s=d.type);var m=i.plugins||[],f=g.fetchEndPointName(null,m);if(!0===i.c2p)_.c2pFetcher(i,{targetUrl:f,campaignId:a,selector:c,position:s,response:i,technologyCriteria:o,callback:_.prefcenterC2P});else{var y=g.mergeObject({type:"prefcenter",ns:p.partnerNamespace,campaign_id:a,device_type:g.getDeviceType()},b.getUser());1===bcQuery(c).length&&p.sendRequest(g.fetchEndPointName(null,m),y).then(function(e){try{var t=JSON.parse(e);200===t.campaignStatus&&_.userInteractionEventRegister(a,t,i,o,"Prefcenter",s,c)}catch(e){v.d("showAllPrefcenter Ajax "+e)}}).catch(function(e){})}}}catch(e){v.d("showAllPrefcenter "+e,l.error)}},getAllApp:function(){try{!0===d.PROJECTSETTINGDATA.targeting.locationEnabled&&g.fetchLocation(),!0===d.PROJECTSETTINGDATA.targeting.audienceEnabled?g.fetchAudience():_.projectSetting()}catch(e){}},fetchTargetingBase:function(){try{var e=g.invalidateUrlCache(d.ONSITE_TARGETING_URL,"targeting",p.targetingUrlExpireTime);p.sendRequest(e,null,5e3).then(function(e){d.PROJECTSETTINGDATA=e,p.isLoadingComplete=!0,S.init()}).catch(function(e){})}catch(e){v.d("fetchTargetingBase "+e,l.warning)}},projectSetting:function(){try{var e=d.PROJECTSETTINGDATA,t=e.targeting;t.apps.length>0&&p.isLoadingComplete&&(p.isLoadingComplete=!1,"Object"===g.checkVariableType(t)&&(t.c2pEnable&&"function"==typeof __INIT_ONSITE_RECS&&__INIT_ONSITE_RECS(0),!0===t.abEnable?(p.retryFailThreshold=t.retryFailThreshold,p.timeToWait=t.timeToWait,_.preLoadABWidget(t.apps),_.successEvent()):_.loadWidget(t.apps)))}catch(e){v.d("projectSetting "+e,l.error)}},changeUserSubscribe:function(e,t){var r={event:e,properties:{mp_lib:"web",token:p.partnerNamespace,source_detail:p.source_detail,event_source:p.event_source,email:t,distinct_id:t,url:window.location.href||"",browser:p.bluecoreDeviceInfo.browser||"",os:p.bluecoreDeviceInfo.os||""}};bcQuery.post("https://api.bluecore.com/api/track/"+e,{data:window.btoa(JSON.stringify(r))})},welcomeMailer:function(e){try{var t=p.campaignAttributeMapping[e].welcomeSeriesCampaignId;if(g.validateKey(t)&&g.isEmail(p.userInputEmail)){var r={newsletter_name:p.userInputEmail},i={promo_options:{bluecore_listId:t},welcome_coupon:p.campaignAttributeMapping[e].coupon_code||""},n=window.btoa(JSON.stringify({partner:p.partnerNamespace,email:p.userInputEmail,campaign_id:e,template_attributes:i,customer_attributes:r}));p.sendRequest(d.WELCOME_EMAIL+p.partnerNamespace,"data="+n,2e3,"POST").then(function(e){}).catch(function(e){})}}catch(e){v.d("welcomeMailer "+err,l.error)}},sendEmailCaptureEvent:function(e,t){try{var r=g.mergeObject({event_type:"email_capture",attribution:!0,distinct_id:p.userDistinctId,email:p.userInputEmail,page_url:window.location.href,coupon_code:p.campaignAttributeMapping[e].coupon_code||"",goal_id:p.campaignAttributeMapping[e].goalId||"",form_json:t,vendor:p.campaignAttributeMapping[e].vendor||1}),i=g.mergeObject({ns:p.partnerNamespace,campaign_id:e,ab_id:p.campaignAttributeMapping[e].abId||"",journey_id:p.campaignAttributeMapping[e].journeyId||"",stats_type:window.btoa(JSON.stringify(r)),device_type:g.getDeviceType()},b.getUser());p.sendRequest(d.ONSITE_CAMPAIGN_STATS,i,5e3).then(function(e){_.updateHoldOutData()}).catch(function(e){}),g.custom_event_record("emailCaptured",g.eventDataBuilder(e,t,null,null)),_.welcomeMailer(e)}catch(e){}},submitPreferences:function(e,t,r){function i(i,n){var a=triggermail.lytics.get_property("email"),o=g.getObem();g.isEmail(i)?bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").attr("readonly",!0):o?bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").parent().remove():bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").removeAttr("readonly"),t||bcQuery("[referenceId="+e+"]").one("click",function(){_.campaignStats(e,"clicks","prefcenter",r.abId,r.journeyId)});var c=i||a;if(p.userInputEmail=g.isEmail(c)?c:null,p.userInputEmail||o){n.source_detail=p.source_detail,n.event_source=p.event_source;var l={event:"customer_patch",properties:{distinct_id:p.userInputEmail,email:p.userInputEmail,customer:n,obem:o||"",token:p.partnerNamespace}};bcQuery.post("https://api.bluecore.com/api/track","data="+window.btoa(JSON.stringify(l)),function(){t&&(_.sendEmailCaptureEvent(e,n),p.campaignAttributeMapping[e].user_email=p.userInputEmail||"","true"===bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureSubmit").attr("unsubscribe")?_.changeUserSubscribe("unsubscribe",p.userInputEmail):triggermail.track("optin",{source_detail:p.source_detail,event_source:p.event_source,email:p.userInputEmail},p.userInputEmail)),_.campaignStats(e,"clicks",p.campaignAttributeMapping[e].templateType,r.abId,r.journeyId),bcQuery("[referenceId="+e+"] .bluecoreConfirmationScreen").length>0?(bcQuery("[referenceId="+e+"] .bluecoreActionScreen").fadeOut(1e3,function(){if(bcQuery("[referenceId="+e+"] .bluecoreConfirmationScreen").fadeIn(1e3),bcQuery("[referenceId="+e+"] .bluecoreActionScreen").remove(),bcQuery.trim(p.campaignAttributeMapping[e].coupon_code).length>0){var t=bcQuery("[referenceId="+e+"] .bluecoreCouponBox");"INPUT"===t.prop("nodeName")?t.val(p.campaignAttributeMapping[e].coupon_code):t.text(p.campaignAttributeMapping[e].coupon_code)}}),setTimeout(function(){g.copyToClipboardRegister(e)},1002)):bcQuery("[referenceId="+e+"]").remove()}),bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureSubmit").unbind("click")}}try{!function(){function t(e,t,r,i){try{if(!t)return!1;if(e.length<r||e.length>i)return!1;var t=new RegExp(t);return!!t.exec(e)}catch(e){return!1}}function n(e,r){var i,n,a=!0,o="";i="email"===(bcQuery(e).attr("name")||bcQuery(e).prop("type"))?"email":bcQuery(e).attr("type")||bcQuery(e).prop("type"),n=bcQuery.trim(bcQuery(e).val());var c=bcQuery(e).data("customcheck")||!1,l=bcQuery(e).data("min")||0,u=bcQuery(e).data("max")||Math.pow(10,1e3),p=bcQuery(e).data("specialchars")||!1,d=bcQuery(e).data("numeric")||!1,m=bcQuery(e).attr("required");if(-1===bcQuery.inArray(bcQuery(e).prop("type"),["radio","checkbox"])){if(bcQuery(e).hasClass("bluecoreEmailCaptureEmailVerify")){(bcQuery.trim(bcQuery(r).find(".bluecoreEmailCaptureEmail").val())||"")!==n&&(a=!1)}if(m&&!n)a=!1,o="Required but value not found";else if(m||n)if(c){var f=bcQuery(e).attr("regex"),y=t(n,f,l,u);y||(a=!1,o="Custom check failed")}else s[i]&&!s[i](n,l,u,m,p,d)&&(a=!1,o="Invalid Value");else a=!0,o="Not required and value not found"}else{var h=bcQuery(e).data("off");""!==h&&"Undefined"!==g.checkVariableType(h)||(h=void 0),m&&!bcQuery(e).is(":checked")?(a=!1,o="Required but value not found",n=h):n=bcQuery(e).is(":checked")?bcQuery(e).data("on"):h}return{type:i,value:n,isValid:a,errorMsg:o}}function a(e){c=bcQuery(e).closest(".bluecoreEmailCaptureForm"),u=[];var t=[];c.find("input,select").each(function(e,r){t.push(r)}),t.forEach(function(e){u.indexOf(e.name)<0&&"bluecoreEmailCaptureSubmit"!==e.name&&u.push(e)}),u.forEach(function(e){"HTMLInputElement"===g.checkVariableType(e)&&bcQuery(e).hasClass("requiredField")&&bcQuery(e).attr("required",!0)})}function o(e){return Object.keys(e).forEach(function(t,r){if("Array"===g.checkVariableType(e[t]))if(0===e[t].length)delete e[t];else if(1===e[t].length)e[t]=e[t][0];else if(e[t].length>1){var i=0,n="";for(var a in e[t])e[t][a]&&(i++,n=e[t][a]);1===i&&(e[t]=n),i||delete e[t]}"String"!==g.checkVariableType(e[t])||e[t]||delete e[t]}),e||{}}try{var c,u=[],s={number:function(e,t,r,i){return g.isInteger(Number(e))&&parseInt(e)>=t&&parseInt(e)<=r},text:function(e,t,r,i,n,a){try{var o=/^[A-Za-z(\s)*]+$/,c=/^[A-Za-z0-9(\s)*]+$/,l=/^[A-Za-z(@#$%^&*!)(\s)*]+$/,u=/^[A-Za-z0-9(@#$%^&*!,._:\-\/\(\)+)(\s)*]+$/,s=function(e,t,r){return function(i){return!!(e.match(i)&&e.length>=t&&e.length<=r)}}(e,t,r),p=!0;return i||e?(p=s(o),a&&!n?p=s(c):n&&!a?s(l):a&&n&&(p=s(u)),p):p}catch(e){return!1}},email:function(e){return!!/^\w+([A-Za-z0-9(\.!#$%&'*+\-\/?^_`{|}~)]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,6})+$/.test(e)},"number-text":function(e,t,r,i){return!i&&!e||g.isInteger(Number(e))&&e.length>=t&&e.length<=r}};showErrorBorderAndText=function(e,t,r){var i=bcQuery(e).parents(".bluecoreEmailCaptureFormElement").find(".bluecoreEmailCaptureError"),n=bcQuery(e).parents(".bluecoreEmailCaptureInvalidBorder");i.length||(i=bcQuery(e).parent().find(".bluecoreEmailCaptureError")),n.length||(n=bcQuery(e).parent().find(".bluecoreEmailCaptureInvalidBorder")),i&&i.hasClass("bluecoreEmailCaptureError")&&(i.removeClass("bluecoreEmailCaptureError"),i.addClass("bluecoreEmailCaptureErrorInput")),bcQuery(e).hasClass("bluecoreEmailCaptureInvalidBorder")&&bcQuery(e).addClass("bluecoreEmailCaptureInvalidBorderRed"),n.length>0&&(bcQuery.inArray(bcQuery(e).prop("type"),["radio","checkbox"]),n.addClass("bluecoreEmailCaptureInvalidBorderRed"))},removeErrorBorderAndText=function(e,t,r){var i=bcQuery(e).parents(".bluecoreEmailCaptureFormElement").find(".bluecoreEmailCaptureErrorInput"),n=bcQuery(e).parents(".bluecoreEmailCaptureInvalidBorder");i.length||(i=bcQuery(e).parent().find(".bluecoreEmailCaptureErrorInput")),n.length||(n=bcQuery(e).parent().find(".bluecoreEmailCaptureInvalidBorder")),i&&i.hasClass("bluecoreEmailCaptureErrorInput")&&(i.removeClass("bluecoreEmailCaptureErrorInput"),i.addClass("bluecoreEmailCaptureError")),bcQuery(e).hasClass("bluecoreEmailCaptureInvalidBorderRed")&&bcQuery(e).removeClass("bluecoreEmailCaptureInvalidBorderRed"),n.length>0&&(bcQuery.inArray(bcQuery(e).prop("type"),["radio","checkbox"])>=0&&t[bcQuery(e).attr("name")].length,n.removeClass("bluecoreEmailCaptureInvalidBorderRed"))};var p=function(t){try{a(t.target),t.preventDefault();var s={};s.radioCheck=!0,s.regularCheck=!0,s.emailCheck=!0;var p=null,d=null;u.forEach(function(e){var t=n(e,c);if(bcQuery.inArray(bcQuery(e).prop("type"),["radio","checkbox"])>=0?bcQuery(e).attr("name")&&void 0===s[bcQuery(e).attr("name")]&&(s[bcQuery(e).attr("name")]=[]):"Undefined"!==g.checkVariableType(bcQuery(e).attr("name"))&&(s[bcQuery(e).attr("name")]=""),bcQuery.inArray(bcQuery(e).prop("type"),["radio","checkbox"])>=0?"Undefined"!==g.checkVariableType(t.value)&&s[bcQuery(e).attr("name")].push(t.value):s[bcQuery(e).attr("name")]=t.value,t&&t.isValid)if(p=s[bcQuery(e).attr("name")],d="radio"===bcQuery(e).attr("type"),p&&p.forEach&&d){var r=p.find(function(e){return!!e});r&&(removeErrorBorderAndText(e,s),s.radioCheck=t.isValid)}else removeErrorBorderAndText(e,s);else if(p=s[bcQuery(e).attr("name")],d="radio"===bcQuery(e).attr("type"),p&&p.forEach&&d){var r=p.find(function(e){return!!e});r||(showErrorBorderAndText(e,s),s.radioCheck=t.isValid)}else showErrorBorderAndText(e,s),s.regularCheck=t.isValid}),bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmailVerify").length>0&&bcQuery.trim(bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").val())!==bcQuery.trim(bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmailVerify").val())&&(s.emailCheck=!1),s.radioCheck&&s.regularCheck&&s.emailCheck&&(delete s.radioCheck,delete s.regularCheck,delete s.emailCheck,o(s),S.processCouponCode(e,null,null,!0,r).then(function(t){t&&i(bcQuery.trim(bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").val()),s)}).catch(function(e){}))}catch(e){v.d("submitHandler "+e,l.error)}};bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureSubmit").click(function(t){if(t.preventDefault(),r.bluecoreDuplicateEmailCheck){var i=bcQuery.trim(bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").val());g.isEmail(i)?g.bluecoreDuplicateEmailCheck(i,e).then(function(r){bcQuery("[referenceId="+e+"] .bluecoreDuplicateEmailCheckError").hide(),p(t),g.custom_event_record("duplicateEmail",{isValidEmail:!0,isEmailExists:!1,campaignID:e})}).catch(function(t){bcQuery("[referenceId="+e+"] .bluecoreDuplicateEmailCheckError").show(),g.custom_event_record("duplicateEmail",{isValidEmail:!0,isEmailExists:!0,campaignID:e})}):(p(t),g.custom_event_record("duplicateEmail",{isValidEmail:!1,isEmailExists:null,campaignID:e}))}else p(t)}),bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureEmail").keypress(function(t){"13"==(t.keyCode?t.keyCode:t.which)&&(bcQuery("[referenceId="+e+"] .bluecoreEmailCaptureSubmit").trigger("click"),t.preventDefault())})}catch(e){v.d("submitPreferences inner "+e,l.error)}}()}catch(e){v.d("submitPreferences "+e,l.error)}},mappedPluginEvent:function(e,t,r){var i=t;"Array"===g.checkVariableType(i)?(g.includes(g.plugins.emailCapture,i)?_.submitPreferences(e,!0,r):g.copyToClipboardRegister(e),g.includes(g.plugins.recs,i)&&bcQuery("[referenceId="+e+"]").bluecoreSite_DSlider({rotationDelay:200,selector:"[referenceId="+e+"]"})):g.copyToClipboardRegister(e)},successEvent:function(){try{if("known"===b.type()){var e=n.get("lastHoldOutId"),t=n.get("bluecoreSiteJourney"),r=_.getJourneyIdFromAbId(e,t);""!==e&&""!==t&&""!==r&&(t=JSON.parse(t),p.campaignAttributeMapping.hasOwnProperty(e)&&"yes"===t[e].successEventPending&&(_.fireSuccessEvent(e,r),t[e].holdOutCallToBeFired=!1,t[e].successEventPending="no",n.set("bluecoreSiteJourney",JSON.stringify(t)),n.remove("lastHoldOutId")))}}catch(e){}},fireSuccessEvent:function(e,t){try{var r=g.mergeObject({event_type:"ho_success",attribution:!0,visitor_type:b.type(),referral:g.getReferrer(),session_id:p.globalSessionDetailCurrent.sessionId,page_url:window.location.href,goal_id:p.abGoalId,distinct_id:p.userDistinctId},b.getUser()),i=g.mergeObject({ns:p.partnerNamespace,campaign_id:e,ab_id:e,journey_id:t,stats_type:window.btoa(JSON.stringify(r))},b.getUser());p.sendRequest(d.ONSITE_CAMPAIGN_STATS,i,5e3).then(function(e){}).catch(function(e){})}catch(e){}},getJourneyIdFromAbId:function(e,t){try{return""!==t&&(t=JSON.parse(t),t.hasOwnProperty(e))?t[e].journeyId:""}catch(e){}},updateHoldOutData:function(){try{var e=n.get("lastHoldOutId"),t=n.get("bluecoreSiteJourney");""!==e&&""!==t&&(t=JSON.parse(t),t.hasOwnProperty(e)&&(t[e].successEventPending="no",t[e].holdOutCallToBeFired=!1,n.set("bluecoreSiteJourney",JSON.stringify(t)),n.remove("lastHoldOutId")))}catch(e){}}},S={processCouponCode:function(e,t,r,i,n){try{var a="We were not able to fetch a dynamic coupon for you. Please try again!",o=null,c=!1;if("Undefined"===g.checkVariableType(n.dynamicCoupon)&&(n.dynamicCoupon=!1),t){try{o=bcQuery.parseHTML(t).find(function(e){return"DIV"==e.tagName&&"none"!=bcQuery(e).css("display")&&(e.hasClass("bluecoreActionScreen")||e.hasClass("bluecoreIntroScreen")||e.hasClass("bluecoreConfirmationScreen"))})}catch(e){o=bcQuery.parseHTML(t).filter(function(e){if("DIV"==e.tagName&&"none"!=bcQuery(e).css("display"))return e}),o=o[0]}c=!!o}else o=bcQuery("[referenceId="+e+"]").find(r),c=!0;var u=bcQuery(o).find(".bluecoreCouponBox"),s=bcQuery.trim(u.text()||u.val()),m=function(){var t=g.mergeObject({ns:p.partnerNamespace,cid:e},b.getUser());return p.sendRequest(d.APIURL("fetchpromo"),t,2e3).then(function(t){return p.campaignAttributeMapping[e].coupon_code=t.code||"",Promise.resolve(t)}).catch(function(e){return Promise.reject(!1)})};if(n&&n.dynamicCoupon&&"[[bluecore_coupon]]"==s&&c)return m().then(function(r){if(t)return!!r.code&&t.replace(s,r.code);if(r.code)return"INPUT"===u.prop("nodeName")?u.val(r.code):u.html(r.code),Promise.resolve(!0);var i=bcQuery("[referenceId="+e+"] .bluecoreCouponError");return 0===bcQuery.trim(i.find("span").text()).length&&i.find("span").text(r.error_message||a),i.show(),Promise.resolve(!1)}).catch(function(e){return Promise.reject(!1)});if(i)return n.dynamicCoupon?m().then(function(t){if(t.error_message){var r=bcQuery("[referenceId="+e+"] .bluecoreCouponError");return 0===bcQuery.trim(r.find("span").text()).length&&r.find("span").text(t.error_message||a),r.show(),!1}return!0}):Promise.resolve(!0);if(n.dynamicCoupon||"[[bluecore_coupon]]"!=s)return Promise.resolve(t||!0);return bcQuery("[referenceId="+e+"] .bluecoreCouponError").show(),Promise.resolve(!1)}catch(e){v.d("processCouponCode "+e,l.warning)}},init:function(){try{g.validateKey(a.get("bluecoreNV"))||a.set("bluecoreNV","true",0,5e5),o.initDB().then(function(e){try{S.manageDetails()}catch(e){v.d("setTimeout "+e,l.error)}})}catch(e){v.d("bluecoreSite_HR Init "+e,l.warning)}},manageDetails:function(){try{sessionStorage.getItem("bluecoreSiteFirstVisit")||(sessionStorage.setItem("bluecoreSiteFirstVisit","yes"),localStorage.setItem("getSessionStorage",Date.now())),window.addEventListener("storage",function(e){"getSessionStorage"===e.key?(localStorage.setItem("sessionStorage",p.partnerNamespace),localStorage.removeItem("sessionStorage")):"sessionStorage"===e.key&&e.newValue===p.partnerNamespace&&sessionStorage.setItem("bluecoreSiteFirstVisit","no")}),S.updateSession(),S.setTimeSpan()}catch(e){}},preFetchDetails:function(){try{o.getData("userLifeTime",null,null,!0,null).then(function(e){g.validateKey(e)&&!g.isEmptyObject(e)?(p.globalLifetimeDetail=e,p.isSiteDataLoaded&&(p.isSiteDataLoaded=!1,_.getAllApp())):(p.globalLifetimeDetail={firstPreviousDomainReferralUrl:g.getReferrer(),firstReferralURL:g.getReferrer(),firstVisit:window.location.href,totalPageViewCount:1,totalSessionCount:1,totalTimeSpan:0,totalVisitCount:1,userId:1},p.isSiteDataLoaded&&(p.isSiteDataLoaded=!1,_.getAllApp()))})}catch(e){v.d("preFetchDetails "+e,l.error)}},fetchSessionAllTimeData:function(){try{o.getData("sessionDetails",null,null,null,null,null,null).then(function(e){if(g.validateKey(e)&&e.length>0)p.globalSessionDetail=e;else{var t=Date.now(),r=t;p.globalSessionDetail={campaignId:[],firstVisitThisSession:window.location.href,referrer:g.getReferrer(),sessionId:t,sessionStartTime:r,pageViews:1}}})}catch(e){v.d("fetchSessionAllTimeData "+e,l.error)}},setVisitDefault:function(e,t){try{var r={sessionId:e.sessionId,startTime:Date.now(),pageViews:1,startPageUrl:document.location.href,comesFrom:t,campaignClickArr:[],campaignShowArr:[],campaignCloseArr:[]};n.set("bluecoreSiteVisit",JSON.stringify(r))}catch(e){v.d("setVisitDefault "+e,l.warning)}},setVisit:function(){try{o.getData("sessionDetails",null,null,!0,null,null,null).then(function(e){if(g.validateKey(e)&&!g.isEmptyObject(e)){var t=g.getReferrer(),r=null;"direct"!==g.getReferrer(!0)?(r=S.getVisit(),r?(r.pageViews++,n.set("bluecoreSiteVisit",JSON.stringify(r))):S.setVisitDefault(e,t)):i.get("bluecoreSiteFirstVisit")?"yes"===i.get("bluecoreSiteFirstVisit")?g.validateKey(e)&&!g.isEmptyObject(e)&&S.setVisitDefault(e,t):(r=S.getVisit(),r?(r.pageViews++,n.set("bluecoreSiteVisit",JSON.stringify(r))):S.setVisitDefault(e,t)):g.validateKey(e)&&e.length>0&&S.setVisitDefault(e,t),S.manageLifetimeActivity(),S.fetchSessionAllTimeData()}})}catch(e){v.d("setVisit "+e,l.warning)}},getVisit:function(){try{if(null!==n.get("bluecoreSiteVisit")&&g.isJsonString(n.get("bluecoreSiteVisit"),"getVisit")){var e=JSON.parse(n.get("bluecoreSiteVisit"));return g.isEmptyObject(e)?null:e}return null}catch(e){v.d("getVisit "+e,l.warning)}},setTimeSpan:function(){try{var e=new Date;window.onbeforeunload=function(){var t=new Date,r=(t-e)/1e3;if(g.validateKey(n.get("bluecoreSiteT"))){var i=parseInt(n.get("bluecoreSiteT"))||0,a=i?i+r:r;n.set("bluecoreSiteT",a,0,5e5)}else n.set("bluecoreSiteT",r,0,5e5)}}catch(e){v.d("setTimeSpan "+e,l.warning)}},manageLifetimeActivity:function(){try{g.getSessionCount().then(function(e){g.getPageViewCount().then(function(t){g.getVisitCount().then(function(r){g.getTimeSpan().then(function(i){o.getData("userLifeTime",null,null,!0,null).then(function(n){g.validateKey(n)&&!g.isEmptyObject(n)?o.setData("userLifeTime",{totalSessionCount:e,totalVisitCount:r,totalPageViewCount:t,totalTimeSpan:i},["totalSessionCount","totalVisitCount","totalPageViewCount","totalTimeSpan"],1):o.setData("userLifeTime",{firstVisit:String(document.location.href),firstReferralURL:g.getReferrer(),totalSessionCount:e,totalVisitCount:r||1,totalPageViewCount:t,firstPreviousDomainReferralUrl:g.getReferrer(),totalTimeSpan:i,userId:1}),S.fetchCampaignDetails()})})})})})}catch(e){v.d("manageLifetimeActivity "+e,l.error)}},updateSession:function(){try{o.getData("sessionDetails",null,null,!0,null,null,null).then(function(e){var t=Date.now(),r=t,i={sessionId:t,sessionStartTime:r,firstVisitThisSession:String(document.location.href),referrer:g.getReferrer(),pageViews:1,campaignId:[]};if(g.validateKey(e)&&!g.isEmptyObject(e)){e.pageViews+=1,p.globalSessionDetailCurrent=e;(Date.now()-e.sessionStartTime)/1e3/60>30?o.setData("sessionDetails",i):o.setData("sessionDetails",{pageViews:Number(p.globalSessionDetailCurrent.pageViews||1)},["pageViews"],p.globalSessionDetailCurrent.sessionId)}else o.setData("sessionDetails",i),p.globalSessionDetailCurrent=i;S.setVisit()})}catch(e){v.d("updateSession "+e,l.error)}},fetchCampaignDetails:function(){try{o.getData("campaignDetails",null,null,null,null).then(function(e){g.validateKey(e)&&e.length>0?(p.globalCampaignDetail=e,null!==n.get("bluecoreSiteVisit")&&g.isJsonString(n.get("bluecoreSiteVisit"),"fetchCampaignDetails")||S.setVisit()):(null!==n.get("bluecoreSiteVisit")&&g.isJsonString(n.get("bluecoreSiteVisit"),"fetchCampaignDetails")||S.setVisit(),p.globalCampaignDetail=[{campaignId:"",clickCount:0,clickSessionId:[],clickTime:"",closeCount:0,closeSessionId:[],closeTime:0,showCount:0,showSessionId:[],showTime:0}]),S.preFetchDetails()})}catch(e){v.d("fetchCampaignDetails "+e,l.warning)}},getSingleCampaignDetails:function(e){try{var t=p.globalCampaignDetail,r=0;if(g.validateKey(t))for(var i=0;i<=t.length-1;i++)if(t[i].campaignId===String(e)){r=t[i];break}return r}catch(e){return v.d("getSingleCampaignDetails "+e,l.warning),!1}},updateCampaignClick:function(e,t,r){try{var i=null,a=r[0];a.clickSessionId.push(p.globalSessionDetailCurrent.sessionId),o.setData("campaignDetails",{clickTime:Date.now(),clickSessionId:a.clickSessionId,clickCount:g.validateKey(S.getSingleCampaignDetails(e))?parseInt(S.getSingleCampaignDetails(e).clickCount||0)+1:1},["clickCount","clickTime","clickSessionId"],String(e)),i=S.getVisit(),i&&(g.validateKey(i[e])||(this.setCampaignClick(e),i=S.getVisit()),g.validateKey(i[e])&&(i[e].click=!0,i[e].totalClick=(parseInt(i[e].totalClick)||0)+1,g.includes(e,i.campaignClickArr)||i.campaignClickArr.push(e),n.set("bluecoreSiteVisit",JSON.stringify(i))))}catch(e){v.d("updateCampaignClick "+e,l.warning)}},updateCampaignShow:function(e,t,r){try{var i=null,a=r[0];a.showSessionId.push(p.globalSessionDetailCurrent.sessionId),o.setData("campaignDetails",{showTime:Date.now(),showSessionId:a.showSessionId,showCount:g.validateKey(S.getSingleCampaignDetails(e))?parseInt(S.getSingleCampaignDetails(e).showCount||0)+1:1},["showCount","showTime","showSessionId"],String(e)),i=S.getVisit(),i&&(g.validateKey(i[e])||(this.setCampaignShow(e),i=S.getVisit()),g.validateKey(i[e])&&(i[e].show=!0,i[e].totalShow=(parseInt(i[e].totalShow)||0)+1,i[e].campaigntype=t||"notSet",g.includes(e,i.campaignShowArr)||i.campaignShowArr.push(e),n.set("bluecoreSiteVisit",JSON.stringify(i))))}catch(e){v.d("updateCampaignShow "+e,l.warning)}},updateCampaignClose:function(e,t,r){try{var i=r[0],a=null;i.closeSessionId.push(p.globalSessionDetailCurrent.sessionId),o.setData("campaignDetails",{closeTime:Date.now(),closeSessionId:i.closeSessionId,closeCount:g.validateKey(S.getSingleCampaignDetails(e))?parseInt(S.getSingleCampaignDetails(e).closeCount||0)+1:1},["closeCount","closeTime","closeSessionId"],String(e)),a=S.getVisit(),a&&(g.validateKey(a[e])||(this.setCampaignClose(e),a=S.getVisit()),g.validateKey(a[e])&&(a[e].close=!0,a[e].totalClose=(parseInt(a[e].totalClose)||0)+1,g.includes(e,a.campaignCloseArr)||a.campaignCloseArr.push(e),n.set("bluecoreSiteVisit",JSON.stringify(a))))}catch(e){v.d("updateCampaignClose "+e,l.warning)}},setCampaignClick:function(e){try{var t=null;o.setData("campaignDetails",{clickTime:Date.now(),clickSessionId:[p.globalSessionDetailCurrent.sessionId],clickCount:g.validateKey(S.getSingleCampaignDetails(e))?parseInt(S.getSingleCampaignDetails(e).clickCount||0)+1:1},["clickTime","clickSessionId","clickCount"],String(e)),t=S.getVisit(),t&&g.validateKey(t[e])&&(t[e].click=!0,t[e].totalClick=(parseInt(t[e].totalClick)||0)+1,t.campaignClickArr.push(e),n.set("bluecoreSiteVisit",JSON.stringify(t)))}catch(e){v.d("setCampaignClick "+e,l.warning)}},setCampaignShow:function(e,t){try{var r=null;o.setData("campaignDetails",{campaignId:String(e),clickTime:"",clickSessionId:"",clickCount:0,showTime:Date.now(),showSessionId:[p.globalSessionDetailCurrent.sessionId],showCount:1,closeTime:"",closeSessionId:"",closeCount:0}),r=S.getVisit(),r&&(r[e]={show:!0,totalShow:1,click:!1,totalClick:0,close:!1,totalClose:0,campaigntype:t},r.campaignShowArr.push(e),n.set("bluecoreSiteVisit",JSON.stringify(r)))}catch(e){v.d("setCampaignShow "+e,l.warning)}},setCampaignClose:function(e){try{o.setData("campaignDetails",{closeTime:Date.now(),closeSessionId:[p.globalSessionDetailCurrent.sessionId],closeCount:g.validateKey(S.getSingleCampaignDetails(e))?parseInt(S.getSingleCampaignDetails(e).closeCount||0)+1:1},["closeTime","closeSessionId","closeCount"],String(e));var t=S.getVisit();t&&g.validateKey(t[e])&&(t[e].close=!0,t[e].totalClose=(parseInt(t[e].totalClose)||0)+1,t.campaignCloseArr.push(e),n.set("bluecoreSiteVisit",JSON.stringify(t)))}catch(e){v.d("setCampaignClose "+e,l.warning)}},setCampaignDetails:function(e,t,r){try{var i=null;if(g.validateKey(p.globalCampaignDetail)&&(i=p.globalCampaignDetail.filter(function(t){return!(void 0===t||!g.validateKey(t.campaignId))&&t.campaignId===String(e)})),g.validateKey(i)&&i.length>0)try{
"views"===t?S.updateCampaignShow(e,r,i):"clicks"===t?S.getSingleCampaignDetails(e).clickSessionId.length>0?S.updateCampaignClick(e,r,i):S.setCampaignClick(e,r,i):"close"===t&&(S.getSingleCampaignDetails(e).closeSessionId.length>0?S.updateCampaignClose(e,r,i):S.setCampaignClose(e,r,i))}catch(e){v.d("setCampaignDetails else "+e)}else S.setCampaignShow(e,r,i)}catch(e){v.d("setCampaignDetails "+e,l.warning)}}};try{setTimeout(function(){try{_.initialiseBluecoreOnsite()}catch(e){v.d("setTimeout "+e,l.error)}},50)}catch(e){}"Function"!==g.checkVariableType(window.bluecore_action_trigger)&&(window.bluecore_action_trigger=function(e){var t=p.campaignAttributeMapping[e];g.validateKey(t)&&(p.activeCampaignArray.prefcenter=[],p.activeCampaignArray.popup=[],p.activeCampaignArray.infoBar=[],p.activeCampaignArray.fullPage=[],p.templateTypes.popup=!0,p.templateTypes.fullPage=!0,p.templateTypes.infoBar=!0,p.templateTypes.AB=!1,p.templateTypes.popupShow=!1,p.templateTypes.fullPageShow=!1,t.actionTrigger=!1,p.hasNotSeenAnyCampaign=!0,p.isActionTriggerCampaign=!0,p.campaignAttributeMapping[e].engaged_onsite=!0,-1!==p.viewedCampaignListThisPage.indexOf(e)&&p.viewedCampaignListThisPage.splice(p.viewedCampaignListThisPage.indexOf(e),1),_.loadWidget([t]))}),bluecoreSitePublic.prototype.campaignStats=_.campaignStats}else setTimeout(__INIT_ONSITE,50,e+1)},!0!==window.__BC_ONSITE_INITIALIZED&&(window.__BC_ONSITE_INITIALIZED=!0,__INIT_ONSITE(0));var __INIT_ONSITE_RECS=function(e){if(!(e>500))if("object"==typeof window.triggermail&&"object"==typeof window.triggermail.Partner&&"function"==typeof triggermail.lytics.get_config&&"function"==typeof bcQuery){var t="Undefined",r=null,i=null,n="bc-"+triggermail.lytics.get_config("token")+"c2p"||"NoName",a={view:["id","brand","category","team"],search:["term"],addtocart:[],purchase:[],c2pCampaigns:[],c2pCampaignStats:["productId"]},o={READ_ONLY:"readonly",READ_WRITE:"readwrite",DBVERSION:2},c={eventArray:["view","addtocart","purchase","search","executeRule","addAttribution"],oneTimeTable:["view","addtocart","purchase","search","c2pCampaigns","c2pCampaignStats"],singleTableDataLimit:100,resultLimit:10},l={set:function(e,t,r,i){var n=i;s.validateKey(n)&&(n=!1);var a=new Date;n?a.setMinutes(a.getMinutes()+n):a.setDate(a.getDate()+r);var o=escape(t)+(null===r?"":"; expires="+a)+"; path=/";document.cookie=e+"="+o},get:function(e){var t=null,r=null,i=null,n=document.cookie.split(";");for(t=0;t<n.length;t++)if(r=n[t].substr(0,n[t].indexOf("=")),i=n[t].substr(n[t].indexOf("=")+1),(r=s.trimStr(r))===e)return unescape(i)},remove:function(e){l.set(e,"",0,-1)}},u={log:function(e){},errorSend:function(){this.log(u.failure.message),_c2pResponse.error=u.failure.message},failure:{error:!1,message:""},response:function(e){try{u.log("result =>",e),this.failure.error&&this.errorSend(),e.attribution?_c2pResponse.attribution=e.result:e.error?e.error&&(_c2pResponse.data=e||{}):_c2pResponse.data=e||{}}catch(e){_c2pResponse.data={}}}},s={validateKey:function(e){return typeof e!==t&&e!==t&&null!==e&&""!==e},trimStr:function(e){try{return s.checkVariableType(e)===t?"":"String"===s.checkVariableType(e)?"Function"===s.checkVariableType(e.trim)?e.trim():e.replace(/^\s+|\s+$/g,""):""}catch(e){return""}},isJsonString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},includes:function(e,t){try{for(var r=t.length,i=0;i<r;i++)if(t[i]===e)return!0;return!1}catch(e){return!1}},isEmptyObject:function(e){try{if("Object"===this.checkVariableType(e)){var t;for(t in e)return!1;return!0}return!0}catch(e){u.log("isEmptyObject "+e)}},cloneObject:function(e){try{if("Object"===this.checkVariableType(e)){var t=e.constructor();for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}return e}catch(t){return e}},convertToObject:function(e){try{if("Object"===this.checkVariableType(e))return e;if("Array"===this.checkVariableType(e)){var t={};for(var r in e)"Function"!==this.checkVariableType(e[r])&&void 0!==e[r]&&(t[r]=e[r]);return t}return null}catch(e){u.log("convertToObject "+e)}},getObjectValues:function(e){try{var t=[];if("Object"===this.checkVariableType(e)){for(var r in e)t.push(e[r]);return t}return[]}catch(e){u.log("convertToObject "+e)}},checkVariableType:function(e){try{return Object.prototype.toString.call(e).split(" ")[1].slice(0,-1)}catch(e){u.log("checkVariableType "+e)}},mergeObject:function(){try{for(var e={},r=arguments.length,i=0;i!==r;){var n=arguments[i];for(var a in n)""!==n[a]&&n[a]!==t&&null!==n[a]&&(e[a]=n[a]);i++}return e}catch(e){u.log("mergeObject "+e)}},validateString:function(e){return null!==e&&""!==e&&typeof e!==t}},p=function(){try{return window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!!window.indexedDB}catch(e){u.log("bouttargetting_boutCheckDB "+e)}},d=function(){try{return r=window.indexedDB.open(n,o.DBVERSION),!0}catch(e){return!1}},g=function(){return new Promise(function(e,n){try{if(s.validateKey(r)&&s.validateKey(i))return e(!0),!1;p()?d()?(r.onerror=function(){u.log("error making DB Connection")},r.onsuccess=function(t){i=t.target.result,e(!0)},r.onupgradeneeded=function(e){if(i=e.target.result,0!==e.oldVersion){for(var r=i.objectStoreNames,n={},o=0;o<r.length;o++){var l=e.currentTarget.transaction.objectStore(r.item(o)),u=l.indexNames;n[r.item(o)]=[];for(var p=0;p<u.length;p++)"timestamp"!==u.item(p)&&n[r.item(o)].push(u.item(p))}var d=Object.keys(n),g=Object.keys(a),m=d.filter(function(e){return!s.includes(e,g)}),f=g.filter(function(e){return!s.includes(e,d)});for(var y in m)i.deleteObjectStore(m[y]);for(var y in f){var h=i.createObjectStore(f[y]);if(h.createIndex("timestamp","timestamp",{unique:!0}),a[f[y]].length>0){var b=a[f[y]];b.forEach(function(e){h.createIndex(e,e,{unique:!1})})}}for(var v in a)if(n[v]!==t){var _=n[v].filter(function(e){return!s.includes(e,a[v])}),S=a[v].filter(function(e){return!s.includes(e,n[v])});for(var C in _){var l=e.currentTarget.transaction.objectStore(v);l.deleteIndex(_[C])}for(var C in S){var l=e.currentTarget.transaction.objectStore(v);l.createIndex(S[C],S[C])}}}else for(var o in c.oneTimeTable)if("String"===s.checkVariableType(c.oneTimeTable[o])){var h=i.createObjectStore(c.oneTimeTable[o],{keyPath:"timestamp"});if(h.createIndex("timestamp","timestamp",{unique:!0}),a[c.oneTimeTable[o]].length>0){var b=a[c.oneTimeTable[o]];b.map(function(e){h.createIndex(e,e,{unique:!1})})}}}):(u.log("error opening DB connection"),n(!0)):(u.log("IndexedDB Not Supported"),n(!0))}catch(e){u.log("error in DB init "+e),n(!0)}})},m={updateLastRecord:function(e,t){try{if("Object"!==s.checkVariableType(t))return!1;if("String"!==s.checkVariableType(e))return!1;var r=i.transaction([e],o.READ_WRITE),n=r.objectStore(e),a=null,c=1;n.openCursor(null,"prev").onsuccess=function(e){var r=e.target.result;if(r&&c>0){a=r.value,c--;for(var i in t.shown_items)a.shown_items[i]=t.shown_items[i];var o=n.put(a);o.onerror=function(e){u.log("error while adding data"+e)},o.onsuccess=function(e){u.log("successfully updated table data")},r.continue()}}}catch(e){u.log("Error Updating record "+e)}},addRecord:function(e,t){try{if("Object"!==s.checkVariableType(t)||s.isEmptyObject(t))return!1;if("String"!==s.checkVariableType(e))return!1;var r=i.transaction([e],o.READ_WRITE),n=r.objectStore(e),a=n.put(t);a.onerror=function(e){u.log("error while adding data"+e)},a.onsuccess=function(t){m.deleteDataBasedOnLimit(e)}}catch(e){u.log("Error Adding record "+e)}},deleteDataBasedOnLimit:function(e){if(!s.validateString(e))return u.log("deleteDataBasedOnLimit table is not String Type"),!1;try{var t=i.transaction([e],o.READ_WRITE),r=t.objectStore(e),n=r.count();n.onsuccess=function(t){if(n.result>c.singleTableDataLimit){var i=n.result-c.singleTableDataLimit-1;r.openCursor().onsuccess=function(t){var r=t.target.result;r&&(m.deleteByKey(e,r.key),0!==i&&(i--,r.continue()))}}}}catch(e){u.log("Error in Delete Record "+e)}},deleteByKey:function(e,t){if(!s.validateString(e))return u.log("deleteByKey table is not String Type"),!1;if("Number"!==s.checkVariableType(t))return u.log("deleteByKey id is not Number Type"),!1;try{var r=i.transaction([e],o.READ_WRITE),n=r.objectStore(e);if(t){n.delete(t).onerror=function(e){u.log("error deleting data by Key")}}else u.log("unable to delete record bec'z id not fonud ="+t)}catch(e){u.log("deleteByKey "+e)}},lastDataBycount:function(e,t){if(!s.validateString(e))return u.log("lastDataByCount table is not String Type"),!1;if("Number"!==s.checkVariableType(t))return u.log("lastDataByCount count is not Number Type"),!1;try{return new Promise(function(r,n){var a=i.transaction([e],o.READ_ONLY),c=a.objectStore(e),l=[];c.openCursor(null,"prev").onsuccess=function(e){var i=e.target.result;i&&t>0?(l.push(i.value),t--,i.continue()):r(l)}})}catch(e){reject(null)}},searchByAttribute:function(e,t,r,n){if(!s.validateString(e))return u.log("searchByAttribute table is not String Type"),!1;if("String"!==s.checkVariableType(t))return u.log("searchByAttribute attribute is not String Type"),!1;if("String"!==s.checkVariableType(r))return u.log("searchByAttribute value is not String Type"),!1;if("Number"!==s.checkVariableType(n))return u.log("searchByAttribute maxLimit is not Number Type"),!1;var c=n||100;try{return new Promise(function(n,l){if(!("Array"===s.checkVariableType(a[e])&&a[e].indexOf(t)>0))return u.log("searchByAttribute attribute='"+t+"' Not Index"),!1;var p=i.transaction([e],o.READ_WRITE),d=p.objectStore(e),g=d.index(t),m=[];g.openCursor(null,"prev").onsuccess=function(e){var i=e.target.result;if(i&&c>0){if(c--,"__auto__"===r){var a=new triggermail.fetcher;r=a.id()||"1"}i.value[t]===r&&m.push(i.value),i.continue()}else n("Array"===s.checkVariableType(m)?m:!1)}})}catch(e){u.log("deleteByKey "+e)}},lastDataBydays:function(e,t,r){if(!s.validateString(e))return u.log("lastDataByDays table is not String Type"),!1;if("Number"!==s.checkVariableType(t))return u.log("lastDataByDays days is not Number Type"),!1;if("Number"!==s.checkVariableType(r))return u.log("lastDataByDays maxLimit is not Number Type"),!1;try{var n=r||100;return new Promise(function(r,a){var c=i.transaction([e],o.READ_ONLY),l=c.objectStore(e),u=new Date,s=u.setDate(u.getDate()-t),p=l.index("timestamp"),d=IDBKeyRange.lowerBound(s),g=[];p.openCursor(d,"prev").onsuccess=function(e){var t=e.target.result;t&&n>0?(n--,g.push(t.value),t.continue()):r(g)}})}catch(e){u.log("lastDataByDays "+e)}},searchDataByIndex:function(e,r){return"String"===s.checkVariableType(r)&&(""!==e&&null!==e&&e!==t&&void(i.transaction([e],o.READ_ONLY).objectStore(e).index("productId").openCursor(r,"prev").onsuccess=function(e){var t=e.target.result;t&&u.response({result:t.value,error:!1,attribution:!0})}))}},f={extractByAttributeName:function(e,r){try{return new Promise(function(i,n){if("Array"!==s.checkVariableType(e))return u.log("extractByAttributeName array is not Array Type"),i(!1),!1;if("Array"!==s.checkVariableType(r))return u.log("extractByAttributeName attrArray is not Array Type"),i(!1),!1;var a=0;i(e.map(function(i){return r.map(function(r){var n={};return s.checkVariableType(i[r])!==t?(n[r]=i[r],n):(a++,a===e.length&&(u.failure.error=!0,u.failure.message=r+" not found in extractByAttributeName"),!1)})}))})}catch(e){u.log("extractByAttributeName "+e)}},extractByAttributeNameWithoutKey:function(e,t){try{return new Promise(function(r,i){return"Array"!==s.checkVariableType(e)?(u.log("extractByAttributeNameWithoutKey array is not Array Type"),r(!1),!1):"Array"!==s.checkVariableType(t)?(u.log("extractByAttributeNameWithoutKey attrArray is not Array Type"),r(!1),!1):void r(e.map(function(e){return t.map(function(t){return e[t]})}))})}catch(e){u.log("extractByAttributeNameWithoutKey "+e)}},getSortedArray:function(e){function t(e,t){return e+t}try{return new Promise(function(r,i){if("Object"!==s.checkVariableType(e))return u.log("getSortedArray array is not Object Type"),r(!1),!1;var n=[],a=0;for(var o in e)n.push([o,e[o]]);a=n.map(function(e){return e[1]}).reduce(t,0),n.sort(function(e,t){return e[1]-t[1]}),r({sortedArray:n,keySum:a})})}catch(e){u.log("getSortedArray "+e)}},setPriorityValue:function(e,t){try{if(!(e.length>=1))return!1;if("p1"==t)return""!=e[0]&&e[0];if("p2"==t)return void 0!==e[1]&&""!==e[1]?e[1]:""!==e[0]&&e[0];if("p3"==t)return void 0!==e[2]&&""!==e[2]?e[2]:void 0!==e[1]&&""!==e[1]?e[1]:""!==e[0]&&e[0]}catch(e){return!1}},getSortedArraySynchronous:function(e){if(e=s.getObjectValues(e)[0],"Object"!==s.checkVariableType(e))return u.log("getSortedArraySynchronous array is not Array Type"),!1;try{var t=[];for(var r in e)t.push([r,e[r]]);return t.sort(function(e,t){return e[1]-t[1]}),t.pop()[0]}catch(e){return!1}},uniqueCountByMatchingAttribute:function(e){return new Promise(function(r,i){if("Array"!==s.checkVariableType(e))return u.log("uniqueCountByMatchingAttribute array is not Array Type"),r(!1),!1;try{r(e.reduce(function(e,r){return e[r]=s.checkVariableType(e[r])===t?1:e[r]+=1,e},{}))}catch(e){u.log("uniqueCountByMatchingAttribute "+e)}})},uniqueCountByMatchingAttributeSynchronous:function(e,r){if("Array"!==s.checkVariableType(e))return u.log("uniqueCountByMatchingAttributeSynchronous array is not Array Type"),!1;if(!s.validateString(r))return u.log("uniqueCountByMatchingAttributeSynchronous returnMappedKey is not Array Type"),!1;try{e=e.filter(function(e,t){return s.validateKey(e)});var i=e.reduce(function(e,r){return e[r]=s.checkVariableType(e[r])===t?1:e[r]+=1,e},{}),n={};return s.checkVariableType(r)!==t?(n[r]=i,n):i}catch(e){return!1}},lastMatchingAttributeSynchronous:function(e,t){if("Array"!=s.checkVariableType(e))return u.log("lastMatchingAttributeSynchronous array is not Array Type"),!1;if(!s.validateString(t))return u.log("lastMatchingAttributeSynchronous returnMappedKey is not Array Type"),!1;try{e=e.filter(function(e,t){return void 0!==e&&""!=e&&null!=e});var r={},i={};return i[e[0]]=1,void 0!==t?(r[t]=i,r):(r[e[0]]=1,r)}catch(e){return!1}},ByPriceRange:function(e,t,r){return new Promise(function(i,n){if("Array"!==s.checkVariableType(e))return u.log("ByPriceRange array is not Array Type"),i(!1),!1;if("Number"!==s.checkVariableType(t))return u.log("ByPriceRange min is not Number Type"),i(!1),!1;if("Number"!==s.checkVariableType(r))return u.log("ByPriceRange max is not Number Type"),i(!1),!1;try{i(e.map(function(e){if(Number(e.price)>=Number(t)&&Number(e.price)<=Number(r))return e}))}catch(e){i(!1)}})},assignKeyInArraySequence:function(e,r){var i=[];return new Promise(function(n,a){if("Array"!=s.checkVariableType(e))return u.log("assignKeyInArray array is not Array Type"),n(!1),!1;if("Array"!=s.checkVariableType(r))return u.log("assignKeyInArray array is not Array Type"),n(!1),!1;try{for(var o in e)for(var c in r)typeof i[r[c]]===t?s.checkVariableType(e[o][c][r[c]])===t&&0!=e[o][c]||(i[r[c]]=[],!1===e[o][c]?i[r[c]].push(""):i[r[c]].push(e[o][c][r[c]])):s.checkVariableType(e[o][c][r[c]])===t&&0!=e[o][c]||(!1===e[o][c]?i[r[c]].push(""):i[r[c]].push(e[o][c][r[c]]));n(i)}catch(e){u.log("assignKeyInArray "+e)}})},assignKeyInArray:function(e,r){var i=[];return new Promise(function(n,a){if("Array"!==s.checkVariableType(e))return u.log("assignKeyInArray array is not Array Type"),n(!1),!1;if("Array"!==s.checkVariableType(r))return u.log("assignKeyInArray array is not Array Type"),n(!1),!1;try{e.forEach(function(e){for(var n in r)s.checkVariableType(i[r[n]])===t?s.checkVariableType(e[n][r[n]])!==t&&(i[r[n]]=[],i[r[n]].push(e[n][r[n]])):s.checkVariableType(e[n][r[n]])!==t&&i[r[n]].push(e[n][r[n]])}),n(i)}catch(e){u.log("assignKeyInArray "+e)}})},getMaxAndMinValue:function(e){return new Promise(function(t,r){if("Array"!==s.checkVariableType(e))return u.log("getMaxAndMinValue array is not Array Type"),t(!1),!1;try{t({max:Math.max.apply(null,e),mix:Math.min.apply(null,e)})}catch(e){u.log("getMaxAndMinValue "+e)}})},getLastInteractionByAttributeName:function(e,r){return new Promise(function(i,n){if("Array"!==s.checkVariableType(e))return u.log("getLastInteractionByAttributeName array is not Array Type"),i(!1),!1;if("String"!==s.checkVariableType(r))return u.log("getLastInteractionByAttributeName array is not Array Type"),i(!1),!1;try{var a=e[0];i(a[r]!==t?a[r]:!1)}catch(e){u.log("getLastInteractionByAttributeName "+e)}})},purchaseBasedExclusion:function(e,t,r,i){return new Promise(function(n,a){if("Array"!==s.checkVariableType(e))return u.log("purchaseBasedExclusion viewArr is not Array Type"),n(!1),!1;if("Array"!==s.checkVariableType(t))return u.log("purchaseBasedExclusion pruchaseArr is not Array Type"),n(!1),!1;if(!s.validateString(i))return u.log("purchaseBasedExclusion condition is not String Type"),n(!1),!1;if(!s.validateString(r))return u.log("purchaseBasedExclusion exclusionAttribute is not String Type"),n(!1),!1;try{for(var o in t){var l=t[o],p=f.purchaseBasedExclusionRemoveFilterData(e,l,r,i);"Array"===s.checkVariableType(p)&&(p=p.filter(function(e){return s.validateKey(e)}))}if(!("Array"===s.checkVariableType(p)&&p.length>0))return n(!1),!1;n(p.splice(0,c.resultLimit))}catch(e){u.log("purchaseBasedExclusion "+e)}})},purchaseBasedExclusionRemoveFilterData:function(e,t,r,i){if("Array"!==s.checkVariableType(e))return u.log("purchaseBasedExclusionRemoveFilterData viewArr is not Array Type"),!1;if("Object"!==s.checkVariableType(t))return u.log("purchaseBasedExclusionRemoveFilterData singlePurchase is not Array Type"),!1;if(!s.validateString(i))return u.log("purchaseBasedExclusionRemoveFilterData condition is not String Type"),!1;if(!s.validateString(r))return u.log("purchaseBasedExclusionRemoveFilterData exclusionAttribute is not String Type"),!1;try{return"timestamp"===i?e.map(function(e){return t.timestamp>e.timestamp&&t[r]>e[r]&&e?null:e}):e.filter(function(e){return t.hasOwnProperty(r)?(t[r]!==e[r]||!e)&&e:(u.failure.error=!0,u.failure.message="exclusionAttribute not found "+r,!1)})}catch(e){u.log("purchaseBasedExclusionRemoveFilterData "+e)}},getAverageValue:function(e){function t(e,t){return e+t}if("Array"!==s.checkVariableType(e))return u.log("getAverageValue array is not Array Type"),!1;try{return new Promise(function(r,i){r(e.reduce(t,0)/e.length)})}catch(e){u.log("getAverageValue "+e)}},percentageQualifyingFetcher:function(e,t,r){var i=!0,n=!0;return new Promise(function(a,o){if("Object"!==s.checkVariableType(e))return u.log("percentageQualifyingFetcher array is not Array Type"),a(!1),!1;if("Number"!==s.checkVariableType(t))return u.log("percentageQualifyingFetcher keySum is not Array Type"),a(!1),!1;if("Number"!==s.checkVariableType(r))return u.log("percentageQualifyingFetcher percentage is not Array Type"),a(!1),!1;try{var c={};for(var l in e)c={},e[l]/t*100>=r&&i&&(c[l]=e[l],n=s.cloneObject(c),i=!1);i&&(n=e),a(n)}catch(e){u.log("percentageQualifyingFetcher "+e)}})}},y={execute:function(e){switch(u.failure={error:!1,message:""},e.queryname){case"recipe0":var r=e.table,i=e.query,n=e[i],a=e.value,o=e.returnattr,l=e.max||c.singleTableDataLimit,p=e.campaignId||0,d=e.selectorDiv||null,g=e.supportedObject;return m.searchByAttribute(r,n,a,l).then(function(e){u.response({result:e,campaignId:p,selector:d||null,error:!1,attribution:!1,supportedObject:g})}),!1;case"recipe1":var r=e.table,i=e.query,y=e[i],o=e.returnattr,l=e.max||c.singleTableDataLimit,g=e.supportedObject;return m["lastDataBy"+i](r,y,l).then(function(e){f.extractByAttributeName(e,o).then(function(e){f.assignKeyInArray(e,o).then(function(e){e?u.response({result:s.convertToObject(e),error:!1,attribution:!1,supportedObject:g}):u.errorSend()})})}),!1;case"recipe2":var r=e.table,i=e.query,y=e[i],l=e.max||c.singleTableDataLimit,h=e.method.rule,b=e.method.value,o=e.returnattr,v=e.method.type,_=e.method.attr,g=e.supportedObject;return m["lastDataBy"+i](r,y,l).then(function(e){e?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){var r={};if(e){var i=e[_];delete e[_],s.checkVariableType(i)===t&&(u.failure.error=!0,u.failure.message=_+" Key not Exist"),"all"===v?f.uniqueCountByMatchingAttribute(i).then(function(t){if(t){r[_]=t;var i=s.mergeObject(s.cloneObject(r),e);u.response({result:i,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()}):"mode"===v?f.uniqueCountByMatchingAttribute(i).then(function(t){t?f.getSortedArray(t).then(function(t){r[_]=t.sortedArray.pop()[0];var i=s.mergeObject(s.cloneObject(r),e);u.response({result:i,error:!1,attribution:!1,supportedObject:g})}):u.errorSend()}):"percentage"===v?"gte"===h&&f.uniqueCountByMatchingAttribute(i).then(function(t){t?f.getSortedArray(t).then(function(i){i?f.PercentageQualifyingFetcher(t,i.keySum,b).then(function(t){if(t){r[_]=t;var i=s.mergeObject(s.cloneObject(r),s.convertToObject(e));u.response({result:i,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()}):u.errorSend()}):u.errorSend()}):(u.failure.error=!0,u.failure.message=v+" method not available at this time",u.errorSend())}else u.errorSend()}):u.errorSend()}):u.errorSend()}),!1;case"recipe3":var r=e.table,i=e.query,y=e[i],o=e.returnattr,S=e.lastengageattribute,v=e.method.type,_=e.method.attr,l=e.max||c.singleTableDataLimit,g=e.supportedObject;return m["lastDataBy"+i](r,y,l).then(function(e){e?f.extractByAttributeName(e,o).then(function(r){var i={},n={};r?f.assignKeyInArray(r,o).then(function(r){if(r){var a=r[_];delete r[_],s.checkVariableType(a)===t&&(u.failure.error=!0,u.failure.message=_+" Key not Exist"),"all"==v?f.uniqueCountByMatchingAttribute(a).then(function(t){t?S&&f.getlastInteractionByAttributeName(e,S).then(function(e){i[_]=t;var n=s.mergeObject({lastEngageAttribute:e},s.cloneObject(i),r);u.response({result:n,error:!1,attribution:!1,supportedObject:g})}):u.errorSend()}):"mode"===v?f.uniqueCountByMatchingAttribute(a).then(function(t){t?f.getSortedArray(t).then(function(t){t?S&&f.getlastInteractionByAttributeName(e,S).then(function(e){n[t.sortedArray.pop()[0]]=t.sortedArray.pop()[1],i[_]=s.cloneObject(n);var a=s.mergeObject({lastEngageAttribute:e},s.cloneObject(i),r);u.response({result:a,error:!1,attribution:!1,supportedObject:g})}):u.errorSend()}):u.errorSend()}):"avg"===v?f.getAverageValue(a).then(function(e){if(e){i[_]=e;var t=s.mergeObject(s.convertToObject(r),s.cloneObject(i));u.response({result:t,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()}):(u.failure.error=!0,u.failure.message=v+" method not available at this time",u.errorSend())}else u.errorSend()}):u.errorSend()}):u.errorSend()}),!1;case"recipe4":var o=e.returnattr,v=e.method.type,_=e.method.attr,C=e.exclusionattribute,l=e.max||c.singleTableDataLimit,w=e.query1,T=w.table,k=w.query,I=w[k],O=e.query2,A=O.table,x=O.query,E=O[x],g=e.supportedObject;return m["lastDataBy"+k](T,I,l).then(function(e){var r={};e?m["lastDataBy"+x](A,E,l).then(function(i){i?f.purchaseBasedExclusion(e,i,C,_).then(function(e){e?"timeBased"===v?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){if(e){var i=e[C];delete e[C],s.checkVariableType(i)===t&&(u.failure.error=!0,u.failure.message=C+" exclusionAttribute Key not Exist"),f.uniqueCountByMatchingAttribute(i).then(function(t){if(t){r[C]=t;var i=s.mergeObject(s.convertToObject(e),s.cloneObject(r));u.response({result:i,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()})}}):u.errorSend()}):"timeBetween"===v?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){if(e){var t=e[_];delete e[_],f.getMaxAndMinValue(t).then(function(t){if(t){var r=s.mergeObject(s.convertToObject(e),t);u.response({result:r,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()})}else u.errorSend()}):u.errorSend()}):"groupMode"===v?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){if(e){var t={},i=[];for(var n in _){var a=e[_[n]];i.push(new Promise(function(e,i){r[_[n]]=f.getSortedArraySynchronous(f.uniqueCountByMatchingAttributeSynchronous(a,_[n])),t[n]=s.convertToObject(s.cloneObject(r))})),delete e[_[n]]}var o=s.mergeObject(t,e);u.response({result:o,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()}):u.errorSend()}):(u.failure.error=!0,u.failure.message=v+" method not available at this time",u.errorSend()):u.errorSend()}):u.errorSend()}):u.errorSend()}),!1;case"recipe5":var o=e.returnattr,v=e.method.type,_=e.method.attr,C=e.exclusionattribute,l=e.max||c.singleTableDataLimit,w=e.query1,T=w.table,k=w.query,I=w[k],D=e.excludeKey||null,g=e.supportedObject,R={};return m["lastDataBy"+k](T,I,l).then(function(e){e?"groupMode"===v?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){if(e){var t={},r=[];for(var i in _)if(R={},o.indexOf(_[i])>-1){var n=e[_[i]];r.push(new Promise(function(e,r){R[_[i]]=f.getSortedArraySynchronous(f.uniqueCountByMatchingAttributeSynchronous(n,_[i])),t[i]=s.convertToObject(s.cloneObject(R)),!1===t[i][_[i]]&&delete t[i]})),delete e[_[i]]}R={};var a=s.mergeObject(t,e);-1!==bcQuery.inArray(D,Object.keys(e))&&(R[D]=[e[D][0]],a=s.mergeObject(a,{exclude_key:s.cloneObject(R)}),delete a[D]),s.isEmptyObject(a)?u.response({result:a,error:!0,attribution:!1,supportedObject:g}):u.response({result:a,error:!1,attribution:!1,supportedObject:g})}else u.errorSend()}):u.errorSend()}):(u.failure.error=!0,u.failure.message=v+" method not available at this time",u.errorSend()):u.errorSend()}),!1;case"recipe6":var o=e.returnattr,v=e.method.type,_=e.method.attr,P=e.lastentractedattribute,l=e.max||c.singleTableDataLimit,w=e.query1,T=w.table,k=w.query,I=w[k],N=e.booster,g=e.supportedObject,R={},j={},B={};return m["lastDataBy"+k](T,I,l).then(function(e){e?"groupMode"===v?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){if(e){var r={},i=[];for(var n in _)if(R={},o.indexOf(_[n])>-1){var a=e[_[n]];i.push(new Promise(function(e,t){R[_[n]]=f.getSortedArraySynchronous(f.uniqueCountByMatchingAttributeSynchronous(a,_[n])),r[n]=s.convertToObject(s.cloneObject(R)),!1===r[n][_[n]]&&delete r[n]})),delete e[_[n]]}var c=Object.keys(P).pop(),l=s.getObjectValues(P).pop();delete e[l],m.lastDataBycount(T,1,1).then(function(i){if(R={},s.checkVariableType(i[0])!==t){var n=i[0][l];s.checkVariableType(n)!==t&&(B[N]=1,j[l]=n,R[c]=s.cloneObject(j),r=s.mergeObject(s.cloneObject(R),r,s.cloneObject(B)))}var a=s.mergeObject(r,e,{});s.isEmptyObject(a)?u.response({result:a,error:!0,attribution:!1,supportedObject:g}):u.response({result:a,error:!1,attribution:!1,supportedObject:g})})}else u.errorSend()}):u.errorSend()}):"groupLast"==v?f.extractByAttributeName(e,o).then(function(e){e?f.assignKeyInArray(e,o).then(function(e){if(e){var r={},i=[];for(var n in _)if(R={},o.indexOf(_[n])>-1){var a=e[_[n]];i.push(new Promise(function(e,t){R[_[n]]=f.getSortedArraySynchronous(f.lastMatchingAttributeSynchronous(a,_[n])),r[n]=s.convertToObject(s.cloneObject(R)),!1===r[n][_[n]]&&delete r[n]})),delete e[_[n]]}R={};var c=Object.keys(P).pop(),l=s.getObjectValues(P).pop();delete e[l],m.lastDataBycount(T,1,1).then(function(i){if(s.checkVariableType(i[0])!==t){var n=i[0][l];s.checkVariableType(n)!==t&&(B[N]=1,j[l]=n,R[c]=s.cloneObject(j),r=s.mergeObject(s.cloneObject(R),r,s.cloneObject(B)))}var a=s.mergeObject(r,e,{});s.isEmptyObject(a)?u.response({result:a,error:!0,attribution:!1,supportedObject:g}):u.response({result:a,error:!1,attribution:!1,supportedObject:g})})}else u.errorSend()}):u.errorSend()}):(u.failure.error=!0,u.failure.message=v+" method not available at this time",u.errorSend()):u.errorSend()}),!1}}},h=function(e){try{if(e&&e.length)for(var t=0;t<e.length;t++)this.push(e[t])}catch(e){u.log("worker "+e)}};h.prototype.push=function(e){try{if(e&&"Array"===s.checkVariableType(e)&&e.length){var t=String(e.splice(0,1));-1!==bcQuery.inArray(t,c.eventArray)?v[t].apply(v,e):u.log("error no event Fount")}}catch(e){u.log("worker.prototype.push "+e)}};var b={updatec2pCampaigns:function(e,t){t=t||!1,!1===t?(e.timestamp=Date.now(),setTimeout(function(){m.addRecord("c2pCampaigns",e)},10)):setTimeout(function(){m.updateLastRecord("c2pCampaigns",e)},10)},addClickCampaignBluecore:function(e){m.addRecord("c2pCampaignStats",e),l.remove("bcCD")},findVisibleAdsIdsAndNames:function(e){var t=[],r={},i=bcQuery("[referenceId='"+e+"'] .bluecoreSliderContainer")[0].getBoundingClientRect(),n=i.left,a=i.right,o=bcQuery("[referenceId='"+e+"'] .bluecoreSliderBox"),c=null,l=null;return o.each(function(){c=bcQuery(this)[0].getBoundingClientRect(),(l=(c.left+c.right)/2)<a&&l>n&&t.push(bcQuery(this)[0])}),bcQuery.each(t,function(){r[bcQuery(this).find("input").val()]=bcQuery(this).find(".bluecoreSliderProductName").text()}),r},addCampaignFetchRecord:function(e,t,r){try{var i={},n=[];bcQuery("[referenceId='"+e+"'] .bluecoreSliderBox input[type='hidden']").each(function(){n.push(bcQuery(this).val())}),n=new Set(n),n=Array.from(n),i.productId=n;var a=b.findVisibleAdsIdsAndNames(e);i.shown_items=a,i.campaignId=e,i.recipeName=t,i.sessionReferrer=r,this.updatec2pCampaigns(i),bcQuery("[referenceId='"+e+"'] .bluecoreSliderNext").on("click",function(t){new Promise(function(e){setTimeout(e,1e3)}).then(function(){var t={},r=b.findVisibleAdsIdsAndNames(e);t.shown_items=r,b.updatec2pCampaigns(t,!0)})}),bcQuery("[referenceId='"+e+"'] .bluecoreSliderPrev").on("click",function(t){new Promise(function(e){setTimeout(e,1e3)}).then(function(){var t={},r=b.findVisibleAdsIdsAndNames(e);t.shown_items=r,b.updatec2pCampaigns(t,!0)})})}catch(e){u.log("addCampaignFetchRecord ",e)}},fetchClickListener:function(e,t,r){try{var e=e,i=t,n=r;null!==l.get("bcCD")&&s.isJsonString(l.get("bcCD"))&&b.addClickCampaignBluecore(JSON.parse(l.get("bcCD"))),bcQuery("[referenceId='"+e+"'] .bluecoreSliderBox").on("click",function(){var t={timestamp:Date.now(),campaignId:e,sessionReferrer:n,source:"onsite",productId:bcQuery(this).find("input").val(),recipeName:i,productName:bcQuery(this).find(".bluecoreSliderBox").text()};l.set("bcCD",JSON.stringify(t),0,5e5),b.addClickCampaignBluecore(t)})}catch(e){u.log("fetchClickListener",e)}}},v={view:function(e){g().then(function(){e.timestamp=Date.now(),m.addRecord("view",e)})},addtocart:function(e){g().then(function(){e.timestamp=Date.now(),m.addRecord("addtocart",e),m.searchDataByIndex("c2pCampaignStats",e.id)})},purchase:function(e){g().then(function(){e.timestamp=Date.now(),m.addRecord("purchase",e)})},search:function(e){g().then(function(){e.timestamp=Date.now(),m.addRecord("search",e)})},executeRule:function(e,t){e.supportedObject=t||{},g().then(function(){y.execute(e)})},addAttribution:function(e,t,r){g().then(function(){b.addCampaignFetchRecord(e,t,r),b.fetchClickListener(e,t,r)})}};g().then(function(){}),function(e){window._c2pService=new h(e)}(window._c2pService)}else setTimeout(__INIT_ONSITE_RECS,50,e+1)}}