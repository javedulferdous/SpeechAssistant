define(['jquery'],function($){'use strict';return function(widget){$.widget('sw.searchWidget',widget,{_create:function(){this._super();this.logo=$('.header.content .logo');},onClick:function(){var preload=$('[data-amsearch-js="preload"]');if(preload&&preload.length>0){this.showPopup(preload.html());}else{this.getEmptyRequest();}
var value=this.element.val().trim(),minChars=this.options.minChars?this.options.minChars:this.options.minSearchLength;if(value.length>=parseInt(minChars,10)&&this.ajaxRequest&&this.ajaxRequest.readyState!==1){this._onPropertyChangeCallBack();}},defineHideOrClear:function(){var self=this,mmItem=$('.ammenu-item');if(mmItem.length){mmItem.on('mouseover',function(){self.hidePopup();});}
$('body').on('click',function(e){var target=$(e.target);if(target.hasClass('amsearch-close')||(target.is('[for="search"][data-role="minisearch-label"]')&&self.element.is('[aria-haspopup="true"]'))){self.element.val('');$('body').focus();if(self.ajaxRequest){self.ajaxRequest.abort();}
self.hideLoader();self.hidePopup();return false;}
if(!target.is('#search, #search_autocomplete *')){if(self.ajaxRequest){self.ajaxRequest.abort();}
self.hideLoader();self.hidePopup();}});},getEmptyRequest:function(){var defaultSearchBlock=this.showPopup(),inputWrapper='[data-amsearch-js="search-wrapper-input"]',closeLoupeIcons='[data-amsearch-js = "close"], [data-amsearch-js="loupe"]';$(closeLoupeIcons).appendTo($(inputWrapper)).show();if(this.windowWidth>=this.mobileView){this.searchForm.find('.search-autocomplete').css('width',defaultSearchBlock);$(inputWrapper).css('width','100%');}
this.logo.addClass('logo-static');this.searchForm.addClass('amsearch-form-container');this.searchForm.addClass('-opened').find('.input-text').attr('placeholder',$.mage.__('Enter Keyword or Item'));this.defineExistencePopup();},showPopup:function(data){var self=this,searchField=this.element,dropdown=$('<div class="amsearch-results" data-amsearch-js="results"></div>'),searchResults=$('<div class="amsearch-leftside" data-amsearch-js="left-side"></div>'),sideProportion=this.proportionSide,productResults='[data-amsearch-js="products"]',leftSide='[data-amsearch-js="left-side"]',leftSideWidth,productsWidth,defaultSearchBlock=this.searchForm.width(),inputWrapper='[data-amsearch-js="search-wrapper-input"]',popularSearch='[data-search-block-type="popular_searches"]',recentSearch='[data-search-block-type="recent_searches"]',closeLoupeIcons='[data-amsearch-js = "close"], [data-amsearch-js="loupe"]';dropdown.append(searchResults);this.searchForm.addClass('amsearch-form-container');if($.type(data)=='string'){searchResults.append(data);}else{for(var i in data){if(data[i].type==='product'&&this.options.width>=this.sizePopupBreakpoint&&this.windowWidth>=this.mobileView){dropdown.append(data[i].html);}else{searchResults.append($(data[i].html).addClass(data[i].type));}}}
this.changePopupFlow();this.responseList.indexList=this.autoComplete.html(dropdown).addClass('amsearch-clone-position').show().find(this.options.responseFieldElements+':visible');this.autoComplete.trigger('contentUpdated');$(popularSearch).parent('.amsearch-item-container').addClass('popular_searches');$(recentSearch).parent('.amsearch-item-container').addClass('recent_searches');if(this.options.width>=this.sizePopupBreakpoint){leftSideWidth=$(productResults).length?this.options.width*sideProportion:searchField.outerWidth();productsWidth=this.options.width?this.options.width*(1-sideProportion):searchField.outerWidth();$(productResults).addClass('-columns');}else{leftSideWidth=$(productResults).length?this.options.width:searchField.outerWidth();}
$(closeLoupeIcons).appendTo($(inputWrapper)).show();if(this.windowWidth>=this.mobileView){$(inputWrapper).css('width','100%');this.searchForm.find('.search-autocomplete').css('width',defaultSearchBlock);}
this.searchForm.addClass('-opened').find('.input-text').attr('placeholder',$.mage.__('Enter Keyword or Item'));this.logo.addClass('logo-static');this.searchForm.keydown(function(eventObject){if(eventObject.which==27){self.hidePopup();}});$(leftSide).css('width',leftSideWidth);$(productResults).css('width',productsWidth);if(!$(leftSide).children().length){$(leftSide).hide();}
if(!$(leftSide).children('.amsearch-item-container').length){$(productResults).css('width','100%');}
this._resetResponseList(false);this.element.removeAttr('aria-activedescendant');if(this.responseList.indexList.length){this._updateAriaHasPopup(true);}else{this._updateAriaHasPopup(false);}
this.responseList.indexList.on('click',function(e){var $target=$(e.target);if($target.hasClass('amasty-xsearch-block-header')){return false;}
if(!$target.attr('data-click-url')){$target=$(e.target).closest('[data-click-url]');}
if($(e.target).closest('[data-amsearch-js="item-actions"]').length===0&&$(e.target).closest('[data-amsearch-js="product-item"]').length){document.location.href=$target.attr('data-click-url');}else{this.element.focus();this.element.trigger('focus');this.element.blur();}}.bind(this)).on('mouseenter mouseleave',function(e){if(this.responseList&&this.responseList.indexList){this.responseList.indexList.removeClass(this.options.selectClass);}
$(e.target).addClass(this.options.selectClass);this.responseList.selected=$(e.target);this.element.attr('aria-activedescendant',$(e.target).attr('id'));}.bind(this));return defaultSearchBlock;},hidePopup:function(){var defaultSearchBlock=this.showPopup(),inputWrapper='[data-amsearch-js="search-wrapper-input"]';this.autoComplete.hide();if(this.autoComplete.is(':hidden')){this.searchLabel.removeClass('active');}
$('[data-amsearch-js="close"], [data-amsearch-js="loupe"]').hide();this.searchForm.find('.input-text').attr('placeholder',$.mage.__('Search entire store here...'));this.searchForm.removeClass('-opened');this.searchForm.removeClass('amsearch-form-container');this.logo.removeClass('logo-static');if(this.windowWidth>=this.mobileView){$(inputWrapper).css('width','100%');this.searchForm.find('.search-autocomplete').css('width',defaultSearchBlock);}},});return $.sw.searchWidget;}});