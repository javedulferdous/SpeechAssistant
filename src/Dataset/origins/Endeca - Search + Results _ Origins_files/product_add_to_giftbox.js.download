!function(t){Drupal.behaviors.productAddToGift={attach:function(e){if(!Drupal.settings.common.show_product_gifting)return null;var s=this;s.multiAdd=!1,s.isOpen=!1,s.doSort=!0,s.giftSets=[],s.prodId="",s.skuBaseId="",s.giftSkuId="",s.itemQty=1,s.setShadeChangeBtnUpdate(),s.setQuantityChangeUpdate(),t(document).on("product.init",(function(t){s.setMenuBtn(t)})),s.setMenuBtn()},setShadeChangeBtnUpdate:function(){var e=this;e.nodes.$addGiftNode=t(".js-add-to-giftbox"),t(document).on("product.skuSelect",(function(t,s){void 0!==s&&(s="number"==typeof s?s.toString():s,e.nodes.$addGiftNode.attr("data-sku-base-id",s),e.skuBaseId=s)}))},setQuantityChangeUpdate:function(){var e=this;t(document).on("product.qtySelect",(function(t,s){void 0!==s&&(s="number"==typeof s?s:parseInt(s),e.itemQty=s)}))},setMenuBtn:function(e){var s=this,n=e&&e.target?e.target:t(".js-product-full");if(s.nodes.$addGiftNode=t(".js-add-to-giftbox",n),s.nodes.$addGiftNode.hasClass("set"))return null;s.nodes.$addGiftNode.addClass("set"),s.nodes.$addGiftNode.bind("click",(function(e){e.preventDefault();var n=t(this);if(s.nodes.init(n),s.inQuickShop=n.parents(".js-quickshop-container").length,s.prodId=n.data("product-id"),s.skuBaseId=n.data("sku-base-id"),s.giftSkuId=s.multiAdd?void 0:s.skuBaseId,n.hasClass("active"))return n.removeClass("active"),s.hideGiftMenu(),null;s.inQuickShop&&(s.nodes.$giftForm.addClass("in-quickshop"),s.nodes.$quickshop.addClass("gifting-open")),n.addClass("active"),s.clearErrorMsg(),s.setEvents(),s.showProgress(),s.clearGiftNameInput(),s.showGiftMenu(),s.setCloseBtn(),s.getCollections(),s.setScrolling()}))},setEvents:function(){var e=this,s=document.getElementById("js-new-item-text");s&&(s.onkeydown=function(t){var s=t||event;if(13==s.keyCode){if(e.nodes.$addNewItem.hasClass("hidden"))return;e.nodes.$addGiftBtn.trigger("click"),Event.stop(s)}}),this.multiAdd||t(document).bind("select:sku",(function(t){e.giftSkuId=t.memo.SKU_BASE_ID})),e.nodes.$addGiftBtn.unbind("click"),e.nodes.$addGiftBtn.bind("click",(function(t){e.handler(e)})),e.nodes.$newGiftText.bind("click",(function(){e.nodes.$dropdown.children().removeClass("active"),e.nodes.$chosenGiftsetID.val(""),e.nodes.$chosenGiftsetName.val("")}))},setCloseBtn:function(){var t=this;t.nodes.$closeBtn.bind("click",(function(){t.hideGiftMenu()}))},resetDropdown:function(e){if(e.length<=0)return null;var s=this.doSort?_.sortBy(e,"COLLECTION_NAME"):e;if(this.nodes.$dropdown.html(""),t.isArray(s))for(var n in s){var i=s[n];if(i){var o=t('<li class="" id="'+i.COLLECTION_ID+'">'+i.COLLECTION_NAME+"</li>");this.nodes.$dropdown.append(o)}}},resetDropdownOptions:function(){var e=this,s=e.nodes.$dropdown.find("li");s.each((function(n,i){t(i).bind("click",(function(n){e.nodes.$chosenGiftsetID.val(this.id),e.nodes.$chosenGiftsetName.val(this.innerHTML),t(this).hasClass("js-create-new")?(e.nodes.$newGiftText.html(""),e.nodes.$addGiftBtn.click()):(s.each((function(e,s){t(s).removeClass("active")})),t(this).addClass("active"))}))}))},getCollections:function(){var t=this;generic.jsonrpc.fetch({method:"user.giftSets",onSuccess:function(e){var s=e.getValue();s=_.without(s,null,""),t.resetDropdown(s),t.resetDropdownOptions(),s.length>=1?t.showChooseMenu():t.hideChooseMenu(),t.setScrolling(),t.hideProgress()},onFailure:function(e){t.showErrors(e)}})},handler:function(e){var s=e;s.showProgress();for(var n,i=s.nodes.$chosenGiftsetID.val(),o=s.nodes.$chosenGiftsetName.val(),d=[],r=0;r<s.itemQty;r++)d.push(s.giftSkuId);o||(o=s.nodes.$newGiftText.val()),n=s.multiAdd?[{_SUBMIT:"alter_collection",action:"add,save",COLLECTION_TYPE:"UKIT",COLLECTION_ID:i,COLLECTION_NAME:o||"",COLLECTION_SUBTYPE:"SITEWIDE_GIFT",SKU_BASE_ID:giftSkuIds,INCREMENT:1}]:[{_SUBMIT:"alter_collection",action:"add,save",COLLECTION_TYPE:"UKIT",COLLECTION_ID:i,COLLECTION_NAME:o||"",COLLECTION_SUBTYPE:"SITEWIDE_GIFT",SKU_BASE_ID:d}],generic.jsonrpc.fetch({method:"rpc.form",params:n,onSuccess:function(e){var n=e.getData();t(document).trigger("addToCart.success",[n]),s.getCollections(),s.hideGiftMenu(),s.hideInputError()},onFailure:function(t){s.showErrors(t)}})},nodes:{init:function(e){this.$container=e.parent(".js-display-gifting"),this.$quickshop=e.parents(".js-quickshop"),this.$closeBtn=t(".js-gifting-close",this.$container),this.$addGiftNode=t(".js-add-to-giftbox",this.$container),this.$chooseGift=t(".js-choose-gift-set",this.$container),this.$dropdown=t(".js-gift-set-dropdown",this.$container),this.$giftForm=t(".js-gifting-form",this.$container),this.$addGiftBtn=t(".js-add-gift",this.$container),this.$newGiftText=t(".js-new-item-text",this.$container),this.$progressNode=t(".js-progress",this.$container),this.$chosenGiftsetID=t(".js-gift-set-selection-id",this.$container),this.$chosenGiftsetName=t(".js-gift-set-selection-name",this.$container),this.$errorMsgCont=t(".js-error-messages",this.$container),this.$qtyDropdown=t(".js-product-qty-select")}},setScrolling:function(){var e,s=Math.ceil(.2*t(window).height());e=this.nodes.$giftForm.offset().top,t("html, body").animate({scrollTop:e-s},{duration:400})},showErrors:function(t){var e=t.getMessages();generic.showErrors(e),this.hideProgress(),this.showInputError()},showProgress:function(){this.nodes.$progressNode.removeClass("hidden"),this.nodes.$addGiftBtn.addClass("hidden")},hideProgress:function(){this.nodes.$progressNode.addClass("hidden"),this.nodes.$addGiftBtn.removeClass("hidden")},hideChooseMenu:function(){this.nodes.$chooseGift.addClass("hidden")},showChooseMenu:function(){this.nodes.$chooseGift.removeClass("hidden")},showInputError:function(){this.nodes.$newGiftText.addClass("error")},hideInputError:function(){this.nodes.$newGiftText.removeClass("error")},hideGiftMenu:function(){this.nodes.$addGiftNode.removeClass("active"),this.nodes.$giftForm.addClass("hidden"),this.nodes.$quickshop.removeClass("gifting-open")},showGiftMenu:function(){this.nodes.$addGiftNode.addClass("active"),this.nodes.$giftForm.removeClass("hidden")},clearGiftNameInput:function(){this.nodes.$newGiftText.val("")},clearErrorMsg:function(){this.nodes.$errorMsgCont.empty()}}}(jQuery);
//# sourceMappingURL=product_add_to_giftbox.js.map
