var site=site||{};site.template=site.template||{},function(e){Drupal.behaviors.applied_offers_overlay_v1={findOfferLinks:function(){var t=this;e(".js-apply-now-offer").click((function(r){r.preventDefault();var a=e(this).prop("href"),n=e(this).data("offer_code");e(this).data("no_redirect")&&n?t.applyOffer({link:e(this)}):n&&window.location.replace(a)}))},applyOffer:function(e){var t=this,r=e.link,a=r.data("offer_code"),n=r.data("applied_offer_confirm");generic.jsonrpc.fetch({method:"offers.apply",params:[{offer_code:a,do_not_defer_messages:1}],onBoth:function(e){var s,i=e.getValue(),o=e.getMessages()||[],f=[];i&&i.inCart?(s=i.confirm_message,""!==r.data("offer_applied_text")&&r.html(r.data("offer_applied_text"))):(o=e.getMessages()||[]).length&&(f=o);if(n){var l=t.setMessaging({offerCode:a,message:s,errors:f});t.launchOverlay(l)}}})},searchUrl:function(t){var r=t.searchStrings,a=decodeURIComponent(encodeURIComponent(window.location.search.substring(1))).split("&"),n={};return e.each(a,(function(t,s){var i=a[t].split("=");-1!==e.inArray(i[0],r)&&(n[i[0]]=i[1])})),n},setMessaging:function(t){var r=t.offerCode,a=t.message,n=t.errors||[],s="";try{e.each(n,(function(e,t){""!=t.text&&"&nbsp;"!=t.text||(t.text=t.key)})),s=site.template.get({name:"applied_offers_overlay",data:{message:a,offer_code:r,errors:n}})}catch(e){s=this.setMessagingInline(t)}return s},setMessagingInline:function(t){var r,a=t.offerCode,n=t.message,s=t.errors||[],i=e(".applied-offer-overlay");if(i.length){i.attr("data-applied_offer",a);var o=i.find(".applied-offer__message");e(o).empty();var f=i.find(".applied-offer__default-message");n&&""!=n||s.length?(f.addClass("hidden"),e(o).html(n)):f.removeClass("hidden");var l=i.find("ul.error_messages");l.empty(),e.each(s,(function(t,r){""!=r.text&&"&nbsp;"!=r.text||(r.text=r.key);var a=[];(a=e("<li/>")).html(r.text),l.append(a)})),r=i.html()}return r},launchOverlay:function(e){generic.overlay.launch({content:e,cssStyle:{height:"115px",width:"768px"}})},triggerOverlayOnRedirect:function(){var e=this,t=this.searchUrl({searchStrings:["applied_offer_confirm","o"]}),r=t.applied_offer_confirm||0,a=t.o||"";if(1==r&&""!=a){var n={filter:{in_cart:1,offer_code:a}};generic.jsonrpc.fetch({method:"offer.offersMatching",params:[n],onBoth:function(t){var r,n=t.getValue(),s=t.getMessages()||[];0==s.length&&(r=n.length?n[0].confirm_message:null);var i=e.setMessaging({offerCode:a,message:r,errors:s});e.launchOverlay(i)}})}},attach:function(e,t){this.attached||(this.attached=!0,this.findOfferLinks(),this.triggerOverlayOnRedirect())},attached:!1}}(jQuery);
//# sourceMappingURL=applied_offers_overlay_v1.js.map
