var prodcat=prodcat||{};prodcat.data=prodcat.data||{};var site=site||{};site.template=site.template||{},Drupal.behaviors.quickshop=function(t){var e,i=function(){for(var t="active",e=1;e<=10;e++)t+=" active--"+e;return t}(),s={$grids:t(),initGrid:function(e,i){_.isUndefined(i)&&(i=Unison.fetch.now().name);var s=!_.isUndefined(i)&&-1!==i.indexOf("small"),a=this;e.has(".product-grid__item").each((function(){a.reset(t(this));var e=0,i="",r=[],o=t(this).hasClass("product-grid--carousel"),c=t(),n=t('<div class="js-quickshop-container quickshop-wrapper" role="presentation" aria-live="polite" />'),d=t(".product-grid__item:visible",this),u=d.length;if(d.each((function(a){if(t(this).data("product-id")&&(i+=" js-quickshop-container--"+t(this).data("product-id")),!o)if(s)t(this).after(n.clone()).next().addClass(i),i="",r.push(t(this));else{var d=1,p=3;t(this).data("quickshop-after")&&(p=t(this).data("quickshop-after")),t(this).data("colspan")&&(d=t(this).data("colspan")),e+=d,c=c.add(this),e!==p&&a+1!==u||(e===p&&t(this).addClass("last"),t(this).after(n.clone()).next().addClass(i),r.push(c),e=0,c=t(),i="")}})),o){var p=t(".slick-slide",this);r=p.length?[p]:[d],t(this).after(n.clone()).next().addClass(i)}t(this).data("product-grid-rows",r),a.$grids.add(t(this))}))},reset:function(e){var i=e.hasClass("product-grid--carousel")?e.parent():e;t(".js-quickshop-container",i).remove(),t(".product-brief",e).removeClass("active")},attach:function(e){var i,s=Unison.fetch.now()?Unison.fetch.now().name:"medium",a=this;this.initGrid(t(".product-grid--quickshop",e),s),Unison.fetch.now()||(i=setInterval((function(){Unison.fetch.now()&&(s=Unison.fetch.now().name,a.initGrid(t(".product-grid--quickshop",e),s),clearInterval(i))}),50))}};return t(document).on("click",".js-quickshop-trigger",(function(e){e.preventDefault(),t(this).attr("aria-expanded","true"),t(this).closest(".js-product").trigger("product.quickshop.launch"),t(".js-access-content-expanded").focus();var i=t(".product__inventory-status-item:visible").text(),s=t(document.activeElement);s.hasClass("button--disabled")&&s.attr({"aria-label":i,role:"presentation"}),site.restrict_navigation(t(".js-access-content-expanded"))})),t(document).on("product.quickshop.close",".js-product",(function(){var e=t(this).data("product-id"),s=t(this).closest(".product-grid"),a=s.closest(".product-grid-wrapper"),r=t(".js-quickshop-container--"+e,a);t(this).removeClass("active"),t(".js-quickshop-trigger").attr("aria-expanded","false"),r.slideUp(400,(function(){t(this).removeClass(i).find(".js-quickshop").remove(),s.trigger("product.quickshop.afterAnimation")}))})),t(document).on("product.quickshop.launch",".js-product",(function(){var e,s=t(this).data("product-id"),a=prodcat.data.getProduct(s),r=t(this),o=r.closest(".product-grid"),c=o.hasClass("product-grid--carousel"),n=r.closest(".product-grid__item"),d=t(".product-brief",o),u=c?o.parent():o,p=t(".js-quickshop-container",u),l=p.filter(".js-quickshop-container--"+s),h=p.filter(".active"),f=t(),v=r.hasClass("active");Unison.fetch.now().name;if(v)r.trigger("product.quickshop.close");else{var g=r.data("available-skus");if(g){var m=[];_.each(_.map(g.split(","),t.trim),(function(t){_.each(a.skus,(function(e){e.SKU_ID===t&&m.push(e)}))})),m.length&&(a.skus=m)}var k=site.template.get({name:"product_quickshop",data:a});if(_.isUndefined(window.CATEGORY_ID)||t(window).trigger("MPP:productQV",[window.CATEGORY_ID+"~"+s]),h.hide(),t(".js-quickshop",l).remove(),l.append(k).show(),Drupal.settings.common.enable_preorder&&site.templates&&site.templates.product_pre_order){var q=site.template.get({name:"product_pre_order",data:a});t(".js-product",l).append(q).show()}(f=t(".js-product",l)).trigger("product.init"),f.find("select.js-sku-menu").trigger("change"),t(".js-quickshop-close",l).on("click keydown",(function(e){switch(site.getKeycode(e)){case 1:case 13:e.preventDefault(),r.trigger("product.quickshop.close");break;case 9:t(".js-product-shade:visible").length>0&&(t(".js-product-shade:visible").first().focus(),site.restrict_navigation(t(".js-quickshop")))}})),e=l.offset().top,o.trigger("product.quickshop.beforeAnimation"),t("html, body").animate({scrollTop:e+-200},{duration:400}),d.removeClass("active"),r.addClass("active");var j,w=s.replace(/[A-Za-z$-]/g,"");if(window.generic.jsonrpc.fetch({method:"reviews.latestMppProductReview",params:[{PROD_BASE_ID:w}],onSuccess:function(e){var i=e.getValue();if(i){i.TITLE&&t(".js-headline",l).text(i.TITLE),i.REVIEW_TEXT&&t(".js-quote",l).text(i.REVIEW_TEXT);var s=i.DISPLAY_NAME;s?s+=", ":s="",s+=i.REVIEWER_LOCATION,t(".js-author",l).text(s);var a=i.RATING/5*100+"%";t(".js-rating",l).css({width:a}).removeClass("hidden")}else t(".product-quote",l).remove()},onFailure:function(){}}),c){var C=t(".js-product-carousel",o).first().slick("slickCurrentSlide");j=n.data("slick-index")-C+1}else j=n.prevUntil(".js-quickshop-container").filter(".js-grid-item:visible").length+1;l.hasClass("active")?l.removeClass(i).addClass("active active--"+j):(h.show().slideUp(400,(function(){t(this).removeClass(i).find(".js-quickshop").remove(),o.trigger("product.quickshop.afterAnimation")})),l.addClass("active active--"+j).hide().slideDown(400,(function(){t(this).css({display:"",overflow:""}),o.trigger("product.quickshop.afterAnimation")})))}})),t(document).on("grid.reflow",".product-grid--quickshop",(function(){s.initGrid(t(this))})),Unison.on("change",(function(i){"large"===e&&"medium"===i.name||"medium"===e&&"large"===i.name||(e=i.name,s.initGrid(t(".product-grid--quickshop"),i.name))})),s}(jQuery);
//# sourceMappingURL=product_quickshop.js.map
