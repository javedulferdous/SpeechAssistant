!function(e){"use strict";Drupal.behaviors.estimatedDeliveryV2={rpcBaseOptions:{method:"address.estimateDeliveryDateSPP"},getRpcOptions:function(t,s){return e.extend({params:[{POSTAL_CODE:t}]},this.rpcBaseOptions,s)},nodes:{},data:null,validData:null,metadata:null,isData:function(e){return null!=e.type},isValidData:function(e){return-1===this.invalidTypes.indexOf(e.type)},invalidTypes:["us_std","us_territory","us_mil_pobox"],displayOrder:["us_nextday","us_2day","us_std","us_std_exact","us_territory","us_mil_pobox"],resources:{},attach:function(t){e.extend(this.nodes,{context:t,openElement:e(".js-estimated-delivery-open",t)}),this.nodes.openElement.on("click",_.bind(this.init,this))},init:function(){var t=site.template.get({name:"estimated_delivery"});generic.overlay.launch({content:t,width:455,height:304,cssClass:"product__estimated-delivery-overlay-cbox",onClosed:function(){e(".js-estimated-delivery-open").focus()}}),e.extend(this.nodes,{container:e(".js-estimated-delivery-container",this.nodes.context),search:e(".js-estimated-delivery-search",this.nodes.context),submit:e(".js-estimated-delivery-submit",this.nodes.context),disclaimer:e(".js-estimated-delivery-disclaimer",this.nodes.context),disclaimerToggle:e(".js-estimated-delivery-disclaimer-toggle",this.nodes.context),dataContainer:e(".js-estimated-delivery-data",this.nodes.context),dataError:e(".js-estimated-delivery-data-error",this.nodes.context),dataTable:e(".js-estimated-delivery-data-table",this.nodes.context),dataTableBody:e(".js-estimated-delivery-data-table-body",this.nodes.context),resultRow:e(".js-estimated-delivery-result-row",this.nodes.context),resultDate:e(".js-estimated-delivery-result-date-cell",this.nodes.context),resultMethod:e(".js-estimated-delivery-result-method-cell",this.nodes.context)}),this.nodes.disclaimerToggle.on("click keydown",_.bind((function(t){var s=site.getKeycode(t);1!==s&&13!==s||(this.nodes.disclaimer.toggle(),e.colorbox.resize())}),this)),this.nodes.submit.on("click",_.bind(this.submit,this)),this.nodes.search.on("keydown",_.bind((function(e){13==e.which&&(e.preventDefault(),this.submit())}),this))},submit:function(){var t=this.nodes.search.val();generic.jsonrpc.fetch(this.getRpcOptions(t,{onSuccess:_.bind((function(t){this.data=_.filter(t.getValue(),this.isData),this.metadata=_.reject(t.getValue(),this.isData),this.validData=_.filter(this.data,this.isValidData,this),this.display(this.validData),e.colorbox.resize()}),this),onFailure:_.bind((function(e){var t=e.getMessages();this.nodes.dataTable.hide(),this.nodes.dataError.show(),generic.showErrors(t,null,null)}),this)}))},display:function(t){var s,i=this.metadata[1].is_valid_zipcode,a=this.nodes.container.data("invalid-error-message"),d=[];if(t||(t=this.data),!i)return this.nodes.dataError.html(a),this.nodes.dataTable.hide(),this.nodes.dataError.show(),this.nodes.dataError.addClass("error"),this.nodes.search.addClass("error"),void generic.focusErrors(e(".js-estimated-delivery-data"),e(".js-estimated-delivery-container"));s=this.nodes.resultRow.remove().first(),this.nodes.dataTableBody.empty(),e.each(t,_.bind((function(e,t){var i=t.min_day_name+" "+t.min_mon+"."+t.min_day_num,a=t.shipment_option_text,n=a.match(/Standard/),o=s.clone();n&&(a=n[0]),t.max_day_num&&(i+=" - "+t.max_day_name+" "+t.max_mon+"."+t.max_day_num),o.find(".js-estimated-delivery-result-method-cell").html(a),o.find(".js-estimated-delivery-result-date-cell").html(i),t.type&&-1!==this.displayOrder.indexOf(t.type)?(o.data("shipmethod-type",t.type),d[this.displayOrder.indexOf(t.type)]=o):d[this.displayOrder.length>d.length?this.displayOrder.length:d.length]=o}),this)),this.nodes.dataTableBody.append(_.compact(d)),this.nodes.dataError.hide(),this.nodes.dataTable.show()}}}(jQuery);
//# sourceMappingURL=estimated_delivery_v2.js.map
