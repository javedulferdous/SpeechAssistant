var site=site||{};site.userInfoCookie=site.userInfoCookie||{},site.userInfoCookie.getValue=site.userInfoCookie.getValue||function(){return""},Drupal.behaviors.utilityNavV1=function(t,e,n,a){"use strict";var r,i=t(),o=t(),s=t(),u={item_count:0,subtotal:"",points:0,order_within:"",ship_sooner_date:"",items:[],singular:0,new_items:[]},c="empty",l=!1;function d(e){for(var n=function(t){return t.replace(/\./,"_")},a=function(t){for(var e=[],a=0,r=t.length;a<r;a++){var i={};if("string"==typeof t[a])e.push(t[a]);else{for(var o in t[a])i[n(o)]=t[a][o];e.push(i)}}return e},r=[],i=0,o=e.length;i<o;i++)for(var s in r[i]={},e[i])e[i].hasOwnProperty(s)&&(t.isArray(e[i][s])?r[i][n(s)]=a(e[i][s]):r[i][n(s)]=e[i][s]);return r}function f(){"added"===c&&(r=setTimeout((function(){l&&t(document).trigger("gnav.close"),_.setState()}),5e3))}function m(){clearTimeout(r)}var _={attach:function(e){o=o.add(t(".utility-nav--cart-item",e)).first(),i=i.add(t(".js-cart-block-container",e)),s=s.add(t(".utility-nav__cart-count",e));var a=+n.userInfoCookie.getValue("is_loyalty_member"),r=n.userInfoCookie.getValue("first_name"),u=n.userInfoCookie.getValue("current_available");t(".utility-nav__loyalty-text",e).attr("data-loyalty-gnav")&&a&&(t(".utility-nav__wrapper",e).addClass("hidden"),t(".utility-nav__loyalty-text",e).removeClass("hidden"),t(".utility-nav__loyalty-text span:nth-child(1)",e).text(r),t(".utility-nav__loyalty-text span:nth-child(2)",e).text(u)),n.userInfoCookie&&this.setData({item_count:n.userInfoCookie.getValue("item_count")-0})},render:function(){u&&u.items&&t.each(u.items,(function(t,e){u.items[t].hasOwnProperty("isBundleItem")&&u.items[t].isBundleItem&&(u.display_bundle_info=1)}));var e=n.template.get({name:"gnav_cart_content",data:u});return e=n.template.render(e,u),i.html(e),s.text(u.item_count),this},load:function(){return i.addClass("loading"),a.jsonrpc.fetch({method:"trans.get",params:[{trans_fields:["TRANS_ID","totals"],payment_fields:[],order_fields:["items","samples","offerCodes"]}],onSuccess:function(t){i.removeClass("loading");var n=t.getValue();!e.isUndefined(n)&&n&&_.setData({subtotal:n.formattedSubtotal,points:n.points,order_within:"",ship_sooner_date:"",item_count:n.items_count,items:d(n.order.items)})},onError:function(){i.removeClass("loading"),!1}}),!0,this},addItem:function(n){if(e.isUndefined(n)||!n||e.isUndefined(n.trans_data)||e.isUndefined(n.ac_results))return this;var a="";if("sku"!==this.getResultType(n.ac_results))a=this.setCollection(n);else{var r=n;a=e.map(n.ac_results,(function(e){var n=e.result,a=n.CARTITEM;a.new_qty=Math.max(1,a.ITEM_QUANTITY-n.PREVIOUS_ITEM_QUANTITY);var i=a["sku.SKU_BASE_ID"];if(null!=i&&r&&r.trans_data&&r.trans_data.order&&r.trans_data.order.items){var o=r.trans_data.order.items;t.each(o,(function(t,e){e["sku.SKU_BASE_ID"]===i&&(a.preOrderMsgShort=e.preOrderMsgShort)}))}return a}))}return this.setData({subtotal:n.trans_data.formattedSubtotal,points:0===n.trans_data.points?0:n.trans_data.points||u.points,items:d(n.trans_data.order.items),item_count:n.trans_data.items_count,new_items:d(a)}),this.setState("added"),t(document).trigger("gnav.open",[o]),l=!0,!0,f(),this},setState:function(t){var n=["empty","nonempty","added"],a="cart-block--",r=a+n.join(" cart-block--");if(e.isUndefined(t))c=u.item_count>0?"nonempty":"empty";else{if(!e.contains(n,t))throw new Error('"'+t+'" is not a valid cart state.');c=t}return i.removeClass(r).addClass(a+c),o.toggleClass("gnav-util--cart--nonempty","empty"!==c),this},setData:function(t){return e.extend(u,t),u.singular=1===u.item_count,this.setState().render(),this},setCollection:function(t){if(!t||!t.ac_results||!t.trans_data)return null;var n=t.trans_data.order,a=e.map(t.ac_results,(function(t){var e=t.result;return e&&e.COLLECTION_ID&&e.CARTITEM?e.COLLECTION_ID:null})),r=e.compact(a);return e.filter(n.items,(function(t){return e.contains(r,t.COLLECTION_ID)}))},getState:function(){return c},getData:function(t){return e.isUndefined(t)?u:u[t]},getResultType:function(t){var n="sku";return e.filter(t,(function(t){return"alter_collection"===t.instance})).length>0&&(n="collection"),e.filter(t,(function(t){return"alter_replenishment"===t.instance&&"REPL"===t.type})).length>0&&(n="replenishment"),n}};return t(document).on("addToCart.success",(function(t,e){_.addItem(e)})),t(document).on("click",".js-gnav-cart-trigger",(function(){if("empty"===c)return t(document).trigger("gnav.close"),window.location=t(this).attr("href"),!0})),t(".js-cart-block-container").on("mouseenter",m),t(".js-cart-block-container").on("mouseleave",f),t(document).on("click",".cart-block__items__view-bag",(function(t){t.preventDefault(),m(),_.setState().render()})),t(document).on("gnav-util.open",(function(t,e){if(e.$el.hasClass("utility-nav--cart-item")){if("empty"===c||"added"===c)return;_.load()}})),t(document).on("gnav-util.cart.update",(function(){_.load()})),t(document).on("click keydown",".js-cart-close",(function(e){var a=n.getKeycode(e);1!==a&&13!==a||(event.preventDefault(),t(document).trigger("gnav.close"),l=!1)})),t(document).on("focusout",".js-gnav-cart-checkout",(function(){t(".js-cart-close span").focus()})),t(document).on("gnav-util.close",(function(){l=!1})),_}(window.jQuery=window.jQuery||function(){},window._=window._||{},window.site=window.site||{},window.generic=window.generic||{});
//# sourceMappingURL=utility_nav_v1.js.map
