var generic=generic||{},site=site||{};!function(e){site.emailSignup={templateContainer:e(),initEmailSignup:function(){var s=this.templateContainer;if(!s.length)return null;s.each((function(){var i=e(this),n=i.is("form")?i:e("form",i),a=e(".js-email-signup__success",i),t=e(".js-email-signup__error",i),r=e('input[name="PC_EMAIL_ADDRESS"]',i),o=e('input[name="MOBILE_PHONE"]',i),l=e(".js-terms-conditions",i),u=e(".site-email-signup__field",i),c=e(".js-email-submit");s.closest(".js-utility-nav-content").addClass("loyalty_email_signup"),o.on("focus",(function(e){l.slideDown(300)})),c.on("keydown",(function(s){if(!s.shiftKey)return e(".js-close-nav").attr("tabindex","0").focus(),!1})),o.focus((function(){i.closest(".menu--lvl-2").addClass("email-menu-lvl-2")})),e(".js-site-email-signup-close",i).on("click",(function(){e(this).closest(".js-utility-nav-content").removeClass("active-util"),i.removeClass("success-email-signup"),l.slideUp(0)})),n.once("js-email-signup").submit((function(s){s.preventDefault(),a.add(t).addClass("hidden"),u.removeClass("error");var c={};e.each(n.serializeArray(),(function(e,s){c[s.name]=s.value.replace("undefined","").replace("%40","@")})),i.find('input[name="SMS_PROMOTIONS"]').prop("checked")&&(c.SMS_PROMOTIONS=1),i.find('input[name="ACCEPTED_PRIVACY_POLICY"]').prop("checked")&&(c.ACCEPTED_PRIVACY_POLICY=1,c.TERMS=1),e.cookie("csrftoken")&&(c._TOKEN=e.cookie("csrftoken")),generic.jsonrpc.fetch({method:"rpc.form",params:[c],onSuccess:function(s){s.getData().userinfo.previously_opted_in_email_promotion?e(document).trigger("email_signup:success_but_signed_up"):e(document).trigger("email_signup:success_and_new"),a.hasClass("inline")||(r.val(""),o.val(""),l.slideUp(0),n.addClass("success-email-signup")),a.removeClass("hidden")},onFailure:function(s){for(var i=s.getMessages(),a="",r=0;r<i.length;r++){a+="<li>"+i[r].text+"</li>";for(var o=2;o<i[r].tags.length;o++){var l=i[r].tags[o].substr(6).toUpperCase();e("[name="+l+"]",n).addClass("error")}}t.html(a).removeClass("hidden"),generic.focusErrors(e(".js-email-signup__error"),e(".js-email-signup-processed"))}})})),generic.focusErrors(e(".js-common-error-messages"),e(".js-password-reset__fieldset"))}))}},Drupal.behaviors.emailSignupFormV1={attach:function(s){site.emailSignup.templateContainer=e(".js-email-signup",s),site.emailSignup.initEmailSignup()}}}(jQuery);
//# sourceMappingURL=gnav_email_signup.js.map
