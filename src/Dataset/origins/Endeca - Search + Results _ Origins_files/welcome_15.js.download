var site=site||{},generic=generic||{};!function(e){window.site=site||{},site.offers=site.offers||{},site.offers.welcome15=site.offers.welcome15||{},Drupal.behaviors.ELB_welcome15={debug:!1,showThanks:!0,showSignedUp:!1,offerCookie:"welcome15",defaultTimeout:3e3,templates:{form:"welcome_15",thanks:"welcome_15_success",error:"welcome15_offer_error",disclaimer:"welcome15_offer_disclaimer"},overlay:{pc:{className:"welcome15-overlay",transition:"none",height:"auto",width:620,overlayClose:!0,trapFocus:!1},mobile:{className:"welcome15-overlay",width:"90%",height:"90%",maxHeight:"90%",opacity:"0",transition:"none",trapFocus:!1}},isStr:function(e){return"string"==typeof e},isFunc:function(e){return"function"==typeof e},isObj:function(e){return"[object Array]"!==Object.prototype.toString.call(e)&&(null!==e&&"object"==typeof e)},getTemplateContent:function(o,t){var i=i||{};t=t||!1;var n=site.template.get({name:o,data:t});return 0===n.length?e():!1!==t&&e.isFunction(i.render)?e(i.render(n,t)):e(n)},openWindow:function(o,t){var i=this;if(o=(o=i.isObj(o)?o:e()).wrap("<div />").parent().html(),!e.isFunction(e.colorbox))return!1;var n={html:o,height:"auto",maxWidth:"100%",maxHeight:"100%",closeButton:!0,scrolling:!1,close:'<i class="icon icon--close"></i>'},s=e("body").hasClass("device-mobile")?i.overlay.mobile:i.overlay.pc;if(e.extend(n,s),i.isObj(t))for(var r in t){var a=t[r];i.isFunc(a)&&(n[r]=a)}e.colorbox(n)},showSignupForm:function(o,t){var i=this;setTimeout((function(){var o,n=i.getTemplateContent(i.templates.form),s=e(n).find("#USE_ALT_LAYOUT").length;n.hasClass("js-welcome-15-hide")||(s&&((o=e("body").hasClass("device-mobile")?i.overlay.mobile:i.overlay.pc).className="welcome15-overlay alt_layout1",o.fixed=!0),i.openWindow(n,{onOpen:function(){e(".welcome15-overlay #cboxContent,#cboxOverlay").css("visibility","hidden")},onComplete:function(){site.offers.welcome15.initSignUpForm(t),e("body").hasClass("device-mobile")&&e.colorbox.resize()}}))}),o)},showOfferOnPage:function(){var o=this,t=o.offerCookie,i=e.cookie(t),n=!1,s=Drupal.settings.globals_variables.popup_show_at_visit_count||!1;if(!i){var r=o.getTemplateContent(o.templates.form);if(e(r).find("#DISABLE_POPOVER").length>0)return e.cookie(t,"1",{expires:14,path:"/"}),!1}return(o.debug||!i&&!Drupal.settings.common.show_welcome_every_session||Drupal.settings.common.show_welcome_every_session&&!sessionStorage.getItem("mx_newsletter_session"))&&(n=!0),s&&(n=!1,e(document).on("RPC:RESULT",(function(){parseInt(site.trackingDataLayer.data["cp.utag_main__pn"])===s&&o.showSignupForm()}))),n},attach:function(o,t){var i=this,n=i.offerCookie;i.showOfferOnPage()&&this.showSignupForm(i.defaultTimeout,o),e.cookie(n,"1",{expires:14,path:"/"}),Drupal.settings.common.show_welcome_every_session&&sessionStorage.setItem("mx_newsletter_session","true"),e(window).on("open:emailSignupOverlay",(function(){i.showSignupForm(0,o)})),e(o).on("email_signup.success",(function(o,t){var n,s=t.getData().userinfo||{},r=i.templates;s.previously_opted_in_email_promotion;if((n=r.thanks).length>0){var a=i.getTemplateContent(n);i.openWindow(a,{onComplete:function(){e.colorbox.resize()}})}})),e(o).on("email_signup.error",(function(e,o){})),e(o).on("cbox_complete",(function(){var t=e("body").hasClass("device-mobile")?i.overlay.mobile:i.overlay.pc,n=e("#cboxContent","#colorbox."+t.className.split(" ")[0]);n.length>0&&(e(".email_popover__disclaimer",n).find("a").once("disclaimer-link").click((function(o){o.preventDefault();var t="email_popover--disclaimer",n=e(this).closest(".email_popover"),s=e("."+t,n);return 0===s.length&&(s=e("<div></div>").addClass(t).html(i.getTemplateContent(i.templates.disclaimer))).prependTo(n),s.toggle(0,(function(){var o=e(this),t=e("#cboxContent"),i=e("#cboxClose"),r=e(".trans-close",o).text(),a=e(".email_popover__content"),l=e(".email_popover__disclaimer"),c=e(".email_popover__social_icons"),m=e(n).find("#USE_ALT_LAYOUT").length;if(o.css("overflow","").addClass("scrollable"),o.is(":visible")){i.hide(),m&&(a.hide(),l.hide(),c.hide());var p=e("<div />").attr("id","cboxClose--alt").html(r);p.click((function(){s.add(e(this)).remove(),i.show(),m&&(a.show(),l.show(),c.show())})),p.appendTo(t),e(".email_popover--disclaimer").jScrollPane()}})),!1})),e(".show_second_language").each((function(){e(this).parents(".welcome15-overlay").addClass("with-second-language")})),e(".js-input-pc-sms",o).once().focus((function(t){e(".js-sms-terms-conditions",o).slideDown(0),e.colorbox.resize()})))}))}},site.offers.welcome15={behavior:Drupal.behaviors.ELB_welcome15,getOverlayContent:function(){return e("#cboxLoadedContent")},initSignUpForm:function(o){var t=site.offers.welcome15,i=t.getOverlayContent(),n=e(".js-email-signup-welcome15",o),s=e(".welcome15-overlay",o);n.hasClass("email-signup-modified-layout")&&s.addClass("welcome15-content"),e(".welcome15-overlay #cboxContent,#cboxOverlay").fadeOut(1,(function(){e("#cboxOverlay").css("visibility","visible").fadeIn(500,(function(){e(".welcome15-overlay #cboxContent").css("visibility","visible").fadeIn(100),n.hasClass("email-signup-modified-layout")&&(e("#cboxContent,#cboxLoadedContent",o).css("max-width","500px"),s.addClass("welcome15-content--active"))}))})),i.find("form").submit((function(o){o.preventDefault();var n=this,s={};return e.each(["_SUBMIT","LAST_SOURCE","COUNTRY_ID","LANGUAGE_ID","PC_EMAIL_PROMOTIONS","redirect_or_text","redirect","PC_EMAIL_ADDRESS","SMS_PROMOTIONS","ACCEPTED_PRIVACY_POLICY"],(function(o,t){var i=e('input[name="'+t+'"]',n);i&&i.length>0&&(s[t]=i.val())})),e.cookie("csrftoken")&&(s._TOKEN=e.cookie("csrftoken")),generic.jsonrpc.fetch({method:"rpc.form",params:[s],onSuccess:function(o){(o.getData().userinfo||{}).previously_opted_in_email_promotion;var n=t.behavior,s=n.templates,r=s.error;r=s.thanks,i.empty().append(n.getTemplateContent(r)),e.colorbox.resize(),e(document).trigger("cbox_complete")},onFailure:function(o){var t=o.getMessages(),i=e(".js-popup-offer-error-messages"),n=e(".js-input-pc-email");t[0]&&(i.empty().html("<div>"+t[0].text+"</div>").removeClass("hidden"),i.addClass("error")),n.addClass("error"),e.colorbox.resize(),generic.focusErrors(e(".js-popup-offer-error-messages"),e(".js-email_input"))}}),!1}))}}}(jQuery);
//# sourceMappingURL=welcome_15.js.map
