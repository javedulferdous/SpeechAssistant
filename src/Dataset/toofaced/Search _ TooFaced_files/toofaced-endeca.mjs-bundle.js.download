(function(ce){ce.address=function(){var a=function(e){var t=ce.extend(ce.Event(e),function(){var e={},t=ce.address.parameterNames();for(var s=0,i=t.length;s<i;s++){e[t[s]]=ce.address.parameter(t[s])}return{value:ce.address.value(),path:ce.address.path(),pathNames:ce.address.pathNames(),parameterNames:t,parameters:e,queryString:ce.address.queryString()}}.call(ce.address));ce(ce.address).trigger(t);return t},i=function(e){return Array.prototype.slice.call(e)},r=function(e,t,s){ce().bind.apply(ce(ce.address),Array.prototype.slice.call(arguments));return ce.address},s=function(e,t){ce().unbind.apply(ce(ce.address),Array.prototype.slice.call(arguments));return ce.address},n=function(){return B.pushState&&L.state!==P},o=function(){return("/"+F.pathname.replace(new RegExp(L.state),"")+F.search+(c()?"#"+c():"")).replace(G,"/")},c=function(){var e=F.href.indexOf("#");return e!=-1?d(F.href.substr(e+1),A):""},l=function(){return n()?o():c()},e=function(){try{return top.document!==P&&top.document.title!==P?top:window}catch(e){return window}},u=function(){return"javascript"},h=function(e){e=e.toString();return(L.strict&&e.substr(0,1)!="/"?"/":"")+e},d=function(e,t){if(L.crawlable&&t){return(e!==""?"!":"")+e}return e.replace(/^\!/,"")},p=function(e,t){return parseInt(e.css(t),10)},f=function(){if(!ee){var e=l(),t=decodeURI(re)!=decodeURI(e);if(t){if(O&&Q<7){F.reload()}else{if(O&&!$&&L.history){V(v,50)}_old=re;re=e;m(A)}}}},m=function(e){var t=a(j),s=a(e?w:x);V(y,10);if(t.isDefaultPrevented()||s.isDefaultPrevented()){g()}},g=function(){re=_old;if(n()){B.popState({},"",L.state.replace(/\/$/,"")+(re===""?"/":re))}else{ee=E;if(q){if(L.history){F.hash="#"+d(re,E)}else{F.replace("#"+d(re,E))}}else if(re!=l()){if(L.history){F.hash="#"+d(re,E)}else{F.replace("#"+d(re,E))}}if(O&&!$&&L.history){V(v,50)}if(q){V(function(){ee=A},1)}else{ee=A}}},y=function(){if(L.tracker!=="null"&&L.tracker!==k){var e=ce.isFunction(L.tracker)?L.tracker:z[L.tracker],t=(F.pathname+F.search+(ce.address&&!n()?ce.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(ce.isFunction(e)){e(t)}else if(ce.isFunction(z.urchinTracker)){z.urchinTracker(t)}else if(z.pageTracker!==P&&ce.isFunction(z.pageTracker._trackPageview)){z.pageTracker._trackPageview(t)}else if(z._gaq!==P&&ce.isFunction(z._gaq.push)){z._gaq.push(["_trackPageview",decodeURI(t)])}}},v=function(){var e=u()+":"+A+";document.open();document.writeln('<html><head><title>"+U.title.replace(/\'/g,"\\'")+"</title><script>var "+T+' = "'+encodeURIComponent(l()).replace(/\'/g,"\\'")+(U.domain!=F.hostname?'";document.domain="'+U.domain:"")+'";</'+"script></head></html>');document.close();";if(Q<7){W.src=e}else{W.contentWindow.location.replace(e)}},R=function(){if(X&&Z!=-1){var e,t,s=X.substr(Z+1).split("&");for(e=0;e<s.length;e++){t=s[e].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(t[0])){L[t[0]]=isNaN(t[1])?/^(true|yes)$/i.test(t[1]):parseInt(t[1],10)!==0}if(/^(state|tracker)$/.test(t[0])){L[t[0]]=t[1]}}X=k}_old=re;re=l()},t=function(){if(!te){te=E;R();var e=function(){D.call(this);b.call(this)},t=ce("body").ajaxComplete(e);e();if(L.wrap){var s=ce("body > *").wrapAll('<div style="padding:'+(p(t,"marginTop")+p(t,"paddingTop"))+"px "+(p(t,"marginRight")+p(t,"paddingRight"))+"px "+(p(t,"marginBottom")+p(t,"paddingBottom"))+"px "+(p(t,"marginLeft")+p(t,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+T+'" style="height:100%;overflow:auto;position:relative;'+(q&&!window.statusbar.visible?"resize:both;":"")+'" />');ce("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});if(q){ce('<style type="text/css" />').appendTo("head").text("#"+T+"::-webkit-resizer { background-color: #fff; }")}}if(O&&!$){var i=U.getElementsByTagName("frameset")[0];W=U.createElement((i?"":"i")+"frame");W.src=u()+":"+A;if(i){i.insertAdjacentElement("beforeEnd",W);i[i.cols?"cols":"rows"]+=",0";W.noResize=E;W.frameBorder=W.frameSpacing=0}else{W.style.display="none";W.style.width=W.style.height=0;W.tabIndex=-1;U.body.insertAdjacentElement("afterBegin",W)}V(function(){ce(W).bind("load",function(){var e=W.contentWindow;_old=re;re=e[T]!==P?e[T]:"";if(re!=l()){m(A);F.hash=d(re,E)}});if(W.contentWindow[T]===P){v()}},50)}V(function(){a("init");m(A)},1);if(!n()){if(O&&Q>7||!O&&$){if(z.addEventListener){z.addEventListener(_,f,A)}else if(z.attachEvent){z.attachEvent("on"+_,f)}}else{K(f,50)}}if("state"in window.history){ce(window).trigger("popstate")}}},D=function(){var e,t=ce("a"),s=t.size(),i=1,a=-1,r='[rel*="address:"]',n=function(){if(++a!=s){e=ce(t.get(a));if(e.is(r)){e.address(r)}V(n,i)}};V(n,i)},C=function(){if(decodeURI(re)!=decodeURI(l())){_old=re;re=l();m(A)}},N=function(){if(z.removeEventListener){z.removeEventListener(_,f,A)}else if(z.detachEvent){z.detachEvent("on"+_,f)}},b=function(){if(L.crawlable){var t=F.pathname.replace(/\/$/,""),s="_escaped_fragment_";if(ce("body").html().indexOf(s)!=-1){ce('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var e=ce(this).attr("href").replace(/^http:/,"").replace(new RegExp(t+"/?$"),"");if(e===""||e.indexOf(s)!=-1){ce(this).attr("href","#"+encodeURI(decodeURIComponent(e.replace(new RegExp("/(.*)\\?"+s+"=(.*)$"),"!$2"))))}})}}},P,k=null,T="jQueryAddress",S="string",_="hashchange",I="init",j="change",w="internalChange",x="externalChange",E=true,A=false,L={autoUpdate:E,crawlable:A,history:E,strict:E,wrap:A},M=ce.browser,Q=parseFloat(M.version),O=!ce.support.opacity,q=M.webkit||M.safari,z=e(),U=z.document,B=z.history,F=z.location,K=setInterval,V=setTimeout,G=/\/{2,9}/g,H=navigator.userAgent,$="on"+_ in z,W,Y,X=ce("script:last").attr("src"),Z=X?X.indexOf("?"):-1,J=U.title,ee=A,te=A,se=E,ie=A,ae={},re=l();_old=re;if(O){Q=parseFloat(H.substr(H.indexOf("MSIE")+4));if(U.documentMode&&U.documentMode!=Q){Q=U.documentMode!=8?7:8}var ne=U.onpropertychange;U.onpropertychange=function(){if(ne){ne.call(U)}if(U.title!=J&&U.title.indexOf("#"+l())!=-1){U.title=J}}}if(B.navigationMode){B.navigationMode="compatible"}if(document.readyState=="complete"){var oe=setInterval(function(){if(ce.address){t();clearInterval(oe)}},50)}else{R();ce(t)}ce(window).bind("popstate",C).bind("unload",N);return{bind:function(e,t,s){return r.apply(this,i(arguments))},unbind:function(e,t){return s.apply(this,i(arguments))},init:function(e,t){return r.apply(this,[I].concat(i(arguments)))},change:function(e,t){return r.apply(this,[j].concat(i(arguments)))},internalChange:function(e,t){return r.apply(this,[w].concat(i(arguments)))},externalChange:function(e,t){return r.apply(this,[x].concat(i(arguments)))},baseURL:function(){var e=F.href;if(e.indexOf("#")!=-1){e=e.substr(0,e.indexOf("#"))}if(/\/$/.test(e)){e=e.substr(0,e.length-1)}return e},autoUpdate:function(e){if(e!==P){L.autoUpdate=e;return this}return L.autoUpdate},crawlable:function(e){if(e!==P){L.crawlable=e;return this}return L.crawlable},history:function(e){if(e!==P){L.history=e;return this}return L.history},state:function(e){if(e!==P){L.state=e;var t=o();if(L.state!==P){if(B.pushState){if(t.substr(0,3)=="/#/"){F.replace(L.state.replace(/^\/$/,"")+t.substr(2))}}else if(t!="/"&&t.replace(/^\/#/,"")!=c()){V(function(){F.replace(L.state.replace(/^\/$/,"")+"/#"+t)},1)}}return this}return L.state},strict:function(e){if(e!==P){L.strict=e;return this}return L.strict},tracker:function(e){if(e!==P){L.tracker=e;return this}return L.tracker},wrap:function(e){if(e!==P){L.wrap=e;return this}return L.wrap},update:function(){ie=E;this.value(re);ie=A;return this},title:function(e){if(e!==P){V(function(){J=U.title=e;if(se&&W&&W.contentWindow&&W.contentWindow.document){W.contentWindow.document.title=e;se=A}},50);return this}return U.title},value:function(e){if(e!==P){e=h(e);if(e=="/"){e=""}if(re==e&&!ie){return}_old=re;re=e;if(L.autoUpdate||ie){m(E);if(n()){B[L.history?"pushState":"replaceState"]({},"",L.state.replace(/\/$/,"")+(re===""?"/":re))}else{ee=E;if(q){if(L.history){F.hash="#"+d(re,E)}else{F.replace("#"+d(re,E))}}else if(re!=l()){if(L.history){F.hash="#"+d(re,E)}else{F.replace("#"+d(re,E))}}if(O&&!$&&L.history){V(v,50)}if(q){V(function(){ee=A},1)}else{ee=A}}}return this}return h(re)},path:function(e){if(e!==P){var t=this.queryString(),s=this.hash();this.value(e+(t?"?"+t:"")+(s?"#"+s:""));return this}return h(re).split("#")[0].split("?")[0]},pathNames:function(){var e=this.path(),t=e.replace(G,"/").split("/");if(e.substr(0,1)=="/"||e.length===0){t.splice(0,1)}if(e.substr(e.length-1,1)=="/"){t.splice(t.length-1,1)}return t},queryString:function(e){if(e!==P){var t=this.hash();this.value(this.path()+(e?"?"+e:"")+(t?"#"+t:""));return this}var s=re.split("?");return s.slice(1,s.length).join("?").split("#")[0]},parameter:function(e,t,s){var i,a;if(t!==P){var r=this.parameterNames();a=[];t=t===P||t===k?"":t.toString();for(i=0;i<r.length;i++){var n=r[i],o=this.parameter(n);if(typeof o==S){o=[o]}if(n==e){o=t===k||t===""?[]:s?o.concat([t]):[t]}for(var c=0;c<o.length;c++){a.push(n+"="+o[c])}}if(ce.inArray(e,r)==-1&&t!==k&&t!==""){a.push(e+"="+t)}this.queryString(a.join("&"));return this}t=this.queryString();if(t){var l=[];a=t.split("&");for(i=0;i<a.length;i++){var u=a[i].split("=");if(u[0]==e){l.push(u.slice(1).join("="))}}if(l.length!==0){return l.length!=1?l:l[0]}}},parameterNames:function(){var e=this.queryString(),t=[];if(e&&e.indexOf("=")!=-1){var s=e.split("&");for(var i=0;i<s.length;i++){var a=s[i].split("=")[0];if(ce.inArray(a,t)==-1){t.push(a)}}}return t},hash:function(e){if(e!==P){this.value(re.split("#")[0]+(e?"#"+e:""));return this}var t=re.split("#");return t.slice(1,t.length).join("#")}}}();ce.fn.address=function(i){var e;if(typeof i=="string"){e=i;i=undefined}if(!ce(this).attr("address")){var t=function(e){if(e.shiftKey||e.ctrlKey||e.metaKey||e.which==2){return true}if(ce(this).is("a")){e.preventDefault();var t=i?i.call(this):/address:/.test(ce(this).attr("rel"))?ce(this).attr("rel").split("address:")[1].split(" ")[0]:ce.address.state()!==undefined&&!/^\/?$/.test(ce.address.state())?ce(this).attr("href").replace(new RegExp("^(.*"+ce.address.state()+"|\\.)"),""):ce(this).attr("href").replace(/^(#\!?|\.)/,"");ce.address.value(t)}};ce(e?e:this).live("click",t).live("submit",function(e){if(ce(this).is("form")){e.preventDefault();var t=ce(this).attr("action"),s=i?i.call(this):(t.indexOf("?")!=-1?t.replace(/&$/,""):t+"?")+ce(this).serialize();ce.address.value(s)}}).attr("address",true)}return this}})(jQuery);var generic=generic||{};var site=site||{};generic.endeca=generic.endeca||{catalog:{},result:{},results:{},resultsgroup:{},mixins:{},instances:{},generic:{Class:generic.Class||{},env:generic.env||{},rb:generic.rb||{},template:generic.template||{}},helpers:{array:{toInt:function(e){for(var t=0;t<e.length;t++){e[t]=parseInt(e[t])}return e},unique:function(e){var t={},s=[];for(var i=0;i<e.length;i++){if(typeof t[e[i]]=="undefined"){s.push(e[i])}t[e[i]]=1}return s},remove:function(e,t){var s;var t=jQuery.isArray(t)?t:[t];return jQuery.grep(e,function(e){return jQuery.inArray(e,t)==-1})}},func:{bind:function(){var e=arguments[0]||null;var t=arguments[1]||this;var s=jQuery.grep(arguments,function(e,t){return t>1});return function(){return e.apply(t,s)}}},string:{toQueryParams:function(e,t){var e=e||"";var t=t||"&";var s=e.substring(e.indexOf("?")+1).split("#")[0].split(t||"&"),i={},a,r,n,o;for(a=0;a<s.length;a++){o=s[a].split("=");r=decodeURIComponent(o[0]);n=o[1]?decodeURIComponent(o[1]):"";if(i[r]){if(typeof i[r]=="string"){i[r]=[i[r]]}i[r].push(n)}else{i[r]=n}}return i}},obj:{first:function(e){for(var t in e){return e[t]}},slice:function(e,t){var s={};for(var i=0;i<t.length;i++){if(typeof e[t[i]]!="undefined"){s[t[i]]=e[t[i]]}}return s}}}};site.endeca=generic.endeca;var rb=rb||{};generic.endeca.generic.rb=function(e){var t=function(e){if(e&&rb){var t=e;var s=rb[t];if(s){return s}else{return{}}}else{return{}}};var s=t(e);var i={get:function(e){if(typeof e!="string"){return null}var t=s[e];if(t){return t}else{return e}}};return i};generic.endeca.generic.Class={fn:function(e,t){var i,s,a,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;i=function(){if(i.prototype.initialize){i.prototype.initialize.apply(this,arguments)}};e=e||Object;s=function(){};s.prototype=e.prototype;i.prototype=new s;i.superclass=e.prototype;i.prototype.constructor=i;for(a in t){if(typeof t[a]=="function"&&typeof i.superclass[a]=="function"&&r.test(t[a])){i.prototype[a]=function(t,s){return function(){this._super=i.superclass[t];var e=s.apply(this,arguments);return e}}(a,t[a])}else{i.prototype[a]=t[a]}}return i},create:function(){var e=arguments.length,t=Array.prototype.slice.call(arguments),s=generic.endeca.generic.Class.fn;if(e==2){tgt=generic.endeca.generic.Class.fn(t[0],t[1])}else if(e==1){tgt=generic.endeca.generic.Class.fn(null,t[0])}else{tgt=function(){}}return tgt},mixin:function(e,t){var s=e;if(t&&t.length){for(var i=0;i<t.length;i++){s=generic.endeca.generic.Class.mixin(s,t[i])}}else{if(t){s=generic.endeca.generic.Class.create(s,t)}}return s}};generic.endeca.generic.env={isIE:!!(typeof ActiveXObject=="function"),isIE6:!!(!!(typeof ActiveXObject=="function")&&/MSIE\s6\.0/.test(navigator.appVersion)),isFF:!!(typeof navigator.product!="undefined"&&navigator.product=="Gecko"&&!(document.childNodes&&!navigator.taintEnabled)&&/firefox/.test(navigator.userAgent.toLowerCase())),isFF2:!!(typeof navigator.product!="undefined"&&navigator.product=="Gecko"&&!(document.childNodes&&!navigator.taintEnabled)&&navigator.userAgent.toLowerCase().split(" firefox/")[1]&&navigator.userAgent.toLowerCase().split(" firefox/")[1].split(".")[0]=="2"),isFF3:!!(typeof navigator.product!="undefined"&&navigator.product=="Gecko"&&!(document.childNodes&&!navigator.taintEnabled)&&navigator.userAgent.toLowerCase().split(" firefox/")[1]&&navigator.userAgent.toLowerCase().split(" firefox/")[1].split(".")[0]=="3"),isMac:!!/macppc|macintel/.test(navigator.platform.toLowerCase()),isSafari:!!/Safari/.test(navigator.userAgent),domain:window.location.protocol+"//"+window.location.hostname,debug:true,parsedQuery:function(){var query=window.location.search.toString().split("?")[1]||"";var splitStr=query.split("&");var key,value,keyNameVar,tempObj,tempStr;var a={};a.n={};var main=function(){var params={};var returnArr=[];var arr=[];if(!query)return;for(var i=0;i<splitStr.length;i++){key=splitStr[i].split("=")[0];value=splitStr[i].split("=")[1];var rx=new RegExp(key);var c=splitStr[i].match(rx);if(eval("a.n."+c)){eval("a.n."+c+".e += 1");eval("a.n."+c+".v.push(value);")}else{eval('keyNameVar = { v:[], key:"'+c+'" };');eval("a.n."+c+" = keyNameVar;");eval("a.n."+c+".e = new Number(0); a.n."+c+".v.push(value);")}}for(var namespace in a.n){if(a.n[namespace].e>0){for(var n=0;n<=a.n[namespace].e;n++){arr.push(a.n[namespace].v.pop())}a.n[namespace].v=arr}tempObj=a.n[namespace].v;if(tempObj.length>1){eval("params."+namespace+"=tempObj")}else{tempStr=tempObj[0];eval("params."+namespace+"=tempStr")}}return params};var parameters=main()||{};return parameters},query:function(e){var t=generic.endeca.generic.env.parsedQuery()[e]||null;return t}};generic.endeca.generic.template=function(){var that={};var templateClassName=".inline-template";var templates={};var translations;var partials;var setInternalTemplate=function(e,t){templates[e]=t;return t};var getInternalTemplate=function(e){var t=templates[e];if(!t&&site.templates&&site.templates[e]){templates[e]=site.templates[e].content;t=templates[e]}return t};var returnTemplate=function(t){var s=t.template;s=interpolate({template:s,recurseParams:{object:t.object,rb:t.rb},Lre:/\[jsInclude\]/i,Rre:/\[\/jsInclude\]/i});if(typeof t.rb==="object"){s=interpolate({template:s,obj:t.rb,Lre:/\[rb\]/,Rre:/\[\/rb\]/})}if(typeof t.object==="object"){try{if(s.match(/\{\{.*\[/)&&s.match(/\].*\}\}/)){throw"generic.template: template expects array notation, defaulting to non-mustache rendering"}translations=translations||{globals:{t:site.translations||{},variables:Drupal.settings.common||{}}};var e=$.extend({},t.object,translations);s=Mustache.to_html(s,e,templates)}catch(e){console.log(e);s=interpolate({template:s,obj:t.object})}}return s};var interpolate=function(args){var args=args||{};args.Lre=args.Lre||/\{\{/;args.Rre=args.Rre||/\}\}/;var obj=args.obj||args.rb||{};var tmpl=args.template||"",recurseParams=args.recurseParams||null,Lre=new RegExp(args.Lre),Rre=new RegExp(args.Rre),tmplA=[],temp,lft,rght;tmplA=tmpl.replace(/[\r\t\n]/g," ").split(Lre);var returnString="";for(var x=0;x<tmplA.length;x++){var chunk=tmplA[x];var splitChunk=chunk.split(Rre);if(typeof splitChunk[1]!=="undefined"){var valueToInsert="";if(recurseParams){recurseParams["path"]=splitChunk[0];valueToInsert=that.get(recurseParams)}else{valueToInsert=eval("obj['"+splitChunk[0]+"']")||eval("obj."+splitChunk[0]);if(typeof valueToInsert==="undefined"||valueToInsert===null){valueToInsert=""}}chunk=valueToInsert.toString()+splitChunk[1]}returnString+=chunk}return returnString};that.get=function(e){var t=e.path;var s=e.callback;var i=!!e.forceReload;var a=e.object;var r=e.rb;var n=getInternalTemplate(t);var o;if(n&&!i){o=returnTemplate({template:n,object:a,rb:r,callback:e.callback})}else{var c=null;jQuery(templateClassName).each(function(){if(jQuery(this).html()&&jQuery(this).attr("path")==t){c=this}});if(c){n=setInternalTemplate(t,jQuery(c).html());o=returnTemplate({template:n,object:e.object,rb:r,callback:e.callback})}}if(typeof e.callback==="function"){e.callback(o)}else{return o}};that.loadMustacheMappings=function(e){var e=e||{mappings:{}};if(e.mappings){for(var t in e.mappings){if(e.mappings.hasOwnProperty(t)&&site.templates[e.mappings[t]]){templates[t]=site.templates[e.mappings[t]].content;templates[e.mappings[t]]=site.templates[e.mappings[t]].content}}}};return that}();generic.endeca.catalog=site.endeca.generic.Class.create({initialize:function(e){this.jsonResult=null;this.resultList=[];jQuery.extend(this,e||{});if(this.jsonResult){this.parseData()}},parseData:function(){if(this.jsonResult.AggrRecords){for(var e=0;e<this.jsonResult.AggrRecords.length;e++){for(var t=0;t<this.jsonResult.AggrRecords[e].Records.length;t++){this._parseRecord(this.jsonResult.AggrRecords[e].Records[t])}}}else if(this.jsonResult.Records){for(var e=0;e<this.jsonResult.Records.length;e++){this._parseRecord(this.jsonResult.Records[e])}}}});site.endeca.catalog=generic.endeca.catalog;generic.endeca.catalog.content=site.endeca.generic.Class.create(site.endeca.catalog,{_parseRecord:function(e){this.resultList.push({Properties:{image:site.endeca.generic.rb("endeca").get("content.image_url"),title:e.Properties.p_PROD_RGN_NAME,description:e.Properties.p_DESCRIPTION,link:e.Properties.p_url,link_text:site.endeca.generic.rb("endeca").get("content.link_text"),Zone:"crawlData"}})}});site.endeca.catalog.content=generic.endeca.catalog.content;generic.endeca.catalog.product=site.endeca.generic.Class.create(site.endeca.catalog,{initialize:function(e){this.categoryList={};this.productList={};this.skuList={};this.parseOrderHi=0;this.parseOrderLo=0;this._super(e);this.resultList=this.getProducts()},_parseRecord:function(e){if(e.Properties["rec_type"]=="product"){var t={c:{},p:{},s:{}};t["p"]["matched"]=1;t["s"]["matched"]=0;for(var s in e.Properties){var i=e.Properties[s];if(i&&i!=""&&!isNaN(i)){if(i.match(/\./)){i=parseFloat(i)}else{i=parseInt(i)}}if(s.match(/_json/i)){s=s.replace(/_json/i,"");i=jQuery.parseJSON(i)}if(s.match(/^([a-z])_/)){t[RegExp.$1]=t[RegExp.$1]?t[RegExp.$1]:[];t[RegExp.$1][s.substr(2)]=i}if(s=="DGraph.WhyDidItMatch"){t["s"]["matchedOn"]=i;var a=typeof i=="object"?i.join():i;if(a.match(/s_/)){t["p"]["matched"]=0;t["s"]["matched"]=1}}}this.addProps(t["c"],t["p"],t["s"])}},addProps:function(e,t,s,i){var a=e.CATEGORY_ID;var r=t.PRODUCT_ID;var n=s.SKU_ID;if(!a||!r||!n)return;var o=this.skuList[n]||{};this.skuList[n]=jQuery.extend(o,s);var c=this.productList[r]||{parseOrder:++this.parseOrderHi};if(i&&c.parseOrder>0){c.parseOrder=--this.parseOrderLo}c=jQuery.extend(c,t);if(!c.skus)c.skus=[];if(!c.skuList)c.skuList={};if(!c.skuList[n])c.skus.push(o);c.skuList[n]=o;this.productList[r]=c;o.product=c;var l=this.categoryList[a]||{};l=jQuery.extend(l,e);if(!l.prods)l.prods=[];l.prods.push(c);this.categoryList[a]=l},getProducts:function(){function e(e,t){if(e.parseOrder>t.parseOrder){return 1}else if(e.parseOrder<t.parseOrder){return-1}return 0}function t(e,t){if(e.DISPLAY_ORDER>t.DISPLAY_ORDER){return 1}else if(e.DISPLAY_ORDER<t.DISPLAY_ORDER){return-1}return 0}var s=[];for(var i in this.productList){this.productList[i].skus.sort(t);s.push(this.productList[i])}s.sort(e);return s},getSkus:function(){var e=[];for(var t in this.skuList){e.push(this.skuList[t])}return e},getCategory:function(e){var t=this.categoryList?this.categoryList[e]:null;return t},getProduct:function(e){var t=this.productList?this.productList[e]:null;return t},getSku:function(e){var t=this.skuList?this.skuList[e]:null;return t}});site.endeca.catalog.product=generic.endeca.catalog.product;generic.endeca.control=site.endeca.generic.Class.create({initialize:function(e){this.configuration=e||site.endeca.configuration;this.queryString=site.endeca.generic.env.query("qs")||"";this.searchTerm=site.endeca.generic.env.query("search")||"";this.hasResults=false;this.hasSearched=0;this.wildcardSearch=false;this.customClasses={};this.results={};this.queries={};this.catalogs={};this.nodes={};if(this.configuration.mustacheMappings){this.loadMustacheMappings()}if(this.configuration.queries){this.generateQueries()}if(this.configuration.results){this.generateResults()}if(this.configuration.nodes){this.generateNodes()}if(this.configuration.coremetricsEnabled){site.endeca.coremetrics.initialize({enabled:true})}if(this.configuration.omnitureEnabled){if(site.endeca.omniture){site.endeca.omniture.initialize({enabled:true})}}if(this.hasAnalyticsIntegrated()&&!this.isTypeahead()){if(site&&site.track){site.track.disableDefaultPageView()}}},loadMustacheMappings:function(){if(this.configuration.mustacheMappings){site.endeca.generic.template.loadMustacheMappings({mappings:this.configuration.mustacheMappings})}},generateQueries:function(){for(var e in this.configuration.queries){this.queries[e]=new site.endeca.query(jQuery.extend({callbackCompleted:site.endeca.helpers.func.bind(this.searchCompleted,this)},this.configuration.query,this.configuration.queries[e]||{}))}},generateResults:function(){for(var resultsName in this.configuration.results){this.configuration.results[resultsName].childClass=this.configuration.results[resultsName].childClass||"";var mixins=this.configuration.mixins[this.configuration.results[resultsName].mixinKey]||this.configuration.mixins[this.configuration.results[resultsName].childClass.replace(/site\.endeca\./,"")]||this.configuration.mixins[this.configuration.results[resultsName].baseClass.replace(/site\.endeca\./,"")+"."+resultsName]||this.configuration.mixins[this.configuration.results[resultsName].baseClass.replace(/site\.endeca\./,"")];var baseClass=eval(this.configuration.results[resultsName].baseClass);var childClass=eval(this.configuration.results[resultsName].childClass)||baseClass[resultsName]||{};this.customClasses[resultsName]=site.endeca.generic.Class.create(site.endeca.generic.Class.mixin(baseClass,mixins),childClass);this.results[resultsName]=new this.customClasses[resultsName](jQuery.extend({},{mixins:this.configuration.mixins,configuration:this.configuration.results[resultsName].configuration||{}},this.configuration.results[resultsName].instanceArgs||{}))}},generateNodes:function(){for(var e in this.configuration.nodes){this.nodes[e]=this.configuration.nodes[e]}},search:function(e){var e=e||{searchTerm:null,queryString:null};this.hasSearched++;this.showLoading();this.resetQueries();var t=e.queryString||this.queryString||"";var s=t?site.endeca.helpers.string.toQueryParams(t)["Ntt"]:e.searchTerm||this.searchTerm||"";for(var i in this.queries){this.queries[i].searchTerm=s;this.queries[i].queryString=this.queries[i].noQueryString?"":t;this.queries[i].prepare();this.queries[i].execute();this.searchTerm=this.queries[i].searchTerm}},searchCompleted:function(e){if(this.queriesCompleted()){this.resetResults();for(var t in this.queries){this.catalogs[t]=new site.endeca.catalog[t]({jsonResult:this.queries[t].jsonResult})}this.meta=new site.endeca.meta({query:this.queries.product,jsonResult:this.queries.product.jsonResult,searchKey:this.queries.product.searchKey,configuration:{followRedirects:this.configuration.followRedirects,sorting:this.configuration.sorting,contentzones:this.configuration.contentzones}});if(this.meta.redirecting){if(this.hasAnalyticsIntegrated()&&site&&site.elcEvents){site.elcEvents.dispatch("track:searchRedirect",this)}return false}this.hideLoading();if(this.hasAnalyticsIntegrated()&&!this.wildcardSearch&&site&&site.elcEvents){var s=this;if(this.isTypeahead()){site.elcEvents.addListener("track:ready",function(){site.elcEvents.dispatch("track:searchTypeaheadLoaded",s)})}else{site.elcEvents.addListener("track:ready",function(){site.elcEvents.dispatch("track:searchPageLoaded",s)})}}return true}return false},queriesCompleted:function(){for(var e in this.queries){if(!this.queries[e].completed){return false}}return true},processCoremetrics:function(e){var e=e||{pageView:true};if(this.configuration.coremetricsEnabled){site.endeca.coremetrics.reset();site.endeca.coremetrics.pageView=e.pageView;site.endeca.coremetrics.productCount=this.meta.searchInfo.totalProductRecords;site.endeca.coremetrics.contentCount=this.meta.searchInfo.totalContentRecords;site.endeca.coremetrics.searchTerm=this.meta.searchInfo.correctedTerms&&this.meta.searchInfo.correctedTerms.length?this.meta.searchInfo.correctedTerms[0]:this.queries.product.parsedSearchTerm();site.endeca.coremetrics.wildcardSearch=this.wildcardSearch;site.endeca.coremetrics.numberOfPages=this.meta.pagination?this.meta.pagination.numberOfPages:1;site.endeca.coremetrics.currentPage=this.meta.pagination?this.meta.pagination.numberOfCurrentPage:1;if(this.meta.dimensions.breadcrumbs){for(var t=0;t<this.meta.dimensions.breadcrumbs.length;t++){for(var s=0;s<this.meta.dimensions.breadcrumbs[t]["Dimension Values"].length;s++){site.endeca.coremetrics.addRefinement({dimensionName:this.meta.dimensions.breadcrumbs[t]["Dimension Name"],refinement:this.meta.dimensions.breadcrumbs[t]["Dimension Values"][s]["Dim Value Name"]})}}}site.endeca.coremetrics.setPageView()}},processOmniture:function(){if(this.configuration.omnitureEnabled){site.endeca.omniture.reset();site.endeca.omniture.productCount=this.meta.searchInfo.totalProductRecords;site.endeca.omniture.contentCount=this.meta.searchInfo.totalContentRecords;site.endeca.omniture.searchTerm=this.meta.searchInfo.correctedTerms&&this.meta.searchInfo.correctedTerms.length?this.meta.searchInfo.correctedTerms[0]:this.queries.product.parsedSearchTerm();site.endeca.omniture.numberOfPages=this.meta.pagination?this.meta.pagination.numberOfPages:1;site.endeca.omniture.currentPage=this.meta.pagination?this.meta.pagination.numberOfCurrentPage:1;var e=this.configuration.searchType||this.queries.product.searchKey;if(e){site.endeca.omniture.searchType=e}if(e=="all"){if(this.meta.dimensions.breadcrumbs){var t=this.meta.dimensions.breadcrumbs[this.meta.dimensions.breadcrumbs.length-1];var s=t["Dimension Values"][t["Dimension Values"].length-1];site.endeca.omniture.refineSearch(s["Dim Value Name"])}else{site.endeca.omniture.searchResults()}}}},isTypeahead:function(){if(this.configuration.minSearchLength){return 1}else{return 0}},hasAnalyticsIntegrated:function(){if(Drupal&&Drupal.settings&&Drupal.settings.analytics){return Drupal.settings.analytics.analytics_integrated}else{return 0}},showLoading:function(){if(this.nodes.loading){this.nodes.loading.show()}},hideLoading:function(){if(this.nodes.loading){this.nodes.loading.hide()}},displayResults:function(){if(this.hasResults){if(this.results.bestsellers){this.results.bestsellers.hide()}if(this.results.content){this.results.content.show()}if(this.nodes.resultsContainer){this.nodes.resultsContainer.show()}if(this.nodes.noResultsContainer){this.nodes.noResultsContainer.hide()}this.processCoremetrics();this.processOmniture();this.wildcardSearch=false;return true}else{if(this.wildcardSearch){if(this.nodes.resultsContainer){this.nodes.resultsContainer.hide()}if(this.nodes.noResultsContainer){this.nodes.noResultsContainer.show()}if(this.results.content){if(this.configuration.noResultsContentZone){this.results.content.contentzones=this.configuration.noResultsContentZone;this.results.content.resultData=this.meta.supplementalContent;this.results.content.displayResults();this.results.content.show()}else{this.results.content.hide()}}if(this.results.bestsellers){this.results.bestsellers.displayResults();this.results.bestsellers.show()}this.processCoremetrics();this.processOmniture();this.wildcardSearch=false;return true}else{this.wildcardSearch=true;this.search({searchTerm:this.searchTerm+"*"});return false}}},resetQueries:function(){for(var e in this.queries){this.queries[e].reset()}},resetResults:function(){this.hasResults=false;for(var e in this.results){this.results[e].reset()}}});site.endeca.control=generic.endeca.control;generic.endeca.coremetrics={enabled:false,category_id:"search",page_id:"Search Results",productCount:0,contentCount:0,searchTerm:null,refinementsList:[],numberOfPages:1,currentPage:1,pageView:true,dimensionNameMap:{"Skin Type":"Typ","Skin Tone":"Ton"},wildcardSearch:false,initialize:function(e){jQuery.extend(this,e)},addRefinement:function(e){var e=e||{};if(e.dimensionName&&e.refinement){var t;if(this.dimensionNameMap[e.dimensionName]){t=this.dimensionNameMap[e.dimensionName]}else{var s=e.dimensionName.split(" ");t=s.shift().substr(0,3);for(var i=0;i<s.length;i++){t+=s[i].charAt(0)}}this.refinementsList.push(t+":"+e.refinement)}},setPageView:function(){if(this.pageView){var e=this.page_id+" "+this.currentPage;var t=this.category_id;var s=this.searchTerm;var i=this.contentCount+this.productCount;var a=this.refinementsList.join(" > ");if(a){e="Search Results Filtered "+this.currentPage}if(this.contentCount>0&&this.productCount==0){s="*"+s}if(typeof cmCreatePageviewTag=="function"){cmCreatePageviewTag(e,s,t,i.toString(),a)}if(this.wildcardSearch){if(typeof cmCreateConversionEventTag=="function"){cmCreateConversionEventTag("RESULTS PAGE",1,"ENDECA WILDCARD SEARCH",1)}}else{if(typeof cmCreateConversionEventTag=="function"){cmCreateConversionEventTag("RESULTS PAGE",1,"NO ENDECA WILDCARD SEARCH",1)}}}},contentClick:function(){if(typeof cmCreatePageElementTag=="function"){cmCreatePageElementTag("CONTENT","SEARCH DROPDOWN")}},productClick:function(){cmCreatePageElementTag("PRODUCTS","SEARCH DROPDOWN");if(this.wildcardSearch){if(typeof cmCreateConversionEventTag=="function"){cmCreateConversionEventTag("SEARCH DROPDOWN",1,"ENDECA WILDCARD SEARCH",1)}}else{if(typeof cmCreateConversionEventTag=="function"){cmCreateConversionEventTag("SEARCH DROPDOWN",1,"NO ENDECA WILDCARD SEARCH",1)}}},seeAllClick:function(){if(typeof cmCreatePageElementTag=="function"){cmCreatePageElementTag("SEE ALL","SEARCH DROPDOWN")}},reset:function(){this.refinementsList=[];this.pageView=true}};site.endeca.coremetrics=generic.endeca.coremetrics;site.endeca.omniture={enabled:false,page_id:"Search Results",productCount:0,contentCount:0,searchTerm:null,searchType:"Regular",refinementsList:[],numberOfPages:1,currentPage:1,initialize:function(e){jQuery.extend(this,e)},searchResults:function(){var e=this.page_id+" "+this.currentPage;var t=this.searchTerm;var s=this.searchType;var i=this.contentCount+this.productCount;if(this.contentCount>0&&this.productCount==0){t="*"+t}omnidata=[t,this.contentCount,this.productCount,e,s];if(typeof tms_page_data.tms_page_info!="undefined"){tms_page_data.tms_page_info["SEARCH"]=omnidata}else{tms_page_data["SEARCH"]=omnidata}jQuery(window).trigger("OMNISEARCH",[omnidata])},refineSearch:function(e){omnidata=[e,this.productCount];if(typeof tms_page_data.tms_page_info!="undefined"){tms_page_data.tms_page_info["FILTERSEARCH"]=omnidata}else{tms_page_data["FILTERSEARCH"]=omnidata}jQuery(window).trigger("FILTERSEARCH",[omnidata])},contentClick:function(){},productClick:function(){var e=this.page_id+" "+this.currentPage;var t=this.searchTerm;var s=this.searchType;var i=this.contentCount+this.productCount;if(this.contentCount>0&&this.productCount==0){t="*"+t}omnidata=[t,this.contentCount,this.productCount,e,s];if(typeof tms_page_data.tms_page_info!="undefined"){tms_page_data.tms_page_info["TYPEAHEAD"]=omnidata}else{tms_page_data["TYPEAHEAD"]=omnidata}jQuery(window).trigger("OMNISEARCH",[omnidata])},seeAllClick:function(){jQuery(window).trigger("SEARCHALLCLK")},reset:function(){this.refinementsList=[]}};generic.endeca.meta=site.endeca.generic.Class.create({initialize:function(e){this.jsonResult=null;this.searchKey="all";this.hasRedirects=false;this.redirecting=false;this.pagination=null;this.sorting=[];this.dimensions={};this.metaInfo={};this.searchInfo={};this.supplementalObjects=[];this.supplementalContent={};jQuery.extend(this,e);if(this.jsonResult){this.parseData()}},parseData:function(e){this.processMetaInfo();this.processSearchInfo();this.processSupplemental();this.processPagination();this.processSorting();this.processDimensions()},processMetaInfo:function(){this.metaInfo=this.jsonResult.MetaInfo||this.metaInfo;this.numberOfPages=this.getMetaProp("Number of Pages",1);this.recordsReturned=this.getMetaProp("Number of Records Returned",0);this.recordsPerPage=this.getMetaProp("Number of Records per Page",0);this.totalMatchRecords=this.getMetaProp("Total Number of Matching Records",0);this.totalAggrRecords=this.getMetaProp("Total Number of Matching Aggregate Records",0)},processSearchInfo:function(e){var e=e||{totalContentRecords:0};var t=this.jsonResult&&this.jsonResult["Search Info"]&&this.jsonResult["Search Info"][this.searchKey]?this.jsonResult["Search Info"][this.searchKey]:{};this.searchInfo.searchTerm=t["Search Term"]||"";if(this.searchInfo.searchTerm.match(/\*$/)){this.searchInfo.searchTerm=this.searchInfo.searchTerm.slice(0,-1)}this.searchInfo.totalContentRecords=e.totalContentRecords||0;this.searchInfo.totalProductRecords=this.totalAggrRecords||this.totalMatchRecords;this.searchInfo.contentResultText=this.searchInfo.totalContentRecords==1?site.endeca.generic.rb("endeca").get("content_result"):site.endeca.generic.rb("endeca").get("content_results");this.searchInfo.productResultText=this.searchInfo.totalProductRecords==1?site.endeca.generic.rb("endeca").get("product"):site.endeca.generic.rb("endeca").get("products");this.searchInfo.totalRecords=parseInt(this.searchInfo.totalContentRecords)+parseInt(this.searchInfo.totalProductRecords);this.searchInfo.resultText=this.searchInfo.totalRecords==1?site.endeca.generic.rb("endeca").get("result"):site.endeca.generic.rb("endeca").get("results");this.searchInfo.startingRecord=this.searchInfo.totalProductRecords?this.getMetaProp("Starting Record Number",1):0;this.searchInfo.endingRecord=this.getMetaProp("Ending Record Number",1);this.searchInfo.originalRecords=this.searchInfo.totalRecords;this.searchInfo.originalResultText=this.searchInfo.resultText;this.searchInfo.correctedTerms=[];if(t["Spell Correction"]){for(var s=0;s<t["Spell Correction"].length;s++){if(t["Spell Correction"][s]["New Term"].toLowerCase().indexOf(this.searchInfo.searchTerm.toLowerCase())<0&&t["Spell Correction"][s]["AutoPhrasing"]=="false"){this.searchInfo.correctedTerms.push(t["Spell Correction"][s]["New Term"])}}}if(this.searchInfo.correctedTerms.length){this.searchInfo.originalRecords=0;this.searchInfo.originalResultText=this.searchInfo.originalRecords==1?site.endeca.generic.rb("endeca").get("result"):site.endeca.generic.rb("endeca").get("results")}this.searchInfo.didYouMean=[];if(t["DYM Information"]){for(var s=0;s<t["DYM Information"].length;s++){if(t["DYM Information"][s]["New Term"].toLowerCase().indexOf(this.searchInfo.searchTerm.toLowerCase())<0&&t["DYM Information"][s]["AutoPhrasing"]=="false"){this.searchInfo.didYouMean.push({"Selection Link":t["DYM Information"][s]["Pivot Link"],Term:t["DYM Information"][s]["New Term"]})}}}},processPagination:function(){if(this.numberOfPages>1){var e=new site.endeca.query(jQuery.extend(true,{},site.endeca.configuration.query,{recordsPerPage:1e4}));this.pagination={numberOfPages:this.numberOfPages,numberOfCurrentPage:this.getMetaProp("Page Number",1),viewAllLink:this.query.getMergedQueryString(e.toQueryString()),previousPageLink:this.getMetaProp("Previous Page Link"),nextPageLink:this.getMetaProp("Next Page Link"),directPageLinks:this.getMetaProp("Direct Page Links","")}}},processSorting:function(){var e=this.getMetaProp("Add Sort Key Links",[]);var t=this.getMetaProp("Sorted By",[]);if(e.length){this.sorting=this.sorting.concat(e)}if(t.length){this.sorting=this.sorting.concat(t)}},processDimensions:function(){var e=[];var t=[];if(this.jsonResult.Breadcrumbs){for(var s=0;s<this.jsonResult.Breadcrumbs.length;s++){var i=this.jsonResult.Breadcrumbs[s];if(i&&i["Type"]=="Navigation"){for(var a=0;a<i["Dimension Values"].length;a++){i["Dimension Values"][a]["Removal Link"]=this.query.getMergedQueryString(i["Dimension Values"][a]["Removal Link"],parseInt(i["Dimension Values"][a]["Dim Value ID"]))}e.push(i)}}}if(this.jsonResult.Refinements){for(var s=0;s<this.jsonResult.Refinements.length;s++){var r=this.jsonResult.Refinements[s];if(r&&r["Dimensions"]&&r["Dimensions"][0]&&r.Dimensions[0]["Dimension Values"]){for(var a=0;a<r.Dimensions[0]["Dimension Values"].length;a++){r.Dimensions[0]["Dimension Values"][a]["Selection Link"]=this.query.getMergedQueryString(r.Dimensions[0]["Dimension Values"][a]["Selection Link"])}t.push(r["Dimensions"][0])}}}if(e.length){this.dimensions.breadcrumbs=e}if(t.length){this.dimensions.refinements=t}},processSupplemental:function(){this.supplementalObjects=this.jsonResult["Supplemental Objects"]||this.supplementalObjects;for(var e=0;e<this.supplementalObjects.length;e++){var t=this.supplementalObjects[e];if(t.Properties){if(t.Properties["DGraph.KeywordRedirectUrl"]){this.hasRedirects=true;if(this.configuration.followRedirects){this.redirecting=true;document.location.href=t.Properties["DGraph.KeywordRedirectUrl"]}return false}if(t.Properties["DGraph.SeeAlsoMerchId"]){var s=t.Properties.Zone;var i=this.supplementalContent[s]||{records:[]};i.style=t.Properties.Style;t=this.highlightSearchTermInSupplemental(t);if(!t.Properties["suppress_"+(jQuery.cookie("LOCALE")||"en_US")]){i.records.push(t)}this.supplementalContent[s]=i}}}},highlightSearchTermInSupplemental:function(e){return e},getMetaProp:function(e,t){var s=this.metaInfo[e]||t;if(!isNaN(s)){s=parseInt(s)}return s}});site.endeca.meta=generic.endeca.meta;var Drupal=Drupal||{};Drupal.settings=Drupal.settings||{};Drupal.settings.endeca=Drupal.settings.endeca||{};generic.endeca.query=site.endeca.generic.Class.create({initialize:function(e){this.configuration=e||{};this.sessionId=Math.floor(Math.random()*999999)+1;this.url="/enrpc/JSONControllerServlet.do";this.urlParams={};this.queryString=null;this.searchTerm="";this.searchKey="all";this.searchMode="matchallpartial";this.searchDimensions=true;this.computePhrasings=true;this.didYouMean=true;this.recordsPerPage=10;this.pageNumber=1;this.sortKey=null;this.rollup=true;this.rollupId="p_PRODUCT_ID";this.rollupDetail=true;this.configuredRangeFilters={};this.defaultRangeFilters=[];this.rangeFilters=[];this.additionalRangeFilters=[];this.configuredRecordFilters={};this.defaultRecordFilters=[];this.recordFilters=[];this.additionalRecordFilters=[];this.recordId=null;this.configureLocale({props:["MDEXHost","MDEXPort","logHost","logPort","defaultDimensionIds"],locale:jQuery.cookie("LOCALE")||Drupal.settings.endeca.locale||"en_US"});jQuery.extend(this,this.configuration);this.recordFilters.push("locale");this.completed=0;this.exportUrlParams=["N","Ne","Nao","Ntt","Ns","D","M"];this.setupServer()},reset:function(){this.urlParams={};this.queryString=null;this.jsonResult=null;this.completed=0},prepare:function(){this.setupServer();if(this.recordId){this.setupRecordId()}else if(this.searchTerm){this.searchTerm=jQuery.trim(this.parsedSearchTerm());if(this.computePhrasings){this.setupPhraseComputation()}if(this.didYouMean){this.setupDidYouMean()}if(this.searchDimensions){this.setupDimensionSearch()}this.setupSearch()}if(this.pageNumber){this.setupPage()}if(this.sortKey){this.setupSort()}if(this.rollup){this.setupRollUp()}this.setupNavigation();this.setupRangeFilters();this.setupRecordFilters();if(this.queryString){this.queryString=decodeURIComponent(this.queryString);this.processQueryString()}else{this.setupDimensionIds()}},execute:function(){var e=this.url+"?"+this.toQueryString();jQuery.ajax({url:e,type:"get",context:this,complete:this.onComplete})},onComplete:function(e){this.completed=1;this.rawResult=e.responseText;this.jsonResult=jQuery.parseJSON(this.rawResult);this.callbackCompleted()},toQueryString:function(e){var e=e||{};var t=e.urlParams?jQuery.param(e.urlParams):jQuery.param(this.urlParams);t=t.replace(/%2B/gi,"+");return t},processQueryString:function(){this.urlParams=jQuery.extend(true,this.urlParams,site.endeca.helpers.string.toQueryParams(this.queryString));this.searchTerm=this.urlParams["Ntt"]||"";this.setupDimensionIds();this.setupRangeFilters();this.setupRecordFilters()},getMergedQueryString:function(e,t){var s=site.endeca.helpers.string.toQueryParams(e);if(!s["Nao"]){s["Nao"]=0}var i=jQuery.extend(true,{},this.urlParams,s);var a=this._getDimensionIds({urlParams:s,oldDimensionIds:this.urlParams["Ne"]});a=site.endeca.helpers.array.remove(a,this.defaultDimensionIds);a=t?site.endeca.helpers.array.remove(a,t):a;i["Ne"]=a.join("+");return this.toQueryString({urlParams:site.endeca.helpers.obj.slice(i,this.exportUrlParams)})},setupServer:function(){this.urlParams["M"]="host:"+this.MDEXHost+"|port:"+this.MDEXPort+"|recs_per_page:"+this.recordsPerPage;this.urlParams["L"]="host:"+this.logHost+"|port:"+this.logPort},setupRecordId:function(){this.urlParams["R"]=this.recordId},setupNavigation:function(){this.urlParams["N"]=this.defaultNavigation?this.defaultNavigation.join("+"):""},setupDimensionIds:function(){var e=this._getDimensionIds({urlParams:this.urlParams});if(e.length){this.urlParams["Ne"]=e.join("+")}},setupSearch:function(e){var e=e||{};this.urlParams["Ntt"]=(e.searchTerm||this.searchTerm).toLowerCase();this.urlParams["Ntk"]=this.searchKey;this.urlParams["Ntx"]=this.searchMode.match(/mode\+/)?this.searchMode:"mode+"+this.searchMode},setupDimensionSearch:function(e){var e=e||{};this.urlParams["D"]=(e.searchTerm||this.searchTerm).toLowerCase();this.urlParams["Dx"]=this.searchMode.match(/mode\+/)?this.searchMode:"mode+"+this.searchMode},setupPhraseComputation:function(){this.urlParams["Ntpc"]=1;this.urlParams["Ntpr"]=1},setupDidYouMean:function(){this.urlParams["Nty"]=1},setupSort:function(){this.urlParams["Ns"]=this.sortKey},setupRollUp:function(){this.urlParams["Nu"]=this.rollupId;this.urlParams["Np"]=this.rollupDetail?2:1},setupPage:function(){this.urlParams["Nao"]=(this.pageNumber-1)*this.recordsPerPage},setupRangeFilters:function(){var e=this._getFilters(this.defaultRangeFilters,this.rangeFilters,this.additionalRangeFilters,this.configuredRangeFilters);if(e.length){this.urlParams["Nf"]=e.join("|")}},setupRecordFilters:function(){var e=this._getFilters(this.defaultRecordFilters,this.recordFilters,this.additionalRecordFilters,this.configuredRecordFilters);if(e.length){this.urlParams["Nr"]="AND("+e.join(",")+")"}},_getFilters:function(e,t,s,i){var a=[];jQuery.each(t,function(e,t){a.push(i[t])});jQuery.each(e,function(e,t){a.push(i[t])});jQuery.each(s,function(e,t){a.push(t)});return a},_getDimensionIds:function(e){var t=[];if(e.oldDimensionIds){t=t.concat(e.oldDimensionIds.split("+"))}if(e.addDefaultDimensionIds){t=t.concat(e.oldDimensionIds.split("+"))}t=t.concat(e.urlParams&&e.urlParams["Ne"]?e.urlParams["Ne"].split("+"):[]);t=t.concat(this.defaultDimensionIds);t=site.endeca.helpers.array.toInt(t);t=site.endeca.helpers.array.unique(t);return t},parsedSearchTerm:function(e){var e=e||{};var t=e.searchTerm||this.searchTerm;var s;try{s=decodeURIComponent(t)}catch(e){s=t}s=s.replace(/\+/g," ");return s.match(/[<>]/)==null?s:""},configureLocale:function(e){var e=e||{props:[],locale:""};for(var t=0;t<e.props.length;t++){if(typeof this.configuration[e.props[t]]=="object"&&typeof this.configuration[e.props[t]][e.locale]!="undefined"){this.configuration[e.props[t]]=this.configuration[e.props[t]][e.locale]}}}});site.endeca.query=generic.endeca.query;generic.endeca.result=site.endeca.generic.Class.create({initialize:function(e){this.parentNode=null;this.node=null;this.resultData=null;this.templatePath=null;jQuery.extend(this,e||{})},displayResult:function(t){var t=t||{};var s=t.parentNode||this.parentNode;var i=this;site.endeca.generic.template.get({path:i.templatePath,object:t.resultData||i.resultData,rb:rb?rb.endeca:null,callback:function(e){e=jQuery.trim(e);if(e){i.node=jQuery(e);if(s&&i.node){s.append(i.node)}i.displayResultCallback(t)}}})},displayResultCallback:function(e){},reset:function(){if(this.node&&this.parentNode&&this.node!=this.parentNode){this.node.remove()}else{this.parentNode.empty()}},hide:function(){this.parentNode.hide()},show:function(){this.parentNode.show()}});site.endeca.result=generic.endeca.result;generic.endeca.results=site.endeca.generic.Class.create({initialize:function(e){this.parentNode=null;this.node=null;this.headerNode=null;this.contentNode=null;this.resultData=[];this.resultNodes=[];this.resultClass=null;this.configuration={};this.mixins={};jQuery.extend(this,e)},setupNodes:function(e){var e=e||{};var t=e.parentNode||this.parentNode;var s=e.containerTemplatePath||this.containerTemplatePath;this.node=t||e.node;if(this.node){if(s){this.loadContainer({parentNode:t,containerTemplatePath:s})}this.headerNode=this.node.find(".results-header:first").length?this.node.find(".results-header:first"):null;this.contentNode=this.node.find(".results:first").length?this.node.find(".results:first"):this.node}},displayResults:function(s){var s=s||{};s.childClass=s.childClass||this.childClass;this.setupNodes(s);var e=s.resultData||this.resultData;var i=this;jQuery.each(e,function(e,t){i.createResult(jQuery.extend(s,{result:t,index:e}))})},loadContainer:function(t){var t=t||{};var e=t.containerTemplatePath||this.containerTemplatePath;var s=this;site.endeca.generic.template.get({path:e,object:t.resultData||s.resultData,rb:rb?rb.endeca:null,callback:function(e){e=jQuery.trim(e);if(e){s.node=jQuery(e);if(t.parentNode&&s.node){t.parentNode.append(s.node)}}}})},createResult:function(e){var e=e||{};this.setResultClass(e);var t=new this.resultClass({parent:this,templatePath:e.templatePath||this.templatePath,resultData:e.result,parentNode:e.contentNode||this.contentNode,configuration:e.configuration||this.configuration,mixins:e.mixins||this.mixins});this.resultNodes.push(t)},setResultClass:function(e){var e=e||{};var t=e.baseClass||this.baseClass||site.endeca.result;if(!this.resultClass){e.childClass=e.childClass||this.childClass||"";var s=e.mixins||this.mixins[this.resultMixinKey]||this.mixins["result."+e.childClass]||this.mixins["result"]||{};this.resultClass=e.childClass&&t[e.childClass]?site.endeca.generic.Class.create(site.endeca.generic.Class.mixin(t,s),t[e.childClass]):site.endeca.generic.Class.mixin(t,s)}},displayResultNodes:function(){for(var e=0;e<this.resultNodes.length;e++){this.resultNodes[e].displayResult()}if(this.resultNodes.length){if(this.resultNodes[0].node){this.resultNodes[0].node.addClass("first")}if(this.resultNodes[this.resultNodes.length-1].node){this.resultNodes[this.resultNodes.length-1].node.addClass("last")}}},hide:function(){this.parentNode.hide()},show:function(){this.parentNode.show()},reset:function(){if(this.containerTemplatePath){if(this.node){this.node.remove()}}else{if(this.contentNode){this.contentNode.empty()}else if(this.node){this.node.empty()}}this.resultData=[];this.resultNodes=[]}});site.endeca.results=generic.endeca.results;generic.endeca.resultsgroup=site.endeca.generic.Class.create(site.endeca.results,{initialize:function(e){this.baseClass=site.endeca.results;this._super(e)},displayResults:function(e){var e=e||{};var t=this;if(t.parentNode&&t.parentNode.length>1){t.parentNode.each(function(){e.parentNode=jQuery(this);t._super(e)})}else{t._super(e)}},createResult:function(e){var e=e||{};e.childClass=this.resultsChildClass||e.childClass;e.mixins=e.mixins||this.mixins[this.resultsMixinKey]||this.mixins["results."+e.childClass]||this.mixins["results"];this.setResultClass(e);var t=new this.resultClass(jQuery.extend({parent:this,resultData:e.result,parentNode:this.contentNode||this.node||this.parentNode,summaryResultData:this.summaryResultData,mixins:this.mixins,configuration:e.configuration||this.configuration},e.resultsArgs||this.resultsArgs||{}));this.resultNodes.push(t)},reset:function(){for(var e=0;e<this.resultNodes.length;e++){this.resultNodes[e].reset()}this._super()}});site.endeca.resultsgroup=generic.endeca.resultsgroup;generic.endeca.mixins.accordion={initialize:function(e){this._super(e);this.accordionHeaderNode=[];this.accordionContentNode=[];this.accordionCloseNode=[]},displayResults:function(e){this._super(e);this.setupAccordion()},setupAccordion:function(){this.accordionHeaderNode=this.node.find(".accordion-header:first");this.accordionContentNode=this.node.find(".accordion-content:first");this.accordionCloseNode=this.node.find(".accordion-close:first");if(this.accordionHeaderNode.length&&this.accordionContentNode.length){var e=this;this.accordionHeaderNode.unbind("click");this.accordionHeaderNode.bind("click",{that:e},e.onClick);if(this.accordionCloseNode.length){this.accordionCloseNode.unbind("click");this.accordionCloseNode.bind("click",{that:e},e.closeAccordion)}}},onClick:function(e){e.preventDefault();var t=e.data.that;t.toggleAccordion();return false},accordionIsOpen:function(){return!this.accordionHeaderNode.hasClass("collapsed")},accordionIsClosed:function(){return this.accordionHeaderNode.hasClass("collapsed")},toggleAccordion:function(){if(!this.accordionHeaderNode.hasClass("collapsed")){this.closeAccordion()}else{this.openAccordion()}},openAccordion:function(e){var t=e&&e.data&&e.data.that?e.data.that:this;if(this.accordionHeaderNode.length&&this.accordionContentNode.length&&this.accordionIsClosed()){this.accordionHeaderNode.removeClass("collapsed");this.accordionContentNode.addClass("opened");this.accordionContentNode.show();this.accordionContentNode.trigger("accordion:open",t)}},closeAccordion:function(e){var t=e&&e.data&&e.data.that?e.data.that:this;if(t.accordionHeaderNode.length&&t.accordionContentNode.length&&t.accordionIsOpen()){t.accordionHeaderNode.addClass("collapsed");t.accordionContentNode.removeClass("opened");t.accordionContentNode.hide();t.accordionContentNode.trigger("accordion:closed",t)}}};site.endeca.mixins.accordion=generic.endeca.mixins.accordion;generic.endeca.mixins.delayedClick={onClick:function(e){var t=e.data.that;var s=this._super;t.delayedClickNode=t.delayedClickNode&&t.delayedClickNode.length?t.delayedClickNode:t.node&&t.node.find(".delayed-click:first").length?t.node.find(".delayed-click:first"):t.parentNode&&t.parentNode.find(".delayed-click:first").length?t.parentNode.find(".delayed-click:first"):t.parent&&t.parent.node&&t.parent.node.find(".delayed-click:first").length?t.parent.node.find(".delayed-click:first"):[];if(t.delayedClickNode.length){e.preventDefault();t.delayedClickNode.unbind("click.delayed");if(!t.isDelayed()){t.addDelay(s,e.data)}else{t.removeDelay()}return false}else{return s(e)}},addDelay:function(e,t){var s=this;s.delayedClickNode.bind("click.delayed",t,e);s.node.siblings(".delayed").removeClass("delayed");s.node.addClass("delayed");s.node.trigger("delay.added",s)},removeDelay:function(){var e=this;e.node.removeClass("delayed");e.node.trigger("delay.removed",e)},isDelayed:function(){return this.node.hasClass("delayed")}};site.endeca.mixins.delayedClick=generic.endeca.mixins.delayedClick;generic.endeca.mixins.links={displayResultCallback:function(e){var e=e||{};e.resultData=e.resultData||this.resultData;var t=e.node||e.parentNode||this.node||this.parentNode;t=t.find(".link-mixin").length?t.find(".link-mixin"):t.find("a").length?t.find("a"):t;var s=e["Selection Link"]||e.resultData["Selection Link"]||e.resultData["Removal Link"]||t.attr("rel");if(s&&t){var i=this;t.bind("click",{that:i,link:s},i.onClick);t.bind("simulate:click",{that:i,link:s},i.onClick);if(t.href){var a=site.endeca.generic.env.parsedQuery();a["qs"]=encodeURIComponent(s);var r=document.location.pathname+"?"+jQuery.param(a);t.href=r}}}};site.endeca.mixins.links=generic.endeca.mixins.links;generic.endeca.mixins.links.address=jQuery.extend({onClick:function(e){var t=e.data.that;jQuery.address.value("?"+e.data.link);if(t.configuration.scrollTo&&t.configuration.scrollTo.length){jQuery(window).scrollTop(t.configuration.scrollTo.position().top)}else if(!(t.noScroll||t.configuration.noScroll)){scroll(0,0)}e.preventDefault();return false}},site.endeca.mixins.links);site.endeca.mixins.links.address=generic.endeca.mixins.links.address;generic.endeca.mixins.links.event=jQuery.extend({onClick:function(e){var t=e.data.that;jQuery(document).trigger("link:clicked",e.data.link);e.preventDefault();return false}},site.endeca.mixins.links);site.endeca.mixins.links.event=generic.endeca.mixins.links.event;generic.endeca.mixins.noReset={displayResults:function(e){if(this.resultNodes.length==0){this._super(e)}},reset:function(){}};site.endeca.mixins.noReset=generic.endeca.mixins.noReset;generic.endeca.mixins.nodeCache={initialize:function(e){this._super(e);this.cachedNode=[];this.previouslyCachedNode=[];this.nodeCacheUseParent=this.nodeCacheUseParent||0;this.nodeCacheNode=this.nodeCacheNode&&this.nodeCacheNode.length?this.nodeCacheNode:[];this.nodeCacheRestoreNode=this.nodeCacheRestoreNode&&this.nodeCacheRestoreNode.length?this.nodeCacheRestoreNode:[];if(!this.nodeCacheNode.length){if(this.parent&&this.parent.nodeCacheNode&&this.parent.nodeCacheNode.length){this.nodeCacheNode=this.parent.nodeCacheNode;this.nodeCacheUseParent=1}}if(!this.nodeCacheRestoreNode.length){if(this.parent&&this.parent.nodeCacheRestoreNode&&this.parent.nodeCacheRestoreNode.length){this.nodeCacheRestoreNode=this.parent.nodeCacheRestoreNode;this.nodeCacheUseParent=1}}this.nodeCacheKey=this.nodeCacheUseParent?this.parent.resultData[this.configuration.nodeCacheKey]:this.resultData[this.configuration.nodeCacheKey]},displayResult:function(e){if(this.isCached()&&!this.nodeCacheRestoreNode.length){this.clearCache()}this._super(e)},onClick:function(e){e.preventDefault();var t=e.data.that||e.data;var s=this._super||function(){};if(t.nodeCacheNode.length){if(t.isCached()){t.loadFromCache();return}else if(t.node.hasClass("recache")&&t.previouslyCachedNode.length){t.recache({data:t});return}else if(t.node.hasClass("recache")&&t.isRestored()){t.recache({data:t});return}else{t.saveToCache()}}return s(e)},isCached:function(){this.cachedNode=this.nodeCacheNode.find("[nodeCacheKey='"+this.nodeCacheKey+"']");return this.cachedNode.length?1:0},isRestored:function(){this.previouslyCachedNode=this.nodeCacheRestoreNode.find("[nodeCacheKey='"+this.nodeCacheKey+"']");return this.previouslyCachedNode.length?1:0},saveToCache:function(){var e=this;this.node.trigger("savedToCache.before",e);var t=this.nodeCacheUseParent?this.parent.node:this.node;if(this.nodeCacheUseParent){this.parent.reset=function(){}}t.attr("nodeCacheKey",this.nodeCacheKey);this.clearCache();this.nodeCacheNode.append(t);this.node.trigger("savedToCache.after",e)},loadFromCache:function(){var e=this;this.node.trigger("loadedFromCache.before",e);var t=this.nodeCacheRestoreNode&&this.nodeCacheRestoreNode.length?this.nodeCacheRestoreNode:this.nodeCacheUseParent?this.parent.parentNode:this.parentNode;var s=this.cachedNode.find(".recache:first");s.unbind("click");s.bind("click",this,this.recache);t.append(this.cachedNode);this.previouslyCachedNode=this.cachedNode;this.node.trigger("loadedFromCache.after",e)},recache:function(e){var t=e.data;if(t.previouslyCachedNode.length==0){return}t.previouslyCachedNode.trigger("recached.before",t);t.nodeCacheNode.append(t.previouslyCachedNode);t.previouslyCachedNode.trigger("recached.after",t)},clearCache:function(){this.cachedNode.remove()}};site.endeca.mixins.nodeCache=generic.endeca.mixins.nodeCache;var site=site||{};var generic=generic||{};generic.endeca.mixins.selectbox={setupNodes:function(e){this._super(e);var t=this;var s;if(this.node.is("select")){s=this.node}else if(this.node.find("select").length){s=this.node.find("select")}else if(this.parentNode.find("select").length){s=this.parentNode.find("select")}if(s){s.bind("change",t,t.onChange)}},onChange:function(e){var t=e.data;var s=this.options[this.selectedIndex];jQuery(s).trigger("simulate:click");e.preventDefault();return false}};site.endeca.mixins.selectbox=generic.endeca.mixins.selectbox;generic.endeca.mixins.summary={initialize:function(e){this._super(e);this.summaryResultData={totalRecords:this.resultData.length};this.summaryResultData.resultText=this.summaryResultData.totalRecords==1?site.endeca.generic.rb("endeca").get("result"):site.endeca.generic.rb("endeca").get("results")},setupNodes:function(e){var e=e||{};this._super(e);if(this.node){this.summaryNode=this.node.find(".results-summary").length?this.node.find(".results-summary"):null}},displayResults:function(e){this._super(e);this.setupSummary()},setupSummary:function(){if(this.summaryNode&&this.configuration.summaryTemplatePath&&this.summaryResultData){this.summary=new site.endeca.result({parentNode:this.summaryNode,templatePath:this.configuration.summaryTemplatePath,resultData:this.summaryResultData});this.summary.displayResult()}},reset:function(e){this._super(e);if(this.summaryNode){this.summaryNode.empty()}}};site.endeca.mixins.summary=generic.endeca.mixins.summary;generic.endeca.result.contentDrupal={displayResult:function(e){var e=e||{};var t=e.resultData||this.resultData;var s=e.parentNode||this.parentNode;if(t.drupal_node_id){jQuery.ajax({url:"/"+Drupal.settings.pathPrefix+"elc_api/endeca_content_result/"+t.drupal_node_id,context:this,complete:function(e){var t=e.responseText;t=jQuery.trim(t);if(t){this.node=jQuery(t);if(s&&this.node){s.append(this.node)}this.displayResultCallback(e)}}})}}};site.endeca.result.contentDrupal=generic.endeca.result.contentDrupal;generic.endeca.result.product={initialize:function(e){this.shadeResults=null;this._super(e)},displayResult:function(e){this.setupReviewData();this.setupBrandData();this._super(e)},displayResultCallback:function(e){this.setupQuickShop();this.setupAddToBag(this.resultData.skus[0]);if(this.resultData.shaded){this.setupShades()}if(this.resultData.sized){this.setupSizeSelect()}if(typeof this.displayResultCallbackBrand=="function"){this.displayResultCallbackBrand()}},setupReviewData:function(){this.resultData.ratingDisplay=this.resultData.TOTAL_REVIEW_COUNT?"block":"none";this.resultData.ratingReviewWord=this.resultData.TOTAL_REVIEW_COUNT&&this.resultData.TOTAL_REVIEW_COUNT>1?site.endeca.generic.rb("language").get("reviews"):site.endeca.generic.rb("language").get("review");this.resultData.ratingRounded=this.resultData.TOTAL_REVIEW_COUNT?Math.round(this.resultData.AVERAGE_RATING*10)/10:0},setupBrandData:function(){this.resultData.formattedPriceRange=this.formatPriceRange();this.resultData.formattedCartridgePrice=typeof this.resultData.GIFTSET_COMPONENTS!="undefined"?this.resultData.skus[0].formattedCartridgePrice:"";this.resultData.price2=this.resultData.skus[0].formattedPrice2;this.resultData.shadedClass=this.resultData.shaded?"shaded":"nonshaded";this.resultData.sizedClass=this.resultData.sized?"sized":"notsized";this.resultData.isComingSoon=eval(jQuery.map(this.resultData.skus,function(e){return e.isComingSoon}).join("+"))>0?"coming_soon":"";if(this.resultData.DESCRIPTION){this.resultData.descriptionBlurb=this.resultData.DESCRIPTION.substring(0,this.configuration.descriptionBlurb||120);this.resultData.descriptionRest=this.resultData.DESCRIPTION.substring(this.configuration.descriptionBlurb||120);this.resultData.descriptionFull=this.resultData.descriptionBlurb+this.resultData.descriptionRest}this.resultData.skinTypeText=typeof productPage!="undefined"&&typeof productPage.getAllSkinTypes=="function"?productPage.getAllSkinTypes(this.resultData):"";if(typeof this.resultData.ATTRIBUTE_BENEFIT!="undefined"){this.resultData.attrBenefit=this.resultData.ATTRIBUTE_BENEFIT.toString().replace(/,/g,", ")}},formatPriceRange:function(){var e=this.resultData.skus[0];var t=this.resultData.skus[0];for(var s=0;s<this.resultData.skus.length;s++){var i=this.resultData.skus[s];e=i.PRICE<e.PRICE?i:e;t=i.PRICE>t.PRICE?i:t}return e!==t?e.formattedPrice+" - "+t.formattedPrice:this.resultData.skus[0].formattedPrice},setupQuickShop:function(){var e=this.node.find("a.quickshop-link");if(e&&typeof brx!="undefined"){var i=this;e.bind("click",function(e){e.preventDefault();if(jQuery.isFunction(productPage.launchQuickshop)){var t=jQuery(this).attr("id").replace("quickview-link-","");productPage.launchQuickshop(t)}else{var s=brx.productView.quickshop({productData:i.resultData})}});e.bind("mouseover",function(e){jQuery(this).find(".quickshop-btn").addClass("qs-active");jQuery(this).closest(".result").addClass("qs")});e.bind("mouseout",function(e){jQuery(this).find(".quickshop-btn").removeClass("qs-active");jQuery(this).closest(".result").removeClass("qs")})}},setupAddToBag:function(e){var t=typeof e==="number"?e:e.SKU_BASE_ID;var s=this.node.find("a.btn-add-to-bag");var i=this.node.find("span.add-progress");s.unbind();s.attr("data-skubaseid",t);s.bind("click",function(e){e.preventDefault();if(i.length){s.hide();i.show();$(document).one("addToCart.success addToCart.failure",function(){i.hide();s.show()})}site.addToCart({skuBaseId:$(this).attr("data-skubaseid")})})},setupNote:function(){},setupGiftSetComponents:function(){},setupShades:function(){var e=this.node.find(".shades");var s=this.node.find(".selected-shade-name");var i=this.node.find(".shade-price");if(e.length){var t;if(typeof this.configuration.maxmimumShades!="undefined"&&this.resultData.skus.length>this.configuration.maxmimumShades){t=this.resultData.skus.slice(0,this.configuration.maxmimumShades)}else{t=this.resultData.skus.slice(0)}e.addClass("shades_"+this.resultData.skus.length);for(var a=0;a<t.length;a++){t[a].PRODUCT_ID=this.resultData.PRODUCT_ID;t[a].url=this.resultData.url}this.shadeResults=new site.endeca.results({resultData:t,parentNode:e,childClass:"shade",configuration:this.configuration,mixins:this.mixins});this.shadeResults.displayResults();this.shadeResults.show();var r=this;this.node.bind("select.sku",function(e,t){r.setupAddToBag(t.resultData.SKU_BASE_ID);if(s.length){s.text(t.resultData.SHADENAME)}if(i.length){i.text(t.resultData.formattedPrice)}});this.shadeResults.resultNodes[0].selectShade()}},setupSizeSelect:function(){var e=this.node.find(".size-select");var s=this.node.find(".size-price");if(e.length){this.sizeResults=new site.endeca.results({resultData:this.resultData.skus,parentNode:e,childClass:"size",configuration:this.configuration,mixins:this.mixins});this.sizeResults.displayResults();this.sizeResults.show();var i=this;this.node.bind("select.sku",function(e,t){i.setupAddToBag(t.resultData.SKU_BASE_ID);if(s.length){s.text(t.resultData.formattedPrice)}})}}};site.endeca.result.product=generic.endeca.result.product;generic.endeca.result.refinementAdditive={onClick:function(e){var t=e.data.that;var s=t.resultData["Selection Link"];var i=site.endeca.helpers.string.toQueryParams(s)["N"];var a=i?i.split("+"):[];var r=site.endeca.helpers.string.toQueryParams(site.endeca.state||"")["N"];var n=r?r.split("+"):[];for(var o=0;o<n.length;o++){if(t.parent.refinementIDs[n[o]]){n.splice(o,1)}}n=n.concat(a);n=site.endeca.helpers.array.unique(n);e.data.link=s.replace(/N=[0-9+]*&/,"N="+n.join("+")+"&");this._super(e)}};site.endeca.result.refinementAdditive=generic.endeca.result.refinementAdditive;generic.endeca.result.shade={initialize:function(e){this._super(e);this.templatePath=this.configuration.shadeTemplatePath||"/templates/endeca/products/shade.tmpl";this.displayResult()},displayResultCallback:function(e){this.drawSwatch();if(!this.configuration.suppressShadeEvents){this.initListeners()}},drawSwatch:function(e){if(!this.resultData.HEX_VALUE_STRING||this.resultData.HEX_VALUE_STRING.length<1){return}var t=this.node.find(".search-swatch-container");var s=this.resultData.HEX_VALUE_STRING.split(",");for(var i=0;i<s.length;i++){var a=jQuery("<div/>");a.css({"background-color":s[i]});if(i==0){a.addClass("first")}if(i==s.length-1){a.addClass("last")}if(s.length==1){a.addClass("single")}t.append(a)}t.css("width","auto")},initListeners:function(e){var t=this;this.node.bind("click",t,function(e){var t=e.data;t.selectShade()})},selectShade:function(e){this.node.siblings(".shade").removeClass("active");this.node.addClass("active");this.node.trigger("select.sku",this)}};site.endeca.result.shade=generic.endeca.result.shade;site.endeca.result.size={initialize:function(e){this._super(e);this.templatePath="/templates/endeca/products/size.tmpl";this.displayResult()},displayResultCallback:function(e){this.initListeners()},initListeners:function(e){var t=this;this.node.bind("click",t,function(e){var t=e.data;this.node.trigger("select.sku",t)})}};generic.endeca.result.summary={displayResult:function(e){var e=e||{};var t=jQuery.extend({results:"/templates/endeca/summary/results.tmpl",noResults:"/templates/endeca/summary/no-results.tmpl",noTerm:"/templates/endeca/summary/no-term.tmpl",autoCorrect:"/templates/endeca/summary/auto-correct.tmpl",didYouMean:"/templates/endeca/summary/did-you-mean.tmpl"},this.configuration.templatePaths||{});if(this.resultData.searchTerm==""){this.templatePath=t["noTerm"]}else if(this.hasResults){this.templatePath=t["results"];this.resultData.productAnchorLinkDisplay=this.resultData.totalProductRecords>0?"inline":"none";this.resultData.contentAnchorLinkDisplay=this.resultData.totalContentRecords>0?"inline":"none";this.resultData.productResultText+=this.resultData.totalContentRecords>0?",":""}else{this.templatePath=t["noResults"]}this._super(e);var s=this.node.find(".searchTerms");if(this.resultData.breadcrumbs&&s.length){var i=[];for(var a=0;a<this.resultData.breadcrumbs.length;a++){for(var r=0;r<this.resultData.breadcrumbs[a]["Dimension Values"].length;r++){i.push(', "'+this.resultData.breadcrumbs[a]["Dimension Values"][r]["Dim Value Name"]+'"')}}s.append(i.join(""))}var n=this.node.find("#auto-correct");if(this.resultData.correctedTerms&&this.resultData.correctedTerms.length&&n.length){this.templatePath=t["autoCorrect"];e.resultData=this.resultData;e.resultData.correctedTerm=this.resultData.correctedTerms.join(",");e.parentNode=n;this._super(e)}var o=this.node.find("#did-you-mean");if(this.resultData.didYouMean&&this.resultData.didYouMean.length&&o.length){this.templatePath=t["didYouMean"];e.resultData=this.resultData.didYouMean[0];e.parentNode=o;this._super(e)}},reset:function(){this.parentNode.empty()}};site.endeca.result.summary=generic.endeca.result.summary;generic.endeca.results.breadcrumbs={initialize:function(e){this.childClass="breadcrumb";this._super(e);if(typeof this.resultData.length=="undefined"&&this.resultData||this.resultData.length){this.displayResults()}},displayResults:function(){this.resultData["Dimension Name RB Key"]=this.resultData["Dimension Name"].replace(/\W+/gi,"_").toLowerCase();this.resultData["Dimension Name RB"]=site.endeca.generic.rb("endeca").get("dimension_"+this.resultData["Dimension Name RB Key"]);this.resultData["Dimension Description RB"]=site.endeca.generic.rb("endeca").get("dimension_"+this.resultData["Dimension Name RB Key"]+".description");var t=this;var e=jQuery.map(this.resultData["Dimension Values"],function(e){return jQuery.extend(e,{"Dimension Name":t.resultData["Dimension Name"],"Dimension Name RB Key":t.resultData["Dimension Name RB Key"],"Dimension Name RB":t.resultData["Dimension Name RB"],"Dimension Description RB":t.resultData["Dimension Description RB"]})});this._super({resultData:this.resultData["Dimension Values"]});this.displayResultNodes()},createResult:function(e){e.templatePath=this.childTemplatePath||this.templatePath||"/templates/endeca/breadcrumbs/link.tmpl";if(this.configuration.breadcrumbTemplates&&this.configuration.breadcrumbTemplates[this.resultData["Dimension Name RB Key"]]){e.templatePath=this.configuration.breadcrumbTemplates[this.resultData["Dimension Name RB Key"]]}e.result["Dim Value Name RB Key"]=e.result["Dim Value Name"].replace(/\W+/gi,"_").toLowerCase();e.result["Dim Value Name RB"]=site.endeca.generic.rb("endeca").get("refinement_"+e.result["Dim Value Name RB Key"]);this._super(e)}};site.endeca.results.breadcrumbs=generic.endeca.results.breadcrumbs;generic.endeca.results.bestsellers={initialize:function(e){this.childClass="product";this._super(e)},displayResults:function(){var t=this;this.query=new site.endeca.query(jQuery.extend({callbackCompleted:function(){var e=new site.endeca.catalog.product({jsonResult:t.query.jsonResult});t.resultData=e.getProducts();t._super();t.displayResultNodes();if(typeof t.configuration.queryCallback=="function"){t.configuration.queryCallback()}}},site.endeca.configuration.query,this.configuration.queryArgs||{}));this.query.prepare();this.query.execute()},createResult:function(e){e.result.context="bestseller-product";e.templatePath=this.childTemplatePath||this.templatePath||"/templates/endeca/products/bestseller-result.tmpl";this._super(e)}};site.endeca.results.bestsellers=generic.endeca.results.bestsellers;generic.endeca.results.contentzone=site.endeca.generic.Class.create(site.endeca.results,{displayResults:function(e){var e=e||{};this.zoneName=this.resultData[0].Properties.Zone;this.styleName=this.resultData[0].Properties.Style;this.styleConfig=this.configuration.styles&&this.configuration.styles[this.styleName]?this.configuration.styles[this.styleName]:undefined;e.containerTemplatePath=this.configuration.containerTemplatePath;if(typeof this.configuration.containerTemplatePath=="object"){e.containerTemplatePath=this.configuration.containerTemplatePath[this.styleName]}else if(this.styleConfig&&this.styleConfig.containerTemplatePath){e.containerTemplatePath=this.styleConfig.containerTemplatePath}this._super(e)},createResult:function(e){var e=e||{};var t=e.result.Properties&&e.result.Properties.Style?e.result.Properties.Style:this.styleName;e.templatePath=this.configuration.templatePath;if(typeof this.configuration.templatePath=="object"){e.templatePath=this.configuration.templatePath[t]}else if(this.styleConfig&&this.styleConfig.templatePath){e.templatePath=this.styleConfig.templatePath}this._super(e)}});site.endeca.results.contentzone=generic.endeca.results.contentzone;generic.endeca.results.contentzone.content={initialize:function(e){this._super(e);if(this.resultData.length){this.displayResults()}},displayResults:function(e){this._super(e);this.displayResultNodes()},createResult:function(e){e.result=e.result.Properties;if(e.result.Style.match(/drupal/i)){e.childClass="contentDrupal"}this._super(e)}};site.endeca.results.contentzone.content=generic.endeca.results.contentzone.content;generic.endeca.results.contentzone.products={initialize:function(e){this.childClass="product";this._super(e);this.query=null;this.totalProductResults=0;var t=[];for(var s=0;s<this.resultData.length;s++){for(var i=0;i<this.resultData[s]["Records"].length;i++){t.push(this.resultData[s]["Records"][i]["Record Spec"]);this.totalProductResults++}}this.query=new site.endeca.query(jQuery.extend({callbackCompleted:site.endeca.helpers.func.bind(this.searchCompleted,this),searchMode:"matchany",searchTerm:t.join(" "),searchKey:"rec_id"},site.endeca.configuration.query,this.configuration.queryArgs||{}));this.query.prepare();this.query.execute()},searchCompleted:function(){var e=new site.endeca.catalog.product({jsonResult:this.query.jsonResult});this.displayResults({resultData:e.getProducts()});this.displayResultNodes()},createResult:function(e){e.result.context="featured-product";e.result.callout=site.endeca.generic.rb("endeca").get("callout.featured-product");this._super(e)}};site.endeca.results.contentzone.products=generic.endeca.results.contentzone.products;generic.endeca.results.pagination={initialize:function(e){this._super(e);this.displayResults()},displayResults:function(){if(this.resultData){this.setupNodes();if(this.resultData.viewAllLink&&this.configuration.viewAllLink){this.createResult({templatePath:this.configuration.viewAllPageTemplatePath||"/templates/endeca/pagination/viewall.tmpl",result:{"Selection Link":this.resultData.viewAllLink}})}if(this.resultData.previousPageLink&&this.configuration.previousPageLink){this.createResult({templatePath:this.configuration.previousPageTemplatePath||"/templates/endeca/pagination/previous.tmpl",result:{"Selection Link":this.resultData.previousPageLink}})}var e=this.contentNode;if(this.configuration.containerTemplatePath){this.containerTemplatePath=this.configuration.containerTemplatePath;this.setupNodes()}if(this.resultData.directPageLinks){for(var t=0;t<this.resultData.directPageLinks.length;t++){this.createResult({templatePath:this.resultData.numberOfCurrentPage==t+1?this.configuration.currentTemplatePath||"/templates/endeca/pagination/current.tmpl":this.configuration.linkTemplatePath||"/templates/endeca/pagination/link.tmpl",result:{"Selection Link":this.resultData.directPageLinks[t],Content:t+1}})}}this.contentNode=e;if(this.resultData.nextPageLink&&this.configuration.nextPageLink){this.createResult({templatePath:this.configuration.nextPageTemplatePath||"/templates/endeca/pagination/next.tmpl",result:{"Selection Link":this.resultData.nextPageLink}})}this.displayResultNodes()}},setupSummary:function(){return;if(this.paginationSummaryNode){if(this.summaryResultData&&this.summaryResultData.totalProductRecords>1){var e="endeca.templates.pagination.summary.shown";if(this.resultData&&this.resultData.numberOfCurrentPage==1){e="endeca.templates.pagination.summary.topShown"}this.createResult({templatePath:e,result:this.summaryResultData,contentNode:this.paginationSummaryNode})}if(this.resultData&&this.resultData.nextPageLink){this.createResult({templatePath:"endeca.templates.pagination.summary.next",result:{"Selection Link":this.resultData.nextPageLink},contentNode:this.paginationSummaryNode})}if(this.summaryResultData){var t=null;var s=null;if(this.summaryResultData.startingRecord==1&&this.summaryResultData.endingRecord>10){t="endeca.templates.pagination.summary.viewLess";s={}}else if(this.summaryResultData.totalProductRecords>10){t="endeca.templates.pagination.summary.viewAll";s={recordsPerPage:1e4}}if(t){var i=new site.endeca.base.query(s);this.createResult({templatePath:t,result:{"Selection Link":i.toQueryString()},contentNode:this.paginationSummaryNode})}}}}};site.endeca.results.pagination=generic.endeca.results.pagination;generic.endeca.results.products={initialize:function(e){this.childClass="product";this._super(e)},displayResults:function(e){var e=e||{};this._super(e);this.displayResultNodes()},createResult:function(e){e.templatePath=this.childTemplatePath||"/templates/endeca/products/result.tmpl";e.result.context="product";this._super(e)}};site.endeca.results.products=generic.endeca.results.products;generic.endeca.results.recentsearches={initialize:function(e){this.searchTerm=null;this._super(e)},displayResults:function(e){this.setupRecentSearches();this._super({templatePath:"/templates/endeca/recent-search.tmpl"});this.displayResultNodes()},setupRecentSearches:function(){var e=encodeURIComponent(this.searchTerm);var t=jQuery.cookie("researches");var s=t?String(t).split(":::"):[];if(this.searchTerm){s.unshift(e)}s=site.endeca.helpers.array.unique(s).splice(0,this.configuration.maximumRecentSearches);if(s&&s.length){jQuery.cookie("researches",s.join(":::"));for(var i=0;i<s.length;i++){this.resultData.push({searchTerm:decodeURIComponent(s[i]).replace(/\+/," "),"Selection Link":"Ntt="+s[i],"Display Link":"?search="+s[i]})}}}};site.endeca.results.recentsearches=generic.endeca.results.recentsearches;generic.endeca.results.refinements={initialize:function(e){this.containerTemplatePath="/templates/endeca/refinements/container.tmpl";this.childClass="refinement";this.moreRefinement=null;this.refinementIDs={};this._super(e);this.resultData["Dimension Name RB Key"]=this.resultData["Dimension Name"].replace(/\W+/gi,"_").toLowerCase();this.resultData["Dimension Name RB"]=site.endeca.generic.rb("endeca").get("dimension_"+this.resultData["Dimension Name RB Key"]);this.resultData["Dimension Description RB"]=site.endeca.generic.rb("endeca").get("dimension_"+this.resultData["Dimension Name RB Key"]+"_description");if(this.configuration.refinementContainerTemplates&&this.configuration.refinementContainerTemplates[this.resultData["Dimension Name RB Key"]]){this.containerTemplatePath=this.configuration.refinementContainerTemplates[this.resultData["Dimension Name RB Key"]]}this.displayResults({resultData:this.resultData["Dimension Values"]});this.displayResultNodes()},createResult:function(e){e.templatePath=this.childTemplatePath||this.templatePath||"/templates/endeca/refinements/link.tmpl";if(this.configuration.refinementTemplates&&this.configuration.refinementTemplates[this.resultData["Dimension Name RB Key"]]){e.templatePath=this.configuration.refinementTemplates[this.resultData["Dimension Name RB Key"]]}if(this.configuration.resultMixinKeys&&this.configuration.resultMixinKeys[this.resultData["Dimension Name RB Key"]]){e.mixins=this.mixins[this.configuration.resultMixinKeys[this.resultData["Dimension Name RB Key"]]]}if(this.resultData["Dim Value Properties"]&&this.resultData["Dim Value Properties"]["DGraph.More"]&&e.result["Dim Value Name"]=="More..."){e.templatePath="/templates/endeca/refinements/show-all.tmpl";this.moreRefinement=e.result["Dim Value ID"]}else{this.refinementIDs[e.result["Dim Value ID"]]=1;e.result["Dim Value Name RB Key"]=e.result["Dim Value Name"].replace(/\W+/gi,"_").toLowerCase();e.result["Dim Value Name RB"]=site.endeca.generic.rb("endeca").get("refinement_"+e.result["Dim Value Name RB Key"]);e.result["Dim Value Description RB"]=site.endeca.generic.rb("endeca").get("refinement_description_"+e.result["Dim Value Name RB Key"])}this._super(e)},reset:function(e){this.refinementIDs={};this._super(e)}};site.endeca.results.refinements=generic.endeca.results.refinements;generic.endeca.results.sorting={initialize:function(e){this._super(e);this.displayResults()},displayResults:function(e){this._super(e);this.displayResultNodes()},createResult:function(e){var e=e||{};if(e.result["Sort Order"]){e.templatePath=this.configuration.currentTemplatePath||"/templates/endeca/sort/current.tmpl"}else{e.templatePath=this.configuration.linkTemplatePath||"/templates/endeca/sort/link.tmpl"}e.result["Sort Key RB"]=e.result["Sort Key"]?site.endeca.generic.rb("endeca").get("sorting_"+e.result["Sort Key"].toLowerCase()):"";this._super(e)}};site.endeca.results.sorting=generic.endeca.results.sorting;generic.endeca.resultsgroup.breadcrumbs={displayResults:function(e){var e=e||{};e.childClass="breadcrumbs";this._super(e);var i=this;jQuery(".clear-all").each(function(e,t){var s=jQuery(this);if(i.displayResultCallback){i.displayResultCallback({"Selection Link":" ",node:s});s.show()}else{s.hide()}})}};site.endeca.resultsgroup.breadcrumbs=generic.endeca.resultsgroup.breadcrumbs;generic.endeca.resultsgroup.contentzones={initialize:function(e){this.resultData={};this.zones={};this.crawlData=[];this.hasSoloResults=false;this.totalResults=0;this.contentzones={};this._super(e)},setCrawlData:function(e){var e=e||{};if(e.crawlData&&e.crawlData.length){this.resultData.crawlData={style:"content",records:e.crawlData}}},setupNodes:function(e){var e=e||{};this.node=this.parentNode||e.node},displayResults:function(e){var e=e||{};e.baseClass=site.endeca.results.contentzone;for(var t in this.contentzones){this.resultClass=null;var s=e;var i=this.resultData[t];if(i&&i.records&&i.records.length){s.resultData=[this.resultData[t].records];s.childClass=this.contentzones[t].childClass||(site.endeca.results.contentzone[this.resultData[t].style]?this.resultData[t].style:this.resultData[t].style.match(/product/i)?"products":"content");s.node=this.contentzones[t].node;if(this.contentzones[t].solo){this.hasSoloResults=true}if(this.contentzones[t].counted){this.totalResults+=s.resultData[0].length}s.configuration=this.contentzones[t];s.mixins=this.mixins["results.contentzone"];this._super(s);this.contentzones[t].resultNode=this.resultNodes[this.resultNodes.length-1];s.node.show()}else{this.contentzones[t].node.hide()}}},hide:function(){for(var e=0;e<this.resultNodes.length;e++){this.resultNodes[e].hide()}},show:function(){for(var e=0;e<this.resultNodes.length;e++){this.resultNodes[e].show()}},reset:function(){for(var e=0;e<this.resultNodes.length;e++){this.resultNodes[e].reset()}this.resultNodes=[];this.totalResults=0}};site.endeca.resultsgroup.contentzones=generic.endeca.resultsgroup.contentzones;generic.endeca.resultsgroup.pagination={displayResults:function(e){var e=e||{};e.childClass="pagination";var t=this;jQuery(".pagination").each(function(){t.parentNode=jQuery(this);e.resultData=[t.resultData];t._super(e)})}};site.endeca.resultsgroup.pagination=generic.endeca.resultsgroup.pagination;generic.endeca.resultsgroup.refinements={initialize:function(e){this.moreRefinements=[];this._super(e)},displayResults:function(e){var e=e||{};e.childClass="refinements";this._super(e);var s=this;jQuery(".expand-all").each(function(e,t){if(s.moreRefinements.length){if(s.displayResultCallback){s.displayResultCallback({"Selection Link":"Ne="+s.moreRefinements().join("+"),node:e})}e.show()}else{e.hide()}})},moreRefinements:function(){if(this.moreRefinements.length){return this.moreRefinements}else{for(var e=0;e<this.resultNodes.length;e++){if(this.resultNodes[e].moreRefinement){this.moreRefinements.push(this.resultNodes[e].moreRefinement)}}}},reset:function(e){this.moreRefinements=[];this._super(e)}};site.endeca.resultsgroup.refinements=generic.endeca.resultsgroup.refinements;var site=site||{};var generic=generic||{};var TFBadges=TFBadges||{};generic.endeca.result.product=jQuery.extend(true,{},generic.endeca.result.product,{displayResult:function(e){this.setupReviewData();this.setupBrandData();this.makeArray("IMAGE_M");this.makeArray("MEDIUM_IMAGE");this.makeArray("IMAGE_L");this.makeArray("LARGE_IMAGE");this.makeArray("LARGE_ALT_IMAGES");this.resultData.defaultSku=_.find(this.resultData.skus,{DEFAULT_SKU:1})||this.resultData.skus[0];this.resultData.defaultSku.IMAGE_M=$.makeArray(this.resultData.defaultSku.IMAGE_M);this.resultData.defaultSku.MEDIUM_IMAGE=$.makeArray(this.resultData.defaultSku.MEDIUM_IMAGE);this.resultData.defaultSku.IMAGE_L=$.makeArray(this.resultData.defaultSku.IMAGE_L);this.resultData.defaultSku.LARGE_IMAGE=$.makeArray(this.resultData.defaultSku.LARGE_IMAGE);this.resultData.defaultSku.LARGE_ALT_IMAGES=$.makeArray(this.resultData.defaultSku.LARGE_ALT_IMAGES);if(Array.isArray(this.resultData.MISC_FLAG_TEXT)){this.resultData.MISC_FLAG_TEXT=this.resultData.MISC_FLAG_TEXT.join(",")}var t=Drupal.settings.consensus_badge_mapping.INVENTORY_STATUS_FLAG.translate||{};if(_.isObject(t)&&!_.isEmpty(t)){var s="";var i=2;var a=3;var r=7;var n=this.checkInvStatus(i,this.resultData.skus);var o=this.checkInvStatus(r,this.resultData.skus);var c=this.checkInvStatus(a,this.resultData.skus);if(this.resultData.skus.length===n.length){s=t[i]}else if(this.resultData.skus.length===o.length){s=t[r]}else if(this.resultData.skus.length===c.length){s=t[a]}if(this.resultData.MISC_FLAG_TEXT!==undefined){this.resultData.MISC_FLAG_TEXT=[this.resultData.MISC_FLAG_TEXT,s].join(",")}else{this.resultData.MISC_FLAG_TEXT=s}}if(Drupal.settings.product_badge_mpp_ts&&this.resultData.MISC_FLAG_TEXT){var l=TFBadges.generateBaseFlagHash(this.resultData);var u=Drupal.settings.product_badge_mpp_ts;var h=TFBadges.generateBadgeItems(l,u);this.resultData.PRODUCT_BADGES=h}this._super(e)},makeArray:function(e){if(this.resultData[e]&&typeof this.resultData[e]!=="object"){this.resultData[e]=[this.resultData[e]]}},checkInvStatus:function(t,e){if(typeof e!==undefined&&t>0){var s=jQuery.grep(e,function(e){return e.INVENTORY_STATUS===t});return s}}});site.endeca.result.product=generic.endeca.result.product;site.endeca.result.shade=jQuery.extend(true,{},generic.endeca.result.shade,{drawSwatch:function(e){if(!this.resultData.HEX_VALUE_STRING||this.resultData.HEX_VALUE_STRING.length<1){return}var t=this.node.find(".search-swatch-container");var s=this.resultData.HEX_VALUE_STRING.split(",");for(var i=0;i<s.length;i++){var a=jQuery("<div/>");a.css({"background-color":s[i]});if(i==0){a.addClass("first")}if(i==s.length-1){a.addClass("last")}if(s.length==1){a.addClass("single")}t.append(a)}t.css("width","auto")}});var site=site||{};var generic=generic||{};generic.endeca.results.bestsellers=jQuery.extend(true,{},generic.endeca.results.bestsellers,{displayResultNodes:function(){this._super();jQuery(document).trigger("endeca.search.results.loaded",[{results:{products:{resultData:this.resultData}}}])}});site.endeca.results.bestsellers=generic.endeca.results.bestsellers;var site=site||{};var generic=generic||{};jQuery(document).ready(function(){site.endeca.configuration={query:{MDEXHost:"localhost",MDEXPort:Drupal.settings.endeca.ports.mdex,logHost:generic.endeca.generic.env.domain.match(/www/)?"njlndca01":"localhost",logPort:Drupal.settings.endeca.ports.log,defaultDimensionIds:[8157,8095,8186,8063,8174,8051,8089,8195,8173,8050],configuredRangeFilters:{skuShoppable:"s_shoppable|GT+0",skuPromotional:"s_promotional|GT+0",skuSearchable:"s_searchable|GT+0",productTrFlag:"p_TR_FLAG|LT+1",productDisplayable:"p_displayable|GT+0",productShoppable:"p_shoppable|GT+0"},defaultRangeFilters:["skuSearchable"],configuredRecordFilters:{products:"rec_type:product",content:"rec_type:content",locale:"locale:"+(jQuery.cookie("LOCALE")||Drupal.settings.endeca.locale),activeSkus:"NOT(s_INVENTORY_STATUS:5)",discontinued:"NOT(s_discontinued:1)",shoppableOrComingSoon:"OR(s_shoppable:1,s_INVENTORY_STATUS:3)"}},mustacheMappings:function(){var e=function(e,t){var s=[];for(i=0,j=e.length;i<j;i++){s[e[i]]=t[i]}return s};var t=_.keys(site.templates);return e(t,t)}(),coremetricsEnabled:false,omnitureEnabled:true,contentzones:{},mixins:{}}});site.endeca.coremetrics=jQuery.extend(true,{},generic.endeca.coremetrics,{category_id:"search",page_id:"Search Results",dimensionNameMap:{"Skin Type":"Typ","Skin Tone":"Ton"}});var global=global||{};var site=site||{};var rb=rb||{};var MantleSearch=MantleSearch||{};site.endeca=site.endeca||{};site.endeca.instances=site.endeca.instances||{};site.endeca.instances.typeahead=site.endeca.instances.typeahead||{};(function(u){site.endeca.instances.typeahead.control=site.endeca.generic.Class.create(site.endeca.control,{initialize:function(e){this.timer=0;this._super(e);if(this.nodes.wrapper.length&&this.nodes.inputElements.length){var t=this;this.nodes.inputElements.bind("keyup",t,t.onKeyUp);this._watchForOpen();this._watchToClose()}u(document).trigger("endeca.typeahead.init")},onKeyUp:function(e){var t=jQuery(this);var s=t.hasClass("search-term--header");var i=e.data;clearTimeout(i.timer);i.timer=setTimeout(function(){i.currentInputElement=t;var e=jQuery.trim(t.val());if(e!==i.searchTerm&&e.length>=i.configuration.minSearchLength){i.searchTerm=e;i.search({searchTerm:e})}u(document).trigger("endeca.typeahead.keyup",[e,s])},175)},_watchToClose:function(){var e=this;jQuery(document).bind("click",e,function(e){var t=e.target;var s=e.data;if(!jQuery(t).parents(s.nodes.wrapper.selector).length&&t!==s.currentInputElement&&t!==s.nodes.wrapper[0]){s.nodes.wrapper.addClass("hidden");return}u(document).trigger("endeca.typeahead.close")})},_watchForOpen:function(){var e=this;jQuery(".js-gnav-util-trigger--search").click(function(){e.displayRecentSearches()})},displayRecentSearches:function(){var e=site.endeca.helpers.obj.first(this.queries).parsedSearchTerm()||"";this.results.recentsearches.searchTerm=e;this.results.recentsearches.displayResults()},searchCompleted:function(){if(!this._super()){return}this.hasResults=false;if(this.queries.product.jsonResult.AggrRecords&&this.queries.product.jsonResult.AggrRecords.length){var s={};var e=[];for(var t=0;t<this.queries.product.jsonResult.AggrRecords.length;t++){if(this.queries.product.jsonResult.AggrRecords[t].Properties["DGraph.WhyDidItMatch"]){var i;if(typeof this.queries.product.jsonResult.AggrRecords[t].Properties["DGraph.WhyDidItMatch"]=="string"){i=[this.queries.product.jsonResult.AggrRecords[t].Properties["DGraph.WhyDidItMatch"]]}else{i=this.queries.product.jsonResult.AggrRecords[t].Properties["DGraph.WhyDidItMatch"]}for(var a=0;a<i.length;a++){if(i[a]&&i[a].match(/Product Category: (.*)/)){if(!RegExp.$1.match(/^CAT/)){if(s[RegExp.$1]){s[RegExp.$1]++}else{s[RegExp.$1]=1;e.push({term:RegExp.$1,url:this.configuration.fullSearchBaseUrl+encodeURIComponent(RegExp.$1)})}}}}}}if(this.results.terms.configuration.limit&&e.length>this.results.terms.configuration.limit){e.splice(this.results.terms.configuration.limit)}e.sort(function(e,t){if(s[e]>s[t]){return-1}else if(s[e]<s[t]){return 1}return 0});this.results.terms.resultData=e;this.results.terms.displayResults();this.results.terms.displayResultNodes();this.results.terms.show();this.hasResults=true}else{this.results.terms.hide()}this.results.products.resultData=this.catalogs.product.resultList;var r=MantleSearch.filterProductList(this.results.products.resultData);this.results.products.resultData=r;if(this.results.products.resultData.length){for(var t=0;t<this.results.products.resultData.length;t+=1){for(var n in this.results.products.resultData[t]){if(n.indexOf("IMAGE_")===0&&typeof this.results.products.resultData[t][n]!=="string"){this.results.products.resultData[t][n]=this.results.products.resultData[t][n][0]}}}this.results.products.displayResults();this.results.products.show();this.results.recentsearches.hide();this.hasResults=true}else{this.displayRecentSearches();this.results.products.hide()}if(this.hasResults){var o=this.searchTerm.replace("*","");var c=rb.endeca["show_results"];c=c.replace("::term::",o);this.results.seeResults.resultData=[{term:c+" ("+this.meta.searchInfo.totalRecords+")",url:this.configuration.fullSearchBaseUrl+o}];this.results.seeResults.displayResults();this.results.seeResults.displayResultNodes();this.results.seeResults.show()}this.nodes.wrapper.removeClass("hidden");var l=this.nodes;this.nodes.wrapper.find(".result").bind("click",function(e){var t=this.getElementsByClassName("link");t[0].click();if(this.parentElement.parentNode.className==="js-end-typeahead-term-results"){}else{site.endeca.coremetrics.productClick()}return true});this.hideLoading();u(document).trigger("endeca.typeahead.complete",[this.hasResults]);this.displayResults()}})})(jQuery);var site=site||{};site.endeca=site.endeca||{};site.endeca.instances=site.endeca.instances||{};site.endeca.instances.typeahead=site.endeca.instances.typeahead||{};jQuery(document).ready(function(){site.endeca.instances.typeahead.configuration=jQuery.extend(true,{},site.endeca.configuration,{followRedirects:false,minSearchLength:3,fullSearchBaseUrl:"/esearch?search=",nodes:{wrapper:jQuery(".js-end-typeahead-wrapper"),inputElements:jQuery(".js-end-search-term"),loading:jQuery(".js-end-typehead-loading")},queries:{product:{recordsPerPage:5,recordFilters:["discontinued","activeSkus","products"]}},results:{products:{baseClass:"site.endeca.results",instanceArgs:{parentNode:jQuery(".js-end-typeahead-product-results",".js-end-typeahead-wrapper"),childTemplatePath:"/templates/endeca/typeahead/product-result.tmpl",childTemplatePathSku:"/templates/endeca/typeahead/product-sku-result.tmpl"},configuration:{limit:5}},terms:{baseClass:"site.endeca.results",instanceArgs:{parentNode:jQuery(".js-end-typeahead-term-results",".js-end-typeahead-wrapper"),templatePath:"/templates/endeca/typeahead/term-result.tmpl"},configuration:{limit:2}},seeResults:{baseClass:"site.endeca.results",instanceArgs:{parentNode:jQuery(".js-end-typeahead-see-results",".js-end-typeahead-wrapper"),templatePath:"/templates/endeca/typeahead/term-result.tmpl"}},recentsearches:{baseClass:"site.endeca.results",instanceArgs:{parentNode:jQuery(".js-end-recent-searches")},configuration:{maximumRecentSearches:5}}}});new site.endeca.instances.typeahead.control(site.endeca.instances.typeahead.configuration)});
//# sourceMappingURL=toofaced-endeca.mjs-bundle.js.map
