var MantlePerf=MantlePerf||{};var MantleGrid=function(d){d.initializeGrid=function(t,r,e){var a={grid:t,item_selector:r};a=_.extend({},a,e||{});var i=d.Dataset.getInitialDataset(t,r);var n=d.MixItUp.getSettings(a);n.load.dataset=i;if(t.data("sort-string")){a.initialSort=t.data("sort-string")}var o=$(r+":visible",t);var s=d.gather_total_cols(o);t.attr("data-total-colspan",s);t.data("mantleGridOptions",a);d.initMixItUp(t,n,a);d.attachEvents(a);d.reportGridCount(a)};d.getDataset=function(t){return d.Dataset.getDataset(t)};d.reportGridCount=function(t){var r=t.grid;var e=t.item_selector;var a=$(e+":visible",r);var i={};i.all=a.length;i.products=a.filter(":not([data-inline-content])").length;r.trigger("mantle-grid:grid-count",i)};d.remixedDataset=function(t,r,e){var a=d.Dataset;var i=d.Filter;var n=d.Sorting;var o=a.getDataset(t);var s=i.filterDataset(o,r);var l=n.getSortConfigByKey(e);var u=n.sortByConfig(s,l);return u};d.remix=function(r,e,a,t){if(!e){e={}}if(!a&&a!==false){a="default"}var i={animate:true};t=_.extend({},i,t||{});var n=t.animate;var o=r.data("mixitup-mixer");var s=MantlePerf.thresholdLog(function(){var t=d.remixedDataset(r,e,a);return t},"MantleGrid.remixDataset");var l=r.data("mantleGridOptions");if(typeof l.remixedDatasetAlter==="function"){var u=l.remixedDatasetAlter(s,o,e,a,t);if(u){s=u}}r.data("animate-op",n);MantlePerf.thresholdLog(function(){o.dataset(s,n)},"mixer.dataset")};d.attachEvents=function(t){var i=t.grid;var a=t.item_selector;i.off(".mantle-grid-attach");i.on("mantle-grid:filter-set.mantle-grid-attach",function(t,r){if(i.data("mixitup-mixer")){i.data("filter-query",r);var e=JSON.stringify(r);i.attr("data-filter-string",e);i.trigger("mantle-grid:remix")}});i.on("mantle-grid:filter-reset.mantle-grid-attach",function(){i.trigger("mantle-grid:filter-set",{})});i.on("mantle-grid:sort-selected.mantle-grid-attach",function(t,r){if(i.data("mixitup-mixer")){i.attr("data-sort-string",r);i.trigger("mantle-grid:remix")}});i.on("mantle-grid:remix.mantle-grid-attach",function(t,r){if(i.data("mixitup-mixer")){var e=i.data("filter-query");var a=i.attr("data-sort-string");d.remix(i,e,a,r)}});i.on("mantle-grid:request-grid-count.mantle-grid-attach",function(){d.reportGridCount(t)});i.on("mantle-grid:process-filter-manifest.mantle-grid-attach",function(t,r){var e=d.Filter.processFilterManifest(i,a,r);return e})};d.initMixItUp=function(t,r,e){var a=null;var i=null;var n=r.load.dataset;if(e.initialSort){a=e.initialSort}if(e.initialFilter){i=e.initialFilter}var o=t.data("mixitup-mixer");if(!!o){console.warn("We are reiniting mixitup. This is supported but not optimal");o.destroy()}o=mixitup(t,r);t.data("mixitup-mixer",o);if((a||i)&&!e.initialDatasetAlter){var s=d.remixedDataset(t,i,a);MantlePerf.thresholdLog(function(){o.dataset(s,false)},"initMixItUp.remixedInitialDataset")}if(e.initialDatasetAlter){var l=e.initialDatasetAlter(n,o,i,a);if(!!l){MantlePerf.thresholdLog(function(){o.dataset(l,false)},"initMixItUp.alteredInitialDataset")}}t.addClass("mg-grid-loaded");if(!t.data("sort-string")){t.attr("data-sort-string","default")}};d.gather_total_cols=function(t){var i=0;t.each(function(t,r){var e=$(r);var a=1;if(e.data("grid-colspan")){a=e.data("grid-colspan");a=parseInt(a)}i+=a});return i};return d}(MantleGrid||{});var JSBoot=JSBoot||{};var MantlePD=MantlePD||{};var MantlePerf=MantlePerf||{};var MantleGrid=function(n){if(n.MixItUp){return n}n.MixItUp=n.MixItUp||{};var t=n.MixItUp;t.getSettings=function(e){var r=e.grid;var a=e.item_selector;var i=new n.Animation.AnimationManager(r,a);if(!e.disableStaggeredAnimation){i.initGridItemHandlers()}var t={animation:{duration:500,effects:"fade",clampHeight:false},selectors:{target:a},data:{uidKey:"id"},controls:{enable:false},layout:{},load:{},callbacks:{onMixStart:function(t,r){MantlePerf.thresholdLog(function(){if(!e.disableStaggeredAnimation){i.mixStartHandler()}},"mixStart")},onMixEnd:function(t){MantlePerf.thresholdLog(function(){if(!e.disableStaggeredAnimation){i.mixEndHandler()}n.reportGridCount(e);n.Placement.ie11_autoplacement(r,a)},"mixEnd")}}};if(e.effects){t.animation.effects=e.effects}if(e.staggerSequence){t.animation.staggerSequence=e.staggerSequence}if(n.IEVersion===11){t.animation.enable=false;n.Placement.ie11_autoplacement(r,a)}return t};return n}(MantleGrid||{});var MantleScroll=MantleScroll||{};var MantleGrid=function(t){if(t.Animation){return t}t.Animation=t.Animation||{};var r=t.Animation;var e=function(t,r){var e=this;this.item_selector=r;this.$grid=t;this.mixend_timer=null;this.firstRun=true;var a=_.debounce(function(){e.process_queue()});var i=function(t){if(e.mixing){return}_.each(t,function(t){if(t.isIntersecting){var r=t.target;$(r).addClass("queue-animation");a()}})};var n={root:null,rootMargin:"0px",threshold:[.1]};this.observer=new IntersectionObserver(i,n)};e.prototype.process_queue=function(){var t=this.$grid;var r=this.item_selector;var e=$(r+".queue-animation:visible",t);var a=1;e.each(function(t,r){var e=$(r);e.removeClass("queue-animation");if(MantleScroll.offscreen(e)){return}e.attr("data-grid-delay",a);a++});e.addClass("mg-item-reveal")};e.prototype.initGridItemHandlers=function(){var t=this.$grid;var r=this.item_selector;var e=t[0].querySelectorAll(r);for(var a=0;a<e.length;a++){var i=e[a];this.observer.observe(i)}};e.prototype.resetAnimation=function(){var t=this.$grid;var r=this.item_selector;var e=t[0].querySelectorAll(r);for(var a=0;a<e.length;a++){var i=e[a];this.observer.unobserve(i)}var n=$(r,t);n.removeClass("queue-animation");if(!this.firstRun&&t.data("animate-op")){n.removeClass("mg-item-reveal")}this.firstRun=false};e.prototype.mixStartHandler=function(){var t=this.$grid;window.clearTimeout(this.mixend_timer);this.mixing=true;t.addClass("mixing");this.resetAnimation()};e.prototype.mixEndHandler=function(){var t=this.$grid;this.mixing=false;this.mixend_timer=window.setTimeout(function(){t.removeClass("mixing")},500);this.initGridItemHandlers()};r.AnimationManager=e;return t}(MantleGrid||{});var MantleGrid=function(n){if(n.Placement){return n}n.Placement=n.Placement||{};var o=n.Placement;o.ie11_autoplacement=function(t,r){if(n.IEVersion!==11){return}var e=$(r+":visible",t);if(e.length===0){return}var a=e.parent();var i=o.detectColumns(a);n.Placement.autoplacement_dense(e,i)};o.detectColumns=function(t){var r=4;if($(window).width()<640){r=2}var e=o.getGridTemplate(t);if(!e){return r}var a=e.split(" ");r=a.length;return r};o.getGridTemplate=function(t){var r=t.css("grid-template-columns");if(!r){r=t.css("-ms-grid-columns")}return r};o.autoplacement_dense=function(t,d){var f=1;var c=1;var v={};var g=function(){f++;_.each(v,function(t,r){if(f>t){delete v[r]}})};t.each(function(t,r){var e=$(r);var a=1;var i=1;if(e.data("grid-colspan")){a=e.data("grid-colspan")}if(e.data("grid-rowspan")){i=e.data("grid-rowspan")}var n=c;while(true){if(v[n]){n++;continue}if(n>d){n=1;g();continue}var o=1;var s=n+1;while(true){if(v[s]){break}if(s>d){break}o++;s++}var l=false;if(a<=o){l=true}if(o===d){l=true}if(!l){n=1;g();continue}break}c=n;if(i>1){for(var u=0;u<a;u++){v[c+u]=f+i-1}}r.style["-ms-grid-row"]=f;r.style["-ms-grid-row-span"]=i;r.style["-ms-grid-column"]=c;r.style["-ms-grid-column-span"]=a;r.style["grid-row"]=f+" / span "+i;r.style["grid-column"]=c+" / span "+a;e.attr("grid-row",f);e.attr("grid-row-span",i);e.attr("grid-column",c);e.attr("grid-column-span",a);c+=a})};return n}(MantleGrid||{});var JSBoot=JSBoot||{};var MantlePD=MantlePD||{};var MantleGrid=function(i){if(i.Dataset){return i}i.Dataset=i.Dataset||{};var u=i.Dataset;u.basePrerenderedDataset=function(t,r){var e=$(r,t);var i=[];e.each(function(t,r){var e=$(r);e.attr("data-grid-uid",t);var a={id:t,initial_order:t,filters:{}};if(e.data("order-index")){a.order_index=parseInt(e.data("order-index"))}i.push(a)});return i};u.getInitialDataset=function(t,r){var e=u.basePrerenderedDataset(t,r);t.data("grid-dataset",e);u.gridDataAlter(t);return e};u.gridDataAlter=function(s){var t=i.getDataset(s);var r=s.find("[data-grid-uid]");var l={};for(var e=0;e<t.length;e++){var a=t[e];l[a.id]=a}$.each(r,function(t,r){var e=$(r);var a=e.data("grid-uid");var i=l[a];var n={};if(e.data("product-id")){var o=e.data("product-id");i.is_product=true;i.product_id=o}u.initDataItem(i,e,n);s.trigger("mantle-grid:init-dataItem",[i,e,n])})};u.initDataItem=function(t,r,e){if(!t.is_product){return}t.filterable=true;var a=t.product_id;var i=r;var n=r[0].querySelector('.js-product[data-product-id="'+a+'"]');if(n){i=$(n)}var o=MantlePD.getProductFromEl(i);var s=i.data("pd-manifest");e.prodData=o;e.pdManifest=s;t.product_name=o.PROD_RGN_NAME;if(o.defaultSku){var l=o.defaultSku;if(l.PRICE){t.price=l.PRICE}}};u.getDataset=function(t){var r=t.data("grid-dataset");return r};u.getDataItemById=function(t,e){if(JSBoot.isJQuery(e)){e=e.data("grid-uid");if(e===null){return}}var a=null;$.each(t,function(t,r){if(r.id===e){a=r;return false}});return a};return i}(MantleGrid||{});var MantleGrid=function(n){if(n.Filter){return n}var l=function(t,r,e){var a=e>0?e|0:0;return t.substring(a,a+r.length)===r};n.Filter=n.Filter||{};var c=n.Filter;c.processPrice=function(a,i,t,n,o,s){_.each(t,function(t){var r=t.min;var e=t.max;if(n<r||n>=e){return}c.addToFilterSet(a,i,t,o,s)})};c.processTags=function(e,a,t,i,n,o){_.each(t,function(t){var r=t.key;if(!_.contains(i,r)){return}c.addToFilterSet(e,a,t,n,o)})};c.addToFilterSet=function(t,r,e,a,i){var n=e.key;var o=e.label;var s=e["filter_key"];var l="product-grid__item--filter--"+s;if(!(n in t[r])){t[r][n]={namespace:r,key:n,filter_key:s,name:o,classname:l,count:0}}t[r][n]["count"]++;if(i&&i.filters){i.filters[s]=true}};c.processFilterManifest=function(t,r,e){var a=$(r,t);var f={};var i=n.getDataset(t);a.each(function(t,r){var u=$(r);var d=n.Dataset.getDataItemById(i,u);_.each(e,function(t){var r=t.key;if(!(r in f)){f[r]={}}if(t.type==="product_price"){if(!u.data("product-id")){return}var e=u.data("product-id");var a=prodcat.data.getProduct(e);var i=t.subtype;var n=a.defaultSku;if(_.isUndefined(n)||_.isNull(n)){return}var o=a.defaultSku[i];if(_.isUndefined(o)||_.isNull(o)){return}var s=t.filter_list;c.processPrice(f,r,s,o,u,d)}if(t.type==="product_data"){if(!u.data("product-id")){return}var e=u.data("product-id");var a=prodcat.data.getProduct(e);var i=t.subtype;var l=a[i];if(!l){return}var s=t.filter_list;l=_.map(l.split(","),_.trim);c.processTags(f,r,s,l,u,d)}})});return f};c.filterDataset=function(t,r){var e=t.slice(0);if(!r||_.isEmpty(r)){return e}var a=e.length;var i=[];for(var n=0;n<a;n++){var o=e[n];if(!o.filterable){continue}var s=c.checkFilterMatch(o,r);if(s){i.push(o)}}if(!!JSBoot.cookie.get("grid-debug")){console.log(r,i)}return i};c.checkFilterMatch=function(t,r){var e=t.filters;return c.checkFilterMatchGroup(e,r)};c.checkFilterMatchGroup=function(t,r){var e=r.__type||"OR";var a=e==="OR";var i=!a;for(var n in r){if(l(n,"__")){continue}var o=r[n];if(typeof o==="object"){var s=c.checkFilterMatchGroup(t,o);if(i&&s===false){return false}if(a&&s===true){return true}}if(o===true){if(a&&t[n]===true){return true}if(i&&t[n]!==true){return false}}}if(i){return true}return false};return n}(MantleGrid||{});var JSBoot=JSBoot||{};var MantleSettings=MantleSettings||{};var MantleGrid=function(t){if(t.Sorting){return t}t.Sorting=t.Sorting||{};var n=t.Sorting;n.sortByConfig=function(t,r){var e=t.slice(0);if(_.isEmpty(r)||_.isEmpty(r.sorts)){return e}var a=!!r.hide_touts;var u=r.sorts;var i={};if(!a){_.each(e,function(t){if(!t.is_product){i[t.initial_order]=t}})}e=_.filter(e,function(t){return!!t.is_product});e.sort(function(t,r){for(var e=0;e<u.length;e++){var a=u[e];var i=a.field;var n=!!a.ascending;var o=1;if(!n){o=-1}var s=t[i];var l=r[i];if(typeof s==="undefined"&&typeof l=="undefined"){continue}if(typeof s==="undefined"){return-1*o}if(s<l){return-1*o}if(typeof l==="undefined"){return 1*o}if(s>l){return 1*o}}});var n=t.length;var o=[];for(var s=0;s<n;s++){if(!_.isEmpty(i[s])){o.push(i[s]);continue}while(e.length>0){var l=e.shift();if(!l.is_product){continue}o.push(l);break}}if(!!JSBoot.cookie.get("grid-debug")){console.log(r,o)}return o};n.getSortConfigByKey=function(t,r){if(!t){return null}var e=t.split(":");if(e.length===2){t=e[0];r=e[1]}var a=n.getBaseSortConfigByKey(t);var i=null;if(r){i=this.processVariantConfig(a,r)}if(i){a=i}return a};n.getBaseSortConfigByKey=function(t){if(_.isEmpty(MantleSettings.mantle_grid_sort_config)){return null}var r=MantleSettings.mantle_grid_sort_config[t];if(!r){return null}return r};n.processVariantConfig=function(t,r){if(!t.variants||!t.variants[r]){return}var e=t.variants[r];var a=Object.assign({},t);a.sorts=e.sorts;return a};return t}(MantleGrid||{});var MantleGrid=function(t){function r(){var t=-1;if(navigator.appName=="Microsoft Internet Explorer"){var r=navigator.userAgent;var e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(e.exec(r)!=null)t=parseFloat(RegExp.$1)}else if(navigator.appName=="Netscape"){var r=navigator.userAgent;var e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(e.exec(r)!=null)t=parseFloat(RegExp.$1)}return t}t.IEVersion=r();return t}(MantleGrid||{});
//# sourceMappingURL=mantle-grid.mjs-bundle.js.map
