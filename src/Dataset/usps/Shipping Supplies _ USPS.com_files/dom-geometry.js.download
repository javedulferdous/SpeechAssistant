define(["./sniff","./_base/window","./dom","./dom-style"],function(k,g,l,h){function m(a,b,d,c,e,f){f=f||"px";a=a.style;isNaN(b)||(a.left=b+f);isNaN(d)||(a.top=d+f);0<=c&&(a.width=c+f);0<=e&&(a.height=e+f)}function q(a){return"button"==a.tagName.toLowerCase()||"input"==a.tagName.toLowerCase()&&"button"==(a.getAttribute("type")||"").toLowerCase()}function r(a){return"border-box"==e.boxModel||"table"==a.tagName.toLowerCase()||q(a)}var e={boxModel:"content-box"};k("ie")&&(e.boxModel="BackCompat"==document.compatMode?
"border-box":"content-box");e.getPadExtents=function(a,b){a=l.byId(a);var d=b||h.getComputedStyle(a),c=h.toPixelValue;b=c(a,d.paddingLeft);var e=c(a,d.paddingTop),f=c(a,d.paddingRight);a=c(a,d.paddingBottom);return{l:b,t:e,r:f,b:a,w:b+f,h:e+a}};e.getBorderExtents=function(a,b){a=l.byId(a);var d=h.toPixelValue,c=b||h.getComputedStyle(a);b="none"!=c.borderLeftStyle?d(a,c.borderLeftWidth):0;var e="none"!=c.borderTopStyle?d(a,c.borderTopWidth):0,f="none"!=c.borderRightStyle?d(a,c.borderRightWidth):0;
a="none"!=c.borderBottomStyle?d(a,c.borderBottomWidth):0;return{l:b,t:e,r:f,b:a,w:b+f,h:e+a}};e.getPadBorderExtents=function(a,b){a=l.byId(a);var d=b||h.getComputedStyle(a);b=e.getPadExtents(a,d);a=e.getBorderExtents(a,d);return{l:b.l+a.l,t:b.t+a.t,r:b.r+a.r,b:b.b+a.b,w:b.w+a.w,h:b.h+a.h}};e.getMarginExtents=function(a,b){a=l.byId(a);var d=b||h.getComputedStyle(a),c=h.toPixelValue;b=c(a,d.marginLeft);var e=c(a,d.marginTop),f=c(a,d.marginRight);a=c(a,d.marginBottom);return{l:b,t:e,r:f,b:a,w:b+f,h:e+
a}};e.getMarginBox=function(a,b){a=l.byId(a);var d=b||h.getComputedStyle(a);b=e.getMarginExtents(a,d);var c=a.offsetLeft-b.l,n=a.offsetTop-b.t,f=a.parentNode,g=h.toPixelValue;if(k("mozilla")){var m=parseFloat(d.left);d=parseFloat(d.top);isNaN(m)||isNaN(d)?f&&f.style&&(f=h.getComputedStyle(f),"visible"!=f.overflow&&(c+="none"!=f.borderLeftStyle?g(a,f.borderLeftWidth):0,n+="none"!=f.borderTopStyle?g(a,f.borderTopWidth):0)):(c=m,n=d)}else(k("opera")||8==k("ie")&&!k("quirks"))&&f&&(f=h.getComputedStyle(f),
c-="none"!=f.borderLeftStyle?g(a,f.borderLeftWidth):0,n-="none"!=f.borderTopStyle?g(a,f.borderTopWidth):0);return{l:c,t:n,w:a.offsetWidth+b.w,h:a.offsetHeight+b.h}};e.getContentBox=function(a,b){a=l.byId(a);var d=b||h.getComputedStyle(a);b=a.clientWidth;var c=e.getPadExtents(a,d);d=e.getBorderExtents(a,d);b?(a=a.clientHeight,d.w=d.h=0):(b=a.offsetWidth,a=a.offsetHeight);k("opera")&&(c.l+=d.l,c.t+=d.t);return{l:c.l,t:c.t,w:b-c.w-d.w,h:a-c.h-d.h}};e.setContentSize=function(a,b,d){a=l.byId(a);var c=
b.w;b=b.h;r(a)&&(d=e.getPadBorderExtents(a,d),0<=c&&(c+=d.w),0<=b&&(b+=d.h));m(a,NaN,NaN,c,b)};var t={l:0,t:0,w:0,h:0};e.setMarginBox=function(a,b,d){a=l.byId(a);var c=d||h.getComputedStyle(a);d=b.w;var g=b.h,f=r(a)?t:e.getPadBorderExtents(a,c);c=e.getMarginExtents(a,c);if(k("webkit")&&q(a)){var p=a.style;0<=d&&!p.width&&(p.width="4px");0<=g&&!p.height&&(p.height="4px")}0<=d&&(d=Math.max(d-f.w-c.w,0));0<=g&&(g=Math.max(g-f.h-c.h,0));m(a,b.l,b.t,d,g)};e.isBodyLtr=function(a){a=a||g.doc;return"ltr"==
(g.body(a).dir||a.documentElement.dir||"ltr").toLowerCase()};e.docScroll=function(a){a=a||g.doc;var b=g.doc.parentWindow||g.doc.defaultView;return"pageXOffset"in b?{x:b.pageXOffset,y:b.pageYOffset}:(b=k("quirks")?g.body(a):a.documentElement)&&{x:e.fixIeBiDiScrollLeft(b.scrollLeft||0,a),y:b.scrollTop||0}};k("ie")&&(e.getIeDocumentElementOffset=function(a){a=a||g.doc;a=a.documentElement;if(8>k("ie")){var b=a.getBoundingClientRect(),d=b.left;b=b.top;7>k("ie")&&(d+=a.clientLeft,b+=a.clientTop);return{x:0>
d?0:d,y:0>b?0:b}}return{x:0,y:0}});e.fixIeBiDiScrollLeft=function(a,b){b=b||g.doc;var d=k("ie");if(d&&!e.isBodyLtr(b)){var c=k("quirks");b=c?g.body(b):b.documentElement;var h=g.global;6==d&&!c&&h.frameElement&&b.scrollHeight>b.clientHeight&&(a+=b.clientLeft);return 8>d||c?a+b.clientWidth-b.scrollWidth:-a}return a};e.position=function(a,b){a=l.byId(a);var d=g.body(a.ownerDocument),c=a.getBoundingClientRect();c={x:c.left,y:c.top,w:c.right-c.left,h:c.bottom-c.top};if(9>k("ie")){var h=e.getIeDocumentElementOffset(a.ownerDocument);
c.x-=h.x+(k("quirks")?d.clientLeft+d.offsetLeft:0);c.y-=h.y+(k("quirks")?d.clientTop+d.offsetTop:0)}b&&(a=e.docScroll(a.ownerDocument),c.x+=a.x,c.y+=a.y);return c};e.getMarginSize=function(a,b){a=l.byId(a);b=e.getMarginExtents(a,b||h.getComputedStyle(a));a=a.getBoundingClientRect();return{w:a.right-a.left+b.w,h:a.bottom-a.top+b.h}};e.normalizeEvent=function(a){"layerX"in a||(a.layerX=a.offsetX,a.layerY=a.offsetY);if(!k("dom-addeventlistener")){var b=a.target;b=b&&b.ownerDocument||document;var d=k("quirks")?
b.body:b.documentElement,c=e.getIeDocumentElementOffset(b);a.pageX=a.clientX+e.fixIeBiDiScrollLeft(d.scrollLeft||0,b)-c.x;a.pageY=a.clientY+(d.scrollTop||0)-c.y}};return e});
