var HU=HU||{};HU.SSO=HU.SSO||{};(function(a){"use strict";a.baseUrl=HU.SSO.baseUrl||"https://passport.hurb.com";a.logonUrl=HU.SSO.baseUrl+"/checkPoint";a.logoutUrl=HU.SSO.baseUrl+"/checkPoint/logout";a.csfrUrl=HU.SSO.csfrUrl||"https://www.hurb.com/pay/csfr";a.userDataUrl=HU.SSO.userDataUrl||"https://myaccountapi.hurb.com/v1/users/basic";a.key=HU.SSO.key||"5485c36d3148f319854ebeb9";a.lang=HU.SSO.lang||"pt_BR";a.csfr=HU.SSO.csfr||"000000";a.googleId=HU.SSO.googleId||"294303068320-77emisj9tuqr5iek35k6hlg5filksaeo.apps.googleusercontent.com";a.facebookId=HU.SSO.facebookId||173460426152579;a.hasFacebookSDK=function(){return window&&window.FB;};a.loadFacebookSDK=function(){if(!a.hasFacebookSDK()){var b=document.createElement("script");b.src='https://connect.facebook.net/'+a.lang+'/sdk'+(window.localStorage&&localStorage.getItem('fbDebug')?'/debug':'')+'.js';b.defer=true;b.async=true;document.head.appendChild(b);window.fbAsyncInit=function(){FB.init({appId:a.facebookId,autoLogAppEvents:true,xfbml:true,version:'v8.0'});FB.AppEvents.logPageView();};}};a.__onload=function(){a.__init();a.loginGoogleYolo().then(undefined,function(){});a.loadFacebookSDK();};a.__init=function(){a.logonUrl=HU.SSO.baseUrl+"/checkPoint";a.logoutUrl=HU.SSO.baseUrl+"/checkPoint/logout";a.myAccountStatus="https://myaccountapi.hurb.com/v1/users/status";};a.loginGoogleYolo=function(){a.__init();return c().then(function(a){if(!a.ready)throw new Error('Google Yolo not ready');return a;}).then(function(a){if(!d())throw new Error('Google yolo not ready');return a;}).then(function(b){return a.isUserLoggedIn().then(function(a){if(a.isLoggedIn)throw new Error('User already logged in');return b;});}).then(function(){return new Promise(function(a,c){window.google.accounts.id.initialize({client_id:HU.SSO.googleId,auto_select:false,scope:["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email"],callback:a});window.google.accounts.id.prompt(function(a){if(a.getSkippedReason()==="user_cancel"){b("send",{hitType:"event",eventCategory:"Login",eventAction:"click_login_fechar",eventLabel:"one_tap_google"});if(window.hum)window.hum("event","one_tap_google","click_login_fechar");}if(a.isNotDisplayed()&&a.getNotDisplayedReason()==="opt_out_or_no_session"){b("send",{hitType:"event",eventCategory:"Login",eventAction:"no_google_account",eventLabel:"one_tap_google"});if(window.hum)window.hum("event","one_tap_google","no_google_account");}if(a.isSkippedMoment())c(new Error("Google yolo skipped"));if(a.isNotDisplayed())c(new Error("Google yolo not displayed"));});});}).then(function(a){b("send",{hitType:"event",eventCategory:"Login",eventAction:"click_login",eventLabel:"one_tap_google"});if(window.hum)window.hum("event","one_tap_google","click_login");return f(a.credential);});function c(){if(!d()&&document&&window&&window.navigator&&window.navigator.vendor&&window.navigator.vendor.search(/Google\ Inc\./)>-1){var a=document.createElement("script");a.src="https://accounts.google.com/gsi/client?onload=onGoogleLibraryLoad";a.defer=true;a.async=true;document.head.appendChild(a);}return new Promise(function(a){var b=false;var c=undefined;var e=0;if(d()){f(true);return;}window.onGoogleLibraryLoad=function(){f(true);};c=setInterval(function(){e++;if(d())f(true);else if(e>=7)f(false);},1000);function f(d){if(b)return;b=true;if(c)clearInterval(c);a({ready:d});}});}function d(){return window.google&&window.google.accounts;}};a.logon=function(b,c,d,e,f){a.__init();e=e||HU.SSO.csfr;d=d||false;var g={frm_login:b,frm_password:c,frm_persistCookie:d,csfr:e,destiantionUrl:f||false,appKey:HU.SSO.key,lang:HU.SSO.lang};return b(a.logonUrl,g,f);};a.logout=function(b){a.__init();return h({responseType:'json',url:HU.SSO.logoutUrl+(b?"?redirUrl="+b:''),timeout:5000,withCredentials:true}).then(function(a){var b=a.domainsToLogout.map(function(b){return '//'+b+a.pathLogout;});return i(b).then(undefined,function(a){if(typeof a==='object'&&a.message==='Paths is empty')return;throw a;}).then(function(){return a;});}).then(function(a){if(b)window.location=b;else g('HU.SSO.userLoggedOut');;return a;}).then(undefined,function(a){if(console&&console.warn)console.warn('Can\'t logout the user');g('HU.SSO.userLogoutError');throw a;});};a.generateCsfr=function(b){return jQuery.ajax(a.csfrUrl,b);};a.isUserLoggedIn=function(){return h({responseType:'json',url:a.myAccountStatus,timeout:10000,withCredentials:true});};a.getLoggedInUser=function(b){return h({responseType:'json',url:a.userDataUrl,withCredentials:true});};a.loginFacebook=function(b,c,d,e){a.__init();b=b||a.key;var f={scope:'public_profile,email'};FB.login(function(f){if(!f.authResponse){if(console&&console.warn)console.warn('User cancelled login or did not fully authorize.');g('HU.SSO.actionFail');throw new Error("Facebook login not authorized");}a.facebookCallback(f.authResponse,c,b,d,e);},f);};a.facebookCallback=function(b,d,f,g,i){var j={fields:"id,first_name,last_name,email,picture{url}",redirect:"false"};FB.api("/me","GET",j,function(a){if(!a||a.error)throw new Error("Error getting user info from Facebook SDK");k(b,a,d,f,g,i);});function k(b,d,f,g,i,j){var k=a.buildUserData();k.email=d.email;k.firstName=d.first_name;k.lastName=d.last_name;k.picture=d.picture.data.url;k.facebook={id:d.id};var f=f||HU.SSO.csfr;c(k.extra,{fbToken:b.accessToken,appId:g,csfr:f});c(k.extra,j);return h({url:a.logonUrl+'?appKey='+a.key+'&ping=1',timeout:10000}).then(function(b){a.csfr=b;k.extra.csfr=b;return e(a.logonUrl+'/facebook',k,i);});}};a.loginGoogle=function(c){a.__init();var d=window.gapi.auth2.init({client_id:a.googleId,cookiepolicy:"single_host_origin"});return d.signIn().then(undefined,function(a){if(console&&console.warn)console.warn('Can\'t connect to google auth2');g('HU.SSO.actionFail');throw a;}).then(function(a){b("send",{hitType:"event",eventCategory:"Login",eventAction:"click_login",eventLabel:"button_google"});if(window.hum)window.hum("event","button_google","click_login");var g=d.currentUser.get().getBasicProfile();var h=e(g.getName());var i=a.getAuthResponse().id_token;var j={email:g.getEmail(),firstName:h.first,lastName:h.last,password:undefined,picture:g.getImageUrl()};return f(i,j,c);});function e(a){var b=/(.*)\ \((.*)\)$/;if(a.search(b)>-1)a=a.match(b)[1];var c=a.trim().split(" ");return{last:c[c.length-1],first:c[0],all:c};}};a.__onload();function b(a,b){if(typeof ga==="function")ga(a,b);}function c(a,b){a=a||{};if(b&&Object.keys(b).length>0)for(var c=0;c<Object.keys(b).length;c+=1){var d=Object.keys(b)[c];a[d]=b[d];}return a;}a.buildUserData=function(){var b={};b.extra={appKey:a.key,csfr:a.csfr};b.locale=HU&&HU.env&&HU.env.l10n&&HU.env.l10n.locale?HU.env.l10n.locale:d();b.currency=HU&&HU.env&&HU.env.l10n&&HU.env.l10n.currency?HU.env.l10n.currency:"";b.timeZone=(new Date().getTimezoneOffset()/60)*-1;return b;};function d(){var a=undefined;if(Array.isArray(navigator.languages)&&navigator.languages.length>0)a=navigator.languages[0];else if(navigator.userLanguage)a=navigator.userLanguage;else a=navigator.language;return a;};function e(a,b,c){return h({method:'POST',responseType:'json',url:a,data:JSON.stringify(b),timeout:10000,withCredentials:true}).then(function(a){if(window.hum&&a.hul)window.hum("login",a.hul);return i(a.tokens).then(undefined,function(a){if(typeof a==='object'&&a.message==='Paths is empty')return;throw a;}).then(function(){if(c)window.location=c;else{if(console&&console.info)console.info('HU.SSO: User logged in');g('HU.SSO.userLoggedIn');};return a;});}).then(undefined,function(a){if(console&&console.warn)console.warn('Can\'t login the user');g('HU.SSO.userLogonError');throw a;});}function f(b,d,f){d=d||{};f=f||{};var g=a.buildUserData();c(g,d);c(g.extra,f);g.extra.gyToken=b;return h({url:a.logonUrl+'?appKey='+a.key+'&ping=1',timeout:10000}).then(function(b){a.csfr=b;g.extra.csfr=b;return e(a.logonUrl+'/googleYolo',g);});}function g(a,b){if(jQuery)jQuery(window).triggerHandler(a,b);}function h(a){return new Promise(function(b,c){a.method=a.method||'GET';var d=new XMLHttpRequest();var e=a.data;if(e&&typeof e==='object')e=JSON.stringify(e);if(a.responseType)d.responseType=a.responseType;if(a.withCredentials!==undefined)d.withCredentials=a.withCredentials;if(a.timeout!==undefined)d.timeout=a.timeout;if(a.headers)Object.keys(a.headers).forEach(function(b){d.setRequestHeader(b,a.headers[b]);});d.open(a.method,a.url);d.onload=function(){if(this.status>=200&&this.status<300)b(d.response);else c({status:this.status,response:d.response});};d.onerror=function(){c({status:this.status,response:d.response});};d.send(e);});}function i(a){return new Promise(function(b){if(!a)throw new Error("Paths is undefined");if(a.length===0)throw new Error("Paths is empty");var c=a.length;var d=0;a.map(function(a){var b=document.createElement('script');b.src=a;b.onload=function(){e();};document.head.appendChild(b);});function e(){d++;f();}function f(){if(d===c)b();}});}})(HU.SSO);