(window.webpackJsonp=window.webpackJsonp||[]).push([["dc38"],{"+Bzs":function(e,n,t){"use strict";t.r(n),t.d(n,"clearProcessedCache",(function(){return E})),t.d(n,"setRateLimit",(function(){return C})),t.d(n,"processImageTiming",(function(){return T})),t.d(n,"canProcessRecords",(function(){return I})),t.d(n,"useImagePerformanceMonitor",(function(){return q})),t.d(n,"default",(function(){return H}));var r=t("ilXw"),o=t.n(r),c=t("q1tI"),a=t("Ty5D"),i=t("GD2B"),u=t("g8Fj"),s=t("C8Bb"),d=t("HWzG"),l=t("h0Qv"),f=t("9Cyh"),b=t("hwnc"),g=t("6Kgu"),m=t("acAX"),v=t("GS5Z"),w=t("G1A3"),_=t("Sbik"),p=t("ODEy"),h=t("y8Vv"),y=t("ANar"),O=Object(b.a)("ImageServing:Performance"),j=new s.a,k=new s.a;function P(){var e,n,t,r,c,a,i="desktop";return Object(m.d)()?i="android":Object(m.h)()&&(i="ios"),["browser:".concat(Object(m.a)()),"os:".concat(i),"device_pixel_ratio:".concat(window.devicePixelRatio),"device_year_class:".concat(Object(f.a)()),"effective_connection_type:".concat(null!==(e=null===(n=navigator)||void 0===n||null===(t=n.connection)||void 0===t?void 0:t.effectiveType)&&void 0!==e?e:"Unknown"),"is_lowend_device:".concat(Object(f.b)()),"save_data:".concat(null!==(r=null===(c=navigator)||void 0===c||null===(a=c.connection)||void 0===a?void 0:a.saveData)&&void 0!==r?r:"Unknown"),"cdn_provider:".concat(o.a.get("wwwCdnProvider")||"unknown")]}var A=new Set;function E(e){(e||A.size>5e3)&&A.clear()}var S=.01;function C(e){S=e}function R(e,n){var t=e.duration,r=e.encodedBodySize,o=e.name,c=n.image_width_policy,a=n.is_cached,s=n.legacy_policy;!t||t<=0||!r||r<=0||u.a.logJitneyEvent({schema:i.a,event_data:{image_cache_type:a?1:0,image_size_bytes:r,image_download_time_ms:Math.floor(t),image_policy:null!=c?c:s,image_url:o}})}function T(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=e.encodedBodySize,o=e.name;if(A.has(o))return O((function(){return["Skipping duplicate resource from processing",e]})),[];A.add(o);var c=Object(w.a)(e);if(!c)return[];var a=c.image_resource_type,i=[].concat(babelHelpers.toConsumableArray(P()),babelHelpers.toConsumableArray(t),babelHelpers.toConsumableArray(Object(w.b)(c)));return Object(h.c)()&&Object(p.a)(c,n,e),Object(h.e)()?(Object(h.g)()?Object(h.h)()&&Math.random()<=.1||Math.random()<=S?(Object(y.a)("image-serving.image_request",1,i),R(e,c)):O((function(){return["Image Request has been rate limited, skipping"].concat(babelHelpers.toConsumableArray(i))})):(Object(y.a)("image-serving.image_request",1,i),R(e,c)),O((function(){return["Image Request Stats",o,c,e]})),"Unbound"===a&&r>=5e5&&(O((function(){return["Dangerously large ".concat(Math.round(r/1e3),"k unbound image detected, please investigate this!"),o,c]})),Object(h.i)()&&Object(y.a)("image-serving.unbound_image_request",1,[].concat(babelHelpers.toConsumableArray(i),["name:".concat(o),"page_href:".concat(location.href)]))),i):[]}var x=[3e3];function I(e){var n,t,r,c=null!=e?e:Object(v.a)(location.pathname);return!Object(h.f)()||"core-guest-loop"===(null!==(n=null===(t=o.a.get("layout-init"))||void 0===t||null===(r=t.tracking_context)||void 0===r?void 0:r.controller)&&void 0!==n?n:"core-guest-loop")&&x.includes(c)}function q(e){var n=e.initialResources,t=void 0===n?[]:n,r=e.pageName,a=Object(c.useRef)(Object(p.c)()).current,i=Object(l.a)(),u=Object(c.useContext)(g.a),s=Object(d.a)();Object(c.useEffect)((function(){if(I(r)){if(0!==t.length){O((function(){return["Processing ".concat(t.length,' pre-load entries for "').concat(r,'"')].concat(babelHelpers.toConsumableArray(t))})),j.clearPendingTasks();var e=(o.a.get("layout-init")||{}).tracking_context,n=(null==e?void 0:e.controller)||"core-guest-loop",c=["form_factor:".concat(i),"is_direct_request:".concat(u),"is_logged_in:".concat(s),"loop:".concat(n),"page_name:".concat(r)];t.forEach((function(e){k.pushTask((function(){T(e,a,c)}))})),t.length=0,j.pushTask((function(){Object(p.b)(a,[].concat(c,babelHelpers.toConsumableArray(P())))}))}}else O((function(){return'Not instrumenting as page: "'.concat(r,'" is not enabled.')}))}),[a,i,t,u,s,r]),Object(c.useEffect)((function(){if(Object(_.b)()){if(I(r)){O((function(){return'Initialized image performance monitor for page: "'.concat(r,'"')}));var e=new PerformanceObserver((function(e){j.clearPendingTasks();var n=(o.a.get("layout-init")||{}).tracking_context,t=(null==n?void 0:n.controller)||"core-guest-loop",c=["form_factor:".concat(i),"is_direct_request:".concat(u),"is_logged_in:".concat(s),"loop:".concat(t),"page_name:".concat(r)];e.getEntries().forEach((function(e){var n=e.initiatorType;"img"!==n&&"link"!==n||k.pushTask((function(){T(e,a,c)}))})),j.pushTask((function(){Object(p.b)(a,[].concat(c,babelHelpers.toConsumableArray(P())))}))}));try{PerformanceObserver.supportedEntryTypes.includes("resource")&&e.observe({type:"resource",buffered:!0})}catch(n){try{PerformanceObserver.supportedEntryTypes.includes("resource")&&e.observe({entryTypes:["resource"]})}catch(e){}}return function(){e.disconnect()}}O((function(){return"Skipping processing as it is disabled for this page"}))}else O((function(){return"PerformanceObserver is not supported"}))}),[a,i,u,s,r])}var z=!1;function H(e){var n=Object(a.i)(),t=Object(c.useState)(Object(v.a)(n.pathname)),r=babelHelpers.slicedToArray(t,2),o=r[0],i=r[1];return q(Object.assign({},e,{pageName:o})),Object(c.useEffect)((function(){E()}),[o]),Object(c.useEffect)((function(){var e=Object(v.a)(n.pathname);e!==o&&(Object(h.a)()&&Object(_.a)()&&performance.clearResourceTimings(),i(e))}),[n.pathname,o]),Object(c.useEffect)((function(){if(Object(_.b)()&&Object(h.a)()&&Object(_.a)()&&I(o))return performance.addEventListener("resourcetimingbufferfull",e),function(){performance.removeEventListener("resourcetimingbufferfull",e)};function e(){O((function(){return"Attempting to clear resource timings from buffer"})),performance.clearResourceTimings(),!z&&Object(h.b)()&&Object(_.c)()&&(z=!0,performance.setResourceTimingBufferSize(500))}}),[o]),null}},"6Kgu":function(e,n,t){"use strict";t.d(n,"a",(function(){return a})),t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return u}));var r=t("q1tI"),o=t.n(r),c=t("6aHl"),a=o.a.createContext(!0);function i(e){var n=e.children,t=Object(r.useState)(!0),i=babelHelpers.slicedToArray(t,2),u=i[0],s=i[1],d=Object(c.b)();return Object(r.useEffect)((function(){var e=d.listen((function(){s(!1),e()}));return e}),[d,u]),o.a.createElement(a.Provider,{value:u},n)}function u(e){return function(n){var t=Object(r.useContext)(a);return o.a.createElement(e,Object.assign({},n,{isDirectRequest:t}))}}},"9Cyh":function(e,n,t){"use strict";t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return b}));var r=t("acAX"),o="2009",c="2010",a="2011",i="2012",u="2013",s="2015",d="2016",l="2017";function f(){try{if(window.navigator&&window.navigator.deviceMemory&&window.navigator.hardwareConcurrency){var e=window.navigator.deviceMemory,n=window.navigator.hardwareConcurrency;return e<1?1===n?o:c:1===e?1===n?a:i:2===e||3===e?n<4?u:s:4===e&&n<=4?d:l}return Object(r.k)(window.navigator.userAgent)&&window.screen&&window.devicePixelRatio?window.screen.height/window.screen.width==896/414&&window.devicePixelRatio>=2||window.screen.height/window.screen.width==812/375&&window.devicePixelRatio>=2||window.screen.height/window.screen.width==736/414&&window.devicePixelRatio>=2||window.screen.height/window.screen.width==667/375&&2===window.devicePixelRatio?l:window.screen.height/window.screen.width==1.775&&2===window.devicePixelRatio?s:window.screen.height/window.screen.width==1.5&&2===window.devicePixelRatio?u:window.screen.height/window.screen.width==1.5&&1===window.devicePixelRatio?i:"Unknown":"Unknown"}catch(e){return}}function b(){var e=f();return!!(e&&Number(e)<=2016)}},G1A3:function(e,n,t){"use strict";t.d(n,"c",(function(){return o})),t.d(n,"d",(function(){return c})),t.d(n,"b",(function(){return a})),t.d(n,"a",(function(){return i}));var r=t("jUmh");function o(e){if(0===e)return"0_ms";if(e<100)return"under_100ms";var n=e/1e3;return n<1?"under_1s":n<5?"under_5s":n<30?"under_30s":"over_30s"}function c(e){if(void 0===e||0===e)return"unknown";var n=e/1e3;return n<5?"under_5k":n<30?"under_30k":n<80?"under_80k":n<150?"under_150k":n<500?"under_500k":"over_500k"}function a(e){return Object.keys(e).map((function(n){return"".concat(n,":").concat(e[n])}))}function i(e){var n=e.duration,t=e.encodedBodySize,a=e.initiatorType,i=e.name,u=e.requestStart,s=e.responseStart,d=e.responseEnd,l=e.transferSize,f=e.workerStart,b=Object(r.a)(i);if("Unknown"!==b){var g={duration:o(n),image_weight:c(t),image_resource_type:b,is_cached:0===l,is_preload:"link"===a,ttfb:o(s-u)};return"ImageManager"===b?g.image_width_policy=Object(r.b)(i):"LegacyAkamai"===b&&(g.legacy_policy=Object(r.c)(i)),f>0&&(g.worker_time=o(d-f)),g}}},GD2B:function(e,n,t){"use strict";t.d(n,"a",(function(){return r}));var r={defaultProps:{schema:"com.airbnb.jitney.event.logging.Performance:PerformanceImageDownloadEvent:2.0.0",event_name:"performance_image_download"},propTypes:{},fullyQualifiedName:"Performance.v2.PerformanceImageDownloadEvent"}},HWzG:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var r=t("q1tI"),o=t("qJkm"),c=t("JnFx"),a=t("yF3J"),i=t("gPVh"),u=t("s4rr");function s(){return!!o.a.isLoggedIn()}function d(){var e=Object(a.c)(),n=Object(r.useState)((function(){var n;return e&&null!==(n=Object(u.a)())&&void 0!==n?n:s()})),t=babelHelpers.slicedToArray(n,2),o=t[0],d=t[1],l=function(){return d(s())};return Object(r.useEffect)(l,[]),Object(c.a)(i.a,l),Object(c.a)(i.b,l),o}},JnFx:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t("q1tI"),o=t("wr5J");function c(e,n){var t=function(e){var n=Object(r.useRef)(e);return n.current=e,Object(r.useCallback)((function(){return n.current.apply(n,arguments)}),[])}(n);Object(r.useEffect)((function(){return o.default.on(e,t),function(){o.default.off(e,t)}}),[e,t])}},ODEy:function(e,n,t){"use strict";t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return d}));var r=t("hwnc"),o=t("ANar"),c=t("G1A3"),a=Object(r.a)("ImageServing:Performance");function i(){return{count:0,largest_image_size:"unknown",total_bytes:"unknown",total_duration:"unknown",state:{largest_image_in_bytes:0,total_bytes:0,total_duration:0}}}function u(e,n,t){var r=e.image_weight,o=t.duration,a=t.encodedBodySize;return n.count++,n.state.total_bytes+=null!=a?a:0,n.state.total_duration+=o,n.total_bytes=Object(c.d)(n.state.total_bytes),n.total_duration=Object(c.c)(n.state.total_duration),a>n.state.largest_image_in_bytes&&(n.largest_image_size=r),n}function s(e){return["count:".concat(e.count),"largest_image_size:".concat(e.largest_image_size),"total_bytes:".concat(e.total_bytes),"total_duration:".concat(e.total_duration)]}function d(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!(e.count<2)){var t=[].concat(babelHelpers.toConsumableArray(n),babelHelpers.toConsumableArray(s(e)));a((function(){return["Flushing Batch Image Request",JSON.parse(JSON.stringify(e))]})),Object(o.a)("image_serving.batch_image_request",1,t),Object.assign(e,{count:0,largest_image_size:"unknown",total_bytes:"unknown",total_duration:"unknown",state:{largest_image_in_bytes:0,total_bytes:0,total_duration:0}})}}},gPVh:function(e,n,t){"use strict";t.d(n,"a",(function(){return r})),t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return c})),t.d(n,"d",(function(){return a}));var r="login:complete",o="logout",c="userUtils:userNameUpdated",a="userUtils:userPhotoUpdated"},jUmh:function(e,n,t){"use strict";t.d(n,"c",(function(){return d})),t.d(n,"b",(function(){return l})),t.d(n,"a",(function(){return f}));var r=/(?:im_w|im_q)/,o=/aki_policy=/,c=/muscache\.com\/4ea\/air\/v2/,a=/im\/pictures\/user/,i=/muscache\.com\/pictures.+\/original\//,u=/muscache\.com\/pictures/;function s(e,n){if(e){var t=e.match(n);if(t)return t[1]}}function d(e){return s(e,/aki_policy=(\w+)/)}function l(e){return s(e,/im_w=(\w+)/)}function f(e){return r.test(e)?"ImageManager":o.test(e)&&!a.test(e)?"LegacyAkamai":c.test(e)?"Fourier":i.test(e)||u.test(e)?"Unbound":"Unknown"}},s4rr:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t("ilXw"),o=t.n(r);function c(){return o.a.get("isCdnSafeLoggedIn")}}}]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/image-performance-monitor-d91480ce.js.map