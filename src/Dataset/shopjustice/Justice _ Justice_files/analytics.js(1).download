(function(){function localStorageAvailable(){var test="test";try{localStorage.setItem(test,test);localStorage.removeItem(test);return true}catch(e){return false}}var synCookieStorage={getItem:function(sKey){if(!sKey){return null}var sValue=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;try{return JSON.parse(sValue)}catch(e){return sValue}},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!sKey||/^(?:expires|max\-age|path|domain|secure)$/i.test(sKey)){return false}var sExpires="";if(vEnd){switch(vEnd.constructor){case Number:sExpires=vEnd===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+vEnd;break;case String:sExpires="; expires="+vEnd;break;case Date:sExpires="; expires="+vEnd.toUTCString();break}}document.cookie=encodeURIComponent(sKey)+"="+encodeURIComponent(JSON.stringify(sValue))+sExpires+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"")+(bSecure?"; secure":"");return true},removeItem:function(sKey,sPath,sDomain){if(!this.hasItem(sKey)){return false}document.cookie=encodeURIComponent(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(sDomain?"; domain="+sDomain:"")+(sPath?"; path="+sPath:"");return true},hasItem:function(sKey){if(!sKey){return false}return new RegExp("(?:^|;\\s*)"+encodeURIComponent(sKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){var aKeys=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var nLen=aKeys.length,nIdx=0;nIdx<nLen;nIdx++){aKeys[nIdx]=decodeURIComponent(aKeys[nIdx])}return aKeys}};var synLocalStorage={getItem:function(sKey){if(!localStorageAvailable())return;var obj=localStorage.getItem(sKey);return obj===null?obj:JSON.parse(obj).val},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!localStorageAvailable())return false;var obj={};obj.val=sValue;obj.expires=vEnd;localStorage.setItem(sKey,JSON.stringify(obj))},removeItem:function(sKey,sPath,sDomain){if(!localStorageAvailable())return false;localStorage.removeItem(sKey)},hasItem:function(sKey){if(!localStorageAvailable())return false;return localStorage.getItem(sKey)===null},keys:function(){var aKeys=[];if(!localStorageAvailable())return aKeys;for(var key in localStorage){if(localStorage.hasOwnProperty(key)){aKeys.push(key)}}return aKeys}};var synSessionStorage={getItem:function(sKey){if(!localStorageAvailable())return;var obj=sessionStorage.getItem(sKey);return obj===null?obj:JSON.parse(obj).val},setItem:function(sKey,sValue,vEnd,sPath,sDomain,bSecure){if(!localStorageAvailable())return false;var obj={};obj.val=sValue;obj.expires=vEnd;sessionStorage.setItem(sKey,JSON.stringify(obj))},removeItem:function(sKey,sPath,sDomain){if(!localStorageAvailable())return false;sessionStorage.removeItem(sKey)},hasItem:function(sKey){if(!localStorageAvailable())return false;return sessionStorage.getItem(sKey)===null},keys:function(){var aKeys=[];if(!localStorageAvailable())return aKeys;for(var key in sessionStorage){if(sessionStorage.hasOwnProperty(key)){aKeys.push(key)}}return aKeys}};var pixel=function(src){if(!window[SyndecaAnalyticsObject].sent){if(window[SyndecaAnalyticsObject].debug)console.log("[SyndecaAnalytics].pixel created tracking pixel",src);var el=document.createElement("img");el.width=1;el.height=1;el.src=src;window[SyndecaAnalyticsObject].sent=true;return el}};var orderJsonToUrlParams=function(data){var params=[];params.add=function(k,v){this.push(k+"="+encodeURIComponent(v))};params.add("d",(new Date).getTime());if(data.hasOwnProperty("account")){params.add("a",data.account)}if(data.hasOwnProperty("guideKey")){params.add("g",data.guideKey)}if(data.hasOwnProperty("orderId")){params.add("o",data.orderId)}if(data.hasOwnProperty("total")){params.add("t",data.total)}if(data.hasOwnProperty("currency")){params.add("c",data.currency)}if(data.hasOwnProperty("userToken")){params.add("u",data.userToken)}if(data.hasOwnProperty("lastCatalogId")){params.add("cid",data.lastCatalogId)}if(data.hasOwnProperty("catalogs")){params.add("cs",data.catalogs)}var i;if(data.hasOwnProperty("items")){for(i=0;i<data.items.length;i++){if(data.items[i].hasOwnProperty("sku")){params.add("is"+i,data.items[i].sku)}if(data.items[i].hasOwnProperty("price")){params.add("ip"+i,data.items[i].price)}if(data.items[i].hasOwnProperty("quantity")){params.add("iq"+i,data.items[i].quantity)}}}if(data.hasOwnProperty("referredItems")){for(i=0;i<data.referredItems.length;i++){if(data.referredItems[i].hasOwnProperty("sku")){params.add("rs"+i,data.referredItems[i].sku)}if(data.referredItems[i].hasOwnProperty("price")){params.add("rp"+i,data.referredItems[i].price)}if(data.referredItems[i].hasOwnProperty("quantity")){params.add("rq"+i,data.referredItems[i].quantity)}}}return params.join("&")};var checkForReferral=function(){var pairs=window.location.search.toLowerCase().substring(1).split("&");var referral={};referral.items=[];for(var i=0;i<pairs.length;i++){var regex=/syn([gcupqs])(\d)?/;var matches=regex.exec(pairs[i]);if(matches){var pair=pairs[i].split("=");var index=matches[2]?matches[2]:0;if(referral.items[index]===undefined){referral.items[index]={}}switch(matches[1]){case"g":referral.guideKey=decodeURIComponent(pair[1]);break;case"c":referral.lastCatalogId=decodeURIComponent(pair[1]);break;case"u":referral.userToken=decodeURIComponent(pair[1]);break;case"s":referral.items[index].sku=decodeURIComponent(pair[1]);break;case"p":referral.items[index].price=decodeURIComponent(pair[1]);break;case"q":referral.items[index].quantity=decodeURIComponent(pair[1]);break}}}if(referral.userToken||referral.items.length){if(window[SyndecaAnalyticsObject].debug)console.log("[SyndecaAnalytics].checkForReferral",referral);window[SyndecaAnalyticsObject].storage.setItem("_synReferral",JSON.stringify(referral),window[SyndecaAnalyticsObject].expiration,"/")}};var checkForOrder=function(order){if(order===undefined&&window.hasOwnProperty("syndecaOrderDetails")){order=window.syndecaOrderDetails}if(order){if(window[SyndecaAnalyticsObject].debug)console.log("[SyndecaAnalytics].checkForOrder order=",order);order.account=window[SyndecaAnalyticsObject].account;var userToken=window[SyndecaAnalyticsObject].storage.getItem("_synUser");var guideKey=window[SyndecaAnalyticsObject].storage.getItem("_synGuide");var lastCatalogId=window[SyndecaAnalyticsObject].storage.getItem("_synCatalog");var catalogs=window[SyndecaAnalyticsObject].storage.getItem("_synCatalogs");if(catalogs&&catalogs instanceof Array){catalogs=catalogs.join()}var referralString=window[SyndecaAnalyticsObject].storage.getItem("_synReferral");var referral=JSON.parse(referralString);if(referral){if(!order.hasOwnProperty("referredItems")&&referral.hasOwnProperty("items")){order.referredItems=referral.items}if(!order.hasOwnProperty("userToken")&&referral.hasOwnProperty("userToken")){order.userToken=referral.userToken}if(!userToken&&referral.hasOwnProperty("userToken")){userToken=referral.userToken}if(!guideKey&&referral.hasOwnProperty("guideKey")){guideKey=referral.guideKey}if(!lastCatalogId&&referral.hasOwnProperty("lastCatalogId")){lastCatalogId=referral.lastCatalogId}}if(userToken){order.userToken=userToken}if(guideKey){order.guideKey=guideKey}if(lastCatalogId){order.lastCatalogId=lastCatalogId}if(catalogs){order.catalogs=catalogs}var params=orderJsonToUrlParams(order);pixel("//"+window[SyndecaAnalyticsObject].endpoint+"?"+params);window[SyndecaAnalyticsObject].storage.removeItem("_synReferral")}};var createAnalytics=function(account,options){window[SyndecaAnalyticsObject].account=account?account:0;options=options||{};var storage=options.hasOwnProperty("storage")?options.storage:"cookie";var expiration=options.hasOwnProperty("expiration")?options.expiration:604800;window[SyndecaAnalyticsObject].endpoint=options.hasOwnProperty("endpoint")?options.endpoint:"analytics.syndeca.com/v1/pixel.gif";window[SyndecaAnalyticsObject].sent=false;if(isNaN(parseInt(expiration,10))){expiration=expiration.toLowerCase()}switch(storage.toLowerCase()){case"localstorage":if(expiration==="session"){window[SyndecaAnalyticsObject].storage=synSessionStorage}else{window[SyndecaAnalyticsObject].storage=synLocalStorage}break;case"sessionstorage":expiration="session";window[SyndecaAnalyticsObject].storage=synSessionStorage;break;case"cookie":default:storage="cookie";window[SyndecaAnalyticsObject].storage=synCookieStorage;break}var expirationDate="";if(expiration==="session"){window[SyndecaAnalyticsObject].expiration="session"}else{var now=new Date;expirationDate=new Date(now.getTime()+expiration*1e3);window[SyndecaAnalyticsObject].expiration=expirationDate.toUTCString()}if(window[SyndecaAnalyticsObject].debug)console.log("[SyndecaAnalytics].createAnalytics(1.10) storage="+storage+" expiration="+expiration+" "+expirationDate)};try{window[SyndecaAnalyticsObject].debug=true;var queue=window[SyndecaAnalyticsObject].q;if(queue&&queue.length){for(var i=0;i<queue.length;i++){switch(queue[i][0]){case"debug":if(queue[i][1]){window[SyndecaAnalyticsObject].debug=true}break;case"create":createAnalytics(queue[i][1],queue[i][2]);checkForReferral(window.location.search);checkForOrder();break;case"trackOrder":checkForOrder(queue[i][1]);break}}}else{if(window[SyndecaAnalyticsObject].debug)console.log("[SyndecaAnalytics] command queue not detected")}}catch(e){if(window[SyndecaAnalyticsObject].debug)console.log(e)}})(window);
