!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=4)}({"/SWy":function(t,e,n){function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(n,!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=150,u="PageView",l="Purchase",h="TrackifyXRetarget",d="Products",p="Orders",g="Collections",f="ThankYou",v="Search",m="ZipifyPage",y="GemProductPage";function _(t){var e=null;return window.location.href.indexOf(t)>-1&&window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,i){e=i}),e}function k(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(n=c({path:"/",SameSite:"Strict"},n)).expires&&n.expires.toUTCString&&(n.expires=n.expires.toUTCString());var i=encodeURIComponent(t)+"="+encodeURIComponent(e);for(var o in n){i+="; "+o;var a=n[o];!0!==a&&(i+="="+a)}document.cookie=i}function w(t){var e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):null}function C(t){k(t,"",{"max-age":-1})}function S(t,e){for(var n=e.split("."),i=0,o=n.length;i<o;i++){if(!t||!t[n[i]])return!1;t=t[n[i]]}return!0}function E(t,e){for(var n=e.split("."),i=0,o=n.length;i<o;i++){if(!t||!t[n[i]])return null;t=t[n[i]]}return t}function b(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,i){var o=new XMLHttpRequest;o.open(e.method||"GET",t),e.headers&&Object.keys(e.headers).forEach(function(t){o.setRequestHeader(t,e.headers[t])}),o.onload=function(){o.status>=200&&o.status<300?n(o.response):i(o.statusText)},o.onerror=function(){return i(o.statusText)},o.send(e.body)})}function T(){var t=(new Date).toLocaleString("en-US",{timeZone:"America/New_York"}),e=new Date(t),n=e.toDateString().split(" "),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()];return n[1]+"_"+e.getDate()+"_"+e.getFullYear()+"_"+i+"_Hour_"+e.getHours()}function P(t){return"string"!=typeof t?"":t.charAt(0).toUpperCase()+t.slice(1)}function O(t,e,n){e.split(" ").forEach(function(e){return t.addEventListener(e,n,!1)})}function x(t,e,n){document.querySelector(t)||e<=0?n(document.querySelector(t)):window.setTimeout(function(){x(t,--e,n)},250)}var A=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.backendURL="https://trackifyx.redretarget.com",this.uniqueId="_"+Math.random().toString(36).substr(2,9),this.shopName=null,this.shopHost="",this.shop=null,this.isZipifyTagsCollectionsLoaded=!1,this.isLogingZipifyTagsCollections=!1,this.zipifyProductsTagsCollections=[],this.collections=[],this.tags=[],this.pixels=[],this.initializedPixels=[],this.page=null,this.product=null,this.cart=null,this.checkout=null,this.isTriggeredByState=!1,this.isLoadingProduct=!1,this.isAddingToCart=!1,this.isFetchingShop=!1,this.isFetchingCart=!1,this.user=this.saveEmptyUser(),this.maxAttemps=s,this.debug=!0,this.eventPrefix="",this.timeOnPage=0,this.reloadCartAttemps=5,this.timeOnSite=parseInt(localStorage.getItem("TFX_TIME_ON_SITE")||0),this.isLoaded=!1,this.productIds=[],this.isScriptInIframe=window.self!==window.top,this.interCartEvents=[],this.interCartEvent=null,this.triggerQueue(),this.triggerATCQueue(),this.consoleLog("USER",this.user)}var e,n,a;return e=t,(n=[{key:"reset",value:function(){this.tags=[],this.collections=[],this.page=null,this.product=null,this.maxAttemps=s}},{key:"init",value:function(){var t=this;this.isResourcesLoaded()?this.shop.enabled?this.setup():this.consoleLog("This shop is disabled"):(this.maxAttemps===s&&this.load(),setTimeout(function(){if(--t.maxAttemps<=0){var e=t.getFailMessage();t.consoleLog(e),t.consoleLog(t)}else t.load(),t.init()},30))}},{key:"load",value:function(){this.setUTMs(),this.user||this.getUserExternalId(),this.page||this.setPage(),this.shopName||this.setShopName(),"fbq"in window||this.loadPixelLibrary(),!this.shop&&this.shopName&&this.loadShopSettings(),this.product||this.loadProduct(),this.tags.length||this.loadTags(),this.collections.length||this.loadCollections(),this.cart||this.loadCart(),-1===[f,p].indexOf(this.page)||this.checkout||this.loadCheckout(),this.isTriggeredByState&&this.page===d&&this.setTagsCollections(window.location.pathname),this.page!==m||this.isZipifyTagsCollectionsLoaded||this.setZipifyTagsCollections(),"UpSellPage"===this.page&&this.getOCUProduct()}},{key:"getFailMessage",value:function(){var t=[];switch("fbq"in window||t.push("FB Pixel script is not loaded"),this.shop||t.push("Can not get shop info"),this.shopName||t.push("Can not get shop name"),this.page||t.push("Can not get page"),this.page){case y:case"PageFly":case d:this.product||t.push("Can not get product");break;case"Cart":this.cart||t.push("Can not get cart");break;case f:this.checkout||t.push("Can not get checkout")}return t.join("\n* ")}},{key:"isResourcesLoaded",value:function(){var t="fbq"in window&&this.shopName&&this.shop&&this.page,e=!0;switch(this.page){case y:case d:e=this.product;break;case"PageFly":e=this.product&&this.collections;break;case"Cart":e=this.cart;break;case f:e=this.checkout}return t&&e}},{key:"setup",value:function(){this.isLoaded?console.log("TFX already loaded"):(console.log("TFX ID: "+this.uniqueId),this.isLoaded=!0,this.setDebugMode(),this.setEventsPrefix(),this.consoleLog("Loaded",this),this.consoleLog(' Page is "'.concat(this.page,'"')),this.filterPixels()?(this.initPixels(),this.fireEvents(),this.isEventsAttached||this.attachListeners(),this.shop.time_on_site&&this.trackTime()):this.consoleLog("No Attached Pixels to current scenario"))}},{key:"setEventsPrefix",value:function(){S(window,"OCUConfig")&&(this.eventPrefix="OCU")}},{key:"setDebugMode",value:function(){this.debug=this.shop.debug}},{key:"consoleLog",value:function(){if(this&&this.debug){var t=[];t.push("TFX:");for(var e=0;e<arguments.length;e++)t.push(arguments[e]);console.log.apply(console,t)}}},{key:"setPage",value:function(){var t=window.location.href;t.includes("/collections")&&(this.page=g),t.includes("/products/")&&(this.page=d),t.includes("/cart")?this.page="Cart":((t.includes("/checkouts/")||t.includes("/secure-checkout/")&&E(window,"OCUConfig"))&&(this.page="Checkout"),t.includes("/s/checkout/")&&(this.page="Checkout"),(t.includes("/secure-checkout/offers/")||t.includes("/secure-chechout/offers"))&&(this.page="UpSellPage"),t.includes("/thank_you")&&(this.page=f),t.includes("/orders/")&&(this.page=p),t.includes("/secure-checkout/thank_you/")&&(this.page="OCUThankYou"),t.includes("/account/login")&&(this.page="Login"),t.includes("/account/register")&&(this.page="SignUp"),t.includes("/search")&&(this.page=v),S(window,"ZipifyPages")&&!t.includes("/products/")&&(this.page=m),"checkout_page"===E(window,"CHDataObject.partial_type")&&(this.page="CartHookCheckout"),"thank_you_page"===E(window,"CHDataObject.partial_type")&&(this.page="CartHookThankYou"),"upsell_page"===E(window,"CHDataObject.partial_type")&&(this.page="CartHookUpSellPage"),"downsell_page"===E(window,"CHDataObject.partial_type")&&(this.page="CartHookDownSellPage"),"page"===E(window,"CHDataObject.partial_type")&&(this.page="CartHookPage"),document.querySelector("body.gempage")&&t.includes("/pages/")&&(this.page=y),t.includes("/pages/")&&document.querySelector('link[href*="pagefly"]')&&(this.page="PageFly"),this.page||(this.page="Unknown"))}},{key:"loadPixelLibrary",value:function(){if("fbq"in window)return!0;var t,e,n,i,o,a;t=window,e=document,n="script",t.fbq||(i=t.fbq=function(){i.callMethod?i.callMethod.apply(i,arguments):i.queue.push(arguments)},t._fbq||(t._fbq=i),i.push=i,i.loaded=!0,i.version="2.0",i.queue=[],(o=e.createElement(n)).async=!0,o.src="https://connect.facebook.net/en_US/fbevents.js",(a=e.getElementsByTagName(n)[0]).parentNode.insertBefore(o,a))}},{key:"loadShopSettings",value:function(){var t=this;t.isFetchingShop||(t.isFetchingShop=!0,setTimeout(function(){t.isFetchingShop=!1},700),b("".concat(this.backendURL,"/pull/config/").concat(this.shopName)).then(function(e){t.shop=JSON.parse(e),t.isFetchingShop=!1}).catch(function(t){console.log("TFX",t)}))}},{key:"setShopName",value:function(){this.shopName=E(window,"Shopify.shop")||E(window,"Shopify.Checkout.apiHost")||E(window,"CHDataObject.store_urls.store_url"),window.getOrderRequestObject&&(this.shopName=window.getOrderRequestObject().shop)}},{key:"getUserExternalId",value:function(){"Shopify"in window&&this.setUser({external_id:S(window,"ShopifyAnalytics.lib.user")?window.ShopifyAnalytics.lib.user().traits().uniqToken:null})}},{key:"loadCheckout",value:function(){this.checkout=E(window,"Shopify.checkout")}},{key:"printTags",value:function(t){var e=t||this.tags||(localStorage.getItem("tags")||"").split(", ");return e&&e.length?(t||(this.tags=e),i(new Set(e.map(function(t){return"string"==typeof t?t.toString().trim():t}).filter(function(t){return""!==t.trim()}))).join(", ")):""}},{key:"printCollections",value:function(t){var e=t||this.collections||(localStorage.getItem("collections")||"").split(", ");return e&&e.length?(t||(this.collections=e),i(new Set(e.map(function(t){return"string"==typeof t?t.toString().trim():t}).filter(function(t){return""!==t.trim()}))).join(", ")):""}},{key:"clearArray",value:function(t){return t&&Array.isArray(t)?t.map(function(t){return t.trim()}).filter(function(t){return t.length>0}):[]}},{key:"loadTags",value:function(){var t=document.querySelector('meta[name="tfx:tags"]');t?(this.tags=this.clearArray(t.content.split(", ")),localStorage.setItem("tags",this.tags.join(", "))):-1===[d,g,y,v,m].indexOf(this.page)&&(this.tags=(localStorage.getItem("tags")||"").split(", "))}},{key:"loadCollections",value:function(){var t=document.querySelector('meta[name="tfx:collections"]');if(t)this.collections=t.content.split(", ").map(function(t){return t.trim()}).filter(function(t){return t.length>0}),localStorage.setItem("collections",this.collections.join(", "));else{var e=localStorage.getItem("collections")||"";this.collections=e.split(", ")}}},{key:"extractTagsCollections",value:function(t){var e={tags:[],collections:[]},n=/<meta name="tfx:tags" content="(.*?)">/g.exec(t),i=/<meta name="tfx:collections" content="(.*?)">/g.exec(t);return n&&(e.tags=n[1].split(", ").map(function(t){return t.trim()}).filter(function(t){return t.length>0})),i&&(e.collections=i[1].split(", ").map(function(t){return t.trim()}).filter(function(t){return t.length>0})),e}},{key:"setTagsCollections",value:function(t){var e=this;this.getTagsCollections(t).then(function(t){var n=e.extractTagsCollections(t);e.tags=n.tags,localStorage.setItem("tags",e.clearArray(e.tags).join(", ")),e.collections=n.collections,localStorage.setItem("collections",e.clearArray(e.collections).join(", "))}).catch(this.consoleLog)}},{key:"getTagsCollections",value:function(t){return b(t)}},{key:"setTagsAndCollectionsFromBackend",value:function(t){var e=this,n=this;return t?new Promise(function(o,a){b("".concat(e.backendURL,"/get/").concat(e.shopName,"/products?ids=")+t.join(",")).then(function(t){var c=JSON.parse(t);if(c.products&&c.products.length){var r=c.products.map(function(t){return new Promise(function(i,o){e.getTagsCollections("".concat(e.shopHost,"/products/").concat(t.handle)).then(function(o){var a=e.extractTagsCollections(o);n.collections=n.collections.concat(a.collections),n.tags=n.tags.concat(a.tags),i({product_id:t.id,html:o})}).catch(function(t){o(t)})})});Promise.all(r).then(function(){n.tags=i(new Set(n.tags)),n.collections=i(new Set(n.collections)),n.filterPixels(),n.initPixels(),o()}).catch(function(t){o(t)})}else a("No products fetched...")}).catch(a)}):new Promise(function(t){return t()})}},{key:"getProduct",value:function(t){if(t)return b(t.endsWith("/")?t.slice(0,-1):t+".json")}},{key:"getProductById",value:function(t){if(t)return b("".concat(this.backendURL,"/get/").concat(this.shopName,"/products?ids=").concat(t))}},{key:"loadProduct",value:function(){var t=this;if(!this.isLoadingProduct){var e=window.tfxProduct||null;if(e)this.product=e;else{if("PageFly"===this.page){if(!this.shop)return null;if(window.__pageflyProducts)for(var n in window.__pageflyProducts)window.__pageflyProducts.hasOwnProperty(n)&&n&&(this.product=c({},window.__pageflyProducts[n].selected_or_first_available_variant),this.shop.report_variants||(this.product.id=parseInt(n)),this.tags=window.__pageflyProducts[n].tags,this.setTagsCollections("/products/".concat(window.__pageflyProducts[n].handle)))}var i=document.querySelectorAll("form[action='/cart/add']");if(1===i.length){var o=i[0],a=o.querySelector('input[name="id"]'),r=o.getAttribute("id");this.consoleLog("Product Form detected, product id is ".concat(r)),a&&a.getAttribute("data-productid")&&(r=a.getAttribute("data-productid")),r&&(r=(r=(r=(r=r.replace("product_form_","")).replace("product-form-","")).replace("product-template","")).replace("AddToCartForm--",""),this.consoleLog("Cleared Product ID is: ".concat(parseInt(r))),parseInt(r)&&(this.isLoadingProduct=!0,this.getProductById(r).then(function(e){var n=JSON.parse(e);n.products&&n.products.length&&(t.product=n.products[0],t.setTagsCollections("/products/".concat(t.product.handle))),t.isLoadingProduct=!1}).catch(function(e){t.isLoadingProduct=!1,t.consoleLog("loadProduct",e)})))}}}}},{key:"setCart",value:function(t){if(t){for(var e in this.cart||(this.cart={}),t)t.hasOwnProperty(e)&&(this.cart[e]=t[e]);localStorage.setItem("TFX_CART",JSON.stringify(this.cart))}}},{key:"setCartFromStorage",value:function(){var t=null;if(!localStorage.getItem("TFX_CART"))return t;try{this.cart=JSON.parse(localStorage.getItem("TFX_CART")),this.consoleLog("Set cart from storage",this.cart),t=!0}catch(t){console.log(t)}return t}},{key:"addToCart",value:function(t){if(t)try{var e=JSON.parse(localStorage.getItem("TFX_CART"));e||(e={items:[]},localStorage.setItem("TFX_CART",JSON.stringify(e)));var n=this.getVariant(t);n.line_price=this.shop.value_reporting?this.calculatePrice(n.price):"0.00",n.quantity=document.getElementsByName("quantity")[0]?document.getElementsByName("quantity")[0].value:1,n.product_type=t.product_type,e.items.find(function(t){return t.id===n.id})||(e.items.push(n),localStorage.setItem("TFX_CART",JSON.stringify(e))),this.cart=e}catch(t){this.consoleLog(t)}}},{key:"reloadCart",value:function(){var t=this;if(console.log("RELOADING"),!this.isFetchingCart&&0!==this.reloadCartAttemps){this.isFetchingCart=!0;var e=E(this.cart,"item_count");b("".concat(this.shopHost,"/cart.json")).then(function(n){var i=JSON.parse(n);t.isFetchingCart=!1,i&&(console.log("data.items.length",e),i.item_count===e?(t.reloadCartAttemps--,setTimeout(function(){t.reloadCart()},500)):(t.cart=i,localStorage.setItem("TFX_CART",JSON.stringify(i))))}).catch(function(e){console.log(e),t.isFetchingCart=!1})}}},{key:"loadCart",value:function(){var t=this;if(!this.isFetchingCart){this.isFetchingCart=!0;var e=window.tfxCart||null;e?(this.cart=e,localStorage.setItem("TFX_CART",JSON.stringify(e)),this.isFetchingCart=!1):this.setCartFromStorage()?this.isFetchingCart=!1:b("".concat(this.shopHost,"/cart.json")).then(function(e){var n=JSON.parse(e);t.isFetchingCart=!1,n&&(t.cart=n,localStorage.setItem("TFX_CART",JSON.stringify(n)))}).catch(function(e){console.log(e),t.isFetchingCart=!1})}}},{key:"saveCartProduct",value:function(t){if(t)try{var e=JSON.parse(w("TFX_ATC"));e.push(t),k("TFX_ATC",JSON.stringify(i(new Set(e))),{"max-age":1209600})}catch(e){k("TFX_ATC",JSON.stringify([t]),{"max-age":600})}}},{key:"getSavedCartProducts",value:function(){var t=[];try{t=JSON.parse(w("TFX_ATC"))}catch(t){this.consoleLog(t)}return t||[]}},{key:"setAdvanceMatchingData",value:function(){this.page!==f&&this.page!==p||this.setUser({em:E(window,"Shopify.checkout.email"),fn:E(window,"Shopify.checkout.shipping_address.first_name"),ln:E(window,"Shopify.checkout.shipping_address.last_name"),ct:E(window,"Shopify.checkout.shipping_address.city"),zp:E(window,"Shopify.checkout.shipping_address.zip"),ph:S(window,"Shopify.checkout.shipping_address.phone")?E(window,"Shopify.checkout.shipping_address.phone").replace(/[^0-9]/g,""):null})}},{key:"getAdvanceMatchingData",value:function(){if(this.setAdvanceMatchingData(),!this.shop.advance_matching)return{};var t=this.getUser(),e={};for(var n in t)t.hasOwnProperty(n)&&t[n]&&"".concat(t[n]).trim()&&(e[n]=t[n]);return e}},{key:"filterPixels",value:function(){var t=this;return t.consoleLog("Tags: ".concat(t.tags)),t.consoleLog("Collections: ".concat(t.collections)),t.pixels=t.shop.pixels.filter(function(e){var n=e.context?e.context.filter(function(e){return-1!==t.tags.indexOf(e.trim())}):[],i=e.context?e.context.filter(function(e){return-1!==t.collections.indexOf(e.trim())}):[];return t.consoleLog("".concat(e.pixel_id," - Matched Tags ").concat(n.join(", "),", Matched Collections ").concat(i.join(", "))),"master"===e.type||"tag"===e.type&&n.length||"collection"===e.type&&i.length}),t.pixels.length}},{key:"initPixels",value:function(){var t=this,e=t.getAdvanceMatchingData();t.pixels.forEach(function(n){"geo"===t.shop.ccpa&&fbq("dataProcessingOptions",["LDU"],0,0),"disabled"===t.shop.ccpa&&fbq("dataProcessingOptions",[]),t.shop.microdata||fbq("set","autoConfig","false",n.pixel_id),-1===t.initializedPixels.indexOf(n.pixel_id)&&(fbq("init",n.pixel_id,e),t.initializedPixels.push(n.pixel_id),t.consoleLog(" Init Pixel: ".concat(n.pixel_id,", Type: ").concat(n.type)),t.shop.shopify_pixel&&t.pageViewEvent(n.pixel_id))})}},{key:"saveEmptyUser",value:function(){var t=S(window,"ShopifyAnalytics.lib.user")?window.ShopifyAnalytics.lib.user().traits().uniqToken:"",e={fbc:w("_fbc"),fbp:w("_fbp"),em:"",fn:"",ln:"",ph:"",external_id:t,ge:"",db:"",ct:"",st:"",zp:"",cn:"",la:""};try{var n=localStorage.getItem("TFX_USER_DATA"),i=JSON.parse(n);if(i)for(var o in i)i.hasOwnProperty(o)&&i[o].length&&(e[o]=i[o])}catch(t){this.consoleLog("ERROR ON PARSE USER DATA",t)}return localStorage.setItem("TFX_USER_DATA",JSON.stringify(e)),e}},{key:"getUser",value:function(){try{return JSON.parse(localStorage.getItem("TFX_USER_DATA"))||{}}catch(t){this.consoleLog("User Data Parse Error")}return{}}},{key:"setUser",value:function(t){if(t){var e=this.getUser();for(var n in t)t.hasOwnProperty(n)&&t[n]&&"".concat(t[n]).trim()&&(e[n]=t[n]);this.user=e,localStorage.setItem("TFX_USER_DATA",JSON.stringify(e)),this.consoleLog("User data is saved:",e)}}},{key:"setUTMs",value:function(){var t={},e=new URLSearchParams(window.location.search),n=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var r=a.value;r[0].startsWith("utm_")&&(t[r[0].replace("utm_","")]=r[1])}}catch(t){i=!0,o=t}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}Object.keys(t).length>0&&localStorage.setItem("TFX_UTM",JSON.stringify(t))}},{key:"getUTMs",value:function(){try{return JSON.parse(localStorage.getItem("TFX_UTM"))}catch(t){return this.consoleLog(" ERROR on parse utm tags"),{}}}},{key:"fireEvents",value:function(){switch(this.shop.shopify_pixel||this.pageViewEvent(),this.page){case"PageFly":case y:case d:this.viewContentEvent();break;case m:this.zipifyViewContentEvent();break;case g:this.viewCategoryEvent();break;case"Cart":this.triggerMissedAtcEvents(),this.viewCartEvent();break;case"Checkout":this.initiateCheckoutEvent(),this.ocuClearCookies();break;case p:this.shop.orders_purchase&&this.purchaseEvent(E(this.checkout,"line_items"));break;case f:this.purchaseEvent(E(this.checkout,"line_items"));break;case"OCUThankYou":this.ocuPurchaseEvent();break;case"UpSellPage":this.ocuViewContentEvent(),this.ocuPurchaseEvent();break;case"CartHookCheckout":this.cartHookInitiateCheckoutEvent();break;case"CartHookThankYou":this.cartHookPurchaseEvent(this.page);break;case"CartHookUpSellPage":case"CartHookDownSellPage":this.cartHookPurchaseEvent(this.page),this.cartHookViewContentEvent();break;case"CartHookPage":this.cartHookViewContentEvent();break;case v:this.searchEvent({q:_("q")})}}},{key:"attachListeners",value:function(){this.isEventsAttached=!0,this.listenSubmitsEvent(),this.listenModalOpenEvent(),this.listenFormChangeEvent(),this.listenDocumentClickEvent(),this.listenSpecialElements(10),this.listenElementsClickEvent(),this.listenTouchEvent(),this.listenPushStateEvent(),this.listenRequests(),this.listenBlurEvent(10)}},{key:"testRequest",value:function(t){return b("https://tfx-bizspice.ngrok.io/?event=".concat(t.event,"&data=").concat(JSON.stringify(t.data))).then().catch()}},{key:"fire",value:function(t,e,n,i,o){var a=n?"trackSingleCustom":"trackSingle",c=null;if(-1!==[l].indexOf(t)){var r=e.order_id||null;if(r){if(w("".concat(r)))return;b("".concat(this.backendURL,"/shop-orders/").concat(this.shopName,"?order_id=").concat(r),{method:"GET"}).then().catch(console.log),o||k("".concat(r),!0,{"max-age":2592e3}),c={eventID:"".concat(r)}}}e&&!this.shop.contents&&e.contents&&delete e.contents,i?fbq(a,i,t,e,c):this.pixels.forEach(function(n){return fbq(a,n.pixel_id,t,e,c)}),t===u&&(this.pageViewFired=!0),this.consoleLog('Fired : "'.concat(t,'" (').concat(a,") with data:"),e),-1===[u,h].indexOf(t)&&this.log(t,e)}},{key:"log",value:function(t,e){var n=this;if(this.shop.logging&&e){if(t===l){var o=e.content_name.toLowerCase();(o.includes("upsellpurchase")||o.includes("downsellpurchase"))&&(t="PurchUpDown"),o.includes("initial")&&(t="PurchInitial")}var a=[];this.tags&&this.tags.length&&(a=i(new Set(this.tags.map(function(t){return"string"==typeof t?t.toString().trim():t}).filter(function(t){return""!==t.trim()}))));var c=[];this.collections&&this.collections.length&&(c=i(new Set(this.collections.map(function(t){return"string"==typeof t?t.toString().trim():t}).filter(function(t){return""!==t.trim()}))));var r,s,u={ev:t,evId:e.order_id||null,si:this.shop.shop_id,us:this.getUser(),cr:this.shop.currency,px:this.pixels.map(function(t){return t.pixel_id}),cx:{tags:a.splice(0,50),collections:c.splice(0,50)},vl:E(e,"value")||0,pr:this.productIds,ds:E(e,"discount")||0,ut:this.getUTMs()||{},url:"".concat(window.location.origin).concat(window.location.pathname),device:(s={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}],init:function(){var t=this.header.join(" ");return{os:this.matchItem(t,this.dataos),browser:this.matchItem(t,this.databrowser)}},matchItem:function(t,e){var n,i,o,a=0,c=0;for(a=0;a<e.length;a+=1)if(new RegExp(e[a].value,"i").test(t)){if(n=new RegExp(e[a].version+"[- /:;]([\\d._]+)","i"),o="",(i=t.match(n))&&i[1]&&(i=i[1]),i)for(i=i.split(/[._]+/),c=0;c<i.length;c+=1)o+=0===c?i[c]+".":i[c];else o="0";return{name:e[a].name,version:parseFloat(o)}}return{name:"unknown",version:0}}}.init(),{osName:s.os?s.os.name:"unknown",osVersion:s.os?s.os.version:"unknown",browserName:s.browser?s.browser.name:"unknown",browserVersion:s.browser?s.browser.version:"unknown",navigatorUserAgent:navigator.version||"unknown",isMobile:(r=navigator.userAgent||navigator.vendor||window.opera,/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))?1:0)}),problems:this.getProblems(t),content_name:e.content_name,dirtyTags:this.tags};this.queueLog(u),b("".concat(this.backendURL,"/log"),{method:"POST",body:JSON.stringify(u)}).then(function(t){n.consoleLog("LOGGED data",u,"Response",t),n.removeFromLogQueue(u)}).catch(function(t){console.log("TFX:",t)})}}},{key:"getProblems",value:function(t){var e=null;if(t===l&&!this.tags.length){var n=document.querySelector('meta[name="tfx:tags"]');n&&(this.tags=n.content);var i=1;try{localStorage.setItem("test","test"),localStorage.removeItem("test"),i=1}catch(t){i=t.message}e={liquidTags:document.querySelector('meta[name="tfx:tags"]')?document.querySelector('meta[name="tfx:tags"]').content:null,page:this.page,isLocalStorageWorking:i}}return e}},{key:"removeFromLogQueue",value:function(t){var e=null;try{e=(e=JSON.parse(localStorage.getItem("TFX_LOG_QUEUE"))).splice(1,e.indexOf(t)),localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify(e))}catch(e){console.log(e),localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify([t]))}}},{key:"queueLog",value:function(t){var e=null;try{(e=JSON.parse(localStorage.getItem("TFX_LOG_QUEUE"))).push(t),localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify(e))}catch(e){localStorage.setItem("TFX_LOG_QUEUE",JSON.stringify([t]))}}},{key:"deleteATCqueue",value:function(t){if(t){var e=null;try{(e=JSON.parse(localStorage.getItem("TFX_QUEUE_ATC"))).splice(e.indexOf(t),1),localStorage.setItem("TFX_QUEUE_ATC",JSON.stringify(i(new Set(e))))}catch(t){console.log(t)}}}},{key:"queueATC",value:function(t){if(t){var e=null;try{(e=JSON.parse(localStorage.getItem("TFX_QUEUE_ATC"))).push(t),localStorage.setItem("TFX_QUEUE_ATC",JSON.stringify(i(new Set(e))))}catch(e){localStorage.setItem("TFX_QUEUE_ATC",JSON.stringify([t]))}}}},{key:"triggerMissedAtcEvents",value:function(){var t=this,e=this;if(this.cart&&this.cart.items){var n=this.getSavedCartProducts();this.cart.items.forEach(function(i){-1===n.indexOf(i.handle)&&(i.id=i.product_id,e.getTagsCollections(i.url).then(function(n){var o=t.extractTagsCollections(n),a=o.tags,c=o.collections,r=e.getProductData("AddToCart",i,a,c);e.fire("AddToCart",r),e.saveCartProduct(i.handle)}).catch(t.consoleLog))})}}},{key:"triggerATCQueue",value:function(){var t=this,e=this,n=null,i=this.getSavedCartProducts();try{(n=JSON.parse(localStorage.getItem("TFX_QUEUE_ATC"))).length&&n.forEach(function(n){-1===i.indexOf(n)?e.getProduct(n).then(function(i){try{var o=JSON.parse(i).product;e.getTagsCollections(n).then(function(i){var a=t.extractTagsCollections(i),c=a.tags,r=a.collections,s=e.getProductData("AddToCart",o,c,r);e.fire("AddToCart",s),e.deleteATCqueue(n)}).catch(t.consoleLog)}catch(t){console.log(t)}}):e.deleteATCqueue(n)})}catch(t){}}},{key:"triggerQueue",value:function(){var t=this,e=null;try{(e=JSON.parse(localStorage.getItem("TFX_LOG_QUEUE"))).length&&e.forEach(function(e){b("".concat(t.backendURL,"/log"),{method:"POST",body:JSON.stringify(c({},e,{isTriggeredFromQueue:1}))}).then(function(n){t.removeFromLogQueue(e)}).catch(function(t){console.log("TFX:",t)})})}catch(t){}}},{key:"trackTime",value:function(){var t=this;setInterval(function(){t.timeOnPage+=5,t.timeOnSite+=5,localStorage.setItem("TFX_TIME_ON_SITE",t.timeOnSite),t.timerEvent()},5e3)}},{key:"calculatePrice",value:function(t,e){if(!t)return 0;var n=e||-1!==t.toString().indexOf(".")?t:t/100;return parseFloat(n/100*this.shop.reporting_percentage).toFixed(2)}},{key:"getVariant",value:function(t){var e=null,n=_("variant")||E(window,"ShopifyAnalytics.meta.selectedVariantId");if(n&&parseInt(n)){var i=E(window,"ShopifyAnalytics.meta.product.variants");if(i&&(e=i.find(function(t){return t.id===parseInt(n)})))return e}return this.consoleLog("V",e),!e&&t.variants&&t.variants.length&&(e=t.variants[0]),e||t}},{key:"getProductData",value:function(t,e,n,i){if(!e)return null;var o=this.getVariant(e);this.consoleLog("Selected Variant",o);var a=document.getElementsByName("quantity")[0]?document.getElementsByName("quantity")[0].value:1,c=this.shop.report_variants?o.id:e.id,r=E(window,"ShopifyAnalytics.meta.selectedVariantId");return this.productIds=[e.id],{content_name:"Trackify ".concat(this.eventPrefix," ").concat(t,": ").concat(this.printTags(n)),content_type:this.shop.report_variants&&e.variants.length?"product":"product_group",content_ids:this.shop.report_variants&&(parseInt(r)||o.id)||e.id,content_category:E(e,"product_type")||E(e,"type")||"",content_timedata:T(),content_collections:this.printCollections(i),value:this.shop.value_reporting?this.calculatePrice(o.price):"0.00",currency:E(window,"ShopifyAnalytics.meta.currency")||this.shop.currency||"USD",contents:[{id:c,name:e.title,quantity:a}]}}},{key:"getCartProductsData",value:function(t,e){var n=this;if(!this.cart)return null;var o=this,a=e||!1;return this.productIds=this.cart.items.map(function(t){return t.product_id||t.id}),{content_name:"Trackify ".concat(this.eventPrefix," ").concat(t," : ").concat(this.printTags()),content_type:this.shop.report_variants?"product":"product_group",content_ids:this.cart.items.map(function(t){return o.shop.report_variants?t.id:t.product_id||t.id}),content_category:i(new Set(this.cart.items.map(function(t){return t.product_type}))).join(", "),content_timedata:T(),content_collections:this.printCollections(),value:this.shop.value_reporting?this.calculatePrice(this.cart.original_total_price,a):"0.00",currency:E(window,"ShopifyAnalytics.meta.currency")||this.cart.currency||"USD",contents:this.cart.items.map(function(t){return{id:o.shop.report_variants?t.id:t.product_id||t.id,name:t.title,quantity:t.quantity,currency:E(window,"ShopifyAnalytics.meta.currency")||n.cart.currency||"USD",item_price:o.calculatePrice(t.line_price),item_category:t.product_type}}),discount:this.cart.total_discount||0,num_items:this.cart.items.length}}},{key:"getPurchaseData",value:function(t,e){if(!t)return this.consoleLog("No Items found for trigger purchase"),null;var n=this,o=null,a=[],c=[],r=[];return this.productIds=[],t.forEach(function(t){n.cart&&(o=n.cart.items.find(function(e){return e.variant_id===t.variant_id}))&&r.push(o.product_type),n.productIds.push(t.product_id||t.id),c.push(n.shop.report_variants&&t.variant_id?t.variant_id:t.product_id||t.id),a.push({id:n.shop.report_variants&&t.variant_id?t.variant_id:t.product_id||t.id,name:t.variant_title||t.title,quantity:t.quantity,item_price:n.calculatePrice(t.price,!0),item_category:o?o.product_type:""})}),{content_name:"Trackify ".concat(e||"Purchase"," : ").concat(this.printTags()),content_type:this.shop.report_variants?"product":"product_group",content_ids:c,content_category:i(new Set(r)).join(", "),content_timedata:T(),content_collections:this.printCollections(),value:this.calculatePrice(E(this,"checkout.total_price")||n.cart.original_total_price,!0),currency:E(window,"ShopifyAnalytics.meta.currency")||this.shop.currency||"USD",contents:a,num_items:(E(this,"checkout.line_items")||t||[]).length,discount:E(this,"checkout.discount")||0,order_id:E(this,"checkout.order_id")||E(this,"interCartEvent.additional.transaction_id")||E(window,"chData.order.order_id"),content_pmtmethod:E(this,"checkout.credit_card.brand")||"other"}}},{key:"getTimerData",value:function(){return{content_timeonpage:this.timeOnPage,content_timeonsite:this.timeOnSite,content_page:this.page}}},{key:"listenSpecialElements",value:function(t){var e=this,n=['button[type*="submit"]','input[type*="submit"]',"button.btn-addtocart",'button[type="button"][data-label="Add to Cart"]',"[id^=buttonapp]"].map(function(t){return'form[action="/cart/add"] '.concat(t,':not([style*="display:none"])')}).concat(['#mst-stiky-box button[name="add"]',"#copyAddtoCartMobile",'.buy-me-btn button[type="submit"]',".zpa-add-to-cart-btn.zp"]),i=document.querySelectorAll(n.join(","));i.length?i.forEach(function(t){O(t,"click mousedown touch",function(){if(e.page===m){var t=document.querySelector("form[data-zp-product-url]"),n=t.getAttribute("data-productid");t&&n&&e.zipifyAddToCartEvent({id:parseInt(n)})}else e.addToCartEvent(!0)})}):t>0&&setTimeout(function(){e.listenSpecialElements(--t)},400)}},{key:"listenRequests",value:function(){if("PageFly"!==this.page){var t,e,n=this;t=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,n){if(-1!==n.indexOf("ref=tfx"))return t.apply(this,arguments),!0;var o=this;o.addEventListener("readystatechange",function t(){4===o.readyState&&(i(o,e,n),o.removeEventListener("readyStateChange",t))}),t.apply(o,arguments)},e=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){var t=this;t.requestData=arguments[0],e.apply(t,arguments)}}function i(t,e,i){if("/cart/add.js"===i&&"POST"===e){var o=JSON.parse(t.response);n.consoleLog("XHR",i,o),window.productJSON?n.zipifyAddToCartEvent({id:o.id}):n.product?n.addToCartEvent():n.queueATC(o.handle)}}}},{key:"listenPushStateEvent",value:function(){var t=this;!function(t){var e=t.pushState;t.pushState=function(n){return"function"==typeof t.onpushstate&&t.onpushstate({state:n}),e.apply(t,arguments)}}(window.history),window.onpopstate=history.onpushstate=function(){setTimeout(function(){t.isTriggeredByState=!0,t.reset(),t.init()},250)}}},{key:"listenSubmitsEvent",value:function(){var t=this,e=this,n=window.location.href;document.addEventListener("submit",function(i){if((!document.activeElement||"update"!==document.activeElement.name)&&S(i,"target.action")){var o=E(i,"target.action"),a=null;try{a=Object.fromEntries(new FormData(i.target))}catch(i){console.log(i)}a&&t.setUser({em:a["checkout[email_or_phone]"]||a["checkout[email]"],ph:a["checkout[shipping_address_attributes][phone]"]||"",fn:a["checkout[shipping_address][first_name]"]||a["checkout[shipping_address_attributes][first_name]"],ln:a["checkout[shipping_address][last_name]"]||a["checkout[shipping_address_attributes][last_name]"],ct:a["checkout[shipping_address][city]"]||a["checkout[shipping_address_attributes][city]"],cn:a["checkout[shipping_address][country]"]||a["checkout[shipping_address_attributes][country]"],st:a["checkout[shipping_address][province]"],zp:a["checkout[shipping_address_attributes][zip]"]}),o.includes("/search")&&e.searchEvent(a),o.includes("/contact#contact_form")&&e.contactEvent(a),o.includes("/account")&&e.signUpEvent(a),o.includes("/account/login")&&e.loginEvent(a),o.includes("/cart/add")&&e.addToCartEvent(!0),!o.includes("/cart/add")&&(o.includes("/cart")||o.includes("/checkout")&&!n.includes("/thank_you")||"/checkout"===a.return_to)&&e.initiateCheckoutEvent(),o.includes("/cart/add")&&"/checkout"===a.return_to&&e.initiateCheckoutEvent(),"/cart"===i.target.getAttribute("data-zp-product-url")&&e.zipifyAddToCartEvent({id:i.target.getAttribute("data-productid")}),"contact_information"===E(window,"Shopify.Checkout.step")&&e.paymentLeadEvent(),"shipping_method"===E(window,"Shopify.Checkout.step")&&e.addShippingInfoEvent(),"payment_method"===E(window,"Shopify.Checkout.step")&&e.addPaymentInfoEvent(),("step_customer_information"===_("step")||E(window,"OCUConfig")&&Object.keys(a).includes("checkout[email]"))&&e.paymentLeadEvent(),"step_shipping_method"===_("step")&&e.addShippingInfoEvent(),"step_payment_method"===_("step")&&e.addPaymentInfoEvent()}})}},{key:"listenModalOpenEvent",value:function(){var t=this,e=this,n=null;document.addEventListener("click",function(i){i.stopPropagation();var o=!1;i.target.getAttribute("data-remodal-target")&&(o=!0,n=i.target.getAttribute("data-url")),"btn quick-shop"===i.target.classList.value&&(n=i.target.parentElement.parentElement.querySelector('a[href*="collections"]').href,o=!0),"quick_shop action_button"===i.target.classList.value&&i.target.closest("a")&&(n=i.target.closest("a").href,o=!0),o&&n&&e.getProduct(n).then(function(t){var n=JSON.parse(t);e.product=n.product,e.viewContentEvent()}).catch(function(e){return t.consoleLog("listenModalOpenEvent",e)})})}},{key:"listenTouchEvent",value:function(){var t=this;document.addEventListener("touchend",function(e){var n=e.target.closest("input");n&&"submit"===n.type&&n.closest("form")&&n.closest("form").action.includes("/checkout")&&t.initiateCheckoutEvent()})}},{key:"listenDocumentClickEvent",value:function(){var t=this;document.addEventListener("click",function(e){if(e.stopPropagation(),S(e,"target")){"bookmarkit"===e.target.id&&t.addToWishListEvent(),e.target.closest("form")&&e.target.closest("form").action.includes("/cart/add")&&(e.target.closest("button")&&e.target.closest("button").classList.value.includes("action_button add_to_cart")&&t.addToCartEvent(!0),e.target.closest("button")&&(e.target.closest("button").classList.value.includes("shopify_add_to_cart")||e.target.closest("button").classList.value.includes("so-btn-add-to-cart"))&&t.addToCartEvent(!0),e.target.closest("button")&&e.target.closest("button").classList.value.includes("ProductForm__AddToCart")&&t.addToCartEvent(!0),e.target.closest("button")&&"buttonapp"===e.target.closest("button").id&&t.addToCartEvent(!0),e.target.closest("button")&&e.target.closest("button").getAttribute("data-cart-url")&&t.addToCartEvent(!0));var n=e.target.closest("button");n&&n.classList.value.includes("Cart__Checkout")&&t.initiateCheckoutEvent();var i=e.target.closest("a");i&&i.href.includes("/checkout")&&!i.href.includes("a/secure/checkout")&&t.initiateCheckoutEvent();var o=e.target.closest("button");o&&o.classList.value.includes("checkout-button")&&t.initiateCheckoutEvent();var a=e.target.closest("button");a&&a.classList.value.includes("shopify-payment-button__button")&&t.initiateCheckoutEvent()}})}},{key:"listenElementsClickEvent",value:function(){var t=this;document.querySelector("ch-button button")&&document.querySelector("ch-button button").addEventListener("click",function(e){t.cartHookAddPaymentInfoEvent()}),x(".product-form__add-button",5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0)})}),x('button[data-action="add-to-cart"]',5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0)})}),setTimeout(function(){i(document.querySelectorAll("span")).filter(function(t){return t.innerHTML.trim().toLowerCase().includes("shoppay")}).forEach(function(e){var n=e.closest("div[role=button]");n&&O(n,"click mousedown touch",function(){t.initiateCheckoutEvent()})})},1e3),x(".checkout-button.button",5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),x("form[action='/cart'] [name='checkout']",5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),x('a[href="/checkout"]',5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),x("button[data-opc-dyn-c-btn-id]",5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent()})}),x(".hs-checkout-purchase",5,function(e){e&&O(e,"click mousedown touch",function(){console.log("TFX Fired Event"),t.initiateCheckoutEvent()})}),x('button[name="buy"]',5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent()})}),x("button[data-testid]",5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent()})}),x('input[value="Check out"]',5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0),t.initiateCheckoutEvent()})}),x('.cart_container button[type="submit"].action_button.add_to_cart',5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0)})}),x('button[name="add"].action_button.add_to_cart',5,function(e){e&&O(e,"click mousedown touch",function(){t.addToCartEvent(!0)})}),x('button[type="submit"].Cart__Checkout',5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),x('button[name="checkout"].checkout_btn',5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),x(".grid__item .right.Checkout",5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})}),x(".actions button.btn[onclick]",5,function(e){e&&O(e,"click mousedown touch",function(){t.initiateCheckoutEvent()})})}},{key:"listenFormChangeEvent",value:function(){var t=this;document.addEventListener("change",function(e){if(e.target.closest("form"))try{var n=Object.fromEntries(new FormData(e.target.closest("form"))),i=E(e,"target.form.action");(i.includes("/cart/add")||i.includes("/secure-checkout/offers/"))&&t.customizeProductEvent(n)}catch(e){console.log(e)}})}},{key:"listenBlurEvent",value:function(t){var e=this,n=this,i=document.querySelectorAll(['customer-fieldset input[name="email"]'].join(","));i.length?i.forEach(function(t){t.addEventListener("blur",function(t){n.paymentLeadEvent(),n.setUser({em:t.target.value})})}):t>0&&setTimeout(function(){e.listenBlurEvent(--t)},400)}},{key:"pageViewEvent",value:function(t){this.fire(u,null,!1,t)}},{key:"viewCategoryEvent",value:function(){var t=this.collections.join(","),e={content_name:"Collection [ ".concat(t," ]")};this.fire("ViewCategory",e,!0)}},{key:"viewContentEvent",value:function(t){var e=t||"ViewContent";this.product&&this.fire("ViewContent",this.getProductData(e,this.product))}},{key:"customizeProductEvent",value:function(){var t=this.getProductData("CustomizeProduct",this.product);this.fire("CustomizeProduct",t)}},{key:"addToCartEvent",value:function(t){var e=this;if((!t||this.shop.atc_click)&&!this.isAddingToCart)if(this.isAddingToCart=!0,this.product){var n=this.getProductData("AddToCart",this.product);this.fire("AddToCart",n),this.addToCart(this.product),this.saveCartProduct(this.product.handle),setTimeout(function(){e.isAddingToCart=!1,e.reloadCart(),e.setTagsCollections("/cart")},1e3)}else this.isAddingToCart=!1}},{key:"viewCartEvent",value:function(){var t=this.getCartProductsData("ViewCart");this.fire("ViewCart",t,!0)}},{key:"initiateCheckoutEvent",value:function(t){w("TFX_IC")||(k("TFX_IC",!0,{"max-age":600}),this.fire("InitiateCheckout",this.getCartProductsData("InitiateCheckout",t)))}},{key:"paymentLeadEvent",value:function(){w("TFX_LEAD")||(k("TFX_LEAD",!0,{"max-age":200}),this.fire("Lead",this.getCartProductsData("Lead")))}},{key:"addShippingInfoEvent",value:function(){var t=this.getCartProductsData("AddShippingInfo");this.fire("AddShippingInfo",t,!0)}},{key:"addPaymentInfoEvent",value:function(){var t=this.getCartProductsData("AddPaymentInfo");this.fire("AddPaymentInfo",t,!0)}},{key:"purchaseEvent",value:function(t,e){var n=this,i=null;this.clearArray(this.tags).length&&this.clearArray(this.collections).length||t&&(i=t.map(function(t){return t.product_id}).filter(function(t){return!!t})),this.setTagsAndCollectionsFromBackend(i).then(function(){var i=n.getPurchaseData(t,e);if((console.log("PURCHASE EVENT DATA",JSON.stringify(i)),n.checkout)&&Math.floor(((new Date).getTime()-new Date(n.checkout.updated_at).getTime())/1e3/60)>10)return void n.consoleLog("Event not triggered because order created at more then 10 minutes ago");n.fire(l,i),C("TFX_IC"),C("TFX_LEAD"),C("TFX_ATC")}).catch(console.log)}},{key:"addToWishListEvent",value:function(){var t=this.getProductData("ViewContent",this.product);this.fire("AddToWishlist",t)}},{key:"searchEvent",value:function(t){var e={currency:this.shop.currency,search_string:t.q,value:0};this.fire("Search",e)}},{key:"contactEvent",value:function(t){this.setUser({fn:t["contact[first_name]"],ln:t["contact[last_name]"],em:t["contact[email]"]}),this.fire("Contact",{})}},{key:"signUpEvent",value:function(t){this.setUser({fn:t["customer[first_name]"],ln:t["customer[last_name]"],em:t["customer[email]"]})}},{key:"loginEvent",value:function(t){this.setUser({em:t["customer[email]"]})}},{key:"timerEvent",value:function(){var t=this.getTimerData();this.fire(h,t,!0)}},{key:"setZipifyTagsCollections",value:function(){var t=this;if(!S(window,"productJSON"))return{};var e=this;this.collections=[],this.tags=[],this.isZipifyTagsCollectionsLoaded=!0,this.isLogingZipifyTagsCollections=!0,setTimeout(function(){t.isZipifyTagsCollectionsLoaded=!1},1200);var n=window.productJSON.map(function(e){return new Promise(function(n){t.getTagsCollections("/products/".concat(e.handle)).then(function(t){n({product_id:e.id,html:t})}).catch(t.consoleLog)})});Promise.all(n).then(function(n){n.forEach(function(n){var o=t.extractTagsCollections(n.html);t.collections=t.collections.concat(o.collections),t.tags=t.tags.concat(o.tags),e.tags=i(new Set(e.tags)),e.collections=i(new Set(e.collections)),e.shop&&(e.filterPixels(),e.initPixels()),t.zipifyProductsTagsCollections.push({product_id:n.product_id,tags:o.tags,collections:o.collections}),t.isLogingZipifyTagsCollections=!1})}).catch(function(e){t.consoleLog(e),t.isLogingZipifyTagsCollections=!1})}},{key:"getZipifyProductsData",value:function(){var t=this;if(!S(window,"productJSON"))return null;var e=window.productJSON;return{content_name:"Trackify PG ViewContent: ".concat(this.printTags()),content_type:this.shop.report_variants&&product.variants.length?"product":"product_group",content_ids:e.map(function(e){return t.shop.report_variants?t.getVariant(e).id:e.id}),content_category:i(new Set(e.map(function(t){return t.type}))).join(", "),content_timedata:T(),content_collections:this.printCollections(),value:this.shop.value_reporting?this.calculatePrice(e.reduce(function(t,e){return t+e.price},0)):0,currency:E(window,"ShopifyAnalytics.meta.currency")||this.cart.currency,contents:e.map(function(e){return{id:t.shop.report_variants?t.getVariant(e).id:e.id,name:e.title,quantity:1,item_price:t.calculatePrice(e.price),item_category:e.type}}),num_items:e.length}}},{key:"zipifyViewContentEvent",value:function(){var t=this;if(this.isLogingZipifyTagsCollections)setTimeout(function(){t.zipifyViewContentEvent()},500);else{var e=this.getZipifyProductsData();e&&!(E(window,"ZipifyPages.analytics.disabled_events.trackify")||[]).length&&this.fire("ViewContent",e)}}},{key:"zipifyAddToCartEvent",value:function(t){var e=this;if(S(window,"productJSON"))if(this.isLogingZipifyTagsCollections)setTimeout(function(){e.zipifyAddToCartEvent()},500);else{var n=window.productJSON.find(function(e){return e.id===parseInt(t.id)||e.variants.find(function(e){return e.id===parseInt(t.id)})});if(n){var i=this.zipifyProductsTagsCollections.find(function(t){return t.product_id===n.id});i&&(this.tags=i.tags,this.collections=i.collections),this.product=n,this.addToCartEvent()}}}},{key:"getOCUProduct",value:function(){this.product=E(window,"OCUConfig.product")}},{key:"getOcuPurchaseData",value:function(t,e){var n=this;if(!S(window,"OCUConfig.trackify.transactions"))return{};var o=this,a=[],c=[],r=[],s=0,u=[];return window.OCUConfig.trackify.transactions.forEach(function(t){e?-1!==["completed","bought","thank_you_page"].indexOf(t.status)&&t.items.length&&(u=u.concat(t.items),s+=parseFloat(t.total_amount)):("completed"===t.status&&t.items.length&&(u=t.items,s=t.total_amount),"bought"===t.status&&t.items.length&&(u=t.items,s=t.total_amount),"thank_you_page"===t.status&&t.items.length&&(u=t.items,s=t.total_amount))}),u.forEach(function(t){r.push(t.product.product_type),c.push(n.shop.report_variants?t.shopify_variant_id:t.shopify_product_id),a.push({id:o.shop.report_variants?t.shopify_variant_id:t.shopify_product_id,name:t.variant_title||t.title,quantity:t.quantity,currency:n.shop.currency,item_price:o.calculatePrice(t.price,!0),item_category:t.product?t.product.product_type:""})}),{content_name:"Trackify OCU ".concat(t,": ").concat(this.printTags()),content_type:this.shop.report_variants?"product":"product_group",content_ids:c,content_category:i(new Set(r)).join(", "),content_timedata:T(),content_collections:this.printCollections(),value:this.calculatePrice(s||0,!0),currency:this.shop.currency||"USD",contents:a,num_items:(window.OCUConfig.trackify.transactions[0].items||[]).length,discount:E(this,"checkout.discount.brand")||0,order_id:E(window,"OCUConfig.trackify.shopify_order_id"),content_pmtmethod:"OCU_".concat(E(window,"OCUConfig.trackify.payment_method")||"other")}}},{key:"getOcuPurchaseEventName",value:function(){var t=null,e=null;return window.OCUConfig.trackify.transactions.forEach(function(n){if("completed"!==n.status||w("TFX_OCU_".concat(n.name))||(e="TFX_OCU_".concat(n.name),t={name:"InitialPurchase",cookie:e,price:n.total_amount},k(e,!0,{"max-age":600})),"bought"===n.status&&!w("TFX_OCU_".concat(n.name))){e="TFX_OCU_".concat(n.name);t={name:"".concat(n.name.replace(/[a-zA-Z]/g,"")).concat(n.name.replace(/[0-9]/g,""),"Purchase"),cookie:e,price:n.total_amount};k(e,!0,{"max-age":600})}}),t}},{key:"ocuClearCookies",value:function(){document.cookie.split(";").map(function(t){return t.split("=")[0]}).filter(function(t){return t.includes("TFX_OCU_")}).forEach(function(t){C(t.trim())})}},{key:"ocuPurchaseEvent",value:function(){var t=this.getOcuPurchaseEventName();if(console.log(t),"OCUThankYou"===this.page){if(w("TFX_ORDER_OCU_".concat(E(window,"OCUConfig.trackify.shopify_order_id"))))return;if(k("TFX_ORDER_OCU_".concat(E(window,"OCUConfig.trackify.shopify_order_id")),1,{"max-age":600}),t){var e=this.getOcuPurchaseData(t.name);this.shop.ocu_ss_api?(this.fire(t.name.replace("TFX_OCU_",""),e,!0),e=this.getOcuPurchaseData(t.name,!0),this.fire(l,e)):this.fire(l,e,!1,null,!0)}}else{if(!t)return;var n=this.getOcuPurchaseData(t.name);this.shop.ocu_ss_api?this.fire(t.name.replace("TFX_OCU_",""),n,!0):this.fire(l,n)}C("TFX_IC"),C("TFX_LEAD")}},{key:"ocuViewContentEvent",value:function(){var t,e,n,i=window.OCUConfig.trackify.transactions.filter(function(t){return"declined"===t.status}).length,o=window.OCUConfig.trackify.transactions.filter(function(t){return-1!==["bought","offered"].indexOf(t.status)}).length,a="DownsellViewContent";i||(e=["zeroth","first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth","sixteenth","seventeenth","eighteenth","nineteenth"],n=["twent","thirt","fort","fift","sixt","sevent","eight","ninet"],a=((t=o)<20?P(e[t]):t%10==0?P(n[Math.floor(t/10)-2]+"ieth"):P(n[Math.floor(t/10)-2])+"y"+P(e[t%10]))+"UpsellViewContent"),this.viewContentEvent(a)}},{key:"getProductsFromBackend",value:function(t,e){var n=this,o=this;return new Promise(function(a,r){b("".concat(n.backendURL,"/get/").concat(n.shopName,"/products?ids=")+t.map(function(t){return t.id}).join(",")).then(function(s){var u=JSON.parse(s);if(u.products&&u.products.length){var l=u.products.map(function(e){var n=t.find(function(t){return t.id===e.id})||{};return c({},e,{},n)});o.setCart({items:l,original_total_price:e.original_total_price,currency:e.currency,total_discount:e.discount});var h=u.products.map(function(t){return new Promise(function(e,i){n.getTagsCollections("".concat(n.shopHost,"/products/").concat(t.handle)).then(function(i){var a=n.extractTagsCollections(i);o.collections=o.collections.concat(a.collections),o.tags=o.tags.concat(a.tags),e({product_id:t.id,html:i})}).catch(function(t){i(t)})})});Promise.all(h).then(function(){o.tags=i(new Set(o.tags)),o.collections=i(new Set(o.collections)),o.filterPixels(),o.initPixels(),a({items:l})}).catch(function(t){a({items:l})})}else r("No products fetched...")}).catch(r)})}},{key:"listenInterCartEvents",value:function(t){var e=this,n=this,i=[];this.consoleLog("Intercart",t),t.forEach(function(t){if(-1===n.interCartEvents.indexOf(t.type)){n.interCartEvents.push(t.type),n.interCartEvent=t;var o={original_total_price:E(t,"additional.total"),currency:E(t,"additional.currency"),total_discount:E(t,"additional.discount")};switch(S(t,"payload.content_ids")&&(i=E(t,"payload.content_ids").map(function(t){return{id:parseInt(t)}})),S(t,"additional.items")&&E(t,"additional.items").forEach(function(t,e){i[e]&&(i[e].quantity=parseInt(t.quantity)||1,i[e].line_price=t.price||0,i[e].price=t.price||0)}),t.type){case"initialize":n.shopName=E(t,"payload.shop"),n.shopHost=E(t,"payload.origin"),n.setUser({external_id:E(t,"payload.session_id")});break;case"InitiateCheckout":n.getProductsFromBackend(i,o).then(function(){n.initiateCheckoutEvent(!0)}).catch(console.log);break;case"AddPaymentInfo":e.setCart(o),e.addPaymentInfoEvent();break;case"Purchase":case"PostPurchase":n.getProductsFromBackend(i,o).then(function(e){n.purchaseEvent(e.items,t.type)}).catch(console.log)}}})}},{key:"cartHookAddPaymentInfoEvent",value:function(){if(S(window,"carthook_object.cart_data")){E(window,"carthook_object.cart_data");this.addPaymentInfoEvent()}}},{key:"cartHookInitiateCheckoutEvent",value:function(){var t=this;if(S(window,"carthook_object.cart_data")){var e=E(window,"carthook_object.cart_data"),n=e.line_items.map(function(t){return{id:parseInt(t.id),quantity:parseInt(t.quantity)||1,variant_id:parseInt(t.variant_id),line_price:t.line_price,price:t.line_price}}),i={original_total_price:e.total_price,currency:e.currency||"USD",total_discount:e.coupon};this.getProductsFromBackend(n,i).then(function(){t.initiateCheckoutEvent()}).catch(console.log)}}},{key:"getCartHookPurchaseEventName",value:function(){var t=E(window,"chData");return t?"checkout_page"===t.last_charged_page_type?"TFX_CH_InitialPurchase":"upsell_page"===t.last_charged_page_type?"TFX_CH_UpsellPurchase":"downsell_page"===t.last_charged_page_type?"TFX_CH_DownsellPurchase":void 0:""}},{key:"cartHookPurchaseEvent",value:function(t){if(E(window,"chData.last_charged_page_type")){var e=this,n=w("TFX_PURCHASED"),o=E(window,"chData.order"),a=this.getCartHookPurchaseEventName(),c=[];n&&(c=n.split(","));var r=o.last_charged_line_items.map(function(t){return{id:parseInt(t.id),quantity:parseInt(t.quantity)||1,variant_id:parseInt(t.variant_id),line_price:t.price,price:t.price}}).filter(function(e){return-1===c.indexOf("".concat(e.id,":").concat(t))});if(r.length){var s={original_total_price:c.length?r.reduce(function(t,e){return t+e.line_price*e.quantity},0):E(window,"chData.order.total_price"),currency:o.currency||"USD",total_discount:o.coupon};this.getProductsFromBackend(r,s).then(function(n){var o=n.items.map(function(e){return"".concat(e.id,":").concat(t)});k("TFX_PURCHASED",[].concat(i(c),i(o)).join(","),{"max-age":200}),e.purchaseEvent(n.items,a)}).catch(console.log)}else this.consoleLog("No Products, Check TFX_PURCHASED")}}},{key:"cartHookViewContentEvent",value:function(){var t=this,e=E(window,"carthook_object.product")||(E(window,"carthook_object.cart_data.line_items")||[])[0];e&&this.getTagsCollections("/products/".concat(e.handle)).then(function(n){var i=t.extractTagsCollections(n);t.getProduct("/products/".concat(e.handle)).then(function(n){t.tags=i.tags,t.collections=i.collections,localStorage.setItem("tags",t.tags.join(", ")),localStorage.setItem("collections",t.collections.join(", ")),t.product=JSON.parse(n).product,t.product.price=e.line_price,t.product.variants&&t.product.variants.length&&(t.product.variants[0].price=e.line_price),t.viewContentEvent()})}).catch(this.consoleLog)}},{key:"listenShopiPayEvents",value:function(t){switch(console.log("SHOPIPAY EVENT",JSON.stringify(t)),console.log("SHOPIPAY DATA LOADED",this.shop),t.type){case"Initialize":console.log("ShopiPay Init...");break;case"InitiateCheckout":this.shopiPayInitiateCheckoutEvent(t);break;case l:case"PostPurchase":this.shopiPayPurchaseEvent(t);break;case"ViewContent":this.shopiPayViewContentEvent(t)}}},{key:"shopiPayInitiateCheckoutEvent",value:function(t){var e=this,n=t.products.map(function(t){return{id:t.product_id}});this.getProductsFromBackend(n,this.cart).then(function(){e.initiateCheckoutEvent()}).catch(console.log)}},{key:"shopiPayPurchaseEvent",value:function(t){var e=[];t.products.forEach(function(t){t.product_id?e.push(t):t.id&&(t.product_id=t.id,e.push(t))}),t.upsellStep&&t.accept?this.purchaseEvent(e,"TFX_SHP_"+t.upsellStep+" Purchase"):this.purchaseEvent(e,"TFX_SHP_Initial Purchase")}},{key:"shopiPayViewContentEvent",value:function(t){var e=this;t.products.forEach(function(t){return e.fire("ViewContent",e.getProductData("ViewContent",t))})}}])&&o(e.prototype,n),a&&o(e,a),t}();window.trackify||(window.trackify=new A,window.trackify.init())},4:function(t,e,n){t.exports=n("/SWy")}});