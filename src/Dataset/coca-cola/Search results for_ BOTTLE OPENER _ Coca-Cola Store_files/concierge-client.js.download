/* Copyright 2014-2020 Â© Moxie Software. All Rights Reserved. Concierge Version: v1.24.2 */
!function(){"use strict";function e(e){return"function"==typeof e}var t,i,n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=0,o=function(e,t){m[r]=e,m[r+1]=t,2===(r+=2)&&(i?i(w):g())};var a="undefined"!=typeof window?window:void 0,s=a||{},c=s.MutationObserver||s.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(w,1)}}var g,h,f,p,v,m=new Array(1e3);function w(){for(var e=0;e<r;e+=2){(0,m[e])(m[e+1]),m[e]=void 0,m[e+1]=void 0}r=0}function y(e,t){var i=this,n=new this.constructor(C);void 0===n[S]&&M(n);var r=i._state;if(r){var a=arguments[r-1];o((function(){return x(r,n,a,i._result)}))}else T(i,n,e,t);return n}function b(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(C);return E(t,e),t}u?g=function(){return process.nextTick(w)}:c?(f=0,p=new c(w),v=document.createTextNode(""),p.observe(v,{characterData:!0}),g=function(){v.data=f=++f%2}):l?((h=new MessageChannel).port1.onmessage=w,g=function(){return h.port2.postMessage(0)}):g=void 0===a&&"function"==typeof require?function(){try{var e=Function("return this")().require("vertx");return void 0!==(t=e.runOnLoop||e.runOnContext)?function(){t(w)}:d()}catch(e){return d()}}():d();var S=Math.random().toString(36).substring(2);function C(){}function _(t,i,n){i.constructor===t.constructor&&n===y&&i.constructor.resolve===b?function(e,t){1===t._state?N(e,t._result):2===t._state?O(e,t._result):T(t,void 0,(function(t){return E(e,t)}),(function(t){return O(e,t)}))}(t,i):void 0===n?N(t,i):e(n)?function(e,t,i){o((function(e){var n=!1,r=function(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}(i,t,(function(i){n||(n=!0,t!==i?E(e,i):N(e,i))}),(function(t){n||(n=!0,O(e,t))}),e._label);!n&&r&&(n=!0,O(e,r))}),e)}(t,i,n):N(t,i)}function E(e,t){if(e===t)O(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(n=t),null===n||"object"!==r&&"function"!==r)N(e,t);else{var i;try{i=t.then}catch(t){return void O(e,t)}_(e,t,i)}var n,r}function I(e){e._onerror&&e._onerror(e._result),k(e)}function N(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&o(k,e))}function O(e,t){void 0===e._state&&(e._state=2,e._result=t,o(I,e))}function T(e,t,i,n){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+1]=i,r[a+2]=n,0===a&&e._state&&o(k,e)}function k(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n,r,o=e._result,a=0;a<t.length;a+=3)n=t[a],r=t[a+i],n?x(i,n,r,o):r(o);e._subscribers.length=0}}function x(t,i,n,r){var o,a,s=e(n),c=!0;if(s){try{o=n(r)}catch(e){c=!1,a=e}if(i===o)return void O(i,new TypeError("A promises callback cannot return that same promise."))}else o=r;void 0!==i._state||(s&&c?E(i,o):!1===c?O(i,a):1===t?N(i,o):2===t&&O(i,o))}var D=0;function M(e){e[S]=D++,e._state=void 0,e._result=void 0,e._subscribers=[]}var A=function(e,t){this._instanceConstructor=e,this.promise=new e(C),this.promise[S]||M(this.promise),n(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?N(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&N(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))};A.prototype._enumerate=function(e){for(var t=0;void 0===this._state&&t<e.length;t++)this._eachEntry(e[t],t)},A.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===b){var r,o,a=!1;try{r=e.then}catch(e){a=!0,o=e}if(r===y&&void 0!==e._state)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===L){var s=new i(C);a?O(s,o):_(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new i((function(t){return t(e)})),t)}else this._willSettleAt(n(e),t)},A.prototype._settledAt=function(e,t,i){var n=this.promise;void 0===n._state&&(this._remaining--,2===e?O(n,i):this._result[t]=i),0===this._remaining&&N(n,this._result)},A.prototype._willSettleAt=function(e,t){var i=this;T(e,void 0,(function(e){return i._settledAt(1,t,e)}),(function(e){return i._settledAt(2,t,e)}))};var L=function e(t){this[S]=D++,this._result=this._state=void 0,this._subscribers=[],C!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t((function(t){E(e,t)}),(function(t){O(e,t)}))}catch(t){O(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())};L.prototype.catch=function(e){return this.then(null,e)},L.prototype.finally=function(t){var i=this.constructor;return e(t)?this.then((function(e){return i.resolve(t()).then((function(){return e}))}),(function(e){return i.resolve(t()).then((function(){throw e}))})):this.then(t,t)},L.prototype.then=y,L.all=function(e){return new A(this,e).promise},L.race=function(e){var t=this;return n(e)?new t((function(i,n){for(var r=e.length,o=0;o<r;o++)t.resolve(e[o]).then(i,n)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))},L.resolve=b,L.reject=function(e){var t=new this(C);return O(t,e),t},L._setScheduler=function(e){i=e},L._setAsap=function(e){o=e},L._asap=o;var W=7,R=8,P="MoxieCache_visitorProfile_lastUpdated",j={chat:1,kb:2,email:3,kbot:4};function V(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(0!==e.length){for(var i=e[0],n=1;n<e.length;n++){var r=e[n];if(null==i)return;i="function"==typeof r?r(i):i[r]}return i}}function F(){}var q=new function(){var e,t,i;e=console,t=V(console,"log"),i=V(console,"error"),t||(e={},t=F),i||(i=t),this.log=function(){t.apply(e,arguments)},this.error=function(){i.apply(e,arguments)},this.suppressLogs=function(){this.log=F}},J=0;function H(e){switch(e){case 1:return"kb";case 2:return"chat";case 3:return"email";case 4:return"link";case 5:return"kbot";default:q.error("Unknown widget value:",e)}}function $(e,t,i){return 4===e?6:1===e?1002===t||1001===t?isNaN(X(i))?16:J:2===t?J:16:e}function U(e){return-1!==[J,W,R].indexOf(e)}function B(e){return"string"==typeof e&&(e=isNaN(e)?Date.parse(e):Number(e)),"object"==typeof e&&e instanceof Date&&(e=e.getTime()),"number"==typeof e&&e<9999999999&&(e*=1e3),e}function G(e,t,i){if(null==e)throw new TypeError('"array" is null or not defined');var n=e.length>>>0;for(i=+i||0,Math.abs(i)===1/0&&(i=0),i<0&&(i+=n)<0&&(i=0);i<n;i++)if(e[i]===t)return i;return-1}function z(e,t,i){var n=e.toString();(void 0===i||i>n.length)&&(i=n.length),i-=t.length;var r=n.indexOf(t,i);return-1!==r&&r===i}function K(e){var t=".",i=z(e=(""+e).trim(),"%"),n=(e=e.replace(/[^0-9.,]/g,"")).lastIndexOf(","),r=e.lastIndexOf(".");r>=0&&n>=0&&r<n&&(t=","),(e.match(new RegExp("\\"+t,"g"))||[]).length>1&&(t=""),e=(e=e.replace(new RegExp("[^0-9"+t+"]","g"),"")).replace(",",".");var o=parseFloat(e);return i&&(o/=100),o}function X(e){var t=K(e);return isNaN(t)?K(e.replace(/\./g,"").replace(/,/g,".")):t}function Q(e,t,i){return U(t)?function(e,t,i){if("number"==typeof e&&!isNaN(e)&&"number"==typeof i&&!isNaN(i))switch(t){case J:return e===i;case W:return e<i;case R:return e<=i;default:return}}(X(e),t,X(i)):function(e,t,i){switch(e=e.toLowerCase(),i=i.toLowerCase(),t){case 2:return n=i,r=r||0,e.lastIndexOf(n,r)===r;case 6:return function(e,t,i){return-1!==e.indexOf(t,i)}(e,i);case 16:return e===i;case 3:return z(e,i);case 5:return null!==e.match(i);default:return!1}var n,r}(e,t,i)}function Y(e,t){return e=B(e),t?(e-B(t))/1e3:(Date.now()-e)/1e3}function Z(e,t,i,n){void 0===n&&(n=!0);var r=0;switch(t){case 0:r=0;break;case 1:r=e.journey.length-1;break;case 2:i||(i=2),(e.journey.length>i||!1===n)&&(r=e.journey.length-i)}return e.journey[r]}function ee(e,t,i,n){void 0===n&&(n=!0);var r=0;switch(t){case 0:r=0;break;case 1:r=e.session.visits.length-1;break;case 2:i||(i=2),(e.session.visits.length>i||!1===n)&&(r=e.session.visits.length-i)}return e.session.visits[r]}function te(e){return void 0===e?e:JSON.parse(JSON.stringify(e))}function ie(e,t,i){e&&e[t]!==i&&(e[t]=i,e.dirty=!0)}function ne(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function re(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}var oe=String.prototype.valueOf,ae=Object.prototype.toString,se="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function ce(e){return"string"==typeof e||"object"==typeof e&&(se?function(e){try{return oe.call(e),!0}catch(e){return!1}}(e):"[object String]"===ae.call(e))}var ue=Math.pow(2,53)-1;function le(e){return"function"==typeof e||"[object Function]"===ae.call(e)}function de(e){var t=function(e){var t=Number(e);if(isNaN(t))return 0;if(0===t||!isFinite(t))return t;return(t>0?1:-1)*Math.floor(Math.abs(t))}(e);return Math.min(Math.max(t,0),ue)}function ge(e,t,i){var n=arguments.length;if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r=Object(e);if(n>1&&!le(t))throw new TypeError("Array.from: when provided, the second argument must be a function");for(var o,a=de(r.length),s=le(Array)?Object(new Array(a)):new Array(a),c=0;c<a;)o=r[c],s[c]=t?n>2?t.call(i,o,c):t(o,c):o,c+=1;return s.length=a,s}function he(e){var t=new Set;if(null!=e)for(var i=0;i!==e.length;i++)t.add(e[i]);return t}function fe(){return window.innerHeight}function pe(){return window.innerWidth}function ve(){return fe()>window.visualViewport.height}function me(e){return t=e,!isNaN(parseFloat(t))&&isFinite(t)?e+"px":e;var t}var we={top:me,bottom:me,left:me,right:me,height:me,width:me};function ye(e){var t=(e=e.toString()).indexOf("px");return t>0&&(e=Number(e.slice(0,t))),e}var be={top:ye,bottom:ye,left:ye,right:ye,height:ye,width:ye};function Se(e,t){var i=we[e];return i?i(t):t}function Ce(e,t){var i=be[e];return i?i(t):t}function _e(e){var t=e.getBoundingClientRect();return{top:t.top+document.body.scrollTop,left:t.left+document.body.scrollLeft}}function Ee(e){return getComputedStyle(e,null)}function Ie(e){var t=ye(Ee(e).height);return""===t&&(t=e.getBoundingClientRect.height),t}function Ne(e){var t=ye(Ee(e).width);return""===t&&(t=e.getBoundingClientRect.width),t}function Oe(e){var t=Ee(e);if("none"==t.display)return!1;if("hidden"==t.visibility)return!1;var i=Ze(e);return!i||Oe(i)}function Te(e,t){for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];if(e&&void 0!==e.length)for(var r=0;r<e.length;r++){var o=e[r];t.apply(void 0,[o].concat(i))}else{var a=e;t.apply(void 0,[a].concat(i))}}function ke(e,t){for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];e&&void 0!==e.length&&e.length>0&&t.apply(void 0,[e[0]].concat(i))}function xe(e){return document.getElementById(e)}function De(e,t){try{return e.querySelectorAll(t)}catch(e){return q.error("Encountered error trying to select dom element with selector: '"+t+"' : "+e.message),document.createDocumentFragment().childNodes}}function Me(e,t){var i=e.length;if(t>=0){if(0===i)return e;if(0===t&&1===i)return e;if(i>t)return[e[t]]}return[]}function Ae(e){return function(e,t){for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];var r=[];return Te(e,(function(e){t.apply(void 0,[e].concat(i))&&r.push(e)})),r}(e,Oe)}function Le(e){return function e(t,i){if(!i)return[];if(i.indexOf(",")>=0){var n=[];return i.split(",").forEach((function(i){n.push.apply(n,e(t,i.trim()))})),n}var r=i.match(/:(eq|first|last|visible)(\((\d+)\))?$/i);if(!r)return De(t,i);var o=i.slice(0,r.index),a=r[1].toLowerCase();if("eq"==a){var s=r[3];return Me(De(t,o),s)}return"first"==a?Me(De(t,o),0):"last"==a?function(e){var t=e.length;return t>1?[e[t-1]]:e}(De(t,o)):"visible"==a?Ae(De(t,o)):void 0}(document,e)}function We(e){ne(e,"remove")?e.remove():e.parentNode&&e.parentNode.removeChild(e)}function Re(e,t){e.innerHTML=t}function Pe(e,t,i){e.insertAdjacentHTML(t,i)}function je(e,t){Pe(e,"afterbegin",t)}function Ve(e,t){Pe(e,"beforeend",t)}function Fe(e,t){!function(e,t){Pe(e,"afterend",t)}(e,t),We(e)}function qe(e){Te(e.childNodes,We)}function Je(e,t){e.appendChild(t)}function He(e,t){e.childNodes.length>0?e.insertBefore(t,e.childNodes[0]):Je(e,t)}function $e(e){e.focus()}function Ue(e){e.blur()}function Be(e){return function e(t,i){return t===i||!!i.parentNode&&e(t,i.parentNode)}(e.ownerDocument,e)}function Ge(e,t){return e.tagName===t}function ze(e){var t=e.getAttribute("class");return null==t?[]:t.split(" ")}function Ke(e,t){var i=e.classList;return null==i?-1!==ze(e).indexOf(t):e.classList.contains(t)}function Xe(e,t){return e.attributes&&null!==e.getAttribute(t)}var Qe=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector;function Ye(e,t){return Qe.call(e,t)}function Ze(e){return void 0===e.parentElement?e.parentNode:e.parentElement}function et(e,t){return e.getAttribute(t)}function tt(e,t,i){e.setAttribute(t,i)}function it(e,t){e.removeAttribute(t)}function nt(e,t,i){e.style[t]=Se(t,i)}function rt(e,t){for(var i in t)nt(e,i,t[i])}function ot(e,t){e.style&&e.style.removeProperty(t)}var at=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&Be(e)&&"none"===Ee(e).display},st=function(){return null},ct=function(){},ut={};function lt(e){var t,i=e.ownerDocument,n=e.nodeName,r=ut[n];return r||(r=Ee(t=i.body.appendChild(i.createElement(n))).display,t.parentNode.removeChild(t),"none"===r&&(r="block"),ut[n]=r,r)}function dt(e,t){for(var i,n,r=[],o=0,a=e.length;o<a;o++)(n=e[o]).style&&(i=n.style.display,t?("none"===i&&(r[o]=st(n,"display")||null,r[o]||(n.style.display="")),""===n.style.display&&at(n)&&(r[o]=lt(n))):"none"!==i&&(r[o]="none",ct(n,"display",i)));for(o=0;o<a;o++)null!=r[o]&&(e[o].style.display=r[o]);return e}function gt(e,t){if(void 0!==e.classList)e.classList.add(t);else if(!Ke(e,t)){var i,n=e.getAttribute("class");i=null!=n?n+" "+t:t,e.setAttribute("class",i)}}function ht(e,t){if(void 0!==e.classList)e.classList.remove(t);else for(var i=!1;!i;){var n=e.getAttribute("class");if(null==n||0===n.length)return void(i=!0);for(var r=null,o=0,a=!1,s=t.length;!a;){var c=n.indexOf(t,o);if(-1===c)a=!0,i=!0;else{var u=c+s,l=u===n.length||" "===n[u],d=0===c||" "===n[c-1];if(l&&d){var g=n.substring(0,c-1),h=n.substring(u+1,n.length);r=0===g.length||0===h.length?g+h:g+" "+h,a=!0}else o=c+1}}null!==r&&e.setAttribute("class",r)}}function ft(e,t){for(var i=e.length,n=0;n<i;n++)if(pt(e[n],t))return!0;return!1}function pt(e,t){t=t.toUpperCase();var i=e.classList;null==i&&(i=ze(e));for(var n=0;n!==i.length;n++){var r=i[n];if(r.length===t.length&&r.toUpperCase()===t)return!0}return!1}function vt(e,t,i){e.addEventListener(t,i,!1)}function mt(e,t,i){e.addEventListener(t,i,{passive:!0})}function wt(e,t,i){e.removeEventListener(t,i)}function yt(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];return function(i){if(i&&i.target)for(var n=i.target,r=i.currentTarget,o=n;null!==o&&!o.isEqualNode(r);){if(e.apply(void 0,[o].concat(t)))return[!0,o];o=Ze(o)}return[!1,null]}}function bt(e,t,i,n,r){var o=function(e){var t=i(e),o=t[0],a=t[1];o&&(null===a&&(a=this),!1===n.bind(a)(e)&&(e.stopPropagation(),r||e.preventDefault()))};return Te(e,r?mt:vt,t,o),o}function St(e,t,i){Te(e,wt,t,i)}function Ct(e){return yt(Ke,e)}function _t(e){return yt(Ge,e.toUpperCase())}function Et(e){return yt(Ye,e)}function It(e){var t=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var r=t[n];if(null!=r)for(var o in r)ne(r,o)&&(i[o]=r[o])}return i}var Nt=Object.prototype.propertyIsEnumerable;function Ot(e){if(null==e)throw new TypeError("Sources cannot be null or undefined");return Object(e)}function Tt(e,t,i){var n=t[i];if(null!=n)if(ne(e,i)){if(void 0===e[i]||null===e[i])throw new TypeError("Cannot convert undefined or null to object ("+i+")");re(n)?e[i]=kt(Object(e[i]),n):e[i]=n}else re(n)?e[i]=kt(Object({}),n):e[i]=n}function kt(e,t){if(e===t)return e;for(var i in t=Object(t))ne(t,i)&&Tt(e,t,i);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(t),r=0;r<n.length;r++)Nt.call(t,n[r])&&Tt(e,t,n[r]);return e}function xt(e){for(var t=[],i=!1,n=0;n!==e.length;n++){var r=e[n];"-"===r?i=!0:i?(t.push(r.toUpperCase()),i=!1):t.push(r)}return t.join("")}function Dt(e){return encodeURIComponent(e)}var Mt=Date.now()%1e9;function At(){var e="__stash_"+(1e9*Math.random()>>>0)+Mt+++"__";this.set=function(t,i){var n=t[e];return n&&n[0]===t?n[1]=i:Object.defineProperty(t,e,{value:[t,i],writable:!0}),this},this.get=function(t){var i=t[e];return i&&i[0]===t?i[1]:void 0},this.delete=function(t){var i=t[e];if(!i)return!1;var n=i[0]===t;return i[0]=i[1]=void 0,n},this.has=function(t){var i=t[e];return!!i&&i[0]===t}}var Lt=!1||"undefined"==typeof WeakMap?new At:new WeakMap;function Wt(e){var t;return Lt.has(e)?t=Lt.get(e):(t={},Lt.set(e,t)),t}function Rt(e,t,i){var n=Wt(e),r=n[t];return n[t]=i,r}function Pt(e,t){return Wt(e)[t]}function jt(e,t){delete Wt(e)[t]}function Vt(e,t){var i=Pt(e,t);return void 0===i&&(i=et(e,"data-"+function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}(t))),i}function Ft(e){for(var t=It({},Wt(e)),i=e.attributes,n=0;n<i.length;n++){var r=i.item(n);0===r.name.indexOf("data-")&&(t[xt(r.name.slice(5))]=r.value)}return t}var qt=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},Jt=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},Ht=function(){this.duration=300,this.aniCount=0,this.frameCount=0,this.timeCount=0,this.animations={},this.frames={},this.timeouts={}};Ht.prototype.count=function(){return this.aniCount+this.frameCount+this.timeCount},Ht.prototype.animationIds=function(){return Object.keys(this.animations)},Ht.prototype.frameIds=function(){return Object.keys(this.frames)},Ht.prototype.timeoutIds=function(){return Object.keys(this.timeouts)};var $t=new Ht;function Ut(e){!function(e,t){var i=Pt(e,"_animations");void 0===i?Rt(e,"_animations",[t]):i.push(t)}(e.element,e.id),$t.animations[e.id]=e,$t.aniCount+=1}function Bt(e){$t.frames[e]&&($t.frameCount-=1,delete $t.frames[e])}function Gt(e){$t.timeouts[e]&&($t.timeCount-=1,delete $t.timeouts[e])}function zt(e){var t;!function(e,t){var i=Pt(e,"_animations");if(void 0!==i){var n=i.indexOf(t);0===n?jt(e,"_animations"):n>=0&&i.splice(n,1)}}(e.element,e.id),function(e){$t.animations[e.id]&&(delete $t.animations[e.id],$t.aniCount-=1)}(e),e.curAniFrame&&((t=e.curAniFrame)&&(Bt(t),Jt(t)),e.curAniFrame=!1),e.doneTimeout&&(Gt(e.doneTimeout),window.clearTimeout(e.doneTimeout),e.doneTimeout=!1)}var Kt=0,Xt=function(e,t,i,n){Kt+=1,this.id=Kt,this.element=e,this.duration=t,this.doneHandler=i,this.label=n,this.startTime=null,this.doneTimeout=!1,this.curAniFrame=!1,this.animator=null,this.doneFunction=null};function Qt(e,t){var i=Pt(e,"_animations");if(i&&i.length){i=ge(i);for(var n=0;n<i.length;n++){var r=$t.animations[i[n]];r&&(t?r.done():r.cancel())}}jt(e,"_animations")}function Yt(e,t,i){var n,r=Ee(e),o={},a=["left","top"];for(var s in t)"auto"===r[s]&&-1!==a.indexOf(s)?(n||(n=_e(e)),o[s]=Number(Ce(s,n[s]))):o[s]=Number(Ce(s,r[s]));var c=(i=i||{}).duration||$t.duration,u=i.label||"css.animate",l=new Xt(e,c,i.done,u);l.animator=function(e){this.curAniFrame=!1,this.startTime||(this.startTime=e);var i=e-this.startTime,n=i>=c?1:i/c,r={};for(var a in t){var s=Number(Ce(a,t[a]))-o[a];r[a]=Se(a,o[a]+s*n)}rt(this.element,r),i>=this.duration?this.done():this.curAniFrame=Zt(this.animator,this.label)}.bind(l),c>0?(l.curAniFrame=Zt(l.animator,l.label),l.doneTimeout=window.setTimeout(function(){Gt(l.doneTimeout),l.doneTimeout=!1,zt(l);var e=Date.now();l.startTime=e-c,l.animator(e)}.bind(l),c),function(e,t){$t.timeCount+=1,$t.timeouts[e]=t||"unknown"}(l.doneTimeout,l.label),Ut(l)):l.animator(Date.now())}function Zt(e,t){var i=qt((function(t){Bt(i),e(t)}));return function(e,t){$t.frameCount+=1,$t.frames[e]=t||"unknown"}(i,t),i}Xt.prototype.finish=function(){if(zt(this),this.animator){var e=Date.now();this.startTime=e-this.duration,this.animator(e)}},Xt.prototype.done=function(){if(zt(this),this.doneHandler)try{this.doneHandler.call(this.element)}catch(e){q.error("ERROR in animation done handler",e)}},Xt.prototype.cancel=function(){zt(this)};var ei=null;function ti(e){null===ei&&(ei=document.createElement("DIV")),je(ei,e);var t=ge(ei.childNodes);return Te(t,We),t}var ii=function(e){this.length=0,null==e||("string"==typeof e?e.length>0&&("<"===e.charAt(0)?this.pushAll(ti(e)):this.pushAll(De(document,e))):void 0!==e.length?this.pushAll(e):this.push(e))};function ni(e){return new ii(e)}function ri(e,t){Object.defineProperty(this,"name",{enumerable:!1,writable:!1,value:"AJAXError"}),Object.defineProperty(this,"message",{enumerable:!1,writable:!0,value:e.statusText}),Object.defineProperty(this,"elapsed",{enumerable:!1,writable:!0,value:t}),Object.defineProperty(this,"request",{enumerable:!1,writable:!0,value:e}),ne(Error,"captureStackTrace")?Error.captureStackTrace(this,ri):Object.defineProperty(this,"stack",{enumerable:!1,writable:!1,value:new Error(e.statusText).stack})}ii.prototype.push=function(e){return e&&1===e.nodeType&&(this[this.length]=e,this.length+=1),this},ii.prototype.pushAll=function(e){for(var t=0;t<e.length;t++)this.push(e[t]);return this},ii.prototype.each=function(e){for(var t=[],i=arguments.length-1;i-- >0;)t[i]=arguments[i+1];return Te.apply(void 0,[this,e].concat(t)),this},ii.prototype.hasClass=function(e){return this.length>0&&Ke(this[0],e)},ii.prototype.attr=function(e,t){var i=arguments.length;if(2===i)Te(this,tt,e,t);else if(1===i){var n=this.length>0?et(this[0],e):null;return null!==n?n:void 0}return this},ii.prototype.removeAttr=function(e){return Te(this,it,e),this},ii.prototype.data=function(e,t){var i=arguments.length;if(2===i)Te(this,Rt,e,t);else{if(1===i)return 0===this.length?void 0:Vt(this[0],e);if(0===i)return 0===this.length?void 0:Ft(this[0])}return this},ii.prototype.addClass=function(e){return Te(this,gt,e),this},ii.prototype.removeClass=function(e){return Te(this,ht,e),this},ii.prototype.on=function(e,t,i){var n=this,r=arguments.length;return 2===r&&"string"==typeof e&&"function"==typeof t&&e.split(" ").forEach((function(e){e&&Te(n,vt,e,t)})),3===r&&"string"==typeof e&&"string"==typeof t&&"function"==typeof i&&bt(this,e,Et(t),i,!1),this},ii.prototype.onPassive=function(e,t,i){var n=arguments.length;return 2===n&&"string"==typeof e&&"function"==typeof t&&Te(this,mt,e,t),3===n&&"string"==typeof e&&"string"==typeof t&&"function"==typeof i&&bt(this,e,Et(t),i,!0),this},ii.prototype.css=function(e,t){var i=arguments.length;if(i>0){var n=typeof e;if(1===i){if("string"===n)return this.length>0?Ee(this[0])[xt(e)]:null;if(Array.isArray(e)){for(var r={},o=Ee(this[0]),a=0;a<e.length;a++){var s=e[a];r[s]=o[s]}return r}"object"===n&&Te(this,rt,e)}if(2===i&&"string"==typeof e){var c=xt(e);Te(this,nt,c,t)}}return this},ii.prototype.append=function(e){return"string"==typeof e?Te(this,Ve,e):e instanceof Element&&ke(this,Je,e),this},ii.prototype.replaceWith=function(e){return Te(this,Fe,e),this},ii.prototype.prepend=function(e){return"string"==typeof e?Te(this,je,e):e instanceof Element&&ke(this,He,e),this},ii.prototype.empty=function(){return Te(this,qe),this},ii.prototype.appendTo=function(e){return e instanceof ii&&e.length>0&&(e=e[0]),Te(this,(function(t){Je(e,t)})),this},ii.prototype.html=function(e){return Te(this,Re,e),this},ii.prototype.val=function(){return this.length>0?this[0].value||null:void 0},ii.prototype.text=function(e){var t=arguments.length;if(0===t){var i=[];return Te(this,(function(e){e.textContent&&i.push(e.textContent)})),i.join("")}return 1===t&&this.length>0&&(this[0].textContent=e),this},ii.prototype.prependHtml=function(e){return Te(this,je,e),this},ii.prototype.remove=function(){return Te(this,We),this},ii.prototype.find=function(e){var t=new ii;return Te(this,(function(i){t.pushAll(De(i,e))})),t},ii.prototype.closest=function(e){var t=new ii;return Te(this,(function(i){t.push(function(e,t){if(Element.prototype.closest)return e.closest(t);var i=e;do{if(Ye(i,t))return i;i=i.parentNode}while(null!==i&&1===i.nodeType);return null}(i,e))})),t},ii.prototype.first=function(){var e=new ii;return this.length>0&&e.push(this[0]),e},ii.prototype.parent=function(){var e=new ii;return this.length>0&&e.push(this[0].parentNode),e},ii.prototype.children=function(e){var t=new ii;return Te(this,(function(e){var i=e.childNodes;t.pushAll(i)})),e&&(t=t.filter(e)),t},ii.prototype.index=function(){return this.length>0?function(e){var t=e.parentNode.childNodes,i=0;for(i=0;i<t.length;i++)if(t[i]===e)return i;return-1}(this[0]):0},ii.prototype.filter=function(e){var t=new ii;return Te(this,(function(i){Ye(i,e)&&t.push(i)})),t},ii.prototype.not=function(e){var t=new ii;if("string"==typeof e)Te(this,(function(i){Ye(i,e)||t.push(i)}));else if(e instanceof ii){var i=e.length;Te(this,(function(n){for(var r=!1,o=0;o<i&&!r;o++)r=n===e[o];r||t.push(n)}))}return t},ii.prototype.animate=function(e,t){return ke(this,Yt,e,t),this},ii.prototype.stop=function(e,t){return Te(this,Qt,t),this},ii.prototype.show=function(){return dt(this,!0),this},ii.prototype.hide=function(){return dt(this,!1),this},ii.prototype.focus=function(){return ke(this,$e),this},ii.prototype.blur=function(){return ke(this,Ue),this},ii.prototype.height=function(e){return 0===arguments.length?this.length>0?Ie(this[0]):0:(Te(this,rt,{height:e+"px"}),this)},ii.prototype.width=function(e){return 0===arguments.length?this.length>0?Ne(this[0]):0:(Te(this,rt,{width:e+"px"}),this)},ii.prototype.sort=function(e){var t=ge(this);t.sort(e);for(var i=0;i<this.length;i++)this[i]=t[i];return this},ii.prototype.detach=function(){return Te(this,We),this},"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf(ri.prototype,Error.prototype):ri.prototype=Object.create(Error.prototype,{constructor:{value:ri}});function oi(){var e={},t={};var i={retainFor:1e4,timeout:2e4};function n(n,r){r=function(e,t){return t?It({},e,t):e}(i,r);var o=e[n];if(!o){var a={url:n,method:"GET"};r.crossDomain&&(a.crossDomain=r.crossDomain),r.contentType&&(a.contentType=r.contentType),void 0!==r.data&&(a.data=r.data),r.dataType&&(a.dataType=r.dataType),r.headers&&(a.headers=r.headers);var s=function(){!function(i,n){e[i]===n&&(delete e[i],t[i]&&(clearTimeout(t[i]),delete t[i]))}(n,o)},c=new XMLHttpRequest;if(o=new L((function(e,t){var i=Date.now();c.open("GET",n,!0),r.crossDomain&&(c.withCredentials=!0),c.setRequestHeader("Accept","application/json");var o=!1;r.timeout&&r.timeout>=0&&(c.addEventListener("loadstart",(function(){o=setTimeout((function(){o=!1,c.abort(),t(new Error("Operation timed out"))}),r.timeout)})),c.addEventListener("loadend",(function(){o&&clearTimeout(o)}))),c.addEventListener("load",(function(){c.status>=200&&c.status<400?e(c):t(new ri(c,Date.now()-i))})),c.addEventListener("error",(function(){t(new ri(c,Date.now()-i))})),c.send()})),e[n]=o,r.retainFor>0){var u=setTimeout(s,r.retainFor);t[n]=u}o.catch((function(){return s(),null}))}return o}this.retainFor=function(e){return(e=Number(e))>=0&&(i.retainFor=e),i.retainFor},this.timeout=function(e){return(e=Number(e))>=0&&(i.timeout=e),i.timeout},this.urls=function(){return Object.keys(e)},this.getXMLHttpRequest=function(e,t){return n(e,t)},this.get=function(e,t){return n(e,t).then((function(e){return"string"==typeof e.response?JSON.parse(e.response):e.response}))},this.remove=function(i){delete e[i],t[i]&&(clearTimeout(t[i]),delete t[i])},this.set=function(t,i){e[t]=L.resolve(i)},this.clear=function(){for(var i in t)clearTimeout(t[i]);e={},t={}}}var ai="function"==typeof CustomEvent?function(e,t){return new CustomEvent(e,{detail:t})}:function(e,t){var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,!1,!1,t),i};function si(e,t,i){var n=ai("GoMoxie:"+e,t);return n.version=i,n}var ci={kb:1,chat:2,email:3,kbot:2,link:4},ui={_blank:1,_self:2};function li(e){var t=e.userAgent;return t.match(/GoogleTV|SmartTV|Internet.TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE-HTML/i)?"Desktop":t.match(/Xbox|PLAYSTATION.3|Wii/i)?"Desktop":t.match(/Windows.(NT|XP|ME|9)/)&&!t.match(/Phone/i)||t.match(/Win(9|.9|NT)/i)?"Desktop":t.match(/iPad/i)||t.match(/tablet/i)&&!t.match(/RX-34/i)||t.match(/FOLIO/i)?"Tablet":t.match(/Linux/i)&&t.match(/Android/i)&&!t.match(/Fennec|mobi|HTC.Magic|HTCX06HT|Nexus.One|SC-02B|fone.945/i)?"Tablet":t.match(/Kindle/i)||t.match(/Mac.OS/i)&&t.match(/Silk/i)?"Tablet":t.match(/GT-P10|SC-01C|SHW-M180S|SGH-T849|SCH-I800|SHW-M180L|SPH-P100|SGH-I987|zt180|HTC(.Flyer|_Flyer)|Sprint.ATP51|ViewPad7|pandigital(sprnova|nova)|Ideos.S7|Dell.Streak.7|Advent.Vega|A101IT|A70BHT|MID7015|Next2|nook/i)||t.match(/MB511/i)&&t.match(/RUTEM/i)?"Tablet":t.match(/BOLT|Fennec|Iris|Maemo|Minimo|Mobi|mowser|NetFront|Novarra|Prism|RX-34|Skyfire|Tear|XV6875|XV6975|Google.Wireless.Transcoder/i)?"Mobile":t.match(/Opera/i)&&t.match(/Windows.NT.5/i)&&t.match(/HTC|Xda|Mini|Vario|SAMSUNG-GT-i8000|SAMSUNG-SGH-i9/i)?"Mobile":t.match(/Macintosh|PowerPC/i)&&!t.match(/Silk/i)?"Desktop":t.match(/Linux/i)&&t.match(/X11/i)?"Desktop":t.match(/Solaris|SunOS|BSD/i)?"Desktop":t.match(/Bot|Crawler|Spider|Yahoo|ia_archiver|Covario-IDS|findlinks|DataparkSearch|larbin|Mediapartners-Google|NG-Search|Snappy|Teoma|Jeeves|TinEye/i)&&!t.match(/Mobile/i)?"Desktop":t.match(/CrOS/i)?"Desktop":"Mobile"}function di(e){return function(){try{return e.apply(this,arguments)}catch(e){q.error(e)}}}function gi(e,t){var i,n,r,o,a;if(e&&e.rulesEngine&&e.rulesEngine.siteRules&&e.rulesEngine.siteRules.rules)e:for(n=0;n<e.rulesEngine.siteRules.rules.length;n++)if((r=e.rulesEngine.siteRules.rules[n]).id===t){if(r.action&&r.action.success)for(o=0;o<r.action.success.length;o++)if((a=r.action.success[o]).parameters&&a.parameters.rule&&a.parameters.rule.id===t){i=o;break e}break}return i}function hi(e,t){return e.widgetManager.engagementWidgets.widgets[t]}function fi(e,t,i,n){if(n)e["#"]=n;else if("chat"===i||"kbot"===i){var r=hi(t,i);r.widgetParameters&&r.widgetParameters.traceId?e["#"]=r.widgetParameters.traceId:r.parameters&&r.parameters.traceId&&(e["#"]=r.parameters.traceId)}return e}function pi(e){var t=null,i=e.contextMonitor.getLastDevice();if(i)switch(i){case"Desktop":t=1;break;case"Tablet":t=2;break;case"Mobile":t=3}var n={};return n.d=Date.now(),n.u=function(e){return e.cacheManager.getVisitorProfileId()}(e),n.w=t,n.W=1,n.p=e.url,n.q=e.pageTitle,n.v="v1.24.2",n.$="1.1",n["@"]=e.cacheManager.makeEventSerialNumber(),n}function vi(e,t,i,n){var r=pi(e);return r.t=t,r.z=ci[i],r.r=n.id,r.i=1,r.o=e.currentOfferCreatedAt.toString(),r=fi(r,e,i)}function mi(e,t){e.logDisabled||(q.log("Events.sendToEventService:",t),e.eventService.notifyEventService(t))}function wi(e,t){e.logDisabled||(q.log("Events.sendToEventServiceImmediately:",t),e.eventService.notifyEventServiceImmediately(t))}function yi(e,t,i){var n=function(e,t){var i=hi(e,t);return i&&i.widgetParameters&&i.widgetParameters.rule?i.widgetParameters.rule.id:null}(e,i);if(n){t.r=n;var r=gi(e,n);void 0!==r&&(t.i=r),t.x=function(e,t){var i=hi(e,t),n=2;return i&&i.proactive&&(n=1),n}(e,i)}return t}var bi=di((function(e,t,i,n,r,o,a,s){var c=pi(e);(c=fi(c,e,i)).t=t?10:9,n&&(c.a=n.toString()),r&&(c.A=r),o&&(c.S=o.toString()),void 0!==a&&(c.f=a),s&&(c["!"]=s.toString()),mi(e,c=yi(e,c,i))})),Si=di((function(e,t,i,n,r,o){var a=pi(e);(a=fi(a,e,i)).t=t?17:18,void 0!==n&&(a.S=n.toString()),a=yi(e,a,i),void 0!==r&&(a.f=r),void 0!==o&&(a["!"]=o.toString()),mi(e,a)})),Ci=di((function(e,t,i,n){var r=pi(e);r.t=11,void 0!==i&&(r.k=i),void 0!==n&&(r.K=n),(r=yi(e,r,t)).z=ci[t],mi(e,r)})),_i=di((function(e,t,i,n,r,o,a){var s=pi(e);s.t=33,void 0!==i&&(s.k=i),void 0!==n&&(s.K=n),void 0!==r&&(s.Q=r),void 0!==o&&(s.j=o),void 0!==a&&(s["+"]=a),(s=yi(e,s,t)).z=ci[t],wi(e,s)})),Ei=di((function(e,t,i,n,r,o,a,s){var c=pi(e);c.t=34,void 0!==i&&(c.k=i),void 0!==n&&(c.K=n),void 0!==r&&(c.Q=r),void 0!==o&&(c.j=o),void 0!==a&&(c["+"]=a),void 0!==s&&(c.m=s),(c=yi(e,c,t)).z=ci[t],wi(e,c)})),Ii=di((function(e,t,i){var n=pi(e);n.t=12,i&&(n.E=parseInt(i,10)),mi(e,n=yi(e,n,t))})),Ni=di((function(e,t,i){var n=pi(e);return n.t=99,void 0!==i&&(n.I=i),n.V=parseFloat(t),wi(e,n),n})),Oi=di((function(e,t,i){var n=pi(e);return n.t=5,n.V=parseFloat(t),void 0!==i&&(n.F=i),mi(e,n),n})),Ti=di((function(e,t,i){var n=vi(e,21,t,i);return mi(e,n),n})),ki=di((function(e,t,i){var n=vi(e,22,t,i);return n["Î"]=Date.now()-e.currentOfferCreatedAt,mi(e,n),n})),xi=di((function(e,t,i){var n=vi(e,23,t,i);return n["Î"]=Date.now()-e.currentOfferCreatedAt,mi(e,n),n})),Di=di((function(e,t,i,n,r){var o=pi(e);if(o.t=15,void 0!==i&&(o.Q=i),n&&(o.h=parseInt(n,10)),r){o.H=[];for(var a=0;a<r.length;a++){var s={};s.k=r[a].articleId,s.K=r[a].articleTitle,o.H.push(s)}}mi(e,o)})),Mi=di((function(e,t,i,n){var r=pi(e);(r=fi(r,e,t)).t=16,r=yi(e,r,t),void 0!==i&&(r.f=i),n&&(r["!"]=n.toString()),mi(e,r)})),Ai=di((function(e,t,i,n,r,o){if(n){var a=pi(e);switch(a=fi(a,e,"chat",o),t){case"service-line-closed":a.t=25;break;case"no-agent-available":a.t=26;break;case"no-agent-slots-available":a.t=35;break;case"wait-too-long":a.t=27}if(i&&(a["!"]=i.toString()),void 0!==n){a.r=n;var s=gi(e,n);void 0!==s&&(a.i=s)}a.x="proactive"===r?1:2,mi(e,a)}})),Li=di((function(e,t,i){var n=pi(e);if(t){if(n.t=31,n=yi(e,n,i),void 0!==i){if(void 0===ci[i])return;n.z=ci[i]}}else n.t=30;mi(e,n)})),Wi=di((function(e){var t=pi(e);t.t=1;var i=e.contextMonitor.getLastBrowseInfo().name;i&&(t.B=i),mi(e,t)})),Ri=di((function(e){var t=pi(e);t.t=2,t.U=window.navigator.userAgent;var i=e.contextMonitor.getLastBrowseInfo().version;i&&(t.b=i);var n=e.contextMonitor.getLastLocation();if(!n)return e.contextMonitor.fetchLocation().then((function(i){t.l=i.latitude,t.L=i.longitude,t.C=i.city,t.T=i.state,t.Y=i.country,mi(e,t)}));t.l=n.latitude,t.L=n.longitude,t.C=n.city,t.T=n.state,t.Y=n.country,mi(e,t)})),Pi=di((function(e){var t=pi(e);t.t=3,mi(e,t)})),ji=di((function(e,t){var i=pi(e);i.t=6,i.D=JSON.stringify(t),mi(e,i)})),Vi=di((function(e,t,i,n,r){var o=pi(t);o.t=e?13:14,o.G=i,o.r=n,o.i=r,mi(t,o)})),Fi=di((function(e,t,i,n,r,o){var a=pi(e);a.t=20,a.r=t,a.i=i,n&&(a["!"]=n.toString()),r&&(a.z=ci[r]),a.x="proactive"===o?1:2,mi(e,a)})),qi=di((function(e,t,i,n){var r=pi(e);r.t=32,r.r=n,r["^"]=ui[i],r["&"]=t,r.z=ci.link,r.x=1,"_self"===i?wi(e,r):mi(e,r)}));function Ji(e,t){var i=new si(e,t,"1.0");return setTimeout((function(){try{window.dispatchEvent(i)}catch(t){q.log("PublicAPI.broadcast("+e+"): error: "+(t.stack?t.stack:t.message))}})),i}function Hi(e,t,i){var n,r,o,a,s,c,u;if(c={cartValue:!1,cartItems:!1},!t||!function(e){return!!(e&&e.session&&e.session.visits&&e.session.visits.length>=1)}(e))return e;if(a=e.session.visits.length-1,o=e.session.visits[a].journey.length-1,void 0!==t.currentCartValue&&(r=Number(t.currentCartValue),isNaN(r)||(e.session.visits[a].journey[o].current_cart_value=r,c.cartValue=r)),void 0!==t.currentCartItems&&(n=(u=t.currentCartItems)&&u.length>0?u.filter((function(e){if("name"in e&&""!==e.name||"sku_or_id"in e&&""!==e.sku_or_id)return!0})):[],e.session.visits[a].journey[o].current_cart_items=n,c.cartItems=n),void 0!==t.transactionTotal&&(s=Number(t.transactionTotal),isNaN(s)||(e.session.end_cart_value=s)),e.last_updated=Date.now(),c.cartValue||c.cartItems){var l=c.cartValue||r,d=c.cartItems||n;Ji("cartUpdated",{cartValue:l,cartItems:d}),Oi(i,l,d)}return e}function $i(e){return-1!==["link"].indexOf(e)}function Ui(e,t){return new L((function(i,n){i(void 0===t?e():e.call(t))}))}function Bi(e){return function(){var t=this,i=[].slice.call(arguments,0);return new L((function(n){n(e.apply(t,i))}))}}function Gi(e){try{var t=window[e],i="__test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return!1}}var zi=new Array(16);for(var Ki,Xi,Qi=[],Yi=0;Yi<256;++Yi)Qi[Yi]=(Yi+256).toString(16).substr(1);var Zi=0,en=0;function tn(e,t,i){var n=t&&i||0,r=t||[],o=(e=e||{}).node||Ki,a=void 0!==e.clockseq?e.clockseq:Xi;if(null==o||null==a){var s=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),zi[t]=e>>>((3&t)<<3)&255;return zi}();null==o&&(o=Ki=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==a&&(a=Xi=16383&(s[6]<<8|s[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:en+1,l=c-Zi+(u-en)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||c>Zi)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Zi=c,en=u,Xi=a;var d=(1e4*(268435455&(c+=122192928e5))+u)%4294967296;r[n++]=d>>>24&255,r[n++]=d>>>16&255,r[n++]=d>>>8&255,r[n++]=255&d;var g=c/4294967296*1e4&268435455;r[n++]=g>>>8&255,r[n++]=255&g,r[n++]=g>>>24&15|16,r[n++]=g>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var h=0;h<6;++h)r[n+h]=o[h];return t||function(e,t){var i=t||0,n=Qi;return[n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]]].join("")}(r)}function nn(e){return!0===e?"p":"s"}function rn(e){return JSON.stringify(e)}function on(e){if(void 0!==e)try{return JSON.parse(e)}catch(t){return e}}var an=function(){this.name="DefaultStoragePlugin",this.data={p:{},s:{}}};an.prototype.destroy=function(){},an.prototype.clear=function(){this.data.p={},this.data.s={}},an.prototype.has=function(e,t){return ne(this.data[nn(t)],e)},an.prototype.set=function(e,t,i){this.data[nn(i)][e]=t},an.prototype.del=function(e,t){delete this.data[nn(t)][e]},an.prototype.get=function(e,t){var i=nn(t);return ne(this.data[i],e)?on(this.data[i][e]):null},an.prototype.removeKeysOtherThan=function(e,t){var i;i=t?this.data.p:this.data.s;var n=Object.keys(i);if(0!==n.length)for(var r=he(e),o=0;o!==n.length;o++){var a=n[o];r.has(a)||delete i[a]}};var sn=["rules_version","uuid","widgets_version"],cn=["chat-","conclient_","email-","kbot-","kb-","MoxieCache_","moxie"];function un(e){if(G(sn,e,0)>=0)return!0;for(var t=0;t<cn.length;t++)if(0===e.indexOf(cn[t]))return!0;return!1}function ln(e){var t,i,n=[];for(i=0;i<e.length;i++)un(t=e.key(i))&&n.push(t);for(i=0;i<n.length;i++)e.removeItem(n[i])}function dn(e,t){t=he(t);var i,n,r=function(e){var t,i,n=[];for(i=0;i!==e.length;i++)un(t=e.key(i))&&n.push(t);return n}(e),o=[];for(n=0;n!==r.length;n++)i=r[n],t.has(i)||o.push(i);return o}var gn=function(e){this.parentStorage=e,this.name="LocalStorageStoragePlugin",this.skip=["Rules","engagementWidgets"]};gn.prototype.destroy=function(){this.parentStorage.destroy()},gn.prototype.has=function(e,t){return!!this.parentStorage.has(e,t)||(!0===t?null!==localStorage.getItem(e):null!==sessionStorage.getItem(e))},gn.prototype.set=function(e,t,i){if(this.parentStorage.set(e,t,i),!(G(this.skip,e)>=0))if(!0===i)try{localStorage.setItem(e,rn(t))}catch(t){q.log("Error setting "+e+": "+t)}else try{sessionStorage.setItem(e,rn(t))}catch(t){q.log("Error setting "+e+": "+t)}},gn.prototype.get=function(e,t){if(this.parentStorage.has(e,t))return this.parentStorage.get(e,t);var i=!0===t?localStorage.getItem(e):sessionStorage.getItem(e);return null!==i&&(i=on(i)),i},gn.prototype.del=function(e,t){this.parentStorage.del(e,t),!0===t?localStorage.removeItem(e):sessionStorage.removeItem(e)},gn.prototype.clear=function(){this.parentStorage.clear(),ln(localStorage),ln(sessionStorage)},gn.prototype.removeKeysOtherThan=function(e,t){var i;this.parentStorage.removeKeysOtherThan(e,t);for(var n=dn(i=t?localStorage:sessionStorage,e),r=0;r!==n.length;r++){var o=n[r];i.removeItem(o)}};var hn="moxie=".length,fn="!--moxie".length,pn=window.top||window;function vn(e){var t="",i="",n=e.indexOf("moxie=");if(n>=0){n>0&&(t=e.slice(0,n));var r=e.indexOf("!--moxie",n+hn);r>=0?(i=e.slice(n+hn,r),t+=e.slice(r+fn)):i=e.slice("moxie=".length)}return[t,i]}function mn(e){var t=vn(pn.name||"");pn.name=t[0]+"moxie="+JSON.stringify(e)+"!--moxie"}var wn=function(e,t){this.name="WindowNameStoragePlugin",this.parentStorage=e,this.clientName=t.clientName,this._data=function(e){var t=vn(pn.name||"")[1],i={};if(t.length>0)try{i=JSON.parse(t)}catch(e){q.log("JSON: unable to parse window.name value:",t)}return i[e]||(i[e]={p:{},s:{}}),i}(this.clientName);var i,n=this;this.saveItListener||(this.saveItListener=function(){mn(n._data)},pn.addEventListener("unload",this.saveItListener,!1));var r=n._data[this.clientName];for(i in r.p)e.set(i,r.p[i],!0);for(i in r.s)e.set(i,r.s[i],!1)};function yn(e){var t=e.widgetManager,i=e.cacheManager;return e._clearingHistoryPromise||(e._clearingHistoryPromise=L.resolve(!0).then((function(){return e.contextMonitor.stop(),t.clearHistory().then((function(){t.destroy()})).then((function(){var t=e.eventService;return e.eventService={clearHistoryStub:!0,notifyEventServiceImmediately:function(){},notifyEventService:function(){}},L.resolve(t.stopEventService())})).then((function(){return L.resolve(i.storagePlugin.clear()).then((function(){i.destroy(),e.cacheManager=null}))})).catch((function(e){throw q.log("History.clearHistory received an error:",e),e}))}))),e._clearingHistoryPromise}function bn(e){var t=e.userAgent.toString().toLowerCase(),i=e.appName,n=/(dolfin)[ /]([\w.]+)/.exec(t)||/(javafx)[/]([\w.]+)/.exec(t)||/(chrome)[ /]([\w.]+)/.exec(t)||/(opera)(?:.*version)?[ /]([\w.]+)/.exec(t)||/(webkit)(?:.*version)?[ /]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(t)||["","unknown"];return"webkit"===n[1]?n=/fbav|instagram/.test(t)&&/(iphone|ipad|ipod)/.test(t)?[n[0],"safari",n[2]]:/(iphone|ipad|ipod)\/?\s*(\.?\d+(\.\d+)*)/.exec(t)||/(android)[ /]([\w._-]+);/.exec(t)||[n[0],"safari",n[2]]:"mozilla"===n[1]?/trident/.test(t)?n[1]="MSIE":n[1]="firefox":/polaris|natebrowser|([010|011|016|017|018|019]{3}\d{3,4}\d{4}$)/.test(t)&&(n[1]="Polaris"),[n[1].toLowerCase(),"unknown"===n[2]?[i,window.navigator.appVersion,"-?"]:n[2]]}wn.prototype.destroy=function(){this.parentStorage.destroy(),this.saveItListener&&(pn.removeEventListener("unload",this.saveItListener),delete this.saveItListener)},wn.prototype.has=function(e,t){return this.parentStorage.has(e,t)},wn.prototype.set=function(e,t,i){if(this.parentStorage.set(e,t,i),!this.skipSaveForKey||!this.skipSaveForKey(e)){var n=!1;!0===i?(this._data[this.clientName].p[e]!==t&&(n=!0),this._data[this.clientName].p[e]=t):(this._data[this.clientName].s[e]!==t&&(n=!0),this._data[this.clientName].s[e]=t),n&&mn(this._data)}},wn.prototype.get=function(e,t){var i=!0===t?this._data[this.clientName].p[e]:this._data[this.clientName].s[e];if(void 0!==i)try{return JSON.parse(i)}catch(e){return i}return this.parentStorage.has(e,t)?(i=this.parentStorage.get(e,t),this.skipSaveForKey&&this.skipSaveForKey(e)?i:(!0===t?this._data[this.clientName].p[e]=i:this._data[this.clientName].s[e]=i,mn(this._data),i)):null},wn.prototype.del=function(e,t){this.parentStorage.del(e,t),!0===t?delete this._data[this.clientName].p[e]:delete this._data[this.clientName].s[e],mn(this._data)},wn.prototype.clear=function(){this.parentStorage.clear(),this._data[this.clientName].p={},this._data[this.clientName].s={},mn(this._data)};var Sn={},Cn=0,_n={},En=0,In={},Nn={};var On=!1;function Tn(){On||(q.error("Double load of concierge suspected"),On=!0)}function kn(e,t){var i=++En;return t.bridgeName="storage_bridge",t.requesterId=e.id,t.requestId=i,t.client=e.concierge.clientName,t.signature="moxie_concierge",e&&e.ifrm&&e.ifrm.contentWindow&&e.ifrm.contentWindow.postMessage?(e.ifrm.contentWindow.postMessage(JSON.stringify(t),"*"),new L((function(e,n){var r=setTimeout((function(){r=!1,n(new Error("TIMEOUT waiting for shared storage."))}),2e3),o=function(){r&&(clearTimeout(r),r=!1)};In[i]={message:t,resolve:function(t){o(),e(t)},reject:function(e){o(),n(e)}}})).finally((function(){delete In[i]}))):(Tn(),L.resolve(!0))}function xn(e,t){this.useSharedStorage=!1,this.parentStorage=e,this.concierge=t,this.scriptLocation=t.scriptLocation,this.created=Date.now(),this.sharedStorageId=function(e){var t=_n[e];return t||(t="concierge-shared-storage",++Cn>1&&(t=t+"-"+Cn),_n[e]=t),t}(this.scriptLocation),this.id=Date.now()}function Dn(e){this.name="InvalidArgumentException",this.message=e,this.toString=function(){return this.name+": "+this.message}}function Mn(e){return z(e,"_file")&&e.indexOf("profileJSON")<0||"Rules"===e||"engagementWidgets"===e}function An(e,t,i,n){return L.resolve(e.storagePlugin.set(t,i,n))}xn.prototype.destroy=function(e){e&&this.parentStorage.destroy(),We(this.ifrm),this.removeListener?(this.removeListener(),delete this.ifrm):Tn()},xn.prototype.init=function(){var e=this;if(Sn[this.id]=this,this.data={p:{},s:{}},e.ifrm=xe(e.sharedStorageId),!e.ifrm){e.ifrm=document.createElement("iframe"),e.ifrm.setAttribute("id",e.sharedStorageId),e.ifrm.setAttribute("tabindex","-1");var t=e.scriptLocation+"/client/storage_bridge.html";e.ifrm.setAttribute("src",t);var i=function(t){if("."===e.scriptLocation||0===e.scriptLocation.indexOf(t.origin)){var i={};try{i="string"==typeof t.data?JSON.parse(t.data):t.data}catch(e){}if(i&&"storage_bridge"===i.bridgeName){var n,r,o,a=e;if(i.requesterId&&Sn[i.requesterId]&&(a=Sn[i.requesterId]),i.requesterId===a.id)i.error?(n=i.requestId,r=new Error("Error from shared storage: "+i.error.message),(o=In[n])?o.reject(r):q.log("SharedStorageBridge: rejectRequest("+n+", "+JSON.stringify(r)+") cannot find outstanding request")):"updated"===i.request?(q.log("CONCIERGE StoragePlugin update: ",i),"moxie_cc"!==i.key||i.newValue||yn(e.concierge).catch((function(e){q.log("ERROR clearing history"+e)}))):function(e,t){var i=In[e];i?i.resolve(t):q.log("SharedStorageBridge: resolveRequest("+e+", "+JSON.stringify(t)+") cannot find outstanding request")}(i.requestId,i);else On||q.log('CONCIERGE StoragePlugin request ID mismatch: plug in "'+a.id+'" receved an event for "'+i.requesterId+'"')}}};e.removeListener=function(){window.removeEventListener("message",i,!1)},Nn[e.scriptLocation]=new L((function(t){e.ifrm.onload=function(e){e.target&&e.target.src&&t(e)}})).then((function(){window.addEventListener("message",i,!1)})),e.ifrm.style.display="none",document.body.appendChild(e.ifrm)}return Nn[e.scriptLocation].then((function(){var t="safari"===bn(window.navigator)[0];return kn(e,{request:"init",shadowInSessionStorage:t}).then((function(t){for(var i in e.parentStorage.removeKeysOtherThan(Object.keys(t.lsValue),!0),e.parentStorage.removeKeysOtherThan(Object.keys(t.ssValue),!1),t.lsValue)e.parentStorage.set(i,t.lsValue[i],!0);for(var n in t.ssValue)e.parentStorage.set(n,t.ssValue[n],!1);e.useSharedStorage=!0}),(function(t){throw q.log("SharedStoragePlugin#init: Failed to load from shared storage, removing listener: "+t.message),e.removeListener(),t}))}))},xn.prototype.name="SharedStoragePlugin",xn.prototype.has=function(e,t){return this.parentStorage.has(e,t)},xn.prototype.get=function(e,t){return this.parentStorage.get(e,t)},xn.prototype.clear=function(){this.parentStorage.clear();return kn(this,{request:"clear"}).then((function(e){return"ack"===e.request}))},xn.prototype.set=function(e,t,i){if(this.parentStorage.set(e,t,i),!this.skipSaveForKey||!this.skipSaveForKey(e))return kn(this,{request:"store",key:e,value:t,persist:!0===i}).then((function(e){return"ack"===e.request}))},xn.prototype.del=function(e,t){return this.parentStorage.del(e,t),kn(this,{request:"remove",key:e,persist:!0===t}).then((function(e){return"ack"===e.request}))};var Ln=0;function Wn(e){this.id=++Ln,this.concierge=e,this.storagePlugin=this.defaultStoragePlugin=new an;var t=Gi("sessionStorage");Gi("localStorage")&&t?(this.storagePlugin=new gn(this.defaultStoragePlugin),this.storagePluginToLoad="SharedStorage"):this.storagePluginToLoad="window.name",this.eventSerialNumber=null,this.saveEventSerialNumber=null,t&&(this.saveEventSerial=this.storeEventSerialNumberSessionStorage,this.eventSerialNumber=this.readEventSerialNumberFromSessionStorage())}function Rn(e,t,i){return L.resolve(e.storagePlugin.del(t,i))}function Pn(e){return"MoxieCache_"+e+"_file"}function jn(e){if(e&&(delete e.last_updated,delete e.last_submitted,e.session&&e.session.visits)){var t=e.session.visits.length-1;if(t>=0){var i=e.session.visits[t].journey;if(i){var n=i.length-1;n>=0&&(e.session.visits[t].journey[n].end_time=0)}}}}function Vn(e){var t=Pn("profileJSON");return function(e,t){return L.resolve(e.storagePlugin.get(t,!0)).then((function(e){return e?void 0===e.contents?(q.log("Loaded "+t+" from localStorage, but .contents was undefined"),null):(q.log("Loaded "+t+" from localStorage"),e.contents):null}))}(e,t).then((function(e){if(null!==e)try{return JSON.parse(e)}catch(e){q.log("Error parsing profile: "+e.message)}return null})).then((function(t){if(null!==t)return e.setData("profileJSON",JSON.stringify(t),!0)})).then((function(){return e}))}function Fn(e){return function(e){return e.storagePlugin.get("moxie_cc",!0)||e.storagePlugin.get("uuid",!0)}(e)?e.autoLoadProperties().then(Vn).then((function(){return e})):function(e){q.log("Creating new identity");var t=e.makeProfileId();return L.all([An(e,"uuid",t,!0),An(e,"moxie_cc",t+"|2147483647",!0)]).then((function(){return e.uuid=t,e}))}(e).then(Vn).then((function(){return e}))}Wn.prototype.storeEventSerialNumberSessionStorage=function(e){window.sessionStorage.setItem("moxie_concierge_event_serial_number",JSON.stringify(e))},Wn.prototype.readEventSerialNumberFromSessionStorage=function(){var e=window.sessionStorage.getItem("moxie_concierge_event_serial_number");if(null==e||""===e)return null;var t=null;try{t=JSON.parse(e)}catch(e){return q.log("Could not read serial number from session storage: "+e.message),null}return"number"!=typeof t?null:Math.floor(t)!==t?null:t<0||t>4294967295?null:t},Wn.prototype.makeEventSerialNumber=function(){null===this.eventSerialNumber&&(this.eventSerialNumber=Math.floor(Math.random()*(Math.pow(2,32)-1)));var e=this.eventSerialNumber++;return this.saveEventSerial&&this.saveEventSerial(this.eventSerialNumber),this.eventSerialNumber>4294967295&&(this.eventSerialNumber=0),e},Wn.prototype.cleanup=function(){delete this.profileJSON,delete this.uuid},Wn.prototype.destroy=function(){this.cleanup(),this.storagePlugin.destroy()},Wn.prototype.skipSaveForKey=Mn,Wn.prototype.isValidUserProfile=function(e){return void 0!==e.session&&void 0!==e.session.id},Wn.prototype.getVisitorProfileId=function(){return this.getDataClone("uuid")},Wn.prototype.emitEvent=function(e){var t;return"function"==typeof CustomEvent?t=new CustomEvent(e):(t=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,{}),q.log("CacheManager: emitting profile update event: "+JSON.stringify(t)),this.dispatchEvent(window,t)},Wn.prototype.dispatchEvent=function(e,t){return e.dispatchEvent(t)},Wn.prototype.resetVisitorProfile=function(){var e=this;return this.concierge.contextMonitor.stop(),Rn(this,Pn("profileJSON"),!0).then((function(){e.visitorProfile=null;var t=e.concierge.contextMonitor.createNewProfile();return e.setData("profileJSON",JSON.stringify(t))})).then((function(){e.concierge.contextMonitor.start()}))},Wn.prototype.setData=Bi((function(e,t,i){if(!ce(t))throw new Dn("Cannot set "+e+", data must be a string.");if("profileJSON"===e){var n,r=this.getDataClone("profileJSON");try{n=JSON.parse(t)}catch(t){throw new Dn("Cannot set "+e+", data is invalid JSON.")}var o=!1,a=!i&&function(e,t){var i=!1;if(e&&e.session&&e.session.visits&&e.session.visits.length>0){var n=e.session.visits.slice(-1)[0];if(n.journey&&n.journey.length>0){var r=n.journey.slice(-1)[0];new Date-new Date(r.end_time)>60*t*1e3&&(i=!0)}else i=!0}else i=!0;return i}(r,30),s=!1;if(i||null!=r){if(void 0!==n.customData)if(r&&void 0!==r.customData)JSON.stringify(r.customData)!==JSON.stringify(n.customData)&&(s=!0);else s=!0}else o=!0,void 0!==n.customData&&(s=!0);return o&&Wi(this.concierge),a&&Ri(this.concierge),s&&ji(this.concierge,n.customData),this.storeProfile(t)}if(e===P)return this[P]=t,An(this,P,t,!0);if("rules_version"===e)return this.rules_version=t,An(this,"rules_version",t,!0);if("widgets_version"===e)return this.widgets_version=t,An(this,"widgets_version",t,!0);throw new Dn("Cannot set "+e+", unknown property.")})),Wn.prototype.storeProfile=Bi((function(e){var t,i=JSON.parse(e);if(this.isValidUserProfile(i)){this.profileJSON=i;var n=(t=0,{contents:e,timestamp:(new Date).getTime(),version:t});return An(this,Pn("profileJSON"),n,!0)}throw new Dn("Cannot store profile, it is not valid.")})),Wn.prototype.setVolatileData=Bi((function(e,t){if("moxie_channels_custom_data"===e||"moxie_channels_form_data"===e)return this[e]=t;throw new Dn("Cannot set "+e+".")})),Wn.prototype.getVolatileData=function(e){return this[e]},Wn.prototype.profileUpdated=function(e){var t=this.getDataClone("profileJSON"),i=te(e);return jn(i),jn(t),JSON.stringify(t)!==JSON.stringify(i)},Wn.prototype.getData=function(e){var t=this[e];return t?"object"==typeof t?te(this[e]):this[e]:null},Wn.prototype.getDataClone=function(e){return this.getData(e)},Wn.prototype.getDataObject=function(e){return this[e]?this[e]:null},Wn.prototype.removeClientCache=function(e,t){return Rn(this,"conclient_"+e,t)},Wn.prototype.setClientCache=function(e,t,i){return An(this,"conclient_"+e,t,i)},Wn.prototype.getClientCache=function(e,t){return this.storagePlugin.get("conclient_"+e,t)},Wn.prototype.removeWidgetCache=function(e,t,i){return Rn(this,e+"-"+t,i)},Wn.prototype.setWidgetCache=function(e,t,i,n){return An(this,e+"-"+t,i,n)},Wn.prototype.getWidgetCache=function(e,t,i){return this.storagePlugin.get(e+"-"+t,i)},Wn.prototype.clearWidgetCacheKey=function(e,t){for(var i=[],n=this.storagePlugin;n.parentStorage;)n=n.parentStorage;var r,o=t?"p":"s",a=Object.keys(n.data[o]);for(r=0;r<a.length;r++)z(a[r],e)&&i.push(Rn(this,a[r],t));return L.all(i)},Wn.prototype.init=function(){var e=this;if(!this.ready){var t,i=L.resolve(e);"window.name"===e.storagePluginToLoad?(e.storagePlugin=new wn(e.storagePlugin,e.concierge),e.storagePlugin.skipSaveForKey=Mn):"SharedStorage"===e.storagePluginToLoad&&(t=new xn(e.storagePlugin,e.concierge),i=i.then((function(){return t.init()})).then((function(){e.storagePlugin=t,t.skipSaveForKey=Mn})).catch((function(e){t&&t.destroy(!1),q.log("FAILED to initialize the SharedStoragePlugin falling back to using regular localStorage: "+e.message)})).then((function(){return e}))),this.ready=i}return this.ready.then(Fn)};var qn=function(e,t){L.resolve(e.storagePlugin.get(t,!0)).then((function(i){e[t]=i}))};Wn.prototype.autoLoadProperties=function(){var e=this,t=[];return t.push(e.storagePlugin.get("moxie_cc",!0)),t.push(e.storagePlugin.get("uuid",!0)),t.push(qn(e,P)),t.push(qn(e,"rules_version")),t.push(qn(e,"widgets_version")),L.all(t).then((function(t){var i,n=t[0],r=t[1];return i=n?n.split("|").shift():r,e.uuid=i,e}))},Wn.prototype.makeProfileId=function(){return tn()};var Jn=null,Hn=null,$n=null;function Un(e){this.monitoredRules=[],this.concierge=e,this.rulesEngine=e.rulesEngine,this.cacheManager=e.cacheManager,this.moxieData=window.MoxieData||{},this.getLastLocation=function(){return Jn},this.getLastDevice=function(){return Hn},this.getLastBrowseInfo=function(){return $n};var t=0,i=0;this.nextMonitorId=function(){return++i},this.start=function(){var e=this;t=setInterval((function(){e.poll()}),1e3)},this.stop=function(){t>0&&(clearInterval(t),t=0)}}Un.prototype.cleanup=function(){this.stop()},Un.prototype.evalRules=function(){this.monitoredRules.forEach((function(e){this.rulesEngine.evalRule(e)?(this.rulesEngine.queueActions(e),this.unregister(e),e.monitor=!1):this.rulesEngine.rulesSucceeded[e.id]&&this.unregister(e)}),this)},Un.prototype.fetchLocation=function(){return this.concierge.httpGet(this.concierge.serviceUrl.location,{type:"GET"}).then((function(e){var t=e.subdivisions&&e.subdivisions.length?e.subdivisions[0].names.en:"";return{city:e.city?e.city.names.en:"",state:t,country:e.country?e.country.names.en:"",ip_address:"",zip:"",longitude:e.location?e.location.longitude:"",latitude:e.location?e.location.latitude:""}}))},Un.prototype.recordEngagementValue=function(){var e=this.cacheManager.getDataClone("profileJSON"),t=Z(ee(e,1),1).current_cart_value;return void 0===e.session.first_engagement_cart_value&&(e.session.dirty=!0,e.session.first_engagement_cart_value=t),void 0===e.session.visits[e.session.visits.length-1].first_engagement_cart_value&&(e.session.visits[e.session.visits.length-1].first_engagement_cart_value=t),this.cacheManager.setData("profileJSON",JSON.stringify(e))},Un.prototype.parseMappedContext=function(e){if(void 0!==e){"string"==typeof e&&(e=[e]);var t=function(e,t){t.replace(/^\$\[/,"").replace(/\]\$$/,"");var i=ni(Le(t)),n=i.text()||i.val();return n?n.trim():""};for(var i in e)ne(e,i)&&"string"==typeof e[i]&&(e[i]=e[i].replace(/\$\[(.*?)\]\$/g,t));return e}},Un.prototype.initTracking=function(){var e,t=0,i=0,n=this.cacheManager.getDataClone("profileJSON"),r=!1,o=!1,a=bn(navigator);$n={name:a[0],version:a[1]},Hn=li(navigator);var s=Number(this.cacheManager.getData(P)),c=this;if(null==n)(n={id:this.cacheManager.getData("uuid"),dirty:!0,tags:null,ip_address:"",all_device_names:[],all_browsers:[{name:$n[0],version:$n[1],language:navigator.language}],all_locations:null,preferences:{never_invite_to_chat:!1,language:navigator.language},session:null,history:{visits:0,last_visit:Date.now(),articles_viewed:0,invited_chat:0,refused_chat:0},last_updated:Date.now(),last_submitted:0}).all_device_names.push(Hn),r=!0,o=!0;else{if(Number(Z(ee(n,1),1).end_time)<s&&(t=n.session.visits.length-1,e=n.session.visits[t].journey.length-1,n.session.visits[t].journey[e].end_time=s,n.last_updated=s),!0!==n.session.transaction_completed&&!0!==this.moxieData.transactionComplete||(this.moxieData.transactionComplete&&(n.session.transaction_completed=this.moxieData.transactionComplete=!0,n.session.end_cart_value=this.moxieData.transactionTotal,Ji("transactionCompleted",{transactionTotal:this.moxieData.transactionTotal,cart:{value:this.moxieData.currentCartValue,items:this.moxieData.currentCartItems}}),Ni(this.concierge,this.moxieData.transactionTotal),this.cacheManager.setData("profileJSON",JSON.stringify(n))),void 0!==this.moxieData.customData&&this.concierge.publicAPI.customData(this.concierge,this.moxieData.customData),n.session=null),void 0!==n.session&&null!==n.session&&void 0!==n.session.visits){var u=Y(Z(ee(n,0)).start_time);(u>2592e3||isNaN(u))&&(n.session=null)}null!==n.session&&0!==n.session.visits.length&&((i=Y(Z(ee(n,1),1).end_time))>1800||isNaN(i))&&(o=!0)}if(null===n.session||void 0===n.session){var l={};l.id=tn(),l.visits=[],l.dirty=!0,l.end_cart_value=0,n.session=l,r=!0,o=!0}if(o){var d={};d.id=tn(),d.dirty=!0,d.journey=[],d.browser={name:$n[0],version:$n[1],language:navigator.language},d.device={},d.device.name=li(navigator),d.referral={url:document.referrer.substr(0,200)},d.journey=[],n.session.visits.push(d),n.history.visits+=1,r=!0}var g={};g.id=tn(),g.dirty=!0,g.url=this.concierge.url.substr(0,200),g.title=this.concierge.pageTitle.substr(0,200),g.start_time=Date.now(),g.end_time=Date.now(),g.referral={url:document.referrer.substr(0,200)};var h=Z(ee(n,1),1),f=h&&h.current_cart_value?h.current_cart_value:0;if(void 0!==this.moxieData.customData&&this.concierge.publicAPI.customData(this.concierge,this.moxieData.customData),void 0!==this.moxieData.currentCartValue){g.current_cart_value=this.moxieData.currentCartValue;var p=this.moxieData.currentCartItems||(h&&h.current_cart_items?h.current_cart_items:[]);Ji("cartUpdated",{cartValue:this.moxieData.currentCartValue,cartItems:p}),Oi(this.concierge,this.moxieData.currentCartValue,p)}else g.current_cart_value=f;if(void 0!==this.moxieData.currentCartItems){var v;for(g.current_cart_items=[],v=0;v<this.moxieData.currentCartItems.length;v++)g.current_cart_items.push({name:this.moxieData.currentCartItems[v].name?this.moxieData.currentCartItems[v].name:"",sku_or_id:this.moxieData.currentCartItems[v].skuOrId,value:this.moxieData.currentCartItems[v].value,quantity:this.moxieData.currentCartItems[v].quantity,uom:this.moxieData.currentCartItems[v].uom,description:this.moxieData.currentCartItems[v].description})}else{var m=h&&h.current_cart_items?h.current_cart_items:[];g.current_cart_items=te(m)}t=n.session.visits.length-1;return n.history.last_visit=Date.now(),(r?this.fetchLocation().then((function(e){Jn=e,ie(n,"ip_address",e.ip_address),ie(n.session,"ip_address",e.ip_address);var i=!0;if(n.all_locations)for(var r=0;r<n.all_locations.length;r++)if(n.all_locations[r].city===e.city){i=!1;break}i&&(n.all_locations=n.all_locations||[],n.all_locations.push(e)),o&&(n.session.visits[t].ip_address=e.ip_address,n.session.visits[t].location=e)})).catch((function(e){q.log("Failed to fetch location: "+JSON.stringify(e))})):L.resolve()).then((function(){return n.session.visits[t].journey.push(g),c.cacheManager.setData("profileJSON",JSON.stringify(n)).then((function(){return{rules:1,widgets:c.concierge.configuration.widgets.version}}))}))},Un.prototype.createNewProfile=function(){var e=Date.now();return{last_updated:e,last_submitted:0,history:{last_visit:e},session:{id:tn(),dirty:!0,visits:[{journey:[{id:tn(),dirty:!0,start_time:e,end_time:e,title:this.concierge.pageTitle.substr(0,200),url:this.concierge.url.substr(0,200),current_cart_value:0,current_cart_items:[]}]}],transaction_completed:!1,end_cart_value:0}}},Un.prototype.poll=function(){var e=Date.now(),t=this;Ui((function(){t.evalRules();var i=[];if(i.push(t.cacheManager.setData(P,e.toString(),!0)),"function"==typeof document.hasFocus&&document.hasFocus()){var n=t.cacheManager.getDataClone("profileJSON"),r=n.session.visits.length-1,o=n.session.visits[r].journey.length-1;n.session.visits[r].journey[o].end_time=e,n.last_updated=e,i.push(t.cacheManager.setData("profileJSON",JSON.stringify(n)))}return L.all(i)})).catch((function(e){q.log("ContextMonitor.poll: error "+(e.stack?e.stack:e.message))}))},Un.prototype.register=function(e){e.monitor&&!e.monitorId&&(e.monitorId=this.nextMonitorId(),this.monitoredRules.push(e))},Un.prototype.unregister=function(e){if(e.monitor&&void 0!==e.monitorId)for(var t=e.monitorId,i=0;i<this.monitoredRules.length;i++)if(this.monitoredRules[i].monitorId===t){this.monitoredRules.splice(i,1),e.monitorId=!1;break}},Un.prototype.tagProfile=function(e,t){var i=this.cacheManager.getData("profileJSON");i.tags=i.tags||[];var n={status:!1,tags:e.tag.filter((function(e){return-1===i.tags.indexOf(e)}))};return n.tags.length&&(i.tags=i.tags||[],i.tags=i.tags.concat(n.tags),this.cacheManager.setData("profileJSON",JSON.stringify(i)),n.status=!0),n},Un.prototype.removeProfileTag=function(e,t){var i=this.cacheManager.getData("profileJSON");i.tags=i.tags||[];var n={status:!1,tags:e.tag.filter((function(e){return-1!==i.tags.indexOf(e)}))};return n.tags.length&&(i.tags=i.tags.filter((function(e){return-1===n.tags.indexOf(e)})),0===i.tags.length&&(i.tags=null),this.cacheManager.setData("profileJSON",JSON.stringify(i)),n.status=!0),n};var Bn=function(e){this.concierge=e};function Gn(e,t){return e.then((function(e){try{var i=t(e);void 0!==i&&(e=i)}catch(e){q.error("Error in callback function: "+e)}return e}))}Bn.prototype.log=function(e){q.log(e)},Bn.prototype.location=function(){return this.concierge.scriptLocation+"/widgets/"+this.concierge.assetVersion.widgets+"/translation.json"},Bn.prototype.navigator=function(){return navigator},Bn.prototype.htmlElement=function(){return document.documentElement},Bn.prototype.sanitizeLang=function(e){return e=(e=e.toLowerCase()).replace("_","-")},Bn.prototype.parentLang=function(e){return e?e.split("-").slice(0,-1).join("-"):""},Bn.prototype.detectLanguage=function(){var e=this.navigator(),t=this.htmlElement(),i=this.sanitizeLang(t.getAttribute("lang")||t.getAttribute("xml:lang")||e.languages&&e.languages[0]||e.language||e.userLanguage||this.data.defaultLanguage||"en");return this.log("Language: "+i),i},Bn.prototype.getValue=function(e,t){var i=this.data.sourceLangs[e];return!(!i||!ne(this.data.langs[i],t))&&this.data.langs[i][t]},Bn.prototype.translate=function(e,t){for(var i=this.data.selectedLanguage,n=!1,r=!1;i;){if(!1!==(n=this.getValue(i,e)))return n;i===this.data.defaultLanguage&&(r=!0),(i=this.parentLang(i))||r||(i=this.data.defaultLanguage)}return t||"__"+e+"__"},Bn.prototype.handleJSONResponse=function(e){this.data=e,e.selectedLanguage=this.detectLanguage(),e.defaultLanguage=this.sanitizeLang(e.defaultLanguage);for(var t={},i=Object.keys(e.langs),n=0;n<i.length;n++)t[this.sanitizeLang(i[n])]=i[n];e.sourceLangs=t,this.concierge.langOptions={defaultLanguage:e.defaultLanguage,selectedLanguage:e.selectedLanguage}},Bn.prototype.init=function(){this.handleJSONResponse(this.concierge.configuration.translations)};var zn=function(){this.callbacks=[]};function Kn(e){this.concierge=e,this.names={}}function Xn(){this.isRunning=!1,this.whenDone=L.resolve(!0),this.queue=[]}function Qn(e){q.log("ActionQueue: Error thrown from run promise, "+JSON.stringify(e))}function Yn(e){this[1]=function(t,i,n){return e.widgetManager.addWidget(i,{id:t.id,action:n,name:t.name,source:t.source})},this[2]=function(t,i,n){var r=e.widgetManager.findWidget(i.widget);return e.widgetManager.removeWidget(r)},this[3]=function(t,i,n){return e.widgetManager.notify(i,{id:t.id,action:n,name:t.name,source:t.source})},this[4]=function(t,i,n){return e.contextMonitor.tagProfile(i,{id:t.id,action:n,name:t.name,source:t.source})},this[5]=function(t,i,n){return e.contextMonitor.removeProfileTag(i,{id:t.id,action:n,name:t.name,source:t.source})}}function Zn(e){var t=e.cacheManager;this.conciergeItem=function(t){return e[t]},this.visitorProfileGetTags=function(){return t.getData("profileJSON").tags},this.visitsToSite=function(){return V(t.getData("profileJSON"),"history","visits")},this.currentCartValue=function(){return Z(ee(t.getData("profileJSON"),1),1).current_cart_value},this.productsInCart=function(){return Z(ee(t.getData("profileJSON"),1),1).current_cart_items},this.userDeviceName=function(){return ee(t.getData("profileJSON"),1).device.name.toLowerCase()},this.secondsOnCurrentPage=function(){var e=Z(ee(t.getData("profileJSON"),1),1);return Y(Date.now(),e.start_time)},this.secondsOnSite=function(){var e=ee(t.getData("profileJSON"),1),i=Z(e,0);return Y(Z(e,1).end_time,i.start_time)},this.secondsFromLastVisit=function(){var e,i=ee(t.getData("profileJSON"),2,2,!1);if(i){var n=Z(i,2,1,!1);void 0!==n&&void 0!==n.end_time&&(e=Y(n.end_time))}return e},this.numberOfPagesVisited=function(){return ee(t.getData("profileJSON"),1).journey.length},this.geographicLocationItem=function(e){return ee(t.getData("profileJSON"),1).location[e]},this.numberOfTimesPageViewed=function(){for(var i=ee(t.getData("profileJSON"),1),n=0,r=1;r<=i.journey.length;r++){Z(i,2,r,!1).url===e.url&&n++}return n},this.referralURL=function(){return Z(ee(t.getData("profileJSON"),1),1).referral.url},this.lastPageVisitedItem=function(e){return Z(ee(t.getData("profileJSON"),1),2)[e]},this.previouslyVisitedItems=function(e){for(var i=ee(t.getData("profileJSON"),1),n=[],r=1;r<=i.journey.length;r++){var o=Z(i,2,r,!1);n.push(o[e])}return n},this.elementCount=function(e){return ni(Le(e)).length},this.elementValue=function(e){var t=ni(Le(e)),i={},n=!1;return t[0]&&"SELECT"===t[0].nodeName&&(t=ni(Le(e)).find("option:checked"),n=!0),n?(i.value=t.val(),i.text=t.text()):i.value=t.val()||t.text(),i},this.customValue=function(e){return V(window,"MoxieData",e)}}function er(e){this.siteRules=null,this.isTestMode=e.isTestMode,this.concierge=e,this.actionQueue=new Xn,this.rulesSucceeded={},this.categorySucceeded={},this.categorySucceeded[1]={},this.categorySucceeded[2]={},this.categorySucceeded[3]={},this.categorySucceeded[4]={},this.categorySucceeded[5]={}}zn.prototype.add=function(e){this.callbacks.push(e)},zn.prototype.doCallbacksAsync=function(e){for(var t=L.resolve(e),i=0;i<this.callbacks.length;i++)t=Gn(t,this.callbacks[i]);return t},zn.prototype.doCallbacksSync=function(e){for(var t=0;t<this.callbacks.length;t++)try{var i=this.callbacks[t](e);void 0!==i&&(e=i)}catch(e){q.error("Error in callback function: "+e)}return e},Kn.prototype.getServiceLines=function(){var e,t;return this.linesPromise||(this.linesPromise=(e=this.concierge,t=e.serviceUrl.connector+"/connector/channels/service_lines",e.httpGet(t).then((function(e){for(var t={},i=e.response,n=0;n<i.length;n+=1)t[i[n].id]=i[n].name;return t})).catch((function(e){throw q.log("Error in fetchServiceLines"+e),e})))),this.linesPromise},Kn.prototype.setName=function(e,t){this.names[e]=L.resolve(t)},Kn.prototype.getName=function(e){return this.names[e]?this.names[e]:this.getServiceLines().then((function(t){return t[e]})).catch((function(){}))},Xn.prototype={done:function(){return 0===this.queue.length?(this.isRunning=!1,this.finishedRunning&&this.finishedRunning(!0),!0):this.next()},enqueue:function(e){return this.queue.unshift(e),this.run()},next:function(){var e=this,t=this.queue.pop();return Ui((function(){var e=L.resolve(t.func(t.params.rule,t.params.parameters,t.params.type));return t.postAction?t.postAction(e):e})).catch((function(e){q.log("ActionQueue: Error thrown while executing action, "+t.label+"; "+e.message+"; "+e.stack)})).finally((function(){return e.done()}))},run:function(){var e=this;return!e.isRunning&&e.queue.length>0&&(e.isRunning=!0,e.whenDone=new L((function(t){e.finishedRunning=t})),setTimeout((function(){return e.isRunning?e.next().catch(Qn):null}))),this.whenDone}},er.prototype.ActionLibrary=Yn,er.prototype.CriteriaLibrary=Zn;var tr=function(e,t){return void 0===e?e:t?!e:e},ir=function(e,t,i){return e?[i,t]:[t,i]},nr=function(e,t,i){var n,r,o,a,s,c,u,l,d,g,h,f,p,v,m,w,y,b,S,C,_,E=i[0],I=i[2],N=i[5];if(1e3===E){for(var O=!0,T=0;T<I.length;T++)if(!nr(e,t,I[T])){O=!1;break}return N?!O:O}if(1001===E){for(var k=!1,x=0;x<I.length;x++)if(nr(e,t,I[x])){k=!0;break}return N?!k:k}var D,M,A,L,W=i[1],R=i[3],P=i[4];try{switch(W){case 21:return M=Date.now(),A=(n=ir(R,M,60*I*1e3))[0],L=n[1],D=Q(A,$(E,W),L),tr(D,N);case 19:return M=e.conciergeItem("url"),A=(r=ir(R,M,I))[0],L=r[1],D=Q(A,$(E,W),L),tr(D,N);case 20:return M=e.conciergeItem("pageTitle"),A=(o=ir(R,M,I))[0],L=o[1],D=Q(A,$(E,W),L),tr(D,N);case 1:return(M=e.visitorProfileGetTags())&&M.length?(D=-1!==M.indexOf(I),tr(D,N)):tr(!1,N);case 2:return M=e.visitsToSite(),A=(a=ir(R,M,I))[0],L=a[1],D=Q(A,$(E,W),L),tr(D,N);case 3:return M=e.currentCartValue(),A=(s=ir(R,M,I))[0],L=s[1],D=Q(A,$(E,W),L),tr(D,N);case 4:M=e.productsInCart(),D=!1;for(var j=0;j<M.length;j++){var V=M[j],F=$(E,W),J=ir(R,I,V.name),H=J[0],B=J[1],G=ir(R,I,V.skuOrId),z=G[0],K=G[1],Y=ir(R,I,V.sku_or_id),Z=Y[0],ee=Y[1];if(Q(H,F,B)||"string"==typeof z&&"string"==typeof K&&Q(z,F,K)||"string"==typeof Z&&"string"==typeof ee&&Q(Z,F,ee)){D=!0;break}}return tr(D,N);case 5:return M=e.userDeviceName(),A=(c=ir(R,M,I))[0],L=c[1],D=Q(A,$(E,W),L),tr(D,N);case 7:return M=e.secondsOnCurrentPage(),D=Q(A=(u=ir(R,M,I))[0],E,L=u[1]),tr(D,N);case 8:return!!(M=e.secondsFromLastVisit())&&(!(I>0)||(A=(l=ir(R,M,I))[0],L=l[1],D=Q(A,$(E,W),L),tr(D,N)));case 9:return M=e.numberOfPagesVisited(),A=(d=ir(R,M,I))[0],L=d[1],D=Q(A,$(E,W),L),tr(D,N);case 10:return M=e.geographicLocationItem("city"),A=(g=ir(R,M,I))[0],L=g[1],D=Q(A,$(E,W),L),tr(D,N);case 11:return M=e.geographicLocationItem("state"),A=(h=ir(R,M,I))[0],L=h[1],D=Q(A,$(E,W),L),tr(D,N);case 12:return M=e.geographicLocationItem("country"),A=(f=ir(R,M,I))[0],L=f[1],D=Q(A,$(E,W),L),tr(D,N);case 13:return M=e.numberOfTimesPageViewed(),A=(p=ir(R,M,I))[0],L=p[1],D=Q(A,$(E,W),L),tr(D,N);case 14:return M=e.referralURL(),A=(v=ir(R,M,I))[0],L=v[1],D=Q(A,$(E,W),L),tr(D,N);case 15:return M=e.lastPageVisitedItem("url"),A=(m=ir(R,M,I))[0],L=m[1],D=Q(A,$(E,W),L),tr(D,N);case 16:return M=e.lastPageVisitedItem("title"),A=(w=ir(R,M,I))[0],L=w[1],D=Q(A,$(E,W),L),tr(D,N);case 17:case 18:if((M=18===W?e.previouslyVisitedItems("title"):e.previouslyVisitedItems("url"))&&M.length){D=!1;for(var te=0;te<M.length;te++)if(A=(y=ir(R,M[te],I))[0],L=y[1],Q(A,$(E,W),L)){D=!0;break}return tr(D)}return!1;case 22:return M=e.secondsOnSite(),A=(b=ir(R,M,I))[0],L=b[1],D=Q(A,$(E,W),L),tr(D,N);case 1e3:return M=e.elementCount(P),tr(D=M>=1,N);case 1001:return M=e.elementValue(P),U(E=$(E,W,I))&&isNaN(X(M.value))&&(M.value="",M.text&&(isNaN(X(M.text))||(M.value=M.text,delete M.text))),""!==M.value&&(!(D=Q(A=(S=ir(R,M.value,I))[0],E,L=S[1]))&&M.text&&(D=Q(A=(C=ir(R,M.text,I))[0],E,L=C[1])),tr(D,N));case 1002:return null!=(M=e.customValue(P))&&(A=(_=ir(R,M,I))[0],L=_[1],void 0!==(D=Q(A,$(E,W,I),L))&&tr(D,N));default:return q.error("Unknown Scope/Criteria input value:",W),!1}}catch(e){var ie=t[0];return q.error('Moxie Concierge Client: Scope/Criteria Eval Error ("'+ie+'" input:'+W+"): "+e.message),!1}},rr=function(e,t){var i=t[3];return null===i||nr(e,t,i)},or=function(e){var t=e[6];return{name:e[0],id:e[1],source:"offer",monitor:e[2],action:{success:e[5]},criteria:e[6],ruleArray:e,hasEvent:!!t}},ar=function(e,t,i){var n=this,r=ni(Le(t)),o=r.length,a=function(t){n.evalRule(e,!0)&&n.queueActions(e)},s=!0;return this.isTestMode&&(s=-1===window.location.search.indexOf("noDirectEventHandlers")),s&&Te(r,(function(e){mt(e,i,a),n.eventListenerArgs.push([e,[i,a]])})),o};function sr(e){for(var t=e.type,i=this.bodyEventListeners[t],n=[],r=0;r!==i.length;r++){for(var o=i[r],a=this.siteRules.rules[o][6],s=!1,c=0;c!==a.length&&!s;c++){var u=a[c],l=u[0];if(-1!==u[1].indexOf(t)){var d=Le(l);if(0!==d.length)for(var g=e.target;null!=g&&!s;){for(var h=0;h!==d.length&&!s;h++){s=d[h].isSameNode(g)}g=g.parentNode}}}s&&n.push(o)}for(var f=0;f!==n.length;f++){var p=n[f],v=this.ruleObjectsByIndex[p];this.evalRule(v,!0)&&this.queueActions(v)}}er.prototype.removeAllEventListeners=function(){this.eventListenerArgs.forEach((function(e){var t=e[0],i=e[1];wt.apply(void 0,[t].concat(i))}))},er.prototype.init=function(e){var t=this;this.siteRules=e,this.actionLibrary=new Yn(this.concierge),this.criteriaLibrary=new Zn(this.concierge),this.bodyEventListeners={},this.ruleObjectsByIndex=[],this.eventListenerArgs=[];for(var i=0;i<this.siteRules.rules.length;i++){var n=this.siteRules.rules[i],r=or(n);if(rr(this.criteriaLibrary,n)){this.ruleObjectsByIndex[i]=r;var o=n[6];if(o&&o.length)for(var a=0;a!==o.length;a++){var s=o[a],c=s[0],u=s[1];if(u&&u.length)for(var l=0;l!==u.length;l++){var d=u[l];0===ar.bind(this)(r,c,d)&&(void 0===this.bodyEventListeners[d]&&(this.bodyEventListeners[d]=[]),-1===this.bodyEventListeners[d].indexOf(i)&&this.bodyEventListeners[d].push(i))}}}r.monitor&&!r.hasEvent&&this.concierge.contextMonitor.register(r)}var g=document.body,h=!0;if(this.isTestMode&&(h=-1===window.location.search.indexOf("noBodyEventHandler")),g&&h){var f=sr.bind(this);Object.keys(this.bodyEventListeners).forEach((function(e){mt(g,e,f),t.eventListenerArgs.push([g,[e,f]])}))}},er.prototype.getSiteRules=function(){return this.siteRules||{}},er.prototype.getSiteSettings=function(){return this.siteRules.settings||{}},er.prototype.queueWaitTime=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.queue_wait_time>=0?this.siteRules.settings.queue_wait_time:5},er.prototype.minTimeBetween=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.min_time_between>=0?this.siteRules.settings.min_time_between:60},er.prototype.hideWhenServiceLineClosed=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.hide_on_demand_chat_when_service_line_is_closed},er.prototype.checkQueueWaitTimeForReactive=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.use_min_time_between_for_on_demand_chat},er.prototype.checkQueueWaitTimeForProactive=function(){return this.siteRules&&this.siteRules.settings&&this.siteRules.settings.use_min_time_between_for_proactive_chat},er.prototype.run=function(){var e,t,i;for(e=[],t=0;t<this.siteRules.rules.length;t++){var n=this.siteRules.rules[t],r=or(n);i=this.evalRule(r),e.push({ruleset:r,success:i}),i&&V(r,"action","success")&&this.queueActions(r)}return e},er.prototype.evalRule=function(e,t){if(t=!!t,e.hasEvent&&!t)return!1;var i=e.ruleArray,n=i[1];if(this.rulesSucceeded[n])return!1;var r=rr(this.criteriaLibrary,i);return!!r&&(!!(r=function(e,t){var i=t[4];return null===i||nr(e,t,i)}(this.criteriaLibrary,i))&&(i[5]&&(this.rulesSucceeded[n]=!0),!0))},er.prototype.isRedundantAction=function(e,t,i,n){return 4!==e&&5!==e&&(!n&&((!i||!i.length)&&(this.categorySucceeded[e][t]||this.categorySucceeded[2][t])))},er.prototype.isRemoveOk=function(e){return this.categorySucceeded[1][e]||this.categorySucceeded[3][e]},er.prototype.queueActions=function(e){var t,i,n,r,o,a=e.criteria,s=void 0!==e.monitorId||e.hasEvent,c=this.concierge.cacheManager.getDataClone("profileJSON"),u=[1,3,4,5];if(e.action&&e.action.success)for(var l=0;l<e.action.success.length;l++)if(i=(t=e.action.success[l])[0],n=t[1],r=t[2],null!==n&&(r.widget=H(n)),!(this.isRedundantAction(i,n,a,s)||2===i&&this.isRemoveOk(n))){o=-1!==u.indexOf(i)&&function(e,t,i,n,r,o){return o.then((function(i){if(i&&i.status)if(1===t||3===t){var o=null;i.parameters&&i.parameters.serviceLineId&&(o=i.parameters.serviceLineId);var a=null;i.parameters&&i.parameters.widget&&(a=i.parameters.widget);var s="reactive";3===t&&(s="proactive"),Fi(e,n,r,o,a,s)}else if(4===t||5===t){Vi(4===t,e,i.tags,n,r)}return null}))}.bind(void 0,this.concierge,i,c,e.id,l);try{this.actionQueue.enqueue({label:e.name+":"+l+":"+i,func:this.actionLibrary[i],params:{rule:e,parameters:this.concierge.contextMonitor.parseMappedContext(r),type:"success"},postAction:o}),this.categorySucceeded[i][n]=!0}catch(t){q.log('Moxie Concierge Client: Action Function Error ("'+e.name+'" action:'+l+"): "+t.message)}}};function cr(e){var t,i;this.wm=e,this.concierge=e.concierge,Kr(e)?this.spots=((t={}).single=new ur("single"),t):this.spots=((i={}).chat=new ur("chat"),i.kb=new ur("kb"),i.email=new ur("email"),i),this.offer=null,this.notification=null,this.open=null,this.active=[],this.alive=[]}function ur(e){this.name=e,this.reactive=null,this.widget=null,this.twiddled=!1}function lr(e,t){return e.spots[t]}function dr(e,t){var i=t.preferredSpotName();return i?Kr(e.wm)?"single":ne(e.spots,i)?i:null:null}function gr(e,t){if(e.wm.notificationDisplayed())return!1;if(fr(e))return!1;if(hr(e))return!1;if(pr(e))return!1;var i=dr(e,t);if(i){var n=V(lr(e,i),"widget");if(n&&!n.hasFinished&&0!==n.state)return!1}return!0}function hr(e){return!!e.offer}function fr(e){return!!e.open}function pr(e){return!!e.notification}function vr(e,t){return $r(t)?function(e,t){if(null===t.preferredSpotName())return!0;var i=lr(e,t.spot);if(i){if(!i.widget)return!0;if(Mr(e,i.widget))return!1;if(i.widget.hasFinished)return!0;if(i.widget.priority<t.priority)return!0;if(0===i.widget.state)return!0}return!1}(e,t):t.parameters.proactive||!1?function(e,t){if(hr(e))return!1;if(null===t.preferredSpotName())return!0;var i=lr(e,t.spot);if(i){if(!i.widget)return!0;if(i.widget.priority<t.priority)return!0;if(i.widget.hasFinished)return!0;if(0===i.widget.state)return!0}return!1}(e,t):function(e,t){var i=lr(e,t.spot);if(i){if(!i.reactive)return!0;if(i.reactive.priority<t.priority)return!0}return!1}(e,t)}function mr(e,t){t&&(e.open===t&&Zr(e.wm,!1),t.unload())}function wr(e,t){var i=lr(e,t.spot);i&&i.widget!==t&&(mr(e,i.widget),i.widget=t,e.wm.engagementWidgets.widgets[t.name]=t,e.wm.widgetsType.updateWidgetElement(t),e.notification&&e.wm.widgetsType.updateNotification())}function yr(e,t){var i=lr(e,t);return i&&i.widget?i.widget:null}function br(e,t,i){var n=t.spot;if(t.parameters.proactive&&!e.wm.loadingActiveWidgets)return e.offer=t,void function(e,t,i){var n=lr(e,t);n&&!n.widget&&wr(e,i)}(e,n,t);var r=lr(e,n);r&&($r(t)||(r.reactive=t),(i||function(e,t,i){return!t||!Mr(e,t)&&(!!t.hasFinished||(i.priority>t.priority||0===t.state))}(e,r.widget,t))&&wr(e,t))}function Sr(e,t){var i=t.parameters;i.rule=i.rule||{},i.proactive=!0;var n=t.label();if(function(e){var t=1e3*e.rulesEngine.minTimeBetween();if(t<=0)return!1;return Date.now()<function(e){var t=Number(e.cacheManager.getClientCache("lastNotified"));return isNaN(t)?0:t}(e)+t}(e.concierge))return q.log("wmStateMakeOffer("+n+"): notified too soon"),L.resolve(Ur);if(!gr(e,t))return q.log("wmStateMakeOffer("+n+"): cannot display notification"),L.resolve(Ur);if(function(e){for(var t=e.active,i=t.length,n=0;n<i;n++)if(t[n].configuration.blockOffersWhileActive)return!0;return!1}(e))return q.log("wmStateMakeOffer("+n+"): blockOffersWhileActive true"),L.resolve(Ur);q.log("wmStateMakeOffer("+n+"): invoked.");var r=e.wm,o=r.createEngagementRecord(t);t.engagementId=o;var a={status:!0,ref:t,parameters:t.parameters,engagementId:o,rule:t.parameters.rule};return t.beforeNotify(a).then(to(r,(function(){return Dr(e,t)}))).then(to(r,(function(){return gr(e,t)?(xr(e,t),t.autoOpen?L.resolve(r.widgetsType.openConcierge(t)).then((function(){return Ur})):a):(q.log("WidgetManager.notify("+n+"): cannot display notification after beforeNotify is complete"),L.resolve(Ur))}))).then(to(r,(function(){t.notificationType=1,e.notification=t,r.showNotification(t);var i=r.getEngagementRecord(o);return null!==i&&(i.decision_type="Ignored",r.setEngagementRecord(o,i)),a}))).then(to(r,(function(e){return q.log("wmStateMakeOffer("+n+"): ready to notify."),e}))).catch((function(e){var t=e.message?e.message:e;return q.log("wmStateMakeOffer("+n+"): error: "+t+"\n"+e.stack),Ur}))}function Cr(e,t){var i=lr(e,t);null!=i&&(q.log('wmState twiddling spot: "'+t+'"'),i.twiddled=!0)}function _r(e){if(hr(e)){var t=e.offer;!function(e,t){if(!t)return;var i=t.engagementId,n=e.getEngagementRecord(i),r=t.parameters;if("chat"===t.name){if(n.proactive&&r.rule){var o=new Date(n.time).getTime();n.chat.time_to_decide=Math.round(((new Date).getTime()-o)/1e3),n.decision_type="Declined",e.setEngagementRecord(i,n)}}else null!==n&&n.proactive&&(n.decision_type="Declined",e.setEngagementRecord(i,n))}(e.wm,t),Er(e),e.wm.broadcastCloseProactiveNotification(t,"declined")}}function Er(e){if(hr(e)){var t=e.offer,i=lr(e,t.spot);e.offer=null,i&&i.widget===t?i.reactive&&i.reactive!==t&&wr(e,i.reactive):mr(e,t)}}function Ir(e){if(pr(e)){var t=e.notification;Ji("notification",{widgetName:zr(t.name),rule:t.parameters.rule,engagementId:t.engagementId,notificationType:eo(t.notificationType),status:"closed"}),e.wm.setNotificationType(0);var i=e.wm.widgetsType.closeNotification();return e.notification=null,i}}function Nr(e){if(pr(e)){var t=e.notification;Ir(e),hr(e)?function(e){var t=e.offer;t&&(e.offer=null,e.wm.broadcastCloseProactiveNotification(t,"accepted"),wr(e,t),0===t.state&&t.execute(e.wm),Cr(e,t.spot))}(e):e.wm.showWidget(t)}}function Or(e){pr(e)&&(Ir(e),hr(e)&&_r(e))}function Tr(e){pr(e)&&(Ir(e),hr(e)&&function(e){hr(e)&&Er(e)}(e))}function kr(e,t){var i=t.label();return Dr(e,t).then((function(n){return n.status?(xr(e,t),t.autoOpen?L.resolve(e.wm.widgetsType.openConcierge(t)).then((function(){return n})):n):(q.log("WidgetManager.addWidget("+i+"): did not add widget"),n)})).catch((function(e){return q.log("WidgetManager.addWidget("+i+"): failed: "+e),q.log(e.stack),Ur}))}function xr(e,t){var i=e.wm,n=t.name,r=t.spot;if(br(e,t,!1),r){var o=Qr(r);if(0===o.length)i.widgetsType.addWidget(t);else{var a=o.find("button");t.buttonEnabled?a.removeAttr("disabled"):a.attr("disabled","")}}t.shouldDisplayBell()&&(i.shouldDisplayBell=!0),ni("#concierge").show();var s=ni("#concierge-tab");Kr(i)&&i.isMobile()&&i.shouldDisplayBell?s.show():i.shouldDisplayBell&&!Kr(i)?s.show():s.hide(),q.log("wmStateAddWidget("+t.label()+"): complete OK"),Ji("widgetAdded",{widgetName:zr(n),rule:{id:V(t,"parameters","rule","id"),name:V(t,"parameters","rule","name")}})}function Dr(e,t){t.parameters=t.parameters||{};var i=t.parameters,n=e.wm,r=t.engagementId;if(q.log("wmStatePrepareToAddWidget called with:",i,r),i.proactive=i.proactive||!1,i.rule=i.rule||{},$r(t)&&(t.priority=2),t.spot=dr(e,t),!vr(e,t))return L.resolve(Ur);var o=t.label();q.log("wmStatePrepareToAddWidget("+o+"): invoked.'");var a={status:!0,ref:t,parameters:i,proactive:i.proactive,engagementId:r,ruleSettings:n.concierge.rulesEngine.getSiteSettings()};return t.beforeAdd(a).then(to(n,(function(e){return void 0!==t.prepareToLoad&&(t.prepareToLoadPromise=t.prepareToLoad(e).then((function(e){return e&&e.autoOpen?n.widgetsType.openConcierge(t):e}))),e})))}function Mr(e,t){return G(e.active,t)>=0}function Ar(e,t){G(e.alive,t)<0&&e.alive.push(t)}function Lr(e,t){var i=G(e.alive,t);i>=0&&e.alive.splice(i,1)}function Wr(e,t){var i=e.wm.concierge.cacheManager.getClientCache("drag_position",!0);return i&&i.left&&i.top&&i.initialElemData&&i.initialConfigData&&(e.wm.isDragConfigDataEqualToCurrent(i.initialConfigData)?(e.wm.widgetAreaDragData.x=i.left,e.wm.widgetAreaDragData.y=i.top,e.wm.widgetAreaDragData.initialElemData=i.initialElemData,e.wm.widgetAreaDragData.draggedByUser=!0):e.wm.concierge.cacheManager.removeClientCache("drag_position",!0)),Mr(e,t)?L.resolve(null):(t.active=!0,e.active.push(t),Ji("widgetActivated",{widgetName:t.name}),Pr(e))}function Rr(e,t){var i=G(e.active,t);i>=0&&(t.active=!1,e.active.splice(i,1),Pr(e)),0===e.active.length&&e.wm.concierge.cacheManager.removeClientCache("drag_position",!0)}function Pr(e){var t=e.active.map((function(e){return{widgetName:e.name,loadParams:e.parameters}}));return e.wm.concierge.cacheManager.setClientCache("activeWidgets",t)}function jr(e){return 9===e}function Vr(e){return 13===e}function Fr(e){return 32===e}function qr(e){return 38===e}function Jr(e){return 40===e}function Hr(e){return"externalAPI"===e||"externalLink"===e}function $r(e){return Hr(V(e,"parameters","rule","source"))}var Ur={status:!1};function Br(e){return"kbot"===e}function Gr(e){return function(e){return"chat"===e}(e)||Br(e)}function zr(e){return Br(e)?"chat":e}function Kr(e){return!!e.engagementWidgets.globalSettings.singleChannelMode}function Xr(e,t){var i=lr(e,t.spot);return!i||(!i.widget||t!==i.widget&&(!Mr(e,i.widget)&&(!!t.parameters&&!!function(e,t){if(!e||!t)return!0;var i=e.parameters,n=t.parameters;if(!i||!n)return!1;if(e.name!==t.name)return!0;switch(e.name){case"chat":if(parseInt(i.portalId,10)!==parseInt(n.portalId,10))return!0;break;case"kb":if(parseInt(i.portalId,10)!==parseInt(n.portalId,10))return!0;if(""+i.searchText!=""+n.searchText)return!0;if(""+i.articleId!=""+n.articleId)return!0;break;case"email":if(parseInt(i.mailboxId,10)!==parseInt(n.mailboxId,10))return!0}return!1}(i.widget,t))))}function Qr(e){return ni('#concierge-widgets ul li[data-spot="'+e+'"]')}function Yr(e){if(void 0!==e){var t,i;try{t=e.width.animVal.value,i=e.height.animVal.value}catch(e){return!1}et(e,"viewBox")||tt(e,"viewBox","0 0 "+t+" "+i),tt(e,"height",25),tt(e,"width",25)}}function Zr(e,t){var i=L.resolve(),n=e.wmState.open;if(!n)return i;var r=ni("#concierge-widget-area");r.removeClass("con-open"),e.widgetsType.closeWidgets&&e.widgetsType.closeWidgets();var o=n.name;return e.$concierge.find("#concierge-widgets li[data-widget="+o+"] .con-icon").attr("aria-expanded","false"),"Tablet"===e.device&&(r.hasClass("con-animating")&&(i=i.then((function(){return r.promise()}))),i=i.then((function(){e.makePositionFixed(),e.forceBlur()}))),e.$concierge.removeClass("con-open-widget"),e.openWidget=!1,e.wmState.open=null,i.then((function(){if(e.widgetsType.focusWidgetButton(o),t)return Ji("widgetClosed",{widgetName:o})})).catch((function(e){q.log("Error Closing Widget:"+e)}))}function eo(e){var t="other";return 2===e?t="widgetMessage":1===e&&(t="proactiveOffer"),t}function to(e,t){return function(i){return!e._disabled&&i&&i.status?t(i):i&&!i.status?i:Ur}}function io(e,t){var i=e.wmState,n=ni("#concierge-widgets ul"),r=n.children("li");if(!(r.length<=1)){var o=t?1:-1;r.sort((function(e,t){var n=e.getAttribute("data-spot"),r=t.getAttribute("data-spot"),a=lr(i,n).widget.sortKey,s=lr(i,r).widget.sortKey;return a>s?1*o:a<s?-1*o:0})),r.detach().appendTo(n)}}function no(e,t,i,n,r){if(e&&parseInt(t,10)>i&&!n&&!r)throw new Error("queue wait time is too long");return!0}function ro(e,t){var i=e.getDataClone("profileJSON"),n=i.session.visits.length-1,r=i.session.visits[n].journey.length-1;i.session.visits[n].journey[r].engagements||(i.session.visits[n].journey[r].engagements=[]),i.session.visits[n].journey[r].engagements.push(t),e.setData("profileJSON",JSON.stringify(i))}function oo(e,t,i){for(var n=e.getData("profileJSON"),r=n.session.visits[n.session.visits.length-1].journey,o=r.length-1,a=JSON.stringify(i),s=o;s>=0;s--){var c=r[s].engagements;if(c)for(var u=c.length-1;u>=0;u--){var l=c[u];if(l.id===t){if(JSON.stringify(l)===a)return L.resolve();if(i.dirty=!0,s===o)c[u]=i;else{c.splice(u,1),0===c.length&&delete r[s].engagements;var d=r[o];d.engagements?d.engagements.push(i):d.engagements=[i]}return e.setData("profileJSON",JSON.stringify(n))}}}return L.resolve()}function ao(e,t){for(var i=e.getDataObject("profileJSON"),n=i.session.visits.length-1,r=0;r<i.session.visits[n].journey.length;r++)if(i.session.visits[n].journey[r].engagements)for(var o=0;o<i.session.visits[n].journey[r].engagements.length;o++)if(i.session.visits[n].journey[r].engagements[o].id===t)return te(i.session.visits[n].journey[r].engagements[o]);return null}function so(e,t){t=t||{},this.concierge=e,this.isValid=this.validateParams(t),this.config=t}function co(e,t){t&&(t.conciergeV2=this,e.isTestMode&&(this.root=e)),this.broadcast=co.broadcast,this.transactionComplete=function(t){return e.ready.then((function(){var i,n,r,o;return i=e.cacheManager,(r=i.getDataClone("profileJSON")).last_updated=Date.now(),r.session.transaction_completed=!0,void 0!==t&&(r=Hi(r,t,e),o=t.vendorTxnId),n=Z(ee(r,1),1),e.contextMonitor.stop(),i.setData("profileJSON",JSON.stringify(r),!0).then((function(){return Ji("transactionCompleted",{transactionTotal:r.session.end_cart_value,cart:{value:n.current_cart_value,items:n.current_cart_items}}),Ni(e,r.session.end_cart_value,o),e.contextMonitor.initTracking().then((function(){e.contextMonitor.start()}))}))}))},this.updateSession=function(t){return e.ready.then((function(){var i,n;return t=t||{},n=Hi((i=e.cacheManager).getDataClone("profileJSON"),t,e),i.setData("profileJSON",JSON.stringify(n))}))},this.startEngagement=function(t){return e.ready.then((function(){var i=e.widgetManager;if(!t||"string"!=typeof t.widget)throw q.log("GoMoxie.concierge.startEngagement: missing required configuration parameter"),new Error("GoMoxie.concierge.startEngagement: missing required configuration parameter");if($i(t.widget))return L.reject(new Error("The engagement type is not allowed: "+t.widget));if(!i.engagementWidgets.widgets[t.widget])throw q.log('GoMoxie.concierge.startEngagement: invalid value for configuration parameter "widget"'),new Error('GoMoxie.concierge.startEngagement: invalid value for configuration parameter "widget"');if(!i.isValidEngagementConfig(t))throw q.log("GoMoxie.concierge.startEngagement: invalid widget configuration"),new Error("GoMoxie.concierge.startEngagement: invalid widget configuration");return i.startExternal("externalAPI",t)}))},this.closeNotification=function(t){return e.ready.then((function(){var i=e.widgetManager;return t?Or(i.wmState):Tr(i.wmState)}))},this.startTrackingEngagement=function(t){return e.ready.then((function(){new so(e,t).startEngagement()}))},this.updatePage=function(t,i){var n=null;return e.ready.catch((function(){return!1})).then((function(){return e.eventService.clearHistoryStub||(n=e.eventService),e.rulesEngine.removeAllEventListeners(),e.contextMonitor.stop(),e.cacheManager&&e.cacheManager.cleanup(),e.widgetManager.destroy(),null})).then((function(){return e.prepare(t,i,{eventService:n}),e.init()})).then((function(){return function(e){delete e._clearingHistoryPromise}(e),null}))},this.clearHistory=function(){var t=e.loadState;if("READY"!==t&&"LOADING"!==t)return L.reject(new Error("Invalid State: "+t+". Can only be invoked in READY or LOADING states."));function i(){return e.loadState="CLEARING",yn(e)}return e.loadState="CLEARING",("READY"===t?i():e.apiReady.then(i)).then((function(){return e.loadState="CLEARED",null}))};var i={},n=function(e){return e.status},r=function(e){return q.log("checkAvailability error thrown: "+e.message),!1};this.checkAvailability=function(t,o){return e.ready.then((function(){if("chat"===t&&void 0===o.portalId)return e.rulesEngine.actionQueue.whenDone})).then((function(){var a={parameters:o},s=e.widgetManager,c="availability";if("chat"===t){if(void 0===o.portalId){var u=s.engagementWidgets.widgets.chat.portalId;if(void 0===u)throw new Error("No Moxie portal/mailbox ID specified for engagement.");a.parameters.portalId=u}a.ruleSettings=e.rulesEngine.getSiteSettings(),c+="|"+o.portalId+"|"+s.device}var l=s.engagementWidgets.widgets[t],d=Date.now(),g=i[c];return g&&g.timeout>d?g.value:(g={timeout:d+5e3,value:l.checkAvailability(a).then(n,r)},i[c]=g,g.value)}))},this.customData=function(t){return e.ready.then((function(){var i=e.cacheManager,n=i.getDataClone("profileJSON");if(void 0===n)throw new Error("Could not find visitor profile.");if(void 0===t)return n.customData;if(!JSON.stringify(t))throw new Error("Could not stringify customData");return n.customData=t,i.setData("profileJSON",JSON.stringify(n)).then((function(){return t}))}))},this.channelsData=function(t){return e.ready.then((function(){var i=e.cacheManager;return void 0===t?i.getVolatileData("moxie_channels_custom_data"):i.setVolatileData("moxie_channels_custom_data",t)}))},this.channelsFormData=function(t){return e.ready.then((function(){var i=e.cacheManager;return void 0===t?i.getVolatileData("moxie_channels_form_data"):i.setVolatileData("moxie_channels_form_data",t)}))},this.onQuestionnaireLoaded=function(t){e.onQuestionnaireLoadedCallbacks.add(t)},this.onQuestionnaireSubmit=function(t){e.onQuestionnaireSubmitCallbacks.add(t)}}function uo(){function e(e){return e.status}function t(e){return q.log("checkAvailability error thrown: "+e.message),"false"}this.broadcast=uo.broadcast,this.transactionComplete=function(e,t){var i,n,r;return i=e.cacheManager,(r=i.getDataClone("profileJSON")).last_updated=Date.now(),r.session.transaction_completed=!0,void 0!==t&&(r=Hi(r,t,e)),n=Z(ee(r,1),1),e.contextMonitor.stop(),i.setData("profileJSON",JSON.stringify(r),!0).then((function(){return uo.broadcast("transactionCompleted",{transactionTotal:r.session.end_cart_value,cart:{value:n.current_cart_value,items:n.current_cart_items}}),Ni(e,r.session.end_cart_value),e.contextMonitor.initTracking().then((function(){e.contextMonitor.start()}))}))},this.updateSession=function(e,t){var i,n;t=t||{},n=Hi((i=e.cacheManager).getDataClone("profileJSON"),t,e),i.setData("profileJSON",JSON.stringify(n))},this.startEngagement=function(e,t){var i,n,r={};if(n=e.widgetManager,t&&"string"==typeof t.widget){if($i(t.widget))throw new Error("The engagement type is not allowed: "+t.widget);if(n.engagementWidgets.widgets[t.widget]){if(n.isValidEngagementConfig(t)){for(i in ne(t,"enableChatDeflection")&&!0===t.enableChatDeflection&&(t.widget="kbot"),t)ne(t,i)&&(r[i]=t[i]);var o={name:t.ruleName,source:"externalAPI",id:-2,action:"success"};return r.rule=o,n.addWidget(t,o).then((function(e){!1!==n.openWidget&&n.openWidget!==t.widget&&n.hideWidget(!0),Or(n.wmState),n.showWidget(e.ref),n.showConcierge(),n.widgetsType.openConcierge()}))}q.log("GoMoxie.concierge.startEngagement: invalid widget configuration")}else q.log('GoMoxie.concierge.startEngagement: invalid value for configuration parameter "widget"')}else q.log("GoMoxie.concierge.startEngagement: missing required configuration parameter")},this.closeNotification=function(e,t){var i=e.widgetManager;return t?Or(i.wmState):Tr(i.wmState)},this.startTrackingEngagement=function(e,t){new so(e,t).startEngagement()},this.updatePage=function(e,t,i){var n;return e.ready.catch((function(){return!1})).then((function(){return e.eventService.stub||(n=e.eventService),e.rulesEngine.removeAllEventListeners(),e.contextMonitor.stop(),e.cacheManager.cleanup(),e.widgetManager.destroy(),null})).then((function(){return e.init(t,i,{eventService:n})}))},this.checkAvailability=function(i,n,r,o){var a,s,c,u,l,d,g,h,f,p;if(a={parameters:r},s=i.cacheManager,c=i.widgetManager,h=r.portalId,u="availability",l="availability-timestamp","chat"===n){if(void 0===h){if(void 0===(g=c.engagementWidgets.widgets.chat.portalId))return void q.log("No Moxie portal/mailbox ID specified for engagement.");h=g,a.parameters.portalId=h}a.ruleSettings=i.rulesEngine.getSiteSettings(),u+="|"+h+"|"+c.device,l+="|"+h+"|"+c.device}return d=c.engagementWidgets.widgets[n],p=1e5,(f=s.getWidgetCache(n,l,!1))&&(p=(Date.now()-f)/1e3),(f&&p<=5&&s.getWidgetCache(n,u,!1)?L.resolve(s.getWidgetCache(u)):d.checkAvailability(a).then(e,t).then((function(e){return L.all([s.setWidgetCache(n,u,e,!1),s.setWidgetCache(n,l,Date.now(),!1)]).then((function(){return e}))}))).then((function(e){return o(e),e}))},this.customData=function(e,t){var i,n;return n=(i=e.cacheManager).getDataClone("profileJSON"),void 0===t?void 0!==n?n.customData:void 0:!!JSON.stringify(t)&&(n.customData=t,i.setData("profileJSON",JSON.stringify(n)),!0)},this.channelsData=function(e,t){var i=e.cacheManager;if(void 0===t)return i.getVolatileData("moxie_channels_custom_data");try{i.setVolatileData("moxie_channels_custom_data",t)}catch(e){return q.log("channelsData: "+e),!1}return!0},this.channelsFormData=function(e,t){var i=e.cacheManager;if(void 0===t)return i.getVolatileData("moxie_channels_form_data");try{i.setVolatileData("moxie_channels_form_data",t)}catch(e){return q.log("Error: "+e),!1}return!0},this.onQuestionnaireLoaded=function(e,t){e.onQuestionnaireLoadedCallbacks.add(t)},this.onQuestionnaireSubmit=function(e,t){e.onQuestionnaireSubmitCallbacks.add(t)},this.registerMethods=function(e,t){void 0!==t&&void 0!==t.concierge&&(t.concierge.updateSession=this.updateSession.bind(void 0,e),t.concierge.transactionComplete=this.transactionComplete.bind(void 0,e),t.concierge.startEngagement=this.startEngagement.bind(void 0,e),t.concierge.checkAvailability=this.checkAvailability.bind(void 0,e),t.concierge.customData=this.customData.bind(void 0,e),t.concierge.closeNotification=this.closeNotification.bind(void 0,e),t.concierge.channelsData=this.channelsData.bind(void 0,e),t.concierge.channelsFormData=this.channelsFormData.bind(void 0,e),t.concierge.startTrackingEngagement=this.startTrackingEngagement.bind(void 0,e),t.concierge.onQuestionnaireLoaded=this.onQuestionnaireLoaded.bind(void 0,e),t.concierge.onQuestionnaireSubmit=this.onQuestionnaireSubmit.bind(void 0,e),t.concierge.updatePage=this.updatePage.bind(void 0,e),e.isTestMode&&(t.concierge.root=e))}}function lo(e){return e.signature="moxie_concierge",e}so.prototype.startEngagement=function(){if(!this.isValid)return q.log("GoMoxie.concierge.startTrackingEngagement: unable to start engagement that had an invalid configuration"),!1;var e=function(e){var t={chat:null,decision_type:"",email:null,id:tn(),kb:null,name:e.engagementType,proactive:!1,rule:{name:e.ruleName,source:"externalAPI",id:-2,ruleAction:"success"},time:Date.now(),type:2};for(var i in e)"engagementType"!==i&&"ruleName"!==i&&ne(e,i)&&(t[i]=e[i]);return t}(this.config);return ro(this.concierge.cacheManager,e),!0},so.prototype.validateParams=function(e){var t,i;for(t in i=!0,"object"==typeof e&&e.engagementType&&e.ruleName||(q.log("GoMoxie.concierge.TrackingEngagement.validateParams: missing required configuration parameter"),i=!1),e)ne(e,t)&&"string"!=typeof e[t]&&(q.log("GoMoxie.concierge.TrackingEngagement.validateParams: invalid engagement parameter: "+t),i=!1);return i},co.broadcast=Ji,uo.broadcast=Ji;var go=[" ","\n","\t"];function ho(){this.outputRaw=[],this.outputSub=[],this.currentSub=null,this.state=1,this.compiled=[],this.actions=[]}function fo(e){var t=new ho;return t.compile(e),function(e){return t.evaluate(e)}}ho.prototype.compile=function(e){var t,i;for(t=0;t!==e.length;t++)switch(i=e[t],this.state){case 1:this.handleStateInput(i);break;case 2:this.handleStateOpen(i);break;case 4:this.handleStateSubOperator(i);break;case 3:this.handleStateSubInit(i);break;case 5:this.handleStateSub(i);break;case 6:this.handleStateSubFinal(i);break;case 7:this.handleStateClose(i)}var n=[],r=null;for(t=0;t!==this.outputRaw.length;t++)null===(i=this.outputRaw[t])?null!==r&&(n.push([r,t]),r=null):null===r&&(r=t);null!==r&&n.push([r,this.outputRaw.length]),this.outputSub.reduce((function(e,t){return null!==t&&e.push(t),e}),[]);var o=0;for(t=0;t!==n.length;t++){r=n[t][0];for(var a=n[t][1];o!==r;o++)this.actions.push(2),this.compiled.push(this.outputSub[o]);this.compiled.push(this.outputRaw.slice(r,a).join("")),o=a,this.actions.push(1)}this.outputRaw=null,this.outputSub=null},ho.prototype.evaluate=function(e){for(var t,i=[],n=0;n!==this.actions.length;n++){switch(this.actions[n]){case 1:i.push(this.compiled[n]);break;case 2:null!=(t=e[this.compiled[n]])&&i.push(t)}}return i.join("")},ho.prototype.handleStateInput=function(e){"<"===e?this.state=2:(this.outputRaw.push(e),this.outputSub.push(null))},ho.prototype.handleStateOpen=function(e){"%"===e?this.state=4:(this.outputRaw.push("<"),this.outputRaw.push(e),this.outputSub.push(null),this.outputSub.push(null),this.state=1)},ho.prototype.handleStateSubOperator=function(e){if("="!==e)throw new Error("Operator for the template must be '=', not '"+e+"'");this.state=3},ho.prototype.handleStateSubInit=function(e){-1===go.indexOf(e)&&(this.currentSub=[e],this.state=5)},ho.prototype.handleStateSub=function(e){if(-1===go.indexOf(e))return"%"===e?(this.finishSub(),void(this.state=7)):void this.currentSub.push(e);this.finishSub(),this.state=6},ho.prototype.finishSub=function(){this.outputSub.push(this.currentSub.join("")),this.outputRaw.push(null),this.currentSub=null},ho.prototype.handleStateSubFinal=function(e){if(-1===go.indexOf(e)){if("%"!==e)throw new Error("Stray character '"+e+"' after substitution");this.state=7}},ho.prototype.handleStateClose=function(e){if(">"!==e)throw new Error("Invalid sequence '"+e+"' after closing percent sign");this.state=1};var po=function(e){e.$notifAnimate&&(e.$notifAnimate.stop(!0,!0),delete e.$notifAnimate),e.$areaAnimate&&(e.$areaAnimate.stop(!0,!0),delete e.$areaAnimate)},vo=function(e){return 0===e.tabStyle.cascade},mo=function(e,t){var i=t.index();if(i<0)return 0;vo(e)||(i=t.parent().children("li").length-(i+1));return i+1},wo=function(e,t,i){var n=e.widgetsType.getNotification(),r=t.children("ul").first(),o=r.height(),a=r.children("li").length,s={display:"block",height:o+65},c={opacity:1},u={opacity:0};if(vo(e)?(c.top=40,u.top=-(50*a-10),s.top=25):(c.bottom=-10,u.bottom=-(o+30),s.bottom=25),r.data("animating")?(r.stop(),n.stop()):(r.css(c),t.addClass("con-animating")),t.css(s),r.data("animating",!0).animate(u,{label:"desktopWidgetsClose",done:function(){t.removeAttr("style"),t.removeClass("con-animating"),r.removeAttr("style").data("animating",!1)}}),e.widgetsType.notificationDisplayed){po(i);var l={};l[vo(e)?"top":"bottom"]=0,n.animate(l,{label:"desktopNotificationSlideClosed"})}},yo=function(e,t,i){var n=t.find(".con-notch"),r={},o=mo(e,i);return r[vo(e)?"top":"bottom"]=function(e,t){return Kr(e)?13:65*t+13}(e,o),"tab-widgets-content"===e.state?(n.animate(r,{label:"adjustNotch"}),!1):(n.css(r),!0)},bo=function(e){var t=e.$concierge;e.engagementWidgets.globalSettings.hideMoxieBranding&&t.addClass("hide-moxie")},So=function(e,t){var i=e.$concierge.find("#concierge-widget-area");if(yo(e,i,t)){i.hasClass("con-animating")?i.stop():i.css({opacity:0,right:50,display:"inline-block"}),bo(e);var n={opacity:1};void 0!==e.widgetAreaDragData.x&&void 0!==e.widgetAreaDragData.y?(i.addClass("free-floating"),n.left=e.widgetAreaDragData.x,n.top=e.widgetAreaDragData.y):n.right=75,i.addClass("con-animating").addClass("con-open").animate(n,{label:"desktopOpenArea",done:function(t,n){delete e.widgetsType.$areaAnimate,function(e,t){for(var i in t)ot(e,t[i])}(i[0],["display","opacity","right"]),i.removeClass("con-animating"),n||"object"!=typeof window.visualViewport||e.widgetsType.applyKeyboardOffset(),e.widgetAreaDragData&&e.widgetAreaDragData.draggedByUser&&e.widgetAreaDragData.resizedWhileMinimized&&e.dragFixAfterResize()}})}e.state="tab-widgets-content",e.widgetsType.$areaAnimate=i},Co=function(e,t){"object"==typeof window.visualViewport&&e.widgetsType.resetKeyboardOffset();var i=e.$concierge.find("#concierge-widget-area");"tab-widgets-content"===e.state&&(i.hasClass("con-animating")?i.stop():i.css({opacity:1,right:75,display:"block"}),t.css({display:"block"}),i.addClass("con-animating").removeClass("con-open").animate({opacity:0,right:50,display:"none"},{label:"desktopCloseArea",done:function(){delete e.widgetsType.$areaAnimate,i.removeAttr("style"),i.removeClass("con-animating"),t.removeAttr("style")}}),e.state="tab-widgets",e.widgetsType.$areaAnimate=i)},_o=function(e){var t=e.$concierge.find("#concierge-widgets"),i=e.$concierge.find("#concierge-tab");"tab"===e.state?(e.$concierge.addClass("with-widgets").removeClass("con-closed"),i.addClass("con-pressed"),i.attr("aria-expanded","true"),e.state="tab-widgets",function(e,t,i){var n=e.widgetsType.getNotification(),r=t.children("ul").first(),o=r.height(),a=r.children("li").length,s={height:o+50+15},c={opacity:0},u={opacity:1};if(vo(e)?(c.top=-(50*a-10),u.top=40,s.top=25):(c.bottom=-(o+30),u.bottom=-10,s.bottom=25),r.data("animating")?(r.stop(),n.stop()):(r.css(c),t.css(s),t.addClass("con-animating")),r.data("animating",!0).animate(u,{label:"desktopWidgetsOpen",done:function(){t.removeAttr("style"),t.removeClass("con-animating"),r.removeAttr("style").data("animating",!1)}}),pr(e.wmState)){var l={},d=Qr(e.wmState.notification.spot),g=65*mo(e,d);1===d.length&&(l[vo(e)?"top":"bottom"]=g),n.animate(l,{label:"desktopNotificationSlideOpen",done:function(){delete i.$notifAnimate}}),i.$notifAnimate=n}}(e,t,this)):"tab-widgets-content"===e.state?(e.$concierge.find("#concierge-widget-area").removeClass("con-open"),i.removeClass("con-pressed"),i.attr("aria-expanded","false"),e.$concierge.removeClass("with-widgets"),Eo(e),e.state="tab",wo(e,t,this),e.$concierge.addClass("con-closed")):(i.removeClass("con-pressed"),i.attr("aria-expanded","false"),e.$concierge.removeClass("with-widgets"),e.state="tab",wo(e,t,this),e.$concierge.addClass("con-closed"))},Eo=function(e){var t=e.$concierge.find("#concierge-widgets li.con-active");t.removeClass("con-active").removeClass("con-pressed"),t.find(".con-notch").remove(),t.find(".con-icon").attr("aria-expanded","false");var i=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active"),n=L.resolve(null);return e.openWidget&&(n=n.then((function(){return e.hideWidget(!1)}))),n.then((function(){return Co(e,i)}))},Io=function(e,t){var i=t.parameters,n=t.engagementId,r=Qr(t.spot);if(r.hasClass("con-active"))return e.openWidget&&e.openWidget!==t.name?e.hideWidget(!1):L.resolve(null);r.addClass("con-active").addClass("con-pressed"),r.find(".con-icon").attr("aria-expanded","true");var o=i.rule.source;return n&&"offer"!==o&&"notification"!==o&&"button"!==o&&(i.rule.source="internal"),t.execute(e)},No=function(){var e=ni(this);e.addClass("con-pressed"),e.data("pressing",1),"concierge-tab"===e.attr("id")&&e.attr("aria-expanded","true"),e.find(".con-icon")&&e.find(".con-icon").attr("aria-expanded","true")},Oo=function(){var e=ni(this);1===e.data("pressing")&&(e.data("pressing",0),e.removeClass("con-pressed"),e.find(".con-icon")&&e.find(".con-icon").attr("aria-expanded","false"),"concierge-tab"===e.attr("id")&&e.attr("aria-expanded","false"))},To=function(){return'<div id="concierge" class="con-right con-closed<%= CON_CLOSED %>">\n  <button id="concierge-tab" type="button" aria-label="<%= CONCIERGE %>" aria-expanded="false" aria-haspopup="true">\n    <%= CONCIERGE_TAB_ICON_SVG %>\n  </button>\n  <div id="concierge-widgets"><ul id="concierge-widgets-ul"<%= CON_ROLE_ATTRIBUTE %>></ul></div>\n  <div id="concierge-widget-area" tabindex="0" role="dialog" aria-live="assertive" aria-label=""><div class="con-notch"><div class="con-notch-inner"></div></div></div>\n\n  <div id="con-notification" class="con-inactive" role="alert" aria-live="assertive">\n  \x3c!--\n    CON-5221: Don\'t include (causes JAWS and NVDA to read twice):\n    aria-labelledby="con-notification-title" aria-describedby="con-notification-body"\n  --\x3e\n    <div class="con-notch"><div class="con-notch-inner"></div></div>\n    <h2 id="con-notification-title" class="concierge-notification-title" aria-hidden="true" tabindex="0">Live Chat</h2>\n    <div class="con-notification-content">\n      <div class="con-notification-icon" aria-live="off" aria-hidden="true"></div>\n      <div id="con-notification-body" aria-hidden="true">\n      \x3c!--\n        CON-5221: Don\'t include (causes JAWS to skip reading):\n        aria-live="polite" aria-atomic="true"\n      --\x3e\n        <div class="con-notification-body" tabindex="0"></div>\n        <div class="con-notification-helptext"><%=NOTIFICATION_ANNOUNCE%></div>\n      </div>\n      <div class="con-notification-calltoaction" role="link" tabindex="0"></div>\n    </div>\n    <button class="con-x" aria-label="<%= CLOSE_ICON %>">\n      <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20" stroke-width="0">\n        <title><%= CLOSE_ICON %></title>\n        <polygon points="17.3,1.1 10.2,8.3 3.1,1.1 1.3,2.9 8.4,10 1.3,17.1 3.1,18.9 10.2,11.8 17.3,18.9 19.1,17.1 11.9,10 19.1,2.9 "/>\n      </svg>\n    </button>\n  </div>\n</div>\n'};function ko(e){this.html=To,this.cssType="desktop",this.notificationDisplayed=!1,this.visualViewportHasScroll=!1,this.visualViewportHasResize=!1;var t=this;this.start=function(){var i=e.$concierge.find("#concierge-tab"),o=e.$concierge.find("#concierge-widgets");i.on("mousedown",No),i.onPassive("touchstart",No),i.on("mouseleave",Oo);var a=function(n){("click"===n.type||Vr(n.which))&&("click"===n.type&&i.removeClass("highlight"),ni(this).removeClass("con-pressed").data("pressing",0).attr("aria-expanded","false"),Li(e.concierge,!1),Ji("bellClicked",{}),t.toggleWindow())};i.on("click",a),i.on("keypress",a),i.on("keyup",(function(e){jr(e.which)?ni(this).addClass("highlight"):qr(e.which)?n(ni(this)):Jr(e.which)&&r(ni(this))})),i.on("blur",(function(){ni(this).removeClass("highlight")})),bt(o,"mousedown",_t("li"),No),bt(o,"touchstart",_t("li"),No,!0),bt(o,"mouseleave",_t("li"),Oo);var s=function(t){("click"===t.type||Vr(t.which))&&(ni(this).removeClass("con-pressed").data("pressing",0),ni(this).find(".con-icon").attr("aria-expanded","false"),Ui((function(){return function(e,t){var i=ni(t.target).closest("li"),n=i.data("spot"),r=yr(e.wmState,n);if(r){if(r.buttonEnabled){var o=r.name,a=zr(o),s=r.parameters;return i.removeClass("highlight"),(s=s||{}).rule=s.rule||{},s.rule.source="button",Ui((function(){return i.hasClass("con-active")?e.hideWidget(!1):Io(e,r)})).then((function(){return Li(e.concierge,!0,o),Ji("buttonClicked",{buttonName:a}),null}))}}else q.log("DesktopWidgets: widgetsClicked: could not find widget for spot, "+n)}(e,t)})).catch((function(e){q.log((e.stack,e.stack))})))};bt(o,"click",_t("li"),s),bt(o,"keypress",_t("li"),s);var c=function(i){if("click"===i.type||Vr(i.which)||Fr(i.which)){var n=ni(i.target);if(n.hasClass("con-x")||n.closest(".con-x").length>0)Or(e.wmState);else{var r=e.wmState.notification;Nr(e.wmState),r&&r.shouldDisplayBell()&&e.$concierge.hasClass("con-closed")&&(t.toggleWindow(),e.state="tab-widgets")}}};e.$concierge.find("#con-notification").on("click",c).on("keypress",c)},this.toggleWindow=function(){_o.call(this,e)},this.focusWidgetButton=function(t){e.$concierge.find("#concierge-widgets li[data-widget="+t+"] .con-icon").focus()};function i(e,t,i){if(pr(e.wmState)){i=i||{};var n=0,r=e.wmState.notification,o=Qr(r.spot);o.length>0&&!Kr(e)&&e.$concierge.hasClass("with-widgets")&&(n=65*mo(e,o)),i[vo(e)?"top":"bottom"]=n,t.css(i);var a=!0;if(r.spot){var s=lr(e.wmState,r.spot);s.widget&&s.widget.preferredSpotName()===r.preferredSpotName()&&(a=!1)}a?function(e){e.addClass("free-floating")}(t):function(e){e.removeClass("free-floating")}(t)}}this.makeWidgetActive=function(e){e.addClass("con-active")},this.makeWidgetInactive=function(e){e.removeClass("con-active")},this.openWidget=function(t){var i=t.name,n=e.$concierge.find("#concierge-widget-area");!function(e,t){var i={kb:"K B Engagement Widget",chat:"Live Chat",kbot:"Live Chat",email:"Email Engagement Widget"}[e]||"";t.attr("aria-label",i)}(i,n);var r=e.widgetAreaForWidget(i),o=n.children(".concierge-widget.con-active").not(r);function a(){ni(this).removeAttr("style")}this.makeWidgetInactive(o),this.makeWidgetActive(r),e.$concierge.find("#concierge-widgets li.con-active").removeClass("con-active").removeClass("con-pressed"),e.$concierge.find("#concierge-widgets li.con-active .con-icon").attr("aria-expanded","false"),"Tablet"===e.device&&r.find("iframe.widget-content").css({overflow:"auto"});var s=e.$concierge.find("#concierge-widgets li[data-widget="+i+"]");s.addClass("con-active").addClass("con-pressed"),s.find(".con-icon").attr("aria-expanded","true"),"tab-widgets-content"===e.state&&o.length>0&&(q.log("openWidget(): invoked and willHide sent to already opened widget -"+o.data("widget")),bo(e),e.postMessageToWidget(o.data("widget"),"willHide"),r.css({opacity:.3}).animate({opacity:1},{label:"desktopOpenWidget",done:a}),o.css({display:"block",position:"absolute",top:2,height:"calc(100% - 4px)",width:"100%","padding-right":"4px",opacity:1,"z-index":100}).animate({opacity:0},{label:"desktopCloseWidget",done:a})),So(e,s)},this.closeWidgets=function(){e.$concierge.find("#concierge-widgets li.con-active").removeClass("con-active").removeClass("con-pressed"),e.$concierge.find("#concierge-widgets li.con-active .con-icon").attr("aria-expanded","false");var t=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active");this.makeWidgetInactive(t),t.removeAttr("style"),Co(e,t),e.$concierge.find("#concierge-widget-area").removeClass("con-open"),e.state="tab"},this.getNotification=function(){return e.$concierge.find("#con-notification")},this.getNotificationBody=function(){return e.$concierge.find("#con-notification-body")},this.getNotificationTitle=function(){return e.$concierge.find("#con-notification-title")},this.setAriaHidden=function(e){this.getNotificationBody().attr("aria-hidden",e),this.getNotificationTitle().attr("aria-hidden",e)},this.canDisplayNotification=function(){return!this.notificationDisplayed&&!e.$concierge.hasClass("con-open-widget")},this.maybeHandleOffset=function(){var t;0===e.tabStyle.verticalAnchor?t=window.visualViewport.offsetTop:(t=0,ve()&&(t=window.visualViewport.height-fe()+window.visualViewport.offsetTop,t=Math.min(t,0))),this.conciergePrevOffset!==t&&(this.conciergePrevOffset=t,this.conElem.style.transform="translateY("+t+"px) scale("+1/window.visualViewport.scale+")",e.dragResizeHandler())},this.viewportHandler=function(e){this.conElem&&this.maybeHandleOffset()},this.applyKeyboardOffset=function(){this.conElem=xe("concierge"),window.visualViewport&&(this.visualViewportHasScroll||(this.visualViewportHasScroll=!0,vt(window.visualViewport,"scroll",this.viewportHandler.bind(this))),this.visualViewportHasResize||(this.visualViewportHasResize=!0,vt(window.visualViewport,"resize",this.viewportHandler.bind(this))))},this.resetKeyboardOffset=function(){this.conElem=null,window.visualViewport&&(this.visualViewportHasScroll&&(this.visualViewportHasScroll=!1,wt(window.visualViewport,"scroll",this.viewportHandler.bind(this))),this.visualViewportHasResize&&(this.visualViewportHasResize=!1,wt(window.visualViewport,"resize",this.viewportHandler.bind(this))))},this.updateNotification=function(){var t=this.getNotification();i(e,t,{})},this.displayNotification=function(){var t=this;this.notificationDisplayed=!0;var n=this.getNotification();n.addClass("con-active").removeClass("con-inactive"),this.setAriaHidden("false"),n.removeAttr("style");i(e,n,{opacity:0}),n.animate({opacity:1},{label:"desktopShowNotification",done:function(e,i){delete t.$notifAnimate,i||"object"!=typeof window.visualViewport||t.applyKeyboardOffset()}}),t.$notifAnimate=n},this.closeNotification=function(){"object"==typeof window.visualViewport&&this.resetKeyboardOffset();var e=this;this.notificationDisplayed=!1;var t=this.getNotification();t&&(t.animate({opacity:0},{label:"desktopHideNotification",done:function(){delete e.$notifAnimate,t.addClass("con-inactive").removeClass("con-active").removeAttr("style"),e.setAriaHidden("true")}}),e.$notifAnimate=t)},this.openConcierge=function(t){"tab-widgets-content"!==e.state&&(e.state="tab-widgets");var i=e.$concierge.find("#concierge-widgets");e.$concierge.addClass("with-widgets").removeClass("con-closed");var n=e.$concierge.find("#concierge-tab");if(n.addClass("con-pressed"),n.attr("aria-expanded","true"),i.addClass("con-visible"),t)return Io(e,t)};var n=function(t){if(!Kr(e)){var i=null;1===(i="concierge-tab"===t.attr("id")?ni("#concierge-widgets-ul li").last():t.prev()).length?(i.find(".con-icon").focus(),i.addClass("highlight")):ni("#concierge-tab").focus().addClass("highlight")}},r=function(t){if(!Kr(e)){var i=null;1===(i="concierge-tab"===t.attr("id")?ni("#concierge-widgets-ul li").first():t.next()).length?(i.find(".con-icon").focus(),i.addClass("highlight")):ni("#concierge-tab").focus().addClass("highlight")}};this.createWidgetElement=function(t){var i=Kr(e)?"":' role="menuitem"',o=e.concierge.getTranslation(zr(t.name),"title"),a="";t.buttonEnabled||(a="disabled");var s=ni('<li data-spot="'+t.spot+'" data-widget="'+t.name+'"'+i+'><button type="button" aria-expanded="false" class="con-icon" '+a+' aria-label="'+o+'">'+t.icon.svg+"</button></li>"),c=s.find("svg");c.length>0&&Yr(c[0]);var u=s.find(".con-icon");return u.on("keyup",(function(e){jr(e.which)?s.addClass("highlight"):qr(e.which)?n(s):Jr(e.which)&&r(s)})),u.on("blur",(function(){s.removeClass("highlight")})),s},this.updateWidgetElement=function(t){var i=Qr(t.spot);if(i.length>0){i.attr("data-widget",t.name);var n=e.concierge.getTranslation(zr(t.name),"title"),r=i.find("button");r.attr("aria-label",n),r.html(t.icon.svg);var o=i.find("svg");o.length>0&&Yr(o[0])}},this.addWidget=function(t){q.log("DesktopWidgets: addWidget:",t.name,t);var n=ni("#concierge-widgets ul"),r=this.createWidgetElement(t);return n.append(r[0]),io(e,vo(e)),i(e,this.getNotification()),Kr(e)&&e.$concierge.removeClass("con-closed"),r};var o=function(t){var i={right:e.tabStyle.horizontalOffset,bottom:""},n=window.pageYOffset;0===e.tabStyle.verticalAnchor?i.top=e.tabStyle.verticalOffset+n:i.top=n+fe()-(e.tabStyle.verticalOffset+50),t.css(i)},a=function(t){var i={right:e.tabStyle.horizontalOffset};0===e.tabStyle.verticalAnchor?i.top=e.tabStyle.verticalOffset:i.bottom=e.tabStyle.verticalOffset,t.css(i)};this.fixPosition=function(e,t){"javascript"===e?(t.addClass("position-method-javascript"),q.log("Concierge Client: PositionMethod - Javascript"),this.scrollHandler||(this.scrollHandler=function(){o(t)},vt(window,"scroll",this.scrollHandler)),o(t)):a(t)},this.beforeAppend=function(t){var i=[],n={right:e.tabStyle.horizontalOffset};a(t),vo(e)?i.push("con-top"):i.push("con-bottom"),t.addClass(i.join(" ")),t.css(n)},this.destroy=function(){po(this),this.scrollHandler&&wt(window,"scroll",this.scrollHandler),ni("#concierge-style-desktop").remove(),this.resetKeyboardOffset()}}function xo(e){this.html=function(){return'<div id="concierge" class="con-right con-closed /DEVICE/">\n    <div id="concierge-backdrop"></div>\n    <button id="concierge-tab" type="button" aria-label="<%= CONCIERGE %>" aria-expanded="false">\n        <%= CONCIERGE_TAB_ICON_SVG %>\n    </button>\n    <div id="concierge-widgets">\n      <div class="con-widgets"><ul id="concierge-widgets-ul"<%= CON_ROLE_ATTRIBUTE %>></ul></div>\n      <div class="con-notch con-notch1"></div>\n      <div class="con-notch con-notch2"></div>\n    </div>\n    <div id="concierge-widget-area" role="dialog" aria-live="assertive" aria-label=""></div>\n\n    <div id="con-notification" role="alert" aria-live="assertive" class="con-inactive">\n    \x3c!--\n      CON-5221: Don\'t include (causes JAWS and NVDA to read twice):\n      aria-labelledby=" con-notification-title" aria-describedby="con-notification-body"\n    --\x3e\n      <h2 id="con-notification-title" class="concierge-notification-title" aria-hidden="true" tabindex="0">Notification</h2>\n      <div class="con-notification-content">\n        <div class="con-notification-icon" aria-live="off" aria-hidden="true"></div>\n        <div id="con-notification-body" class="con-notification-body" tabindex="0" aria-hidden="true"></div>\n        \x3c!--\n          CON-5221: Don\'t include (causes JAWS to skip reading):\n          aria-live="polite" aria-atomic="true"\n        --\x3e\n        <div class="con-notification-calltoaction" role="link" tabindex="0"></div>\n      </div>\n      <button class="con-x" aria-label="<%= CLOSE_ICON %>">\n        <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20" stroke-width="0">\n          <title><%= CLOSE_ICON %></title>\n          <polygon points="17.3,1.1 10.2,8.3 3.1,1.1 1.3,2.9 8.4,10 1.3,17.1 3.1,18.9 10.2,11.8 17.3,18.9 19.1,17.1 11.9,10 19.1,2.9 "/>\n        </svg>\n      </button>\n    </div>\n</div>\n'},this.cssType="mobile",this.openWidgetCount=0,this.bodyOrigStyle="",this.bodyOrigClasses="",this.htmlOrigStyle="",this.htmlOrigClasses="",this.start=function(){var t=this;navigator.userAgent.match(/instagram/i)&&navigator.userAgent.match(/iphone/i)&&(e.$concierge.addClass("instagram"),e.$concierge.find("#concierge-widget-area").css("height",window.innerHeight+"px")),e.$concierge.find("#concierge-tab").onPassive("touchstart",(function(){ni(this).addClass("con-pressed").attr("aria-expanded","true"),function(e){var t=e.$concierge.find("#concierge-widgets");if(Do(e,t),Kr(e)){var i=lr(e.wmState,"single").widget;q.log("widget "+i.name+" clicked");var n=zr(i.name);Li(e.concierge,!0,i.name),Ji("buttonClicked",{buttonName:n}),i.parameters.rule.source="button",i.execute(e)}else!function(e){e.$concierge.hasClass("con-open")||!e.shouldDisplayBell?Mo(e):function(e){var t=e.$concierge.find("#concierge-widgets");e.$concierge.find("#concierge-tab").attr("aria-expanded","true"),Do(e,t),t.data("animation","opening"),e.$concierge.removeClass("con-pressed").removeClass("con-closed");var i=t.attr("style");t.removeAttr("style");var n=t.height();void 0===i||!1===i?t.css({overflow:"hidden",opacity:0,height:0}):t.attr("style",i);t.animate({height:n,opacity:1},{label:"mobileOpenMenu",done:function(){t.data("animation",!1),t.removeAttr("style"),e.$concierge.addClass("con-open")}})}(e)}(e)}(e)})).on("touchend",(function(){ni(this).removeClass("con-pressed")})),e.$concierge.onPassive("touchstart",".con-widgets li",(function(){ni(this).addClass("con-pressed"),ni(this).find(".con-icon").attr("aria-expanded","true")})).on("touchend",".con-widgets li",(function(){var t=ni(this);t.removeClass("con-pressed"),t.find(".con-icon");var i=t.data("spot"),n=yr(e.wmState,i);if(n){var r=n.name;return n.parameters.rule.source="button",q.log("widget "+r+" clicked"),n.execute(e).then((function(){return Li(e.concierge,!0,r),Ji("buttonClicked",{buttonName:zr(r)}),!1}))}q.log("MobileWidgets: widgetsClicked: could not find widget for spot, "+i)})),e.$concierge.find("#concierge-backdrop").on("click",(function(){Tr(e.wmState),Mo(e)}));var i=function(t){if("click"===t.type||Vr(t.which)||Fr(t.which)){var i=ni(t.target);i.hasClass("con-x")||i.closest(".con-x").length>0?Or(e.wmState):Nr(e.wmState)}};e.$concierge.find("#con-notification").on("click",i),e.$concierge.find("#con-notification").on("keypress",i);var n=!1;this.orientationListener=function(){if(t.notificationDisplayed){var e=t.getNotification();n&&clearTimeout(n),n=setTimeout((function(){n=!1,e.css({width:pe()})}),500)}},window.addEventListener("orientationchange",this.orientationListener)},this.focusWidgetButton=function(t){Kr(e)?e.$concierge.find("#concierge-tab").focus():e.$concierge.find("#concierge-widgets li[data-widget="+t+"]").focus()};this.addScrollFix=function(){var e=ni("html");this.htmlOrigStyle=e.attr("style"),this.htmlOrigClasses=e.attr("class"),e.attr("style",""),e.attr("class",""),e.addClass("concierge-modal-displayed");var t=ni("body");this.bodyOrigStyle=t.attr("style"),this.bodyOrigClasses=t.attr("class"),t.attr("style",""),t.attr("class",""),t.addClass("concierge-modal-displayed"),this.scrollFixApplied=!0},this.removeScrollFix=function(){if(this.scrollFixApplied){var e=ni("html");e.removeClass("concierge-modal-displayed"),e.attr("style",this.htmlOrigStyle),delete this.htmlOrigStyle,e.attr("class",this.htmlOrigClasses),delete this.htmlOrigClasses;var t=ni("body");t.removeClass("concierge-modal-displayed"),t.attr("style",this.bodyOrigStyle),delete this.bodyStyleRemoved,t.attr("class",this.bodyOrigClasses),delete this.bodyOrigClasses,ni("#concierge-widget-area").css({top:""}),delete this.scrollFixApplied}},this.makeWidgetActive=function(e){e.length>0&&(0===this.openWidgetCount&&this.addScrollFix(),e.addClass("con-active"),this.openWidgetCount+=e.length)},this.makeWidgetInactive=function(e){e.length>0&&(e.removeClass("con-active"),this.openWidgetCount-=e.length,0===this.openWidgetCount&&this.removeScrollFix())};this.openWidget=function(t){var i=t.name;!function(e,t){var i={kb:"K B Engagement Widget",chat:"Live Chat",kbot:"Live Chat",email:"Email Engagement Widget"}[e]||"";t.attr("aria-label",i)}(i,e.$concierge.find("#concierge-widget-area"));var n=e.widgetAreaForWidget(i),r=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active").not(n),o=this;this.makeWidgetActive(n),this.$widgetAnimating=n,function(e){var t=e.$concierge;e.engagementWidgets.globalSettings.hideMoxieBranding&&t.addClass("hide-moxie")}(e),n.attr("aria-expanded","true"),n.css({"z-index":1,opacity:0}).animate({opacity:1},{label:"mobileOpenWidget",done:function(){delete o.$widgetAnimating,o.makeWidgetInactive(r),r.attr("aria-expanded","false"),n.removeAttr("style")}}),Mo(e)},this.closeWidgets=function(){var t=e.$concierge.find("#concierge-widget-area .concierge-widget.con-active"),i=this;t.css({opacity:1}).animate({opacity:0},{label:"mobileCloseWidgets",done:function(){q.log("close complete"),i.makeWidgetInactive(t),t.removeAttr("style").attr("aria-expanded","false")}})},this.getNotification=function(){return e.$concierge.find("#con-notification")},this.getNotificationBody=function(){return e.$concierge.find("#con-notification-body")},this.getNotificationTitle=function(){return e.$concierge.find("#con-notification-title")},this.setAriaHidden=function(e){this.getNotificationBody().attr("aria-hidden",e),this.getNotificationTitle().attr("aria-hidden",e)},this.canDisplayNotification=function(){return!this.notificationDisplayed&&!e.$concierge.hasClass("con-open-widget")},this.fixPosition=function(e,t){if("javascript"===e){t.addClass("position-method-javascript"),q.log("Concierge Client: PositionMethod - Javascript");var i=function(){var e=fe();t.css({top:e})};window.addEventListener("scroll",i),i()}};var t=!1,i=this;this.fixNotificationsUsingVisualViewport=function(){var e=xe("con-notification");e&&(t=!1,e.style.transform="translateY("+window.visualViewport.offsetTop+"px) scale("+1/window.visualViewport.scale+")")},this.viewportHandler=function(){t||(t=!0,Zt(i.fixNotificationsUsingVisualViewport,"mobileNotifScrollFix"))},this.applyNotificationKeyboardOffset=function(){window.visualViewport.addEventListener("scroll",this.viewportHandler),window.visualViewport.addEventListener("resize",this.viewportHandler),this.viewportHandler()},this.resetNotificationKeyboardOffset=function(){window.visualViewport.removeEventListener("scroll",this.viewportHandler),window.visualViewport.removeEventListener("resize",this.viewportHandler)},this.updateNotification=function(){},this.displayNotification=function(t){var i=this;this.notificationDisplayed=!0,q.log("opening notification.");var n=this.getNotification();n.data("parameters",t.parameters),n.addClass("con-active").removeClass("con-inactive"),this.setAriaHidden("false");var r="0px";e.engagementWidgets.globalSettings.notificationMobileVerticalOffset&&(r=e.engagementWidgets.globalSettings.notificationMobileVerticalOffset.toString()+"px"),i.$notifAnimating=n,n.css({top:"-150px"}).animate({top:r},{label:"mobileShowNotification",done:function(){i.$notifAnimating=!1;var e=pe();n.css({width:e}),"object"==typeof window.visualViewport&&i.applyNotificationKeyboardOffset()}})},this.closeNotification=function(){"object"==typeof window.visualViewport&&this.resetNotificationKeyboardOffset();var e=this;this.notificationDisplayed=!1;var t=this.getNotification();t&&t.animate({opacity:0},{label:"mobileHideNotification",done:function(){t.addClass("con-inactive").removeClass("con-active").removeAttr("style"),e.setAriaHidden("true")}})},this.openConcierge=function(){},this.destroy=function(){this.$notifAnimating&&(this.$notifAnimating.stop(!0,!0),delete this.$notifAnimating),this.$widgetAnimating&&(this.$widgetAnimating.stop(!0,!0),delete this.$widgetAnimating),this.orientationListener&&(window.removeEventListener("orientationchange",this.orientationListener),delete this.orientationListener),this.removeScrollFix(),ni("#concierge-style-mobile").remove()},this.createWidgetElement=function(t){var i=Kr(e)?"":' role="menuitem"',n=e.concierge.getTranslation(zr(t.name),"title");return ni('<li data-spot="'+t.spot+'" data-widget="'+t.name+'"'+i+'><button type="button" aria-expanded="false" class="con-icon" aria-label="'+n+'">'+t.icon.svg+'</button><span class="con-mobile-primary-menu">'+n+"</span></li>")},this.updateWidgetElement=function(t){var i=Qr(t.spot),n=i.find("button");if(Kr(e)){var r=ni("#concierge-tab");n.pushAll(r),i.pushAll(r)}i.attr("data-widget",t.name),i.attr("data-spot",t.spot);var o=e.concierge.getTranslation(zr(t.name),"title");i.find(".con-mobile-primary-menu").text(o),n.attr("aria-label",o),n.html(t.icon.svg);var a=n.find("svg");a.length>0&&Yr(a[0])},this.addWidget=function(t){q.log("MobileWidgets: addWidget:",t.name,t);var i=ni("#concierge-widgets ul"),n=this.createWidgetElement(t);if(i.append(n[0]),io(e,!0),Kr(e)){var r=ni("#concierge-tab");return r.html(t.icon.svg),r.attr("data-widget",t.name),r.attr("data-spot",t.spot),r}return n}}function Do(e,t){var i=t.data("animation");return i&&("opening"===i?(t.stop(),e.$concierge.addClass("con-open")):"closing"===i&&t.stop(),t.data("animation",!1)),i}function Mo(e){var t=e.$concierge.find("#concierge-widgets");(e.$concierge.find("#concierge-tab").attr("aria-expanded","false"),e.$concierge.hasClass("con-closed"))||"closing"!==t.data("animation")&&(Do(e,t),t.data("animation","closing"),e.$concierge.removeClass("con-pressed").removeClass("con-open"),t.css({overflow:"hidden"}),t.animate({opacity:0,height:0},{label:"mobileCloseMenu",done:function(){t.data("animation",!1),t.removeAttr("style"),e.$concierge.addClass("con-closed")}}))}function Ao(){}Ao.prototype.markChat=function(e,t,i){var n=Date.now();return e.transient_data?(e.transient_data.vp_data.chat.session_id=Math.abs(parseInt(t)),"start"===i&&(e.transient_data.vp_data.chat.start_time=n),"end"===i&&(e.transient_data.vp_data.chat.end_time=n)):e.transient_data={vp_data:{chat:{session_id:t,start_time:n}}},q.log("Marking chat "+t+" as "+i),e};var Lo=function(e,t){It(this,t),this.parameters=this.parameters||{},this.configuration=this.configuration||{},this.configuration.connectorUrl=e.serviceUrl.connector,function(e,t){var i=t.widgetManager;e.priority=1,e.state=0,e.buttonEnabled=!0,e.preferredSpotName=function(){return this.name},e.getSpotName=function(){return this.spot},e.label=function(){var e=V(this,"parameters","rule","name");return e?this.name+":"+e:this.name},e.checkAvailability=function(){return L.resolve({status:!0})},e.shouldDisplayBell=function(){return!0},e.beforeNotify=function(e){return L.resolve(Wo(e,!0))},e.beforeAdd=function(e){return L.resolve(Wo(e,!0))},e.beforeLoad=function(){},e.getRemoteURL=function(){if(this.remoteURL)return this.remoteURL},e.hideWidget=function(){i.wmState.open===this&&i.hideWidget(!1)},e.closeWidget=function(){if(this.spot){var e=lr(i.wmState,this.spot);this.hasFinished=!0,e.widget===this&&e.reactive&&e.reactive!==this&&wr(i.wmState,e.reactive)}},e.destroy=function(e){},e.unload=function(){0!==this.state&&(i.widgetAreaForWidget(this.name).remove(),this.state=0)},e.execute=function(e){var t=this;return e.concierge.cacheManager.removeWidgetCache(this.name,"widget-closed").then((function(){e.showWidget(t)}))}}(this,e)};function Wo(e,t){return(e=e||{}).status=t,e}function Ro(e){var t;return e.getAllResponseHeaders().indexOf("x-trace-id")>=0&&(t=e.getResponseHeader("x-trace-id")),t}var Po=function(e){function t(t,i){e.call(this,t,i),Jo(this,t),function(e,t){var i=t.widgetManager,n=t.cacheManager;e.beforeAdd=function(e){var r,o,a=e.ref,s=e.parameters,c=Vo(i.device),u=a.name,l=a.getEngagmentId(),d=a.getSuspendedSession(),g=a.getActiveSession();if(!e.ruleSettings)throw new Error("obj.ruleSettings is missing");return o=e.ruleSettings.skip_chat_queue_status_check?t.serviceUrl.connector+"/connector/channels/portal_with_service_line/"+s.portalId+"/device/"+c:t.serviceUrl.connector+"/connector/channels/portals_with_queue_status/"+s.portalId+"/device/"+c,t.httpGetXMLHttpRequest(o).then((function(o){var c,h=JSON.parse(o.responseText);if(s.traceId=Ro(o),e.ruleSettings.skip_chat_queue_status_check)s.serviceLineId||(s.serviceLineId=h.response.serviceLineId,s.serviceLine=h.response.serviceLineName),t.serviceLines.setName(s.serviceLineId,s.serviceLine),c=h.response;else{if(s.serviceLineId||(s.serviceLineId=h.response.queueStatus.id,s.serviceLine=h.response.queueStatus.name),t.serviceLines.setName(s.serviceLineId,s.serviceLine),!h.response)throw new Error("status.response evaluates to false");var f=s.rule&&s.rule.source?s.rule.source:"internal";if(!Hr(f)&&e.ruleSettings.hide_on_demand_chat_when_service_line_is_closed&&"true"!==h.response.queueStatus.queueopen)throw new Error("service line is closed");if(r="true"===h.response.queueStatus.slotavailable,!Hr(f)&&e.ruleSettings.hide_on_demand_chat_when_no_available_agent_slots&&!r&&!d&&!g&&!e.engagementId)throw new Error("spot not available");no(e.ruleSettings.check_queue_wait_time_for_on_demand_chat,V(h,"response","queueStatus","holdtime"),e.ruleSettings.queue_wait_time,d,g),c=h.response.portalData}s.widgetpath=t.scriptLocation+"/widgets/chat/"+t.assetVersion.widgets+"/",s.langOptions=t.langOptions;var p=0;c.deviceList.length>1&&(p=Vo(i.device));var v="<%=host %>/netagent/cimlogin.aspx?questid=<%=questId %>&portid=<%=portalId %>&defaultStyleId=<%=styleId %>&widgetpath=<%=widgetpath %>&flyout=1";v=fo(v)({host:s.host,questId:c.deviceList[p].questid,styleId:c.deviceList[p].styleid,portalId:c.deviceList[p].styleid,widgetpath:t.scriptLocation+"/widgets/chat/"+t.assetVersion.widgets+"/"}),("string"==typeof a.remoteURL||a.remoteURL instanceof String)&&(a.remoteURL={}),a.portalId=s.portalId,a.remoteURL[s.portalId]=v,a.oldRemoteUrl=v,navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?a.remoteURL[s.portalId]+="&fullScreen=false":"Mobile"!==i.device&&"Tablet"!==i.device||(a.remoteURL[s.portalId]+="&fullScreen=true"),e.engagementId&&e.engagementId!==l&&(l=!1);var m=0!==i.notificationType;return s.questId=c.deviceList[p].questid,s.styleId=c.deviceList[p].styleid,a.shouldReplaceIframeSrc=!0,d&&l?(m&&i.widgetsType.closeNotification(),n.removeWidgetCache(u,"suspended_session",!0),void(a.autoOpen=!0)):i.loadingActiveWidgets&&g&&l?(a.origRemoteURL=a.remoteURL,a.oldRemoteUrl=a.remoteURL[s.portalId],a.remoteURL[s.portalId]=fo(g)({host:s.host,widgetpath:t.scriptLocation+"/widgets/chat/"+t.assetVersion.widgets+"/"}),navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?a.remoteURL[s.portalId]+="&fullScreen=false":"Mobile"!==i.device&&"Tablet"!==i.device||(a.remoteURL[s.portalId]+="&fullScreen=true"),t.cacheManager.getWidgetCache(u,"widget-closed")||m?i.loadWidget(a):void(a.autoOpen=!0)):void 0})).then((function(){return e.status=!0,e}))},e.beforeNotify=function(n){var r=t.rulesEngine,o=Vo(i.device),a=60;r.queueWaitTime&&(a=r.queueWaitTime());var s=n.rule,c=null;s&&s.id?c=s.id:q.log("Chat Widget:beforeNotify: rule id missing from obj:",n);var u=n.parameters,l=t.serviceUrl.connector+"/connector/channels/queue_status/"+u.portalId+"/device/"+o;return t.httpGetXMLHttpRequest(l).then((function(r){var o=JSON.parse(r.responseText);u.traceId=Ro(r);var s=o.response.id;if(u.serviceLineId=o.response.id,u.serviceLine=o.response.name,t.serviceLines.setName(u.serviceLineId,u.serviceLine),t.cacheManager.getWidgetCache(e.name,"suspended_session",!0))return n.status=!1,function(e,t){for(var i=e.getData("profileJSON"),n=i.session.visits.length-1,r=0;r<i.session.visits[n].journey.length;r++)if(i.session.visits[n].journey[r].engagements)for(var o=0;o<i.session.visits[n].journey[r].engagements.length;o++)if(i.session.visits[n].journey[r].engagements[o].id===t)return i.session.visits[n].journey[r].engagements.splice(o,1),e.setData("profileJSON",JSON.stringify(i));return L.resolve()}(t.cacheManager,n.engagementId).then((function(){return n}));var l=parseInt(o.response.holdtime||"0",10);if("true"===o.response.slotavailable&&"true"===o.response.queueopen&&"true"===o.response.agentavailable&&l<a)n.status=!0;else{var d=function(e){var t=arguments;e=Ot(e);for(var i=1;i<arguments.length;i++)kt(e,t[i]);return e}({},i.getEngagementRecord(n.engagementId));"false"===o.response.queueopen?(d.chat.missed_reason=2,Ai(t,"service-line-closed",s,c,"proactive",u.traceId)):l>=a?(d.chat.missed_reason=3,Ai(t,"wait-too-long",s,c,"proactive",u.traceId)):"false"===o.response.agentavailable?(d.chat.missed_reason=1,Ai(t,"no-agent-available",s,c,"proactive",u.traceId)):"true"!==o.response.slotavailable&&Ai(t,"no-agent-slots-available",s,c,"proactive"),i.setEngagementRecord(n.engagementId,d),n.status=!1}return n}))},e.startNewSession=function(){var i=t.widgetManager,r=Vo(i.device),o=t.serviceUrl.connector+"/connector/channels/queue_status/"+e.parameters.portalId+"/device/"+r;return t.httpGet(o).then((function(r){if(e.shouldReplaceIframeSrc){var o=e.getRemoteURL();"true"!==r.response.slotavailable&&(o=qo(n,e.oldRemoteUrl)),navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?o+="&fullScreen=false":"Mobile"!==i.device&&"Tablet"!==i.device||(o+="&fullScreen=true"),ni("#concierge-widget-chat .widget-content").attr("src",o)}else ni("#concierge-widget-chat iframe.widget-content").replaceWith('<iframe frameborder="no" class="widget-content"></iframe>'),t.widgetManager.writeSrcToIframe(e.name)}))},e.checkAvailability=function(e){var n=e.parameters,r=Vo(i.device);if(!e.ruleSettings)return L.resolve({status:!1});var o=t.serviceUrl.connector+"/connector/channels/queue_status/"+n.portalId+"/device/"+r;return t.httpGet(o).then((function(t){return t.response?e.ruleSettings.hide_on_demand_chat_when_service_line_is_closed&&"true"!==t.response.queueopen?{status:!1}:e.ruleSettings.hide_on_demand_chat_when_no_available_agent_slots&&"true"!==t.response.slotavailable?{status:!1}:e.ruleSettings.check_queue_wait_time_for_on_demand_chat&&parseInt(t.response.holdtime,10)>e.ruleSettings.queue_wait_time?{status:!1}:{status:!0}:{status:!1}})).catch((function(e){return q.log("checkAvailability error thrown: "+e),{status:!1}}))},e&&e.titleBar&&(e.titleBar.onclick=function(){i.hideWidget(!1),Ji("widgetMinimized",{widgetName:e.name})})}(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lo),jo={};function Vo(e){var t=jo[e];return t||(t=0),t}jo.Mobile=1,jo.Tablet=2,jo.Desktop=3;var Fo=function(e){return parseInt(e)};function qo(e,t){var i,n=e.getVolatileData("moxie_channels_custom_data");if(function(e,t){if(e)for(var i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");0===n&&((r=r[0].split("?"))[0]=r[1]),e&&ne(e,r[0])&&delete e[r[0]]}}(n,t),n){if("object"!=typeof n)try{n=JSON.parse(n)}catch(e){q.log("Error parsing "+n+": err")}"object"==typeof n&&(i=n,0!==Object.keys(i).length)&&(t=t+"&"+function(e){for(var t=[],i=Object.keys(e),n=0;n<i.length;n++){var r=i[n];if(Array.isArray(e[r])){var o,a=[];for(o=0;o<e[r].length;o++)a.push(Dt(r+"[]")+"="+Dt(e[r][o]));t.push(a.join("&"))}else t.push(Dt(r)+"="+Dt(e[r]))}return t.join("&")}(n))}return t}function Jo(e,t){var i=t.widgetManager,n=t.cacheManager;e.getEngagmentId=function(){return n.getWidgetCache(this.name,"engagement_id",!0)},e.getActiveSession=function(){return n.getWidgetCache(this.name,"active_session")},e.getSuspendedSession=function(){return n.getWidgetCache(this.name,"suspended_session",!0)},e.closeWidget=function(){},e.getRemoteURL=function(){var e,t=this.remoteURL,i=this.parameters.portalId;return e="object"==typeof t?t[i]:t,qo(n,e)},e.updateBroadcastPayload=function(e,i){if(this.parameters){var n=this.parameters;if(n.portalId&&(i.portalId=n.portalId),n.serviceLineId){var r=n.serviceLineId;return i.serviceLineId=r,t.serviceLines.getName(r).then((function(e){return i.serviceLine=e,i}))}}return L.resolve(i)},e.handleChannelsMessage=function(e,t){var n=this.name;switch(q.log("Event: "+e.call+" URL: "+e.url+" DATA: "+t.data),e.call){case"openSurvey":i.handleBroadcast(n,"surveyLoaded",{sessionId:Fo(i.concierge.cacheManager.getWidgetCache(n,"sessionId"))}),i.widgetAreaIFrameForWidget(n).attr("src",e.url);break;case"setReturnFromSurvey":i.handleBroadcast(n,"surveyCompleted",{sessionId:Fo(i.concierge.cacheManager.getWidgetCache(n,"sessionId"))}),i.hideWidget(!1);break;case"setFlyoutContent":i.widgetAreaIFrameForWidget(n).attr("src",e.url);break;case"chatFocus":"Tablet"===i.device&&"object"!=typeof window.visualViewport&&(i.makePositionAbsolute(),i.needsForceBlur=!0);break;case"chatBlur":break;case"getTabInfo":i.handleGetTabInfo(t,n);break;case"setChatInProgress":var r=parseInt(e.sessionId);0===e.sessionId&&"Tablet"===i.device&&"object"!=typeof window.visualViewport&&(i.makePositionAbsolute(),i.needsForceBlur=!0),i.handleSetChatInProgress(r,n,this.parameters),r>0&&i.handleBroadcast(n,"chatSessionStarted",{sessionId:r})}},e.beforeLoad=function(){t.widgetManager.channelsWidget=this}}var Ho=function(e){function t(t,i){e.call(this,t,i),this.baseHideWidget=this.hideWidget,this.hideWidget=function(){this.baseHideWidget(),this.closeWidget()}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lo);function $o(e,t,i,n,r,o,a,s){Object.defineProperty(this,"name",{value:t,enumerable:!0,writable:!1}),Object.defineProperty(this,"maxLength",{value:i,enumerable:!0,writable:!1}),Object.defineProperty(this,"required",{value:n,enumerable:!0,writable:!1}),Object.defineProperty(this,"label",{value:r,enumerable:!0,writable:!1}),Object.defineProperty(this,"type",{value:o,enumerable:!0,writable:!1}),Object.defineProperty(this,"defaultvalue",{value:a,enumerable:!0,writable:!1}),Object.defineProperty(this,"options",{value:s,enumerable:!0,writable:!1}),this.hide=e}function Uo(){this.hide=!1,this.questions=[]}$o.prototype.setAnswer=function(e){var t=void 0!==e.hide?e.hide:this.hide;if("16"===this.type||"15"===this.type||"4"===this.type||"6"===this.type){for(var i=0;i<this.options.length;i++)if(this.options[i].value===e.value){this.answer=e.value,this.hide=t;break}}else this.answer=e.value,this.hide=t},Uo.prototype.getQuestionByName=function(e){for(var t=0;t<this.questions.length;t++)if(this.questions[t].name===e)return this.questions[t];return null},Uo.prototype.loadQuestions=function(e){for(var t=0;t!==e.length;t++){var i=e[t],n=new $o(!1,i.formatParameters.elementname,i.formatParameters.elementmaxlength,i.formatParameters.elementrequired,i.actualquestion,i.type,i.formatParameters.elementdefaultvalue||i.formatParameters.elementchecked,i.options);"14"===n.type?n.answer="true"===i.formatParameters.elementchecked:n.answer=n.defaultvalue,this.questions.push(n)}},Uo.load=function(e){var t=new Uo;t.hide=!0===e.hide;for(var i=e.questions?e.questions.length:0,n=0;n<i;n++){var r=e.questions[n],o=new $o(r.hide,r.name,r.maxLength,r.required,r.label,r.type,r.defaultvalue,r.options);o.answer=r.answer,t.questions.push(o)}return void 0!==e.sendChatTranscript&&(t.sendChatTranscript=e.sendChatTranscript),t},Uo.prototype.toJson=function(){return JSON.stringify(this)};var Bo=function(e){function t(t,i){e.call(this,t,i),Jo(this,t),function(e,t){var i=t.widgetManager,n=t.cacheManager;e.preferredSpotName=function(){return"chat"},e.titleBar.onclick=function(){sessionStorage.getItem("kbot-disableTitleClick")||(i.hideWidget(!1),Ji("widgetMinimized",{widgetName:"kbot"}),n.setWidgetCache("kbot","shouldReopen",!1,!1))},e.sendSearchGuid=function(e,i){var r={chat_session_id:e},o=i.kbPortalId,a=n.getWidgetCache("kbot","search-guid",!1);if(o&&a){var s=new XMLHttpRequest,c=t.serviceUrl.connector+"/connector/kb/suggestions/"+o+"/"+a;s.open("PUT",c,!0),s.setRequestHeader("Content-Type","application/json"),s.withCredentials=!1,s.onerror=function(){q.log("Received failure response from connector endpoint for kb search_guid")},s.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&200===this.status&&(q.log("Sent to kb: "+JSON.stringify(r)),n.removeWidgetCache("kbot","search-guid",!1))},s.send(JSON.stringify(r))}},e.prepareToLoad=function(r){var o,a=r.parameters,s="questionnaire-"+r.parameters.questId,c=t.serviceUrl.connector+"/connector/channels/questionnaire/"+a.questId+"/"+a.styleId;return t.httpGetXMLHttpRequest(c).then((function(e){var i=JSON.parse(e.responseText);return r.parameters.parameters=i.response.parameters,r.parameters.traceId=Ro(e),(o=new Uo).loadQuestions(i.response.questions),t.onQuestionnaireLoadedCallbacks.doCallbacksAsync(o)})).then((function(){return n.setWidgetCache("kbot",s,o.toJson())})).then((function(){return sessionStorage.getItem("MoxieFlyout.chatInProgress")?e.autoOpen=!0:n.getWidgetCache("kbot","shouldReopen",!1)&&"null"===sessionStorage.getItem("MoxieFlyout.chatInProgress")&&(e.autoOpen=!0),e})).catch((function(t){return q.log("kbot failed in prepare to load:"+JSON.stringify(t)),i.removeWidget(e),null}))},e.shouldRebuildIframe=function(){var e=this.getActiveSession();return n.getWidgetCache(this.name,"rebuildIframe",!1)&&!e},e.beforeAdd=function(r){var o,a,s=r.ref,c=r.parameters,u=Vo(i.device),l=this.getEngagmentId(),d=this.getSuspendedSession(),g=this.getActiveSession(),h=n.getWidgetCache("kbot","active_kb_session");if(!r.ruleSettings)throw new Error("obj.ruleSettings is missing");return a=r.ruleSettings.skip_chat_queue_status_check?t.serviceUrl.connector+"/connector/channels/portal_with_service_line/"+c.portalId+"/device/"+u:t.serviceUrl.connector+"/connector/channels/queue_status/"+c.portalId+"/device/"+u,t.httpGetXMLHttpRequest(a).then((function(e){var i=JSON.parse(e.responseText);if(c.traceId=Ro(e),r.ruleSettings.skip_chat_queue_status_check)c.serviceLineId||(c.serviceLineId=i.response.serviceLineId,c.serviceLine=i.response.serviceLineName),t.serviceLines.setName(c.serviceLineId,c.serviceLine);else{if(c.serviceLineId||(c.serviceLineId=i.response.id,c.serviceLine=i.response.name),t.serviceLines.setName(c.serviceLineId,c.serviceLine),c.serviceLineStatus={open:"true"===i.response.queueopen,slotAvailable:"true"===i.response.slotavailable},!i.response)throw new Error("status.response evaluates to false");if(!Hr(c.rule.source)&&r.ruleSettings.hide_on_demand_chat_when_service_line_is_closed&&"true"!==i.response.queueopen)throw new Error("service line is closed");if(o="true"===i.response.slotavailable,!Hr(c.rule.source)&&r.ruleSettings.hide_on_demand_chat_when_no_available_agent_slots&&!o&&!d&&!g&&!r.engagementId)throw new Error("slot not available");no(r.ruleSettings.check_queue_wait_time_for_on_demand_chat,V(i,"response","holdtime"),r.ruleSettings.queue_wait_time,d,g)}if(c.widgetpath=t.scriptLocation+"/widgets/kbot/"+t.assetVersion.widgets+"/",c.langOptions=t.langOptions,r.ruleSettings.skip_chat_queue_status_check)return i;var n=t.serviceUrl.connector+"/connector/channels/portals/"+c.portalId;return t.httpGetXMLHttpRequest(n).then((function(e){var t=JSON.parse(e.responseText);return c.traceId=Ro(e),t}))})).then((function(o){var a=0;o.response.deviceList.length>1&&(a=Vo(i.device));(!s.remoteURL||"string"==typeof s.remoteURL||s.remoteURL instanceof String)&&(s.remoteURL={}),s.portalId=c.portalId,s.remoteURL[c.portalId]=fo("<%=host %>/netagent/cimlogin.aspx?questid=<%=questId %>&portid=<%=portalId %>&defaultStyleId=<%=styleId %>&widgetpath=<%=widgetpath %>&flyout=1")({host:c.host,questId:o.response.deviceList[a].questid,styleId:o.response.deviceList[a].styleid,portalId:o.response.deviceList[a].styleid,widgetpath:t.scriptLocation+"/widgets/kbot/"+t.assetVersion.widgets+"/"}),s.hashedQuestId=o.response.deviceList[a].questid,s.hashedPortalId=o.response.deviceList[a].styleid,navigator.appVersion&&-1!==navigator.appVersion.indexOf("MSIE 10")?(c.fullScreen=!1,s.remoteURL[c.portalId]+="&fullScreen=false"):"Mobile"!==i.device&&"Tablet"!==i.device||(c.fullScreen=!0,s.remoteURL[c.portalId]+="&fullScreen=true"),r.engagementId&&r.engagementId!==l&&(l=!1);var u=0!==i.notificationType;if(c.questId=o.response.deviceList[a].questid,c.styleId=o.response.deviceList[a].styleid,n.getWidgetCache("kbot","suspended_session",!0)&&l)return u&&i.widgetsType.closeNotification(),e.shouldReplaceIframeSrc=!0,n.removeWidgetCache("kbot","suspended_session",!0),void(e.autoOpen=!0);var d=n.getWidgetCache("kbot","widget-closed");if(i.loadingActiveWidgets&&g&&l)return e.shouldReplaceIframeSrc=!0,s.origRemoteURL=s.remoteURL,s.oldRemoteUrl=s.remoteURL[c.portalId],s.remoteURL[c.portalId]=fo(g)({host:c.host,widgetpath:t.scriptLocation+"/widgets/kbot/"+t.assetVersion.widgets+"/"}),d||u?i.loadWidget(e):void(e.autoOpen=!0);if(i.loadingActiveWidgets&&h&&l){var f=n.getWidgetCache("kbot","shouldReopen",!1);return d||u||!f?i.loadWidget(e):void(e.autoOpen=!0)}})).then((function(){return r.status=!0,r}))},e.beforeNotify=function(e){return L.resolve(Wo(e,!1))},e.startNewSession=function(){var e=t.widgetManager.createEngagementRecord(this,"kb");n.setWidgetCache("kbot","engagement_id",e,!0),n.removeWidgetCache("kbot","active_session"),ni("#concierge-widget-kbot iframe.widget-content").replaceWith('<iframe frameborder="no" class="widget-content"></iframe>'),t.widgetManager.writeSrcToIframe("kbot"),delete this.shouldReplaceIframeSrc},e.createChatEngagementRecord=function(){var e=t.widgetManager.createEngagementRecord(this,"chat");return n.setWidgetCache("kbot","engagement_id",e,!0),{id:e,data:t.widgetManager.getEngagementRecord(e)}}}(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lo);var Go=function(e){function t(t,i){e.call(this,t,i),function(e,t){e.beforeAdd=function(i){if(i.parameters.langOptions=t.langOptions,!i.ruleSettings)throw new Error("obj.ruleSettings is missing");return e.parameters.ruleSettings=i.ruleSettings,i.status=!0,L.resolve(i)}}(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lo);var zo=function(e){function t(t,i){e.call(this,t,i),function(e,t){e.name="bell",e.priority=0,e.buttonEnabled=!1,e.icon=V(t,"widgetManager","engagementWidgets","conciergeTab","icon"),e.preferredSpotName=function(){return"bell"},e.execute=function(e){return L.resolve(null)}}(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lo);var Ko=function(e){function t(t,i){e.call(this,t,i),this.engagement_type=5,function(e,t){var i=t.widgetManager;e.priority=0,e.shouldDisplayBell=function(){return!1},e.preferredSpotName=function(){return null},e.beforeAdd=function(e){if(Kr(i)){var n=i.wmState;if(null===n.spots.single.widget)return kr(n,new zo(t,{rule:{source:"internal"},parameters:{}})).then((function(t){return Wo(e,t.status)}))}return L.resolve(Wo(e,!0))},e.execute=function(i){var n=this;if(!n.isExecuting){var r=this.parameters;return n.isExecuting=!0,"_blank"===r.linkStrategy?(Xo(t,r),Ar(i.wmState,e),n._openTimeout=setTimeout((function(){n.isExecuting=!1,Lr(i.wmState,e),delete n._openTimeout}),1e3),window.open(r.url,r.linkStrategy,"noopener")):t.logDisabled?window.open(r.url,r.linkStrategy,"noopener"):(window.addEventListener("GoMoxie:PriorityEvents",(function(){window.open(r.url,r.linkStrategy,"noopener")}),!1),Ar(i.wmState,e),this._openTimeout=setTimeout((function(){delete n._openTimeout,window.open(r.url,r.linkStrategy,"noopener")}),3e3),Xo(t,r)),L.resolve(null)}},e.destroy=function(t){Lr(t.wmState,e),this._openTimeout&&clearTimeout(this._openTimeout)}}(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lo);function Xo(e,t){Ji("linkFollowed",{strategy:t.linkStrategy,url:t.url}),qi(e,t.url,t.linkStrategy,t.rule.id)}function Qo(e){e.bridgeListener=Yo.bind(e),window.addEventListener("message",e.bridgeListener,!1)}function Yo(e,t){var i=Zo,n=!1;null!=t&&(i=t.doPostMessage,n=!0);var r,o=this.concierge,a=o.cacheManager,s=this.wmState;if("string"==typeof e.data&&"SessionCleared"!==e.data)try{r=JSON.parse(e.data)}catch(t){return q.log("WidgetBridge received invalid JSON: ",t),void q.log("Payload was:"+e.data)}else r=e.data;if(r&&r.call&&this.channelsWidget)this.channelsWidget.handleChannelsMessage(r,e);else{var c=r.widget;if(c){var u=this.engagementWidgets.widgets[c];if(u){var l=u.parameters;if(!Br(c)){var d=Gr(c)&&"object"==typeof u.remoteURL?u.remoteURL[u.portalId]:u.remoteURL;if(void 0!==u.shouldReplaceIframeSrc&&d&&e.origin.toLowerCase()!==d.match(/^https?:\/\/[^/]+/)[0].toLowerCase()&&(e.origin!=="http://"+window.location.hostname||e.origin!=="https://"+window.location.hostname))return}var g,h=e.data,f=e.data.parameters;if(q.log("["+h.type+"] message accepted from: "+e.origin),!n&&"_multi"===h.type)return g=ea(this,c,e,h,f),void i(e,g);g={};var p=null,v=null;switch(h.type){case"focusEvent":"Tablet"===this.device&&"object"!=typeof window.visualViewport&&(this.makePositionAbsolute(),this.needsForceBlur=!0);break;case"blurEvent":"Tablet"===this.device&&"object"!=typeof window.visualViewport&&(this.needsForceBlur=!1);break;case"resetConcierge":Zr(this,!0),this.removeWidget(u,!0),this.addWidget(u.parameters,u.parameters.rule);break;case"getVisitorProfile":p="profileJSON",g={type:"getVisitorProfileResponse",replyForMsgId:h.msgId,parameters:{data:a.getData(p)}},i(e,g);break;case"setVisitorProfile":p="profileJSON",a.setData(p,JSON.stringify(f.data));break;case"getEngagementRecord":v=a.getWidgetCache(c,"engagement_id",!0),g={type:"getEngagementRecordResponse",replyForMsgId:h.msgId,parameters:{id:v,data:ao(a,v)}},i(e,g);break;case"onQuestionnaireSubmit":g={type:"onQuestionnaireSubmitResponse",replyForMsgId:h.msgId},o.onQuestionnaireSubmitCallbacks?o.onQuestionnaireSubmitCallbacks.doCallbacksAsync(Uo.load(f.data)).then((function(t){g.parameters=t.toJson(),i(e,g)})):(g.parameters=JSON.stringify(f),i(e,g));break;case"getParameters":g={type:"getParametersResponse",replyForMsgId:h.msgId,parameters:{data:l}},i(e,g);break;case"setEngagementRecord":v=a.getWidgetCache(c,"engagement_id",!0),oo(a,v,f.data);break;case"createEngagementRecord":v=this.createEngagementRecord(u),a.setWidgetCache(c,"engagement_id",v,!0),g={type:"createEngagementRecordResponse",replyForMsgId:h.msgId,parameters:{id:v,data:this.getEngagementRecord(v)}},i(e,g);break;case"getWidgetInitData":g={type:"getWidgetInitDataResponse",replyForMsgId:h.msgId,parameters:{data:{clientHref:window.location.href,parameters:u.parameters,configuration:u.configuration,translation:o.localization.data}}},i(e,g);break;case"getConfiguration":g={type:"getConfigurationResponse",replyForMsgId:h.msgId,parameters:{data:u.configuration}},i(e,g);break;case"getCache":g={type:"getCacheResponse",replyForMsgId:h.msgId,parameters:{key:f.key,value:a.getWidgetCache(c,f.key,f.persist)}},i(e,g);break;case"getCacheData":g={type:"getCacheDataResponse",replyForMsgId:h.msgId,parameters:{key:f.key,value:a.getData(f.key)}},i(e,g);break;case"getTranslation":g={type:"getTranslationResponse",replyForMsgId:h.msgId,parameters:{value:o.localization.data}},i(e,g);break;case"getOtherCache":g={type:"getOtherCacheResponse",replyForMsgId:h.msgId,parameters:{key:f.key,value:a.getWidgetCache(c,f.key,f.persist)}},i(e,g);break;case"setCache":a.setWidgetCache(c,f.key,f.value,f.persist);break;case"removeCache":a.removeWidgetCache(c,f.key,f.persist);break;case"notificationMessage":if(hr(s)||fr(s))return;f.title&&(f.title=o.getTranslation(zr(c),f.title)),u.parameters.title=f.title,u.parameters.message=f.message,u.parameters.icon=f.icon,u.parameters.callToAction=f.callToAction,u.parameters.notificationType=2,u.notificationType=2,this.showNotification(u);break;case"updateWidgetTitle":this.updateWidgetTitle(c,f);break;case"updateTabText":ni("#concierge .con_tab_text").text(f.text);break;case"hideWidget":u.hideWidget();break;case"setServiceLineId":this.setServiceLineId(f,c);break;case"setActive":f.active?Wr(s,u):Rr(s,u);break;case"handleClose":a.setWidgetCache(c,"willHandleClose",f.value,!0);break;case"callFunction":g={type:"callFunctionResponse",replyForMsgId:h.msgId,parameters:{}},u[f.funcName]&&(g.parameters.result=u[f.funcName](f.funcArgs)),i(e,g);break;case"broadcast":this.handleBroadcast(c,f.eventType,f.data)}}}}}var Zo=function(e,t){e&&e.source&&e.source.postMessage(lo(t),e.origin)},ea=function(e,t,i,n,r){var o=[],a=[],s={doPostMessage:function(e,t){o.push(t)}};return r.calls.forEach((function(n){n.parameters.signature=r.signature,n.parameters.widget=t,n.widget=t;var c=o.length,u=!1;try{e.bridgeListener({data:n,origin:i.origin},s)}catch(e){u=!0,o.push(null),a.push(e.name)}u||(a.push(null),o.length===c&&o.push(null))})),{type:"_multiResponse",replyForMsgId:n.msgId,parameters:{success:o,failure:a}}};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var ta,ia=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){
/*!
   * displacejs.js 1.3.2 - Tiny javascript library to create moveable DOM elements.
   * Copyright (c) 2019 Catalin Covic - https://github.com/catc/displace
   * License: MIT
   */
e.exports=function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var n=function(e){return e&&e.__esModule?e:{default:e}}(i(1));e.exports=n.default},function(e,t,i){function n(){var e=this,t=this.el,i=this.opts||s,n={};if(t.style.position="absolute",this.handle=i.handle||t,i.constrain){for(var c=i.relativeTo||t.parentNode,u=t,l=0,d=0;u!==c;)u=u.parentNode,(0,r.isRelative)(u)&&(l-=u.offsetLeft,d-=u.offsetTop),u===c&&(l+=u.offsetLeft,d+=u.offsetTop);var g=l+c.offsetWidth-t.offsetWidth,h=d+c.offsetHeight-t.offsetHeight;n.xClamp=(0,r.generateClamp)(l,g),n.yClamp=(0,r.generateClamp)(d,h)}this.opts=i,this.data=n,this.events={mousedown:o.mousedown.bind(this),mouseup:o.mouseup.bind(this),touchstart:o.touchstart.bind(this),touchstop:o.touchstop.bind(this),scrollFix:function(t){e.isDragging&&t.preventDefault()}},this.handleMove=a(this.opts.customMove),this.handle.addEventListener("mousedown",this.events.mousedown,!1),this.handle.addEventListener("touchstart",this.events.touchstart,!1),document.addEventListener("touchmove",this.events.scrollFix,{passive:!1})}Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),o=i(3),a=(0,r.generateMoveFn)(),s={constrain:!1,relativeTo:null,handle:null,ignoreFn:null,highlightInputs:!1,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchStop:null,customMove:null},c=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw Error("Must include moveable element");this.el=t,this.opts=i,n.call(this)}return e.prototype.reinit=function(){this.destroy(),n.call(this)},e.prototype.destroy=function(){var e=this.events;this.handle.removeEventListener("mousedown",e.mousedown,!1),document.removeEventListener("mousemove",e.mousemove,!1),document.removeEventListener("mouseup",e.mouseup,!1),this.handle.removeEventListener("touchstart",e.touchstart,!1),document.removeEventListener("touchmove",e.touchmove,!1),document.removeEventListener("touchstop",e.touchstop,!1),document.removeEventListener("touchmove",this.events.scrollFix,{passive:!1})},e}();t.default=function(e,t){return new c(e,t)}},function(e,t){function i(e,t,i){e.style.left=t+"px",e.style.top=i+"px"}Object.defineProperty(t,"__esModule",{value:!0}),t.generateClamp=function(e,t){return function(i){return Math.min(Math.max(i,e),t)}},t.isRelative=function(e){return"relative"===window.getComputedStyle(e).position},t.generateMoveFn=function(){return window.requestAnimationFrame?function(e){var t=e||i;return function(e,i,n){window.requestAnimationFrame((function(){t(e,i,n)}))}}:function(e){return function(t,n,r){(e||i)(t,n,r)}}}},function(e,t){function i(e,t,i){var n=this.el,r=this.opts,o=this.data;"function"==typeof r.onMouseMove&&r.onMouseMove(n,i);var a=i.clientX-e,s=i.clientY-t;return r.constrain&&(a=o.xClamp(a),s=o.yClamp(s)),this.handleMove(n,a,s),i.preventDefault(),!1}function n(e,t,i){var n=this.el,r=this.opts,o=this.data;"function"==typeof r.onTouchMove&&r.onTouchMove(n,i);var a=i.targetTouches[0],s=a.clientX-e,c=a.clientY-t;return r.constrain&&(s=o.xClamp(s),c=o.yClamp(c)),this.handleMove(n,s,c),i.preventDefault(),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.mousedown=function(e){var t=this.opts;if(t.highlightInputs){var n=e.target.tagName.toLowerCase();if("input"===n||"textarea"===n)return}if(!t.ignoreFn||!t.ignoreFn(e)){if(0===e.button){var r=this.el,o=this.events;"function"==typeof t.onMouseDown&&t.onMouseDown(r,e);var a=e.clientX-r.offsetLeft,s=e.clientY-r.offsetTop;o.mousemove=i.bind(this,a,s),document.addEventListener("mousemove",o.mousemove,!1),document.addEventListener("mouseup",o.mouseup,!1)}e.preventDefault()}},t.mousemove=i,t.mouseup=function(e){var t=this.el,i=this.opts,n=this.events;"function"==typeof i.onMouseUp&&i.onMouseUp(t,e),document.removeEventListener("mouseup",n.mouseup,!1),document.removeEventListener("mousemove",n.mousemove,!1)},t.touchstart=function(e){var t=this.opts;if(t.highlightInputs){var i=e.target.tagName.toLowerCase();if("input"===i||"textarea"===i)return}if(!t.ignoreFn||!t.ignoreFn(e)){var r=this.el,o=this.events;"function"==typeof t.onTouchStart&&t.onTouchStart(r,e);var a=e.targetTouches[0],s=a.clientX-r.offsetLeft,c=a.clientY-r.offsetTop;o.touchmove=n.bind(this,s,c),this.isDragging=!0,document.addEventListener("touchmove",o.touchmove,!1),document.addEventListener("touchend",o.touchstop,!1),document.addEventListener("touchcancel",o.touchstop,!1)}},t.touchmove=n,t.touchstop=function(e){this.isDragging=!1;var t=this.el,i=this.opts,n=this.events;"function"==typeof i.onTouchStop&&i.onTouchStop(t,e),document.removeEventListener("touchmove",n.touchmove,!1),document.removeEventListener("touchend",n.touchstop,!1),document.removeEventListener("touchcancel",n.touchstop,!1)}}])})),na=(ta=ia)&&ta.__esModule&&Object.prototype.hasOwnProperty.call(ta,"default")?ta.default:ta;ia.displacejs;function ra(e){this.shouldDisplayBell=!1,this.KNOWN_WIDGETS={chat:{requires:["portalId","host"]},email:{requires:["mailboxId"]},kb:{requires:["articleLimit","portalId","searchText"]},kbot:{requires:["portalId","host"]}},this.notificationType=0;var t=navigator;this.concierge=e,this.journeyViewManager=new Ao(e),this.stashedConciergeCss={top:"",bottom:""},this.needsForceBlur=!1,this.state="tab",this.device=li(t),this.openWidget=!1,this.widgetLoadPromises={},this.windowHasDragResize=!1,q.log("WidgetManager constructor: device="+this.device),"Mobile"===this.device?this.widgetsType=new xo(this):this.widgetsType=new ko(this),this.bridgeListener={},this.initDraggableData()}function oa(e){var t,i=e.concierge.cacheManager;return e.tabStyle=e.tabStyle||{verticalOffset:"100",verticalAnchor:1,horizontalOffset:"20",cascade:1},i&&e.engagementWidgets&&(t=e.engagementWidgets).conciergeTab&&t.conciergeTab.tabStyle&&(void 0!==t.conciergeTab.tabStyle.verticalOffset&&(e.tabStyle.verticalOffset=t.conciergeTab.tabStyle.verticalOffset),void 0!==t.conciergeTab.tabStyle.verticalAnchor&&(e.tabStyle.verticalAnchor=t.conciergeTab.tabStyle.verticalAnchor),void 0!==t.conciergeTab.tabStyle.horizontalOffset&&(e.tabStyle.horizontalOffset=t.conciergeTab.tabStyle.horizontalOffset),void 0!==t.conciergeTab.tabStyle.cascade&&(e.tabStyle.cascade=t.conciergeTab.tabStyle.cascade)),e.tabStyle}function aa(e,t){var i,n,r,o,a,s=t.widget,c={},u=e.engagementWidgets.widgets[s].parameters;return"email"===s?(r="mailboxId",n="mailbox ID"):(r="portalId",n="portal ID"),u&&(a=u[r],i=u.host),(o=t[r]||a)||q.log("No Moxie "+n+" specified for engagement."),c[r]=o,Gr(s)&&function(e,t,i){var n=e||t;n||q.log("No Moxie chat host specified for engagement.");i.host=n}(t.host,i,c),c}function sa(e){window.MOXIE_CONCIERGE&&delete window.MOXIE_CONCIERGE.startEngagement,e.dataStartListener&&(St(document,"click",e.dataStartListener),delete e.dataStartListener),e.windowHasDragResize&&(wt(window,"resize",e.dragResizeHandler.bind(this)),e.windowHasDragResize=!1),function(e){e.bridgeListener&&(window.removeEventListener("message",e.bridgeListener,!1),delete e.bridgeListener)}(e)}function ca(e){e.initEngagementWidgets(),Qo(e),oa(e),function(e){var t=e.widgetsType.html();t=(t=t.replace(/\/SCRIPT_LOCATION\//g,e.concierge.scriptLocation+"/")).replace(/\/DEVICE\//g,e.device);var i=!1;if(e.concierge.cacheManager&&e.engagementWidgets&&(i=e.engagementWidgets).conciergeTab&&i.conciergeTab.icon&&i.conciergeTab.icon.svg){var n=i.conciergeTab.icon.svg;t=t.replace(/<!-- replace: ICON -->/g,n)}var r=ni(t=fo(t)({concierge:e.concierge,CONCIERGE_TAB_ICON_SVG:e.engagementWidgets.conciergeTab.icon.svg,CON_CLOSED:Kr(e)?" single-channel":"",CON_ROLE_ATTRIBUTE:Kr(e)?"":' role="menu"',CLOSE_ICON:e.concierge.getTranslation("common","CLOSE_ICON"),CONCIERGE:e.concierge.getTranslation("common","CONCIERGE"),NOTIFICATION_ANNOUNCE:e.concierge.getTranslation("common","NOTIFICATION_ANNOUNCE")})),o=function(t){if("click"===t.type||13===t.which||32===t.which)return e.closeWidget(!1),!1};bt(r,"click",Ct("con-close-area"),o),bt(r,"keypress",Ct("con-close-area"),o);var a=Ct("con-widget-title-section");bt(r,"keyup",a,(function(){return rt(this,{outline:"-webkit-focus-ring-color auto 5px"}),!1})),bt(r,"blur",a,(function(){return rt(this,{outline:"none"}),!1}));var s=function(t){if("click"===t.type&&rt(this,{outline:"none"}),"click"===t.type||13===t.which||32===t.which){var i=ni(this).closest(".concierge-widget").data("widget");e.postMessageToWidget(i,"titleClicked");var n=e.engagementWidgets.widgets[i];return n.titleBar.onclick&&n.titleBar.onclick(e),!1}};bt(r,"click",a,s),bt(r,"keypress",a,s),e.widgetsType.beforeAppend&&e.widgetsType.beforeAppend(r),ni("body").append(r[0]),r.hide()}(e);var t=ni("#concierge .con-icon svg");void 0!==t&&t.length>0&&Yr(t[0]),e.$concierge=ni("#concierge"),e.widgetsType.start()}ra.prototype.startExternal=function(e,t){var i=this,n=!0===t.enableChatDeflection||"true"===t.enableChatDeflection;null!==t.widget&&void 0!==t.widget||(t.widget=t.startEngagement),"chat"===t.widget&&n&&(t.widget="kbot");var r=[];"kbot"===t.widget||"chat"===t.widget?(r.push("kbot"),r.push("chat")):r.push(t.widget);var o,a=null;if(r.forEach((function(e){null===a&&(function(e,t){var i=!1;return Object.keys(e.spots).forEach((function(n){var r=e.spots[n];r.widget&&r.widget.name===t&&(i=r.twiddled)})),i}(i.wmState,e)&&(a=e))})),null!==a){var s=L.resolve(null);return q.log('WidgetManager.startExternal not starting widget "'+t.widget+'" because the spot is twiddled'),(null!==(o=this.wmState).open&&void 0!==o.open?o.open.name:null)!==a&&(q.log('WidgetManager.startExternal is showing existing widget "'+a+'"'),"tab"===this.state&&this.widgetsType.toggleWindow&&(s=s.then((function(){return i.widgetsType.toggleWindow()}))),s=s.then((function(){return i.showWidget(i.findWidget(a))}))),s.then((function(){return{status:!1}}))}delete t.startEngagement,delete t.enableChatDeflection,t.ruleSource=e;var c=["externalLink","externalAPI"];if(t.ruleId=-1*(1+c.indexOf(e)),t.action="success",null===t.widget||void 0===t.widget||""===t.widget)return q.log("WidgetManager.startExternal invoked with improper widget specification"),L.resolve({status:!1,invalid:!0});var u=this;It(t,aa(this,t));var l=null;l="kbot"===t.widget?["kbot","chat"]:"chat"===t.widget?["chat","kbot"]:[t.widget];var d=L.resolve(null);return l.forEach((function(e){var t=i.findWidget(e);null!=t&&(q.log('WidgetManager.startExternal Removing widget: "'+e+'"'),d=d.then((function(){return u.removeWidget(t,!0)})))})),d.then((function(){return function(e,t){var i={name:t.ruleName,source:t.ruleSource,id:t.ruleId,action:t.action},n=L.resolve();return n=n.then((function(){if(e.notificationDisplayed())return q.log("WidgetManager.displayWidget("+t.widget+":"+t.ruleName+"): is closing the notification"),Tr(e.wmState)})).then((function(){return e.addWidget(t,i)})).then((function(i){if(i&&void 0!==i.status&&!1===i.status)return q.log("WidgetManager.displayWidget("+t.widget+":"+t.ruleName+"): halted because addWidget failed"),i;var n=L.resolve(null);return!1!==e.openWidget&&e.openWidget!==t.widget&&(n=n.then((function(){return e.hideWidget(!0)}))),n.then((function(){return e.showWidget(i.ref)})).then((function(){return e.showConcierge()})).then((function(){return e.widgetsType.openConcierge()})).then((function(){return{ref:i.ref,status:!0}}))})).catch((function(e){return q.log("WidgetManager.displayWidget("+t.widget+":"+t.ruleName+"): failed: "+e),q.log(e.stack),Ur}))}(i,t)}))},ra.prototype.findWidget=function(e){for(var t in this.wmState.spots){var i=this.wmState.spots[t];if(i.widget&&i.widget.name===e)return i.widget;if(i.reactive&&i.reactive.name===e)return i.reactive}return this.wmState.offer&&this.wmState.offer.name===e?this.wmState.offer:this.engagementWidgets.widgets[e]},ra.prototype.initDraggableData=function(){this.widgetAreaDragData||(this.widgetAreaDragData={draggedByUser:!1,initialElemData:null,currentElemData:null,parentData:null,resizedWhileMinimized:!1})},ra.prototype.removeDraggableData=function(){delete this.widgetAreaDragData},ra.prototype.dragStartHandler=function(e,t){this.$concierge.find("#concierge-iframe-cover").show(),gt(e,"is-dragging"),this.widgetAreaDragData.currentElemData=e.getBoundingClientRect(),this.widgetAreaDragData.parentData=e.parentNode.getBoundingClientRect(),this.widgetAreaDragData.draggedByUser||(ni(e).addClass("free-floating"),this.widgetAreaDragData.initialElemData=this.widgetAreaDragData.currentElemData,this.widgetAreaDragData.draggedByUser=!0)},ra.prototype.dragMaxCalculations=function(){var e,t=document.body.getBoundingClientRect().width-this.widgetAreaDragData.parentData.left,i=0-(this.widgetAreaDragData.currentElemData.width-t),n=this.widgetAreaDragData.parentData.right-this.widgetAreaDragData.initialElemData.right-this.widgetAreaDragData.parentData.width,r=this.widgetAreaDragData.currentElemData.width+n,o=0-r;this.widgetAreaDragData.parentData.left>r&&(o=0-this.widgetAreaDragData.parentData.left);var a=window.visualViewport?window.visualViewport.height:window.innerHeight;if(1===this.tabStyle.verticalAnchor){var s=a-this.widgetAreaDragData.parentData.top;e=0-this.widgetAreaDragData.currentElemData.height+s}else e=a-this.widgetAreaDragData.currentElemData.height-this.widgetAreaDragData.initialElemData.top;return{minX:o,maxX:i,minY:0-this.widgetAreaDragData.parentData.top,maxY:e}},ra.prototype.dragMoveHandler=function(e,t,i){if(this.widgetAreaDragData.currentElemData){var n=this.dragMaxCalculations(),r=n.minX,o=n.maxX,a=n.minY,s=n.maxY;t=Math.min(t,o),t=Math.max(t,r),i=Math.min(i,s),i=Math.max(i,a)}this.widgetAreaDragData.x=t,this.widgetAreaDragData.y=i,rt(e,{left:this.widgetAreaDragData.x,top:this.widgetAreaDragData.y})},ra.prototype.dragConfigData=function(){return{moveableWidgets:this.engagementWidgets.globalSettings.moveableWidgets,tabStyle:this.tabStyle}},ra.prototype.isDragConfigDataEqualToCurrent=function(e){if("object"!=typeof e)return!1;var t=this.dragConfigData();if(e.moveableWidgets!==t.moveableWidgets||"object"!=typeof e.tabStyle||"object"!=typeof t.tabStyle)return!1;for(var i=["cascade","horizontalOffset","verticalAnchor","verticalOffset"],n=0;n<i.length;n++){var r=i[n];if(e.tabStyle[r]!==t.tabStyle[r])return!1}return!0},ra.prototype.dragEndHandler=function(e,t){this.$concierge.find("#concierge-iframe-cover").hide(),ht(e,"is-dragging"),void 0===this.widgetAreaDragData.initialConfigData&&(this.widgetAreaDragData.initialConfigData=this.dragConfigData()),this.concierge.cacheManager.setClientCache("drag_position",{left:this.widgetAreaDragData.x,top:this.widgetAreaDragData.y,initialElemData:this.widgetAreaDragData.initialElemData,initialConfigData:this.widgetAreaDragData.initialConfigData},!0)},ra.prototype.dragCheck=function(e){var t=[];if("function"==typeof e.composedPath)for(var i=e.composedPath(),n=i.length,r=0;r<n&&"concierge-widget-area"!==i[r].id;r++)t.push(i[r]);else if(e.target){var o=e.target;for(t.push(o);o.parentNode&&"concierge-widget-area"!==(o=o.parentNode).id;)t.push(o)}for(var a=["con-widget-icon","clickable-title","con-close-area"],s=0;s<a.length;s++)if(ft(t,a[s]))return!0;return!1},ra.prototype.dragFixAfterResize=function(){if(this.widgetAreaDragData&&this.widgetAreaDragData.draggedByUser)if(fr(this.wmState)){this.widgetAreaDragData.resizedWhileMinimized=!1;var e=this.$concierge.find("#concierge-widget-area");this.dragStartHandler(e[0]),this.dragMoveHandler(e[0],this.widgetAreaDragData.x,this.widgetAreaDragData.y),this.dragEndHandler(e[0])}else t=this.wmState,i=!1,Object.keys(t.spots).forEach((function(e){t.spots[e].widget&&(i=!0)})),i&&(this.widgetAreaDragData.resizedWhileMinimized=!0);var t,i},ra.prototype.dragResizeHandler=function(e){this.draggableWidgetArea&&this.dragFixAfterResize()},ra.prototype.addEventListeners=function(){var e=this;if(window.MOXIE_CONCIERGE=window.MOXIE_CONCIERGE||{},window.MOXIE_CONCIERGE.startEngagement=function(t){return e.startExternal("externalAPI",t)},this.dataStartListener&&St(document,"click",this.dataStartListener),this.dataStartListener=bt(document,"click",yt(Xe,"data-moxie-start-engagement"),(function(t){var i=function(e){var t=/^moxie(.*)/,i={};for(var n in e)if(ne(e,n)&&t.test(n)){var r=n.replace(t,"$1");i[r=r.charAt(0).toLowerCase()+r.slice(1)]=e[n]}return i}(ni(this).data());return e.startExternal("externalLink",i),!1})),!e.isMobile()&&e.engagementWidgets.globalSettings.moveableWidgets){var t=e.$concierge.find("#concierge-widget-area");t.addClass("moveable-widget"),e.draggableWidgetArea=na(t[0],{onMouseDown:e.dragStartHandler.bind(e),onTouchStart:e.dragStartHandler.bind(e),customMove:e.dragMoveHandler.bind(e),onMouseUp:e.dragEndHandler.bind(e),onTouchStop:e.dragEndHandler.bind(e),ignoreFn:e.dragCheck}),e.windowHasDragResize||(vt(window,"resize",e.dragResizeHandler.bind(e)),window.visualViewport&&vt(window.visualViewport,"resize",e.dragResizeHandler.bind(e)),e.windowHasDragResize=!0)}},ra.prototype.isMobile=function(){return"Mobile"===this.device},ra.prototype.createEngagementRecord=function(e,t){var i=function(e,t){var i=e.name,n=e.parameters.proactive,r=e.parameters.rule,o=Br(t=t||e.name)?"kb":t,a={id:tn(),dirty:!0,time:Date.now(),type:j[t],name:o,proactive:void 0!==n&&n,rule:void 0!==r?r:null,decision_type:"",kb:null,chat:null,email:null};return Gr(i)?a.chat={agents:[],missed_reason:0}:"email"===i&&(a.email={sent:!1}),a}(e,t);return ro(this.concierge.cacheManager,i),i.id},ra.prototype.getEngagementRecord=function(e){return ao(this.concierge.cacheManager,e)},ra.prototype.setEngagementRecord=function(e,t){return oo(this.concierge.cacheManager,e,t)},ra.prototype.getWidgetParameters=function(e){return this.widgetParameters[e]},ra.prototype.toggleWindow=function(){this.widgetsType.toggleWindow(this)},ra.prototype.knownWidgets={chat:Po,kbot:Bo,kb:Go,email:Ho},ra.prototype.simpleWidgets={link:Ko},ra.prototype.createWidget=function(e){var t,i=this.concierge,n=JSON.parse(JSON.stringify(V(i,"configuration","widgets","widgets",e)||{}));return(t=this.knownWidgets[e]?new this.knownWidgets[e](i,n):this.simpleWidgets[e]?new this.simpleWidgets[e](i,n):new Lo(i,n)).name=e,t},ra.prototype.initEngagementWidgets=function(){var e=JSON.parse(JSON.stringify(V(this.concierge,"configuration","widgets")||{}));for(var t in e.widgets)e.widgets[t]=this.createWidget(t);for(var i in self.simpleWidgets)e.widgets[i]=this.createWidget(t);this.engagementWidgets=e,this.wmState=new cr(this)},ra.prototype.addWidget=function(e,t,i){var n,r=e.widget;return(n=this.createWidget(r)).widgetParameters=e,n.parameters=e,n.parameters.rule=t,n.parameters.proactive=n.parameters.proactive||!1,n.engagementId=i,kr(this.wmState,n)},ra.prototype.removeWidget=function(e,t){e&&(q.log('WidgetManager.removeWidget("'+e.name+'"): invoked.'),function(e,t){if(t){q.log('wmStateRemoveWidget called with: "'+t.name+'"'),e.notification===t&&Tr(e);var i=t.spot;if(q.log('wmStateRemoveWidget spotName is: "'+i+'"'),i){var n=lr(e,i);n.widget&&n.widget.name===t.name&&(n.reactive||n.widget.widgetParameters&&n.widget.widgetParameters.rule.id<0)?(q.log("wmStateRemoveWidget: remove reactive widget of same name"),mr(e,n.widget),Qr(i).remove(),n.reactive=n.widget=null):(q.log("wmStateRemoveWidget: remove not reactive"),n.reactive===t&&(n.reactive=null),n.widget===t&&n.reactive&&wr(e,n.reactive))}}}(this.wmState,e),e.destroy(this),t||ni("#concierge-widgets ul li").length||ni("#concierge").hide())},ra.prototype.updateWidgetTitle=function(e,t){var i=this.widgetAreaForWidget(e),n=i.find(".concierge-widget-header .con-widget-title"),r=t.text;n.text(r&&this.concierge.getTranslation(e,r,""));var o="";switch(t.buttonType||""){case"minimizeIcon":o=this.concierge.getTranslation("common","MINIMIZE_ICON");break;case"searchIcon":o=this.concierge.getTranslation("common","SEARCH_ICON");break;case"backIcon":o=this.concierge.getTranslation("common","BACK_ICON");break;default:o=""}var a=i.find(".concierge-widget-header .con-widget-icon");a.empty();var s=t.graphic||"";if(s.length){if("<"===s.charAt(0))a.html(s);else{var c=this.concierge.scriptLocation+"/widgets/"+e+"/"+s;a.html('<img src="'+c+'" />')}a.attr("title",o)}var u=i.find(".concierge-widget-header .con-widget-title-section");t.hasCallback?u.addClass("clickable-title").addClass(".clickable-title"):u.removeClass("clickable-title").removeClass(".clickable-title")},ra.prototype.makePositionAbsolute=function(){var e;"absolute"!==this.$concierge.css("position")&&(this.stashedConciergeCss=this.$concierge.css(["top","bottom"]),e=this.$concierge.offset().top,this.$concierge.css({position:"absolute",top:e,bottom:""}))},ra.prototype.makePositionFixed=function(){var e,t;"fixed"!==this.$concierge.css("position")&&this.stashedConciergeCss&&(t="auto"!==this.stashedConciergeCss.top?"top":"bottom",e=this.$concierge.offset().top-document.body.scrollTop,this.$concierge.css({position:"fixed",top:e,bottom:"auto"}),"top"===t?this.$concierge.animate({top:this.stashedConciergeCss.top},{label:"makePositionFixedTop"}):this.$concierge.animate({top:fe()-parseInt(this.stashedConciergeCss.bottom,10)-this.$concierge.height()},{label:"makePositionFixedBottom",done:function(){this.$concierge.css({top:"auto",bottom:this.stashedConciergeCss.bottom})}.bind(this)}))},ra.prototype.handleGetTabInfo=function(e,t){var i=this.concierge.cacheManager.getWidgetCache(t,"cookieId",!0);i||(i=Math.ceil(1e5*Math.random()),this.concierge.cacheManager.setWidgetCache(t,"cookieId",i,!0)),e.source.postMessage(JSON.stringify(lo({origWindowName:window.name,cookieID:i,currentOrigin:window.location.protocol+window.location.host,previousOrigin:window.location.protocol+window.location.host,sessionId:this.concierge.cacheManager.getWidgetCache(t,"sessionId")})),e.origin)},ra.prototype.handleSetChatInProgress=function(e,t,i){var n=this.engagementWidgets.widgets[t];n&&void 0!==n.sendSearchGuid&&n.sendSearchGuid(e,i),this.concierge.cacheManager.setWidgetCache(t,"sessionId",Math.abs(parseInt(e))),e>0?this.markChat(e,"start"):e<0&&this.markChat(e,"end")},ra.prototype.setNotificationType=function(e){return e>=0&&e<=2&&(this.notificationType=e,!0)},ra.prototype.handleBroadcast=function(e,t,i){if(this[e+"HandleBroadcast"]&&this[e+"HandleBroadcast"](e,t,i))return L.resolve(!0);var n=this,r=this.engagementWidgets.widgets[e],o="widget:"+zr(e)+":"+t;return(r&&r.updateBroadcastPayload?r.updateBroadcastPayload(o,i):L.resolve(i)).then((function(t){return function(e,t,i,n){try{switch(i){case"widget:chat:agentJoinedSession":bi(e.concierge,!0,t,n.agentId,n.agentName,n.sessionId,n.serviceLine,n.serviceLineId);break;case"widget:chat:agentLeftSession":n.agentId&&bi(e.concierge,!1,t,n.agentId,n.agentName,n.sessionId,n.serviceLine,n.serviceLineId);break;case"widget:chat:articleViewed":case"widget:kb:articleViewed":Ci(e.concierge,t,n.articleId,n.articleTitle);break;case"widget:chat:articleRated":case"widget:kb:articleRated":_i(e.concierge,t,n.articleId,n.articleTitle,n.search,n.ratingType,n.rating);break;case"widget:chat:articleCommented":case"widget:kb:articleCommented":Ei(e.concierge,t,n.articleId,n.articleTitle,n.search,n.ratingType,n.rating,n.comment);break;case"widget:chat:chatSessionStarted":Si(e.concierge,!0,t,n.sessionId,n.serviceLine,n.serviceLineId);break;case"widget:chat:chatSessionEnded":Si(e.concierge,!1,t,n.sessionId,n.serviceLine,n.serviceLineId),function(e,t){var i=t.sessionId;i&&e.concierge.cacheManager.setWidgetCache("kbot","lastChatSessionEnded",i,!1)}(e,n);break;case"widget:email:emailSent":Ii(e.concierge,t,n.mailboxId);break;case"widget:kb:portalSearched":case"widget:chat:portalSearched":Di(e.concierge,t,n.searchText,n.portalId,n.articlesList);break;case"widget:chat:prechatQuestionnaireComplete":Mi(e.concierge,t,n.serviceLine,n.serviceLineId)}}catch(e){q.log("Error in processBroadcast"+e)}}(n,e,o,t),Ji(o,t),null})).catch((function(e){q.log("handleBroadcast Error:"+e)}))},ra.prototype.markChat=function(e,t){var i=this.concierge.cacheManager.getData("profileJSON"),n=this.journeyViewManager.markChat(i,e,t);this.concierge.cacheManager.setData("profileJSON",JSON.stringify(n))},ra.prototype.showNotification=function(e){q.log("WidgetManager.showNotification called:",e.name),this.wmState.notification!==e&&Tr(this.wmState),this.wmState.notification=e,function(e,t){var i=t.parameters,n=i.title,r=i.message,o=i.icon,a=i.callToAction,s=e.widgetsType.getNotification();s.attr("data-spot",t.spot),s.attr("data-widget",t.name),s.find(".concierge-notification-title").html(n||""),s.find(".con-notification-body").html(r||"");var c=s.find(".con-notification-calltoaction");a&&a.length?(c.show(),c.html(a||""),c.attr("tabindex","0")):(c.hide(),c.attr("tabindex","-1"));var u=s.find(".con-notification-icon"),l="";if(o){u.show();var d=e.concierge.scriptLocation+"";z(d,"/")||(d+="/"),l='<img alt="" tabindex="-1" src="'+(o=(o=o.replace(/\/SCRIPT_LOCATION\//g,d)).replace(/^http:/,""))+'" role="presentation">'}else u.hide();u.html(l)}(this,e),this.widgetsType.displayNotification(e,e.engagementId),this.setNotificationType(e.notificationType);var t,i,n=zr(e.name);Ji("notification",{engagementId:e.engagementId,notificationType:eo(e.notificationType),widgetName:n,status:"displayed",rule:e.parameters.rule}),1===e.notificationType&&(t=this.concierge,i=Date.now(),t.cacheManager.setClientCache("lastNotified",i),Ji("proactiveOffer",{widgetName:n,status:"displayed",rule:e.parameters.rule}),this.concierge.currentOfferCreatedAt=Date.now(),Ti(this.concierge,n,e.parameters.rule))},ra.prototype.notificationDisplayed=function(){return pr(this.wmState)},ra.prototype.broadcastCloseProactiveNotification=function(e,t){var i=e.parameters;Ji("proactiveOffer",{widgetName:i.widget,status:t,rule:i.rule}),"accepted"===t?ki(this.concierge,i.widget,i.rule):"declined"===t&&xi(this.concierge,i.widget,i.rule)},ra.prototype.postMessageToWidget=function(e,t,i){var n,r,o=this.engagementWidgets.widgets[e],a=this.concierge.cacheManager.getWidgetCache(e,"active_session");"willClose"!==t&&"willTerminate"!==t||Rr(this.wmState,o),a&&o.remoteURL&&i?(r=Gr(e)&&"object"==typeof o.remoteURL?o.remoteURL[o.portalId]:o.remoteURL,n=r.match(/^https?:\/\/[^/]+/)[0]):n="*";var s=this.widgetAreaIFrameForWidget(e);if(s.length){var c=s[0].contentWindow,u={widget:e,type:t,parameters:i},l=function(){c.postMessage(lo(u),n),q.log(u.type+" message posted to : "+n)},d=s.data("loadPromise");return d?d.then(l):Ui(l)}return L.resolve()},ra.prototype.callWidgetFunction=function(e,t,i){var n,r,o=this.engagementWidgets.widgets[e];o.remoteURL?(r=Gr(e)&&"object"==typeof o.remoteURL?o.remoteURL[o.portalId]:o.remoteURL,n=r.match(/^https?:\/\/[^/]+/)[0]):n="*";var a=this.widgetAreaIFrameForWidget(e),s=a[0].contentWindow,c={widget:e,type:"functionCall",parameters:{functionName:t,functionData:i}},u=function(){s.postMessage(lo(c),n),q.log(c.type+" message posted to : "+n)};return a.data("loaded")?L.resolve(u()):(a.data("loadPromise")||L.resolve()).then(u)},ra.prototype.writeSrcToIframe=function(e){var t=this.widgetAreaIFrameForWidget(e);if(t.length>0){var i=this.concierge.scriptLocation+"/widgets/"+e+"/"+this.concierge.assetVersion.widgets+"/index.html";t.attr("src",i)}},ra.prototype.widgetAreaForWidget=function(e){return this.$concierge.find("#concierge-widget-"+e)},ra.prototype.widgetAreaIFrameForWidget=function(e){return this.widgetAreaForWidget(e).find("iframe")},ra.prototype.loadWidget=function(e){var t=e.name,i=e.parameters,n=e.engagementId;if(q.log('WidgetManager.loadWidget("'+t+'", "'+JSON.stringify(i)+'", '+n+'"): invoked.'),!this._disabled){var r=n;if(!e.state){"externalAPI"!==i.rule.source&&(e.widgetParameters=i);var o=ni("#concierge-widget-area");if(0===this.widgetAreaForWidget(t).length){var a={widget:e,widgetName:t,CLOSE_ICON:this.concierge.getTranslation("common","CLOSE_ICON"),FOOTER:this.concierge.getTranslation("common","FOOTER")},s="";this.engagementWidgets.globalSettings&&!this.engagementWidgets.globalSettings.hideMoxieBranding&&(s=fo('<div class="concierge-widget-footer concierge-drag-handle">\n  <span class="powered" aria-label="<%= FOOTER %> go moxie.com"><%=FOOTER%></span>\n  <svg draggable="false" focusable="false" version="1.1" id="black" xmlns="http://www.w3.org/2000/svg"\n    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 547.2 91"\n    enable-background="new 0 0 547.2 91" xml:space="preserve">\n    <g>\n      <path d="M87.4,27.7c-1.8-0.2-3.1-0.3-4.3-0.1c-0.9,0.2-2.9,0.1-4.3,3.1c-0.4,0.9,1,1.5,2.3,1.3s3.9-0.1,5.6,1.4\n              c2,1.7,2.6,8.8-3.5,13.7c-5.7,4.6-17.5,3.5-20.1-3.3c-2.5-6.4,0.5-11.2,2.6-13.1c2.4-2.1,5-3.9,10.6-4.3c0.6,0,2.1-1.3,2.7-3.6\n              c0.2-1-1.2-1.9-1.9-1.9c-4.7-0.1-7.4,0.4-11.6,2.2c-4.4,1.8-10.7,5.9-11.7,14.5c-2.3,2.9-5.7,5.9-9.4,8.9c0,0-0.4,0.3-0.5,0.2\n              c-0.2-0.1-0.1-0.5-0.1-0.5c0.1-4.4-0.1-7.8-0.1-8.7c-0.1-2.3-0.3-3.6-0.5-5.3c-0.1-0.5-0.1-1.7-1.3-2.7c-1.3-1-1.8-1-2.1-0.9\n              c-0.6,0.3-0.5,1.6-0.8,2.7c-0.2,0.7-0.7,2.2-1.1,3c-0.5,1.3-1.4,2.7-2.5,4.4c-3.7,5.5-18.2,14.4-24.1,11.8\n              c-5.5-2.4-1.6-9.3-0.2-11.8s11.5-13.2,26.7-13c1.4,0,7.6,1.3,8.3,1.5c1-0.2,1.8-0.9,1.3-2.3c-0.8-2.2-0.6-3-6.1-4.2\n              c-7.2-1.6-34.1,0.1-40.6,22.2c-1.4,4.8,0.8,9,2.8,10.9c3.4,3.3,9.7,4.1,15.4,2.5c6-1.7,11.5-5.1,16.6-10.1c0.2-0.2,0.5-0.5,0.7-0.7\n              c0.4-0.4,1.4-1,1.3,0.9c-0.1,1-0.2,2.1-0.4,3.1c-0.1,1-0.2,2-0.4,3c-1.9,1.4-3.8,2.7-5.6,4c-4.1,2.9-7.5,4.8-11,7.1\n              c-3.7,2.4-7.1,5.4-8.8,7c-3.3,3.1-6.1,7-5.9,12c0.3,5,2,8.7,11.8,8.6c10.7-0.1,19.2-8.8,23.6-21.8c1.5-4.6,2.3-10.2,2.7-15.4\n              c4.8-3.5,8.3-6.7,10.2-8.7c0,0,0.4-0.3,0.6-0.2s0.4,0.7,0.4,0.7c2.8,7.1,11,10.6,19.7,10c12-0.8,20.8-8.4,21.1-16.6\n              C95.4,38,95.5,28.7,87.4,27.7z M28.4,77.9c-3.1,4.1-7.1,7.6-10.9,7.6c-3.9,0-5.3-2.1-4.7-4.7c0.6-2.9,3-6.1,4.8-7.8\n              c1.2-1.1,3.2-2.8,4.5-3.9c3.2-2.6,7.5-5.9,12.6-9.4c0.4-0.3,0.9-0.3,0.8,0.8c-0.2,1.5-0.5,2.9-0.7,4.1C34.2,67.2,32,73.1,28.4,77.9\n              z" />\n      <path\n        d="M359.1,47.2c-3.7-1.2-5.9,0.9-6.6,2.6c-0.7,1.6-0.8,4.6,2.5,5.6c3.3,1.1,6,0.1,7.1-2.8C363.2,49.7,361.3,47.9,359.1,47.2z" />\n      <path d="M546.4,54.7c-0.2,0.2-2.5,0.8-3.4,0.9c-2.1,0.1-7.5-0.2-13.3-6c-5.8-5.8-9.8-19.8-15.4-27.2c-1.5-1.9-3-3.3-4.8-3.9\n              c-1.3-0.5-3.1-0.4-4.3-0.2c-3.7,0.6-5.6,2.5-10.1,8.6c-3.7,5-5.8,10.2-6.7,12.5c-1.3-10.7-3.8-17.1-9.7-15.1\n              c-3.6,1.2-8.7,9.6-10.3,13.3c0-1.3-0.1-3.3-0.2-6.1c-0.4-6.8-1.7-10.1-5.1-11.6c-4.6-2.1-10.7-1.8-19.1,2.1\n              c-4.5,2.1-8,3.8-10.3,5.6c-2.4,1.9-3.7,7-0.7,6c4.8-1.5,5.7,0.3,6.1,3.7c0.1,1.1,0.1,2.1-0.1,3.1c-0.7,4.8-7.1,9.8-14.2,9.1\n              c-7-0.7-11.1-3.7-11.3-10.5c-0.2-6.7,4.9-10.2,6.7-11.2c2.6-1.5,7.4-2.6,7.4-2.6c0.9-1,2.1-3.5-0.5-3.8\n              c-4.4-0.6-16.5,1.2-20.3,11.1c-1.4,3.8-1.4,7.6-0.3,11c-3.3,2.4-10.2,6.4-19.8,6.4c-10.1,0-13-5.2-12.8-13\n              c0.2-7.3,6.9-11.1,13.4-11.3c6.6-0.2,8.3,1.9,10.4,3.1c1.9,0.2,3.7-1.6,3.2-3.3c-0.5-1.5-1.7-5-12.8-5.4\n              c-13.9-0.4-23.1,8.1-23.1,19.9c0.1,11.5,11,16.1,20.5,16c10.7-0.1,18.9-4.8,23.1-8.2c3.2,4.8,8.9,8,16,8\n              c15.7-0.2,20.8-10,20.7-17.4c-0.1-3.4-0.6-5.7-1.3-7.2c-0.7-1.5,0.6-3.2,1.6-3.8c3.2-1.9,6.5-3.4,10.4-3.2\n              c5.9,0.3,6.2,15.1,5.6,22.8c-0.6,7.7,1.3,7.7,2.9,7.7c0.7,0,2.6-1.6,3.1-2.8c0.5-1.2,0.8-2.4,1-2.9c2.9-7.5,8.9-16.7,9.3-17\n              c0.4-0.2,2.9-1.5,3.5,3c0.5,3.3,1.4,14,3.6,15c0.1,0.1,1.1,0.5,1.7,0.5c1.3,0.1,2.6-0.4,3.1-0.9c0.6-0.7,2.3-6.2,5.3-11.8\n              c3-5.5,7.9-12.4,10.6-12.7c2.9-0.4,5.4,6.9,9.1,15.2c2.3,5.1,4.9,10.7,8.7,14.6c3.5,3.6,7.7,5,12.3,5.2c6.1,0.2,10-1.8,11.1-3.2\n              C547.7,55.7,546.9,54.3,546.4,54.7z" />\n      <path d="M177.5,58.2c-0.3-0.1-0.8-0.1-1.1-0.1c-3.6,0-4.3-2.9-4.8-4.9c-0.8-3.3-0.7-7.7-0.9-12.1c-0.1-6.1,0.4-31.6,0.4-34.3\n              c0-1.4-1.5-2.4-2.7-2.8c-2-0.7-5-1.2-6.6,0.5c-2.2,2.3-8.4,10.4-14,21.3c-4.8,9.3-7.9,17.2-8.9,19.3c-0.3,0.6-0.7,0.6-0.9,0.4\n              c-1.6-1.8-9.5-18.4-13.7-33.8c-1.9-6.9-1.6-10.1-3.4-11.2c-1.2-0.7-2.5-0.5-6.3-0.1c-0.3,0-0.5,0.1-0.7,0.2\n              c-1.3,0.3-2.5,0.7-3.4,1.3c-1.6,1.2-1.6,3.2-1.8,4.4c-0.2,1.2-4.2,20.2-5.8,32.3c-1.6,12.1-3.5,28-2.6,31.4\n              c0.5,2.1,2.5,3.6,4.5,3.9c2,0.4,3.5-0.2,4.2-0.5c0.2-0.1,0.5-0.2,0.6-0.9c0-0.7-0.3-0.5-0.6-3.4c-0.4-3.8,1.3-23.3,2.1-31.7\n              c0.9-8.3,3.3-19.1,4.3-22.6c2.3,7.8,10.8,27.6,19,39.5c0.3,0.5,1.1,0.8,1.9,1c5.9,1.3,6-0.8,7.5-5.2c1.5-4.4,10.7-23.4,13.4-28.3\n              c1.6-2.9,3.9-6.4,6.2-8.7c-0.6,6.2-1.4,26.5-1,34.8c0.3,9.2,0.7,13.1,7,14.4c1.4,0.3,4.3,0.1,6.7-1.2\n              C178.8,59.7,178.3,58.6,177.5,58.2z" />\n      <path\n        d="M277,18c3.4-0.3,5.5-2.3,5.4-5.3c-0.1-3-2.6-3.9-4.9-3.7c-3.8,0.3-5,3.1-5,4.9C272.6,15.7,273.6,18.4,277,18z" />\n      <path\n        d="M345.7,46c-2.5,0.4-6,4.8-16.5,6.3c-6.3,0.9-11.9,0-15.4-2.6c-4.8-3.4-6.6-9.4-5.3-11.2c0.3-0.5,1.1-0.4,2,0.1\n              c1.9,1,5.8,2.7,11.2,2.3c9-0.7,15.2-4.9,14.5-11.8c-0.6-6-6.2-9.1-14-9.1c-11.7,0-22.2,8.4-22.4,19.6c0,0.4,0,0.8,0,1.1\n              c-8.5,7.8-15.8,9.6-18.9,7.4c-3-2.1-0.5-13.4,0-16.9c0.5-3.4,0.6-5.6-1.2-7.4c-1.9-1.8-4.6-1.4-5.6-1.2c-1,0.2-0.9,2.4-1,3.5\n              c-0.1,1.1-0.6,3.2-1.1,12.2c-0.3,4.5-0.2,9.3,2,12.6c2.2,3.3,6.3,4.6,11.4,3.7c5.6-1,11.4-5,15.6-8.4c3.2,8.1,12.6,12.1,22.8,12\n              c12.2-0.1,20-4.9,21.8-6.4c0.5-0.4,1.4-2.3,1.6-3.3C347.1,47.3,346.9,45.8,345.7,46z M311.1,30.5c1.4-2.5,4.6-4.4,7.4-4.9\n              c5-0.9,9.4,0.6,9.8,4.3c0.6,4.7-5.8,7.4-12.8,5.6c-1.1-0.3-2.5-0.8-3.5-1.5C310.7,32.8,310.8,31.2,311.1,30.5z" />\n      <path d="M269.5,58.3c-4.8,0.3-8.9-3.7-11.4-6.5c-1.3-1.5-6.5-7.5-8.7-10.9c-0.2-0.2-0.1-0.4,0.2-0.7c10.5-8.3,11.8-8.8,15.5-12.7\n              c4.2-4.5,2.9-7.1-0.6-9.2c-0.7-0.4-1.9-0.2-1.9,0.6c-0.2,3.1-4.4,6.9-14.2,15.3c-1.2,1-3.3,0.7-3.8,0c-0.3-0.4-0.8-1.2-1.2-1.8\n              c-4-6.3-7.3-8.3-9.4-8.8c-3.2-0.8-7.3-1.2-13.3,0.1c-6,1.3-12.8,2.5-13.7,3c-0.9,0.5-2.5,2.3-2.3,3.1c0.2,1,1.5,1,2.5,0.8\n              c1.3-0.1,3-0.2,4.4,1.3c2,2.1,4.1,8.1-2.4,13.7c-6.5,5.6-19.2,5.6-21.4-3c-1.9-7.5,3.1-12.2,5.7-13.8c1-0.6,2-1.1,3.1-1.6\n              c0.6-0.2,1.2-0.5,1.8-0.6c0.7-0.2,2-0.5,2.7-0.8c0.5-0.2,2.2-3,2.1-3.5c-0.1-0.4-0.3-0.8-0.7-1.1c-0.6-0.6-2.6-0.9-7.5,0.3\n              C190,22.9,179,27,178.3,39.1c-0.7,11,9.1,17.3,20.7,16.3c12.5-1.1,20-8,20.3-17c0-1.1,0-2.6-0.2-4.1c-0.3-2-0.6-3.9,0.2-4.6\n              c1.6-1.4,5.3-1.7,5.8-1.8c5.8-0.8,9.3,5.8,11.8,9c0.7,0.8,2,2.6,2.8,3.7c0.2,0.3-0.1,0.7-0.7,1.3c-9.6,8.2-13.3,11.8-15.1,14\n              c-1.9,2.4-4.8,6.9-2.1,9.6c1.4,1.4,3.7,1.5,4.2,0.4c1.2-2.7,4-9,15.4-19.1c0.8-0.7,2.1-1,2.5-0.7c3.1,4.2,6.6,8.6,9.3,11.6\n              c5.6,6.1,13.9,5,17.8,3C272.8,59.8,272.3,58.2,269.5,58.3z" />\n      <path d="M532.8,21.4h-2v-1.3h5.5v1.3h-2V27h-1.6V21.4z M543.1,20.1l-1.8,3.8l-1.8-3.8h-2.1v7h1.6v-4.4l1.9,3.8h0.9l1.9-3.8V27h1.6\n              v-7H543.1z" />\n    </g>\n  </svg>\n</div>')(a)),a.moxieBranding=s;var c=fo('<div class="concierge-widget" id="concierge-widget-<%= widgetName %>" data-widget="<%= widgetName %>">\n  <header class="concierge-widget-header concierge-drag-handle">\n    <div class="con-widget-title-section">\n      <div class="con-widget-icon"></div>\n      <h2 class="con-widget-title" tabindex="0"><%= widget.title %></h2>\n    </div>\n    <div class="con-close-area">\n      <button type="button" class="con-close-widget" aria-label="<%= CLOSE_ICON %>">\n        <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20" stroke-width="0">\n          <title><%= CLOSE_ICON %></title>\n          <polygon points="17.3,1.1 10.2,8.3 3.1,1.1 1.3,2.9 8.4,10 1.3,17.1 3.1,18.9 10.2,11.8 17.3,18.9 19.1,17.1 11.9,10 19.1,2.9 "/>\n        </svg>\n      </button>\n    </div>\n  </header>\n\n  <div id="concierge-iframe-cover" class="widget-content"></div>\n  <iframe allow="geolocation" frameborder="no" class="widget-content" aria-live="polite" aria-atomic="true"></iframe>\n  <%= moxieBranding %>\n</div>\n')(a);c=c.replace(/\/SCRIPT_LOCATION\//g,this.concierge.scriptLocation+"/"),o.append(c)}void 0===n&&(n=this.createEngagementRecord(e),r=n),e.state=2,e.proactive=i&&i.proactive||!1,q.log("WidgetManager.loadWidget("+t+"): set widget.proactive="+e.proactive),e.beforeLoad();var u=this,l=this.concierge.cacheManager.getWidgetCache(t,"active_session");if(l||e.shouldReplaceIframeSrc){var d=this.widgetAreaIFrameForWidget(t),g=e.getRemoteURL();q.log("WidgetManager.loadWidget("+t+"): requests iframe src="+g,"hasActive:",l,"shouldReplace:",e.shouldReplaceIframeSrc),d.data("loadPromise",n=new L((function(e){d.attr("src",g),d.on("load",(function(){d.data("loaded")||(d.data("loaded",!0),e(r))}))})))}else void 0!==e.prepareToLoadPromise?e.prepareToLoadPromise.then((function(){u.writeSrcToIframe(t)})):this.writeSrcToIframe(t);this.updateWidgetTitle(t,{text:e.titleBar&&e.titleBar.text?"title":"",graphic:e.titleBar&&e.titleBar.graphic?e.titleBar.graphic:null})}var h=this.concierge.getTranslation(t,"title","Concierge");return this.widgetAreaIFrameForWidget(t).attr("title",h),n}},ra.prototype.replaceWidget=function(e){var t=this,i={status:!0,ref:e,parameters:e.parameters,ruleSettings:this.concierge.rulesEngine.getSiteSettings(),engagementId:e.engagementId};return e.beforeAdd(i).then((function(i){return i&&i.status&&br(t.wmState,e,!0),i}))},ra.prototype.getSeenChannelsHosts=function(){return this.seenChannelsHosts||(this.seenChannelsHosts=this.concierge.cacheManager.getClientCache("channelsHosts")||[]),this.seenChannelsHosts},ra.prototype.registerChatHost=function(e){var t=this.getSeenChannelsHosts();G(t,e)<0&&(t.push(e),this.seenChannelsHosts=t,this.concierge.cacheManager.setClientCache("channelsHosts",t,!1))},ra.prototype.showWidget=function(e){var t=e.name,i=e.parameters,n=e.engagementId,r=this.wmState;q.log("WidgetManager.showWidget("+t+", "+JSON.stringify(e.parameters)+", "+n+"): invoked.");var o=L.resolve();if(e){var a=this,s=ni("#concierge-widget-area");Gr(t)&&i.host&&this.registerChatHost(i.host),o=o.then((function(){return e.spot&&Xr(r,e)?a.replaceWidget(e):"function"==typeof e.shouldRebuildIframe&&e.shouldRebuildIframe()?(a.widgetAreaIFrameForWidget(t).replaceWith('<iframe frameborder="no" class="widget-content" allow="geolocation"></iframe>'),Ui((function(){a.writeSrcToIframe(t)})).then((function(){return a.concierge.cacheManager.removeWidgetCache(t,"rebuildIframe",!1)}))):void 0})).then((function(){e.proactive=i&&i.proactive||!1,q.log("WidgetManager.showWidget("+e.label()+"): set widget.proactive="+e.proactive)})).then((function(){return e.state?L.resolve(a.postMessageToWidget(t,"willShow",i)).then((function(){return a.concierge.cacheManager.getWidgetCache(t,"engagement_id",!0)})):a.loadWidget(e)})).then((function(i){return i&&null!==a.getEngagementRecord(i)||(i=a.createEngagementRecord(e)),e.engagementId=n=i,a.concierge.cacheManager.setWidgetCache(t,"engagement_id",n,!0)})).then((function(){var e,i=a.getEngagementRecord(n);if(Gr(t)){if(null===i)q.log('WidgetManager.showWidget("'+n+'"): was null.');else if(i.proactive&&void 0===i.chat.time_to_decide){var r=new Date(i.time).getTime();i.chat.time_to_decide=Math.round(((new Date).getTime()-r)/1e3),i.chat.missed_reason=0,i.decision_type="Accepted",e=a.setEngagementRecord(n,i)}}else null!==i&&i.proactive&&(i.decision_type="Accepted",e=a.setEngagementRecord(n,i));return e||(e=L.resolve()),e.then((function(){return a.concierge.contextMonitor.recordEngagementValue()}))})).then((function(){if(a.notificationDisplayed())return q.log("WidgetManager.showWidget("+e.label()+"): ignoring the notification"),Tr(r)})).then((function(){return s.addClass("con-open"),a.$concierge.addClass("con-open-widget"),r.open=e,Cr(a.wmState,e.spot),a.openWidget!==t?(a.widgetsType.openWidget(e),Ji("widgetOpened",{widgetName:t,source:i.rule.source}),a.openWidget=t):a.widgetsType.makeWidgetActive(a.widgetAreaForWidget(t)),null}))}return o},ra.prototype.forceBlur=function(){if(this.needsForceBlur){ni("#concierge").append('<input type="text" id="fakefocus" style="width:1px; height:1px" />');var e=ni("#fakefocus");e.focus(),e.blur(),e.remove(),this.needsForceBlur=!1}},ra.prototype.hideWidget=function(e){var t=this,i=t.postMessageToWidget(t.openWidget,"willHide");return e||(i=i.then((function(){return Zr(t,!1)}))),i},ra.prototype.closeWidget=function(e){var t=this,i=t.postMessageToWidget(t.openWidget,"willClose"),n=this.wmState.open;return e||t.concierge.cacheManager.getWidgetCache(t.openWidget,"willHandleClose",!0)||(i=i.then((function(){return Zr(t,!0)})).then((function(){n&&n.closeWidget()}))),i},ra.prototype.fixPosition=function(e){this.widgetsType.fixPosition&&this.widgetsType.fixPosition(e,this.$concierge)},ra.prototype.expandConcierge=function(){q.log("WidgetManager.expandConcierge(): invoked.")},ra.prototype.collapseConcierge=function(){q.log("WidgetManager.collapseConcierge(): invoked.")},ra.prototype.preloadCSS=function(){return oa(this),function(e){var t="concierge-style-"+e.widgetsType.cssType;return 0===ni("#"+t).length?new L((function(i){var n=e.concierge.scriptLocation+"/widgets/"+e.concierge.assetVersion.widgets+"/"+e.widgetsType.cssType+".css",r=document.getElementsByTagName("head")[0],o=document.createElement("link");o.onload=function(){i(!0)},o.id=t,o.rel="stylesheet",o.type="text/css",o.href=n,o.media="all",r.appendChild(o)})):L.resolve(!0)}(this)},ra.prototype.init=function(){q.log("WidgetManager.init(): invoked."),this.$concierge=ni("#concierge"),0===this.$concierge.length&&ca(this)},ra.prototype.showConcierge=function(){q.log("WidgetManager.showConcierge(): invoked."),ni("#concierge-widgets ul li").length>0&&ni("#concierge").show()},ra.prototype.hideConcierge=function(){q.log("WidgetManager.hideConcierge(): invoked."),ni("#concierge").hide()},ra.prototype.getWidgetPath=function(e){return this.concierge.widgetPath+e+"/"},ra.prototype.setServiceLineId=function(e,t){var i=this;if(t&&t.parameters){var n=t.name,r=t.parameters;r.serviceLineId!==e.serviceLineId&&(r.serviceLineId=e.serviceLineId,this.concierge.serviceLines.getName(e.serviceLineId).then((function(n){return r.serviceLine=n,r.serviceLineId=e.serviceLineId,r.parameters&&r.parameters.queue&&(r.parameters.queue=e.serviceLineId),Wr(i.wmState,t),null})).catch((function(t){q.log('setServiceLineId("'+n+'", '+JSON.stringify(e)+"): ERROR: "+t)})))}},ra.prototype.loadActiveWidgets=function(){var e=this,t=e.wmState.wm.concierge.cacheManager.getClientCache("activeWidgets")||[],i=null,n=[];e.loadingActiveWidgets=!0;for(var r=0;r<t.length;r++)t[r].loadParams&&(i=this.concierge.cacheManager.getWidgetCache(t[r].widgetName,"engagement_id",!0),n.push(this.addWidget(t[r].loadParams,t[r].loadParams.rule,i).then((function(t){if(t&&t.status)return Wr(e.wmState,t.ref).then((function(i){return Cr(e.wmState,t.ref.spot),i}))}))));return L.all(n).finally((function(){delete e.loadingActiveWidgets}))},ra.prototype.notify=function(e,t){q.log("WidgetManager.notify called with:",e,t);var i=e.widget,n=this.createWidget(i);return e.rule=t||{},e.proactive=!0,n.parameters=e,Sr(this.wmState,n)},ra.prototype.terminateWidget=function(e,t){void 0===t&&(t=!1);var i=this,n=e.name;if(!Gr(n))return L.resolve(!0);if(!Mr(i.wmState,e)||!function(e,t){return t&&0!==t.state}(i.wmState,e))return L.resolve(!0);var r=new L((function(e,r){var o=null;t&&(o=setTimeout((function(){r("willTerminate not answered with widgetTerminated in timely manner")}),1e3)),i[n+"HandleBroadcast"]=function(t,r){return t===n&&"widgetTerminated"===r&&(null!==o&&clearTimeout(o),delete i[n+"HandleBroadcast"],e(!0),!0)}}));return i.postMessageToWidget(n,"willTerminate").then((function(){return r}))},ra.prototype.disable=function(){this._disabled=!0},ra.prototype.enable=function(){this._disabled&&delete this._disabled},ra.prototype.clearHistory=function(){for(var e=this,t={},i=this.getSeenChannelsHosts(),n=0;n!==i.length;n++)t[i[n]]=!0;var r=L.resolve(!0);e.disable();for(var o=function(t){return function(){return e.removeWidget(t)}},a=function(e){return function(){var t=document.createElement("iframe");t.setAttribute("id","concierge.clear.history"),t.setAttribute("tabindex","-1"),t.style.display="none",t.style.height="400px",t.style.width="300px";var i,n=e+"/netagent/ClearChatSession.aspx";return t.setAttribute("src",n),new L((function(n){var r=function(e){"SessionCleared"===e.data&&(window.removeEventListener("message",r,!1),e.fromTimeout?n(!1):n(!0))};window.addEventListener("message",r,!1),document.body.appendChild(t),i=window.setTimeout((function(){q.log("WidgetManager.clearHistory("+e+'): timeout waiting for "SessionCleared" event. Proceeding with clearHistory process.'),r({data:"SessionCleared",fromTimeout:!0})}),1e3)})).then((function(e){e&&i&&clearTimeout(i),t.remove?t.remove():null!==t.parentNode&&t.parentNode.removeChild(t)}))}},s=Object.keys(e.wmState.spots),c=[],u=0;u<s.length;u+=1){var l=lr(e.wmState,s[u]);if(l&&l.widget){var d=s[u];l.widget.parameters&&l.widget.parameters.host&&(t[l.widget.parameters.host]=!0),c.push(e.terminateWidget(l.widget,!0).catch((function(e){q.error("Could not terminate widget in spot "+d+": "+e)})).then(o(l.widget)))}}r=r.then(L.all(c)),c=[];for(var g=Object.keys(t),h=0;h<g.length;h+=1)c.push(a(g[h])());return r=r.then(L.all(c))},ra.prototype.destroy=function(){if(sa(this),this.draggableWidgetArea&&(this.draggableWidgetArea.destroy(),delete this.draggableWidgetArea,this.removeDraggableData()),this.wmState){for(var e in this.removeWidget(this.wmState.notification),this.wmState.spots){var t=lr(this.wmState,e);this.removeWidget(t.reactive),this.removeWidget(t.widget)}for(var i=ge(this.wmState.alive),n=0;n<i.length;n++)this.removeWidget(i[n])}ni("#concierge-widget-area .concierge-widget iframe").remove(),ni("#concierge-widget-area .concierge-widget").remove(),this.widgetsType.destroy&&this.widgetsType.destroy()},ra.prototype.isValidEngagementConfig=function(e){var t;if(void 0===e||!e.widget||!this.KNOWN_WIDGETS[e.widget])return!1;for(t=0;t<this.KNOWN_WIDGETS[e.widget].requires.length;t++)if(void 0===e[this.KNOWN_WIDGETS[e.widget].requires[t]])return!1;return!0};var ua=function(e){var t,i=e.Symbol;return"function"==typeof i?i.observable?t=i.observable:(t=i("observable"),i.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),la=function(){return Math.random().toString(36).substring(7).split("").join(".")},da={INIT:"@@redux/INIT"+la(),REPLACE:"@@redux/REPLACE"+la(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+la()}};function ga(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function ha(e,t,i){var n;if("function"==typeof t&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===i&&(i=t,t=void 0),void 0!==i){if("function"!=typeof i)throw new Error("Expected the enhancer to be a function.");return i(ha)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var r=e,o=t,a=[],s=a,c=!1;function u(){s===a&&(s=a.slice())}function l(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return o}function d(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return u(),s.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,u();var i=s.indexOf(e);s.splice(i,1),a=null}}}function g(e){if(!ga(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,o=r(o,e)}finally{c=!1}for(var t=a=s,i=0;i<t.length;i++){(0,t[i])()}return e}function h(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");r=e,g({type:da.REPLACE})}function f(){var e,t=d;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function i(){e.next&&e.next(l())}return i(),{unsubscribe:t(i)}}})[ua]=function(){return this},e}return g({type:da.INIT}),(n={dispatch:g,subscribe:d,getState:l,replaceReducer:h})[ua]=f,n}function fa(e,t){var i=t&&t.type;return"Given "+(i&&'action "'+String(i)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function pa(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function va(e,t){var i=Object.keys(e);return Object.getOwnPropertySymbols&&i.push.apply(i,Object.getOwnPropertySymbols(e)),t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i}function ma(e){for(var t=arguments,i=1;i<arguments.length;i++){var n=null!=t[i]?t[i]:{};i%2?va(n,!0).forEach((function(t){pa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wa(){for(var e=arguments,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=e[n];return 0===i.length?function(e){return e}:1===i.length?i[0]:i.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function ya(e){return function(t){var i=t.dispatch,n=t.getState;return function(t){return function(r){return"function"==typeof r?r(i,n,e):t(r)}}}}var ba=ya();ba.withExtraArgument=ya;var Sa=function(e,t){return function(e){for(var t=Object.keys(e),i=t.length,n=new Array(i);i--;)n[i]=[t[i],e[t[i]]];return n}(t).filter((function(t){var i=t[0];t[1];return i!==e})).reduce((function(e,t){var i,n=t[0],r=t[1];return It(e,((i={})[n]=r,i))}),{})},Ca="function"==typeof CustomEvent?function(e,t){return new CustomEvent(e,{detail:t})}:function(e,t){var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,!1,!1,t),i},_a=function(e,t,i){var n=Ca("GoMoxie:"+e,t);return n.version=i,n},Ea=["u","w","W","p","q","V","v","$"],Ia={events:[],eventsCount:0,sending:[],batchTimerState:"INITIALIZED",lastServerCallOK:!0,priorityEventAdded:!1,prevState:{},terminating:!1,failureStreak:0};var Na=function(e){for(var t=Object.keys(e),i={},n=0;n<t.length;n++){var r=t[n];"function"==typeof e[r]&&(i[r]=e[r])}var o,a=Object.keys(i);try{!function(e){Object.keys(e).forEach((function(t){var i=e[t];if(void 0===i(void 0,{type:da.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===i(void 0,{type:da.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+da.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(i)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var n=!1,r={},s=0;s<a.length;s++){var c=a[s],u=i[c],l=e[c],d=u(l,t);if(void 0===d){var g=fa(c,t);throw new Error(g)}r[c]=d,n=n||d!==l}return(n=n||a.length!==Object.keys(e).length)?r:e}}({schemaVersion:function(e,t){return void 0===e&&(e=1),e},eventService:function(e,t){void 0===e&&(e=Ia);var i=Sa("prevState",e),n=JSON.parse(JSON.stringify(i));if(!e.terminating)switch(t.type){case"ADD_EVENT":return It(i,{prevState:n},{events:e.events.concat([Sa("type",t)]),eventsCount:e.eventsCount+1});case"ADD_PRIORITY_EVENT":return It(i,{prevState:n},{events:e.events.concat([Sa("type",t)]),eventsCount:e.eventsCount+1,priorityEventAdded:!0})}switch(t.type){case"SEND_EVENTS":return It(i,{prevState:n},{events:[],eventsCount:0,sending:e.events});case"SEND_PRIORITY_EVENTS":return It(i,{prevState:n},{events:[],eventsCount:0,sending:e.events,priorityEventAdded:!1});case"CLEAR_SENT":return It(i,{prevState:n},{sending:[],lastServerCallOK:!0,failureStreak:0});case"RETRY_SENT":return It(i,{prevState:n},{events:e.sending.concat(e.events),eventsCount:e.eventsCount+e.sending.length,sending:[],lastServerCallOK:!1,failureStreak:e.failureStreak+1});case"SET_TIMER_STATE":return It(i,{prevState:n},{batchTimerState:t.value||!1});case"TERMINATING":return It(i,{prevState:n},{terminating:!0})}return e}});function Oa(e,t,i){var n=3e4;return i>0&&(n+=1333*Math.pow(i,2),n=Math.min(3e5,n)),new L((function(i,r){var o=new XMLHttpRequest;o.open("POST",t.serverEndpoint),o.timeout=n,o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Accept","application/json"),o.onload=function(e){return i({status:o.status,body:o.response})},o.onerror=function(e){return i({status:o.status,message:"Could not read error response, probably because CORS headers are missing."})},o.send(JSON.stringify(function(e){for(var t={e:[]},i={},n=JSON.parse(JSON.stringify(e)),r=0;r<Ea.length;r++){var o=Ea[r],a=Ta(n.map((function(e){return e.payload[o]})));if(1===a.length&&void 0!==a[0]){i[o]=a[0];for(var s=0;s<n.length;s++){delete n[s].payload[o]}}}return(t=It(i,t)).e=n.map((function(e){return e.payload})),t.d=Date.now(),t}(e)))})).catch((function(e){return console.error("Concierge encountered a fatal error when trying to send events:",e),{status:-1,message:e.message}}))}function Ta(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];-1===ka(t,n)&&t.push(n)}return t}function ka(e,t,i){var n=isFinite(i)?Math.floor(i):0,r=e instanceof Object?e:new Object(e),o=isFinite(r.length)?Math.floor(r.length):0;if(n>=o)return-1;if(n<0&&(n=Math.max(o+n,0)),void 0===t){do{if(n in r&&void 0===r[n])return n}while(++n<o)}else do{if(r[n]===t)return n}while(++n<o);return-1}var xa=function(e,t){if("SEND_PRIORITY_EVENTS"===e){var i=new _a("PriorityEvents",{status:t});window.dispatchEvent(i)}},Da=function(e,t){return function(i,n){if(n().eventService.events.length>0){i({type:e});var r=n().eventService.failureStreak;Oa(n().eventService.sending,t,r).then((function(t){t&&!n().eventService.terminating&&(t.status>=200&&t.status<300||t.status>=400&&t.status<500?(xa(e,!0),i(Aa())):r>=8640?(xa(e,!1),i(Aa())):(xa(e,!1),i({type:"RETRY_SENT"})))}))}}};function Ma(e){return Da("SEND_EVENTS",e)}function Aa(){return{type:"CLEAR_SENT"}}var La=function(e,t){void 0===t&&(t=function(e){return e}),this.timeout_in_ms=e,this.stateChangeCallbackFn=t,this.timerState="INITIALIZED"};La.prototype.timerInternalState=function(){return this.timerState},La.prototype.startTimer=function(e){var t=this;void 0===e&&(e=this.timeout_in_ms);this.timer=setTimeout((function(){t.timerState="EXPIRED",t.stateChangeCallbackFn("EXPIRED")}),e),this.timerState="RUNNING",this.stateChangeCallbackFn("RUNNING")},La.prototype.cancelTimer=function(){clearTimeout(this.timer),this.timerState="CANCELLED",this.stateChangeCallbackFn("CANCELLED")};var Wa=[function(e){var t={schemaVersion:1,eventService:It({},e.eventService,{terminating:!1})};return It({},e,t)}],Ra=function(){try{var e=localStorage.getItem("moxieState");if(null===e)return;return function(e,t){void 0===t&&(t=Wa);var i=e.schemaVersion||0,n=t.length;i<n&&t.slice(i,n).forEach((function(t){return e=t(e)}));return e}(JSON.parse(e))}catch(e){return}};function Pa(e,t,i){e.subscribe((function(){var n=e.getState().eventService.prevState.eventsCount,r=e.getState().eventService.eventsCount;if(n!==r){var o=e.getState().eventService.prevState.lastServerCallOK,a=e.getState().eventService.lastServerCallOK,s=e.getState().eventService.priorityEventAdded,c=0===e.getState().eventService.sending.length;c&&s?(t.cancelTimer(),e.dispatch(function(e){return Da("SEND_PRIORITY_EVENTS",e)}(i))):c&&a&&r>=5?(t.cancelTimer(),e.dispatch(Ma(i))):0===n&&r>=1?(t.cancelTimer(),a?t.startTimer():t.startTimer(1e4)):!0===o&&!1===a&&(t.cancelTimer(),t.startTimer(1e4))}})),e.subscribe((function(){var t=e.getState().eventService.prevState.batchTimerState,n=e.getState().eventService.batchTimerState;t!==n&&"EXPIRED"===n&&e.dispatch(Ma(i))})),e.subscribe((function(){var t=e.getState().eventService.prevState.eventsCount,i=e.getState().eventService.eventsCount,n=e.getState().eventService.prevState.sending,r=e.getState().eventService.sending,o=e.getState().eventService.terminating;(t!==i||n!==r)&&!o&&function(e){try{var t=JSON.stringify(e);localStorage.setItem("moxieState",t)}catch(e){return}}(e.getState())}))}var ja=function(e){if(this.store=null,this.batchTimer=null,this.config=e,this.startEventService(),void 0===this.config.serverEndpoint)throw"serverEndpoint config value is required for the EventService"};function Va(e){this.scriptElement=e,this.engagementWidgetsVersion=null,this.engagementRulesVersion=null}ja.prototype.notifyEventService=function(e){this.store.dispatch({type:"ADD_EVENT",payload:e})},ja.prototype.notifyEventServiceImmediately=function(e){this.store.dispatch({type:"ADD_PRIORITY_EVENT",payload:e})},ja.prototype.startEventService=function(){var e=Ra();null!=e&&null!==e.eventService&&void 0!==e.eventService&&(e.eventService.failureStreak=0),this.store=ha(Na,e,function(){for(var e=arguments,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=e[n];return function(e){return function(){var t=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},r={getState:t.getState,dispatch:function(){return n.apply(void 0,arguments)}},o=i.map((function(e){return e(r)}));return ma({},t,{dispatch:n=wa.apply(void 0,o)(t.dispatch)})}}}(ba));var t,i=(t=this.store,function(e){t.dispatch({type:"SET_TIMER_STATE",value:e})});this.batchTimer=new La(5e3,i),Pa(this.store,this.batchTimer,this.config),this.store.dispatch({type:"CLEAR_SENT"}),this.batchTimer.startTimer()},ja.prototype.stopEventService=function(){this.store.dispatch({type:"TERMINATING"}),this.batchTimer.cancelTimer(),this.store.dispatch({type:"CLEAR_SENT"}),this.store.dispatch(Ma(this.config)),function(){try{localStorage.removeItem("moxieState")}catch(e){return}}()},Va.prototype.logError=function(e,t){var i=e+": ";t.stack?i+=t.stack:t.message?i+=t.message:i+=t.toString(),q.error(i)},Va.prototype.getTranslation=function(e,t,i){return this.localization.translate(e+".client."+t,i)},Va.prototype.registerNamespace=function(){return window.GoMoxie=window.GoMoxie||{},window.GoMoxie.concierge={},window.GoMoxie.console=q,this.isTestMode||q.suppressLogs(),window.GoMoxie};function Fa(){return function(){var e,t=["JxBrowser","MoxieAgentClient","JavaFX"];for(e=0;e!==t.length;e++)if(-1!==window.navigator.userAgent.indexOf(t[e]))return!1;var i=!1,n=bn(window.navigator);if(-1!==G(["chrome","firefox","safari","msie","android"],n[0]))if("msie"===n[0]){if(-1!==window.navigator.userAgent.toLowerCase().indexOf("iemobile"))return!1;i=parseInt(n[1])>=11}else i="android"!==n[0]||parseFloat(n[1])>=5;else i=!1;return i}()}function qa(){var e="Concierge failed to load: ";if(!Fa())throw Ji("conciergeFailedToLoad",e+="unsupported browser"),new Error(e);if(!function(){var e=!1;try{e=void 0!==window.localStorage.getItem("MoxieUndefinedKey")}catch(e){q.error(e)}return e}())throw Ji("conciergeFailedToLoad",e+="localStorage required"),new Error(e);return!0}Va.prototype.prepare=function(e,t,i){i=i||{},ni("#concierge").remove(),this.url=e,this.pageTitle=t,this.scriptLocation=this.scriptElement.getScriptLocation(),this.isTestMode=this.scriptElement.getTestMode(),this.logDisabled=this.scriptElement.getLogFlag(),this.clientName=this.scriptElement.getClientName(),this.positionMethod=this.scriptElement.getDisplayConfiguration().positionMethod,this.conciergeHost=this.scriptElement.getConciergeHost(),this.separator=this.scriptElement.getConciergeSeparator(),this.protocol=0===this.scriptLocation.indexOf("https:")?"https:":"http:",this.currentOfferCreatedAt=null,this.gomoxie=this.registerNamespace(),this.loadState="LOADING",this.serviceUrl={connector:this.protocol+"//connector"+this.separator+this.clientName+"."+this.conciergeHost,location:this.protocol+"//location."+this.conciergeHost,events:this.protocol+"//events"+this.separator+this.clientName+"."+this.conciergeHost+"/1.1/events"},this.assetVersion={rules:"",widgets:""},this.onQuestionnaireLoadedCallbacks=new zn,this.onQuestionnaireSubmitCallbacks=new zn,this.httpGet=this.httpGet||(new oi).get,this.httpGetXMLHttpRequest=this.httpGetXMLHttpRequest||(new oi).getXMLHttpRequest,this.localization=i.localization||new Bn(this),this.rulesEngine=i.rulesEngine||new er(this),this.eventService=i.eventService||new ja({serverEndpoint:this.serviceUrl.events}),this.publicAPI=i.publicAPI||new uo,this.publicAPI.registerMethods(this,this.gomoxie),this.publicApiV2=i.publicApiV2||new co(this,this.gomoxie),this.cacheManager=this.cacheManager||i.cacheManager||new Wn(this),this.widgetManager=i.widgetManager||new ra(this),this.contextMonitor=i.contextMonitor||new Un(this),this.serviceLines=i.serviceLines||new Kn(this)},Va.prototype.prepareAndInit=function(e,t,i){return this.prepare(e,t,i),this.init()},Va.prototype.initAPI=function(){var e=this,t=e.scriptLocation+"/config/latest/1/web/configuration.json";return-1!==this.url.indexOf("MoxieTest=true")&&sessionStorage.setItem("MoxieConfigCacheBust","true"),"true"===sessionStorage.getItem("MoxieConfigCacheBust")&&(t+="?cacheBuster="+Date.now()),this.apiReady=L.all([this.httpGet(t).then((function(t){return e.configuration=t,e.assetVersion.widgets=t.widgets.version,e.localization.init(),e.widgetManager.preloadCSS()})),e.cacheManager.init()]).then((function(){return e.contextMonitor.initTracking()})).then((function(){return e.widgetManager.init(),e.rulesEngine.init(e.configuration),e.widgetManager.loadActiveWidgets()})).then((function(){return function(e,t){var i=new si(e,t,"1.0");try{window.dispatchEvent(i)}catch(t){q.log("PublicAPI.broadcastNow("+e+"): error: "+(t.stack?t.stack:t.message))}return i}("apiReady")})),this.apiReady},Va.prototype.init=function(){var e,t=this;return this.ready=this.initAPI().then((e=function(){return t.contextMonitor.start(),t.rulesEngine.run(),t.widgetManager.addEventListeners(t.widgetManager),t.widgetManager.showConcierge(),t.widgetManager.fixPosition(t.positionMethod),Pi(t),Ji("conciergeReady"),t.loadState="READY",!0},function(){return"LOADING"===t.loadState?e():null})),this.ready.catch((function(e){t.loadState="FAILED",t.logError("Concierge Unexpected Error",e),Ji("conciergeFailedToLoad")})),this.ready};var Ja=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Ha=/^(?:([^:/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?))?((((?:[^?#/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,$a=/^(?:(?![^:@]+:[^:@/]*@)([^:/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#/]*\.[^?#/.]+(?:[?#]|$)))*\/?)?([^?#/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ua=/(?:^|&)([^&=]*)=?([^&]*)/g;function Ba(e){qa(),this.element=e}Ba.getScriptElement=function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++)if(e[t].getAttribute("data-concierge")||e[t].getAttribute("concierge"))return new Ba(e[t]);return null},It(Ba.prototype,{getSourceUri:function(){return function(e,t){for(var i=t?Ha:$a.exec(e),n={queryKey:{}},r=14;r--;)n[Ja[r]]=i[r]||"";return n.query.replace(Ua,(function(e,t,i){t&&(n.queryKey[t]=i)})),n}(this.element.src,!1)},getTestMode:function(){var e=this.getSourceUri();return e.queryKey.testmode?"true"===e.queryKey.testmode:localStorage.getItem("Moxie_testmode")},getLogFlag:function(){var e=this.getSourceUri();return e.queryKey.log?"false"===e.queryKey.log:localStorage.getItem("Moxie_log")},getAttribute:function(e){return this.element.getAttribute(e)},getScriptLocation:function(){var e=this.getAttribute("data-concierge-script-location");if(e)return e;var t=this.getSourceUri(),i=[t.protocol,"://",t.host];80===t.port&&443===t.port||!t.port||i.push(":"+t.port);var n=t.path?t.path.split("/").slice(0,-2).join("/"):"";return i.push(n),i.join("")},getClientName:function(){return this.getAttribute("data-client")?this.getAttribute("data-client"):this.getScriptLocation().match(/([^/]+)$/).pop()},getConciergeHost:function(){return this.getAttribute("data-concierge-host")?this.getAttribute("data-concierge-host"):"gomoxie.solutions"},getConciergeSeparator:function(){var e="-",t=this.getSourceUri();return t.queryKey.separator&&(e=t.queryKey.separator),e},getDisplayConfiguration:function(){var e=this.getAttribute("data-display-config");return e&&(e=JSON.parse(e)),e&&"object"==typeof e?{positionMethod:e.positionMethod||"css"}:{positionMethod:"css"}}}),function(){var e;try{qa();var t=new Va(Ba.getScriptElement()),i=document.location.href,n=document.title;e=t.prepareAndInit(i,n)}catch(t){q.error(t),e=L.reject(t)}window.conciergeReady=window.conciergeReady||e}()}();
