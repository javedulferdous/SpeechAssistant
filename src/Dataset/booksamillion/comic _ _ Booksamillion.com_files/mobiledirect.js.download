window.mm=window.mm||{};
mm.settings={redirectMobile:!0,redirectTablet:!1,redirectPercentMobile:100,redirectPercentTablet:100,noMobileParam:"mobile=no",noMobileCookieDuration:30,noMobileCookieName:"mmNoRedirect",noMobileCookieValue:"true",mmReferrerCookieName:"mmReferrer",mobileRedirectCookieName:"mmMobileRedirect",mobileRedirectParam:"mmMobileRedirect",mobileRedirectCookieValue:"true",mobileRedirectCookieDuration:43200,userAgentInclusions:[],userAgentExclusions:[],onRedirect:function(){},domain:"https://m.booksamillion.com",routes:[{from:"/doctorwho /features?cat=doctorwho /holidaywishlist /bookclub /elfontheshelf /geekchic /gift4 /exchange-online-mall /nook /more /lonely_planet /membership /features?cat=cityofbones /cityofbones /beck joemuggs /help/order.html?id=6458939153009 /help/order.html summeradventure bammidnightmagic sweepstakes sweepstakes2 authorevents /educatorsweeps /businessservices?id=6761951667542 /businessservices/pub_auth.html /businessservices/business.html /businessservices/education.html /businessservices/expert_picks.html /help/offers.html /help/contact.html /educatorsweeps /BAMdecades /kawaii 100-years listapalooza literacy d-channel /features?cat=bookpage_current /giftguide /shippinginformation /features?cat=shippinginformation".split(" "),
to:!1},{from:/^\/?(\?.*)?$/,to:"/"},{from:/(http|https)?(:\/\/)?(www\.booksamillion\.com)?\/flash(.*)/g,to:!1},{from:/(http|https)?(:\/\/)?(www\.booksamillion\.com)?\/go\-set\-a\-watchman(.*)/g,to:!1},{from:/https:\/\/secure\.booksamillion\.com\/ncom\/order(.*)/g,to:!1},{from:["/help/terms.html?id=5529961662992","/help/contact.html"],to:"/contact"},{from:/.*/,to:function(a){return a.fullPath}}]};mm.controller={settings:{},init:function(a,b){var c=a.match(/(https?:\/\/)([^\/?#]+)([^?#]*)(\?[^#]*)?(#.*)?/)||[];this.settings={redirectMobile:!0,redirectTablet:!0,redirectPercentMobile:100,redirectPercentTablet:100,singlePageExcludeParam:"mmexclude=true",noMobileParam:"mobile=no",noMobileCookieDuration:30,noMobileCookieName:"mmNoRedirect",noMobileCookieValue:"true",mmReferrerCookieName:"mmReferrer",mobileRedirectCookieName:"mmMobileRedirect",mobileRedirectParam:"mmMobileRedirect",mobileRedirectCookieValue:"true",
mobileRedirectCookieDuration:43200,userAgentInclusions:[],userAgentExclusions:[],useDomain:!1,onRedirect:function(){}};mm.tools.extend(this.settings,mm.settings);this.location={path:c[3],fullPath:(c[3]||"")+(c[4]||""),domain:c[2],protocol:c[1],qs:function(){var a=(c[4]||"").substr(1).split("&")||[],b={};for(i=0;i<a.length;i++){var d=a[i].split("=")||[];b[d[0]]=d[1]}return b}()};var d=this.getRedirectUrl(a);!1!==b&&d&&(this.setRedirectMobileCookie(),this.settings.onRedirect(this.location),window.location=
d);return d},device:function(){var a=0,b=0,c="desktop",d=window.innerWidth,f=window.innerHeight;navigator.userAgent.toLowerCase().match(/(ipad|playbook|kindle|xoom)|(android(?!.*(mobi|opera mini)))/i)&&a++;navigator.userAgent.toLowerCase().match(/(up.browser|up.link|iphone|mmp|symbian|smartphone|midp|wap|windows phone|wphone|android|iemobile)/i)&&b++;if(0<b||0<a)500>=d&&720>=f&&d<f||800>=d&&500>=f&&d>f?b++:a++,a>b?c="tablet":b>=a&&(c="mobile");return c},checkOverride:function(){for(var a=0;a<this.settings.userAgentExclusions.length;a++){var b=
this.settings.userAgentExclusions[a];if("string"===typeof b){if(-1<navigator.userAgent.toLowerCase().indexOf(b.toLowerCase()))return!1}else if(navigator.userAgent.toLowerCase().match(b))return!1}for(a=0;a<this.settings.userAgentInclusions;a++)if(b=this.settings.userAgentInclusions[a],"string"===typeof b){if(-1<navigator.userAgent.toLowerCase().indexOf(b.toLowerCase()))return!0}else if(navigator.userAgent.toLowerCase().match(b))return!0;return null},getRedirectUrl:function(a){if(this.location.qs[this.settings.singlePageExcludeParam.split("=")[0]]===
this.settings.singlePageExcludeParam.split("=")[1])return!1;a=this.checkOverride();var b=this.device();if(!1===a||this.hasMobileNo()||null===a&&("desktop"===b||"mobile"===b&&!this.settings.redirectMobile||"tablet"===b&&!this.settings.redirectTablet))return!1;if(!this.hasRedirectMobileCookie()&&("mobile"===b&&Math.floor(100*Math.random())>this.settings.redirectPercentMobile||"tablet"===b&&Math.floor(100*Math.random())>this.settings.redirectPercentTablet))return this.setMobileNoCookie(mm.controller.settings.mobileRedirectCookieDuration),
!1;for(i=0;i<this.settings.routes.length;i++){var b=this.settings.routes[i],c=[].concat(b.from),d=!1;a=!1;for(var f=0;f<c.length;f++){var e=c[f];(e="string"===typeof e?this.settings.useDomain||-1<e.indexOf("http")?-1<(this.location.protocol+this.location.domain+this.location.fullPath).indexOf(e):-1<this.location.fullPath.indexOf(e):this.settings.useDomain||-1<e.toString().indexOf("http")?(this.location.protocol+this.location.domain+this.location.fullPath).match(e):this.location.fullPath.match(e))&&
(d=e)}if(d)return this.location.match=d||[],"string"===typeof b.to?a="function"===typeof this.settings[b.to]?this.settings[b.to](this.location,b.extraParam):b.to:"function"===typeof b.to&&(a=b.to(this.location,b.extraParam)),!a&&""!==a||(!0===a||!1===a)||(a=this.settings.domain+"/"+a.toString().replace(/^\//,"")),this.setRefererCookie(),a}},hasRedirectMobileCookie:function(){return mm.tools.cookie.get(mm.controller.settings.mobileRedirectCookieName)||-1<document.URL.indexOf(this.settings.mobileRedirectParam)?
!0:!1},setRedirectMobileCookie:function(){mm.tools.cookie.set(mm.controller.settings.mobileRedirectCookieName,mm.controller.settings.mobileRedirectCookieValue,{maxAge:mm.controller.settings.mobileRedirectCookieDuration})},hasMobileNo:function(){return-1<document.URL.indexOf(this.settings.noMobileParam)?(this.setMobileNoCookie(),!0):mm.tools.cookie.get(mm.controller.settings.noMobileCookieName)?!0:!1},setMobileNoCookie:function(a){mm.tools.cookie.set(mm.controller.settings.noMobileCookieName,mm.controller.settings.noMobileCookieValue,
{maxAge:a||mm.controller.settings.noMobileCookieDuration})},setRefererCookie:function(){mm.tools.cookie.set(mm.controller.settings.mmReferrerCookieName,encodeURIComponent(document.referrer),{domain:window.location.host.replace(/www\./,"")})}};
mm.tools={cookie:{get:function(a){return(this.getAll()||{})[a]},getAll:function(){for(var a={},b=document.cookie.split("; ")||[],c=0;c<b.length;c++){var d=b[c].split("=");a[d[0]]=d[1]}return a},set:function(a,b,c){c=mm.tools.extend({path:"/"},c);a=[a+"="+b];"number"===typeof c.maxAge&&(a.push("Max-Age="+60*c.maxAge),b=new Date,b.setTime(b.getTime()+6E4*c.maxAge),a.push("Expires="+b.toUTCString()));c.domain&&a.push("Domain="+c.domain);a.push("Path="+c.path);document.cookie=a.join("; ")},remove:function(a,
b){b=mm.tools.extend({maxAge:0},b);this.set(a,null,b)}},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};!mm.test&&mm.controller.init(document.URL);
