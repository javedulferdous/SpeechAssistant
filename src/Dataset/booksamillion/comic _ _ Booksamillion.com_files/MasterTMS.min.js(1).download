(function () {
  var newClient = 'https://secure-cdn.mplxtms.com/s/newClient/MasterTMS.min.js';
  var oldClient = 'https://secure-cdn.mplxtms.com/s/oldClient/MasterTMS.min.js';
  var excludedSiteIds = { '3241': true, '1875': true, '1171': true };
  var migratedDivisionId = { '18': true, '20': true, '21': true, '26': true, '33': true, '43': true, '44': true, '45': true, '51': true, '53': true, '56': true, '80': true, '87': true, '101': true, '136': true, '157': true, '241': true, '242': true, '260': true, '362': true, '404': true, '415': true };
  var ourScript = document.querySelector('script[src*=\'MasterTMS\']');
  var ourSrc;
  var siteId;
  var tmsScript;
  var tmsUrl;
  var divisionNumber;

  if (window.MasterTmsUdo && window.MasterTmsUdo.division_number) {
    divisionNumber = MasterTmsUdo.division_number;
  }

  if (ourScript !== null && ourScript !== undefined) {
    ourSrc = ourScript.src;
    if (ourSrc.indexOf('#') !== -1) {
      siteId = ourSrc.split('#')[1];
      if (excludedSiteIds[siteId] && !(siteId == '3241' && migratedDivisionId[divisionNumber])) {
        tmsUrl = oldClient;
      } else {
        tmsUrl = newClient;
      }
      tmsScript = document.createElement('script');
      tmsScript.type = 'text/javascript';
      tmsScript.async = true;
      tmsScript.src = tmsUrl + '#' + siteId;
      ourScript.parentNode.insertBefore(tmsScript, ourScript);
    }
  }
})();
