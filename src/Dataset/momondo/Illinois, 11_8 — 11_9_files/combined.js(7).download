(new R9.logger).time("combined");(function(a,b){a.createComponentClass("common.results.ScrollSearchBanner",{shownToUser:!1,options:{},cssClass:{bannerShow:"ScrollSearchBanner--showing",bannerHide:"ScrollSearchBanner--hidden",bannerInvisible:"ScrollSearchBanner--invisible"},cachedDomStates:{isBannerVisible:!1},init:function(){this.searchElement=this.getChildElement("bannerSearch");this.closeBannerElement=this.getChildElement("bannerClose")},addEventHandlers:function(){this.subscribe("scrollSearchBanner.toggleVisibility",this.toggleVisibility.bind(this));
this.registerEvent("click",this.searchElement,this.submitSearchForm.bind(this));this.registerEvent("click",this.closeBannerElement,this.dismissBanner.bind(this));this.registerEvent("reset.scrollSearch.banner.shown",this.resetBannerShown.bind(this));a.question.answer("was.user.shown.scrollSearch.banner",this.wasBannerShown.bind(this))},toggleVisibility:function(a){a?this.showBanner():this.closeBanner(!1)},submitSearchForm:function(){this.resetBannerShown();a.events.publish("submit.search.form");this._unbindScrollEvent();
this._trackEvent("scrollFormSubmit","searchFormSubmitFromBanner");this.closeBanner(!1);b(window).scrollTop(0).trigger("scroll")},dismissBanner:function(a){a.stopPropagation();this.closeBanner(!0)},showBanner:function(){this.cachedDomStates.isBannerVisible||(this.shownToUser=!0,this.cachedDomStates.isBannerVisible=!0,this._triggerDialogCloseOnSearchForm(),this.element.removeClass(this.getStlBlock(this.cssClass.bannerInvisible)),this.swapClasses(this.element,this.cssClass.bannerHide,this.cssClass.bannerShow),
this.element.attr("aria-hidden","false"),this._trackEvent("showBanner","makeBannerVisible"))},closeBanner:function(a){this.cachedDomStates.isBannerVisible&&(this.cachedDomStates.isBannerVisible=!1,this.swapClasses(this.element,this.cssClass.bannerShow,this.cssClass.bannerHide),this.element.addClass(this.getStlBlock(this.cssClass.bannerInvisible)),this.element.attr("aria-hidden","true"),a&&(this._unbindScrollEvent(),this._trackEvent("dismissSearchScrollBanner","userClosedBanner",a)))},wasBannerShown:function(){return this.shownToUser},
resetBannerShown:function(){this.shownToUser=!1},_triggerDialogCloseOnSearchForm:function(){a.events.publish("forceDismiss.DatePicker.ifOpen");a.events.publish("smarty.setitem.complete");a.events.publish("common.dropdown.closeAll");a.events.publish("common.widgets.select.close")},_trackEvent:function(b,c,d){a.Analytics.api.trackEvent({category:"scrollSearchBanner",action:b,label:c,value:d})},_unbindScrollEvent:function(){a.events.publish("unbind.scroll.search.event")},destroy:function(){this._unbindScrollEvent()}})})(R9,
jQuery);(function(d){d.createComponentClass("hotels.results.HotelPriceAlertButton",{options:{inFilterList:!1,wireButtonStyle:!1,driveByAnon:!1,alertSavedMessage:null,alertSavedMessageShort:null,alertUpdatedMessage:null,alertManageLinkMessage:null,showManageLink:!0,searchId:"",sourceId:null},createButton:void 0,init:function(){this.createButton=this.getChildElement("create")},inlineComponentsReady:function(){var a=d.question.ask("hotels.results.alerts.existingAlert");a&&0<a.length&&this.updateButtonVisibility(!0)},
addEventHandlers:function(){var a=this;this.createButton.off("click.pricealert").on("click.pricealert",function(){a.createButton.hasClass("clickedPriceAlert")||d.events.publish("hotels.results.alerts.create",{sourceId:a.options.sourceId})});this.subscribe(["alertsaved.success","hotels.results.alerts.driveby.cancel"],function(){a.createButton.removeClass("clickedPriceAlert");a.showAlertCompleteFeedback(!0);a.updateButtonVisibility(!0)});this.subscribe("hotels.priceAlert.setview",function(b){a.updateButtonVisibility("edit"===
b.view)});this.subscribe("search.poll.response",function(b){(b=b.existingAlertId)&&0<b?a.updateButtonVisibility(!0):a.updateButtonVisibility(!1)});this.subscribe("resultspage.searchId.changed",function(b){a.options.searchId=b.searchId});this.subscribe("resultspage.cleanup",function(){a.updateButtonVisibility(!1);a.options.inFilterList||a.element.addClass("hidden")});this.subscribe("hotels.results.priceAlertEnabled",function(b){a.setVisible(b)})},setVisible:function(a){a?this.element.show():this.element.hide()},
updateButtonVisibility:function(a){this.element.toggleClass("existing",a)},showAlertCompleteFeedback:function(a,b){var c=$(".belowSearchContainer .warningsContainer"),e=a?this.options.alertSavedMessage:this.options.alertUpdatedMessage,f=a?"alertSavedWarning":"alertUpdatedWarning";a&&b&&(e=this.options.alertSavedMessageShort);this.options.showManageLink&&(e+=" \x3ca href\x3d'/alerts' target\x3d'_blank' class\x3d'manageLink'\x3e"+this.options.alertManageLinkMessage+"\x3c/a\x3e",d.Analytics.api.trackEvent({category:"pricealert/managelink/impression",
action:"impression"}));c.empty();c.append("\x3cdiv class\x3d'%s'\x3e\x3cspan\x3e%s\x3c/span\x3e\x3c/div\x3e".format(f,e));$(".manageLink",c).on("click.manageLink",function(){d.Analytics.api.trackEvent({category:"pricealert/managelink/click",action:"click"})});c.addClass("visible");$(document).one("click",function(){c.removeClass("visible");$(".manageLink",c).off("click.manageLink")});a||setTimeout(function(){c.removeClass("visible")},8E3);d.events.publish("watching",{searchId:this.searchId})}})})(R9);(function(c){c.createComponentClass("hotels.results.HotelPriceAlertBanner",{options:{inFilterList:!1,wireButtonStyle:!1,driveByAnon:!1,alertSavedMessage:null,alertSavedMessageShort:null,alertUpdatedMessage:null,alertManageLinkMessage:null,showManageLink:!0,existingAlertId:null,searchId:"",sourceId:null,dateless:!1,killWatchlist:!1,regionSearch:!1,harmonizeToFlightStyle:!1,showHeader:!1},toggle:void 0,tooltipTrigger:void 0,alertIcon:void 0,alertIconActive:void 0,ripple:void 0,keyBoardNavigation:!1,
init:function(){this.toggle=this.getChildElement("toggle");this.options.harmonizeToFlightStyle&&(this.tooltipTrigger=this.getChildElement("tooltip-trigger"),this.ripple=this.getChildElement("ripple"),this.options.showHeader&&(this.alertIcon=this.getChildElement("alertIcon"),this.alertIconActive=this.getChildElement("alertIconActive")))},inlineComponentsReady:function(){var a=c.question.ask("hotels.results.alerts.existingAlert");a&&0<a.length&&this.setChecked(!0);this.options.existingAlertId&&0<this.options.existingAlertId&&
(this.setChecked(!0),c.events.publish("hotels.results.existingAlert",this.options.existingAlertId));this.options.harmonizeToFlightStyle&&this.tooltipTrigger.getWidget()&&this.tooltipTrigger.getWidget().setContent(this.options.msg.tooltipMsg)},addEventHandlers:function(){var a=this;this.toggle.checkbox({change:function(b,d,e){c.Analytics.api.trackEvent({category:"Price-Alert",action:b.checked?"toggleOn":"toggleOff"});c.events.publish("hotels.results.priceAlerts.toggle.sync",{id:a.id(),checked:b.checked});
b.checked?(c.events.publish("hotels.results.alerts.create",{sourceId:a.options.sourceId}),this.options.showHeader&&a.activateAlertIcon()):(c.events.publish("hotels.results.alerts.delete"),this.options.showHeader&&a.inActivateAlertIcon());b.blur()}});this.subscribe("hotels.priceAlert.setview",function(b){a.setChecked("edit"===b.view)});this.subscribe("search.poll.response",function(b){var c=b.existingAlertId;a.options.existingAlertId=c;var e=b.regionSearch;a.options.dateless=b.dateless;a.options.regionSearch=
e;a.options.regionSearch?a.element.addClass("regional"):a.element.removeClass("regional");c&&0<c?a.setChecked(!0):a.setChecked(!1)});this.subscribe("hotels.results.search.finished",function(){a.setCheckboxEnabled(!0)});this.subscribe("resultspage.cleanup",function(){a.setChecked(!1);a.setCheckboxEnabled(!1)});this.subscribe(["hotels.results.priceAlert.show","hotels.results.prediction"],function(b){a.setCheckboxEnabled(!!b)});this.subscribe("hotels.results.priceAlertEnabled",function(b){a.setCheckboxEnabled(b.enabled);
a.setVisible(b.visible)});this.subscribe("hotel.results.alerts.driveby.cancel",function(){a.setChecked(!1)});this.subscribe("hotels.results.alerts.delete",function(){a.setChecked(!1)});this.subscribe("alertsaved.success",function(){a.setChecked(!0)});this.subscribe(["alertsaved.success","hotel.results.alerts.driveby.cancel"],function(){a.showAlertCompleteFeedback(!0);a.keyBoardNavigation&&setTimeout(function(){a.toggle.focus();a.keyBoardNavigation=!1},10)});this.subscribe("hotels.results.priceAlerts.toggle.sync",
function(b){b.id!==a.id&&a.setChecked(b.checked)});this.registerEvent("keydown",this.toggle,function(b){b.which===c.globals.keyCodes.SPACE&&(a.keyBoardNavigation=!0)})},setChecked:function(a){this.toggle.getWidget().setChecked(a);this.options.showHeader&&(a?this.activateAlertIcon():this.inActivateAlertIcon())},setCheckboxEnabled:function(a){this.toggle.getWidget().setEnabled(a)},showAlertCompleteFeedback:function(a,b){if(!this.options.killWatchlist){var d=$(".belowSearchContainer .warningsContainer"),
e=a?this.options.alertSavedMessage:this.options.alertUpdatedMessage,f=a?"alertSavedWarning":"alertUpdatedWarning";a&&b&&(e=this.options.alertSavedMessageShort);this.options.showManageLink&&(e+=" \x3ca href\x3d'/alerts' target\x3d'_blank' class\x3d'manageLink'\x3e"+this.options.alertManageLinkMessage+"\x3c/a\x3e",c.Analytics.api.trackEvent({category:"pricealert/managelink/impression",action:"impression"}));d.empty();d.append("\x3cdiv class\x3d'%s'\x3e\x3cspan\x3e%s\x3c/span\x3e\x3c/div\x3e".format(f,
e));$(".manageLink",d).on("click.manageLink",function(){c.Analytics.api.trackEvent({category:"pricealert/managelink/click",action:"click"})});d.addClass("visible");$(document).one("click",function(){d.removeClass("visible");$(".manageLink",d).off("click.manageLink")});a||setTimeout(function(){d.removeClass("visible")},8E3)}c.events.publish("watching",{searchId:this.searchId})},setVisible:function(a){a?this.element.removeClass("hidden"):this.element.addClass("hidden");this.toggle.attr("aria-hidden",
!a)},activateAlertIcon:function(){this.alertIcon.hide();this.alertIconActive.show();this.ripple.addClass("rippleEffect");this.ripple.on(c.Common.Utils.Browsers.ANIMATION_END,function(){this.alertIconActive.removeClass("in-transition").addClass("active")}.bind(this))},inActivateAlertIcon:function(){this.alertIcon.show();this.alertIconActive.hide();this.ripple.removeClass("rippleEffect");this.alertIconActive.removeClass("active").addClass("in-transition")}})})(R9);(function(d,e){function g(a){return a?"string"===typeof a&&(""===a.trim()||0>=parseInt(a)):!0}var l={landmarkId:"lm",countryId:"ctry",hotelId:"hotel",neighbourhoodId:"hood",regionId:"reg",freeRegionId:"freereg",cityId:"city",address:"addr"},n={lm:"landmarkId",ctry:"countryId",hotel:"hotelId",hood:"neighbourhoodId",reg:"regionId",freereg:"freeRegionId",city:"cityId",addr:"address"},m="landmarkId countryId hotelId neighbourhoodId regionId freeRegionId cityId".split(" ");d.createComponentClass("hotels.search.HotelSearchForm",
"base.search.SearchForm",{formQuestion:"hotels.fd.searchform",formCitycodeQuestion:"hotels.fd.searchform.citycode",formCitynameQuestion:"hotels.fd.searchform.cityname",formLocationQuestion:"hotels.fd.searchform.location",formSearchUrlBuilderQuestion:"hotels.fd.searchform.build",travelersDataQuestion:"hotels.searchform.travelers.",numNightsQuestion:"hotels.fd.searchform.numNights",daysOutQuestion:"hotels.fd.searchform.daysOut",options:{slideCMP2:!1,slideCMP2OnReady:!0,isSEM:!1,defaultRooms:1,defaultGuests:5,
defaultAdults:1,defaultChildren:1,flareSmartyType:30,smartyUrl:"/mv/marvel",locationType:"",maxRooms:8,maxGuests:32,maxAdults:32,maxChildren:32,forceOpen:!1,filterTemplateName:null,hotelPlannerTrigger:0,activeHome:!1,useLegacySearchUrl:!1,msg:{location:"",city:"",checkinDate:"",checkoutDate:"",roomsChoiceLabel:"",guestsChoiceLabel:"",roomsOverMax:"",roomsBelowMin:"",guestsOverMax:"",guestsBelowMin:"",useLegacyDatePicker:!0},formQuestion:"hotels.fd.searchform",isSingleHotel:!1,isDisabledAdvanced:!1,
isTravelerTypeEnabled:!1,loggingPrefix:"",belowCalendar:null,goToHotelDetailsPage:!1,keepLocation:!0,showSmartyHistory:!1,maxHistoryItems:5,controlGroup:null,urlParams:void 0,autofocusDestination:!1,autoOpenDatepicker:!1,isFdForm:!1,isRegionSearchEnabled:!1,showNumberboxTooltips:!1,useLocalStorageHistory:!1,numberBoxMsg:{roomsOverMax:function(){var a=this.adults.getValue()+this.children.getValue();return d.Common.Utils.String.formatString(this.options.msg.roomsOverMax,this.rooms.getValue(),a)},roomsBelowMin:function(){var a=
this.adults.getValue()+this.children.getValue();return d.Common.Utils.String.formatChoice(this.options.msg.roomsBelowMin,this.rooms.getValue(),this.rooms.getValue(),a)},guestsOverMax:function(){var a=this.adults.getValue()+this.children.getValue();return d.Common.Utils.String.formatString(this.options.msg.guestsOverMax,a,this.rooms.getValue())},guestsBelowMin:function(){var a=this.adults.getValue()+this.children.getValue();return d.Common.Utils.String.formatChoice(this.options.msg.guestsBelowMin,
a,a,this.rooms.getValue())}},showNeedIdeasButton:!1,showPopularDestinationsList:!1,showPopularDestinationsPictures:!1,searchAutoExecute:!1,searchAutoExecuteAfterCmp2:!1,hasSubscriptionPanel:!1,hotelTravelersDropdownEnabled:!1,useAlgoliaSmarty:!1,colorCodingDescriptions:{low:"",medium:"",high:""}},filtersContainerEl:null,amenity:null,neighbourhoodId:null,neighbourhood:null,ambiance:null,location:null,cityId:null,cityName:null,hotelId:null,freeRegionId:null,regionId:null,countryId:null,locationType:"",
calendarFooter:null,daterangePicker:null,rooms:null,guests:null,adults:null,children:null,roomsGuestsDropdown:null,traveler:null,hotelPlanner:null,cityColors:[],vertical:"hotels",_dateFormat:"YYYY-MM-DD",extraFiltersData:{},advancedFilterState:null,searchFormFilterState:null,lastCheckInDate:null,lastCheckOutDate:null,smartyItemChanged:!1,searchAutoExecuteOnChangeCount:3,searchAutoExecuteChanged:[],cmp2Items:void 0,init:function(){this.base();this.hcPlacesEnabled=d.config.getBoolean("ui.hc.places.enabled",
!1);this.locationType=this.options.locationType||"";this.formQuestion=this.options.formQuestion;this.formCitycodeQuestion=this.formQuestion+".citycode";this.formLocationQuestion=this.formQuestion+".location";this.formSearchUrlBuilderQuestion=this.formQuestion+".build";this.bindDaterangePicker();this.options.hotelTravelersDropdownEnabled||this.bindRoomsGuestsDropdown();this.bindLocationField();this.bindTravelerTypeRadios();if(!this.options.loggedIn&&this.options.privateDealsPromoEnabled){var a=this.getChildElement("privatedeals");
a.on("click",function(a){d.Analytics.api.trackEvent("hotels/form/private-deals-promo/click");d.authentication.showLogin({success:function(){d.Analytics.api.trackEvent("hotels/form/private-deals-promo/success");location.reload()}})});if(this.options.isFdForm){var b=d.storage.get("fd.privatedeals.promo.viewcount");b||(a.addClass("first-time-user"),b=0);d.storage.set("fd.privatedeals.promo.viewcount",++b)}d.Analytics.api.trackEvent("hotels/form/private-deals-promo/impression")}this.options.useDialogQuestions&&
(this.formQuestion+=".dialog",this.formCitycodeQuestion+=".dialog",this.formLocationQuestion+=".dialog");this.filtersContainerEl=this.getChildElement("filtersContainer");this.calendarFooter=this.getChildElement("calendarFooter")},inlineComponentsReady:function(){this.base();this.options.autoOpenDatepicker&&this.openDatepicker();d.globals&&d.globals.isSeo&&this.isValidDates();this.element.is(":visible")&&this.options.slideCMP2OnReady&&this.loadSlideCMP2()},vsLog:function(a){this.searchForm.is(":visible")&&
0<=this.searchForm.offset().top&&"complete"===document.readyState&&d.Analytics.api.trackEvent(["hotels/form",a].join("/"))},addEventHandlers:function(){this.base();var a=this;this.subscribe("hotels.frontdoor.form.location hotels.frontdoor.form.rooms hotels.frontdoor.form.guests hotels.frontdoor.form.guests.adults hotels.frontdoor.form.guests.children hotels.frontdoor.form.guests.childrenAges hotels.frontdoor.form.dates hotels.frontdoor.form.traveler hotels.frontdoor.form.all cmp2.form.fill".split(" "),
e.proxy(this.onChange,this));this.bindAdvancedFilter();this.subscribe("hotels.frontdoor.form.location hotels.frontdoor.form.rooms hotels.frontdoor.form.guests hotels.frontdoor.form.guests.adults hotels.frontdoor.form.guests.children hotels.frontdoor.form.guests.childrenAges hotels.frontdoor.form.dates hotels.frontdoor.form.traveler hotels.frontdoor.form.all cmp2.form.fill".split(" "),{id:this.id()},e.proxy(this.onInternalChange,this));this.options.showColorCoded&&(this.subscribe("hotels.frontdoor.form.location",
function(){a.updateCalendarColors()}),this.subscribe("DatePicker.summon",function(){a.updateCalendarColors()}),this.subscribe("DatePicker.opened",function(){a.updateCalendarColors()}),this.subscribe("Calendar.monthchange",function(){a.updateCalendarColors()}));this.subscribe("hotels.frontdoor.filter.TOGGLE",e.proxy(this.toggleAdvanced,this));this.subscribe("intentmedia.submit.handler",e.proxy(this.onHookSubmitForIntentMedia,this));this.subscribe("hotels.frontdoor.form.autoSubmit",this.autoSubmit.bind(this));
this.subscribe("omni.vertical.changed",function(b){"hotels"===b&&a.focusFirstElement()});this.answer(this.formQuestion,function(){return a.serialize()});this.answer(this.formSearchUrlBuilderQuestion,function(b){b=e.extend({},a.serialize(),b);return a.buildSearchURL(b)});this.answer(this.formLocationQuestion,function(){var b="\x3cdiv\x3e"+a.location.val()+"\x3c/div\x3e";return e(b).text()});this.answer(this.formCitycodeQuestion,function(){return a.cityId.val()});this.answer(this.formCitynameQuestion,
function(){return a.cityName.val()});this.answer("hotels.results.searchType",this.getSearchType.bind(this));this.answer("hotels.results.locationId",this.getLocationId.bind(this));this.answer(this.numNightsQuestion,this.calculateNumNights.bind(this));this.answer(this.daysOutQuestion,this.calculateDaysOut.bind(this));this.options.showNeedIdeasButton&&(this.needIdeasButton=this.getChildElement("need-ideas"),this.needIdeasButton.click(this.needIdeas),a.needIdeasButton.removeClass("hidden"));this.options.searchAutoExecuteAfterCmp2&&
this.subscribe("cmp2.rendering.finished",function(b){!a.isNewCmp2CheckAdded(b)&&a.canExecuteAutoSearch()&&(a.searchAutoExecuteChanged=[],a.onSubmit())});if(this.options.slideCMP2){var b=this;this.subscribe("hotels.frontdoor.form.location hotels.frontdoor.form.rooms hotels.frontdoor.form.guests hotels.frontdoor.form.guests.adults hotels.frontdoor.form.guests.children hotels.frontdoor.form.guests.childrenAges hotels.frontdoor.form.dates hotels.frontdoor.form.traveler hotels.frontdoor.form.all cmp2.form.fill".split(" "),
function(){b.enableSearchButton()})}this.subscribe("form.clear.location.inputs",this.clearLocationInputs.bind(this));this.options.hotelTravelersDropdownEnabled||(this.subscribe("hotels.frontdoor.rooms.onChange",{namespace:this.id()},this.onRoomsChange.bind(this)),this.subscribe("hotels.frontdoor.guests.onChange",{namespace:this.id()},this.onGuestsChange.bind(this)))},clearLocationInputs:function(){this.location.val("");this.cityId.val("");this.cityName.val("");this.hotelId.val("");this.freeRegionId.val("");
this.regionId.val("");this.landmarkId.val("");this.countryId.val("")},updateCalendarColors:function(){var a=this.cityId.val();""!=a&&"0"!=a?this.fetchPriceColors(a):this.clearColors()},fetchPriceColors:function(a){var b=this,c=e.Deferred(),f=e.Deferred(),h="/api/search/buzzCalendar/hotels/"+a;if(this.cityColors[a])return h=b.processPriceData(this.cityColors[a]),c.resolve(h),h=b.showFooter(),f.resolve(h),c;d.action.executeSkipUrlPrefix(h).done(function(d){if(!d)throw b.clearColors(),Error("No data in price response");
b.cityColors[a]=d;d=b.processPriceData(d);c.resolve(d);d=b.showFooter();f.resolve(d)}).catch(c.reject.bind(this));return c},clearColors:function(){this.belowCalendar=jq(".belowCalendar");this.belowCalendar.addClass("hidden");jq(".col-day").removeClass("low medium high").removeAttr("aria-describedby title")},showFooter:function(){this.belowCalendar=jq(".belowCalendar");0==this.belowCalendar.find("div").length&&this.belowCalendar.addClass("hidden").append(this.calendarFooter.find(".colorCodedFooter"));
this.belowCalendar.removeClass("hidden").addClass("colorCoded");this.belowCalendar.find(".colorCodedFooter").addClass("showing")},processPriceData:function(a){var b=this,c=a.dates;jq(".col-day").removeClass("low").removeClass("medium").removeClass("high");this.belowCalendar=jq(".belowCalendar");Object.keys(c).forEach(function(a){var f=c[a];a=b.strToDate(a).format("x");b.setPriceClasses(a,f);b.setPriceAriaDescription(a,f)})},setPriceClasses:function(a,b){a=jq(".col-day[data-val\x3d'"+a+"']");switch(b){case "LOW":a.addClass("low").removeClass("medium").removeClass("high");
break;case "MEDIUM":a.removeClass("low").addClass("medium").removeClass("high");break;case "HIGH":a.removeClass("low").removeClass("medium").addClass("high")}},setPriceAriaDescription:function(a,b){a=jq(".col-day[data-val\x3d'"+a+"']");var c=this.getColorLegendId(b);c?a.attr("aria-describedby",c):a.removeAttr("aria-describedby");(b=this.getColorDescription(b))?a.attr("title",b):a.removeAttr("title")},getColorLegendId:function(a){switch(a){case "LOW":return this.id("colorCodedLegend-low");case "MEDIUM":return this.id("colorCodedLegend-medium");
case "HIGH":return this.id("colorCodedLegend-high");default:return null}},getColorDescription:function(a){switch(a){case "LOW":return this.options.colorCodingDescriptions.low;case "MEDIUM":return this.options.colorCodingDescriptions.medium;case "HIGH":return this.options.colorCodingDescriptions.high;default:return null}},dateToStr:function(a){return moment(a).format("YYYY-MM-DD")},strToDate:function(a){return moment(a,"YYYY-MM-DD")},refreshHistory:function(){this.options.controlGroup&&this.options.controlGroup.getHistory().update()},
setupLocationFields:function(){this.location=this.getChildElement("location");this.cityId=this.getChildElement("city-id");this.cityName=this.getChildElement("city-name");this.hotelId=this.getChildElement("hotel-id");this.landmarkId=this.getChildElement("landmark-id");this.neighbourhoodId=this.getChildElement("neighborhood-id");this.regionId=this.getChildElement("regionId");this.subRegionId=this.getChildElement("subRegionId");this.freeRegionId=this.getChildElement("freeRegionId");this.countryId=this.getChildElement("countryId");
this.stars=this.getChildElement("star-wrapped");this.price=this.getChildElement("price-wrapped");this.rating=this.getChildElement("rating-wrapped");this.address=this.getChildElement("addr");this.placeId=this.getChildElement("placeId");this.placeName=this.getChildElement("placeName");this.dates=this.daterangePicker},loadSlideCMP2:function(){if(this.options.slideCMP2&&void 0===this.validate()){this.disableSearchButton();var a=this,b=this.serialize()||{};b.relativeUrl=!0;var b=this.buildSearchURL(b),
c={id:this.id("slidecmp2"),url:b};if(this.options.activeHome&&!this.options.slideCMP2PreventRedirect)return d.action.execute("hotels/search/brands/cheapflights/Redirect",{url:b,returnUrl:!0},function(a){window.location.href=a}),!0;d.ajax.execute("common/compareto/slide/SlideCompareToHotels",{customUpdate:function(b){var c=a.getChildElement("slidecmp2");c.attr("class","");c.replaceWith(b.innerHTML);return!0},data:c});return!0}return!1},bindLocationField:function(){var a=this;this.setupLocationFields();
this.options.autoOpenDatepicker&&(e(this.location).on("keyup",function(b){13===b.which&&a.cityId.val()&&a.openDatepicker()}),e(this.location).on("mousedown touchstart",function(){e(this).focus()}));var b={minWidth:420,smartyControlGroup:null,flareSmartyType:a.options.flareSmartyType,dataSource:a.options.smartyUrl,messages:a.options.msg,clearItem:function(){a.smartyItemChanged=!0;a.locationType="";a.cityId.val("");a.cityName.val("");a.landmarkId.val("");a.hotelId.val("");a.neighbourhoodId.val("");
a.freeRegionId.val("");a.regionId.val("");a.countryId.val("");a.address.val("");a.hcPlacesEnabled&&(a.placeName.val(""),a.placeId.val(""));d.events.publish("hotels.frontdoor.form.location",{id:a.id(),locationType:"",location:"",cityId:"",landmarkId:"",hotelId:"",addr:"",placeName:"",placeId:""})},showPopularDestinationsList:a.options.showPopularDestinationsList&&this.options.isFdForm,showPopularDestinationsPictures:a.options.showPopularDestinationsPictures&&this.options.isFdForm,showBackgroundAutocomplete:d.config.getBoolean("ui.common.smarty.background.autocomplete.enabled",
!1),setItem:d.Common.Utils.throttle(50,function(b,c){a.smartyItemChanged=!0;b=c||{};c=b.id||b.lmid||b.hid||b.frid||b.rid||b.cid||b.nhid;a.options.keepHotelIdOnCitySearch&&b.id===a.options.citycode&&"city"===b.type&&(b.hid=b.hid||a.options.hotelId||"",b.hid===a.options.hotelId&&(a.smartyItemChanged=!1));d.events.publish("hotels.frontdoor.form.location",{id:a.id(),location:b.str,locationType:b.type||"",cityId:b.id||(c?"0":""),locationName:b.short_str,landmarkId:b.lmid||(c?"0":""),hotelId:b.hid||(c?
"0":""),freeRegionId:b.frid||(c?"0":""),regionId:b.rid||(c?"0":""),countryId:b.cid||(c?"0":""),neighbourhoodId:b.nhid||(c?"0":""),entityKey:b.entityKey||(c?"0":""),objectID:b.objectID||(c?"0":"")});c=a.options.useLegacyDatePicker?a.dates.endInput.val()&&a.dates.startInput.val():a.checkIn.getValue()&&a.checkOut.getValue();a.options.autoOpenDatepicker&&!c&&a.openDatepicker();a.options.autoSubmit&&b.str&&a.autoSubmit();a.vsLog("location")}),afterDone:function(){""===a.location.val()&&(a.smartyItemChanged=
!0,a.locationType="",a.cityId.val(""),a.cityName.val(""),a.landmarkId.val(""),a.neighbourhoodId.val(""),a.hotelId.val(""),a.freeRegionId.val(""),a.regionId.val(""),a.countryId.val(""),a.address.val(""),a.hcPlacesEnabled&&(a.placeName.val(""),a.placeId.val("")),d.events.publish("hotels.frontdoor.form.location",{id:a.id(),locationType:"",location:"",cityId:"",cityName:"",landmarkId:"",hotelId:"",entityKey:"",objectID:"",placeName:"",placeId:""}))}},c=this.location.data("inputModal");c&&(b.appendTo=
c.getSmartyWrapper(),b.fixedDropdown=!0,b.minWidth=null,b.maxWidth=null);this.checkAndSetDropdownSmartyInnerScrollOpts(b);this.checkAndSetSmartyUIUpdateOpts(b);d.globals.testMode&&(b.windowDataTestTagName="data-test-location-smarty-window",b.windowDataTestTagValue=this.location.attr("id"));this.locationSmarty=(a.options.useAlgoliaSmarty?this.location.algoliaHotelSmarty(b):this.location.hotelSmarty(b)).getWidget()},openDatepicker:function(){var a=this;setTimeout(function(){a.options.useLegacyDatePicker?
a.daterangePicker.startDisplay.trigger("mousedown"):a.checkIn&&a.checkIn.trigger?a.checkIn.trigger("focus"):a.checkIn&&a.checkIn.summonDatePicker&&a.checkIn.summonDatePicker()},25)},bindAdvancedFilter:function(){var a=this;this.subscribe("hotels.frontdoor.form.location",function(b){a.shouldUpdate(b)&&d.events.publish("hotels.frontdoor.updateFilters",b)})},bindDaterangePicker:function(){var a=this,b=function(b){var c=this.serialize();d.events.publish("hotels.frontdoor.form.dates",{id:this.id(),checkInDate:c.checkInDate,
checkOutDate:c.checkOutDate,actOnStart:b});this.vsLog("checkout");a.options.autoSubmit&&a.autoSubmit()};this.options.useLegacyDatePicker?this.daterangePicker=this.getChildElement("stayDates").daterangePicker({getFormData:function(){return e.extend({vertical:a.vertical},a.serialize())},change:function(b,f){b=a.serialize();d.events.publish("hotels.frontdoor.form.dates",{id:a.id(),checkInDate:b.checkInDate,checkOutDate:b.checkOutDate,actOnStart:f});a.vsLog("checkout")},useDaysFormat:!0,alwaysShowEndDatepicker:a.options.autoOpenDatepicker,
nextFieldSelector:"#"+a.id("submit"),secondClickHideDelay:a.options.searchAutoExecute||a.options.searchAutoExecuteAfterCmp2?0:200}).getWidget():(this.checkIn=this.getChildElement("checkIn").getWidget(),this.checkOut=this.getChildElement("checkOut").getWidget(),this.checkIn.options.change=b.bind(this,!0),this.checkOut.options.change=b.bind(this,!1),this.dateRangeInput=this.getChildElement("dateRangeInput").getWidget())},bindRoomsGuestsDropdown:function(){var a=this,b,c;b=this.searchForm.closest(".viewport").find(".content");
c=this.options.phoenixRising?"styleJamDropdownDialog":"dropdownDialog";this.roomsGuestsDropdown=this.getChildElement("roomsGuestsDropdown")[c]({expandTo:this.id("roomsGuestsDropdown-cover"),container:b.length?b:void 0,alignment:this.options.phoenixRising?"left":"right",coverTrigger:this.options.phoenixRising,onOpen:function(){a.roomsGuestChanged=!1;setTimeout(function(){a.rooms.decrButton.focus()},100);a.getChildElement("roomsGuestsDropdown").attr("aria-expanded","true")},onClose:function(b,c,d){b&&
d&&27===d.which&&setTimeout(function(){a.roomsGuestsDropdown.element.focus()},100);a.roomsGuestChanged&&a.options.autoSubmit&&a.autoSubmit();a.getChildElement("roomsGuestsDropdown").attr("aria-expanded","false")}}).getWidget();this.roomsGuestsDropdown.element.off("keydown").keydown(function(b){if(40===b.which||32===b.which)b.preventDefault(),b.stopPropagation(),a.roomsGuestsDropdown.toggleContent(!0)});d.events.subscribe("hotelsearchform.close.roomsGuestsDropdown",function(){a.roomsGuestsDropdown.close()});
this.rooms=this.getChildElement("rooms").numberBox({min:1,max:a.options.maxRooms,defaultValue:a.options.defaultRooms,callback:function(){a.updateBoxButtonStates();a.roomsGuestChanged=!0;d.events.publish("hotels.frontdoor.form.rooms",{id:a.id(),rooms:this.getValue()});a.vsLog("changerooms")}}).getWidget();b=this.rooms.decrButton;this.adults=this.getChildElement("adults").numberBox({min:1,max:a.options.maxAdults,defaultValue:a.options.defaultAdults,callback:function(){a.roomsGuestChanged=!0;d.events.publish("hotels.frontdoor.form.guests.adults",
{id:a.id(),adults:this.getValue()});a.vsLog("changeguests_adults")}}).getWidget();c=(this.children=this.getChildElement("children").numberBox({min:0,max:a.options.maxChildren,defaultValue:a.options.defaultChildren,callback:function(){a.roomsGuestChanged=!0;d.events.publish("hotels.frontdoor.form.guests.children",{id:a.id(),children:this.getValue()});a.vsLog("changeguests_children")}}).getWidget())&&this.children.incrButton;var f=function(b,c){b&&b.off("keydown").keydown(function(b){9===b.which&&(c?
b.shiftKey:!b.shiftKey)&&(b.preventDefault(),b.stopPropagation(),setTimeout(function(){a.roomsGuestsDropdown.element.focus();a.roomsGuestsDropdown.toggleContent(!1)},100))})};f(b,!0);f(c,!1);this.hotelPlanner=this.getChildElement("hotelPlanner");this.hotelPlanner.on("click",function(b){b=a.serialize();d.events.publish("hotelplanner.open",{location:b.location,startDate:b.checkInDate,endDate:b.checkOutDate})});this.updateBoxButtonStates()},updateBoxButtonStates:function(){var a=this.adults.getValue(),
b=this.children.getValue();a+b===Math.min(this.options.maxGuests,4*this.options.maxRooms)?(this.adults.disableIncrement(),this.children.disableIncrement()):(this.adults.enableIncrement(),this.children.enableIncrement())},bindTravelerTypeRadios:function(){if(this.options.isTravelerTypeEnabled&&this.getChildElement("traveler").length){var a=this;this.traveler=this.getChildElement("traveler").radioButtonSet({change:function(b){b="traveler/"+(b.value||"");e.proxy(a.dataChanged,a);a.vsLog(b)}}).getWidget()}},
onHookSubmitForIntentMedia:function(a){a&&"function"===typeof a.callOnSubmit&&(this.intentMediaCallOnSubmit=a.callOnSubmit)},onSubmit:function(a){var b=this.base;if(!this.isSubmitted){this.syncFilters();if(this.loadSlideCMP2()||!1===this.submitSubscription.call(this))return!1;this.setYandexTracking();this.submitIntentMedia();b.call(this,a);this.options.autoSubmit&&(this.isSubmitted=!1)}return!1},isRegionSearch:function(a){return(a.regionId||a.freeRegionId||a.countryId)&&(0!=a.regionId||0!=a.freeRegionId||
0!=a.countryId)},publishSubmitEvent:function(a){a&&a.url&&0<=a.url.indexOf("%s")&&(new d.logger).error("HotelSearchForm submit url has invalid %s parameter");this.isRegionSearch(a)&&this.options.isRegionSearchEnabled?window.location.href="/"+a.url:this.base(a);d.storage.remove("hotelsHideRentalsXSell")},autoSubmit:function(){if(this.checkFormChanges())this.onSubmit()},checkFormChanges:function(){return!1},onChange:function(a){this.shouldUpdate(a)&&(this.updateLogging(a),this.load(a),this.saveToStorage(),
this.refreshHistory())},registerAndCheckAutoSearch:function(a){var b=this,c=function(a,c){var d=b.searchAutoExecuteChanged.indexOf(a);(c=0===c.length)&&-1!==d?b.searchAutoExecuteChanged.splice(d,0):-1!==d||c||b.searchAutoExecuteChanged.push(a)};a.hasOwnProperty("location")&&(b.searchAutoExecuteChanged=[],c("location",a.location));a.hasOwnProperty("checkInDate")&&c("checkInDate",a.checkInDate);a.hasOwnProperty("checkOutDate")&&!a.actOnStart&&c("checkOutDate",a.checkOutDate);return this.canExecuteAutoSearch()},
canExecuteAutoSearch:function(){return!this.element.hasClass("Advanced")&&this.searchAutoExecuteChanged.length===this.searchAutoExecuteOnChangeCount},isNewCmp2CheckAdded:function(a){var b;if(this.cmp2Items){var c=this.cmp2Items;b=function(a){return a.checked&&!c.some(function(b){return a.id===b.id&&b.checked})}}else b=function(a){return a.checked};this.cmp2Items=a.items;return a.items.some(b)},onInternalChange:function(a){if(this.options.searchAutoExecute&&this.registerAndCheckAutoSearch(a))this.searchAutoExecuteChanged=
[],this.onSubmit();else{for(var b=this.options.searchAutoExecuteAfterCmp2&&this.registerAndCheckAutoSearch(a),c="location checkInDate checkOutDate rooms guests adults children traveler refreshCmp2sOnOpen".split(" "),d=0;d<c.length;d++)if(a.hasOwnProperty(c[d])){this.loadCompareToItems();break}if(!b&&(b={location:"location",checkInDate:"checkin",checkOutDate:"checkout",rooms:"rooms",guests:"guests",adults:"adults",children:"children",traveler:"traveler"},c=null,a.hasOwnProperty("checkInDate")&&(a.checkInDate!==
this.lastCheckInDate&&(c="checkInDate"),this.lastCheckInDate=a.checkInDate),a.hasOwnProperty("checkOutDate")&&(a.checkOutDate!==this.lastCheckOutDate&&(c="checkOutDate"),this.lastCheckOutDate=a.checkOutDate),null!==c&&delete a["checkOutDate"===c?"checkInDate":"checkOutDate"],!a.silent))for(var e in b)a.hasOwnProperty(e)&&this.submitPreload(b[e])}},onRoomsChange:function(a){a.rooms>this.rooms.options.max?this.rooms.setValue(this.rooms.options.max,!0):a.rooms<this.rooms.options.min?this.rooms.setValue(this.rooms.options.min,
!0):this.rooms.setValue(a.rooms,!0);a=this.rooms.getValue();var b=this.adults.getValue(),c=this.children.getValue();b<a&&(b=a);4*a<b+c&&(c=4*a-b,0>c&&(c=0,b=4*a));this.children.setValue(c,!0);this.adults.setValue(b,!0);this.refreshRoomsGuestsDropdownDisplay()},calculateNumNights:function(){var a=1,b,c;this.options.useLegacyDatePicker?(b=moment(this.daterangePicker.getStartDate()),c=moment(this.daterangePicker.getEndDate())):(b=this.checkOut.getDate(),c=this.checkIn.getDate());null!=b&&null!=c&&(a=
b.diff(c,"days",!0));return Math.ceil(a)},calculateDaysOut:function(){var a=0,b;b=this.options.useLegacyDatePicker?moment(this.daterangePicker.getStartDate()):this.checkIn.getDate();null!=b&&(a=moment(moment.now()),a=b.diff(a,"days",!0));return Math.ceil(a)},onGuestsFieldChange:function(a){a.guests>this.guests.options.max?this.guests.setValue(this.guests.options.max,!0):a.guests<this.guests.options.min?this.guests.setValue(this.guests.options.min,!0):this.guests.setValue(a.guests,!0);a=this.guests.getValue();
var b=this.rooms.getValue();4*b<a?(b=Math.ceil(a/4),this.rooms.setValue(b),this.options.showNumberboxTooltips&&this.showTooltip(this.guests.incrButton,this.options.numberBoxMsg.guestsOverMax.call(this))):b>a?(this.rooms.setValue(a),this.options.showNumberboxTooltips&&this.showTooltip(this.guests.incrButton,this.options.numberBoxMsg.guestsBelowMin.call(this))):this.options.showNumberboxTooltips&&this.clearTooltips();this.refreshRoomsGuestsDropdownDisplay()},onAdultsFieldChange:function(a){a.adults>
this.adults.options.max?this.adults.setValue(this.adults.options.max,!0):a.adults<this.adults.options.min?this.adults.setValue(this.adults.options.min,!0):this.adults.setValue(a.adults,!0);var b=this.adults.getValue();a=this.children.getValue();var c=this.rooms.getValue(),d=Math.ceil((b+a)/4);d>b&&(d=b);c<d?c=d:c>b&&(c=b,b=4*c-b,a=b<a?b:a);this.children.setValue(a,!0);this.rooms.setValue(c,!0);this.refreshRoomsGuestsDropdownDisplay()},onChildrenFieldChange:function(a){a.children>this.children.options.max?
this.children.setValue(this.children.options.max,!0):a.children<this.children.options.min?this.children.setValue(this.children.options.min,!0):this.children.setValue(a.children,!0);a=this.adults.getValue();var b=this.children.getValue(),c=this.rooms.getValue(),b=Math.ceil((b+a)/4);c<b&&(c=b);c>a&&(a=c);this.adults.setValue(a,!0);this.rooms.setValue(c,!0);this.refreshRoomsGuestsDropdownDisplay()},onGuestsChange:function(a){var b,c;"undefined"!==typeof a.guests?(b=a.guests,c=0):(b=a.adults,c=a.children);
if("undefined"!==typeof b)this.onAdultsFieldChange(a);else if("undefined"!==typeof c)this.onChildrenFieldChange(a)},getExtraFilterData:function(){var a=d.question.ask("hotels.frontdoor.filter.DATA");this.extraFiltersData=a||{};var b={};if(null!=a&&("0"!==a.stars||"-10"!==a.rating||a.price&&a.price.max!==a.price.min||null!=a.priceType)){if("0"!==a.stars){b.stars={};var c=parseInt(a.stars);[0,2,3,4,5].forEach(function(a){b.stars[a]=a>=c?1:0})}if("-10"!==a.rating){b.rating={};var e={horrible:20,mediocre:40,
okay:60,good:80,excellent:100},g;for(g in e)if(e.hasOwnProperty(g)){var k=parseInt(a.rating);b.rating[g]=k<=e[g]?1:0}}a.price&&a.price.max!==a.price.min&&(b.price={min:parseInt(a.price.min),max:parseInt(a.price.max)});null!=a.priceType&&(b.priceType={code:a.priceType})}this.advancedFilterState=b},syncFilters:function(){var a=this;this.getExtraFilterData();this.advancedFilterState&&Object.keys(this.advancedFilterState).forEach(function(b){d.events.publish("resultspage.filters.sync",{name:b,state:a.advancedFilterState[b]})})},
serialize:function(){var a=this.base(),b,c;this.options.useLegacyDatePicker?(b=moment(this.daterangePicker.getStartDate()),c=moment(this.daterangePicker.getEndDate())):(b=moment(this.checkIn.getDate()),c=moment(this.checkOut.getDate()));this.getExtraFilterData();var f;this.options.hotelTravelersDropdownEnabled?f=d.question.ask(this.travelersDataQuestion+this.id("form")):(f={adults:this.adults.getValue(),children:this.children.getValue()},e.extend(f,{rooms:this.rooms.getValue()}));this.advancedFilterState&&
this.advancedFilterState.hasOwnProperty("priceType")&&this.advancedFilterState.priceType.code&&(a.priceType=this.advancedFilterState.priceType.code);a.goToHotelDetailsPage=this.options.goToHotelDetailsPage&&this.smartyItemChanged;e.extend(a,{locationType:this.locationType,location:this.location.val(),cityId:this.cityId.val(),landmarkId:this.landmarkId.val(),hotelId:this.hotelId.val(),checkInDate:b.format(this._dateFormat),checkOutDate:c.format(this._dateFormat),freeRegionId:this.freeRegionId.val(),
amenity:this.amenity,regionId:this.regionId.val(),countryId:this.countryId.val(),neighbourhoodId:this.neighbourhoodId.val(),neighbourhood:this.neighbourhood,ambiance:this.ambiance,address:this.address.val(),searchType:"C",citycode:this.cityId.val(),applyFilters:!0,filterState:JSON.stringify(this.advancedFilterState)},f);this.options.addHtcPlaceParams&&e.extend(a,{placeName:this.placeName.val(),placeId:this.placeId.val()});this.locationType!==l.address&&this.hasLocationId()||e.extend(a,{searchType:"A",
address:this.location.val()});return a},serializeForCompareTo:function(){var a=this.serialize();delete a.checkInDate;delete a.checkOutDate;this.options.useLegacyDatePicker?(a.checkin_date=moment(this.daterangePicker.getStartDate()).format(d.globals.apiDateFormat),a.checkout_date=moment(this.daterangePicker.getEndDate()).format(d.globals.apiDateFormat)):(a.checkin_date=moment(this.checkIn.getDate()).format(d.globals.apiDateFormat),a.checkout_date=moment(this.checkOut.getDate()).format(d.globals.apiDateFormat));
a.lmid=a.landmarkId;a.hid=a.hotelId;a.frid=a.freeRegionId;a.rid=a.regionId;a.cid=a.countryId;a.nhid=a.neighbourhoodId;return a},load:function(a){a.hasOwnProperty("searchDialog")&&a.searchDialog&&this.resetFieldsForSearchDialog();a.locationType&&(this.locationType=a.locationType);a.locationName&&this.cityName.val(a.locationName);a.location&&this.location.val(a.location);a.cityId&&this.cityId.val(a.cityId);a.landmarkId&&this.landmarkId.val(a.landmarkId);a.hotelId&&this.hotelId.val(a.hotelId);a.freeRegionId&&
this.freeRegionId.val(a.freeRegionId);a.regionId&&this.regionId.val(a.regionId);a.countryId&&this.countryId.val(a.countryId);a.neighbourhoodId&&this.neighbourhoodId.val(a.neighbourhoodId);this.hcPlacesEnabled&&(a.entityKey&&this.placeName.val(a.entityKey),a.objectID&&this.placeId.val(a.objectID));if(a.checkInDate){var b=moment(a.checkInDate,this._dateFormat);b.isValid()&&(this.options.useLegacyDatePicker?this.daterangePicker.setStartDate(b):this.checkIn.setDate(b))}a.checkOutDate&&(b=moment(a.checkOutDate,
this._dateFormat),b.isValid()&&(this.options.useLegacyDatePicker?this.daterangePicker.setEndDate(b):this.checkOut.setDate(b)));a.rooms&&d.events.publish("hotels.frontdoor.rooms.onChange",e.extend({namespace:this.id()},a));"undefined"===typeof a.guests&&"undefined"===typeof a.adults&&"undefined"===typeof a.children||d.events.publish("hotels.frontdoor.guests.onChange",e.extend({namespace:this.id()},a));this.options.hotelTravelersDropdownEnabled&&this.options.specifyChildAges&&"undefined"!==typeof a.childrenAges&&
d.events.publish("hotels.frontdoor.childrenAges.onChange",e.extend({namespace:this.id()},a));a.urlParams&&(this.options.urlParams=a.urlParams);a.stars&&(this.options.stars=a.stars);this.options.hotelTravelersDropdownEnabled||(this.refreshRoomsGuestsDropdownDisplay(),this.updateBoxButtonStates())},resetFieldsForSearchDialog:function(){this.options.keepLocation||(this.locationType="",this.location.val(""),this.cityId.val(""),this.cityName.val(""),this.landmarkId.val(""),this.hotelId.val(""),this.address.val(""));
this.freeRegionId.val("");this.regionId.val("");this.countryId.val("");this.neighbourhoodId.val("")},getCookieData:function(){var a=this.base();this.options.isDisabledAdvanced||(this.extraFiltersData.price&&(a.filterMinPrice=this.extraFiltersData.price.min,a.filterMaxPrice=this.extraFiltersData.price.max),a.filterPriceType=this.extraFiltersData.priceType,a.filterMinStars=this.extraFiltersData.stars,a.filterMinGuestRating=this.extraFiltersData.rating);return a},loadFromHistory:function(a){this.options.useLocalStorageHistory&&
this.base(a);a=this.localHistory.reduceTravelersObjectToTotal();0<a&&(a={guests:a,rooms:Math.min(Math.max(this.rooms.getValue(),Math.ceil(a/4)),a)},this.load(a))},getStorageProps:function(){return"checkInDate checkOutDate location locationType cityId landmarkId hotelId rooms guests searchType".split(" ")},buildSearchURL:function(a){if(this.options.useLegacySearchUrl)return this.legacyBuildSearchUrl(a);d.storage.remove("hotels.results.saveToTrips.tripId");var b={urlPrefix:d.config.getString("ui.hotels.searchUrlPath",
"hotels").replace(/\//g,""),location:a.location,ctid:a.cityId,frid:a.freeRegionId,srid:a.subRegionId,rid:a.regionId,cid:a.countryId,hid:a.hotelId,lmid:a.landmarkId,nhid:a.neighbourhoodId,adults:a.adults,children:a.children,childAges:a.childrenAges,rooms:a.rooms,checkin:a.checkInDate,checkout:a.checkOutDate,address:a.address,amenity:a.amenity,minStars:a.minStars,stars:this.options.stars,view:d.question.ask("hotels.resultspage.pageView"),goToHotelDetailsPage:this.options.goToHotelDetailsPage,smartyItemChanged:this.smartyItemChanged,
fromRatesTable:a.detailsPage,useFullSearchUrl:d.globals&&d.globals.useFullSearchUrl};this.options.addHtcPlaceParams&&(b.placeName=a.placeName,b.placeId=a.placeId);return d.hotels.search.HotelSearchFormUrls.generateUrl(b,this.getSearchFormFilterState())},getSearchFormFilterState:function(){return e.extend({},this.searchFormFilterState)},legacyBuildSearchUrl:function(a){d.storage.remove("hotels.results.saveToTrips.tripId");var b=[d.config.getString("ui.hotels.searchUrlPath","hotels").replace(/\//g,
"")],c=a.location,f=[],h="-c%s";this.options.isRegionSearchEnabled&&this.isRegionSearch(a)&&!a.preserveFilters&&b.push("region");var k=a.address||"";g(k)||(c=k,-1==k.indexOf(a.location)&&(c+=","+a.location),h="-a%s");void 0!==c&&(c=c.replace("/",""));f.push(d.utils.search.encodeLocation(c));g(a.freeRegionId)?g(a.regionId)?g(a.countryId)?g(a.cityId)||f.push(h.format(a.cityId)):f.push("-u%s".format(a.countryId)):f.push("-r%s".format(a.regionId)):f.push("-e%s".format(a.freeRegionId));g(a.hotelId)?g(a.landmarkId)?
g(a.neighbourhoodId)||f.push("-n%s".format(a.neighbourhoodId)):f.push("-l%s".format(a.landmarkId)):(f.push("-h%s".format(a.hotelId)),(this.options.goToHotelDetailsPage&&this.smartyItemChanged||a.detailsPage)&&f.push("-details"));g(a.amenity)||f.push("-f%s".format(a.amenity));b.push(f.join(""));g(a.checkInDate)||g(a.checkOutDate)||(b.push(a.checkInDate),b.push(a.checkOutDate));a.adults&&b.push("%sadults".format(a.adults));a.children&&(this.options.specifyChildAges&&this.options.hotelTravelersDropdownEnabled&&
a.childrenAges?b.push("%schildren-%s".format(a.children,a.childrenAges)):b.push("%schildren".format(a.children)));1<a.rooms&&b.push("%srooms".format(a.rooms));b=b.join("/");c={};g(a.neighbourhood)?g(a.ambiance)||(c=e.extend(c,{ambiance:a.ambiance,filterType:"A"})):c=e.extend(c,{neighborhood:a.neighbourhood,filterType:"N"});if(!g(this.options.urlParams))try{c=e.extend(c,JSON.parse(this.options.urlParams))}catch(p){}this.options.isRegionSearchEnabled&&a.preserveFilters&&this.options.multiCityIds&&this.isRegionSearch(a)&&
(c=e.extend(c,{ids:this.options.multiCityIds}));e.isEmptyObject(c)||(b+="?"+e.param(c));return b},submitPreload:function(a){if(d.config.getBoolean("ui.submitpreload")&&!this.loadingHistory){var b=this.serialize()||{};b.changed_field=a;b["rooms-input"]=b.rooms;b["guests-input"]=b.guests;b.checkin_date=moment(b.checkInDate,this._dateFormat).format(d.globals.apiDateFormat);b.checkout_date=moment(b.checkOutDate,this._dateFormat).format(d.globals.apiDateFormat);d.action.execute("common.search.PreloadAction",
b)}},validate:function(){var a=this.options.useLegacyDatePicker?this.daterangePicker.getStartDate():this.checkIn.getDate(),b=this.options.useLegacyDatePicker?this.daterangePicker.getEndDate():this.checkOut.getDate();if(!this.options.isSingleHotel&&!this.hasLocationId()&&!this.location.val())return this.options.msg.city;if(null===a)return this.options.msg.checkinDate;if(null===b||moment(a).isAfter(moment(b).subtract(1,"day")))return this.options.msg.checkoutDate;if(g(this.location.val()))return this.options.msg.location;
if(this.options.hasSubscriptionPanel&&(a=this.notValidSubscription())&&a.length)return a},isEnoughInformationForCompareToRequest:function(){if(this.options.loadCmp2WhenVisible&&!this.element.is(":visible"))return!1;var a=this.hasLocationId()||!g(this.locationType);return!this.options.suppressCmp2s&&a&&void 0===this.validate()},setYandexTracking:function(){if(window.yaCounter16685854)try{yaCounter16685854.reachGoal("Hotel_Search_Button_Click")}catch(a){}},toggleAdvanced:function(a){this.shouldUpdate(a)&&
(this.options.showNeedIdeasButton&&(!0===a.state?this.needIdeasButton.addClass("hidden"):this.needIdeasButton.removeClass("hidden")),this.element.toggleClass("Advanced",a.state))},refreshRoomsGuestsDropdownDisplay:function(){var a=d.Common.Utils.String.formatChoice(this.options.msg.roomsChoiceLabel,this.rooms.getValue(),this.rooms.getValue()),b=this.adults.getValue()+this.children.getValue(),b=d.Common.Utils.String.formatChoice(this.options.msg.guestsChoiceLabel,b,b);this.roomsGuestsDropdown.updateLabel(a,
b,", ");this.updateHotelPlanner(this.rooms.getValue())},getCompareToFormData:function(){var a=this.serializeForCompareTo();return e.extend({vertical:this.vertical},a)},submitIntentMedia:function(){"function"===typeof this.intentMediaCallOnSubmit&&this.intentMediaCallOnSubmit.call(null,this.serialize())},updateHotelPlanner:function(a){0<this.options.hotelPlannerTrigger&&(a>=this.options.hotelPlannerTrigger?this.hotelPlanner.addClass("visible"):this.hotelPlanner.removeClass("visible"))},showTooltip:function(a,
b){a.toolTip({content:b,position:"right",showImmediately:!0})},clearTooltips:function(){this.rooms.incrButton.data("toolTip")&&this.rooms.incrButton.data("toolTip").removeWidget();this.guests&&this.guests.incrButton.data("toolTip")&&this.guests.incrButton.data("toolTip").removeWidget();this.children&&this.children.incrButton.data("toolTip")&&this.children.incrButton.data("toolTip").removeWidget();this.adults&&this.adults.incrButton.data("toolTip")&&this.adults.incrButton.data("toolTip").removeWidget()},
needIdeas:function(){var a=e(".destinationTiles");e("html, body").animate({scrollTop:a.offset().top-10},1200);d.Analytics.api.trackEvent("hotels/form/needidesbutton")},autofocus:function(){this.options.autofocusDestination&&this.location.focus()},getStorageExceptions:function(){},isValidDates:function(){if(!this.options.useLegacyDatePicker&&this.checkIn&&0===this.checkIn.getValue()){var a=1,b=2;d&&d.config&&(a=d.config.getInt("ui.horizon.hotels.search.form.checkIn.date.adjustment",a),b=d.config.getInt("ui.horizon.hotels.search.form.checkOut.date.adjustment",
b));a=moment().startOf("day").add(a,"d");b=moment().startOf("day").add(b,"d");b={id:this.id(),checkInDate:a,checkOutDate:b,silent:!0};d.events.publish("hotels.frontdoor.form.dates",b)}},hasLocationId:function(){return[this.hotelId,this.cityId,this.neighbourhoodId,this.regionId,this.freeRegionId,this.landmarkId,this.countryId].some(function(a){return null!==a&&!g(a.val?a.val():a)})},getSearchType:function(){var a=this.serialize();if(this.address&&this.address.val())return"addr";for(var b=0;b<m.length;b++){var c=
m[b];if(!g(a[c]))return l[c]}return"addr"},getLocationId:function(){var a=this.getSearchType();return"hood"===a?this.neighbourhoodId:this[n[a]].val()},focusFirstElement:function(){this.location.get(0).focus()}})})(window.R9,window.jQuery);(function(c,d,k){c.createComponentClass("hotels.search.HotelInlineSearchForm","hotels.search.HotelSearchForm",{formQuestion:"hotels.rp.searchform",formLocationQuestion:"hotels.rp.searchform.location",formCitycodeQuestion:"hotels.rp.searchform.citycode",formCitynameQuestion:"hotels.rp.searchform.cityname",numNightsQuestion:"hotels.rp.searchform.numNights",daysOutQuestion:"hotels.rp.searchform.daysOut",priceDropdownWidget:null,startingForm:null,cmp2ChangeOnly:!1,streamingLabel:null,hotelLabel:null,
preserveFilters:!1,cmp2dirty:null,wrapper:null,priceAlertWrapper:null,detailsPage:null,options:{displayOverlay:!0,priceTypeEnabled:!1,refactorDropdown:!1,dayOfWeekEnabled:!1,tempHotelLabel:!1,singleHotel:!1,pinnable:!1,useSearchIcons:!1,preserveFiltersOnSearchChange:!1,footerDisclaimersEnabled:!1,hotelTravelersDropdownEnabled:!1,specifyChildAges:!1,useCmp2Submit:!1,searchId:"",fullWidthMap:!1,harmonizePriceAlertStyle:!1,msg:{roomsDisplayLabel:"",guestsDisplayLabel:"",footerDisclaimer:"",footerNights:"",
footerRooms:""}},init:function(){this.options.useHistory=!1;this.base();this.options.autoOpenDatepicker&&this.startFocusDates();this.filteredCount=this.getChildElement("filtered");this.cmp2dirty=this.getChildElement("cmp2dirty");this.totalCount=this.getChildElement("totalCount");this.totalContainer=this.getChildElement("total");this.detailsPage=this.getChildElement("detailsPage");c.config.getBoolean("ui.skip-fd.enabled",!1)&&(this.lastAirportCode=this.getChildElement("lastAirportCode")[0].value,this.locationAirportCode=
this.getChildElement("locationAirportCode")[0].value);this.options.priceTypeEnabled&&this.bindPriceTypeDropdown();this.startingForm=this.serialize();this.streamingLabel=this.getChildElement("tempHotelLabel");this.hotelLabel=this.getChildElement("hotelLabel");this.wrapper=this.getChildElement("wrapper");this.priceAlertWrapper=this.getChildElement("inlinePriceAlertBannerWrapper")},addEventHandlers:function(){this.base();var a=this,b=d(document),l=this.getChildElement("counts").find("a.showAll").eq(0);
this.subscribe("cmp2.input.stateChanged",function(b){a.cmp2dirty.val(1);a.setFormChangedState(!0)});if(this.options.displayOverlay){var e=function(b){a.element.is(".FormView")&&!a.options.forceOpen&&0===d(b.target).closest(".R9-Overlay").length&&a.setView("Display")},g=function(){b.off("mousedown",e);setTimeout(function(){b.on("mousedown",e)},50)};if(this.location&&this.location.getWidget()){var f="";this.location.getWidget().setOption("beforeStart",function(){f=a.location.val();b.off("mousedown",
e);a.element.off("mousedown",g)});var h=this.location.getWidget().options.afterDone;this.location.getWidget().setOption("afterDone",function(){h.call(this,arguments);setTimeout(function(){b.on("mousedown",e);a.element.on("mousedown",g)},f!==a.location.val()?500:0);f=a.location.val()})}l.length&&l.click(function(){g()});this.getChildElement("display").on("click",function(b){0===d(b.target).closest("#"+a.id("counts")+" a.showAll").length&&a.setView("Form")});this.getChildElement("display-location").on("click",
function(b){a.setView("Form");a.getChildElement("location").focus()});b.on("mousedown",e);a.element.on("mousedown",g)}this.subscribe(["hotel.inline.search.form.show","rental.inline.search.form.show"],function(b){a.setView("Form");b.focus&&(a.dateRangeInput?a.dateRangeInput.focus():a.checkIn.focus())});this.getChildElement("change").on("click",function(){a.setView("Form")});this.subscribe(["hotel.inline.search.form.setview","rental.inline.search.form.setview"],function(b){a.setView(b)});c.events.subscribe(["searchform.submit",
"cmp2.submit","inline.update.view"],function(b){a.correctForSameDay(b);a.load(b);a.updateDisplayView();a.startingForm=a.serialize()});c.config.getBoolean("ui.skip-fd.enabled",!1)&&c.events.subscribe("SkipFdUrlRewriter.locationResolved",function(b){a.locationAirportCode=b});this.subscribe("hotels.results.form.priceType",d.proxy(this.onChange,this));this.subscribe("hotels.frontdoor.form.rooms hotels.frontdoor.form.guests hotels.frontdoor.form.guests.adults hotels.frontdoor.form.guests.children hotels.frontdoor.form.guests.childAge hotels.frontdoor.form.dates hotels.frontdoor.form.traveler hotels.frontdoor.form.all".split(" "),
{id:this.id()},d.proxy(this.updateFooter,this));this.options.tempHotelLabel&&(this.subscribe("resultspage.streaming.start",function(b){a.hotelLabel.addClass("hidden");a.streamingLabel.removeClass("hidden")}),this.subscribe("resultspage.streaming.done",function(){a.hotelLabel.removeClass("hidden");a.streamingLabel.addClass("hidden")}));if(this.options.aboveGrid||this.options.useSearchIcons)this.onVisible(function(){var c=function(b){if(0===d(b.target).closest(".R9-Overlay, .js-overlay").length)a.onPinnableClickOut(!0)};
b.on("click",c);a.handleSmartyPinnable(c)});if(this.options.pinnable)this.onVisible(function(){a.subscribe("pinnableBar.pinnedChange",function(b){a.pinned=b})});this.options.hotelTravelersDropdownEnabled||this.answer("hotel-rooms-selected",function(){return a.rooms.getValue()});this.bindFormChangedState();this.subscribe("hotels.results.dualViewMap.open",this.onMapViewToggle.bind(this,!0));this.subscribe("hotels.results.dualViewMap.closed",this.onMapViewToggle.bind(this,!1));this.options.useCmp2Submit&&
(this.subscribe("cmp2.rendering.finished",function(b){a.element.toggleClass("cmp2-ready",!!(b&&b.items&&b.items.length))}),this.subscribe("cmp2.hidden",{visible:!1},function(){a.element.removeClass("cmp2-ready")}),this.subscribe("resultspage.cleanup",function(){c.events.publish("cmp2.cleanUp",{id:a.id()})}))},inlineComponentsReady:function(){this.base();this.options.priceTypeEnabled&&this.getPriceTypeFromHistory();this.loadCompareToItems();this.updateFooter()},isEnoughInformationForCompareToRequest:function(){if(this.options.useCmp2Submit)return this.options.loadCmp2InEditModeOnly&&
!this.checkFormChanges()||this.options.loadCmp2WhenVisible&&!this.element.is(":visible")?!1:!this.options.suppressCmp2s&&!this.validate()},startFocusDates:function(){var a=this;d(".keel").addClass("focus-dates");this.options.useLegacyDatePicker||(this.checkIn.element.addClass("focused"),this.checkIn.element.closest(".Common-Widgets-Datepicker-DateRangeInput").addClass("focused"));d(document).off("keydown.focusdates").on("keydown.focusdates",function(b){27===b.which&&a.stopFocusDates(b)});d(document).off("click.focusdates").on("click.focusdates",
function(b){var c=d(b.target);(!a.element.find(c).length&&!c.closest(a.datePicker.element).length||c.closest(".searchButton").length)&&a.stopFocusDates(b)})},stopFocusDates:function(a){a&&a.originalEvent&&(d(document).off("keydown.focusdates","click.focusdates"),d(".keel").removeClass("focus-dates"),this.onPinnableClickOut(!1),this.checkIn&&this.checkIn.dismissDatePicker&&this.checkIn.dismissDatePicker())},handleSmartyPinnable:function(a){var b=this,c=d(document),e="";if(this.location&&this.location.getWidget()){var g=
this.location.getWidget().options.beforeStart;this.location.getWidget().setOption("beforeStart",function(){g&&g.call(this,arguments);e=b.location.val();c.off("click",a)});var f=this.location.getWidget().options.afterDone;this.location.getWidget().setOption("afterDone",function(){f&&f.call(this,arguments);setTimeout(function(){c.on("click",a)},e!==b.location.val()?500:0);e=b.location.val()})}},onInternalChange:function(a){this.base(a);c.config.getBoolean("ui.skip-fd.enabled",!1)&&this.checkFormChanges()&&
(a.cityId||a.countryId)&&(new c.common.utils.SkipFdUrlRewriter).resolveAirportCode(a.cityId,a.countryId)},bindAdvancedFilter:function(){return!1},bindLocationField:function(){this.options.singleHotel?this.setupLocationFields():this.base()},bindFormChangedState:function(){var a=this.setFormChangedState.bind(this,!0);this.subscribe("smarty.setitem.complete",{id:this.id("location")},a);this.subscribe("DatePicker.update",{action:"change",group:this.id("travelDates")},a);this.subscribe(["hotels.frontdoor.form.rooms",
"hotels.frontdoor.form.guests.adults","hotels.frontdoor.form.guests.children","hotels.frontdoor.form.guests.childAge"],a)},updateFooter:function(){if(this.options.footerDisclaimersEnabled){var a=this.calculateNumNights(),a=k.formatChoice(this.options.msg.footerNights,a,a),b=k.formatChoice(this.options.msg.footerRooms,this.getRoomsValue(),this.getRoomsValue());c.events.publish("footer.update.rp.disclaimer",{message:k.formatString(this.options.msg.footerDisclaimer,a,b)})}},getRoomsValue:function(){var a=
"";if(this.options.hotelTravelersDropdownEnabled){var b=this.getTravelersData();b&&b.rooms&&(a=b.rooms)}else a=this.rooms.getValue();return a},getTravelersData:function(){return c.question.ask(this.travelersDataQuestion)},serialize:function(){var a=this.base();this.options.priceTypeEnabled?d.extend(a,{priceType:this.priceDropdownWidget.getValue()}):d.extend(a,{priceType:c.question.ask("results.priceType")});d.extend(a,{preserveFilters:this.preserveFilters,detailsPage:this.detailsPage.val()});c.config.getBoolean("ui.skip-fd.enabled",
!1)&&d.extend(a,{lastAirportCode:this.lastAirportCode,locationAirportCode:this.locationAirportCode});return a},getStorageExceptions:function(){return this.preserveFilters?["preserveFilters"]:null},load:function(a){this.base(a);a.priceType&&this.options.priceTypeEnabled&&(a=a.priceType,this.priceDropdownWidget.setValue(a),c.events.publish("resultsHeader.changed",{tab:"hotels",rooms:this.getRoomsValue(),priceType:a}))},setView:function(a){this.options.displayOverlay&&("Display"===a?(this.element.removeClass("FormView"),
this.disableSearchButton()):"Form"===a?(this.element.addClass("FormView"),this.enableSearchButton()):this.element.removeClass("FormView"),this.options.displayOverlay&&(this.getChildElement("searchform").attr("aria-hidden","Form"!==a),this.getChildElement("display").attr("aria-hidden","Display"!==a),this.getChildElement("change").attr("aria-pressed","Display"!==a)),c.Analytics.api.trackEvent("%s/searchform/view/%s".format(this.options.loggingPrefix,a)))},focusFormAfterDisplayView:function(a){if(a){a=
d(a);var b=this,c;a.is(this.getChildElement("display-location"))?c=function(){b.location&&b.location.focus&&b.location.trigger&&b.location.focus().trigger("mousedown")}:a.is(this.element.find(".checkInContainer").children())?c=function(){b.checkIn&&b.checkIn.focus?b.checkIn.focus():b.daterangePicker&&b.daterangePicker.startWrapper&&b.daterangePicker.startWrapper.trigger&&b.daterangePicker.startWrapper.focus().trigger("mousedown")}:a.is(this.element.find(".checkOutContainer").children())?c=function(){b.checkOut&&
b.checkOut.focus?b.checkOut.focus():b.daterangePicker&&b.daterangePicker.endWrapper&&b.daterangePicker.endWrapper.trigger&&b.daterangePicker.endWrapper.focus().trigger("mousedown")}:a.is(this.element.find(".roomGuestContent").children())?c=function(){var a=b.getChildElement("roomsGuestsDropdown");a&&a.getWidget&&a.getWidget().open&&a.getWidget().open()}:a.is(this.element.find(".priceTypeContent").children())&&(c=function(){b.getChildElement("priceType").children("select").first().focus()});c&&(this.focusSearchFormTID&&
clearTimeout(this.focusSearchFormTID),this.focusSearchFormTID=setTimeout(c,200))}},updateDisplayView:function(){if(this.options.displayOverlay){var a=this.serialize(),a={checkInDate:moment(a.checkInDate,this._dateFormat).format(this.options.displayDateFormat),checkOutDate:moment(a.checkOutDate,this._dateFormat).format(this.options.displayDateFormat),location:a.location,rooms:a.rooms,guests:a.adults+a.children,roomsLabel:c.Common.Utils.String.formatChoice(this.options.msg.roomsDisplayLabel,a.rooms,
a.rooms),guestsLabel:c.Common.Utils.String.formatChoice(this.options.msg.guestsDisplayLabel,a.guests,a.guests),priceType:this.formatPriceTitle(),checkInLabel:moment(a.checkInDate,this._dateFormat).format("dddd"),checkOutLabel:moment(a.checkOutDate,this._dateFormat).format("dddd")},b;for(b in a)a.hasOwnProperty(b)&&d("[data-disp-%s]".format(b),this.element).html(a[b])}},correctForSameDay:function(a){if(a.checkInDate&&a.checkOutDate){var b=moment(a.checkInDate,this._dateFormat),c=moment(a.checkOutDate,
this._dateFormat);0===b.diff(c,"days")&&(a.checkOutDate=b.add(1,"days").format(this._dateFormat))}},bindPriceTypeDropdown:function(){var a=this,b=this.options.useSelectWidget?"r9Select":"dropdown";this.priceDropdownWidget=this.getChildElement("priceType")[b]({change:function(b){b&&c.events.publish("hotels.results.form.priceType",{id:a.id(),priceType:this.getValue()})}}).getWidget();this.subscribe("hotels.results.form.priceType",this.onInternalChange.bind(this));(b=this.getChildElement("price-tooltip"))&&
b.toolTip({content:b.data("message"),showImmediately:!1})},formatPriceTitle:function(){if(this.options.priceTypeEnabled){if(this.options.useSelectWidget){var a=this.priceDropdownWidget.getText();return a.includes(":")?a.split(":")[1].trim():a}return this.options.refactorDropdown?(a="option[value\x3d"+this.priceDropdownWidget.getValue()+"]",this.priceDropdownWidget.element.find(a).attr("data-title")):this.priceDropdownWidget.element.find("select").attr("title").split(":")[1]}return""},onSubmit:function(a){this.checkFormChanges()?
(this.base(a),c.events.publish("inlineSearchFormUpdated",this.serialize()),this.validate()||(this.options.displayOverlay?(this.updateDisplayView(),this.setView("Display")):this.enableSearchButton(),this.startingForm=this.serialize())):(c.events.publish("filter.reset",{name:"price"}),a={tab:"hotels",rooms:this.getRoomsValue(),refreshResults:!0},this.options.priceTypeEnabled&&d.extend(a,{priceType:this.priceDropdownWidget.getValue()}),c.events.publish("resultsHeader.changed",a),this.options.displayOverlay?
(this.updateDisplayView(),this.setView("Display")):this.enableSearchButton());this.cmp2dirty.val(0);this.setFormChangedState(!1);this.cmp2ChangeOnly&&c.events.publish("resultspage.simulate.changed",{searchId:this.options.searchId});if(this.options.pinnable||this.options.useSearchIcons)this.onPinnableClickOut(!0);this.setEditMode(!1)},syncFilters:function(){this.options.preserveFiltersOnSearchChange||this.base()},checkFormChanges:function(){var a=this.serialize();this.cmp2ChangeOnly=!1;if(a&&this.startingForm){var b=
a.location===this.startingForm.location,d=a.checkInDate===this.startingForm.checkInDate,e=a.checkOutDate===this.startingForm.checkOutDate,g=1!=a.cmp2dirty,f;f=a.adults===this.startingForm.adults&&a.children===this.startingForm.children;this.options.specifyChildAges&&(f=f&&a.childrenAges===this.startingForm.childrenAges);var h=a.rooms===this.startingForm.rooms,a=this.options.priceTypeEnabled&&"undefined"===typeof a.priceType;b&&g||c.events.publish("hotels.search.location.changed");b&&d&&e&&f&&h&&!a&&
!g&&(this.cmp2ChangeOnly=!0);if(b&&d&&e&&f&&h&&g&&!a)return!1;this.preserveFilters=this.options.preserveFiltersOnSearchChange&&b}return!0},getPriceTypeFromHistory:function(){var a=c.storage.get("hotels.frontdoor.filter.HotelFrontDoorAdvancedFilter");a&&a.hasOwnProperty("priceType")&&(this.priceDropdownWidget.setValue(a.priceType),this.updateDisplayView(),c.events.publish("resultsHeader.changed",{priceType:a.priceType}))},onMapViewToggle:function(a){this.element.toggleClass("AboveFilters",a);this.options.fullWidthMap&&
this.element.toggleClass("fullWidth",a);this.options.harmonizePriceAlertStyle&&this.priceAlertWrapper&&this.priceAlertWrapper.toggleClass("hidden",!a)},editMode:!1,submitMode:!1,hovered:!1,pinned:!1,onPinnableClickOut:function(a){a||this.autoSubmit()},setEditMode:function(a){var b=this;a?(setTimeout(function(){b.editMode=!0},300),this.element.addClass("edit-mode"),this.submitButton.attr("aria-label",this.options.msg.accessibilityEditSearch)):(this.editMode=!1,this.element.removeClass("edit-mode"),
this.submitButton.attr("aria-label",this.options.msg.accessibilitySubmitSearch))},onVisible:function(a){var b=c.question.ask("SearchPage.view");"function"===typeof a&&(null===b||"RP"===b?a.call(this):this.subscribe("resultspage.routed",a.bind(this)))}})})(R9,jQuery,R9.Common.Utils.String);(function(c,d){c.createComponentClass("common.results.MapToggle",{showMapText:null,showListText:null,closeOnToggleClick:!1,mapText:null,listText:null,toggleDebounce:!1,options:{mapVisible:!1,mapSamePage:!1,mapUrl:"",updateUrl:!1,showMapEvent:"results.showMapView",showListEvent:"results.showListView",openEvent:"results.map.opened",closeEvent:"results.map.closed",includeHeaderInMap:!1,mapVersionCode:"fullscreen",showOnMapSearchFailed:!1,showOnlyWhenFiltersVisible:!1,hideMapForRegionSearch:!1,dualReactMapEnabled:!1},
init:function(){this.showMapText=this.getChildElement("map");this.showListText=this.getChildElement("list");if("dualview"===this.options.mapVersionCode||"fullscreendrawer"===this.options.mapVersionCode)this.mapText=this.showMapText.find(".text").text(),this.listText=this.showListText.find(".text").text()},addEventHandlers:function(){var a=this;this.element.on("click",this.handleMapToggle.bind(this));this.subscribe("results.mapToggle.toggle",this.handleMapToggle.bind(this));this.options.mapSamePage||
(this.subscribe(this.options.openEvent,this.receiveUpdate.bind(this,!0)),this.subscribe(this.options.closeEvent,this.receiveUpdate.bind(this,!1)));this.options.showOnlyWhenFiltersVisible?this.subscribe("resultspage.filters.show",this.show.bind(this)):this.subscribe("resultspage.filtersData.changed",this.show.bind(this));this.subscribe("search.startSearch",function(b){"undefined"!==typeof b&&b.preserveFilters||a.hide()});this.subscribe("search.searchFailed",function(b){"undefined"!==typeof b&&b.preserveFilters||
(a.options.showOnMapSearchFailed&&a.options.mapVisible?(a.closeOnToggleClick=!0,a.show()):a.hide())});this.subscribe("resultspage.isRegionSearch",function(b){a.options.hideMapForRegionSearch&&a.element.toggleClass("hidden-for-region",b.isRegionSearch)});this.subscribe("filters.disabled",this.setDisabled.bind(this));this.subscribe("searchform.submit",function(b){a.options.mapUrl=b.url;a.element.prop("href","/"+b.url+";map")});c.question.forget("results.mapToggle.isMapVisible");this.answer("results.mapToggle.isMapVisible",
function(){return a.options.mapVisible});c.question.forget("results.mapToggle.includeHeaderInMap");this.answer("results.mapToggle.includeHeaderInMap",function(){return a.options.includeHeaderInMap});if("dualview"===this.options.mapVersionCode||"fullscreendrawer"===this.options.mapVersionCode)this.subscribe("results.showMapEvent",this.toggleDualViewMap.bind(this,!0)),this.subscribe("results.showListEvent",this.toggleDualViewMap.bind(this,!1)),this.subscribe("results.mapToggle.syncState",function(b){b&&
b.hasOwnProperty("isMapOpen")&&a.toggleDualViewMap(b.isMapOpen)})},toggleDualViewMap:function(a){var b=this;this.options.mapVisible=a;this.updateBrowserHistory(a);setTimeout(function(){b.toggleMapIconText(!a)},this.options.dualReactMapEnabled?0:400)},handleMapToggle:function(a){var b=this;d("body").click();this.closeOnToggleClick&&this.options.showOnMapSearchFailed&&this.options.mapVisible&&(this.closeOnToggleClick=!1,this.hide());"dualview"===this.options.mapVersionCode||"fullscreendrawer"===this.options.mapVersionCode?
(this.toggleDebounce||(this.toggleDebounce=!0,setTimeout(function(){b.toggleDebounce=!1},400),this.publishEvent(!this.options.mapVisible)),a&&a.preventDefault()):this.options.mapSamePage||(this.publishEvent(!this.options.mapVisible),a&&a.preventDefault())},publishEvent:function(a){a!==this.options.mapVisible&&(a?(c.events.publish(this.options.showMapEvent,{includeHeader:this.options.includeHeaderInMap}),c.events.publish("results.showMapEvent")):(c.events.publish(this.options.showListEvent),c.events.publish("results.showListEvent")))},
receiveUpdate:function(a){this.options.mapVisible=a;this.options.mapVisible?d(this.element).addClass("mapVisible"):d(this.element).removeClass("mapVisible");this.showListText.attr("aria-hidden",!this.options.mapVisible);this.showMapText.attr("aria-hidden",this.options.mapVisible)},toggleMapIconText:function(a){a?this.showMapText.find(".text").text(this.mapText):this.showMapText.find(".text").text(this.listText)},hide:function(){d(this.element).addClass("hidden").attr("aria-hidden",!0)},show:function(){d(this.element).removeClass("hidden").attr("aria-hidden",
!1)},setDisabled:function(a){this.element.toggleClass("disabled",a).attr("aria-disabled",a)},updateBrowserHistory:function(a){if(this.options.updateUrl&&void 0!==window.history.replaceState){var b=document.location.pathname.replace(/;map/g,"")+document.location.search.replace(/;map/g,"");a?window.history.replaceState({},"",b+";map"):window.history.replaceState({},"",b)}}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.results.filters.Filter",{name:null,data:null,title:null,content:null,searchCompleted:!1,options:{name:null,title:null,title2:null,collapsible:!1,collapsed:!1,isDropdown:!1,mobileView:!1,logUserInteraction:!0,logFiltersQuestion:"",loggingType:"ga",loggingPrefix:"filters",loggingAction:null,loggingLabel:null,resetInTitle:!1,triggerFilteredLabel:!1,useFilterLabelHidesReset:!1,refreshFilterPosOnCollapse:!1,hasPlaceholder:!1,infoTooltip:null,infoTooltipExtraClass:null,
showApplyAll:!1,trackEnabled:!1,showOnSearchFailed:!1,useMcFlyStyling:!1},trackingType:null,trackCategory:"filters",dirty:!1,resetButton:null,enabled:null,interactable:null,previousFilters:{},init:function(){this.data={};this.name=this.options.name;this.title=this.getChildElement("title");this.content=this.getChildElement("content");if(void 0===this.name||""===this.name)throw"Error initializing Javascript filter: a filter name was not provided";this.options.infoTooltip&&this.getChildElement("info").toolTip({content:this.options.infoTooltip,
position:"top",showImmediately:!1,extraClass:this.options.infoTooltipExtraClass});this.trackingType=this.getTrackingType();c.question.answer("filters."+this.name+".state",function(){return this.getState()}.bind(this))},inlineComponentsReady:function(){this.options.collapsible&&!this.options.collapsed&&this.element.addClass("open")},addEventHandlers:function(){var a=this;this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));var b=this.reset.bind(this);this.subscribe("filters.reset",
b);this.subscribe("filter.reset",{name:this.name},b);this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed"],function(){a.element.toggleClass("hidden",a.element.hasClass("empty"))});this.subscribe("resultspage.streaming.done",function(){a.searchCompleted=!0});this.subscribe("search.searchFailed",function(){a.options.showOnSearchFailed?a.element.removeClass("hidden"):a.element.addClass("hidden")});this.subscribe("filter.show",{name:this.name},function(){a.element.removeClass("hidden")});
this.subscribe("search.startSearch",this.onSearchStart.bind(this));this.subscribe("train.legChange.reset",function(){c.events.publish("filter.reset",{name:a.name})});(b=this.getChildElement("reset"))&&b.length&&(b.click(function(b){b.stopPropagation();a.reset({type:"reset",userClick:!0})}),b.keydown(function(b){switch(b.which){case c.globals.keyCodes.RETURN:case c.globals.keyCodes.SPACE:b.preventDefault(),a.reset({type:"reset",userClick:!0})}}));this.subscribe("filters.selectedprice",function(){a.reset.apply(a,
arguments)});b=this.getChildElement("skip");b.length&&b.click(function(b){b=d("[tabbable]:visible");var c=b.index(a.element)+1;c>=b.length&&(c=0);b.eq(c).get(0).focus()});if(this.options.collapsible){var e=function(b){var f=(b=a.element.hasClass("open"))?"hide":"show";c.Analytics.api.trackEvent({category:"Filter-Collapsible",action:f,label:a.name});a.element.toggleClass("open");a.title.attr("aria-pressed","show"===f);a.title.attr("aria-expanded","show"===f);c.globals.testMode&&a.title.attr("data-test-filter-collapsed",
b);c.events.publish("horizon.filters.opened");!0===a.options.refreshFilterPosOnCollapse&&c.events.publish("horizon.filters.FiltersDialog.itemToggled");a.isMobileView()&&(a.element.parent().addClass("hideNotOpened"),c.events.publish("horizon.mobile.FiltersDialog.itemOpened",{name:a.name,title:a.options.title}));a.options.trackEnabled&&a.trackingType&&(b?c.VestigoEvents.filters.shared.collapse(a.trackingType):c.VestigoEvents.filters.shared.expand(a.trackingType))};this.title.click(e);this.title.keypress(function(a){if(a.keyCode===
c.globals.keyCodes.RETURN||a.keyCode===c.globals.keyCodes.SPACE)return e(),!1})}this.subscribe("filters.disabled",this.setDisabled.bind(this));this.subscribe("filter.disabled",{name:this.name},function(b){a.setDisabled(b.disabled)});this.subscribe("filters.goBack",function(){a.element.removeClass("open");a.element.parent().removeClass("hideNotOpened")});this.options.triggerFilteredLabel&&this.subscribe("resultspage.results.count.changed",this.onResultsCountChanged.bind(this));c.question.forget("resultspage.filter.%s.history.view".format(this.name));
this.answer("resultspage.filter.%s.history.view".format(this.name),this.getHistoryFilterViewState.bind(this));this.subscribe("resultspage.filter.%s.history.apply".format(this.name),this.applyFilterFromHistory.bind(this));this.subscribe("resultspage.filter.%s.history.reset".format(this.name),this.reset.bind(this,{type:"reset"}));this.subscribe("resultspage.filter.%s.history.sync".format(this.name),this.syncWithHistoryPillState.bind(this));this.subscribe("filters.changed",{name:this.name},function(b){a.toggleDirtyOnAfterFiltersChanged(b)});
this.options.hasPlaceholder&&this.subscribe("filters.update.placeholderDisplay",this.updatePlaceholderDisplay.bind(this));this.subscribe("filters."+this.name+".setFromPrevious",this.onSetFromPrevious.bind(this));this.subscribe("filters."+this.name+".applyPreferences",this.onApplyPreferences.bind(this));this.options.showApplyAll&&this.registerEvent("click",this.getChildElement("applyAll"),function(b){b.stopPropagation();b.stopImmediatePropagation();a.applyAll()})},toggleDirtyOnAfterFiltersChanged:function(a){this.element.is(".Common-Results-Filters-FilterSection")||
this.element.toggleClass("isDirty",!a.reset)},onApplyPreferences:function(a){if(a||a.length)this.setStateFromPrevious(a),this.pushStateChange(null,{filterPreferenceChange:!0,changeData:{field:a.key,value:a.value,remove:a.reset}})},onSetFromPrevious:function(a){this.setStateFromPrevious(a);a.silent?this.syncFilterState(a.reset):this.pushStateChange(null,{previousFilterChange:!0,changeData:{field:a.key,value:a.value,remove:a.reset,fromPrevious:!0}});a.reset?delete this.previousFilters[a.key]:this.previousFilters[a.key]=
a.value},updatePreviousFilters:function(a){},removePreviousFilter:function(a){c.events.publish("filters.myfilters.removeFromPrevious",{name:this.name,key:a});a?delete this.previousFilters[a]:this.previousFilters={}},getResetType:function(){return!1===this.options.isMultiValueSet?"showAll":!0===this.options.isMultiValueSet?"clearAll":"custom"},pushStateChange:function(a,b,e){a=!0===a?null:e?e:this.getState();b=d.extend({name:this.name,state:a},b,{elemId:this.id()});c.events.publish("filters.changed",
b);Object.keys(this.previousFilters).length&&!b.previousFilterChange&&this.updatePreviousFilters(a);this.trackStateChange(b)},logUserInteraction:function(a){this.trackInteraction(a);if(""===this.options.logFiltersQuestion||this.logViewState(this.element))"ga"===this.options.loggingType&&"object"===typeof a?c.Analytics.api.trackEvent(a):c.Analytics.api.trackEvent("/"+this.options.loggingPrefix+"/"+this.name+(a?"/"+a:""))},logViewState:function(a){return c.question.ask(this.options.logFiltersQuestion,
{filterEl:a})},publishHoverState:function(a,b){a=d.extend({namespace:this._namespace,name:this.name,hover:a},b||{});c.events.publish("filters.%s.hovering".format(this.name),a)},toggleResetLink:function(a){var b=this.getChildElement("reset");a?(0!==b.length&&b.addClass("active"),this.element.addClass("activeReset")):(0!==b.length&&b.removeClass("active"),this.element.removeClass("activeReset"))},reset:function(a){this.willReset.apply(this,arguments);this.setLastUserInteraction(!0);this.pushStateChange(!0,
{reset:!0});a&&a.userClick&&this.logUserInteraction("reset")},updatePlaceholderDisplay:function(a){},filterDataChanged:function(a){this.element.closest(".hfilter").addClass("empty-filter");var b=d.extend({},a[this.name]);if(b.hasOwnProperty("enabled"))b.enabled?this.element.hasClass("inactive")&&this.element.removeClass("inactive"):this.element.addClass("inactive"),this.setEnabled(b.enabled),delete b.enabled;else if(!a[this.name]){Object.keys(a).length&&(this.setEnabled(!1),this.element.addClass("empty"));
return}this.dirty=b.isDirty;delete b.isDirty;this.isUserManipulated=b.isUserManipulated;c.events.publish("filter.dirty",{name:this.name,dirty:this.dirty,isUserManipulated:this.isUserManipulated});this.element.toggleClass("isDirty",this.dirty);this.toggleResetLink(this.dirty);this.options.collapsible&&!this.options.resetInTitle&&this.dirty&&this.element.addClass("open");this.options.triggerFilteredLabel&&this.lastUserInteraction&&(this.invalidateFilterLabelData?(this.invalidateFilterLabelData=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):
this.invalidateFilterLabelCount=!0);this.update(b);this.isUserManipulated&&this.syncFilterState();this.element.toggleClass("empty",!this.shouldBeVisible(b));this.element.closest(".hfilter").toggleClass("empty-filter",!this.shouldBeVisible(b));this.setLastUserInteraction(!1)},syncFilterState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a?null:this.getState()})},syncWithHistoryPillState:function(a){c.events.publish("resultspage.filters.sync",{name:this.name,state:a})},
setStateFromPrevious:function(a){},onResultsCountChanged:function(a){!isNaN(this.lastTotalFilteredCount)&&!isNaN(a.filtered)&&0<=a.filtered&&(this.lastFilterCountDiff=a.filtered-this.lastTotalFilteredCount);this.lastTotalFilteredCount=a.filtered;this.invalidateFilterLabelCount?(this.invalidateFilterLabelCount=!1,this.updateFilteredLabels(this.lastFilterCountDiff)):this.invalidateFilterLabelData=this.lastUserInteraction},updateFilteredLabels:function(a){a=parseInt(a);if(!isNaN(a)){if(this.options.useFilterLabelHidesReset){var b=
this.getChildElement("reset");b&&b.length&&b.hasClass("active")&&(this.subscribe("filter.label.cleared."+this.name,this.onFilterLabelCleared.bind(this)),this.toggleResetLink(!1))}c.events.publish("filter.label.update",{name:this.name,diff:a})}},onFilterLabelCleared:function(a){this.unsubscribe("filter.label.cleared."+a.name);this.dirty&&this.toggleResetLink(!0)},toggleAttribute:function(a){return"true"===a?"false":"true"},setLastUserInteraction:function(a){this.lastUserInteraction=a},setDisabled:function(a){c.dom.toggleOneClass(this.element,
"Disabled",a);this.element.find("[aria-disabled]").attr("aria-disabled",a);this.interactable=!a},cleanupExistingState:function(){},shouldBeVisible:function(a){return!0},willReset:function(a){},update:function(a){},applyAll:function(){},getState:function(){},isMobileView:function(){return this.options.mobileView},setEnabled:function(a){this.enabled!==a&&(this.enabled=a,c.events.publish("filter.enabled",{name:this.name,enabled:a}))},onSearchStart:function(a){this.element.removeClass("hidden");this.enabled=
null;this.searchCompleted=!1;"undefined"!==typeof a&&a.preserveFilters||(this.options.hasPlaceholder||this.element.addClass("empty"),this.cleanupExistingState())},getHistoryFilterViewState:function(){return{}},applyFilterFromHistory:function(a){if(c.config.getBoolean("ui.horizon.filters.history.enabled",!1)){var b=d.extend({},this.getState(),a);c.Analytics.api.trackEvent({category:"Filter-History",action:"Applying state From History: "+a,label:this.name});c.events.publish("filters.changed",{name:this.name,
state:b})}},getStateForFilterHistory:function(){return d.extend({},this.getState(),{displayName:this.options.title})},updateFilterHistory:function(){c.config.getBoolean("ui.horizon.filters.history.enabled",!1)&&(c.Analytics.api.trackEvent({category:"Filter-History",action:"Storing filter state in browser: ",label:this.name}),c.events.publish("store.filter.history",{name:this.name,state:this.getStateForFilterHistory()}))},getTrackingType:function(){if(this.options.trackEnabled&&c.VestigoType){var a=
c.VestigoType.FilterType;switch(this.name){case "equipment":return a.aircraft;case "eqmodel":return a.model;case "neighborhoods":return a.neighbourhood;case "ambiance":return a.style;case "price-options":return a.other;case "providers":return a.provider;case "roomtypes":return a.roomtype;case "propertysubtype":return a.propertytype;case "boardtypes":return a.board;default:return c.VestigoType.FlightQualityType[this.name]?a.flightquality:a[this.name]}}return""},trackInteraction:function(a){c.VestigoEvents&&
this.trackingType&&("reset"!==a&&"showall"!==a||c.VestigoEvents.filters.shared.reset(this.trackingType))},getTrackingAction:function(a){if(c.VestigoType){var b=c.VestigoType.FilterValueAction.select;0===a&&(b=c.VestigoType.FilterValueAction.unselect);2===a&&(b=c.VestigoType.FilterValueAction.only);return b}},trackStateChange:function(a){},trackStateChangeEnabled:function(a){return this.options.trackEnabled&&a.changeData}})})(R9,jQuery);(function(d,e){d.createComponentClass("common.results.filters.AndUpFilter","common.results.filters.Filter",{titleEl:null,state:{},items:[],itemValues:{},tooltips:[],any:null,rentalsCheckbox:null,rentalsCheckboxState:1,lastItemClicked:0,numberVisibleItem:5,numberVisibleItems:5,lastTarget:null,atLeastSubtitle:null,disabledItemClass:null,options:{countEnabled:!1,anyEnabled:!0,plusSign:"%s+",hideUnavailable:!0,tooltipColor:"black",useRadioButtons:!1},init:function(){var a=this;this.base();this.titleEl=
this.element.find(".filterSectionTitle");this.items=this.element.find(".item");this.items.each(function(b,c){a.itemValues[e(c).attr("value")]=b});this.any=this.element.find(".item-any");this.rentalsCheckbox=this.getChildElement("rentals-check");this.eventPrefix="filters.%s.".format(this.options.name);this.disabledItemClass=this.options.hideUnavailable?"hidden":"disabled";this.itemContainer=this.getChildElement("options")},addEventHandlers:function(a){var b=this;this.base(a);this.options.useRadioButtons?
this.bindRadioButtons():(a.find(".item .overlay").on("click",this.selectItemsRight.bind(this)),a.find(".item-any .overlay").on("click",this.selectAnyItem.bind(this)),a.find(".item, .item-any").on("keypress",function(a){switch(a.which){case d.globals.keyCodes.SPACE:case d.globals.keyCodes.RETURN:a.preventDefault(),e(a.target).children(".overlay").click()}}),this.addKeyboardNavigation(a),this.element.find(".filter-options").mouseleave(this.handleItemMouseLeave.bind(this)),this.rentalsCheckbox.click(this.handleRentalsFilterClick.bind(this)),
this.subscribe("filters.property.rental.changed",this.handlePropertyFilterChange.bind(this)),this.isTouchDevice()||(this.tooltips.push(this.any.toolTip({content:function(){return b.any.attr("data-message")},position:"top",showImmediately:!1,color:b.options.tooltipColor})),this.items.each(function(){var a=e(this);b.tooltips.push(a.toolTip({content:function(){return a.attr("data-message")},position:"top",showImmediately:!1,color:b.options.tooltipColor}));a.mouseenter(b.handleItemMouseEnter.bind(b))}),
this.subscribe("hotels.results.horizontalFilters.pinned",this.adjustTooltipPositioning.bind(this))),this.subscribe(this.eventPrefix+"resetitem",this.checkItems.bind(this)),d.events.subscribe(this.eventPrefix+"clickitem",function(a){b.checkItemByValue(a.itemvalue)}))},bindRadioButtons:function(a){var b=this;this.options.useRadioButtons&&this.getChildElement("review-score-radios").length&&(this.radioButtons=this.getChildElement("review-score-radios").getWidget())&&(this.radioButtons.setOption("click",
this.selectItemsRightOfElement.bind(this)),this.items.each(function(){e(this).next().find(".count").on("click",b.selectItemsRightOfElement.bind(b,this))}))},adjustTooltipPositioning:function(a){a&&a.hasOwnProperty("filtersPinned")&&null!=this.tooltips&&!this.options.inModal&&this.tooltips.forEach(function(b){b.getWidget().options.position=a.filtersPinned?"bottom":"top"})},setClazz:function(a){this.element.removeClass("one-up two-up three-up four-up five-up");this.element.addClass(a)},filterChanged:function(a){var b=
{};a&&-1<a.indexOf("-")&&(b.field=a.split("-")[1],b.value=1);this.logFilterChanged(a);this.pushStateChange(null,{changeData:b});this.updateFilterHistory()},logFilterChanged:function(a){this.logUserInteraction(["AndUpFilter",a].join("-"))},setCountClass:function(a){this.element.removeClass("count0 count1 count2 count3 count4 count5");this.element.addClass("count"+a)},onSetFromPrevious:function(a){a.reset&&(a.silent=!0);this.base(a)},setStateFromPrevious:function(a){if(a.reset)this.reset();else{var b;
b=this.options.useRadioButtons?function(a){return a.val()}:function(a){return a.data("val")};var c=this.items.filter(function(){return b(e(this))===a.key}).eq(0);c.length&&this.selectItemsRightOfElement(c)}},setState:function(a){var b=this;this.state=a;var c=this.getKeys(a);if(this.options.useRadioButtons){this.resetItemState();var g="",k=!0;c.each(function(a){1===b.state[a]?g=a:k=!1});this.radioButtons.setButtonCheckedByValue(k?"any":g)}else{this.items.addClass(this.disabledItemClass).attr("aria-"+
this.disabledItemClass,!0);d.globals.testMode&&this.items.attr("data-test-filteritem-disabled",!0);this.any.addClass("hidden").attr("aria-hidden",!0);var f=e.map(c,function(a){return".item.item-"+a});this.numberVisibleItems=f.length;this.setCountClass(this.numberVisibleItems);var h=[];e.each(c,function(b,c){1===a[c]&&h.push(".item.item-"+c)});f=this.itemContainer.find(f.join());f.removeClass(this.disabledItemClass).attr("aria-"+this.disabledItemClass,!1);f.removeClass("selected").attr("aria-checked",
!1);d.globals.testMode&&f.attr("data-test-filteritem-disabled",!1);this.any.removeClass("hidden").attr("aria-hidden",!1);this.any.removeClass(this.disabledItemClass).attr("aria-"+this.disabledItemClass,!1);h.length>=this.numberVisibleItems?(this.resetItemState(),this.any.addClass("selected").attr("aria-checked",!0),d.globals.testMode&&this.any.attr("data-test-filteritem-selected",!0)):(c=this.itemContainer.find(h.join()),c.addClass("selected").attr("aria-checked",!0),d.globals.testMode&&c.attr("data-test-filteritem-selected",
!0))}},selectItemsRight:function(a){return this.selectItemsRightOfElement(e(a.target))},selectItemsRightOfElement:function(a){var b=this;this.resetItemState();this.lastTarget=a;if(this.options.useRadioButtons){var c=!1,g=null;this.items.each(function(a){b.state[this.value]=c?0:1;e(b.lastTarget).attr("value")===e(this).attr("value")&&(e(this).addClass("selected").attr("aria-checked",!0),g=this.value,c=!0)});g&&this.filterChanged("change-"+g)}else a=a.closest(".item").index(),0===a&&(a=1),this.lastItemClicked=
a,a=e(this.items.slice(this.options.anyOptionEnabled?a-1:a,this.items.length)),a.addClass("selected").attr("aria-checked",!0),d.globals.testMode&&a.attr("data-test-filteritem-selected",!0),this.setStateFromUI(),this.filterChanged(["change",e.map(this.state,function(a,b){return 1==a?b:null}).join("-")].join("-"))},selectAnyItem:function(a){this.lastTarget=e(a.target);this.resetItemState();d.events.publish("filter.reset",{name:this.name});this.any.addClass("selected").attr("aria-checked",!0);d.globals.testMode&&
this.any.attr("data-test-filteritem-selected",!0);this.logSelectAnyItem()},deselectAnyItem:function(){this.any.hasClass("selected")&&(this.any.removeClass("selected").attr("aria-checked",!1),d.globals.testMode&&this.any.attr("data-test-filteritem-selected",!1))},logSelectAnyItem:function(){this.logUserInteraction("showall")},toggleItem:function(a){a=e(a.target).closest(".item");var b=this.element.find(".item:not(.hidden):not(.disabled)"),c=this.element.find(".item.selected:not(.hidden):not(.disabled)");
c.length===this.numberVisibleItems?(b.removeClass("selected").attr("aria-checked",!1),a.addClass("selected").attr("aria-checked",!0),d.globals.testMode&&(b.attr("data-test-filteritem-selected",!1),a.attr("data-test-filteritem-selected",!0))):1===c.length&&a.is(".selected")?(b.addClass("selected").attr("aria-checked",!0),d.globals.testMode&&b.attr("data-test-filteritem-selected",!0)):(b=!a.hasClass("selected"),a.toggleClass("selected",b).attr("aria-checked",b),d.globals.testMode&&a.attr("data-test-filteritem-selected",
b));this.setStateFromUI();this.filterChanged(["change",e.map(this.state,function(a,b){return 1==a?b:null}).join("-")].join("-"))},setStateFromUI:function(){var a=this;a.state={0:0};this.itemContainer.find(".item:not(.disabled):not(.hidden)").each(function(b,c){b=e(c);c=e(c).data("val");a.state[c]=b.is(".selected")?1:0})},getState:function(){return this.state},update:function(a){var b=this,c=a.valueMap,e=this.getKeys(c),d=a.andUpCounts,f={},e=e.sort(function(a,b){return c[a].displayOrder-c[b].displayOrder});
e.forEach(function(a){var e=c[a];if(e.filtered)f[a]=-1;else{var g=b.element.find(".item-"+a);g.length&&(g.data(e.call||e.info?"":b.options.plusSign.format(e.minPrice)),b.options.useRadioButtons&&d&&d[a]&&g.next().find(".count span").text(d[a]));f[a]=e.selected?1:0;e.selected&&b.deselectAnyItem()}});b.options.useRadioButtons&&d&&d.any&&this.any.next().find(".count span").text(d.any);this.setState(f)},cleanupExistingState:function(){this.state={};this.setClazz("");this.items.addClass(this.disabledItemClass).attr("aria-"+
this.disabledItemClass,!0);d.globals.testMode&&this.items.attr("data-test-filteritem-disabled",!0);this.any.addClass("hidden").attr("aria-hidden",!0);this.lastTarget=null},getKeys:function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&-1!==a[c]&&b.push(c);return b},handleItemMouseEnter:function(a){a=e(a.target).closest(".item");var b=a.index();0>b&&(b=0);e(this.items.slice(0,b)).removeClass("hovered");a.addClass("hovered");e(this.items.slice(b,this.items.length)).addClass("hovered")},handleItemMouseLeave:function(a){this.items.removeClass("hovered")},
resetItemState:function(){this.items.removeClass("selected").attr("aria-checked",!1);this.any.removeClass("selected").attr("aria-checked",!1);d.globals.testMode&&(this.items.attr("data-test-filteritem-selected",!1),this.any.attr("data-test-filteritem-selected",!1))},willReset:function(a){this.lastTarget=null;this.resetItemState()},handleRentalsFilterClick:function(a){this.rentalsCheckboxState=0<this.rentalsCheckboxState?0:1;d.events.publish("filters.property.rental.setchecked.force",{selected:this.rentalsCheckboxState,
changeType:"toggle"})},handlePropertyFilterChange:function(a){this.rentalsCheckboxState!=a.selected&&(this.rentalsCheckboxState=a.selected,this.rentalsCheckbox.prop("checked",0<this.rentalsCheckboxState).attr("aria-checked",0<this.rentalsCheckboxState))},filterDataChanged:function(a){this.base(a);1===this.lastItemClicked&&this.toggleResetLink(!0)},reset:function(a){this.base(a);this.lastItemClicked=0},checkItems:function(a){--a;this.items.length&&this.items[a]&&e(this.items[a]).find(".overlay").trigger("click")},
checkItemByValue:function(a){this.element.find('.item:not(.disabled):not(.hidden)[data-val\x3d"'+a+'"]').find(".overlay").click()},getStateForFilterHistory:function(){var a=this.getFilterPillDisplayValues();return e.extend({},{displayName:this.items.title,state:this.getState(),type:d.question.ask("filters.FilterHistory.type.andup")},a)},getFilterPillDisplayValues:function(){var a=null,b={};this.items.filter(":not(.hidden):not(.disabled)").each(function(c,d){c=e(d);d=c.attr("data-val");null==a&&c.is(".selected")&&
(a=d);b[d]=c.attr("data-message")});return{lowestKey:a,displayValues:b}},getHistoryFilterViewState:function(a){var b=this.getState(),c=this,d=function(a){return a.map(function(a){var b=c.items.filter("[data-val\x3d%s]".format(a));return b.length?{key:a,index:b.index()}:null}).filter(function(a){return null!==a}).sort(function(a,b){return a.index>b.index?1:-1}).map(function(a){return a.key})}(this.getKeys(a).filter(function(b){return 0!=a[b]})),k=[];this.items.each(function(a,b){k.push(e(b).attr("data-val"))});
var f=d.filter(function(a){return"undefined"!==typeof b[a]&&null!==b[a]});if(f.length){var h=f[0],f=b[h],h=k.indexOf(h);if(1==f&&(0===h||0==b[k[h-1]]))return{isAlreadyApplied:!0,lowestKey:d[0]}}else return{disabled:!0};return{state:a,lowestKey:d[0]}},applyFilterFromHistory:function(a){if(d.config.getBoolean("ui.horizon.filters.history.enabled",!1)){var b=e.extend({},this.getState());this.resetItemState();this.getKeys(b).forEach(function(a){b[a]=0});var c=e.extend({},b,a);d.Analytics.api.trackEvent({category:"Filter-History",
action:"Applying state From History: "+a,label:this.name});d.events.publish("filters.changed",{name:this.name,state:c})}},syncWithHistoryPillState:function(a){this.reset();this.base(a)},isTouchDevice:function(){return"ontouchstart"in window||navigator&&0<navigator.maxTouchPoints},addKeyboardNavigation:function(a){a.find(".item, .item-any").on("keydown",function(a){var b,g;switch(a.which){case d.globals.keyCodes.LEFT:b=e(this).prev();g="back";break;case d.globals.keyCodes.RIGHT:b=e(this).next(),g=
"forward"}for(;"none"===b.css("display")&&b.length;)b="back"===g?b.prev():b.next();b.focus()})}})})(R9,jQuery);(function(b,d){b.createComponentClass("hotels.results.filters.StarsFilter","common.results.filters.AndUpFilter",{options:{accountForOneStarRatingState:!1},update:function(a){var c=this.getChildElement("title-text")||this.titleEl;a.useCircleRatings?this.element.hasClass("circles")||(this.element.addClass("circles"),c.html(this.options.deTitle),this.getChildElement("info").addClass("visible")):this.element.hasClass("circles")&&(this.element.removeClass("circles"),c.html(this.options.title),this.getChildElement("info").removeClass("visible"));
delete a.useCircleRatings;this.base(a)},addEventHandlers:function(a){this.base(a);b.events.subscribe("filters.stars.resetitem",function(a){b.events.publish("filter.reset",{name:"stars"})})},updatePlaceholderDisplay:function(a){this.options.isDropdown?this.base(a):a&&(this.getChildElement("placeholder").toggleClass("hidden",!a.visible),this.getChildElement("options").toggleClass("hidden",!!a.visible))},getFilterPillDisplayValues:function(){var a=null,c={};this.items.filter(":not(.hidden):not(.disabled)").each(function(e,
b){e=d(b);b=e.attr("data-val");null==a&&e.is(".selected")&&(a=b);c[b]=b});return{lowestKey:a,displayValues:c}},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&b.VestigoEvents.filters.hotels.stars(this.resolveVestigoValue(a.changeData.field),this.getTrackingAction(a.changeData.value))},resolveVestigoValue:function(a){var c=b.VestigoType.StarsOption;switch(a){case "2":return c.two;case "3":return c.three;case "4":return c.four;case "5":return c.five;default:return c.any}},setStateFromUI:function(){var a=
this;a.state=this.options.accountForOneStarRatingState?{0:0,1:0}:{0:0};this.itemContainer.find(".item:not(.disabled):not(.hidden)").each(function(c,b){c=d(b);b=d(b).data("val");a.state[b]=c.is(".selected")?1:0})}})})(R9,jQuery);(function(d){R9.extend("Widgets",{Slider:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!this.validateElement())return this;this.options=d.extend({},this.options,b);this.init()}});R9.extend("Widgets.Slider.prototype",{elementNode:null,element:null,elementWidth:0,elementPositionLeft:0,activeRange:null,handles:[],activeHandle:null,activeHandleIndex:null,startValues:null,timelineDepPoints:null,timelineDepTimes:null,timelineArrTimes:null,timelineHours:null,timelinePrices:null,timelineLegSignatures:null,
timelineElements:null,timelineLabels:null,mouseMoveDelegate:d.noop,mouseUpDelegate:d.noop,options:{start:d.noop,stop:d.noop,slide:d.noop,min:0,max:100,step:1,values:[],range:!0,logarithmic:!1,snapToValue:!1,timeValueAmount:0,exponent:-1,cutoff:-1,totalRange:-1,totalStepAmount:-1,equalStepAmount:-1,cutoffPercentage:-1,equalStepRange:-1,expStepAmount:-1,useCustomDistribution:!1},init:function(){var a=this.element.data("r9RangeSlider");null!=a&&(this.options.values=a.getValues());this.element.data("r9RangeSlider",
this);var b=this;this.handles=this.element.children(".r9-rangeSlider-handle");this.activeRange=this.element.find(".r9-rangeSlider-activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(a){b.mouseDown(a);a.preventDefault();a.stopPropagation(!0)});a=this.options.values;if(!a||1>a.length)a=this.options.range?[this.options.min,this.options.max]:[this.options.min];this.determineSetValues(a);setTimeout(function(){b.drawActiveRange()},60)},validateElement:function(){return 0<
this.element.length&&this.element.hasClass("r9-rangeSlider")},setStartValues:function(){this.startValues=[];for(var a=0;a<this.options.values.length;a++)this.startValues[a]=this.options.values[a]},setupActiveHandle:function(a){this.activeHandle=a;this.activeHandleIndex=null;this.elementWidth=this.element.outerWidth();this.elementPositionLeft=this.element.offset().left;for(a=0;a<this.handles.length;a++)this.activeHandle==this.handles[a]&&(this.activeHandleIndex=a);d(this.activeHandle).addClass("r9-rangeSlider-handle-active")},
mouseDown:function(a){this.setupActiveHandle(a.target);var b=this;this.mouseMoveDelegate=function(a){b.mouseMove(a)};this.mouseUpDelegate=function(a){a.stopPropagation(!0);b.mouseUp(a)};d(document).bind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).bind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);this.setStartValues();this.options.start(a,this.options.values)},mouseUp:function(a){d(this.activeHandle).removeClass("r9-rangeSlider-handle-active");
this.activeHandleIndex=this.activeHandle=null;d(document).unbind("mousemove.r9RangeSlider touchmove.r9RangeSlider",this.mouseMoveDelegate).unbind("mouseup.r9RangeSlider touchend.r9RangeSlider",this.mouseUpDelegate);var b=!1;if(this.startValues)for(var c=0;c<this.options.values.length;c++){if(this.options.values[c]!=this.startValues[c]){b=!0;break}}else b=!0;this.options.stop(a,this.options.values,b)},setActiveHandleValue:function(a){var b=100*this.positionForValue(a);d(this.activeHandle).css("left",
b+"%").css("z-index","3");for(b=0;b<this.handles.length;b++)this.handles[b]==this.activeHandle&&(this.options.values[b]=a,this.setHandleAttribute("valuenow",a,b),1<this.handles.length&&(0===b?this.setHandleAttribute("valuemin",a,1):this.setHandleAttribute("valuemax",a,0)));this.drawActiveRange()},setHandleAttribute:function(a,b,c){void 0!==c?d(this.handles[c]).attr("aria-"+a,b):d(this.handles).attr("aria-"+a,b);R9.globals.testMode&&(void 0!==c?d(this.handles[c]).attr("data-test-sliderhandle-"+a,b):
d(this.handles).attr("data-test-sliderhandle-"+a,b))},mouseMove:function(a){a.preventDefault();a.stopPropagation();var b=a.originalEvent;b.touches&&0<b.touches.length?a.pageX=b.touches[0].pageX:b.changedTouches&&0<b.changedTouches.length&&(a.pageX=b.changedTouches[0].pageX);this.setActiveHandleValue(this.valueForPosition(Math.min(this.elementWidth,Math.max(0,a.pageX-this.elementPositionLeft))/this.elementWidth,this.activeHandleIndex));this.options.slide(a,this.options.values)},getValues:function(){return this.options.values.slice(0)},
getValue:function(){return 0<this.options.values.length?this.options.values[0]:0},setValues:function(a){var b=this;this.options.values=[];for(var c=0;c<a.length;c++){var e=this.trimAlignValue(a[c]),f=100*this.positionForValue(e),g=2;1<a.length&&(0==c&&90<=f||c==a.length-1&&10>=f)&&(g=3);this.options.values.push(e);d(this.handles[c]).css("left",f+"%").css("z-index",g)}setTimeout(function(){b.drawActiveRange()},60);R9.config.getBoolean("ui.slider.nonBlockingDrawActiveRange",!0)?setTimeout(this.drawActiveRange.bind(this),
1):this.drawActiveRange();this.options.slide(null,this.options.values)},determineSetValues:function(a){if(R9.config.getBoolean("ui.slider.safeSetValues",!0))return this.safeSetValues(a);this.setValues(a);return null},safeSetValues:function(a){try{return this.setValues(a),null}catch(b){return b}},errorSetValues:function(a){R9.Widgets.Slider.singleSetValuesError||(R9.Widgets.Slider.singleSetValuesError=1,R9.config.getBoolean("ui.slider.logRollbar",!1)&&window.Rollbar&&Rollbar.error?Rollbar.error("Slider setValues failed",
{error:a&&a.message?a.message:"(unknown error)",winTop:window===window.top,winParent:window.top===window.parent}):R9.config.getBoolean("ui.slider.logVs",!0)&&R9.Analytics.api.trackEvent({category:"slider",action:"error",label:"setvalues",value:(window===window.top)+"-"+(window.top===window.parent)}))},setCustomDistribution:function(a){this.options.exponent=a.exponent;this.options.cutoff=a.cutoff;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=a.ranges.length;
this.options.cutoffPercentage=a.cutoffPercentage;this.options.equalStepAmount=this.options.cutoffPercentage*this.options.totalStepAmount;this.options.equalStepRange=this.options.cutoff-this.options.min;this.options.expStepAmount=this.options.totalStepAmount-this.options.equalStepAmount;this.options.useCustomDistribution=!0},resetCustomDistribution:function(){this.options.exponent=-1;this.options.cutoff=-1;this.options.totalRange=this.options.max-this.options.min;this.options.totalStepAmount=-1;this.options.equalStepAmount=
-1;this.options.cutoffPercentage=-1;this.options.equalStepRange=-1;this.options.expStepAmount=-1;this.options.useCustomDistribution=!1},setTimelinePoints:function(a,b,c,d,f,g,h){this.timelineDepPoints=a;this.timelineDepTimes=b;this.timelineArrTimes=c;this.timelineHours=d;this.timelinePrices=f;this.timelineLegSignatures=g;h&&this.clearTimelineValues();this.setTimelineValues()},clearTimelineValues:function(){this.element.find(".timelineValue").remove();this.clearTimelineHours()},setTimelineValues:function(){this.timelineElements=
[];for(var a=0;a<this.timelineDepPoints.length;a++)this.setTimelinePoint(a);this.setTimelineHours()},setTimelinePoint:function(a){var b=d("\x3cspan /\x3e").addClass("timelineValue"),c=d('\x3cdiv class\x3d"times"  /\x3e').text(this.timelineDepTimes[a]+" - "+this.timelineArrTimes[a]),e=d('\x3cdiv class\x3d"priceValue" /\x3e').text(this.timelinePrices[a]),f=d("\x3cdiv /\x3e");b.data("legSig",this.timelineLegSignatures[a]);f.append(c);f.append(e);a=100*this.positionForValue(this.timelineDepPoints[a]);
this.element.append(b);b.css("left",a+"%");b.off("mouseover.r9Timeline").on("mouseover.r9Timeline",function(){d(this).addClass("highlight")});b.off("mouseout.r9Timeline").on("mouseout.r9Timeline",function(){d(this).removeClass("highlight")});this.markFilteredOutTimeLinePoint(b);b.toolTip({delay:0,showImmediately:!1,extraClass:"timelinePoint",content:""+f.html()});this.timelineElements.push(b)},markFilteredOutTimeLinePoint:function(a){if(a&&0!==a.length){var b=this.getPositionLeftValue(this.handles[0],
0),c=this.getPositionLeftValue(this.handles[1],100),d=this.getPositionLeftValue(a,100);b>d||c<d?a.addClass("filteredOut"):a.removeClass("filteredOut")}},markFilteredOutTimeLinePoints:function(){var a=this;this.timelineElements&&0!==this.timelineElements.length&&$.each(this.timelineElements,function(b,c){a.markFilteredOutTimeLinePoint(c)})},clearTimelineHours:function(){this.element.find(".timelineHour").remove()},setTimelineHours:function(){for(var a=0,b=0;24>b;b++){var c=this.options.min+36E5*b;
if(c>this.options.min&&c<this.options.max){var e=d("\x3cspan /\x3e").addClass("timelineHour").text(this.timelineHours[a]);this.element.append(e);c=100*this.positionForValue(c);e.css("left",c+"%");a++}}},getPositionLeftValue:function(a,b){return a?parseFloat($(a)[0].style.left):b},formatHourLabel:function(a){var b=new Date(a);a=b.getUTCHours();10>a&&(a="0"+a);b=b.getUTCMinutes();10>b&&(b="0"+b);return a+":"+b},triggerStop:function(){this.options.stop({},this.options.values,!0)},setValue:function(a){var b=
this.options.values.slice(0);b[0]=a;this.determineSetValues(b)},getOption:function(a){return this.options[a]},setOption:function(a,b){if("object"==typeof a)for(a in b=a,b)b.hasOwnProperty(a)&&(this.options[a]=b[a]);else this.options[a]=b;this.determineSetValues(this.options.values)},positionForValue:function(a){if(this.options.logarithmic){var b=1<=this.options.min?Math.log(this.options.min):0,c=Math.log(this.options.max);a=1<=a?(Math.log(a)-b)/((c-b)/1):0}else a=this.options.useCustomDistribution?
a>this.options.cutoff?Math.log(a-this.options.cutoff)/this.options.exponent/this.options.expStepAmount*(1-this.options.cutoffPercentage)+this.options.cutoffPercentage:(a-this.options.min)/this.options.equalStepRange*this.options.cutoffPercentage:(a-this.options.min)/(this.options.max-this.options.min);return a.toFixed(5)},valueForPosition:function(a,b){if(this.options.logarithmic&&1!==a){var c=1<=this.options.min?Math.log(this.options.min):0;a=Math.exp(c+(Math.log(this.options.max)-c)*a)}else a=this.options.useCustomDistribution&&
1!==a&&0<a?a>this.options.cutoffPercentage?this.options.cutoff+Math.exp((a*this.options.totalStepAmount-this.options.equalStepAmount)*this.options.exponent):1/this.options.cutoffPercentage*a*this.options.equalStepRange+this.options.min:this.options.min+(this.options.max-this.options.min)*a;a=this.trimAlignValue(a);0<b&&(a=Math.max(a,this.options.values[b-1]));b+1<this.handles.length&&(a=Math.min(a,this.options.values[b+1]));return a},drawActiveRange:function(){var a=!1,b=0,c=d(this.handles[this.handles.length-
1]).css("left"),e=d(this.activeRange);this.options.range&&(b=d(this.handles[0]).css("left"));if(c&&0<=c.indexOf("%")||b&&0<=b.indexOf("%"))a=!0;c=parseInt(c)-parseInt(b);e.css({left:b,width:(c||0)+(a?"%":"")});(1<this.handles.length?this.options.values[0]===this.options.min&&this.options.values[1]===this.options.max:this.options.values[0]===this.options.max)?e.addClass("fullRange"):e.removeClass("fullRange");this.markFilteredOutTimeLinePoints()},trimAlignValue:function(a){if(a<=this.options.min)return this.options.min;
if(a>=this.options.max)return this.options.max;var b;this.options.snapToValue?(b=10<this.options.step?this.options.step:10,b=Math.ceil(Math.pow(b,Math.floor(Math.log(a)/Math.log(b))-1))):b=0<this.options.step?this.options.step:1;var c=a%b;a-=c;2*Math.abs(c)>=b&&(a+=0<c?b:-b);a=parseFloat(a.toFixed(5));a=Math.min(a,this.options.max);return Math.max(a,this.options.min)}})})(jq||jQuery);
(function(d,a){d.createWidgetClass("slider.Slider",a.extend({},d.Widgets.Slider.prototype,{init:function(){var a=this;this.handles=this.element.children(".handle");this.activeRange=this.element.find(".activeRange");this.handles.off(".r9RangeSlider").on("mousedown.r9RangeSlider touchstart.r9RangeSlider",function(b){a.mouseDown(b);b.preventDefault();b.stopPropagation(!0)});this.handles.off("focus.sliderHandle").on("focus.sliderHandle",function(){a.focusHandler(1)});this.handles.off("blur.sliderHandle").on("blur.sliderHandle",
function(){a.focusHandler(0)});this.setHandleAttribute("valuemin",this.options.min);this.setHandleAttribute("valuemax",this.options.max);setTimeout(function(){var b=a.options.values;if(!b||1>b.length)b=a.options.range?[a.options.min,a.options.max]:[a.options.min];a.options.range?(a.setHandleAttribute("valuenow",b[0],0),a.setHandleAttribute("valuenow",b[1],1)):a.setHandleAttribute("valuenow",b[0]);(b=a.determineSetValues(b))&&a.errorSetValues(b);a.setHandleAttribute("label",a.options.ariaLabel)},1)},
focusHandler:function(a){this.handles.off("keydown.sliderHandle");this.handles.off("keyup.sliderHandle");if(a&&!this.element.hasClass("Disabled")){var b=this;this.handles.on("keydown.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:a.preventDefault();b.keyMoveHandle(a,-1,1);break;case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault();b.keyMoveHandle(a,1,1);break;case 33:a.preventDefault();b.keyMoveHandle(a,1,5);break;case 34:a.preventDefault(),
b.keyMoveHandle(a,-1,5)}});this.handles.on("keyup.sliderHandle",function(a){switch(a.keyCode){case d.globals.keyCodes.LEFT:case d.globals.keyCodes.DOWN:case d.globals.keyCodes.RIGHT:case d.globals.keyCodes.UP:a.preventDefault(),b.mouseUp(a),b.startValues=null}})}},keyMoveHandle:function(b,c,d){this.setupActiveHandle(b.target);var e=a(b.target).position().left/this.elementWidth,g=1/((this.options.max-this.options.min)/(null!==this.options.step?this.options.step:1));this.options.logarithmic&&(g=.01);
c=this.valueForPosition(Math.min(this.elementWidth,Math.max(0,e+g*c*d)),this.activeHandleIndex);this.startValues||this.setStartValues();this.setActiveHandleValue(c);this.options.start(b,this.options.values);this.options.slide(b,this.options.values)},mouseDown:function(){this.element.hasClass("Disabled")||d.Widgets.Slider.prototype.mouseDown.apply(this,arguments)},validateElement:function(){return this.element.hasClass("Common-Widgets-Slider-Slider")}}))})(R9,jQuery);(function(g,f){g.createComponentClass("common.results.filters.RangeFilterSlider","common.results.filters.Filter",{options:{formatValues:function(a){return a},displayFormat:"%s",min:void 0,max:void 0,snapToValue:!1,step:1,logarithmic:!1,useTextInput:!1,maxValueSlider:!1,onStop:f.noop,onSlide:void 0,onStart:void 0,onValidate:void 0,useAndUp:!1,andUpString:"",andUpMax:null,usesRangeDistribution:!1},minRange:void 0,maxRange:void 0,leftRange:void 0,rightRange:void 0,displayLabel:void 0,leftDisplay:void 0,
separatorDisplay:void 0,rightDisplay:void 0,andUpDisplay:void 0,andUpMin:void 0,textInputForm:void 0,textInputMin:void 0,textInputMax:void 0,textInputOpen:!1,widget:void 0,init:function(){this.displayLabel=this.getChildElement("rangeLabel");this.leftDisplay=this.element.find(".min");this.rightDisplay=this.element.find(".max");this.separatorDisplay=this.element.find(".sep");this.andUpDisplay=this.element.find(".andup");this.andUpMin=this.element.find(".minValue");this.andUpText=this.element.find(".andUpText")},
addEventHandlers:function(){var a=this;this.answer("RangeFilterSlider.init."+this.id(),function(b){for(var c in b)!b.hasOwnProperty(c)||null!==b[c]&&void 0!==b[c]||delete b[c];f.extend(a.options,b);return a});this.widget=this.getChildElement("sliderWidget").slider({range:!this.options.maxValueSlider,min:this.options.min,max:this.options.max,step:this.options.step,snapToValue:this.options.snapToValue,logarithmic:this.options.logarithmic,useTextInput:this.options.useTextInput,usesRangeDistribution:this.options.usesRangeDistribution}).getWidget();
this.minRange=this.options.min;this.maxRange=this.options.max;var c=function(b){a.options.maxValueSlider?a.setRightRange(b[0]):(a.setLeftRange(b[0]),a.setRightRange(b[1]))};this.widget.setOption("stop",function(b,d,e){e&&(a.setLastUserInteraction(!0),c(d));a.options.onStop(b,d,e)});this.widget.setOption("slide",function(b,d){if(b&&(c(d),"function"===typeof a.options.onSlide))a.options.onSlide(b,d)});this.options.useTextInput&&(this.textInputForm=this.getChildElement("textInputForm"),this.textInputMin=
this.getChildElement("minInput").find("input[type\x3dnumber]"),this.textInputMax=this.getChildElement("maxInput").find("input[type\x3dnumber]"),this.addTextInputHandlers());this.widget.setOption("start",function(b,c){if("function"===typeof a.options.onStart)a.options.onStart(b,c)});this.subscribe("results.filter.disablePriceGraph",function(){var b=a.getChildElement("sliderWidget"),c=b.children(".left"),b=b.children(".right");c.css("left","0%");b.css("left","100%");a.leftDisplay.html("---");a.rightDisplay.html("---");
a.leftDisplay.addClass("disabled");a.rightDisplay.addClass("disabled")});this.subscribe("results.filter.enablePriceGraph",function(){a.leftDisplay.removeClass("disabled");a.rightDisplay.removeClass("disabled")})},addTextInputHandlers:function(){var a=this;this.displayLabel.click(a.openTextInput.bind(a));this.textInputForm.submit(a.submitTextInput.bind(a));f("body").on("click.exceptPriceFilter",function(b){!a.textInputOpen||0<f(a.element).find(f(b.target)).length||(a.textInputForm.trigger("submit"),
a.closeTextInput())});var c={9:function(b){b.target&&f(b.target).is(a.textInputMin)?a.textInputMax.focus():a.closeTextInput()},13:function(){a.textInputForm.trigger("submit")},27:function(){a.closeTextInput()}};this.textInputForm.keydown(function(a){"function"===typeof c[a.keyCode]&&(c[a.keyCode](a),a.preventDefault())})},setMinRange:function(a){this.minRange=a;this.options.min=a;this.widget.setOption("min",a);this.widget.setHandleAttribute("valuemin",a,0)},setMaxRange:function(a){this.maxRange=a;
this.options.max=a;this.widget.setOption("max",a);this.widget.setHandleAttribute("valuemax",a,1)},setUsesRangeDistribution:function(a){this.options.usesRangeDistribution=a;this.widget.setOption("usesRangeDistribution",a)},setLeftRange:function(a,c){this.leftRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},setRightRange:function(a,c){this.rightRange=a;g.dom.schedule(this.updateDisplay.bind(this,c))},isLeftRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.minRange!==
a[0]},isRightRangeManipulated:function(){var a=this.widget&&this.widget.getValues();return a&&this.maxRange!==a[1]},reset:function(){this.setLeftRange(this.minRange);this.setRightRange(this.maxRange)},clearState:function(){this.leftRange=this.rightRange=this.minRange=this.maxRange=void 0},validateValues:function(a){if("function"===typeof this.options.onValidate)return this.options.onValidate(a);var c=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!c?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:
!1},updateDisplay:function(a,c){var b=this.options.formatValues([this.leftRange,this.rightRange],this),d=b[0],b=b[1],e=this.options.displayFormat;if("function"===typeof e)d=e(d,!0),b=e(b,!1);else if("string"===typeof e)d=e.format(d),b=e.format(b);else throw"Must pass a valid display formula [function || string]";this.leftDisplay.html(d);this.options.useAndUp&&this.andUpMin.html(d);this.rightDisplay.html(b);this.options.useAndUp&&(this.rightRange==this.maxRange?(this.rightDisplay.hide(),this.separatorDisplay.hide(),
this.leftDisplay.hide(),this.andUpDisplay.show()):(this.andUpDisplay.hide(),this.leftDisplay.show(),this.separatorDisplay.show(),this.rightDisplay.show()),this.options.andUpMax&&(this.leftRange>this.options.andUpMax?this.andUpText.hide():this.andUpText.show()));e=[this.leftRange,this.rightRange];this.options.maxValueSlider&&(e[0]=this.rightRange);this.widget.setHandleAttribute("valuetext",this.options.maxValueSlider?b:d,0);this.widget.setHandleAttribute("valuetext",b,1);a&&(c&&c.useCustomDistribution?
this.widget.setCustomDistribution(c):c&&!1===c.useCustomDistribution&&this.widget.resetCustomDistribution(),this.widget.setValues(e));this.textInputForm&&this.updateTextInput(e)},openTextInput:function(a){if(this.textInputForm&&!(1>this.textInputForm.length)){var c=f(a.target).is(".max")?this.textInputMax:this.textInputMin;this.resetTextInput();this.textInputForm.removeClass("hidden");this.displayLabel.addClass("hidden");this.textInputOpen=!0;setTimeout(function(){c.focus()},10)}},closeTextInput:function(){!this.textInputForm||
1>this.textInputForm.length||(this.displayLabel.removeClass("hidden"),this.textInputForm.addClass("hidden"),this.textInputOpen=!1)},receiveMaxValue:function(a){a=[this.options.min,Math.round(Number(a))];if(!this.validateValues(a))return this.resetTextInput(),!1;this.widget.options.stop(null,a,a[0]!==this.leftRange||a[1]!==this.rightRange)},submitTextInput:function(a){a.preventDefault();var c=Math.round(Number(this.textInputMin.val())),b=Math.round(Number(this.textInputMax.val())),c=[c,b];if(!this.validateValues(c))return this.resetTextInput(),
!1;this.widget.options.stop(a,c,c[0]!==this.leftRange||c[1]!==this.rightRange);this.closeTextInput();return!1},updateTextInput:function(a){this.textInputMin.val(a[0]).attr("min",this.minRange).attr("max",a[1]);this.textInputMax.val(a[1]).attr("min",a[0]).attr("max",this.maxRange)},resetTextInput:function(){this.textInputMin.val(this.leftRange);this.textInputMax.val(this.rightRange)},destroy:function(){this.base();f("body").off("click.exceptPriceFilter")}})})(window.R9,window.jQuery);(function(g,f){var m=JSON.parse('{"legs":[{"cutoffPercentage":0.7,"leftRange":110,"useCustomDistribution":true,"ranges":[{"min":110,"max":144,"minPrice":128.09,"count":4},{"min":144,"max":178,"minPrice":161.8,"count":15},{"min":178,"max":212,"minPrice":200.59,"count":7},{"min":212,"max":246,"minPrice":232.36,"count":16},{"min":246,"max":280,"minPrice":261.16,"count":17},{"min":280,"max":314,"minPrice":301.32,"count":11},{"min":314,"max":348,"minPrice":322.96,"count":26},{"min":348,"max":382,"minPrice":358.16,"count":36},{"min":382,"max":416,"minPrice":414.54,"count":19},{"min":416,"max":450,"minPrice":432.79,"count":18},{"min":450,"max":484,"minPrice":464.27,"count":7},{"min":484,"max":518,"minPrice":555.09,"count":7},{"min":518,"max":552,"minPrice":594.41,"count":6},{"min":552,"max":556,"minPrice":-1,"count":0},{"min":556,"max":567,"minPrice":661.45,"count":1},{"min":567,"max":612,"minPrice":665.27,"count":5},{"min":612,"max":788,"minPrice":700.47,"count":11},{"min":788,"max":1479,"minPrice":857.45,"count":7}],"isUserManipulated":false,"maxRange":1479,"rightRange":1479,"maxCount":36,"enabled":true,"isDirty":false,"isFiltering":false,"maxIndex":0,"minIndex":0,"maxPrice":857.45,"cutoff":552,"updateTitle":false,"minRange":110,"exponent":1.366390713113171}],"isUserManipulated":false,"maxPrice":[857.45],"filteredResults":213}');
g.createComponentClass("common.results.filters.SimpleRangeGraphFilter","common.results.filters.Filter",{Graph:null,legs:void 0,legCount:1,filteredResults:null,options:{showOutliers:!1,outlierDeviation:18,displayFormat:"%s",thousandsDelimiter:",",decimalDelimiter:".",showGraphOverlay:!1,activeLeg:-1,yAxisDisplay:"count",min:void 0,max:void 0,step:1,useTextInput:!1,triggerFilteredLabel:!1,showYLines:!1,graphHeight:72,xAxisSteps:0,yAxisTicks:0,hasCursor:!1,minimumResults:0,forceHideGraph:!1,forceDisableOnSingleResult:!0,
disableOnSingle:!0,usePlaceholderData:!1,showCurrencyCodes:!1,isRtl:!1},textInput:null,init:function(){this.base();this.Graph=this.makeGraphClass();this.legs=[];this.minRange=this.options.min;this.maxRange=this.options.max;this.textInput=this.getChildElement("textInputForm");this.eventPrefix="filters.%s.".format(this.options.name)},inlineComponentsReady:function(){this.base();var a=this;this.element.find(".graphFilterSection").each(function(b){a.legs[b]={slider:g.question.ask("RangeFilterSlider.init."+
a.id("slider-"+b),{min:a.options.min,max:a.options.max,step:a.options.step,useTextInput:a.options.useTextInput,displayFormat:a.options.displayFormat,formatValues:a.formatValues.bind(a),triggerFilteredLabel:a.options.triggerFilteredLabel,onStart:function(c,d){return a.sliderDidStart(b,d)},onSlide:function(c,d){return a.sliderDidSlide(b,d)},onStop:function(c,d,e){a.publishHoverState(!1,{leg:b});d={};var h=a.legs[b].slider;h&&(d.field=(f(c.target).hasClass("left")?"left":"right")+b,d.value=h[-1<d.field.indexOf("left")?
"leftRange":"rightRange"]);return a.sliderDidStop(b,e,{changeData:d})},onValidate:function(b){return a.validateValues(b)}}),label:a.getChildElement("label-"+b),ranges:void 0,maxYVal:void 0,element:f(this)}});this.options.usePlaceholderData&&(this.update(m),this.showGraph(0))},addEventHandlers:function(){this.base();this.subscribe(this.eventPrefix+"resetitem",this.reset.bind(this))},formatValues:function(a){var b=this;return a.map(function(a){return"undefined"===typeof a?a:g.Common.Utils.formatOptionalPrice(Math.round(a),
!0,b.options.showCurrencyCodes)})},update:function(a){var b=this;a&&(a.hasOwnProperty("filteredResults")&&(this.filteredResults=a.filteredResults),a.legs?a.legs.forEach(b.updateLeg.bind(b)):this.updateLeg(a,0),a.sectionLabels?a.sectionLabels.forEach(function(a,d){b.legs[d].label.html(a)}):1===b.legs.length&&(b.legs[0].label.html(this.options.title),b.legs[0].label.addClass("only-label")),this.disabledPriceGraphFilter(a))},updateLeg:function(a,b){this.updateLegSlider(a,b);this.legs[b].ranges=a;this.legs[b].graph=
void 0;var c=this.lookupGraphYKeys(this.options.yAxisDisplay);(c=a[c.max])&&c.length?this.legs[b].maxYVal=c[b]:f.isArray(c)||(this.legs[b].maxYVal=c);this.showGraph(b);this.updateGraph(b,[parseInt(a.leftRange),parseInt(a.rightRange)])},validateValues:function(a){var b=a[0]!==a[0]||a[1]!==a[1];return a&&a[0]&&a[1]&&!b?this.minRange<=a[0]&&a[0]<=a[1]&&a[1]<=this.maxRange:!1},willReset:function(){this.legs.forEach(function(a){a.slider.reset()})},lookupGraphYKeys:function(a){var b={count:{value:"count",
max:"maxCount"},price:{value:"minPrice",max:"maxPrice"}};return"string"===typeof a&&b[a]?b[a]:b.count},updateLegSlider:function(a,b){var c=this.legs[b].slider,d=parseInt(a.minRange),e=parseInt(a.maxRange),h=parseInt(a.leftRange),f=parseInt(a.rightRange),n=void 0===c.leftRange||void 0===c.minRange||c.leftRange===c.minRange,p=void 0===c.rightRange||void 0===c.maxRange||c.rightRange===c.maxRange;if(!isNaN(d)&&!isNaN(e)){c.setMinRange(d);c.setMaxRange(e);this.minRange=d;this.maxRange=e;isNaN(h)?n&&c.setLeftRange(c.minRange,
!0):c.setLeftRange(h,!0);isNaN(f)?p&&c.setRightRange(c.maxRange,!0):c.setRightRange(f,!0);c.updateDisplay(!0,a);var l=this;g.dom.schedule(function(){l.getChildElement("section-"+b).removeClass("hidden");l.getChildElement("legToggle").find("[name\x3d%s]".format(b+1)).addClass("active");l.element.removeClass("hidden")})}},getValuesFromRanges:function(a){var b=[];a.forEach(function(a,d,e){b[d]=a.min;e.length===d+1&&(b[d+1]=a.max)});return b},sliderDidStop:function(a,b,c){b&&(c&&(c.activeLegIndex=a),
this.pushStateChange(null,c),this.updateFilterHistory(),this.setLastUserInteraction(!0));this.logUserInteraction()},sliderDidSlide:function(a,b){void 0!==this.legs[a].graph&&this.updateGraph(a,b)},sliderDidStart:function(a){this.isGraphable(a)&&this.updateGraph(a,this.legs[a].slider.widget.options.values)},getLegResultCount:function(a){var b=0;a.forEach(function(a){b+=a.count});return 1E4<b?null:b},calculateRangeMean:function(a,b){var c=0;a.forEach(function(a){c+=a.max*a.count});return c/b},calculateRangeStdDev:function(a,
b,c){var d=0,e=0;a.forEach(function(a){e=a.max*a.count;d+=(e-c)*(e-c)/b});return Math.sqrt(d/b)},showGraph:function(a){var b=this.legs[a].ranges;void 0===this.legs[a].graph&&(this.legs[a].graph=this.getChildElement("graph-"+a).html(this.generateGraph(a,b)));this.getChildElement("section-"+a).addClass("showGraph");this.legs[a].graph.find(".filterGraph").addClass("open");this.filteredResults>=this.options.minimumResults&&!this.options.forceHideGraph?this.legs[a].graph.removeClass("force-hidden"):this.legs[a].graph.addClass("force-hidden")},
getState:function(){return{legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};b.min=a.slider.leftRange.toString();b.max=a.slider.rightRange.toString();return b})}},updateGraph:function(a,b){this.legs[a].graph.find(".bars .bar").each(function(){var a=parseInt(f(this).data("boundary"));b[0]>a||b[1]<a?f(this).addClass("inactive"):f(this).removeClass("inactive")})},isGraphable:function(a){if(!this.legs[a]||
!this.legs[a].ranges||!this.legs[a].ranges.ranges)return!1;a=this.legs[a].ranges.ranges;var b=2>a.length,c=!1,d=!1;if(!this.options.showOutliers){var e=this.getLegResultCount(a);e?c=this.getHasOutliers(a,e):d=!0}return!b&&!c&&!d},getHasOutliers:function(a,b){var c=this.calculateRangeMean(a,b);a=this.calculateRangeStdDev(a,b,c);return(this.maxRange-c)/a>this.options.outlierDeviation},generateGraph:function(a,b){return(new this.Graph({minRange:b.minRange,maxRange:b.maxRange,yKey:this.lookupGraphYKeys(this.options.yAxisDisplay).value,
yMax:this.legs[a].maxYVal,ranges:b.ranges,showYLines:this.options.showYLines,height:this.options.graphHeight,xAxisSteps:this.options.xAxisSteps,yAxisTicks:this.options.yAxisTicks,hasCursor:this.options.hasCursor,yMaxPixels:this.options.graphHeight-2,isRtl:this.options.isRtl})).render()},makeGraphClass:function(){var a=function(a){this.options=f.extend(this.options,a);this.init()};a.prototype=f.extend(a.prototype,{xUnitScale:1,yUnitScale:1,xLabelPixels:void 0,yLabelPixels:void 0,xPixelPadding:5,xMaxPixels:g.config.getInt("ui.range.filter.graph.xAxisMax",
179),options:{},init:function(){this.findAxisTextWidths();0<this.xAxisSteps&&this.adjustXAxisSteps();0<this.options.yAxisTicks&&this.adjustYAxisTicks()},formatX:function(a){return g.Common.Utils.formatPrice(Math.round(a),!0)},formatY:function(a){return a},rawX:function(a){return a},rawY:function(a){return a},pixelScaleY:function(a){return 0>a?1:this.options.yMaxPixels/this.options.yMax*a},findAxisTextWidths:function(){if(!(this.xLabelPixels&&this.yLabelPixels||null==this.options.ranges)){var a=this.formatX(this.options.ranges[this.options.ranges.length-
1]&&this.options.ranges[this.options.ranges.length-1].max),c=this.formatY(this.options.yMax),a=f("\x3cspan\x3e").html(a).addClass("xLabel").css("font-size","9px"),c=f("\x3cspan\x3e").html(c).addClass("yLabel").css("font-size","10px");"rtl"===document.dir&&c.css("display","inline-block");var d=f("\x3cdiv\x3e").css("position","absolute").css("left","-9999px").css("top","-9999px").css("opacity","0");d.append(a).append(c);f("body").append(d);this.xLabelPixels=a.outerWidth()+5;this.yLabelPixels=c.outerWidth()+
5;d.remove()}},adjustXAxisSteps:function(){for(;0<this.options.xAxisSteps&&!(this.xMaxPixels/(this.options.xAxisSteps+1)>this.xLabelPixels);this.options.xAxisSteps--);2>=this.options.xAxisSteps&&(this.options.xAxisSteps=2)},adjustYAxisTicks:function(){var a=this.options.yMax,c=Number(this.options.yAxisTicks);if(0!==a%c)for(this.options.yAxisTicks=8>a?a:8;1<this.options.yAxisTicks&&0!==this.options.yMax%this.options.yAxisTicks;this.options.yAxisTicks--)1===this.options.yAxisTicks&&(this.options.yAxisTicks=
8<this.options.yAxisTicks?c:this.options.yMax)},renderYAxis:function(){if(1>this.options.yAxisTicks)return"";var a=this.options.height/this.options.yAxisTicks,c=f("\x3cdiv\x3e");if(0<this.options.yAxisTicks){for(var d=f("\x3cdiv class\x3d'y-axis'\x3e\x3c/div\x3e"),e,h=0;h<this.options.yAxisTicks;h++)e=this.renderYAxisLabel(h).css("height",a+"px").css("width",this.yLabelPixels+"px"),d.append(e);d.css("width",this.yLabelPixels);c.append(d)}if(this.options.showYLines)for(h=0;h<this.options.yAxisTicks;h++)d=
f("\x3cdiv\x3e\x3c/div\x3e").addClass(h+1===this.options.yAxisTicks?"line last":"line").css("top",h*a+"px").css("height",a-1+"px").css("rtl"===document.dir?"right":"left",this.yLabelPixels+this.xPixelPadding+"px"),c.append(d);return c.html()},renderYAxisLabel:function(a){return f("\x3cdiv class\x3d'label'\x3e"+this.formatY(this.options.yMax-this.options.yMax*a/this.options.yAxisTicks)+"\x3c/div\x3e")},renderXAxis:function(){if(0<this.options.xAxisSteps){for(var a=this.rawX(this.options.minRange),
c=this.rawX(this.options.maxRange),d=Math.max(Math.ceil((c-a)/this.options.xAxisSteps),this.xUnitScale),a=Math.min((c-a)/d+1,8),c="",e=0;e<a;e++)c+=this.renderXAxisLabel(e,d);return"\x3cdiv class\x3d'x-axis' style\x3d'"+("rtl"===document.dir?"right":"left")+": "+(this.yLabelPixels+2)+"px'\x3e"+c+"\x3c/div\x3e"}return""},renderXAxisLabel:function(a,c){a=this.rawX(this.options.minRange)+a*c;return"\x3cspan class\x3d'x-label'\x3e"+this.formatX(a)+"\x3c/span\x3e"},renderGraphBars:function(){for(var a=
"",c=40<this.yLabelPixels,d=c?this.yLabelPixels:(this.yLabelPixels+this.xPixelPadding)/2,e=0,f=this.options.ranges.length;e<f;e++)var g=this.options.ranges[e],a=a+("\x3cspan class\x3d'bar' data-boundary\x3d'"+g.min+"' style\x3d'height: "+this.pixelScaleY(g[this.options.yKey])+"px'\x3e\x3c/span\x3e");e=(c?"left:":"right:")+d+"px";"rtl"===document.dir&&(e=(c?"right:":"left:")+d+"px");return this.options.hasCursor?"\x3cdiv class\x3d'bars' style\x3d'"+e+"'\x3e"+a+"\x3cspan class\x3d'cursor'\x3e\x3c/span\x3e\x3c/div\x3e":
"\x3cdiv class\x3d'bars' style\x3d'"+e+";'\x3e"+a+"\x3c/div\x3e"},render:function(){return f("\x3cdiv class\x3d'filterGraph'/\x3e").html(this.renderYAxis()+this.renderGraphBars()+this.renderXAxis())}});return a},getHistoryFilterViewState:function(a){var b=this,c=this.legCount,d=null,e=null,g=[],k=function(a,b){b()?null===d&&(d=!0):a()&&(null===e&&(e=!0),d=!1)};a.legs.forEach(function(a,d){if(!(d>=c)){var f=b.legs[d].ranges?{min:b.legs[d].ranges.minRange,max:b.legs[d].ranges.maxRange}:{},h=b.legs[d].ranges?
{min:b.legs[d].ranges.leftRange,max:b.legs[d].ranges.rightRange}:{};a.min&&a.max?k(function(){return a.min>f.min&&a.max<f.max},function(){return a.min==h.min&&a.max==h.max}):a.min?k(function(){return a.min<f.max},function(){return a.min==h.min}):a.max?k(function(){return a.max>f.min},function(){return a.max==h.max}):e=!1;g.push(a)}});return f.extend(this.base(),{state:{legs:g},isAlreadyApplied:d,disabled:!e})},getStateForFilterHistory:function(){var a=this,b={legs:this.legs.slice(0,this.legCount).map(function(a){if(!a.slider||
"number"!==typeof a.slider.leftRange||"number"!==typeof a.slider.rightRange)return{};var b={};a.slider.isLeftRangeManipulated()&&(b.min=a.slider.leftRange.toString());a.slider.isRightRangeManipulated()&&(b.max=a.slider.rightRange.toString());return b})};return{displayName:this.options.title,state:b,type:g.question.ask("filters.FilterHistory.type.slider"),subtype:this.getFilterHistoryDisplayViewSubtype(),displayValue:b.legs.map(function(b,d){return{displayName:a.getLegDisplayName(d),min:b.min&&a.formatValues([parseInt(b.min)]),
max:b.max&&a.formatValues([parseInt(b.max)])}})}},getLegDisplayName:function(){return null},getFilterHistoryDisplayViewSubtype:function(){return g.question.ask("filters.FilterHistory.type.numeric")},setDisabled:function(a){a=a||this.options.forceDisableOnSingleResult&&this.options.disableOnSingle&&1>=this.filteredResults;this.base(a);this.legs&&this.legs.forEach(function(b){b.slider.element.find(".r9RangeSlider").toggleClass("Disabled",a)})},disabledPriceGraphFilter:function(a){this.setDisabled(0===
a.legs.length);this.element.hasClass("Disabled")?g.events.publish("results.filter.disablePriceGraph"):g.events.publish("results.filter.enablePriceGraph")},setStateFromPrevious:function(a){var b=parseInt(a.key[a.key.length-1]);if(this.legs&&b<this.legs.length){var b=this.legs[b].slider,c=a.key.startsWith("left");a=a.reset?c?b.minRange:b.maxRange:parseInt(a.value);var d=b.widget.getValues();c?(b.setLeftRange(a),d[0]=a):(b.setRightRange(a),d[1]=a);b.widget.setValues(d)}},updatePreviousFilters:function(a){a?
a.legs.forEach(function(a,c){var b="left"+c;c="right"+c;a.hasOwnProperty("min")&&this.previousFilters.hasOwnProperty(b)&&this.previousFilters[b]!==a.min&&this.removePreviousFilter(b);a.hasOwnProperty("max")&&this.previousFilters.hasOwnProperty(c)&&this.previousFilters[c]!==a.max&&this.removePreviousFilter(c)},this):this.removePreviousFilter()},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&(g.VestigoType.FilterType.price===this.name?(a=0<this.legs.length?this.legs[0].slider:null)&&
g.VestigoEvents.filters.shared.priceRange(a.leftRange,a.rightRange,g.VestigoType.PriceType[g.question.ask("results.priceType")]):this.base(a))}})})(R9,jQuery);(function(c,e){var f=c.config.getBoolean("ui.horizon.fitlers.valueSetFilterItem.clearDisabledPrice",!0),g=c.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");c.createComponentClass("common.results.filters.ValueSetFilterItem",{checkbox:null,options:{name:null,loggingValue:null,group:null,state:{code:null,displayValue:null,pluralDisplayValue:null,minPrice:null,selected:0,info:!1,showAllSate:void 0,resetState:void 0,noSelect:!1,disabled:!1,hideOnly:!1,ignoreOnly:!1,displayOrder:0,
filtered:!1,partiallyFiltered:!1,resetOnDynamicIconClick:!1,tooltipText:null,href:null,cssClass:null,enableItemActionLogging:!1,enableActionTypeLogging:!0,count:0,showAsNotChecked:null,meta:!1},unrolled:!1,withImage:!1,onlyOnClick:!1,heading:void 0,headingOnlyState:1,onUserChange:e.noop,onRemove:e.noop,countEnabled:!1,allowZeroCount:!1,disableOnZeroCount:!1,messages:{},usePluralDisplayValue:!1,allUncheckedMeansInactive:!1,openMapOnSelection:!1,inModal:!1},events:{only:"filters.valueSetFilterItem.only"},
eventPrefix:"",eventGroupPrefix:"",loggingPrefix:"filters",updateKey:null,state:null,init:function(){this.state=e.extend({},this.options.state||{});this.checkbox=this.getChildElement("check");this.price=this.getChildElement("price");this.only=this.getChildElement("only");this.count=this.getChildElement("count");this.funnel=this.element.find(".funnel");this.innerCount=e("span",this.count);this.eventPrefix="filters.%s.%s.".format(this.options.group,this.options.name);this.eventGroupPrefix="filters.%s.".format(this.options.group);
this.options.onUserChange=this.options.onUserChange.bind(this,this.options.name);this.options.tooltipText&&(this.tooltip=this.getChildElement("tooltip-anchor").toolTip(this.getTooltipOptions({content:this.options.tooltipText})).getWidget());this.update(this.state);var a=this;c.dom.schedule(function(){a.checkbox.prop("checked",0<a.state.selected);"string"===typeof a.state.cssClass&&a.element.addClass(a.state.cssClass);a.options.cssClass&&a.element.addClass(a.options.cssClass);a.state.disabled&&a.setDisabled(!0);
a.state.hasOwnProperty("noSelect")&&(a.element.toggleClass("NoSelect",a.state.noSelect),a.checkbox.attr("aria-disabled",a.state.noSelect))})},addEventHandlers:function(){var a=this;this.registerEvent("click",this.element.find(".FilterCheckbox"),this.checkboxClicked.bind(this));this.registerEvent("keypress",this.element,function(b){b.keyCode===c.globals.keyCodes.RETURN&&a.checkboxClicked(b)});this.registerEvent("click",this.price,this.priceClicked.bind(this));this.registerEvent("click",this.count,
this.countClicked.bind(this));this.registerEvent("click",this.only,this.onlyClicked.bind(this));this.registerEvent("mouseenter",this.element,this.handleOnlyContainerMouseEnter.bind(this));this.registerEvent("mouseenter",this.only,this.handleOnlyMouseEnter.bind(this));this.registerEvent("mouseleave",this.element,this.handleOnlyContainerMouseLeave.bind(this));this.registerEvent("mouseleave",this.only,this.handleOnlyMouseLeave.bind(this));this.registerEvent("focus",this.only,this.handleOnlyFocus.bind(this));
this.options.resetOnDynamicIconClick&&this.registerEvent("click",this.funnel,this.funnelClicked.bind(this));if(this.options.showRemoveIcon){var b=this.getChildElement("remove"),d=null;"function"===typeof this.options.onRemove&&this.registerEvent("click",b,function(b){b.stopPropagation();d&&d.close();a.options.onRemove(a)});b.attr("title")&&(d=b.toolTip().getWidget())}this.registerEvent("keypress",this.only,function(b){switch(b.which){case c.globals.keyCodes.SPACE:case c.globals.keyCodes.RETURN:a.only.click(),
b.stopPropagation()}});this.addSubscriptionHandlers();this.registerEvent("focus",this.checkbox,this.toggleFocusStyle.bind(this,!0));this.registerEvent("blur",this.checkbox,this.toggleFocusStyle.bind(this,!1))},addSubscriptionHandlers:function(){var a=this;this.subscribe(this.eventPrefix+"setchecked",this.setChecked.bind(this));this.only&&this.only.length&&this.subscribe(this.eventPrefix+"onlyclick.force",function(){a.only.click()});this.subscribe(this.eventPrefix+"quickclick.force",function(){a.state.disabled||
a.state.hideOnly||a.state.noSelect||a.setChecked(1,"quickfilter")});this.subscribe(this.eventPrefix+"quickunclick.force",function(){a.state.disabled||a.state.hideOnly||a.state.noSelect||a.setChecked(0,"quickfilter")});this.subscribe(this.eventPrefix+"setchecked.force",function(b){a.setChecked(b.selected,b.changeType||"toggle")});this.subscribe(this.eventPrefix+"resetitem",function(b){a.setChecked(a.state.resetState,b.changeType||"toggle")});this.subscribe(["filters.disabled",this.eventPrefix+"disabled"],
this.setDisabled.bind(this));this.subscribe("resultspage.cleanup",function(b){a.isClean=!0});this.subscribe("filters."+this.options.group+".showAsNotChecked",function(b){a.state.showAsNotChecked=b})},countClicked:function(a){this.state.disabled||this.state.hideOnly||this.state.noSelect||(this.setChecked(1),this.options.onUserChange("count"),this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"count"}))},priceClicked:function(a){if(this.price.attr("href"))window.open(this.price.attr("href"),
"_blank");else{if(this.state.disabled||this.state.hideOnly||this.state.noSelect)return;this.setChecked(1);this.options.onUserChange("price")}this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:"price"})},onlyClicked:function(a){a.stopPropagation();this.state.disabled||(this.options.openMapOnSelection&&this.handleItemSelected(!0),this.options.heading?this.setChecked(this.options.headingOnlyState):this.setChecked(2),this.only.addClass("hideOnly"),
this.options.onUserChange("only"))},handleOnlyContainerMouseEnter:function(a){this.only.removeClass("hideOnly");this.only.addClass("hideOnlyDecoration")},handleOnlyContainerMouseLeave:function(a){this.only.addClass("hideOnly")},handleOnlyMouseEnter:function(a){this.only.removeClass("hideOnlyDecoration")},handleOnlyMouseLeave:function(a){this.only.addClass("hideOnlyDecoration")},handleOnlyFocus:function(a){this.only.removeClass("hideOnly");this.only.removeClass("hideOnlyDecoration")},funnelClicked:function(a){a.stopPropagation();
this.funnelTooltipWidget&&this.funnelTooltipWidget.close();c.events.publish("filters.reset",{type:"showAll"})},checkboxClicked:function(a){a.preventDefault();if(!this.state.disabled&&!this.state.noSelect){a=0<this.state.selected?0:1;var b="toggle";this.options.openMapOnSelection&&0<a&&this.handleItemSelected();this.options.enableActionTypeLogging&&(b=0<this.state.selected?"unselect":"select");this.options.onlyOnClick&&2!==this.state.selected&&(a=2,b="only");this.setChecked(a);this.options.onUserChange(b);
a=0<this.state.selected?"show":"hide";this.options.enableItemActionLogging&&c.Analytics.api.trackEvent({category:this.loggingPrefix,action:this.options.group,label:a+"-"+this.options.name})}},handleItemSelected:function(a){c.events.publish(this.eventGroupPrefix+"selected",{name:this.options.name,only:a})},setDisabled:function(a){this.state.disabled=a;c.dom.toggleOneClass(this.element,"Disabled",a);this.element.attr("aria-disabled",a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",a);c.events.publish(this.eventPrefix+
"state.disabled",a)},setSelectable:function(a){this.state.noSelect=!a;c.dom.toggleOneClass(this.element,"Disabled",!a);this.element.attr("aria-disabled",!a);c.dom.toggleOneClass(this.checkbox.parent(),"Disabled",!a)},setPrice:function(a){a=a||"";this.state.minPrice=a;this.price.text(a)},setCount:function(a){this.state.count=a;this.innerCount.text(a)},setChecked:function(a,b,d){d=this.options.allUncheckedMeansInactive&&this.state.showAsNotChecked?!1:0<a;c.dom.toggleOneClass(this.element,"Checked",
d);this.checkbox.prop("checked",d);this.state.selected=a;c.events.publish(this.eventPrefix+"changed",this.state);if(b)this.options.onUserChange(b)},setDisplayValue:function(a){this.element.find(".label").text(a);this.state.displayValue=a},update:function(a){var b=this;this.options.disableOnZeroCount&&0===a.count&&a.filtered?(a.disabled=!0,this.state.userSelectedDisabled=this.state.selected!==a.resetState):this.state.userSelectedDisabled=!1;a.disabled&&f&&(a.minPrice="");this.state.filtered=a.filtered;
this.state.displayOrder=a.displayOrder;this.state.showAllState=a.showAllState;this.state.resetState=a.resetState;this.state.meta=a.meta;var d=this.computeUpdateKey(a);if(!c.config.getBoolean("ui.horizon.filters.updateKey",!0)||d!==this.updateKey||this.isClean)this.isClean=!1,this.state.selected=a.selected,this.state.disabled=a.disabled,c.dom.schedule(function(){b.updateElement(a);b.updateKey=d})},updateElement:function(a){a.cssClass&&a.cssClass!==this.state.cssClass&&(this.element.removeClass(this.state.cssClass),
this.element.addClass(a.cssClass),this.state.cssClass=a.cssClass);this.setChecked(a.selected,"",!0);this.setPrice(a.minPrice);this.state.displayValue!==a.displayValue&&this.setDisplayValue(a.displayValue);(0!==a.count||this.options.allowZeroCount)&&a.count!==this.state.count&&this.options.countEnabled&&this.setCount(a.count);this.updateDynamicFilterTooltip(a);var b=!!a.hideOnly;if(this.state.hideOnly!==b||this.element.hasClass("No-Only")!==b)this.state.hideOnly=b,this.element.toggleClass("No-Only",
this.state.hideOnly);b=!!a.noSelect;this.state.noSelect!==b&&(this.state.noSelect=b,this.element.toggleClass("NoSelect",this.state.noSelect));this.setDisabled(!!a.disabled);this.price.attr("href",a.href||null)},updateDynamicFilterTooltip:function(a){this.element.removeClass("Filtered FilteredOut");if(a.filtered||a.partiallyFiltered){var b=a.filtered?this.options.messages.filtered:this.options.messages.partiallyFiltered;if(b){this.showingTooltip=!0;var d=a.displayValue;this.options.usePluralDisplayValue&&
(d=a.pluralDisplayValue);b=c.Common.Utils.String.formatString(b,d);this.element.addClass("Filtered"+(a.filtered?" FilteredOut":""));this.funnel.attr({"data-title":b,"aria-label":b,"aria-disabled":!this.options.resetOnDynamicIconClick});this.funnel.getWidget()||(this.funnelTooltipWidget=this.funnel.toolTip(this.getTooltipOptions()).getWidget())}}else this.showingTooltip&&(this.funnel.attr({title:"","aria-disabled":!0}),this.showingTooltip=!1)},computeUpdateKey:function(a){var b="selected filtered partiallyFiltered hideOnly noSelect disabled showAsNotChecked".split(" ").reduce(function(b,
c){return b+(a[c]?"1":"0")},""),b=b+(this.options.countEnabled?a.count:a.minPrice),b=b+(a.cssClass?a.cssClass:""),b=b+a.displayValue;return b+=a.href?a.href:""},getTooltipOptions:function(a){var b=this.options.cssClass&&-1!==this.options.cssClass.indexOf("kayak-flights");return e.extend({},{position:"top",extraClass:"Common-Results-Filters-ValueSetFilterItem__Tooltip "+this.options.cssClass+" "+(b?"uikit ":"")+(this.options.inModal?"modal-layer":""),orientation:b?"start":"middle",size:b?"uikit":"m"},
a)},getState:function(){return this.state.disabled&&!this.state.userSelectedDisabled?null:this.state.selected},toggleFocusStyle:function(a){this.element.toggleClass(g,a)}})})(R9,jQuery);(function(h,g){h.createComponentClass("common.results.filters.ValueSetFilter","common.results.filters.Filter",{content:null,renderedFilterOptions:null,renderedHeadings:null,options:{isMultiValueSet:!1,isDefaultChecked:!1,showAllNone:!1,onReset:null,sortInPlace:!1,sortInPlaceLazy:!1,flushState:!0,onDeselect:null,confineOnlyToHeading:!1,selectableHeadings:!1,collapsedContent:!0,showHeadingCount:!0,showHeadingOnly:!0,onChange:null,removeExpiredOptions:!0,removeExpiredHeadingsWithOptions:!1,visibleCount:0,
overflowMinimum:0,showOverflowTemplate:"",hideOverflowTemplate:"",alwaysVisibleItems:[],preventNoneChecked:!1,showItemHoverTooltip:!1,includeExcludeItems:null,reverseOptionOrder:!1,countEnabled:!1,allowZeroCount:!1,allowEmptyPrice:!1,disableOnZeroCount:!1,disableOnNoPrice:!1,showOnly:!0,showDescription:!1,resetOnDynamicIconClick:!1,extraCssClass:"",featureClass:"",onlyLinkClass:"",hidePrice:!1,messages:{},itemTooltipTextMap:null,usePluralDisplayValue:!1,onGetState:null,reloadTop:!1,logItemActions:!1,
logActionType:!0,isDropdown:!1,itemTemplateId:"valueSetFilterItem",headingTemplateId:"headingContainerItem",showTooltipForEllipsed:!1,tooltipHoverDelay:1E3,allUncheckedMeansInactive:!1,reverseSortOrder:!1,sortOverflowByCount:null,displayDefaultUnchecked:!1,openMapOnSelection:!1,inModal:!1,useStarRating:!0,useStarTextDisplayValue:!1},events:{all:"filters.valueSetFilter.showall"},showAllBtn:null,showNoneBtn:null,only:null,showOverflowLink:void 0,overflowVisible:!1,includeExcludeRadios:null,metaState:null,
showAsNotChecked:null,resetState:null,multisetOptions:null,headingValueMap:null,headingsDataMap:null,init:function(){this.base();this.renderedFilterOptions={};this.content=this.getChildElement("options");0<this.options.visibleCount&&(this.showOverflowLink=this.getChildElement("overflow"));this.showAllBtn=this.getChildElement("all");this.showNoneBtn=this.getChildElement("none");this.options.itemTooltipTextMap=this.options.itemTooltipTextMap||{};this.resetState=this.options.isMultiValueSet&&!this.options.isDefaultChecked?
0:1},addEventHandlers:function(){this.base();var a=this;void 0!==this.showOverflowLink&&(this.showOverflowLink.click(function(){a.options.isDropdown?a.getChildElement("dropdown_content").hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0):a.element.hasClass("overflow-visible")?a.hideOverflowOptions(!0):a.showOverflowOptions(!0)}),this.showOverflowLink.keypress(function(b){switch(b.which){case h.globals.keyCodes.SPACE:case h.globals.keyCodes.RETURN:a.showOverflowLink.click()}}));
this.subscribe("filters.%s.setonly".format(this.name),function(b){b=a.getRenderedFilterOptions()[b];a.options.preventNoneChecked&&(a.only.setSelectable(!0),b.setSelectable(!1));a.only=b});this.subscribe("filters.%s.setChecked".format(this.name),this.setCheckedItems.bind(this));this.subscribe("filters.%s.setUnChecked".format(this.name),this.setUnCheckedItems.bind(this));this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),this.onItemHover.bind(this));this.options.showAllNone&&
(this.registerEvent("click",this.showAllBtn,function(b){b&&g(b.target).hasClass("disabled")||a.reset({type:"all",userClick:!0,ignoreHideOverflow:!0})}),this.registerEvent("click",this.showNoneBtn,function(b){b&&g(b.target).hasClass("disabled")||a.deselect({type:"none",userClick:!0,ignoreHideOverflow:!0})}));this.options.includeExcludeItems&&(this.includeExcludeRadios=this.getChildElement("vsf-incl-radios").styleJamRadioButtonSet({change:a.onChangedIncludeExcludeRadio.bind(this)}).getWidget());this.subscribe("search.startSearch",
function(){a.showAsNotChecked=null;0<a.options.visibleCount&&a.hideOverflowOptions()});this.subscribe("filters.%s.forceReset".format(this.name),function(){a.reset()});this.options.openMapOnSelection&&this.subscribe("filters.%s.selected".format(this.name),function(){h.events.publish("results.mapToggle.toggle");h.events.publish("results.showMapEvent")})},inlineComponentsReady:function(){this.base();this.options.showTooltipForEllipsed&&!this.options.showItemHoverTooltip&&this.subscribe("filters.%s.hovering".format(this.name),
this.onItemHover.bind(this))},reset:function(a){if(!a||!(a.ignore===this.name||g.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name)))if(this.metaState=null,this.options.allUncheckedMeansInactive&&(this.showAsNotChecked=!0,h.events.publish("filters."+this.name+".showAsNotChecked",!0)),"function"===typeof this.options.onReset)this.options.onReset.apply(this,arguments);else{var b=this.options.flushState,c=this.options.displayDefaultUnchecked;this.forEachItem(function(d,f){f.state.disabled||f.state.noSelect||
(c?(b=!0,f.setChecked(0),f.state.selected=0):void 0!==f.state.showAllState&&a&&a.type&&"reset"!==a.type?(b=!1,f.setChecked(f.state.showAllState)):(d=f.state.resetState,void 0!==d&&void 0!==f.state.defaultSelectedState&&d!==f.state.defaultSelectedState&&(b=!1),f.setChecked(void 0!==d?d:this.resetState)),this.options.preventNoneChecked&&f.setSelectable(!0))});this.options.resetInTitle||!(0<this.options.visibleCount)||a&&a.ignoreHideOverflow||this.hideOverflowOptions();this.enableShowAllNone(!1,!0);
a&&a.silent?this.syncFilterState(b):this.pushStateChange(b,{reset:!0});a&&a.userClick&&(this.setLastUserInteraction(!0),this.logUserInteraction("showall"));this.only=null}},onChangedIncludeExcludeRadio:function(a){a=g(a);var b=a.val();a.is(":checked")&&b&&(this.metaState=b,this.pushStateChange())},enableShowAllNone:function(a,b){this.options.showAllNone&&(this.showAllBtn.toggleClass("disabled",!a),this.showNoneBtn.toggleClass("disabled",!b))},updateShowAllNone:function(a){this.options.showAllNone&&
(a?this.enableShowAllNone(!this.allChecked(a),this.anyChecked(a)):this.enableShowAllNone(!0,!0))},getIgnoreDeselect:function(){return null},getResetType:function(){return this.options.isDefaultChecked?"showAll":this.base()},deselect:function(a){if(!a||!(a.ignore===this.name||g.isArray(a.ignore)&&-1<a.ignore.indexOf(this.name)))if("function"===typeof this.options.onDeselect)this.options.onDeselect.apply(this,arguments);else{var b=this.getIgnoreDeselect();this.forEachItem(function(a,d){d.state.disabled||
d.state.noSelect||b&&0<=b.indexOf(a)||(d.setChecked(0),this.options.preventNoneChecked&&d.setDisabled(!1))});!(0<this.options.visibleCount)||a&&a.ignoreHideOverflow||this.hideOverflowOptions();this.enableShowAllNone(!0,!1);a&&a.silent?this.syncFilterState():this.pushStateChange(!1);a&&a.userClick&&this.logUserInteraction(a.type)}},cleanupExistingState:function(){this.forEachItem(function(a,b){h.ComponentManager.remove(b.id())});this.renderedFilterOptions={};this.multisetOptions=null;this.getOptionsContainer().empty()},
sortRenderedFilterOptions:function(a){if(a.useHeadings)for(var b=Object.keys(a.headingValueMap),c=0;c<b.length;c++){var d=this.getOptionsContainer().find('.heading[data-heading\x3d"%s"]'.format(b[c])).find(".content");this.sortOptionsInPlace(d,a.headingValueMap[b[c]])}else this.sortOptionsInPlace(this.getOptionsContainer(),a.valueMap)},sortOptionsInPlace:function(a,b){var c=a.find(".Common-Results-Filters-ValueSetFilterItem");0!==c.length&&(c=c.toArray().sort(function(a,c){a=b[g(a).data("name")];
c=b[g(c).data("name")];return a&&c?a.displayOrder-c.displayOrder:0}),g(c).detach().appendTo(a))},addOptionToFilterMap:function(a,b,c,d,f){var e=this.id()+"-"+Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,""),e=g.extend({id:e,name:a},b,{showCount:this.options.countEnabled,showPrice:!this.options.countEnabled&&!this.options.hidePrice,itemTemplateId:this.options.itemTemplateId,hasCount:this.options.allowZeroCount?0<=b.count:0<b.count,hasPrice:this.options.allowEmptyPrice||b.minPrice,disabled:this.options.disableOnZeroCount?
0===b.count:!1,tooltipText:this.options.itemTooltipTextMap[a],showOnly:this.options.showOnly,showDescription:this.options.showDescription,hideDisplayValue:"stars"===this.options.name&&!this.options.useStarTextDisplayValue,useStarRating:this.options.useStarRating,onlyLinkClass:this.options.onlyLinkClass,optionsContainer:this.getOptionsContainer(),useMcFlyStyling:this.options.useMcFlyStyling?"mcfly-styling":"",featureClass:this.options.featureClass?this.options.featureClass.trim():""},f||{});f=h.template.renderElement(e.itemTemplateId,
e);var n=b.displayOrder,l=function(a,b){return a>b};this.options.reverseSortOrder&&(l=function(a,b){return a<b});var k=null;this.forEachItem(function(a,b){l(b.state.displayOrder,n)&&(null!==k?l(k.state.displayOrder,b.state.displayOrder)&&(k=b):k=b)},d);if(null===k||void 0!==c)if(e=e.optionsContainer,c){var m=e.find('.heading[data-heading\x3d"%s"]'.format(c));m.length||(m=this.makeHeadingContainer(c),e.append(m));m.find(".content").append(f)}else this.options.reverseOptionOrder?e.prepend(f):(f.insertAfter(k),
e.append(f));else f.insertBefore(k.element);b=this.makeFilterOption(f,b,a,c);d[a]=b;b.element.on("mouseenter",this.publishHoverState.bind(this,!0,{item:b.options.name}));b.element.on("mouseleave",this.publishHoverState.bind(this,!1,{item:b.options.name}))},addFilterItem:function(a,b,c,d){this.addOptionToFilterMap(a,b,c,this.getRenderedFilterOptions(),d)},makeFilterOption:function(a,b,c,d,f){var e=this;return new h.common.results.filters.ValueSetFilterItem(a,g.extend(!0,{},{state:b,name:c,group:this.name,
cssClass:this.options.extraCssClass+" "+this.options.featureClass+(f&&f.cssClass?" "+f.cssClass:""),onUserChange:function(){e.filterItemDidChange.apply(e,Array.prototype.slice.call(arguments).concat(this))},heading:d,headingOnlyState:this.options.confineOnlyToHeading?1:2,countEnabled:this.options.countEnabled,allowZeroCount:this.options.allowZeroCount,disableOnZeroCount:this.options.disableOnZeroCount,resetOnDynamicIconClick:this.options.resetOnDynamicIconClick,messages:this.options.messages,tooltipText:this.options.itemTooltipTextMap[c],
enableActionLogging:this.options.logItemActions,enableActionTypeLogging:this.options.logActionType,usePluralDisplayValue:this.options.usePluralDisplayValue,allUncheckedMeansInactive:this.options.allUncheckedMeansInactive,openMapOnSelection:this.options.openMapOnSelection,inModal:this.options.inModal},f||{}))},makeHeading:function(a){var b=this,c=this.id()+"-"+Math.floor(1E4*Math.random())+"-"+a.replace(/\W+/g,""),d=b.headingsDataMap&&b.headingsDataMap[a],c=h.template.renderElement(b.options.headingTemplateId,
{id:c,heading:a,showOnly:b.options.showHeadingOnly,showCount:b.options.showHeadingCount,collapsedContent:b.options.collapsedContent,selectable:b.options.selectableHeadings,selected:d?b.headingsDataMap[a].selected:!1,description:d?b.headingsDataMap[a].description:"",count:d?b.headingsDataMap[a].count:"",useMcFlyStyling:this.options.useMcFlyStyling?"mcfly-styling":"",featureClass:this.options.featureClass?this.options.featureClass.trim():""});this.renderedHeadings||(this.renderedHeadings={});this.renderedHeadings[a]=
c;this.options.selectableHeadings&&(c.find(".HeadingCheckbox").checkbox({change:function(c){if(!g(c).hasClass("Disabled")){var d=g(c).find("input").is(":checked");h.Analytics.api.trackEvent({category:"filters",action:a,label:"click"});b.onHeadingClick(a,g(c).find("input").is(":checked"));b.pushStateChange(null,{changeData:{field:b.headingsDataMap[a].code+"__ALL",value:d?1:0,displayValue:a}})}}}).getWidget().setChecked(d?b.headingsDataMap[a].selected:!1),this.options.showOnly&&this.registerEvent("click",
c.find(".only"),this.onHeadingOnlyClick.bind(this,a,!1)));return c},onHeadingClick:function(a,b){var c=this;Object.keys(this.headingValueMap[a]).forEach(function(a){c.getRenderedFilterOptions()[a].setChecked(b?1:0)})},onHeadingOnlyClick:function(a,b){var c=this;Object.entries(this.renderedHeadings).forEach(function(b){var d=b[0]===a;b[1].find(".HeadingCheckbox").find("input").prop("checked",d);c.onHeadingClick(b[0],d)});b||(h.Analytics.api.trackEvent({category:"filters",action:a,label:"only"}),this.pushStateChange())},
makeHeadingContainer:function(a){var b;this.options.selectableHeadings?b=this.makeHeading(a):(b="\x3cdiv class\x3d'heading' data-heading\x3d\""+a+'"\x3e%s\x3c/div\x3e',a="\x3cdiv class\x3d'title'\x3e%s\x3c/div\x3e\x3cdiv class\x3d'content'\x3e\x3c/div\x3e".format(a),b=g(b.format(a)));return b},shouldBeVisible:function(a){return(a=a.useHeadings?a.headingValueMap:a.valueMap)&&0<Object.keys(a).length},logUserInteraction:function(a,b){if("ga"===this.options.loggingType){a=a.split("/");var c;a[0]&&(c=
"reset"===a[0]?"showall":a[0]);var d=this.getRenderedFilterOptions()[a[0]];a[1]&&"toggle"===a[1]&&d&&(a[1]=d.state.selected?"show":"hide");a[1]&&(c=(b?"":a[1]+"-")+c+(b?"-"+a[1]:""));this.base({category:this.trackCategory,action:this.name,label:c})}else this.base(a)},filterItemDidChange:function(a,b,c,d){var f={field:a,value:c&&c.state.selected,displayValue:c&&c.state.displayValue};if(this.options.allUncheckedMeansInactive){var e=this.getRenderedFilterOptions();null==this.showAsNotChecked&&(this.showAsNotChecked=
Object.keys(e).every(function(b){var c=0<e[b].state.selected;return b===a?!c:c}));this.showAsNotChecked?(h.events.publish("filters."+this.name+".showAsNotChecked",!1),this.showAsNotChecked=!1,e[a].setChecked(1),b="only"):0===Object.keys(e).filter(function(a){return 0<e[a].state.selected}).length&&(h.events.publish("filters."+this.name+".showAsNotChecked",!0),this.showAsNotChecked=!0,this.forEachItem(function(a,b){b.setChecked(1)}),b="showall")}this.multisetOptions&&c&&Object.keys(this.multisetOptions).forEach(function(b){var c=
this.multisetOptions[b],d=a===b,f=0<this.getRenderedFilterOptions()[b].getState();d?this.forEachItem(function(a,b){b.state.meta||(a=-1<c.indexOf(a),f?b.setChecked(a?1:0):a||b.setChecked(1))}):-1===c.indexOf(a)&&this.getRenderedFilterOptions()[b].setChecked(0)},this);"only"===b||"price"===b||"count"===b?(this.only=this.getRenderedFilterOptions()[a],this.forEachItem(function(b,c){c.options.state.ignoreOnly||c&&b!==a&&(this.only.options.heading&&this.options.confineOnlyToHeading?this.only.options.heading===
c.options.heading&&c.setChecked(0):c.setChecked(0))}),"price"===b&&h.events.publish("filters.selectedprice",{ignore:this.name})):this.only&&this.unsetOnlyOption(a);"function"===typeof this.options.onChange&&this.options.onChange.call(this,c);d||(this.setLastUserInteraction(!0),this.pushStateChange(null,{changeData:f}),this.updateFilterHistory(),this.options.logUserInteraction&&(this.logUserInteraction("showall"===b?b:a+"/"+b),c&&c.state.filtered&&h.Analytics.api.trackEvent("filters/filteredItem/"+
b)));c&&0!==c.getState()&&h.events.publish("gtm.update",{event:"resultsFilterChange",filterName:this.name,filterValue:a});this.options.reloadTop&&window.scrollTo(0,0)},unsetOnlyOption:function(a){a!==this.only.options.name?(this.only.setChecked(1),this.only=null):a===this.only.options.name&&2!==this.only.state.selected&&(this.only=null)},update:function(a){var b=this,c=!1,d=Object.keys(this.getRenderedFilterOptions()).length;this.options.showDescription&&this.updateDescriptions(a);this.multisetOptions=
a.multisetOptions;a.hasOwnProperty("headingsDataMap")&&(this.headingsDataMap=a.headingsDataMap);var f=g.extend(!0,{},a);if(f.useHeadings){this.headingValueMap=f.headingValueMap;for(var e=Object.keys(this.headingValueMap),h=0;h<e.length;h++){var l=e[h],l=this.updateItems(this.headingValueMap[l],l,f);c||(c=l)}if(f.orderedHeadings){var k=f.orderedHeadings;this.getOptionsContainer().find(".heading").sort(function(a,b){return k.indexOf(g(a).data("heading"))>k.indexOf(g(b).data("heading"))?1:k.indexOf(g(a).data("heading"))<
k.indexOf(g(b).data("heading"))?-1:0}).appendTo(this.getOptionsContainer())}this.options.selectableHeadings&&this.getOptionsContainer().find(".heading").each(function(c,d){var f=!1,e=!0;g(d).find("li").each(function(a,c){a=b.getRenderedFilterOptions()[g(c).data("name")];a.state.selected&&(f=!0);a.state.disabled||(e=!1)});c=g(d).find(".HeadingCheckbox");c.find("input").prop("checked",f);c.toggleClass("Disabled",e);c.attr("aria-disabled",e);g(d).toggleClass("Disabled",e);c=g(d).data("heading");a.hasOwnProperty("headingsDataMap")&&
a.headingsDataMap[c]&&g(d).find(".headingCount").text(a.headingsDataMap[c].count)});this.options.removeExpiredHeadingsWithOptions&&this.getOptionsContainer().find(".heading").each(function(a,c){(a=g(c).data("heading"))&&""!==a&&0>e.indexOf(a)&&(g(c).find("li").each(function(a,c){(a=g(c).data("name"))&&""!==a&&delete b.getRenderedFilterOptions()[a]}),g(c).remove())})}else c=this.updateItems(f.valueMap,void 0,f);(this.options.sortInPlace||this.options.sortInPlaceLazy&&d!==Object.keys(this.getRenderedFilterOptions()).length)&&
this.sortRenderedFilterOptions(f);this.element.hasClass("empty")&&c&&this.element.removeClass("empty");this.options.showAllNone&&this.updateShowAllNone(f.valueMap)},updateItems:function(a,b,c){if(!a)return!1;var d=this.updateMetaItems(a),f=this,e=Object.keys(d);a=0<e.length;var g=!1,e=e.sort(function(a,b){return d[a].displayOrder-d[b].displayOrder});this.options.disableOnNoPrice&&e.forEach(function(a){a=d[a];a.minPrice||(a.disabled=1,a.selected=0)});this.options.displayDefaultUnchecked?(this.showAsNotChecked=
this.allChecked(d))&&e.forEach(function(a){d[a].selected=0;d[a].showAllState=0}):this.options.allUncheckedMeansInactive&&null==this.showAsNotChecked&&(this.showAsNotChecked=this.allChecked(d))&&e.forEach(function(a){d[a].showAsNotChecked=!0});e.filter(function(a){return f.getRenderedFilterOptions().hasOwnProperty(a)}).forEach(function(a){var b=d[a];f.getRenderedFilterOptions()[a].update(b)});var l={};e.length>this.options.overflowMinimum&&(l=this.getOverflowItems(e,d));e.forEach(function(a){var e=
d[a];e.showAsNotChecked=f.showAsNotChecked;f.getRenderedFilterOptions().hasOwnProperty(a)||f.addFilterItem(a,e,b,{filtersData:c});l&&l[a]&&(0===e.selected||f.options.isDefaultChecked)?(f.getRenderedFilterOptions()[a].element.addClass("overflow-item").attr("aria-hidden",!0),g=!0):f.getRenderedFilterOptions()[a].element.removeClass("overflow-item").attr("aria-hidden",!1);2===e.selected&&(f.only=f.getRenderedFilterOptions()[a])});this.options.preventNoneChecked&&this.disableOnlyOption();if(void 0!==
this.showOverflowLink&&!this.element.hasClass("overflow-visible")){this.showOverflowLink.toggleClass("visible",g);this.showOverflowLink.attr("aria-pressed",function(a){return"false"===a?"true":"false"});if(g&&(this.options.showOverflowTemplate||this.options.hideOverflowTemplate)){var e={},k=Object.keys(l).length;this.options.showOverflowTemplate&&(e.more=h.Common.Utils.String.formatChoice(this.options.showOverflowTemplate,k,k),this.overflowVisible||this.getChildElement("overflow-text").text(e.more));
this.options.hideOverflowTemplate&&(e.less=h.Common.Utils.String.formatChoice(this.options.hideOverflowTemplate,k,k),this.overflowVisible&&this.getChildElement("overflow-text").text(e.less));Object.keys(e).length&&this.showOverflowLink.data(e)}this.options.collapsedContent&&(this.element.find(".heading").addClass("collapsed"),this.showOverflowLink.toggleClass("visible",!0))}this.handleExpiredOptions(d,b);return a},updateMetaItems:function(a){if(!a)return a;var b=this,c=Object.keys(a),d={},f=function(b){return b&&
a[b]&&a[b].meta};if(1>c.length||!c.some(f))return a;c.forEach(function(c){var e;f(c)&&g.isArray(b.options.includeExcludeItems)&&0<=b.options.includeExcludeItems.indexOf(c)&&(e=!0,b.includeExcludeRadios&&a[c].selected&&(b.includeExcludeRadios.setButtonCheckedByValue(c),b.metaState=b.metaState&&b.metaState===c?c:null));e||(d[c]=a[c])});return d},updatePlaceholderDisplay:function(a){this.options.isDropdown?this.base(a):a&&(this.getChildElement("placeholder").toggleClass("hidden",!a.visible),this.getChildElement("options").toggleClass("hidden",
!!a.visible))},updateDescriptions:function(a){var b=a.valueMap,c=a.descriptions;Object.keys(c).forEach(function(a){var d=b[a];null!=d&&(d.description=c[a])})},allChecked:function(a){var b=Object.keys(a),c=this.getIgnoreDeselect();return b.length?b.every(function(b){return 0<a[b].selected||0<a[b].disabled||c&&0<=c.indexOf(b)}):null},anyChecked:function(a){var b=Object.keys(a),c=this.getIgnoreDeselect();return b.length?b.some(function(b){return 0<a[b].selected&&!a[b].disabled&&(!c||0>c.indexOf(b))}):
null},getOverflowSorter:function(a){return this.options.sortOverflowByCount?function(b,c){b=a.hasOwnProperty(b)?a[b].count:0;return(a.hasOwnProperty(c)?a[c].count:0)-b}:null},getOverflowItems:function(a,b){var c=this;if(0<this.options.visibleCount){var d=a.filter(function(a){return-1===c.options.alwaysVisibleItems.indexOf(a)});a=this.options.visibleCount-(a.length-d.length);var f=d;b=c.getOverflowSorter(b);"function"===typeof b&&(f=d.sort(b));var e={};f.slice(a).forEach(function(a){e[a]=a});return e}return null},
handleExpiredOptions:function(a,b){this.forEachItem(function(c,d){a.hasOwnProperty(c)||d.options.heading!==b||(this.options.removeExpiredOptions?(h.ComponentManager.remove(d.id()),delete this.getRenderedFilterOptions()[c]):d.setChecked(0))})},disableOnlyOption:function(){var a=this.getRenderedFilterOptions();if("object"===typeof a&&0!==a.length){var b=Object.keys(a),c=b.filter(function(b){return 0<a[b].getState()});b.forEach(function(b){a[b].setSelectable(!0)});1===c.length?a[c[0]].setSelectable(!1):
0===c.length&&this.log.console("ValueSetFilter#DisableOnlyOption: No filter options checked while preventNoneChecked is true. \nFilter name: "+this.options.name)}},setCheckedItems:function(a){this.forEachItem(function(b,c){0<=a.items.indexOf(b)?c.setChecked(1):c.setChecked(0)});this.pushStateChange()},setStateFromPrevious:function(a){var b=this.getRenderedFilterOptions()[a.key];if(b)if(a.reset)2===b.getState()?this.reset({silent:!0}):b.setChecked(void 0!==b.state.resetState?b.state.resetState:this.resetState);
else{if(a.hasOwnProperty("value")){var c=parseInt(a.value,10);b.setChecked(c);this.filterItemDidChange(a.key,2===c?"only":null,b,!0)}}else this.options.selectableHeadings&&a.key&&a.key.endsWith("__ALL")&&this.setHeadingFromPrevious(a)},setHeadingFromPrevious:function(a){var b=parseInt(a.value,10),c=this.getHeadingForCode(a.key.replace("__ALL",""));if(2===b)this.onHeadingOnlyClick(c,!a.reset);else a.reset&&(b=0===b?1:0),this.onHeadingClick(c,0<b)},getHeadingForCode:function(a){for(var b=Object.keys(this.headingsDataMap),
c,d=0;d<b.length;d++)if(this.headingsDataMap[b[d]].code===a){c=b[d];break}return c},updatePreviousFilters:function(a){a?Object.keys(this.previousFilters).forEach(function(b){var c=parseInt(this.previousFilters[b],10);if(a&&a.hasOwnProperty(b)){var d=a[b];d===c||2===d&&0<c||this.removePreviousFilter(b)}else this.options.selectableHeadings&&b.endsWith("__ALL")&&this.updatePreviousFilterHeading(b,a)},this):this.removePreviousFilter()},updatePreviousFilterHeading:function(a,b){var c=b[a],d=this.getHeadingForCode(a.replace("__ALL",
"")),f=[];Object.entries(this.headingValueMap).forEach(function(a){var e=a[0];a=Object.keys(a[1]).filter(function(a){return void 0!==b[a]});if(2>c||e!==d)f=f.concat(a)});var e=!1;(e=2===c||0===c?f.some(function(a){return 1===b[a]}):f.some(function(a){return 0===b[a]}))&&this.removePreviousFilter(a)},setUnCheckedItems:function(a){this.forEachItem(function(b,c){0<=a.items.indexOf(b)?c.setChecked(0):c.setChecked(1)});this.pushStateChange()},onItemHover:function(a){if(!a.hasOwnProperty("namespace")||
a.namespace===this._namespace){var b=this.renderedFilterOptions[a.item],c=(h.question.ask("hotels.results.filtersPinned")||!1)&&!this.options.inModal;if(this.options.showTooltipForEllipsed&&!0===a.hover){var d=b.element.find("label");if(d.length&&d[0].offsetWidth>=d[0].scrollWidth)return}!0===a.hover?b.element.toolTip({content:b.options.state.displayValue,position:c?"bottom":"top",showImmediately:!0,delay:this.options.tooltipHoverDelay}):!1===a.hover&&b.element.data("toolTip")&&b.element.data("toolTip").removeWidget()}},
showOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").addClass("overflow-visible").attr("aria-expanded",!0),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!1)):(this.element.addClass("overflow-visible").attr("aria-expanded",!0),this.element.find(".overflow-item").attr("aria-hidden",!1));this.getChildElement("overflow").attr("aria-pressed",!0);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("less"));
if(this.options.collapsedContent){var b=document.documentElement.scrollTop||document.body.scrollTop;this.element.find(".heading").removeClass("collapsed");this.element.find(".heading").addClass("expanded");document.documentElement.scrollTop=b}this.overflowVisible=!0;a&&this.logUserInteraction("overflow/showmore",!0);h.events.publish("filter.overflow.toggle")},hideOverflowOptions:function(a){this.options.isDropdown?(this.getChildElement("dropdown_content").removeClass("overflow-visible").attr("aria-expanded",
!1),this.getChildElement("dropdown_content").find(".overflow-item").attr("aria-hidden",!0)):(this.element.removeClass("overflow-visible").attr("aria-expanded",!1),this.element.find(".overflow-item").attr("aria-hidden",!0));this.showOverflowLink.attr("aria-pressed",!1);this.showOverflowLink.find(".text").html(this.showOverflowLink.data("more"));if(this.options.collapsedContent){var b=document.documentElement.scrollTop||document.body.scrollTop;this.element.find(".heading").addClass("collapsed");this.element.find(".heading").removeClass("expanded");
document.documentElement.scrollTop=b}this.overflowVisible=!1;a&&this.logUserInteraction("overflow/showless",!0);h.events.publish("filter.overflow.toggle")},forEachItem:function(a,b){var c=this,d=b||this.getRenderedFilterOptions();Object.keys(d).forEach(function(b){a.call(c,b,d[b])},this)},getRenderedFilterOptions:function(){return this.renderedFilterOptions},getOptionsContainer:function(){return this.content},getState:function(){var a={};this.metaState&&(a[this.metaState]=1);this.forEachItem(function(b,
c){var d=c.getState();null!==d&&(a[c.state.code||b]=d)},g.extend({},this.getRenderedFilterOptions()));this.options.onGetState&&(a=this.options.onGetState.call(this,a));return a},getHistoryFilterViewState:function(a){var b={};this.forEachItem(function(a,c){var d=c.getState();b[c.state.code||a]=d},g.extend({},this.getRenderedFilterOptions()));var c=this.showCheckedFilterHistory()?"1":"0",d={},f=null,e=Object.keys(a).filter(function(b){b=a[b];if(g.isArray(b)){if(b.filter(function(a){return 2===parseInt(a,
10)}).length)return!0}else return 2===parseInt(b,10);return!1}),e=e.length?e[0]:null,h=Object.keys(a).filter(function(a){return b.hasOwnProperty(a)}),l=function(a,c){var d=b[a],f={},e=null;g.isArray(d)?(f[a]=[],d.forEach(function(b){b===c?null===e&&(e=!0):e=!1;f[a].push(c)})):(e=c===d,f[a]=c);return{state:f,isAlreadyApplied:e}};return e?b.hasOwnProperty(e)?g.extend({},l(e,"2"),{only:e}):{disabled:!0}:h.length?(h.forEach(function(a){var b=l(a,c);d[a]=b.state[a];b.isAlreadyApplied?null===f&&(f=b.isAlreadyApplied):
f=!1}),{state:d,isAlreadyApplied:f}):{disabled:!0}},getStateForFilterHistory:function(){var a={},b=this;this.forEachItem(function(b,d){var c=d.getState();null!==c&&(a[d.state.code||b]=c)},g.extend({},this.getRenderedFilterOptions()));return g.extend({},{displayName:this.options.title,type:h.question.ask("filters.FilterHistory.type.checkbox"),inclusive:this.showCheckedFilterHistory(),state:g.extend({},a),displayValue:Object.keys(a).reduce(function(a,d){a[d]=b.getFilterHistoryDisplayValue(d);return a},
{})})},getFilterHistoryDisplayValue:function(a){var b=h.config.getBoolean("ui.horizon.filters.history.%s.show.code.only".format(this.name),!1),c=this.getRenderedFilterOptions();return c.hasOwnProperty(a)?b?c[a].state.code:c[a].state.displayValue:null},showCheckedFilterHistory:function(){return h.config.getBoolean("ui.horizon.filters.history.%s.show.checked.items".format(this.name),!1)},trackStateChange:function(a){if(this.trackStateChangeEnabled(a)&&this.trackingType){var b=h.VestigoType,c=h.VestigoType.FilterType,
d=h.VestigoEvents.filters,f=a.changeData.field,e=this.getTrackingAction(a.changeData.value);switch(this.trackingType){case c.cabin:a=b.CabinType[f||"m"];d.flights.cabin(a,e);break;case c.sameair:d.flights.sameAirport(e);break;case c.alliance:a=b.AllianceType[f];d.flights.alliance(a,e);break;case c.layoverair:d.flights.layOverAirport(f,e);break;case c.aircraft:a=b.AircraftType[f];d.flights.aircraft(a,e);break;case c.model:a=b.AircraftModelType[f];d.flights.model(a,e);break;case c.freebies:d.hotels.freebies(b.FreebieOption[f],
e);break;case c.neighbourhood:d.hotels.neighbourhood(f,a.changeData.displayValue,e);break;case c.amenities:d.hotels.amenities(f,e);break;case c.style:d.hotels.style(f,e);break;case c.property:d.hotels.property(f,e);break;case c.other:d.hotels.other(b.PriceOption[f],e);break;case c.provider:d.shared.provider(f,e);break;case c.airlines:d.flights.airlines(f,e);break;case c.roomtype:d.packages.roomtype(b.RoomType[f],e);break;case c.propertytype:d.packages.propertytype(f,e);break;case c.board:d.packages.board(b.BoardType[f],
e);break;case c.stars:d.hotels.stars(f,e);break;case c.flightquality:(a=b.FlightQualityType[this.name])&&d.flights.flightquality(a,e)}}}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.filters.IconSetFilterItem","common.results.filters.ValueSetFilterItem",{})})(R9);(function(e){e.createComponentClass("common.results.filters.IconSetFilter","common.results.filters.ValueSetFilter",{options:{keelColumns:3,iconUrlMap:{},smallLabelOptions:[],itemTemplateId:"iconSetFilterItem"},svgTemplateId:"svgIcons",withImage:!0,init:function(){this.base();this.svgTemplateId=this.options.svgTemplateId||this.svgTemplateId},getIconUrl:function(b){var a=this.options.iconUrlMap[b];a||this.log.console("no file path found for option "+b+".","iconUrlMap: ",this.options.iconUrlMap);return a},
getPrerenderedSvg:function(b){var a=e.template.renderElement(this.svgTemplateId,{}),a=$(a).filter(function(a,d){if($(d).data("option")===b)return d});return 0===a.length?"":$(a).html().trim()},makeFilterOption:function(b,a,h,d){var c=this;return new e.common.results.filters.IconSetFilterItem(b,{state:a,name:h,group:this.name,onUserChange:function(){c.filterItemDidChange.apply(c,Array.prototype.slice.call(arguments).concat(this))},heading:d,useMcFlyStyling:this.options.useMcFlyStyling?"mcfly-styling":
""})},addOptionToFilterMap:function(b,a,e,d){var c=this.getIconUrl(b),f=c&&0<=c.indexOf(".svg"),g=-1!==this.options.smallLabelOptions.indexOf(b)?"small-label":"";0==a.count&&(g+=" disabled");c={imageUrl:c,isSvgImage:f,keelColumns:this.options.keelColumns,extraCssClass:g};f&&(f=this.getPrerenderedSvg(b))&&(c.svgMarkup=f);this.base(b,a,e,d,c)}})})(R9);(function(b,d){b.createComponentClass("hotels.results.filters.ReviewScoreFilter","common.results.filters.AndUpFilter",{startPopover:null,closeTimeout:null,autoCloseTimeout:null,options:{ratingOptions:null,showStartPopover:!1,popoverFadeTimeout:30,classNameForPopover:""},init:function(){this.base();this.startPopover=this.getChildElement("StartTooltip")},addEventHandlers:function(a){this.base(a);var c=this;this.subscribe("resultspage.streaming.firstPhase.done",function(){c.initStartPopover()});this.registerEvent("click",
d(".topFilters, .showMap"),function(){c.disablePopover()});this.subscribe(["provider.book.click","authentication.showLogin","result.details.opened"],function(){c.closePopover()});this.registerEvent("resize",d(window),function(){c.isPopoverEnabled()&&c.positionPopover(jq(c.options.classNameForPopover),c.startPopover)});null!=this.options.ratingOptions?this.options.ratingOptions.each(function(a){b.events.subscribe("filters.%s.%s.resetitem".format(c.name,a),function(a){b.events.publish("filter.reset",
{name:c.name})})}):b.events.subscribe(["filters.rating.okay.resetitem","filters.rating.good.resetitem","filters.rating.excellent.resetitem","filters.rating.mediocre.resetitem"],function(a){b.events.publish("filter.reset",{name:"rating"})})},updatePlaceholderDisplay:function(a){this.options.isDropdown?this.base(a):a&&(this.getChildElement("placeholder").toggleClass("hidden",!a.visible),this.getChildElement("options").toggleClass("hidden",!!a.visible))},initStartPopover:function(){var a=this;this.isPopoverEnabled()&&
(window.setTimeout(function(){a.positionPopover(jq(a.options.classNameForPopover),a.startPopover);a.startPopover.fadeIn("slow");jq("body").append(a.startPopover);a.timeoutPopover();a.startPopover.find(".closeLink").off("click").on("click",function(){a.disablePopover()})},1E3),this.autoCloseTimeout=window.setTimeout(function(){a.startClose(a.startPopover)},1E3*this.options.popoverFadeTimeout))},isPopoverEnabled:function(){return 0<this.startPopover.length&&this.checkShowStartPopover()},timeoutPopover:function(){b.storage.set("filterUsePromoTimeoutStart",
Date.now())},disablePopover:function(){this.setDisablePromoUse();this.closePopover()},closePopover:function(){clearTimeout(this.autoCloseTimeout);this.startClose(this.startPopover)},setDisablePromoUse:function(){b.storage.remove("filterUsePromoTimeoutStart");b.storage.set("disableFilterUsePromo","true")},checkShowStartPopover:function(){var a=b.storage.get("disableFilterUsePromo"),c=b.storage.get("filterUsePromoTimeoutStart");if(!a)if(c){if(c+864E5<Date.now())return b.storage.remove("filterUsePromoTimeoutStart"),
!0}else return!0;return!1},positionPopover:function(a,c){var b=jq(a).offset();c.css({top:b.top+70,left:b.left+jq(a).outerWidth()+10})},startClose:function(a){var c=this;this.closeTimeout=setTimeout(function(){a.find(".closeIcon").hide();a.fadeOut("slow",function(){c.element.append(a)})},100)},getFilterPillDisplayValues:function(){var a=null,c={};this.cards.filter(":not(.hidden):not(.disabled)").each(function(b,e){b=d(e);e=b.attr("data-val");var f=b.attr("data-message");null==a&&b.is(".selected")&&
(a=e);c[e]=[f,d.trim(b.text())]});return{lowestKey:a,displayValues:c}},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&b.VestigoEvents.filters.hotels.reviews(this.resolveVestigoValue(a.changeData.field),this.getTrackingAction(a.changeData.value))},resolveVestigoValue:function(a){return a?b.VestigoType.ReviewsOption[a]:b.VestigoType.ReviewsOption.any}})})(R9,jQuery);(function(f,d){var m=f.config.getString("ui.horizon.common.core.focusOutlineClass","a11y-focused");f.createWidgetClass("dropdown.DropdownDialog",{element:null,elementNode:null,content:null,placeholder:null,label:null,value:null,icon:null,isOpen:!1,leftOffset:0,ajaxLoadFailed:!1,eventSuffix:null,openDisabled:!1,subValue:null,animationDuration:200,changePosition:!1,positionCss:{},rtlAlignment:void 0,options:{autoOpen:!1,alignment:null,calculateAlignment:!0,direction:"down",isPopover:!1,showIcon:!0,
matchWidth:!1,isFixedWidth:!1,repositionWithStyle:!1,scrollOffset:157,fixedPositionOffset:45,loadWithAjaxOnInit:!1,ajaxUrl:"",ajaxData:{},iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:0,leftOffset:0,removeZIndex:!1,flippable:!0,delayShowDropdown:d.noop,showDropdownDelay:200,hasSubValue:!1,animateClose:null,expandTo:null,forceTriggerWidth:!1,useCover:!1,closeEvent:null,stopClickPropagation:!1,checkIsOutsideScreen:!1,
tooltipIcon:"",tooltipText:"",showModalBp:-1,rotateArrow:!1},init:function(){!this.options.alignment&&this.element&&this.element.data("alignment")&&(this.options.alignment=this.element.data("alignment"));!this.options.expandTo&&this.element&&this.element.data("expandto")&&(this.options.expandTo=this.element.data("expandto"));this.options.alignment||(this.options.alignment="left");this.eventSuffix=".DropdownDialog."+this.id();this.options.autoOpen&&this.open();if(this.options.onInit)this.options.onInit(this);
this.createContent();this.elementNode=this.element[0];this.createTrigger();this.popoverArrow=this.getChildElement("popover-arrow");this.options.loadWithAjaxOnInit&&this.options.ajaxUrl&&this.loadAjax();this.options.alignment||(this.options.alignment="left");this.options.useCover&&(this.cover=this.getChildElement("cover"),this.coverInner=this.getChildElement("cover-inner"));if(this.options.tooltipIcon){var a=this.getChildElement("tooltip");a.toolTip({content:a.data("message"),extraClass:"halfWidth"})}},
closeOnBodyClick:function(a){this.isOpen&&(!this.content||!this.content[0]||this.content[0]!==a.target&&1>this.content.find(a.target).length)&&(this.close(),f.events.publish("DropdownDialog.clickOutsideClose",{id:this.id()}))},changeDropdownPosition:function(a){this.id()===a.id&&(this.changePosition=a.changePosition,this.positionCss=a.positionCss)},addEventHandlers:function(){var a=this,b;b=this.options.triggerClass?d("."+a.options.triggerClass):d(a.element);f.globals.testMode&&b.attr("data-test-popover-trigger",
"");this.closeOnBodyClick=this.closeOnBodyClick.bind(this);this.handleToggleContent=this.handleToggleContent.bind(this);var c=["authentication.showLogin","trips.menu.open","afterclick.dialog.opened","common.dropdown.closeAll"];this.options.closeEvent&&c.push(this.options.closeEvent);this.subscribe(c,this.close.bind(this,null,!0));this.subscribe("travelers.dropdown.change.position",this.changeDropdownPosition.bind(this));var c="click.dialog"+this.eventSuffix,e=d("body");this.registerEvent("click"+
this.eventSuffix,b,this.handleToggleContent);if(this.isOpen)e.on(c,closeOnBodyClick);this.registerEvent("keydown",function(b){var c=f.globals.keyCodes,e=!1;b.which===c.SPACE||b.which===c.RETURN||b.which===c.DOWN?(a.handleToggleContent(b),e=!0):b.which===c.UP&&(a.handleToggleContent(b,{focusLast:!0}),e=!0);e&&(b.preventDefault(),b.stopImmediatePropagation(),b.stopPropagation())});this.registerEvent("focus",function(){a.element.addClass("focus").addClass(m)});this.registerEvent("blur",function(){a.element.removeClass("focus").removeClass(m)})},
handleToggleContent:function(a,b){var c="click.dialog"+this.eventSuffix,e=d("body"),h=this;this.options.stopClickPropagation&&a.stopPropagation();e.off(c,this.closeOnBodyClick);this.toggleContent(b);h.isOpen&&setTimeout(function(){e.on(c,h.closeOnBodyClick)},10)},bindOpenDialogEvents:function(){var a=this;d(document).on("keydown"+this.eventSuffix,function(b){b.which===f.globals.keyCodes.ESC&&a.close(b,null,!0)});d(window).on("resize"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});d(document).on("scroll"+
this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});d(".viewport").on("scroll"+this.eventSuffix,function(){a.isOpen&&a.reposition(!0)});var b=function(){a.element.is(":visible")&&(f.Common.Utils.Browsers.isIE(11)||setTimeout(function(){a.reposition(!0)},25))};this.registerEvent("click",this.content.find(".close"),this.close.bind(this));this.registerEvent("mouseup touchend",this.content,b);this.subscribe("horizon.dropdownDialog.reposition",b)},destroy:function(){this.base();this.removeOpenDialogEvents()},
removeOpenDialogEvents:function(){d(".viewport").off("scroll"+this.eventSuffix);d(window).off("resize"+this.eventSuffix);d(document).off("scroll"+this.eventSuffix).off("keydown"+this.eventSuffix);d(document.body).off("click"+this.eventSuffix).off("click.dialog"+this.eventSuffix)},createContent:function(){this.content=this.options.content?d(this.options.content):d("#"+this.element.attr("id")+"_content");this.options.isFixedWidth&&this.content.css("width",this.getTriggerWidth()+"px");this.content.hasClass("open")&&
(this.isOpen=!0)},createTrigger:function(){this.element.hasClass("open")&&(this.isOpen=!0);this.label=this.element.find(".label");this.label.length||(this.label=d("\x3cdiv\x3e",{"class":"label"}),this.element.prepend(this.label));this.placeholder=this.element.find(".placeholder");this.placeholder.length||(this.placeholder=d("\x3cdiv\x3e",{"class":"placeholder",text:this.options.placeholder}),this.element.append(this.placeholder));this.options.showIcon&&(this.icon=this.element.find(".icon"),this.icon.length||
(this.icon=d("\x3cdiv\x3e",{"class":"icon "+this.options.iconClass}),this.element.append(this.icon)));this.options.hasSubValue&&(this.value=this.label.find(".value"),this.value.length||(this.value=d("\x3cdiv\x3e",{"class":"value"}),this.label.prepend(this.value)),this.subValue=this.label.find(".subValue"),this.subValue.length||(this.subValue=d("\x3cdiv\x3e",{"class":"subValue"}),this.label.prepend(this.subValue)));if(this.options.text)this[this.options.hasSubValue?"updateValue":"updateLabel"](this.options.text);
else if(!this.options.hasSubValue){var a=this.label.html();a&&a.trim()&&this.updateLabel(a.trim())}},open:function(a){a=a||{};if(!this.openDisabled){this.isOpen=!0;var b=this,c=f.config.getString("ui.horizon.output.container","body");if("function"===typeof this.options.delayShowDropdown&&this.options.delayShowDropdown()&&!this.showDropdownTimeout)this.showDropdownTimeout=setTimeout(this.open.bind(this),this.options.showDropdownDelay);else{null!==this.showDropdownTimeout&&(clearTimeout(this.showDropdownTimeout),
this.showDropdownTimeout=null);this.options.rotateArrow&&this.icon.css("transform","rotate(-180deg)");this.bindOpenDialogEvents();this.options.container&&""!==this.options.container&&(c=this.options.container,d(b.options.container).off("scroll."+b.id()).on("scroll."+b.id(),function(){b.isOpen&&b.repositionWithJS()}));this.options.isPopover&&this.popoverArrow.show();this.content.appendTo(c);if(this.options.onOpen)this.options.onOpen(this);this.repositionWithJS();this.element.attr("aria-pressed")&&
this.element.attr("aria-pressed",!0);b.element.addClass("open");b.content.addClass("open");this.content.attr("aria-expanded",!0);this.element.attr("aria-expanded",!0);this.content.data("owner",this.element.attr("id"));f.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);f.events.publish("DropdownDialog.open",{id:b.id()});this.toggleCover(!0);this.setupTabKeyHandling({focusLast:a.focusLast});this.styleForModal(!0);this.changePosition&&this.id()&&this.content.css({top:d(document).scrollTop()+
this.positionCss.top+"px",left:this.positionCss.left+"px"});this.options.calculateAlignment||this.content.css({left:this.options.leftOffset})}}},setupTabKeyHandling:function(a){a=a||{};var b=this,c=this.getFocusableElements();c.length&&(b.content.off("keydown","**"),setTimeout(function(){a.focusLast?d(c[c.length-1]).focus():d(c[0]).focus();b.content.on("mouseover","a, [tabindex]",function(){b.content.find(":focus").trigger("blur")});b.content.on("keydown",function(a){c=b.getFocusableElements();for(var e=
-1,d=a.target,g=0;g<c.length;g++)c.get(g)===d&&(e=g);var d=0===e,g=c.length-1,l=e===g,k=!1;if(a.which===f.globals.keyCodes.TAB&&(1===c.length||d&&a.shiftKey||l&&!a.shiftKey))b.toggleContent(),b.element.focus();else{switch(a.which){case f.globals.keyCodes.RETURN:a.stopPropagation();a.target.click();b.element.focus();break;case f.globals.keyCodes.DOWN:l?c.get(0).focus():c.get(e+1).focus();k=!0;break;case f.globals.keyCodes.UP:d?c.get(g).focus():c.get(e-1).focus();k=!0;break;case f.globals.keyCodes.HOME:c.get(0).focus();
k=!0;break;case f.globals.keyCodes.END:c.get(g).focus(),k=!0}k&&(a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault())}})},25))},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible, a[href]:visible").not("[tabindex\x3d-1],[disabled]")},_close:function(a,b,c){var e=this.isOpen,d=this;this.isOpen=!1;this.options.isPopover&&this.popoverArrow.hide();this.element.removeClass("open");this.content.removeClass("open");this.toggleCover(!1);d.element.after(d.content);
c&&setTimeout(function(){d.element.focus()},1);if(this.options.onClose)this.options.onClose(e,this,a);f.events.publish("DropdownDialog.close",{id:d.id(),silent:!!b});this.element.attr("aria-pressed")&&this.element.attr("aria-pressed",!1);this.content.attr("aria-expanded",!1);this.element.attr("aria-expanded",!1);f.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);this.styleForModal(!1)},close:function(a,b,c){if(!c||"object"!==typeof c||c.avoidElementId!==this.id()){this.options.repositionWithStyle&&
this.resetPosition();this.removeOpenDialogEvents();this.options.rotateArrow&&this.icon.css("transform","");if(this.options.animateClose){var d=this;this.animateClose(function(){d._close(a,b,c)})}else this.isOpen&&this._close(a,b,c);null!=a&&a.stopPropagation()}},toggleContent:function(a){this.isOpen?this.close(null,null,!0):this.open(a)},updateLabel:function(a,b,c){b&&(a+=(c||"")+b);this.label.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},updateValue:function(a){a=
a||"";this.value.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},resetPosition:function(){this.content.css({position:"absolute"})},reposition:function(a){if(this.options.repositionWithStyle){var b;window.scrollY>this.options.scrollOffset?(b={position:"fixed",top:this.options.fixedPositionOffset+"px"},this.content.css(b),this.changePosition&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+
"px",left:this.positionCss.left+"px"})):(b={position:"absolute"},this.content.css(b),this.repositionWithJS(a))}else this.repositionWithJS(a)},repositionForNonModal:function(){var a=this.showInModal();if(this.modalActive()&&a)return!1;this.styleForModal(a);return!a&&!this.modalActive()},repositionWithJS:function(a){if(this.repositionForNonModal()){this.rtlAlignment="rtl"!==document.dir||"left"!==this.options.alignment&&"right"!==this.options.alignment?void 0:"right"===this.options.alignment?"left":
"right";var b=this.options.direction,c=this.rtlAlignment||this.options.alignment,e=this.element.offset(),h=d(this.options.container),f=this.options.expandTo?d("#"+this.options.expandTo):d(),g=f.length&&f.is(":visible"),l=g?f.offset():null;a=a||!1;if(h.length)var k=h.offset(),e={top:e.top-k.top+h.scrollTop(),left:e.left-k.left};else h=d(window);k=e.top+this.element.outerHeight();0===this.element.width()&&0!==this.element.position().top&&(k+=window.scrollY);this.shouldFlipDirection(b)&&(b=this.getReversedDirection(b));
this.shouldFlipAlignment(c)&&(c=this.getReversedDirection(c));this.updateAnimationClass(b,c);this.content.toggleClass("noAnimation",a);"up"===b?(this.content.addClass("up"),k=e.top-this.content.outerHeight()):this.content.removeClass("up");if("left"===b||"right"===b)k="up"===this.options.alignment?e.top-this.element.outerHeight()/2:"down"===this.options.alignment?e.top-this.content.outerHeight()+this.element.outerHeight():e.top+this.element.outerHeight()/2-this.content.outerHeight()/2;a={top:Math.floor(k)+
"px"};g?"right"===c?a.right=Math.floor(h.width()-f.width()-l.left)+"px":a.left=Math.floor(l.left)+"px":"left"===b?a.right=Math.floor(h.width()-e.left)+"px":"right"===b?a.left=Math.floor(e.left+this.element.width())+"px":"right"===c||"window-center-desktop"===c?"window-center-desktop"==c&&768<=window.innerWidth?(a.right="",a.left=Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+"px"):(a.left="",b=this.getTriggerWidth(),38>b&&!this.options.forceTriggerWidth&&(b=38),a.right=Math.floor(h.width()-
(e.left+b))+"px"):a.left="center"===c?Math.floor(e.left-this.content.outerWidth()/2)+this.getTriggerWidth()/2+"px":"window-center"===c?Math.floor(window.innerWidth/2-this.content.outerWidth()/2)+"px":Math.floor(e.left)+"px";this.options.topOffset&&0!==this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");this.options.leftOffset&&0!==this.options.leftOffset&&(a.right?a.right=parseInt(a.right.replace("px",""))-this.options.leftOffset+"px":a.left&&(a.left=parseInt(a.left.replace("px",""))+
this.options.leftOffset+"px"));this.leftOffset&&(a.marginLeft=this.leftOffset+"px");this.options.isPopover&&"right"===c&&(a.left=Math.floor(e.left+this.getTriggerWidth()+22)+"px",a.top=Math.floor(k-45)+"px");c=this.options.isFixedWidth?"width":"minWidth";this.options.matchWidth?a[c]=this.getTriggerWidth()+"px":g?a[c]=f.outerWidth()+"px":a.minWidth="";this.options.removeZIndex||(a.zIndex=this.element.zIndex()+9999);this.options.checkIsOutsideScreen&&(f=this.content.outerWidth(),h=h.outerWidth(),g=
!1,f>=h?g=!0:(c=parseInt(a.left,10),e=parseInt(a.right,10),c&&c+f>=h?g=!0:e&&e+f>=h&&(g=!0)),g&&(a.left="0px",a.right="auto",a.maxWidth=h+"px"));this.content.css(a);this.changePosition&&this.content.css({top:d(document).scrollTop()+this.positionCss.top+"px",left:this.positionCss.left+"px"});this.options.calculateAlignment||this.content.css({left:this.options.leftOffset})}},styleForModal:function(a){a&&this.showInModal()?(this.content.css({top:0,left:0,right:0,maxWidth:"100%",minHeight:"100vh"}),this.content.addClass("modal"),
this.content.toggleClass("noAnimation",!0),d("body").addClass("modal-open"),this.addedModalOpen=!0):this.addedModalOpen&&(this.addedModalOpen=!1,this.content.removeClass("modal"),d("body").removeClass("modal-open"))},modalActive:function(){return this.content.hasClass("modal")},shouldFlipDirection:function(a){if(this.options.flippable){var b=d(window).scrollTop(),c=b+d(window).outerHeight(),e=this.content.outerHeight(),f=this.element.offset().top,c=f+this.element.outerHeight()+e>c,b=f-e<b;if("down"===
a)return c&&!b;if("up"===a)return b&&!c}return!1},shouldFlipAlignment:function(a){if(this.options.flippable){var b=d(window).width(),c=this.content.width(),e=this.element.offset().left,f=this.element.width(),f=0>=e+("left"===a?0:f)-c,b=e+("left"===a?c:0)>=b;if("left"===a)return!f&&b;if("right"===a)return f&&!b}return!1},getReversedDirection:function(a){switch(a){case "down":return"up";case "up":return"down";case "left":return"right";case "right":return"left";case "bottom":return"top";case "top":return"bottom";
case "center":return"center"}return a},updateAnimationClass:function(a,b){a=this.getDirectionClass(a,b);this.content.hasClass(a)||this.content.removeClass(function(a,b){return(b.match(/\banimate-\S+/g)||[]).join(" ")}).addClass(a).removeAttr("style")},getDirectionClass:function(a,b){var c;"left"===a||"right"===a?(c="down"===b?"top":"bottom",a="center"===a?"right":this.getReversedDirection(a)):(c="down"===a?"top":"bottom",a="center"===b?"right":b);return"animate-"+c+"-"+a},loadAjax:function(){var a=
this;return f.ajax.execute(this.options.ajaxUrl,{data:this.options.ajaxData,customUpdate:function(b){b.innerHTML&&""!==b.innerHTML?a.content.html(b.innerHTML):(a.element.remove(),a.content.remove(),a.ajaxLoadFailed=!0);return!0}})},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:this.element.outerWidth()},animateClose:function(a){var b=this,c=this.content.attr("class");(c=c&&c.match(/\banimate-\S+/))&&c.length&&(this.content.removeClass(c[0]),window.setTimeout(function(){b.content.addClass(c[0]+
" close-animation")},1),window.setTimeout(function(){a();b.content.removeClass("close-animation")},this.animationDuration))},toggleCover:function(a){this.options.useCover&&(a?this.coverInner.css("transform","scale("+(this.cover.outerWidth()+2)/this.element.outerWidth()+", 1.333)"):this.coverInner.css("transform","scale(1)"))},showInModal:function(){return 0<this.options.showModalBp&&d(window).outerWidth()<this.options.showModalBp&&this.content.hasClass("open")}})})(window.R9,window.jQuery);(function(b,d){b.createComponentClass("common.results.filters.FilterDropdownDialog","common.widgets.dropdown.DropdownDialog",{options:{name:"",subfilters:[],publishEventOnOpen:"",publishEventOnClose:"",contentId:"",staticTitle:"",skipResetOnClose:!1,openOnHover:!1},hover:!1,addEventHandlers:function(){var a=this;this.base();var e=this;this.registerEvent("click",this.element.find(".close"),function(a){a.stopPropagation();e.close();a=d(this).data("filter-name");d(this).data("skip-reset")||(0<a.indexOf(",")?
a.split(",").forEach(e.resetSubfilter.bind(e)):a&&b.events.publish("filter.reset",{name:a,type:"reset",userClick:!0}))});b.events.subscribe(["FilterDropdownDialog.close","common.results.filterDrawer.closed"],function(b){a.close();b&&b.forceClose&&a.element.toggleClass("keepOpen",!1)});b.events.subscribe("FilterDropdownDialog.open",{id:this.id()},function(){!a.isOpen&&a.open()});this.content.mouseenter(function(){a.hover=!0});this.content.mouseleave(function(){a.hover=!1;a.element.hasClass("keepOpen")||
b.events.publish("FilterDropdownDialog.mouseleave")});b.question.answer("FilterDropdownDialog.isHover."+this.id(),function(){return a.element.hasClass("open")?a.hover:null});this.subscribe("filters.disabled",this.setDisabled.bind(this));this.subscribe("filters.dropdown.disabled",{name:this.options.name},function(b){return a.setDisabled(b.disabled)});this.subscribe("search.searchFailed",this.setDisabled.bind(this,!0));this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));
this.subscribe("resultspage.filters.show",this.togglePlaceholder.bind(this,!1));this.subscribe("search.startSearch",this.togglePlaceholder.bind(this,!0));this.subscribe("searchform.submit",this.setDisabled.bind(this,!1))},closeOnBodyClick:function(a){this.options.contentId?this.isOpen&&(!this.content||!this.content[0]||this.content[0]!==a.target&&1>d(a.target).closest("#"+this.options.contentId).length)&&this.close():this.base(a)},close:function(){this.element.hasClass("Disabled")||(this.options.publishEventOnClose&&
b.events.publish(this.options.publishEventOnClose),this.base(),this.element.removeClass("open"),b.events.publish("FilterDropdownDialog.closed",{name:this.options.name}))},open:function(){this.element.hasClass("Disabled")||(this.options.publishEventOnOpen&&b.events.publish(this.options.publishEventOnOpen),this.base(),this.element.addClass("open"),b.events.publish("FilterDropdownDialog.opened",{name:this.options.name}))},toggleContent:function(a){this.options.openOnHover&&this.element.hasClass("open")&&
!this.element.hasClass("keepOpen")||this.base(a)},togglePlaceholder:function(a){this.content.toggleClass("placeholder-visible",a)},setDisabled:function(a){b.dom.toggleOneClass(this.element,"Disabled",a)},resetSubfilter:function(a){(this.options.contentId||this.content.find(".Common-Results-Filters-Filter."+a).hasClass("activeReset"))&&b.events.publish("filter.reset",{name:a,type:"reset",userClick:!0})},filterDataChanged:function(a){if(this.element.hasClass("Disabled")){var b=!1;this.options.subfilters.forEach(function(c){d.extend({},
a[c]).enabled&&(b=!0)});b&&this.setDisabled(!1)}var c=this.options,f=c.staticTitle,c=c.name;f&&""!==f?this.updateLabel(f):a&&a[c]&&a[c].dynamicTitle&&this.updateLabel(a[c].dynamicTitle)}})})(R9,jQuery);(function(e,f){e.createComponentClass("hotels.results.filters.RegionFilter","common.results.filters.Filter",{name:"regions",state:null,isRegionCardSlimEnabled:!1,init:function(){this.isRegionCardsSlimEnabled=this.options.isRegionCardsSlimEnabled},addEventHandlers:function(){this.base();this.subscribe("filters.%s.setregion".format(this.name),this.onChange.bind(this));this.subscribe("filters.%s.togglecity".format(this.name),this.onChangeSlim.bind(this))},cleanupExistingState:function(){this.willReset()},
willReset:function(){this.state=null},update:function(a){if(this.isRegionCardsSlimEnabled){this.state={};var c=this;Object.keys(a.valueMap).forEach(function(b){c.state[b]=a.valueMap[b].selected;c.subscribe("filters.%s.%s.resetitem".format(c.name,b),function(){c.state[b]=0;c.pushStateChange()})})}else{this.state={};var d=Object.keys(a.valueMap).filter(function(b){return 2===a.valueMap[b].selected})[0];d&&(this.state[d]=2)}},onChange:function(a){this.state={};this.state[a]=2;this.logUserInteraction("setregion");
this.pushStateChange()},onChangeSlim:function(a){null!=this.state&&a in this.state&&(this.state[a]=(this.state[a]+1)%2);this.logUserInteraction("togglecity");this.pushStateChange()},getState:function(){return this.state}})})(R9,jQuery);(function(d){R9.extend("Widgets",{RadiobuttonSet:function(a,b){this.elementNode=a;this.element=d(this.elementNode);if(!b||b.dontValidate||this.validateElement())this.options=d.extend({},this.options,b),this.init()}});R9.extend("Widgets.RadiobuttonSet",{isRadiobuttonSet:function(a){return a&&a.nodeName&&"span"===a.nodeName.toLowerCase()},isWidgetControlled:function(a){return d(a).hasClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass)},findLabelNode:function(a){return document.getElementById(a.id+
"-label")},findRadiobuttonSetNode:function(a){return null!=a?a.parentNode:null},refresh:function(a){var b=!1;a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).each(function(){var a=d(R9.Widgets.RadiobuttonSet.findLabelNode(this)),e=d(this);e.prop("checked")?(b=!0,a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked")):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked");e.prop("disabled")?a.addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+
"-label-disabled"):a.removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-disabled")});b||(a=a.find("input."+R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass).first(),a.prop("checked",!0),d(R9.Widgets.RadiobuttonSet.findLabelNode(a[0])).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-checked"))},applyCallback:function(a,b,c,e){a&&(d.isFunction(a)?a.apply(b,c):(a=a[e.target.value],d.isFunction(a)&&a.apply(b,c)))}});R9.extend("Widgets.RadiobuttonSet.prototype",
{widgetName:"radiobuttonset",widgetBaseClass:"r9-radiobuttonset",elementNode:null,element:null,options:{change:null,click:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.handleElementClickEvent);this.element.data(this.widgetName,this);R9.Widgets.RadiobuttonSet.refresh(this.element)},bindInputEvent:function(a,b){var c="input."+
this.widgetBaseClass;a+="."+this.widgetName;var d=this;this.element.off(a,c).on(a,c,function(a){b.call(d,this,R9.Widgets.RadiobuttonSet.findLabelNode(this),a)})},validateElement:function(){return R9.Widgets.RadiobuttonSet.isRadiobuttonSet(this.elementNode)&&R9.Widgets.RadiobuttonSet.isWidgetControlled(this.element)&&void 0===this.element.data(this.widgetName)},handleElementFocusEvent:function(a,b,c){a.disabled||d(b).addClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementBlurEvent:function(a,
b,c){a.disabled||d(b).removeClass(R9.Widgets.RadiobuttonSet.prototype.widgetBaseClass+"-label-focused")},handleElementChangeEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.change,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))},handleElementClickEvent:function(a,b,c){a.disabled||(R9.Widgets.RadiobuttonSet.applyCallback(this.options.click,this,arguments,c),R9.Widgets.RadiobuttonSet.refresh(this.element))}})})(jq||jQuery);
(function(d){R9.createWidgetClass("radio.StyleJamRadioButtonSet",d.extend({},R9.Widgets.RadiobuttonSet.prototype,{currentRadio:null,isTabList:!1,init:function(a){setTimeout(this.refresh.bind(this),1);this.currentRadio=this._getLabelForButton(this._getButtons().filter(":checked"));this.isTabList="tablist"===this.element.attr("role")},refresh:function(){R9.Widgets.RadiobuttonSet.refresh(this.element);var a=this.getEnabledRadios().filter("[aria-checked\x3dtrue]");a.length&&this.element.attr("aria-activedescendant",
a.attr("id"));this.focusRadio();this.isTabList&&window.setTimeout(function(){var a=this.getCheckedButton();this._getButtons().attr("aria-selected",!1);a.attr("aria-selected",!0);this._setActiveTabPanel(a)}.bind(this),1)},addEventHandlers:function(a){this.bindInputEvent("change",this.handleElementChangeEvent);this.bindInputEvent("click",this.onClick);this.element.on("focus",this.onFocus.bind(this));this.element.on("blur",this.onBlur.bind(this));this.element.on("keydown",this.onKeyDown.bind(this))},
onClick:function(a,b,c){this.handleElementClickEvent(a,b,c);this.isTabList&&this._getButtons().each(function(b,c){a===c&&this._setButtonCheckedById(c.id)}.bind(this));this.focusRadio()},focusRadio:function(a){a&&a.length||(a=this._getLabelForButton(this._getButtons().filter(":checked")));a.length&&(this.element.attr("aria-activedescendant",a.attr("id")),this.handleActiveLabel(a),this.currentRadio=a)},getAllRadios:function(){return this.element.find("label")},getEnabledRadios:function(){return this.element.find("label").filter('[data-is-label-disabled\x3d"false"]')},
focusButtonSet:function(){this.getChildElement("set").focus()},onFocus:function(){var a=this.element.attr("aria-activedescendant");"undefined"===typeof a&&0<this.getEnabledRadios().length&&(a=this.getEnabledRadios().get(0).id);a&&this.focusRadio(d("#"+a));this.element.addClass("focused")},onBlur:function(){this.element.removeClass("focused")},onKeyDown:function(a){switch(a.which){case R9.globals.keyCodes.SPACE:this.checkCurrentRadio();break;case R9.globals.keyCodes.UP:case R9.globals.keyCodes.LEFT:this.focusPreviousRadio();
break;case R9.globals.keyCodes.DOWN:case R9.globals.keyCodes.RIGHT:this.focusNextRadio();break;default:return!0}return!1},checkCurrentRadio:function(){this.currentRadio&&this.checkRadio(this.currentRadio)},focusPreviousRadio:function(){var a=this.getPrevButtons(),b=this.getEnabledRadios(),a=a.length?d(a.get(0)):d(b.get(b.length-1));this.checkRadio(a)},focusNextRadio:function(){var a=this.getNextButtons(),a=a.length?d(a.get(0)):d(this.getEnabledRadios().get(0));this.checkRadio(a)},checkRadio:function(a){a&&
(a.attr?this._getButtons().filter("#"+a.attr("for")+"[aria-checked\x3dfalse]").click():a.click(),this.currentRadio.attr("aria-checked",!1),this.focusRadio(a),this.currentRadio.attr("aria-checked",!0))},getCheckedButton:function(){var a=this._getButtons().get(0);this._getButtons().get().some(function(b){if(!0===d(b).prop("checked"))return a=b,!0});return d(a)},getPrevButtons:function(){return this.currentRadio.prevAll("label:visible")},getNextButtons:function(){return this.currentRadio.nextAll("label:visible")},
getCheckedPair:function(){var a=this.getCheckedButton();return{value:a.val(),title:this._getLabelForButton(a).attr("title")}},isButtonChecked:function(a){return!0===this._getButtonByValue(a).prop("checked")},isButtonEnabled:function(a){return!1===this._getButtonByValue(a).prop("disabled")},getRadioButtonAmount:function(){return this.element.find("input").length},getValue:function(){return this.getCheckedButton().val()},setValue:function(a){this.setButtonCheckedByValue(a)},setInnerLabelText:function(a,
b){this._getInnerLabelByValue(a).text(b)},setButtonCheckedByValue:function(a){this._setButtonChecked(function(b){return b.val()===a})},setButtonEnabledByValue:function(a,b){this._setButtonEnabled(function(b){return b.val()===a},b)},_setButtonCheckedById:function(a){this._setButtonChecked(function(b){return b.attr("id")===a})},_setButtonEnabledById:function(a,b){this._setButtonEnabled(function(b){return b.attr("id")===a},b)},_setButtonChecked:function(a){var b=this;this._getButtons().each(function(c,
e){c=d(e);e=!!a(c);c.prop("checked",e);c.attr("aria-checked",e);b.handleActiveLabel(b.getAllRadios().filter("[for\x3d'"+c.attr("id")+"']"))});this.refresh()},_setButtonEnabled:function(a,b){var c=this;this._getButtons().each(function(){var e=d(this);!0===a(e)&&(e.prop("disabled",!1===b),e.attr("aria-disabled",!1===b),c.handleDisabledLabel(c.getAllRadios().filter("[for\x3d'"+e.attr("id")+"']"),b))});this.refresh()},_setActiveTabPanel:function(a){a=d("[id\x3d'%s']".format(a.attr("aria-controls")));
a.length&&(this._getButtons().get().reduce(function(a,c){c=d(c).attr("aria-controls");return a.add(d("[id\x3d'%s']".format(c)))},d()).attr("aria-expanded",!1),a.attr("aria-expanded",!0))},_getButtons:function(){return this.element.find("input."+this.widgetBaseClass)},_getButtonByValue:function(a){return this._getButtons().filter('[value\x3d"'+a+'"]')},_getInnerLabelByValue:function(a){return this._getLabelForButton(this._getButtonByValue(a)).find(".js-inner-label")},_getLabelForButton:function(a){return a.next(".js-label")},
handleActiveLabel:function(a){this.getAllRadios().attr("aria-checked",!1);a.attr("aria-checked",!0);R9.dom.swapClasses(this.getAllRadios(),a.data("active-state"),a.data("default-state"));R9.dom.swapClasses(a,a.data("default-state"),a.data("active-state"))},handleDisabledLabel:function(a,b){a.attr("data-is-label-disabled",!b);b?R9.dom.swapClasses(a,a.data("disabled-state"),a.data("default-state")):R9.dom.swapClasses(a,a.data("default-state"),a.data("disabled-state"))},addNewRadioButton:function(a,
b,c,d,g,k,h){if(a){var e=this.element.find("input").first().clone(),f=this.element.find("label").first().clone();e.attr("id",a);f.attr("id",a+"-label");f.attr("for",a);b&&e.attr("value",b);c&&e.attr("name",c);g&&f.attr("title",g);d&&f.find(".label-text").text(d);this.element.append(e,f);h&&this._setButtonEnabledById(a,h);k&&this._setButtonCheckedById(a);this.refresh()}},deleteRadioButtonByValue:function(a){if(a&&(a=this.element.find("input[value\x3d"+a+"]"))){var b=this.element.find("label[id\x3d"+
a.attr("id")+"-label]");d(a).remove();b&&b.remove();this.refresh()}}}))})(jQuery);(function(c,d){c.createComponentClass("hotels.results.HotelPriceTypeSelector",{options:{defaultPriceType:"daybase",useRadioBoxes:!1,trackEnabled:!1,savingPriceTypeToSessionStorageEnabled:!1},priceDropdownWidget:null,init:function(){this.options.useRadioBoxes?this.bindPriceTypeWidget():this.bindPriceTypeDropdown();this.options.savingPriceTypeToSessionStorageEnabled&&sessionStorage.getItem("priceType")&&this.priceDropdownWidget.setValue(sessionStorage.getItem("priceType"))},addEventHandlers:function(){var a=
this;this.subscribe("searchform.submit",this.load.bind(this));this.subscribe(["resultspage.streaming.done","resultspage.filtersData.changed","filter.show"],function(){a.element.removeClass("hidden")});this.subscribe(["hotels.search.location.changed","rentals.search.location.changed"],function(){a.priceDropdownWidget.setValue(a.options.defaultPriceType)});this.subscribe(["search.searchFailed","search.startSearch"],function(){a.element.addClass("hidden")});this.subscribe("resultspage.priceType.changed",
function(b){b.priceType&&a.priceDropdownWidget.setValue(b.priceType)});c.question.forget("results.priceType");this.answer("results.priceType",this.getCurrentPriceType.bind(this))},load:function(a){a.priceType&&this.priceDropdownWidget.setValue(a.priceType)},bindPriceTypeWidget:function(){var a=this;this.priceDropdownWidget=this.getChildElement("priceType").styleJamRadioButtonSet({change:function(b){b&&a.publishPriceType(this.getValue())}}).getWidget()},bindPriceTypeDropdown:function(){var a=this;
this.priceDropdownWidget=this.getChildElement("priceType").r9Select({change:function(b){b&&(b=this.getValue(),a.trackChanges.call(a,b),a.publishPriceType(b))}}).getWidget();var b=this.getChildElement("price-tooltip");b&&b.toolTip({content:b.data("message"),showImmediately:!1})},trackChanges:function(a){this.options.trackEnabled&&c.VestigoEvents&&c.VestigoEvents.filters.shared.priceType(c.VestigoType.PriceType[a])},publishPriceType:function(a){a&&(this.options.savingPriceTypeToSessionStorageEnabled&&
sessionStorage.setItem("priceType",a),c.events.publish("resultsHeader.changed",{priceType:a,refreshResults:!0}))},getCurrentPriceType:function(){return this.priceDropdownWidget.getValue()}})})(R9,jQuery);(function(c){function k(){var a=c('\x3cdiv class\x3d"scroll-bar"\x3e\x3cdiv class\x3d"gutter"\x3e\x3c/div\x3e\x3cdiv class\x3d"handle"\x3e\x3c/div\x3e\x3c/div\x3e').insertAfter(this);this.data("scrollbar",a);a.find(".handle").height(this[0].offsetHeight/this[0].scrollHeight*100+"%")}function l(){var a=this.data("scrollbar"),b=a.find(".handle");a.find(".gutter");var d=this,g=0;this.on("touchstart",function(a){g=a.touches[0].pageY});this.on("touchmove",function(a){var b=this.scrollTop+10*(0<g-a.touches[0].pageY?
1:-1);e.bind(c(this))(b);a.preventDefault()});this.on("wheel",function(a){var b=a.originalEvent,b=this.scrollTop+10*(0>(-b.deltaY||-b.detail)?1:-1);e.bind(c(this))(b);a.preventDefault()});a.on("click",".gutter",function(a){a=a.pageY||a.clientY;e.bind(d)(h.bind(d)(a),!0)});b.on("mousedown",function(){window.getSelection&&window.getSelection().removeAllRanges();b.addClass("hover");c(document).on("mousemove.scrollhandle",function(a){var b=a.pageY||a.clientY;a.preventDefault();e.bind(d)(h.bind(d)(b))});
c(document).on("mouseup.scrollhandle",function(a){b.removeClass("hover");c(document).off(".scrollhandle")});var a=m();if(a.changeEvt)c(document).on(a.changeEvt,function(){document[a.hiddenProp]&&(b.removeClass("hover"),c(document).off(".scrollhandle"))})})}function m(){var a,b;"undefined"!==typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!==typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");
return{hiddenProp:a,changeEvt:b}}function h(a){var b=this.data("scrollbar"),d=b.find(".handle"),b=b.find(".gutter");a=a-b.offset().top-d.outerHeight()/2;var c=this[0].scrollHeight-this[0].offsetHeight,d=b.height()-d.outerHeight();return c/d*a}function e(a,b){b?this.animate({scrollTop:a},{duration:100,step:f.bind(this),complete:f.bind(this)}):(this[0].scrollTop=a,f.bind(this)())}function f(){var a=this.data("scrollbar");if(a){var b=a.find(".handle"),a=a.find(".gutter"),c=this[0].scrollTop,e=this[0].scrollHeight-
this[0].offsetHeight,a=(a.height()-b.outerHeight())/e*c+b.outerHeight()/2-b.outerHeight()/2+5;b.css("top",a)}}function n(a){a&&"undefined"!==typeof a.scrollTo&&e.bind(this)(a.scrollTo);a&&a.reset&&e.bind(this)(0)}c.fn.scroller=function(a){var b=this.data("scrollbar");if(b)this[0].offsetHeight>=this[0].scrollHeight?b.hide():b.show();else{if(this[0].offsetHeight>=this[0].scrollHeight)return;k.bind(this)();l.bind(this)()}n.bind(this)(a);return this}})(jQuery);(function(f,c){f.createWidgetClass("select.Select",{inputElement:null,dropdownOptions:null,content:null,list:null,jQueryConstructorName:"r9Select",options:{autoOpen:!1,alignment:"left",direction:"down",showIcon:!0,matchWidth:!1,matchMinWidth:!0,iconClass:"",contentClass:"",triggerClass:"",content:null,onInit:null,onOpen:null,onClose:null,text:"",placeholder:"",topOffset:"0",removeZIndex:!1,flippable:!0,change:c.noop},init:function(){this.elementNode=this.element[0];this.createContent();this.inputElement=
this.getChildElement("status");this.dropdownOptions=this.content.find("li");this.list=this.getChildElement("dropdownDialogList");this.focusSelected()},focusSelected:function(){if(this.content.find("li.selected").length){var a=this.content.find("li.selected").addClass("focused");a.siblings().removeClass("focused");this.setInputValue(a);this.element.attr("aria-activedescendant",a.attr("id"))}else a=c(this.content.find("li")[0]),a.length&&(a.addClass("focused").siblings().removeClass("focused"),this.setInputValue(a),
this.element.attr("aria-activedescendant",a.attr("id")))},updateValue:function(a,b){this.isNodeDisabled(a)||(a.addClass("focused").siblings().removeClass("focused"),this.element.attr("aria-activedescendant",a.attr("id")),this.isOpen&&this.ensureVisible(a),a.addClass("selected").siblings().removeClass("selected"),this.setInputValue(a),b&&"function"===typeof this.options.change&&this.inputElement.trigger("change"))},setInputValue:function(a){this.inputElement.text(a.attr("data-title"));this.inputElement.attr("data-value",
a.attr("data-value"));this.inputElement.attr("data-title",a.attr("data-title"));this.element.hasValue=!0},ensureVisible:function(a,b){var c=a.position().top;a=a.outerHeight(!0);var d=this.content.scrollTop(),g=this.content.height(),k=this.list.scrollTop();if(b){b=this.list[0].scrollHeight;var f=c+this.list.scrollTop(),h=(g-a)/2;if(f>h&&b-f>h){this.list.scroller({scrollTo:d+k+c-h});return}f<h?this.list.scroller({scrollTo:0}):this.list.scroller({scrollTo:b-g})}0>c?this.list.scroller({scrollTo:d+k+c}):
c+a>g&&this.list.scroller({scrollTo:d+k+(c+a-g)})},addEventHandlers:function(){function a(a){a=c(a.target).closest(".Common-Widgets-Select-Select-Content");b.content[0]!=a[0]&&b.isOpen&&(b.close(),b.blur())}var b=this,e=c("body"),d;d=this.options.triggerClass?c("."+b.options.triggerClass):c(b.element);this.inputElement.on("change",function(a){b.options.change&&b.options.change.call(b,a)});b.dropdownOptions.on("click",function(a){b.updateValue(c(this),!0);b.close();b.blur()});e.on("click",a);this.subscribe("trips.menu.open",
c.proxy(this.close,this));this.subscribe("select.force.close",c.proxy(this.close,this));f.events.subscribe("authentication.showLogin",this.close.bind(this,null,!0));d.click(function(c){b.element.closest(".Common-Widgets-Select-Select-Content").length||(e.off("click",a),b.element.focus(),b.toggleContent(),setTimeout(function(){e.on("click",a)},10))});c(document).keydown(function(a){27===a.which&&b.close(a,null,!0)});this.element.focusout(function(){b.element.hasClass("closed")&&b.blur()});this.element.blur(function(){b.element.hasClass("closed")&&
b.blur()});this.element.keydown(function(a){if(13===a.which||32===a.which)b.selectFocused(),b.close(),a.preventDefault();if(40===a.which){if(b.isOpen){var c=b.content.find(".focused").next();c.length&&b.updateValue(c)}else b.open();a.preventDefault();a.stopImmediatePropagation()}38===a.which&&(b.isOpen?(c=b.content.find(".focused").prev(),c.length&&b.updateValue(c)):b.open(),a.preventDefault(),a.stopImmediatePropagation());9==a.which&&(b.close(),b.blur())});this.element.on("focus",function(){b.element.addClass("focused")});
c(window).on("resize",function(){b.isOpen&&b.reposition()});c(document).on("scroll",function(){b.isOpen&&b.reposition()});c(".viewport").on("scroll",function(){b.isOpen&&b.reposition()});c(".col-left-rail").on("scroll",function(){b.isOpen&&b.reposition()});c(".filterList").on("scroll",function(){b.isOpen&&b.reposition()});d=function(){b.element.is(":visible")&&(f.Common.Utils.Browsers.isIE(11)||setTimeout(function(){b.reposition()},25))};this.content.on("mouseup touchend",d);f.events.subscribe("horizon.dropdownDialog.reposition",
d);f.events.subscribe("horizon.selectWidget.reposition",d);f.events.subscribe("Select.OutsideExit",b.outsideExit.bind(b))},val:function(){return this.inputElement.attr("data-value")},getValue:function(){return this.val()},dataVal:function(){return this.inputElement.attr("data-value")},getDataValue:function(){return this.dataVal()},getText:function(){return this.inputElement.text()},setText:function(a){this.inputElement.text(a)},setValue:function(a,b){a=this.content.find("li[data-value\x3d'"+a+"']");
a.length&&this.updateValue(a,b)},setValueOrDefault:function(a,b){a=this.content.find("li[data-value\x3d'"+a+"']");a.length?this.updateValue(a,b):this.setValue("",b)},isNodeSelected:function(a){return a.length&&a.hasClass("selected")},isNodeDisabled:function(a){return a.length&&a.hasClass("disabled")},getNodeDataValue:function(a){return a.length?a.attr("data-value"):""},disableValue:function(a){a=this.content.find("li[data-value\x3d'"+a+"']");a.length&&a.addClass("disabled")},enableValue:function(a){a=
this.content.find("li[data-value\x3d'"+a+"']");a.length&&a.removeClass("disabled")},blur:function(){this.element&&this.element.removeClass("closed focused");this.content.removeClass("closed")},createContent:function(){this.content=this.options.content?c(this.options.content):c("#"+this.element.attr("id")+"_content")},open:function(){this.isOpen=!0;var a=this,b="body";this.focusSelected();this.options.container&&""!==this.options.container&&(b=this.options.container,c(a.options.container).off("scroll."+
a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.reposition()}));this.content.appendTo(b);this.reposition();a.element.addClass("open");a.content.addClass("open");a.element.removeClass("closed");a.content.removeClass("closed");f.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);a.list.scroller();b=a.content.find("li.focused");a.ensureVisible(b,!0);if(this.options.onOpen)this.options.onOpen(this);f.events.publish("Select.open",{id:a.id()})},selectFocused:function(){var a=
this.content.find("li.focused");a.length&&this.updateValue(a,!0)},getFocusableElements:function(){return this.content.find(":input:visible,[tabindex]:visible").not("[tabindex\x3d-1],[disabled]")},close:function(a,b,c){if(this.isOpen){var d=this.isOpen,g=this;this.isOpen=!1;this.element.removeClass("open");this.content.removeClass("open");this.element.addClass("closed");this.content.addClass("closed");f.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);g.element.after(g.content);
var e=this.content.find("li.selected");e.length&&this.element.attr("aria-activedescendant",e.attr("id"));c&&setTimeout(function(){g.element.focus()},1);if(this.options.onClose)this.options.onClose(d,this,a);f.events.publish("Select.close",{id:g.id(),silent:!!b})}},toggleContent:function(){this.isOpen?this.close(null,null,!0):this.open()},updateLabel:function(a){this.label.html(a);"0"==a+""||a?this.element.addClass("hasValue"):this.element.removeClass("hasValue")},hasValue:function(){return this.element.hasClass("hasValue")},
reposition:function(){var a=this.options.direction,b=this.element.offset(),e=c(this.options.container);if(e.length)var d=e.offset(),b={top:b.top-d.top+e.scrollTop(),left:b.left-d.left};else e=c(window);d=b.top+this.element.outerHeight();this.shouldFlipDirection(a)&&(a="down"===a?"up":"down");"up"===a?(this.content.addClass("up"),d=b.top-this.content.outerHeight()):this.content.removeClass("up");a={top:d+"px"};"right"===this.options.alignment?a.right=e.width()-(b.left+this.getTriggerWidth())+"px":
a.left="center"===this.options.alignment?b.left-this.content.outerWidth()/2+this.getTriggerWidth()/2+"px":b.left+"px";this.options.topOffset&&"0"!=this.options.topOffset&&(a.marginTop=this.options.topOffset+"px");this.leftOffset&&(a.marginLeft=this.leftOffset+"px");this.options.matchWidth?(a.minWidth=this.getTriggerWidth()+"px",a.maxWidth=a.minWidth):(a.minWidth=this.options.matchMinWidth?this.getTriggerWidth()+"px":"",a.maxWidth="");this.options.removeZIndex||(a.zIndex=this.element.zIndex()+9999);
this.content.css(a)},shouldFlipDirection:function(a){if(this.options.flippable){var b=c(window).scrollTop(),e=b+c(window).outerHeight(),d=this.content.outerHeight(),g=this.element.offset().top,e=g+this.element.outerHeight()+d>e,b=g-d<b;if("down"===a)return e&&!b;if("up"===a)return b&&!e}return!1},getTriggerWidth:function(){var a=this.elementNode.getBoundingClientRect();return a?a.right-a.left:this.element.outerWidth()},setOptions:function(a,b){var e=this.dropdownOptions;c.each(a,function(a,b){a=c(e[a]);
a.attr("data-value",b.value);a.attr("data-title",b.title);a.text(b.text);a.prop("disabled",b.disabled)})},setToFirstOption:function(){this.updateValue(c(this.dropdownOptions[0]),!1)},unselect:function(){this.dropdownOptions.removeClass("selected")},getSelectedElement:function(){var a=this.getValue(),b=this.getText();return{value:a,title:b,text:b}},outsideExit:function(a){a&&a.selectId&&a.selectId===this.id()&&this.close()}})})(window.R9,window.jq||window.jQuery);(function(b){R9.extend("Widgets",{TextInput:function(a,c){this.elementNode=a;this.element=b(this.elementNode);this.validateElement()&&(this.options=b.extend({},this.options,c),this.init())}});R9.extend("Widgets.TextInput",{isTextInput:function(a){return a&&a.nodeName&&"input"==a.nodeName.toLowerCase()&&"text"==a.type.toLowerCase()},isWidgetControlled:function(a){return"undefined"==typeof document.createElement("input").placeholder}});R9.extend("Widgets.TextInput.prototype",{widgetName:"textinput",
widgetBaseClass:"r9-textinput",widgetPlaceholderClass:"r9-textinput-placeholder-active",elementNode:null,element:null,options:{click:null,change:null},init:function(){this.bindInputEvent("focus",this.handleElementFocusEvent);this.bindInputEvent("smartyfocus",this.handleElementFocusEvent);this.bindInputEvent("blur",this.handleElementBlurEvent);this.bindFormSubmission();this.element.data(this.widgetName,this);this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode)},validateElement:function(){return R9.Widgets.TextInput.isTextInput(this.elementNode)&&
R9.Widgets.TextInput.isWidgetControlled(this.elementNode)&&void 0===this.element.data(this.widgetName)},bindInputEvent:function(a,b){var c=this;a+="."+this.widgetName;this.element.unbind(a).bind(a,function(a){b.call(c,this,a)})},bindFormSubmission:function(){var a=this,b="submit."+a.widgetName+a.element.attr("id"),d="form-pre-submit."+a.widgetName+a.element.attr("id");this.element.parents("form").off(b).on(b,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)});
this.element.parents("form").off(d).on(d,function(b){a.element.val()==a.element.attr("placeholder")&&a.clearPlaceholderText(a.element)})},handleElementFocusEvent:function(a,c){a.disabled||(b(a).val()==b(a).attr("placeholder")&&this.clearPlaceholderText(b(a)),this.options.focus&&this.options.focus.apply(this,arguments))},handleElementBlurEvent:function(a,c){a.disabled||(0==b.trim(b(a).val()).length&&this.setPlaceholderText(a),this.options.blur&&this.options.blur.apply(this,arguments))},clearPlaceholderText:function(a){a.removeClass(this.widgetPlaceholderClass).val("")},
setPlaceholderText:function(a){b(a).addClass(this.widgetPlaceholderClass).val(b(a).attr("placeholder"))}})})(jq||jQuery);
(function(b){R9.createWidgetClass("text.TextInput",b.extend({},R9.Widgets.TextInput.prototype,{widgetPlaceholderClass:"vs-placeholder",inputElement:null,icon:null,options:{needsPlaceholderSupport:!1,selectOnFocus:!1,useMcFlyStyling:!1,useIcon:!1},init:function(){this.inputElement=this.inputElement||this.element;this.elementNode=this.inputElement.get(0);this.options.useMcFlyStyling&&this.options.useIcon&&(this.icon=b("#"+this.id("icon")))},addEventHandlers:function(){var a=this;this.options.needsPlaceholderSupport&&
(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("focus",this.handleElementFocusEvent),this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));if(this.options.selectOnFocus)a.inputElement.on("focus",function(){a.inputElement.on("mouseup.a keyup.a",function(b){a.elementNode.setSelectionRange(0,9999);a.inputElement.off("mouseup.a keyup.a").select()})});this.options.useMcFlyStyling&&this.options.useIcon&&
(this.registerEvent("mouseenter",this.inputElement,function(){a.icon.addClass("hovered")}),this.registerEvent("mouseleave",this.inputElement,function(){a.icon.removeClass("hovered")}),this.registerEvent("focus",this.inputElement,function(){a.icon.addClass("focused")}),this.registerEvent("blur",this.inputElement,function(){a.icon.removeClass("focused")}))},getValue:function(){return b(this.inputElement).val()}}))})(jq||jQuery);(function(h,k){h.createWidgetClass("smarty.LandmarksSmarty","common.widgets.smarty.FlareSmarty",{geocoder:null,constructor:function(a,b){this.base(a,k.extend({dataSource:"/f/smarty",appendTo:"body",flareSmartyType:25,dropdownClass:" smartbox smartbox-landmarks smartbox-longnames",minWidth:250,featureClass:"",forceSelection:!0,searchOnFocus:!0,searchNoQuery:!0,showDropdownWhenEmpty:!1,f:"j",v:"v1"},b))},translateItem:function(a){if(!a)return null;a=k(a);return{type:a.attr("data-type"),id:a.attr("id"),
str:a.text(),short_str:a.attr("data-short-name"),lat:a.attr("data-lat"),lon:a.attr("data-lon")}},onBeforeStart:function(){"function"===typeof this.options.beforeStart&&this.options.beforeStart(this)},noItemToSelect:function(){if("function"===typeof this.options.onNoItemToSelect)this.options.onNoItemToSelect(this)},runSearch:function(a){if(!(this.element.val().length<this.options.minLength)){var b=null==this.lastValue,c=this.element.val();this.lastValue=c;var d=this.getRequestData();d.value||(d.value=
"");var e=this.preprocessRequest(d),f=this,g={};!b&&0<c.length&&h.Maps&&h.Maps.Google&&h.Maps.Google.load&&(h.Maps.Google.load(null,"landmarks-smarty"),g.useGoogle=h.Maps.Google.isLoaded());var l=function(){if(!g.smarty&&!g.google)f.searchCompleted(f.makeEmptyContent(),a);else if(g.smarty||g.google){var b=f.postprocessResponse(g);b&&f.searchCompleted(b,a)}};this.smartyRequest=k.post(this.options.dataSource,e,function(a){g.smarty=a;l()},this.options.dataType);g.useGoogle&&(this.geocoder||(this.geocoder=
new google.maps.Geocoder),b=this.preprocessGoogleRequest(d),this.geocoder.geocode(b,function(a,b){"OK"===b&&(g.google=a,l())}))}},isUpdateInProgress:function(){return this.keyTimeout||this.smartyRequest},abortRequest:function(){if(this.smartyRequest){try{this.smartyRequest.abort()}catch(a){}this.smartyRequest=null}},postprocessResponse:function(a){var b,c,d;a.smarty&&(c=JSON.parse(a.smarty),d=c.landmarks);if(null!=d)b=this.makePopularContent(d,this.options.recentLandmarks);else if(c||a.google)b=this.makeRegularContent(c,
a.google);b||(b=this.makeEmptyContent());return b},makeEmptyContent:function(){return this.options.emptyItemContent},makePopularContent:function(a,b){var c=[];if(a&&0<a.length){c.push("\x3cdiv\x3e\x3cdiv class\x3d'smartyheader'\x3e");c.push(this.options.popularLandmarksHeader);c.push("\x3c/div\x3e\x3c/div\x3e");c.push("\x3cul\x3e");for(var d=0;d<a.length;d++){var e=this.makeSmartyResult(a[d]);e&&c.push(e)}c.push("\x3c/ul\x3e")}if(b&&0<b.length){c.push("\x3cdiv\x3e\x3cdiv class\x3d'smartyheader'\x3e");
c.push(this.options.recentLocationsHeader);c.push("\x3c/div\x3e\x3c/div\x3e");c.push("\x3cul\x3e");for(d=0;d<b.length;d++)a=b[d],(e=this.makeResult(a.type.uiCode,a.id,a.landmarkName,a.latitude,a.longitude))&&c.push(e);c.push("\x3c/ul\x3e")}return c.join("")},makeRegularContent:function(a,b){var c=[],d=0,e=10;if(a)for(var f=0;f<e&&f<a.length;f++,d++){var g=this.makeSmartyResult(a[f]);g&&c.push(g)}if(b)for(e-=d,f=0;f<e&&f<b.length;f++,d++)(a=this.makeGoogleResult(b[f]))&&c.push(a);return 0<c.length?
"\x3cul\x3e"+c.join("")+"\x3c/ul\x3e":null},makeSmartyResult:function(a){var b=a.loctype,c=a.id,d=a.lat,e=a.lng;a=a.displayname;a=this.highliteText(a,this.lastValue);return this.makeResult(b,c,a,d,e)},makeGoogleResult:function(a){if(this.googleHasType(a.types,["premise","street_address","neighborhood","sublocality_level_4","sublocality_level_5"])){var b=a.geometry.location.lat(),c=a.geometry.location.lng();if(this.isInBounds(b,c))return a=a.formatted_address,a=this.highliteText(a,this.lastValue),
this.makeResult("adr",null,a,b,c)}return null},makeResult:function(a,b,c,d,e){return"\x3cli data-type\x3d'"+a+"' class\x3d'"+a+"' "+(b?"id\x3d'"+b+"' ":"")+(d?" data-lat\x3d'"+d+"' ":"")+(e?" data-lon\x3d'"+e+"' ":"")+"\x3e"+c+"\x3c/li\x3e"},isInBounds:function(a,b){return this.options.swBounds&&this.options.neBounds&&(a<this.options.swBounds.lat||a>this.options.neBounds.lat||b<this.options.swBounds.lon||b>this.options.neBounds.lon)?!1:!0},googleHasType:function(a,b){for(var c=0;c<a.length;c++)for(var d=
0;d<b.length;d++)if(a[c]===b[d])return!0;return!1},preprocessGoogleRequest:function(a){var b={};b.language=h.globals.locale.lc;b.address=a.value;this.options.swBounds&&this.options.neBounds&&(b.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(this.options.swBounds.lat,this.options.swBounds.lon),new google.maps.LatLng(this.options.neBounds.lat,this.options.neBounds.lon)));return b},showDropdown:function(a,b){h.events.publish("common.results.filterDrawer.preventScroll",!0);this.base(a,b)},
hideDropdown:function(a){h.events.publish("common.results.filterDrawer.preventScroll",!1);this.base(a);this.dropdown.hide();return!0}})})(window.R9,window.jq||window.jQuery);(function(c,d){c.createComponentClass("common.results.filters.DistanceFilter","common.results.filters.Filter",{landmarkInput:d(),cityOnlyCheckbox:d(),distanceDropdownWidget:void 0,distanceEl:null,landmark:null,setLandmarkFromPrevious:!1,cityIds:[],searchLandmark:null,tooltip:null,openMapLink:null,options:{toolTipMessage:null,isMultiValueSet:null,isDisabled:!1,featureClass:"",disabledText:"",forceDistanceSort:!0,forcedSortMode:"distance",smartyUrl:"/f/smarty",showOpenMapLink:!1},init:function(){var a=
this;this.base();this.landmarkInput=this.getChildElement("landmark");a.isMobileView()||this.options.useMcFlyStyling||(this.tooltip=this.landmarkInput.toolTip({content:this.options.toolTipMessage,position:"right",activation:"click",fadeIn:500,fadeOut:500,showImmediately:!1,positionUpdate:!0}));this.distanceEl=this.getChildElement("distance");this.distanceDropdownWidget=this.distanceEl[this.options.useSelectWidget?"r9Select":"dropdown"]({change:function(b,c,g,e){a.logUserInteraction("distanceFrom",
d(b.currentTarget).val());a.pushStateChangeWithDistanceSorting({field:"distance",location:a.landmarkInput.val()})},onOpen:function(){c.events.publish("common.results.filterDrawer.preventScroll",!0)},onClose:function(){c.events.publish("common.results.filterDrawer.preventScroll",!1)}}).getWidget();this.cityOnlyCheckbox=this.getChildElement("cityOnly");this.eventPrefix="filters.%s.".format(this.options.name);this.options.showOpenMapLink&&(this.openMapLink=this.getChildElement("open-map-link"))},logUserInteraction:function(a,
b){if("ga"===this.options.loggingType){switch(a){case "reset":a="showall";break;case "distanceFrom":a="select-distance";break;case "smarty":a="select-location";break;case "cityOnly":a="select-cityonly";break;case "openMap":a="select-open-map"}this.base({category:this.trackCategory,action:this.name,label:a,value:b})}else this.base(a)},addEventHandlers:function(){this.base();var a=this;this.landmarkInput.landmarksSmarty({dataSource:a.options.smartyUrl,positionOnScroll:!0,forceSelectionOfHighlightedItem:!1,
trackingType:"none",setItem:function(b,c){a.landmarkInput.val()!==c.str&&(a.landmarkInput.val(c.str),a.landmark={lat:c.lat,lon:c.lon,display:c.str,id:c.id,type:c.type},a.element.removeClass("empty"),a.logUserInteraction("smarty",a.landmarkInput.val()),a.pushStateChangeWithDistanceSorting({field:"smarty",location:a.landmarkInput.val()}))},extendRequest:function(){return{c:a.cityIds.join(",")}},appendTo:a.isMobileView()?a.landmarkInput.parent():"body",minWidth:a.isMobileView()?"auto":"250",display:a.isMobileView()?
"block":"inline",dropdownClass:" smartbox smartbox-landmarks smartbox-longnames "+a.options.featureClass+(a.options.useMcFlyStyling?" mcfly-styling":"")});a.isMobileView()&&(this.landmarkInput[0].setSelectionRange(0,9999),this.landmarkInput.on("focus",function(){d(this).select()}));this.subscribe("search.startSearch",function(){a.landmark=null});this.cityOnlyCheckbox.click(function(b){d(b.target).attr("aria-checked",d(b.target).prop("checked"));a.logUserInteraction("cityOnly");a.pushStateChange(null,
{changeData:{field:"cityOnly",value:"1"}})});this.subscribe("common.distanceFilter.renew.disable.options",function(b){a.options.isDisabled=b});this.subscribe(this.eventPrefix+"resetitem",this.setChecked.bind(this));this.options.showOpenMapLink&&this.registerEvent("click",this.openMapLink,function(){c.events.publish("results.mapToggle.toggle");c.events.publish("results.showMapEvent")})},cleanupExistingState:function(){this.willReset()},willReset:function(){this.cityOnlyCheckbox.prop("checked",!1);
this.distanceDropdownWidget.setValue("-1.00");this.landmarkInput.val("");this.landmark=null;this.landmarkInput.getWidget().options.swBounds=null;this.landmarkInput.getWidget().options.neBounds=null;this.resetForcedSortMode()},pushStateChangeWithDistanceSorting:function(a){this.options.forceDistanceSort&&-1===c.question.ask("resultsHeader.sortMode").sortType.indexOf(this.options.forcedSortMode)&&this.pushForcedSortMode(this.options.forcedSortMode,!0);this.pushStateChange(null,{changeData:a})},pushForcedSortMode:function(a,
b){c.events.publish("resultsHeader.sortType.force",{sortCode:a+"_"+(b?"a":"b")})},resetForcedSortMode:function(){c.events.publish("resultsHeader.sortType.resetForced")},update:function(a){this.adjustFilter();if(!this.options.isDisabled){var b=a.landmarkDisplayName;!b||this.landmark&&!this.setLandmarkFromPrevious&&b===this.landmark.display||(this.landmark={lat:a.lat,lon:a.lon,display:a.landmarkDisplayName,type:a.lmType,id:a.lmId},this.updateDisplay(a),this.updateSmartyBounds(a),this.setLandmarkFromPrevious=
!1);this.cityIds=a.cityIds;this.element.removeClass("empty");this.cityOnlyCheckbox.prop("checked",a.hasOwnProperty("cityOnly")&&a.cityOnly);if(a.hasOwnProperty("distance")){a=parseFloat(0===a.distance%1?"%s.0".format(a.distance):a.distance);for(var b=this.options.useSelectWidget?this.distanceDropdownWidget.dropdownOptions:this.distanceDropdownWidget.select.children(),c=null,d=0;d<b.length;d++){var e=this.options.useSelectWidget?b[d].getAttribute("data-value"):b[d].value,f=parseFloat(e);if(f===a||
a<f){c=e;break}}this.distanceDropdownWidget.setValue(c)}else this.distanceDropdownWidget.setValue("-1.00")}},updateSmartyBounds:function(a){var b=this.landmarkInput.getWidget();b.options.swBounds={lat:a.swBoundLat,lon:a.swBoundLon};b.options.neBounds={lat:a.neBoundLat,lon:a.neBoundLon}},updateDisplay:function(a){this.landmarkInput.val(a.landmarkDisplayName);var b=this.cityOnlyCheckbox.parent();a.isRegionSearch?b.addClass("hidden"):(b.hasClass("hidden")&&b.removeClass("hidden"),this.cityOnlyCheckbox.parent().find("label span").text(a.searchCityName))},
getState:function(){return null!==this.landmark?{lmLat:"%s".format(this.landmark.lat),lmLong:"%s".format(this.landmark.lon),distance:"%s".format(this.distanceDropdownWidget.getValue()),lmId:this.landmark.id,lmType:this.landmark.type,lmDisplay:this.landmark.display,cityOnly:this.cityOnlyCheckbox.is(":checked")}:{cityOnly:this.cityOnlyCheckbox.is(":checked")}},adjustFilter:function(){this.landmarkInput.attr("placeholder",this.options.disabledText);this.landmarkInput.attr("disabled",this.options.isDisabled);
this.distanceEl.find("select").attr("disabled",this.options.isDisabled)},setChecked:function(a){a&&("distance"===a&&(this.distanceDropdownWidget.setValue("-1.00"),this.landmarkInput.val(""),this.landmark=null,this.landmarkInput.getWidget().options.swBounds=null,this.landmarkInput.getWidget().options.neBounds=null,this.pushStateChange()),"cityOnly"===a&&this.cityOnlyCheckbox.trigger("click"))},setStateFromPrevious:function(a){this.setLandmarkFromPrevious=!0;a.reset?(this.resetForcedSortMode(),this.landmark=
null,this.distanceDropdownWidget.setValue("-1.00"),this.landmarkInput.val(""),this.landmarkInput.getWidget().options.swBounds=null,this.landmarkInput.getWidget().options.neBounds=null):(this.pushForcedSortMode(this.options.forcedSortMode,!0),this.landmark={id:a.value,type:a.key})},trackStateChange:function(a){if(this.trackStateChangeEnabled(a)){var b=a.changeData.field;"distance"===b?c.VestigoEvents.filters.hotels.location.distance(this.distanceDropdownWidget.getValue(),a.changeData.location):"cityOnly"===
b&&c.VestigoEvents.filters.hotels.location.cityonly(a.state&&a.state.cityOnly?c.VestigoType.FilterValueAction.select:c.VestigoType.FilterValueAction.unselect)}}})})(R9,jQuery);(function(b,e){b.createComponentClass("hotels.results.filters.PriceOptionsFilter","common.results.filters.ValueSetFilter",{options:{shouldOverrideReset:!1,onReset:function(a){var b=a&&"reset"===a.type,d=this.options.shouldOverrideReset;this.forEachItem(function(a,c){!d||"onlinereq"!==a&&"noimage"!==a?c.setChecked(0):c.setChecked(b?0:1)});this.logUserInteraction("showall");this.pushStateChange()},onGetState:function(a){return 0==a.onlinereq&&0==a.noimage&&0==a.dealonly&&0==a.bestvalueonly?{}:a}}})})(R9,
jQuery);(function(e,f){e.createComponentClass("hotels.results.filters.HotelNameFilter","common.results.filters.Filter",{selectedHotelsContainer:null,selectedHotels:{},searchCityIds:[],searchId:null,smarty:null,hotelFilterInput:null,popularDialogHtml:null,templates:{popularSectionTemplate:"popularSection",popularItemTemplate:"popularItem",popularHotelsLabel:"popularHotelsLabel"},options:{featureClass:"",isPopularEnabled:!1},init:function(){this.base();this.selectedHotelsContainer=this.getChildElement("hotels");
this.hotelFilterInput=this.getChildElement("hotelFilterInput");this.eventPrefix="filters.%s.".format(this.options.name);this.updatePopularDialog()},addEventHandlers:function(){this.base();var a=this;this.updateSmarty();this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("search.poll.response",function(b){a.updatePopularDialog(b);a.disabledFilter(b)});this.subscribe(this.eventPrefix+"resetitem",this.removeHotelFromSelected.bind(this))},updateSmarty:function(){var a=
this,b=e.config.getString("ui.brand.smartUrl","/f/smarty");this.smarty&&"function"===typeof this.smarty.destroy&&this.smarty.destroy();this.smarty=this.hotelFilterInput.hotelSmarty({dropdownClass:"smartbox smartbox-longnames hotelName"+a.options.featureClass+(a.options.useMcFlyStyling?" mcfly-styling":""),dataSource:b,forceSelection:!1,showDropDownWhenEmpty:!1,flareSmartyType:79,positionOnScroll:!0,minWidth:250,forceSelectionOfHighlightedItem:!1,trackingType:"none",initialData:function(){return a.popularDialogHtml},
setItem:function(b,c){b="h-"+c.id;a.hotelFilterInput.val("");e.events.publish("filter.reset",{name:"price-options"},{type:"reset"});a.addHotelToSelected(c.str,b);a.logUserInteraction("add");a.pushStateChange(null,{changeData:{field:b,value:"1",name:c.str}})},extendRequest:function(){return{searchid:a.searchId,c:a.searchCityIds.join(",")}}})},cleanupExistingState:function(){this.willReset()},willReset:function(){var a=this;Object.keys(this.selectedHotels).forEach(function(b){a.selectedHotels[b].remove();
delete a.selectedHotels[b]});this.selectedHotelsContainer.attr("aria-hidden",!0);e.events.publish("resultsHeader.sortType.resetForced")},update:function(a){if(a){this.searchCityIds=a.cityIds;this.element.removeClass("empty");this.resetSelectedHotels();if(a.hasOwnProperty("hotelIds"))for(var b=0,d=a.hotelIds.length;b<d;b++)this.addHotelToSelected(a.hotelNames[b],a.hotelIds[b],!0);a.hasOwnProperty("popularBrands")&&e.dom.schedule(this.updatePopularDialog.bind(this,a.popularBrands))}},updatePopularDialog:function(a){this.options.isPopularEnabled&&
("undefined"!==typeof a?(this.popularHotelsData=a.popularHotels,this.popularDialogHtml=this.renderPopularDialog()):this.popularDialogHtml=this.getChildElement("popularDialog").html())},resetSelectedHotels:function(){this.selectedHotels=[];this.selectedHotelsContainer.empty()},addHotelToSelected:function(a,b,d){var c=this;c.selectedHotels.hasOwnProperty(b)&&c.selectedHotels[b].length||(this.selectedHotels[b]=f(),d&&e.dom.schedule(function(){c.selectedHotels[b]=e.template.renderElement("hotelItem",
{name:a,code:b});c.selectedHotelsContainer.append(c.selectedHotels[b]);c.selectedHotelsContainer.attr("aria-hidden",!1);c.selectedHotels[b].find(".close").click(c.onCloseClick.bind(c,b))}))},onCloseClick:function(a){null!=a?this.removeHotelFromSelected(a):null!=this.currentTarget&&this.removeHotelFromSelected(this.currentTarget.parentElement.id())},removeHotelFromSelected:function(a){if(this.selectedHotels.hasOwnProperty(a)&&this.selectedHotels[a].length){var b=this.selectedHotels[a].data("name");
this.selectedHotels[a].slideUp().remove();delete this.selectedHotels[a];this.pushStateChange(null,{changeData:{field:a,value:"0",name:b}});this.logUserInteraction("remove");0===this.selectedHotels.length&&this.selectedHotelsContainer.attr("aria-hidden",!0)}},renderPopularDialog:function(){this.popularDialogHtml="";var a=f("\x3cdiv\x3e"),b=this.renderPopularItems(this.popularHotelsData,"hotel");if(!b)return"";b&&(a.append(e.template.renderElement(this.templates.popularHotelsLabel)),a.append(b));return a.html()},
renderPopularItems:function(a,b,d){var c="undefined"!==typeof d?d:5,h=this,g=null;a&&Object.keys(a).length&&(g=f(e.template.renderElement(this.templates.popularSectionTemplate,{type:b})),a.some(function(a,d){if(d>=c)return!0;d=b+"-"+a.id;h.selectedHotels.hasOwnProperty(d)?c++:(a=e.template.renderElement(h.templates.popularItemTemplate,{type:b,code:d,displayName:a.name}),g.append(a))}));return g},getState:function(){var a=Object.keys(this.selectedHotels);return 0<a.length?{hotelIds:a}:null},disabledFilter:function(a){var b=
this,d=!1,c=!1;a.filtersData&&(a.filtersData.hotelname&&(d=a.filtersData.hotelname.disabledFilter),a.filtersData.hotelchain&&(c=a.filtersData.hotelchain.isUserManipulated));this.hotelFilterInput[0].disabled=d||c;this.smarty.getWidget().runSearchOnFocus=function(){return!b.hotelFilterInput[0].disabled}},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&e.VestigoEvents.filters.hotels.hotelname(a.changeData.field,a.changeData.name,0==a.changeData.value?e.VestigoType.FilterValueAction.unselect:
e.VestigoType.FilterValueAction.select)}})})(R9,jQuery);(function(e,f){e.createComponentClass("hotels.results.filters.HotelChainFilter","common.results.filters.Filter",{selectedHotelChainsContainer:null,selectedHotelChains:{},searchCityIds:[],searchId:null,smarty:null,hotelChainInput:null,popularDialogHtml:null,templates:{popularSectionTemplate:"popularSection",popularItemTemplate:"popularItem",popularBrandsLabel:"popularHotelChainsLabel"},options:{featureClass:"",isPopularEnabled:!1},init:function(){this.base();this.selectedHotelChainsContainer=this.getChildElement("hotelChains");
this.hotelChainInput=this.getChildElement("hotelChainInput");this.eventPrefix="filters.%s.".format(this.options.name);this.updatePopularDialog()},addEventHandlers:function(){this.base();var a=this;this.updateSmarty();this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("search.poll.response",function(b){a.updatePopularDialog(b);a.disabledFilter(b)});this.subscribe(this.eventPrefix+"resetitem",this.removeHotelFromSelected.bind(this))},updateSmarty:function(){var a=
this,b=e.config.getString("ui.brand.smartUrl","/f/smarty");this.smarty&&"function"===typeof this.smarty.destroy&&this.smarty.destroy();this.smarty=this.hotelChainInput.hotelSmarty({dropdownClass:"smartbox smartbox-longnames hotelChainName"+a.options.featureClass+(a.options.useMcFlyStyling?" mcfly-styling":""),dataSource:b,forceSelection:!1,showDropDownWhenEmpty:!1,flareSmartyType:80,positionOnScroll:!0,minWidth:250,forceSelectionOfHighlightedItem:!1,trackingType:"none",initialData:function(){return a.popularDialogHtml},
setItem:function(b,c){a.hotelChainInput.val("");e.events.publish("filter.reset",{name:"price-options"},{type:"reset"});b=c.type+"-"+c.id;a.addHotelChainToSelected(c.str,b);a.logUserInteraction("add");a.pushStateChange(null,{changeData:{field:b,value:"1",name:c.str}})},extendRequest:function(){return{searchid:a.searchId,c:a.searchCityIds.join(",")}}})},cleanupExistingState:function(){this.willReset()},willReset:function(){var a=this;Object.keys(this.selectedHotelChains).forEach(function(b){a.selectedHotelChains[b].remove();
delete a.selectedHotelChains[b]});this.selectedHotelChainsContainer.attr("aria-hidden",!0);e.events.publish("resultsHeader.sortType.resetForced")},update:function(a){if(a){this.searchCityIds=a.cityIds;this.element.removeClass("empty");this.resetSelectedHotels();if(a.hasOwnProperty("hotelChainIds"))for(var b=0,d=a.hotelChainIds.length;b<d;b++)this.addHotelChainToSelected(a.hotelChains[b],a.hotelChainIds[b],!0);a.hasOwnProperty("popularBrands")&&e.dom.schedule(this.updatePopularDialog.bind(this,a.popularBrands))}},
resetSelectedHotels:function(){this.selectedHotelChains=[];this.selectedHotelChainsContainer.empty()},updatePopularDialog:function(a){this.options.isPopularEnabled&&("undefined"!==typeof a?(this.popularBrandData=a.popularBrands,this.popularDialogHtml=this.renderPopularDialog()):this.popularDialogHtml=this.getChildElement("popularDialog").html())},addHotelChainToSelected:function(a,b,d){var c=this;c.selectedHotelChains.hasOwnProperty(b)&&c.selectedHotelChains[b].length||(this.selectedHotelChains[b]=
f(),d&&e.dom.schedule(function(){c.selectedHotelChains[b]=e.template.renderElement("hotelChainItem",{name:a,code:b});c.selectedHotelChainsContainer.append(c.selectedHotelChains[b]);c.selectedHotelChainsContainer.attr("aria-hidden",!1);c.selectedHotelChains[b].find(".close").click(c.onCloseClick.bind(c,b))}))},onCloseClick:function(a){null!=a?this.removeHotelFromSelected(a):null!=this.currentTarget&&this.removeHotelFromSelected(this.currentTarget.parentElement.id())},removeHotelFromSelected:function(a){if(this.selectedHotelChains.hasOwnProperty(a)&&
this.selectedHotelChains[a].length){var b=this.selectedHotelChains[a].data("name");this.selectedHotelChains[a].remove();delete this.selectedHotelChains[a];this.removePreviousFilter(a);this.pushStateChange(null,{changeData:{field:a,value:"0",name:b}});this.logUserInteraction("remove")}},renderPopularDialog:function(){this.popularDialogHtml="";var a=f("\x3cdiv\x3e"),b=this.renderPopularItems(this.popularBrandData,"br");if(!b)return"";b&&(a.append(e.template.renderElement(this.templates.popularBrandsLabel)),
a.append(b));return a.html()},renderPopularItems:function(a,b,d){var c="undefined"!==typeof d?d:5,h=this,g=null;a&&Object.keys(a).length&&(g=f(e.template.renderElement(this.templates.popularSectionTemplate,{type:b})),a.some(function(a,d){if(d>=c)return!0;d=b+"-"+a.id;h.selectedHotelChains.hasOwnProperty(d)?c++:(a=e.template.renderElement(h.templates.popularItemTemplate,{type:b,code:d,displayName:a.name}),g.append(a))}));return g},getState:function(){var a=Object.keys(this.selectedHotelChains);return 0<
a.length?{hotelChainIds:a}:null},disabledFilter:function(a){var b=this,d=!1,c=!1;a.filtersData&&(a.filtersData.hotelchain&&(d=a.filtersData.hotelchain.disabledFilter),a.filtersData.hotelname&&(c=a.filtersData.hotelname.isUserManipulated));this.hotelChainInput[0].disabled=d||c;this.smarty.getWidget().runSearchOnFocus=function(){return!b.hotelChainInput[0].disabled}},setStateFromPrevious:function(a){a.reset?this.removeHotelFromSelected(a.key):this.addHotelChainToSelected(a.display,a.key,!0)},trackStateChange:function(a){this.trackStateChangeEnabled(a)&&
e.VestigoEvents.filters.hotels.hotelchain(a.changeData.field,a.changeData.name,0==a.changeData.value?e.VestigoType.FilterValueAction.unselect:e.VestigoType.FilterValueAction.select)}})})(R9,jQuery);(function(c,d){c.createComponentClass("common.results.filters.FilterDrawer",{options:{topOffset:233,customDialogSize:!0,pinnedTopOffset:105,pinnedLeftOffset:0,headerHeight:62,rtlEnabled:!1},init:function(){this.dialog=this.getChildElement("dialog").dialog({onClose:this.onDialogClose.bind(this),onOpen:this.onDialogOpen.bind(this),customWidth:!0}).getWidget()},addEventHandlers:function(){var a=this;this.subscribe("common.results.filterDrawer.open",function(){a.dialog.open()});this.subscribe("common.results.filterDrawer.close",
function(){a.dialog.close()});this.registerEvent("resize",d(window),function(){a.resizeDialog()});this.subscribe("common.results.filterDrawer.preventScroll",function(b){a.preventScroll(b)});this.subscribe("hotels.results.horizontalFilters.pinned",function(){a.resizeDialog()})},onDialogClose:function(){c.events.publish("common.results.filterDrawer.closed")},onDialogOpen:function(){this.resizeDialog()},resizeDialog:function(){if(this.options.customDialogSize){var a=c.question.ask("hotels.results.filtersPinned"),
b=c.question.ask("inlineSearch.height"),d=this.options.headerHeight,e=c.question.ask("languageBar.height")||0;a?(a=document.documentElement.clientHeight-this.options.pinnedTopOffset,b=this.options.pinnedTopOffset+window.pageYOffset):(b=b+d+e,a=document.documentElement.clientHeight-Math.floor(b)+window.pageYOffset,b=Math.floor(b));this.options.rtlEnabled?this.dialog.element.height(a).offset({top:b}).css({right:this.options.pinnedLeftOffset}):this.dialog.element.height(a).offset({top:b,left:this.options.pinnedLeftOffset})}},
preventScroll:function(a){this.dialog.element.toggleClass("no-scroll",a)}})})(R9,jQuery);(function(b){b.createComponentClass("common.results.filters.FilterList",{filtersSection:null,filterTabs:null,placeholderList:null,isPlaceholderEnabled:null,filterLayout:{},options:{searchCompleted:!1,primaryFilterList:[],moreFilterList:[],hideDelay:0},init:function(){this.filtersSection=this.getChildElement("filtersSection");this.placeholderList=this.getChildElement("placeholderList");this.filterTabs=this.element.find(".filterTab");this.isPlaceholderEnabled=this.placeholderList&&0<this.placeholderList.length;
this.hideFilterList()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.streaming.done",this.showFilterList.bind(this));this.subscribe(["search.startSearch","resultspage.streaming.start"],this.streamingStarted.bind(this));this.subscribe("resultspage.filtersData.changed",this.handleFilterResponse.bind(this));this.subscribe("search.searchFailed",this.hideAll.bind(this));this.subscribe("resultspage.filterList.show",this.showFilterList.bind(this));this.filterTabs.keydown(this.handleTabKeydown.bind(this));
this.element.on("click",".fullscreen-dialog-header",function(){a.element.toggleClass("active")})},handleFilterResponse:function(a){a&&Object.keys(a).length&&a[Object.keys(a)[0]].enabled&&(this.showFilterList(),b.events.publish("resultspage.filters.show"))},showFilterList:function(){this.element.removeClass("loading");this.filtersSection.removeClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden")},handleTabKeydown:function(a){switch(a.which){case b.globals.keyCodes.RETURN:case b.globals.keyCodes.SPACE:a.currentTarget.click();
break;case b.globals.keyCodes.RIGHT:this.focusNextTab($(a.currentTarget));break;case b.globals.keyCodes.LEFT:this.focusPrevTab($(a.currentTarget))}},focusNextTab:function(a){!a.next().is(a)&&a.next().is(".filterTab")?a.next().click().focus():this.filterTabs.eq(0).click().focus()},focusPrevTab:function(a){!a.prev().is(a)&&a.prev().is(".filterTab")?a.prev().click().focus():this.filterTabs.eq(-1).click().focus()},streamingStarted:function(a){"undefined"!==typeof a&&a.preserveFilters||(this.options.hideDelay?
setTimeout(this.hideFilterList.bind(this),this.options.hideDelay):this.hideFilterList())},hideFilterList:function(){this.element.addClass("loading");this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.removeClass("hidden");b.events.publish("resultspage.filters.hide")},hideAll:function(){this.filtersSection.addClass("hidden");this.isPlaceholderEnabled&&this.placeholderList.addClass("hidden");b.events.publish("resultspage.filters.hide")}})})(R9);(function(b,g){b.createComponentClass("hotels.results.filters.HotelFilterList","common.results.filters.FilterList",{filtersTabs:null,topFiltersSection:null,hotelSortDropdown:null,searchId:null,scrollIndicatorLeft:null,secondFiltersRowWrapper:null,scrollIndicatorRight:null,loadCompleteResultsTimeout:5E3,options:{isUpdatedStyling:!1,useMapToggle:!1,isMomondo:!1,horizontalFilter:!1,includeHeaderInMap:!1,moreCollapsible:!1},init:function(){this.base();this.options.isMomondo&&this.options.horizontalFilter&&
(this.scrollIndicatorRight=this.getChildElement("scrollIndicatorRight")[0],this.scrollIndicatorLeft=this.getChildElement("scrollIndicatorLeft")[0],this.secondFiltersRowWrapper=this.getChildElement("bottomFilterRowWrapper"),this.secondFiltersRowWrapper[0].scrollWidth>this.secondFiltersRowWrapper[0].clientWidth&&(this.scrollIndicatorRight.style.opacity="1"))},addEventHandlers:function(){this.base();var a=this,c=this.getChildElement("topFiltersTab"),d=this.getChildElement("moreFiltersTab"),e=this.getChildElement("moreFiltersSection");
this.filtersTabs=this.getChildElement("filterTabs");this.topFiltersSection=this.getChildElement("topFiltersSection");this.hotelSortDropdown=this.getChildElement("sort");c.on("click",function(){d.hasClass("selectedTab")&&(c.addClass("selectedTab").attr("aria-selected",!0),d.removeClass("selectedTab").attr("aria-selected",!1),e.addClass("hidden").attr("aria-expanded",!1),a.topFiltersSection.removeClass("hidden").attr("aria-expanded",!0),b.Analytics.api.trackEvent("filter_tabs_hrp/topFiltersTab"),b.events.publish("filterTab.changed"),
a.filtersTabs.removeClass("moreSelected"))});d.on("click",function(){c.hasClass("selectedTab")&&(d.addClass("selectedTab").attr("aria-selected",!0),c.removeClass("selectedTab").attr("aria-selected",!1),e.removeClass("hidden").attr("aria-expanded",!0),a.topFiltersSection.addClass("hidden").attr("aria-expanded",!1),b.Analytics.api.trackEvent("filter_tabs_hrp/moreFiltersTab"),b.events.publish("filterTab.changed"),a.filtersTabs.addClass("moreSelected"))});var f=this.getChildElement("mapViewPortal"),h=
this.getChildElement("fullScreenMapToggle");a.options.useMapToggle||(f.on("click",function(){b.Analytics.api.trackEvent("sparklemap/open")}),h.on("click",function(){b.events.publish("hotels.rp.fullScreenMap.toggle",{includeHeader:a.options.includeHeaderInMap})}),this.subscribe("hotels.rp.fullScreenMap.opened",function(){a.getChildElement("fullScreenMapToggleCaption").html(a.options.msg.mapLayerClose)}),this.subscribe(["hotels.rp.fullScreenMap.closed","resultspage.cleanup"],function(){a.getChildElement("fullScreenMapToggleCaption").html(a.options.msg.mapLayerOpen)}),
this.subscribe("searchform.submit",function(a){f.prop("href","/"+a.url+";map")}));this.subscribe("resultspage.filtersData.changed",function(){a.options.useMapToggle||(f.removeClass("hidden"),h.removeClass("hidden"));a.filtersTabs.removeClass("hidden");a.hotelSortDropdown.removeClass("hidden")});this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("resultspage.streaming.done",function(b){a.onSearchFinished(b)});this.subscribe(["search.startSearch","search.searchFailed"],
function(b){"undefined"!==typeof b&&b.preserveFilters||(a.options.useMapToggle||f.addClass("hidden"),a.filtersTabs.addClass("hidden"),a.hotelSortDropdown.addClass("hidden"))});this.options.isMomondo&&this.options.horizontalFilter&&(this.secondFiltersRowWrapper.on("scroll",function(){a.toggleFilterScrollIndicator("scroll")}),g(window).on("resize",function(){a.toggleFilterScrollIndicator("resize")}));if(this.options.moreCollapsible){var k=this.getChildElement("moreFiltersDrawer");e.addClass("collapsed");
this.registerEvent("click",k,function(){g(this).toggleClass("expanded");e.toggleClass("collapsed")})}},onSearchFinished:function(a){a.error&&a.error.type||this.element.find(".dispCt").removeClass("hidden")},toggleFilterScrollIndicator:function(a){"resize"===a&&1250<g(window)[0].innerWidth?(this.scrollIndicatorLeft.style.opacity="0",this.scrollIndicatorRight.style.opacity="0"):0===this.secondFiltersRowWrapper[0].scrollLeft?(this.scrollIndicatorLeft.style.opacity="0",this.scrollIndicatorRight.style.opacity=
"1"):this.secondFiltersRowWrapper[0].scrollLeft===this.secondFiltersRowWrapper[0].scrollWidth-this.secondFiltersRowWrapper[0].clientWidth?(this.scrollIndicatorLeft.style.opacity="1",this.scrollIndicatorRight.style.opacity="0"):this.secondFiltersRowWrapper[0].scrollWidth===this.secondFiltersRowWrapper[0].clientWidth?(this.scrollIndicatorLeft.style.opacity="0",this.scrollIndicatorRight.style.opacity="0"):(this.scrollIndicatorLeft.style.opacity="1",this.scrollIndicatorRight.style.opacity="1")}})})(R9,
jQuery);(function(b,e){b.createComponentClass("hotels.results.filters.HorizontalHotelFilterList","common.results.filters.FilterList",{moreFiltersDropdown:null,moreFiltersStartingText:null,trackingCategory:"HorizontalHotelFilterList",state:{visible:!1},events:{dualMapOpen:"hotels.results.dualViewMap.open",dualMapClosed:"hotels.results.dualViewMap.closed"},options:{},init:function(){this.base();this.moreFiltersDropdown=this.getChildElement("moreFilters-dropdown").getWidget();this.moreFiltersStartingText=this.moreFiltersDropdown.label.text()},
addEventHandlers:function(){this.base();var a=0;this.options.moreFilterList&&this.subscribe("resultspage.filtersData.changed",this.filterDataChanged.bind(this));this.moreFiltersDropdown.element.on("click",function(){b.Analytics.api.trackEvent({category:this.trackingCategory,action:"open",label:"more"})});if(this.options.primaryFilterList)for(a=0;a<this.options.primaryFilterList.length;a++)this.subscribe("FilterDropdownDialog.opened",{name:this.options.primaryFilterList[a]},this.trackFilterClick.bind(this));
this.subscribe(["horizontalFilters.resizeContent","pinnedContent.reset"],function(){b.events.publish("pinnedContent.setPlaceholderHeight",{})});this.subscribe("pinnableBar.placeholderHeight.updated",function(){b.events.publish("base.maps.triggerResize")});this.subscribe(this.events.dualMapOpen,this.syncWithMap.bind(this,!0));this.subscribe(this.events.dualMapClosed,this.syncWithMap.bind(this,!1))},syncWithMap:function(a){this.state.visible=a},trackFilterClick:function(a){a&&a.name&&b.Analytics.api.trackEvent({category:this.trackingCategory,
action:"open",label:a.name})},setAllFiltersDisabled:function(a){b.events.publish("filters.disabled",a)},showFilterList:function(){b.events.publish("filters.update.placeholderDisplay",{visible:!1})},hideFilterList:function(){b.events.publish("filters.update.placeholderDisplay",{visible:!0})},hideAll:function(){this.hideFilterList()},filterDataChanged:function(a){for(var b=0,c=0;c<this.options.moreFilterList.length;c++){var d=a[this.options.moreFilterList[c]];d&&d.isDirty&&b++}a=b?"".concat(this.moreFiltersStartingText,
" (").concat(b,")"):this.moreFiltersStartingText;this.moreFiltersDropdown.updateLabel(a);this.moreFiltersDropdown.element.toggleClass("isDirty",!!b)}})})(R9,jQuery);(function(c,e){c.createComponentClass("common.results.ProgressBar",{bar:null,timerId:null,currentValue:null,startTime:null,elapsedTime:null,delayInterval:150,options:{linear:!1,totalTime:6E4,interval:750,percentage:0,visible:!0,startEvents:["search.startSearch"],stopEvents:["resultspage.streaming.done"]},init:function(){this.bar=this.getChildElement("bar");0<this.options.percentage&&(this.currentValue=this.options.percentage);this.options.visible&&this.startTimer()},addEventHandlers:function(){var a=
this;this.subscribe(this.options.stopEvents,function(){a.finish()});this.subscribe(this.options.startEvents,function(b){b=b&&!isNaN(b.delay)?b.delay:400;a.stopTimer();a.element.addClass("Reset").addClass("notrans");a.setPercentage(0);var d=function(){a.element.removeClass("Reset");a.start();c.dom.schedule(function(){a.element.removeClass("notrans")})};0<b?setTimeout(d,b):d()})},setPercentage:function(a){isNaN(a)||(this.currentValue=100<a?100:a,a="translateX("+this.currentValue+"%)",this.bar.css({transform:a,
msTransform:a}))},getPosition:function(a){return this.options.linear?a:(3.4+(1-Math.exp(-(6*a-1.5))))/4.4},timerCallback:function(){this.elapsedTime=(new Date).getTime()-this.startTime;if(this.elapsedTime>=this.options.totalTime)this.finish();else if(100===this.currentValue)this.finish();else{var a=100*this.getPosition(this.elapsedTime/this.options.totalTime);this.setPercentage(a);c.events.publish("progressbar.percentage.change",{percent:a});this.setNextTimeout(this.delayInterval)}},finish:function(){var a=
this;this.setPercentage(100);this.stopTimer();setTimeout(function(){a.element.addClass("Hidden");c.events.publish("progressbar.finished")},400)},start:function(){this.element.removeClass("Hidden");this.startTimer()},setNextTimeout:function(a){var b=this;this.timerId=window.setTimeout(function(){b.timerCallback()},a)},startTimer:function(){null===this.timerId&&(this.elapsedTime=0,this.startTime=(new Date).getTime(),this.setNextTimeout(this.delayInterval))},stopTimer:function(){null!==this.timerId&&
(window.clearTimeout(this.timerId),this.startTime=this.timerId=null)}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.filters.placeholders.FilterPlaceholderList",{topFilters:null,moreFilters:null,hasMultipleFilterLists:!1,init:function(){this.topFilters=this.getChildElement("top");(this.moreFilters=this.getChildElement("more"))&&this.moreFilters.length&&(this.hasMultipleFilterLists=!0)},addEventHandlers:function(){this.hasMultipleFilterLists&&(this.subscribe("filterTab.changed",this.switchActiveFilterList.bind(this)),this.subscribe("moreFilters.toggle",this.toggleMoreFilterList.bind(this)))},
switchActiveFilterList:function(){this.topFilters.toggleClass("hidden");this.moreFilters.toggleClass("hidden")},toggleMoreFilterList:function(a){a?this.moreFilters.removeClass("hidden"):this.moreFilters.addClass("hidden")}})})(R9);(function(d,g){var h=/^(left|right)/,k=["stars","extendedrating"];d.createComponentClass("common.results.filters.PreviousFilters","common.results.filters.ValueSetFilter",{options:{removeItemTooltip:null},searchId:null,filtersData:{subs:{}},applyAllLink:null,init:function(){this.base();this.applyAllLink=this.getChildElement("applyAll")},addEventHandlers:function(){this.base();var a=this;this.subscribe("resultspage.searchId.changed",function(b){a.searchId=b.searchId});this.subscribe("resultspage.streaming.firstResults",
this.fetchPreviousFilters.bind(this,!1));this.subscribe("resultspage.streaming.done",this.fetchPreviousFilters.bind(this,!0));this.subscribe("filters.changed",this.checkChangedFilters.bind(this));this.subscribe("filters.myfilters.removeFromPrevious",this.removeFromPrevious.bind(this));this.subscribe("resultspage.preservedFilters.removed",this.reset.bind(this,{silent:!0}))},update:function(a){var b=Object.keys(a),c=this.getRenderedFilterOptions();0<b.length&&(b.filter(function(a){return!c.hasOwnProperty(a)}).forEach(function(b){this.addFilterItem(b,
a[b])},this),this.forEachItem(function(a){0>b.indexOf(a)&&this.removeItem(a)}),this.updateVisibility())},reset:function(a){this.bulkManipulate(0,"reset",a&&a.silent)},removeFromPrevious:function(a){this.filtersData.hasOwnProperty(a.name)&&this.filtersData[a.name].forEach(function(b){a.key&&a.key!==b.key||b.item.setChecked(0)})},addFilterItem:function(a,b){this.base(a,b,void 0,{showRemoveIcon:!0,removeTitle:this.options.removeItemTooltip});b=this.parseFilterCode(a);var c=this.getRenderedFilterOptions()[a];
this.filtersData.hasOwnProperty(b.name)||(this.filtersData[b.name]=[]);this.filtersData[b.name].push({key:b.key,value:b.value,item:c});1===c.getState()&&(b.silent=!0,d.events.publish("filters."+b.name+".setFromPrevious",b));this.options.mirrorDisabled&&(this.filtersData.subs[a]=d.events.subscribe("filters."+b.name+"."+b.key+".state.disabled",function(a){1===c.getState()&&a||c.setDisabled(a)}))},fetchPreviousFilters:function(a){var b=this;d.action.execute("common/results/filters/PreviousFiltersUpdateAction",
{searchId:this.searchId,currentFilters:a?Object.keys(this.getRenderedFilterOptions()).join(","):void 0}).then(function(a){a.personalizedFilterValues&&b.update(a.personalizedFilterValues)})},parseFilterCode:function(a){a=a.split(";");return{name:a[0],key:a[1],value:a[2]}},filterDataChanged:function(){},filterItemDidChange:function(a,b,c){a=this.parseFilterCode(a);0===c.getState()&&(a.reset=!0);c.state&&c.state.displayValue&&(a.display=c.state.displayValue);d.events.publish("filters."+a.name+".setFromPrevious",
a);this.logUserInteraction("selectItem",a.name);this.updateVisibility()},makeFilterOption:function(a,b,c,e){return this.base(a,b,c,e,g.extend({},{showRemoveIcon:!0,onRemove:this.onRemoveItem.bind(this)}))},removeItem:function(a){var b=this.getRenderedFilterOptions()[a],c=this.parseFilterCode(a),e=b.options.group;d.ComponentManager.remove(b);b.element.remove();this.filtersData.hasOwnProperty(e)&&(this.filtersData[e]=this.filtersData[e].filter(function(a){return a.key!==b.option.name}));this.options.mirrorDisabled&&
this.filtersData.subs[a]&&d.events.unsubscribe("filters."+c.name+"."+c.key+".state.disabled",this.filtersData.subs[a]);delete this.getRenderedFilterOptions()[a]},onRemoveItem:function(a){var b=a.state.code,c=this.parseFilterCode(b);a=0===a.getState();d.events.publish("filters."+c.name+".setFromPrevious",{key:c.key,value:c.value,reset:!0,silent:a});a&&d.action.execute("common/results/filters/PreviousFiltersDeleteAction",{searchId:this.searchId,name:c.name,field:c.key,value:c.value});this.removeItem(b);
this.logUserInteraction("removeItem",c.name);this.updateVisibility()},updateVisibility:function(){var a=Object.keys(this.getRenderedFilterOptions()).length;if(a){(this.element.hasClass("empty")||this.element.hasClass("hidden"))&&this.logUserInteraction("impression");this.element.removeClass("empty hidden");var b=0;this.forEachItem(function(a,c){0<c.getState()&&b++});var c=0<b;this.toggleResetLink(c);this.applyAllLink.length&&this.applyAllLink.toggleClass("hidden",c||1===a)}else this.element.addClass("empty hidden")},
bulkManipulate:function(a,b,c){this.forEachItem(function(b,c){b=this.parseFilterCode(b);b.silent=!0;b.reset=0===a;d.events.publish("filters."+b.name+".setFromPrevious",b);c.setChecked(a)});c||(this.pushStateChange(),this.logUserInteraction(b));this.updateVisibility()},applyAll:function(){this.bulkManipulate(1,"applyAll")},pushStateChange:function(){d.events.publish("filters.changed",{name:"myfilters"})},logUserInteraction:function(a,b){a={category:this.name,action:a};"undefined"!==typeof b&&(a.value=
b);d.Analytics.api.trackEvent(a)},checkChangedFilters:function(a){var b=this.filtersData[a.name];if(b&&b.length&&!a.hasOwnProperty("previousFilterChange")){if(a.hasOwnProperty("changeData")){var c=a.changeData,d=b.filter(function(a){return c.field===a.key});if(-1<k.indexOf(a.name))b.forEach(function(a){c.field===a.key?a.item.setChecked(c.value):a.item.setChecked(0)});else if(null!==c.field.match(h))d.forEach(function(a){0<a.item.getState()&&parseInt(c.value,10)!==parseInt(a.value,10)&&a.item.setChecked(0)});
else{var f=parseInt(c.value,10);2===f?b.forEach(function(a){a.item.setChecked(a.key===c.field?1:0)}):d.forEach(function(a){a.item.setChecked(parseInt(a.value,10)===f)})}}else a.reset&&b.forEach(function(a){a.item.setChecked(0)});this.updateVisibility()}}})})(R9,jQuery);(function(d){R9.createWidgetClass("number.NumberInput","common.widgets.text.TextInput",{widgetPlaceholderClass:"vs-placeholder",inputElement:null,options:{needsPlaceholderSupport:!1,decimalLimit:null},init:function(){this.inputElement=this.getChildElement("input")||this.element;this.elementNode=this.inputElement.get(0)},addEventHandlers:function(){this.options.needsPlaceholderSupport&&(this.element.is(":focus")||this.handleElementBlurEvent(this.elementNode),this.bindInputEvent("focus",this.handleElementFocusEvent),
this.bindInputEvent("smartyfocus",this.handleElementFocusEvent),this.bindInputEvent("blur",this.handleElementBlurEvent));var b=this;"number"===typeof b.options.decimalLimit&&0<=b.options.decimalLimit&&this.inputElement.keyup(function(c){var a=d(c.currentTarget).val(),e=a.indexOf("."),f=a.length-e-1;-1!==e&&f>b.options.decimalLimit&&(a=parseFloat(a),"number"===typeof a&&a===a&&(d(c.currentTarget).val(a.toFixed(b.options.decimalLimit)),c.preventDefault()))})}})})(jq||jQuery);(function(a,c){a.createComponentClass("common.kn.Display",{options:{},addEventHandlers:function(){var b=this;this.subscribe("displayads.register",{type:b.options.type},function(a){b.registerDisplay()});b.options.destroyable&&this.subscribe("displayads.destroy",function(){a.events.publish("displayad.sra.destroy",b.getSlotParams())})},inlineComponentsReady:function(){this.options.lazyLoad||this.registerDisplay()},registerDisplay:function(){a.events.publish("displayad.sra.register",c.extend(this.getSlotParams(),
this.options))},destroy:function(){a.events.publish("displayad.sra.destroy",this.getSlotParams());this.base()},getSlotParams:function(){return{adDivId:this.id()}}})})(R9,jQuery);(function(f,c){var h=f.config.getBoolean("ui.horizon.rails.fuzzyComparisons",!0);f.createComponentClass("base.results.Rail",{options:{pinnable:!0,sticky:!1,debug:!1,debounceDelay:5,handleHorizontalScroll:!0,repositionTimeout:200,fixedTopPosition:0,preventDynamicPositioning:!1,defaultRailWidth:300,isBusinessMode:!1,appliedTravelPolicyIds:[],isOneWay:!1},prevScroll:0,upScroll:!1,stickTop:!1,stickBottom:!1,originalNode:null,staticPosition:0,pinnedContentHeight:0,enabled:!0,isFullScreenMapV3:!1,init:c.noop,
addEventHandlers:c.noop,inlineComponentsReady:function(){var a=this;a.originalNode=a.element.get(0);this.bindWindowEvents();this.element.hasClass("fullscreen-drawer")&&(this.isFullScreenMapV3=!0);this.options.pinnable&&this.subscribe("resultspage.streaming.done moreFilters.toggle filterTab.changed filter.overflow.toggle displayad.loaded textad.loaded pinnedContent.heightChanged horizon.filters.opened resultspage.requestResults.completed horizon.filters.FiltersDialog.itemToggled".split(" "),function(){a.onScroll()});
this.subscribe("pinnedContent.enable",function(b){a.enabled=b});this.subscribe(["pinnableBar.pinnedChange","pinnedContent.heightChanged"],function(){a.setPinnedContentHeight()});this.subscribe("pinnedContent.reset",function(){a.resetPosition()});this.subscribe("rail.update.preventDynamicPositioning",this.updatePreventDynamicPositioning.bind(this))},onScroll:function(){!1!==this.enabled&&(this.isRailAttached()?this.handleScroll():this.unbindWindowEvents())},handleScroll:function(){var a=this.getWindowScroll(),
b=this.getParentScroll();this.upScroll=this.prevScroll>a;this.prevScroll=a;(a=this.getPositionCSS(a,b,this.isElementTallerThanScreen()))&&this.element.css(a)},unbindWindowEvents:function(){c(window).off("scroll.pinrails-"+this.id());c(window).off("resize.pinrails-"+this.id())},bindWindowEvents:function(){var a;this.options.pinnable&&(0<this.options.repositionTimeout&&this.element.css("transition","transform %sms ease-in-out".format(this.options.repositionTimeout)),a=0<this.options.debounceDelay?f.Common.Utils.debounce(this.onScroll.bind(this),
this.options.debounceDelay):this.onScroll.bind(this),this.registerEvent("scroll.pinrails-"+this.id(),c(window),a),this.registerEvent("resize.pinrails-"+this.id(),c(window),a))},testBottom:function(a,b){return b?a<this.getParentHeight()-this.getWindowHeight():a+this.getElementHeight()<this.getParentHeight()},testTop:function(a,b){return a>this.getParentTop()-this.pinnedContentHeight-this.options.fixedTopPosition},isElementTallerThanScreen:function(){return this.getElementHeight()>this.getWindowHeight()},
calculateScrollPosition:function(a,b){return!b||this.upScroll&&this.fuzzyCompare(this.getElementTop()-this.getParentTop()-this.pinnedContentHeight,a)?{position:"top"}:!this.upScroll&&this.fuzzyCompare(a+this.getWindowHeight(),this.getElementBottom()-this.getParentTop())?{position:"bottom"}:{translate:this.staticPosition}},fuzzyCompare:function(a,b){if(!h)return a>=b;a-=b;return 0<a||1>=Math.abs(a)},resetPosition:function(){var a=c.extend(!0,{},{position:"relative",left:"unset",top:"auto",bottom:"auto"},
this.makeTransformCSS("translate(0,0)"));this.element.css(a)},getPositionCSS:function(a,b,d){if(!this.isRailSticky()&&!this.isFullScreenMapV3){var g=0,e={position:"relative",top:"auto",left:"unset",bottom:"auto","padding-top":""};a=this.testTop(a,d);var f=this.testBottom(b,d);this.staticPosition=this.getElementTop()-this.getParentTop();if(a&&f)if(b=this.calculateScrollPosition(b,d),b.translate&&(g=b.translate),b.position){if(this.options.preventDynamicPositioning)return;"top"===b.position?(e={position:"fixed",
left:"inherit",top:this.options.fixedTopPosition,bottom:"auto",width:this.getParentWidth()},g=this.pinnedContentHeight):(e={position:"fixed",left:"inherit",bottom:0,top:"auto",width:this.getParentWidth()},g=0)}else e=c.extend({},e);else g=a?this.getParentHeight()-this.getElementHeight():0,e=c.extend({},e);b="translateY(%spx)".format(Math.max(0,g));this.options.handleHorizontalScroll&&"fixed"===e.position&&(d=this.getLeftScroll(),0<d&&(b="translate(-%spx, %spx)".format(d,g)));return c.extend({},e,
this.makeTransformCSS(b))}},getParentWidth:function(){return this.element.parent().width()},makeTransformCSS:function(a){return{msTransform:a,transform:a}},destroy:function(){this.unbindWindowEvents();this.base()},isRailAttached:function(){return this.element&&c.contains(window.document,this.originalNode)},isRailSticky:function(){var a=this.element.css("position");return"sticky"===a||"-webkit-sticky"===a},getElementHeight:function(){return Math.round(this.element.outerHeight())},getElementBottom:function(){return this.getElementTop()+
this.getElementHeight()},getElementTop:function(){return Math.round(this.element.offset().top)},getWindowHeight:function(){return Math.round(c(window).outerHeight())},getWindowScroll:function(){return Math.round(c(window).scrollTop())},getParentHeight:function(){return Math.round(this.element.parent().outerHeight())},getParentTop:function(){return Math.round(this.element.parent().offset().top)},getLeftScroll:function(){return Math.round(c(window).scrollLeft())},getParentBottom:function(){return this.getParentTop()+
this.getParentHeight()},getParentScroll:function(){return this.getWindowScroll()-this.getParentTop()},setPinnedContentHeight:function(){var a=f.question.ask("pinnedContent.height");null!==a?this.pinnedContentHeight=a:0!==this.pinnedContentHeight&&(this.pinnedContentHeight=0)},updatePreventDynamicPositioning:function(a){a&&a.hasOwnProperty("preventDynamicPositioning")&&(this.options.preventDynamicPositioning=a.preventDynamicPositioning)},subscribeForUpdatingPolicyInfo:function(a,b){if(this.options.isBusinessMode){var d=
this,c=this.getChildElement(b);this.subscribe("search.poll.response",function(b){b=d.getNewPolicies(b.appliedTravelPolicyIds);b.length&&(Array.prototype.push.apply(d.options.appliedTravelPolicyIds,b),f.ajax.execute("common/results/mercury/"+a,{data:{appliedTravelPolicyIds:JSON.stringify(d.options.appliedTravelPolicyIds),isOneWay:d.options.isOneWay},appendTo:c,replace:!0,afterScript:function(){c.show()}}))});this.subscribe("search.startSearch",function(a){d.options.appliedTravelPolicyIds=[];d.options.isOneWay=
!!a&&!!a.oneway;c.hide()})}},getNewPolicies:function(a){if(!a)return[];var b=this.options.appliedTravelPolicyIds;if(!b)return a;var c=[];a.forEach(function(a){-1===b.indexOf(a)&&c.push(a)});return c}})})(R9,jQuery);(function(a,b){a.createComponentClass("hotels.results.HotelLeftRail","base.results.Rail",{options:{mapVersionCode:"fullscreen"},init:function(){var a=this;"fullscreendrawer"===this.options.mapVersionCode&&(a.element.addClass("fullscreen-drawer"),setTimeout(function(){a.element.addClass("left-rail-results-closed")},1400))},addEventHandlers:function(){this.base();this.registerEvent("click",this.getChildElement("expandFilterButton"),function(){a.events.publish("hotels.results.splitView.expand.toggle");
a.Analytics.api.trackEvent("splitViewMap/filterToggle/click")})}})})(R9,jQuery);(function(e,d){e.createComponentClass("hotels.results.HotelCovidCleanModal",{dialog:null,hasSeen:!1,brandList:null,options:{},init:function(){},addEventHandlers:function(){var a=this;this.subscribe("hotels.results.covid.cleanModal.show",function(b){a.setBrand(b.brand);a.open()});this.registerEvent("click",this.getChildElement("close-button"),this.close.bind(this));d(this.element).find(".brand a").on("click",function(a){a.stopPropagation(a)});d(this.element).find(".brand").on("click",function(){a.toggleBrand(d(this))});
this.brandList=this.getChildElement("brands")},toggleBrand:function(a){a.hasClass("closed")?(this.brandList.find(".brand.open").removeClass("open").addClass("closed").css({"min-height":"auto"}),a.toggleClass("closed").toggleClass("open"),this.manageHeight(a),this.ensureBrandVisible()):a.toggleClass("closed").toggleClass("open").css({"min-height":"auto"})},manageHeight:function(a){var b=a.find(".nameIconsArrow"),c=a.find(".details"),b=b.innerHeight(),c=c.innerHeight();a.css({"min-height":b+c+54+"px"})},
setBrand:function(a){var b=this,c=this.brandList.find(".brand"+a);this.brandList.find(".brand").removeClass("open").addClass("closed").css({"min-height":"auto"});c.removeClass("closed").addClass("open");window.setTimeout(function(){b.manageHeight(c)},250);this.ensureBrandVisible()},ensureBrandVisible:function(){var a=this.brandList.find(".brand.open").position().top,b=this.brandList.scrollTop();this.brandList.animate({scrollTop:b+a},1E3)},inlineComponentsReady:function(){this.dialog=this.getChildElement("covid-clean-dialog").dialog({renderInline:!0,
modal:!0,isAlertDialog:!0}).getWidget();this.closeButton=this.getChildElement("close-button")},open:function(){var a=this;this.dialog&&(this.dialog.open(),this.hasSeen=!0,setTimeout(function(){a.ensureBrandVisible()},500))},close:function(){this.dialog&&this.dialog.close()}})})(R9,jQuery);(function(b,c){b.createWidgetClass("loader.AriaLoadMessage",{options:{message:""},init:function(){this.message=this.getChildElement("message")},deactivateLoadMessage:function(a){this.message.text(a);this.message.attr("aria-label",a)},activateLoadMessage:function(a){"undefined"!==typeof a?this.message.text(a):this.message.text(this.options.message);"undefined"!==typeof a?this.message.attr("aria-label",a):this.message.attr("aria-label",this.options.message)}})})(R9,jQuery);(function(h,f){h.createComponentClass("hotels.results.HotelQueryAlerts",{includedListSet:null,nyepiDateEl:!1,warningsList:null,warningsHeader:null,options:{warnings:[]},init:function(){this.warningsList=this.getChildElement("warningsList");this.warningsHeader=this.getChildElement("warningsHeader");this.updateWarningVisibility()},inlineComponentsReady:function(){this.nyepiDateEl=this.getChildElement("nyepi-date")},addEventHandlers:function(){var b=this;this.subscribe("search.poll.response",function(a){b.updateWarningVisibility(a)});
this.subscribe("resultspage.cleanup",function(){b.isVisible(!1)})},updateWarningVisibility:function(b){var a=this,e=[];this.options.warnings.forEach(function(c){var d=a.getChildElement(c.id);"nyepiDayOfSilenceWarning"===c.id?(c=b&&b.nyepiWarningDate||!1,a.swapClassesToggle(f(d),"","Warning--hidden",c),a.swapClassesToggle(f(d).parent().parent(),"Warnings__List__Item--visible","Warnings__List__Item--hidden",c),c&&(e.push(d),a.nyepiDateEl&&a.nyepiDateEl.length&&b.nyepiWarningDate&&a.nyepiDateEl.html(b.nyepiWarningDate))):
(e.push(d),a.swapClassesToggle(f(d),"","Warning--hidden",!0))});var g=1<e.length;a.swapClassesToggle(this.warningsList,"Warnings__List--Multiple","Warnings__List--Single",g);a.swapClassesToggle(this.warningsHeader,"Warnings__Header--visible","Warnings__Header--hidden",g);a.isVisible(0<e.length)},isVisible:function(b){b?this.swapClasses(this.element,"Container--hidden","Container--visible"):this.swapClasses(this.element,"Container--visible","Container--hidden")}})})(R9,jQuery);(function(f,g){f.createComponentClass("hotels.results.RegionCardsSlim",{cardTemplateId:"hotelRegionCard",titleTemplateId:"hotelRegionTitle",tagTemplateId:"cityFilterTag",cardsContainer:null,titleContainer:null,tagsContainer:null,countsEl:null,titleRendered:!1,userClosed:!1,renderedCards:null,renderedTags:null,arrows:null,prevButton:null,nextButton:null,options:{isNewRegionFlowEnabled:!1,cardWidth:242,upperCaseFilterTag:!0},init:function(){this.renderedCards={};this.renderedTags={};this.cardsContainer=
this.getChildElement("cards");this.titleContainer=this.getChildElement("title");this.tagsContainer=this.getChildElement("tags");this.arrows=this.getChildElement("arrows");this.prevButton=this.getChildElement("prev");this.nextButton=this.getChildElement("next")},addEventHandlers:function(){var a=this,b=this.options.isNewRegionFlowEnabled?2:f.config.getInt("ui.hrp.filters.regions.minDisplay",3);this.subscribe("resultspage.cleanup",this.cleanup.bind(this));this.subscribe("resultspage.filtersData.changed",
function(c){f.events.publish("resultspage.isRegionSearch",{isRegionSearch:c.hasOwnProperty("regions")});c.hasOwnProperty("regions")&&c.regions.valueMap&&Object.keys(c.regions.valueMap).length>=b&&(a.update(c.regions),3>=Object.keys(c.regions.valueMap).length?(a.arrows.hide(),a.cardsContainer.removeClass("gte5")):(a.cardsContainer.addClass("gte5"),a.arrows.show(),a.addPageTurnHandlers()))})},update:function(a){var b=a.topCtids,c=Object.keys(a.valueMap).length;this.element.hasClass("hidden")&&(this.element.removeClass("hidden"),
this.userClosed&&(this.element.slideDown(),this.userClosed=!1));this.titleRendered||!a.shortName||this.options.isNewRegionFlowEnabled?this.titleRendered&&(this.titleContainer.find(5>c?".gte5":".lt5").hide(),this.titleContainer.find(5<=c?".gte5":".lt5").show(),this.titleContainer.find("span.count").text(c),a.shortName&&this.titleContainer.find("span.name").text(a.shortName)):(this.titleContainer.html(f.template.renderElement(this.titleTemplateId,{count:c,name:a.shortName})),this.titleContainer.find(5>
c?".gte5":".lt5").hide(),this.titleContainer.find(5<=c?".gte5":".lt5").show(),this.titleRendered=!0);for(c=0;c<b.length;c++){var d=c;4<b.length&&(d=((c-1)%b.length+b.length)%b.length);var e=b[d];if(d=this.prepareRegionData(e,a,d))this.renderedCards.hasOwnProperty(e)?this.updateExistingCard(d):(this.addNewCard(d),this.addFilterTag(e,a.valueMap[e].displayValue))}this.updateCardSelection(a.valueMap)},addPageTurnHandlers:function(){this.nextButton.off("click").on("click",this.scrollCarousel.bind(this,
!0));this.prevButton.off("click").on("click",this.scrollCarousel.bind(this,!1))},scrollCarousel:function(a){var b=this,c=(a?"-":"")+this.options.cardWidth;this.cardsContainer.addClass("animating").css("transform","translateX("+c+"px)");this.nextButton.off("click");this.prevButton.off("click");setTimeout(function(){b.addPageTurnHandlers();b.cardsContainer.removeClass("animating").css("transform","translateX(0)");a?b.cardsContainer.append(g(".col-card",b.cardsContainer).first()):b.cardsContainer.prepend(g(".col-card",
b.cardsContainer).last())},500)},prepareRegionData:function(a,b,c){return b.valueMap[a]?{id:this.id(a),ctid:a,url:b.coverPhotos[a],displayOrder:c,popular:0===c,minPrice:b.valueMap[a].minPrice,selected:1===b.valueMap[a].selected,title:b.valueMap[a].displayValue,subtitle:b.ctidCountry?b.ctidCountry[a]:""}:null},addNewCard:function(a){var b=this,c=f.template.renderElement(this.cardTemplateId,a);c.data("ctid",a.ctid);c.click(function(){b.pushRegionFilterUpdate(a.ctid)});a.selected&&c.addClass("chosen");
(a.call||a.info||!a.minPrice.match(/\d/g))&&c.addClass("no-price");this.renderedCards[a.ctid]=c;this.cardsContainer.append(c)},pushRegionFilterUpdate:function(a){f.events.publish("filters.regions.togglecity",a);this.renderedCards[a].toggleClass("chosen");a=this.renderedTags[a];a.hasClass("hidden")?this.showFilterTag(a):a.addClass("hidden")},updateCardSelection:function(a){var b=this;Object.keys(a).forEach(function(c){var d=b.renderedCards[c],e=b.renderedTags[c];d&&e&&(1===a[c].selected?(d.addClass("chosen"),
e.hasClass("hidden")&&b.showFilterTag(e)):(d.removeClass("chosen"),e.addClass("hidden")))})},showFilterTag:function(a){this.tagsContainer.append(a);a.removeClass("hidden")},addFilterTag:function(a,b){var c=this;b=f.template.renderElement(this.tagTemplateId,{name:c.options.upperCaseFilterTag?b.toUpperCase():b});this.tagsContainer.append(b);b.addClass("hidden");b.find(".close").click(function(){c.pushRegionFilterUpdate(a)});this.renderedTags[a]=b},updateExistingCard:function(a){var b=this.renderedCards[a.ctid];
a.selected&&!b.hasClass("chosen")&&b.addClass("chosen")},cleanup:function(){this.cardsContainer.empty();this.titleContainer.empty();this.tagsContainer.empty();this.titleRendered=!1;this.renderedCards={};this.renderedTags={};this.element.addClass("hidden")}})})(R9,jQuery);(function(a){a.createComponentClass("common.results.UnconfirmedAccountWarning",{init:function(){this.dialog=this.getChildElement("dialog").dialog({}).getWidget();this.footerLink=this.getChildElement("footerLink")},addEventHandlers:function(){this.subscribe("common.results.unconfirmedWarning",this.setUpDialog.bind(this))},setUpDialog:function(a){this.email=a.email;a.sendEmailBeforeOpeningDialog&&this.resendConfirmationEmail();this.dialog.open()},resendConfirmationEmail:function(){a.events.publish("common.results.resendConfirmationEmail",
{email:this.email})}})})(R9);(function(a,c){a.createComponentClass("hotels.results.HotelPrivateRatesBanner",{options:{promoParams:null},addEventHandlers:function(){var b=this;this.getChildElement("inlinePrivateRatesButton").click(function(){a.Analytics.api.trackEvent("hotel/results/privateRatesPromo");var d=c.extend({regurl:b.options.promoParams.promo},b.options.promoParams);a.authentication.showLogin(d)});this.getChildElement("close").click(function(){b.element.hide();setMetaCookie("PRIVATE_DEAL_BANNER",!1)})}})})(R9,jQuery);(function(d,g){d.createComponentClass("common.results.DisplayCounts",{filteredCount:null,totalCount:null,showAllLink:null,product:null,baseProductString:null,options:{withUnits:!1,isHorizontalMode:!1,labelMsg:"",filteredCountId:"",totalCountId:"",pluralProductMsg:"",singleProductMsg:"",ariaLabel:"",wrapperClass:""},init:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.baseProductString=
this.product.html()},addEventHandlers:function(){var a=this;this.subscribe("resultspage.results.count.changed",function(c){d.dom.schedule(a.updateCounts.bind(a,c))});this.subscribe(["search.searchFailed","search.startSearch"],function(){d.dom.schedule(a.updateCounts.bind(a,{filtered:0,total:0}))});this.bindShowAll()},bindShowAll:function(){this.filteredCount=this.getChildElement("filteredCount");this.totalCount=this.getChildElement("totalCount");this.product=this.element.find("span.product");this.showAllLink=
this.element.find("a.showAll").eq(0);this.showAllLink.click(function(){g(this).hasClass("disabled")||(d.events.publish("filters.reset",{type:"showAll"}),d.Analytics.api.trackEvent({category:"Filters",action:"see-all-results"}))})},updateCounts:function(a){if(this.options.withUnits){this.filteredCount.text(a.filtered);this.totalCount.text(a.total);this.showAllLink.css("display",a.filtered===a.total?"none":"inline-block");var c=this.element.children().first();c.removeClass("visible").addClass("visible");
c.removeClass("simple").addClass("simple");this.element.removeClass("visible").addClass("visible");this.element.removeClass("simple").addClass("simple")}else{var b="";""!=this.options.ariaLabel&&(b=' aria-label\x3d"'+this.options.ariaLabel+'"');var c="\x3cspan id\x3d"+this.options.filteredCountId+"\x3e"+a.filtered+"\x3c/span\x3e",e="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+b+"\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3c/a\x3e",b="\x3ca class\x3d'showAll' href\x3d'javascript:void(0)'"+
b+"\x3e\x3cspan id\x3d"+this.options.totalCountId+"\x3e"+a.total+"\x3c/span\x3e\x3cspan class\x3d'product'\x3e "+this.options.pluralProductMsg+"\x3c/span\x3e\x3c/a\x3e",f=this.getChildElement("showLabel"),b=d.Common.Utils.String.formatChoice(this.options.labelMsg,a.filtered,a.filtered,c,e,b,this.options.pluralProductMsg,this.options.singleProductMsg,f.length?f[0].outerHTML:"");this.options.isHorizontalMode&&(b=this.options.pluralProductMsg,b=b.charAt(0).toUpperCase()+b.slice(1),b=d.Common.Utils.String.formatString(this.options.labelMsg,
c,e,b));c="\x3cdiv class\x3d'"+this.options.wrapperClass+" visible'\x3e"+b+"\x3c/div\x3e";this.element.html(c).addClass("visible");d.events.publish("displayCounts.newData",{data:c});this.bindShowAll()}this.element.find("a.showAll").toggleClass("disabled",a.filtered===a.total);a.hasOwnProperty("product")?this.product.html(a.product):this.product.html()!==this.baseProductString&&this.product.html(this.baseProductString)}})})(R9,jQuery);(function(b,d){var m=b.config.getBoolean("ui.horizon.widgets.styleJamSelect.scrollLock",!1),l=function(a){b.dom.toggleOneClass(document.body,"scroll-locked",a)};b.createWidgetClass("select.StyleJamSelect",{input:null,inputStatus:null,display:null,displayStatus:null,content:null,background:null,listWrapper:null,list:null,container:null,inlineElementName:null,isOpen:!1,isOpening:!1,options:{modal:!1,container:"",onOpen:null,onClose:null,change:null,onChange:null,alignment:"left",minWidth:300,modalBelowDisplay:!1,
showLabel:!0,showFocusIndication:!1,selectOnFocus:!0,focusModeHighlight:"",showInfoItem:!1,infoItemEnabledClass:"",infoItemDisabledClass:"",infoItemOptionValues:null,infoItemOptionTooltips:null,repositionOnScroll:!1,enableFocusAccessibility:!1,useWindowWidth:!1},init:function(){this.input=this.getChildElement("input");this.inputStatus=this.getChildElement("input-status");this.content=this.getChildElement("content");this.list=this.getChildElement("list");this.listWrapper=this.getChildElement("list-wrapper");
this.options.container&&(this.container=d(this.options.container),this.container.length||(this.container=null));this.options.modal?(this.display=this.getChildElement("display"),this.displayStatus=this.getChildElement("display-status"),this.background=this.getChildElement("bg"),this.inlineElementName="display"):this.inlineElementName="input";this.options.showInfoItem&&this.setupInfoOptionItem()},addEventHandlers:function(){var a=this;this.registerEvent("click",this[this.inlineElementName],function(){a.toggleContent()});
this.registerEvent("keydown.select",this[this.inlineElementName],function(c){a.handleKeyboardNavigation(c,a.inlineElementName)});this.registerEvent("focus",this[this.inlineElementName],this.onFocus.bind(this,this.inlineElementName));this.registerEvent("keydown.select",document,function(c){a.handleDocumentKeyboardNavigation(c,a.inlineElementName)});this.inputStatus.on("change",function(c){if(a.options.change){var n,b;b=d(this);n=b.attr("data-value");b=b.html();a.options.change.call(a,c,n,b)}});this.subscribe("select.force.close",
this.close.bind(this));this.list.on("click","li",function(){a.updateValue(d(this),!0);a.close()});m&&(this.registerEvent("mouseenter",this.list,l.bind(window,!0)),this.registerEvent("mouseleave",this.list,l.bind(window,!1)));this.registerEvent("click.select touchstart.select",d(document),function(c){0===d(c.target).closest("#"+a.id("content")+", #"+a.id()).length&&(a.close(),a.onBlur(a.options.modal?"display":"input"))});this.options.repositionOnScroll&&this.registerEvent("scroll",d(window),function(){b.dom.schedule(a.position.bind(a))});
this.registerEvent("resize",d(window),function(){b.dom.schedule(a.position.bind(a))});this.options.enableFocusAccessibility&&(this.element.focusin(function(){b.dom.swapClasses(a[a.inlineElementName],"",a.options.focusModeHighlight)}),this.element.focusout(function(){b.dom.swapClasses(a[a.inlineElementName],a.options.focusModeHighlight,"")}));this.options.showFocusIndication&&this.subscribe("body.accessibilityMode.enabled",function(c){c?b.dom.swapClasses(a[a.inlineElementName],"",a.options.focusModeHighlight):
b.dom.swapClasses(a[a.inlineElementName],a.options.focusModeHighlight,"")});this.subscribe("common.widgets.select.close",this.close.bind(this))},handleKeyboardNavigation:function(a,c){switch(a.which){case b.globals.keyCodes.SPACE:case b.globals.keyCodes.RETURN:this.isOpen||(this.isOpening=!0,this.open(),a.preventDefault());break;case b.globals.keyCodes.DOWN:case b.globals.keyCodes.UP:a.preventDefault();this.isOpen||(this.isOpening=!0,this.open());break;case b.globals.keyCodes.TAB:this.isOpen&&this.close(),
this.onBlur(c)}},handleDocumentKeyboardNavigation:function(a,c){switch(a.which){case b.globals.keyCodes.SPACE:case b.globals.keyCodes.RETURN:this.isOpen&&!this.isOpening?(this.updateValue(this.getHighlightedItems().first(),!1),this.triggerChange(),this.close(),a.preventDefault()):this.isOpening&&(this.isOpening=!1);break;case b.globals.keyCodes.DOWN:this.isOpen&&!this.isOpening?(a.preventDefault(),a=this.list.find("li.js-focus").next(),a.length||(a=this.list.children("li[data-selected\x3dtrue]"),
a.length||(a=this.list.children().eq(0))),this.focusItem(a)):this.isOpening&&(this.isOpening=!1);break;case b.globals.keyCodes.UP:this.isOpen&&!this.isOpening&&(a.preventDefault(),a=this.list.find("li.js-focus").prev(),a.length||(a=this.list.children("li[data-selected\x3dtrue]"),a.length||(a=this.list.children().eq(0))),this.focusItem(a));break;case b.globals.keyCodes.TAB:this.isOpen&&(this.close(),this.focusInlineElement(),this.onBlur(c));break;case b.globals.keyCodes.ESC:this.isOpen&&(this.updateSelection(this.getSelectedItem()),
this.close(),this.focusInlineElement())}},isValidElement:function(){return!0},focusInlineElement:function(){this[this.inlineElementName].focus()},onFocus:function(a){b.dom.swapChildrenClasses(this[a],this.options.sjstate[a],"blurred","focused")},onBlur:function(a){b.dom.swapChildrenClasses(this[a],this.options.sjstate[a],"focused","blurred")},toggleContent:function(){this.isOpen?this.close():this.open()},open:function(){if(!this.isOpen){this.position();var a=this;this.isOpen=!0;if(this.container)this.container.off("scroll."+
a.id()).on("scroll."+a.id(),function(){a.isOpen&&a.position()});this.list.scroller();setTimeout(function(){a.ensureVisible(a.getSelectedItem(),!0)},200);b.dom.swapChildrenClasses(this.content,this.options.sjstate.content,"closed","open");b.dom.swapChildrenClasses(this.input,this.options.sjstate.input,"closed","open");b.dom.swapChildrenClasses(this.display,this.options.sjstate.display,"closed","open");if("function"===typeof this.options.onOpen)this.options.onOpen(this);this.display&&this.display.attr("aria-expanded",
!0);b.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!0);b.events.publish("Select.opened",{id:this.id()})}},close:function(){if(this.isOpen){m&&l(!1);var a=this.isOpen;this.isOpen=!1;b.dom.swapChildrenClasses(this.content,this.options.sjstate.content,"open","closed");b.dom.swapChildrenClasses(this.input,this.options.sjstate.input,"open","closed");b.dom.swapChildrenClasses(this.display,this.options.sjstate.display,"open","closed");if("function"===typeof this.options.onClose)this.options.onClose(a,
this);this.display&&this.display.attr("aria-expanded",!1);b.globals.testMode&&this.element.add(this.content).attr("data-test-popover-open",!1);this.options.selectOnFocus&&this.focusInlineElement();b.events.publish("Select.closed",{id:this.id()})}},position:function(){var a=this.options.useWindowWidth?d(window).width():d(window).outerWidth(),c=this.getPositionElement(),b=c.offset(),h=c.outerWidth(),f={};if(this.container)var e=this.container.offset(),b={top:this.options.modalBelowDisplay?1:b.top-e.top+
container.scrollTop(),left:this.options.modalBelowDisplay?0:b.left-e.left};this.options.modal?(this.background.css({width:h-16,height:this.display.outerHeight()-16}),e=Math.max(h,this.options.minWidth),this.content.css({minWidth:e>a?a:e,maxWidth:a}),c=this.options.modalBelowDisplay?Math.floor(b.top+c.outerHeight()+1):Math.floor(b.top)):(c=Math.floor(b.top+c.outerHeight()),f.minWidth=h);var e=this.content.outerWidth(),g="rtl"===document.dir,b="right"===this.options.alignment?g?Math.ceil(b.left-(a-
e)):Math.ceil(b.left-(e-h)):g?Math.ceil(b.left-(a-h-10)):Math.floor(b.left);b+e>a&&(b=a-e-10,b=0<b?b:0);"rtl"===document.dir&&Math.abs(b)+e>a&&(a=a-e-10,b=0<a?-a:0);f.transform="translate("+b+"px, "+c+"px)";f.msTransform=f.transform;this.content.css(f)},getPositionElement:function(){return this.options.modal?this.display:this.input},ensureVisible:function(a,b){if(a.position()){var c=a.position().top;a=a.outerHeight(!0);var d=this.listWrapper.scrollTop(),f=this.listWrapper.height(),e=this.list.scrollTop();
if(b){b=this.list[0].scrollHeight;var g=c+this.list.scrollTop(),k=(f-a)/2;if(g>k&&b-g>k){this.list.scroller({scrollTo:d+e+c-k});return}g<k?this.list.scroller({scrollTo:0}):this.list.scroller({scrollTo:b-f})}0>c?this.list.scroller({scrollTo:d+e+c}):c+a>f&&this.list.scroller({scrollTo:d+e+(c+a-f)})}},getSelectedItem:function(){var a=this.list.find("li"),b=a.filter("[data-value\x3d'"+this.val()+"']");return b.length?b:a.first()},getHighlightedItems:function(){return this.list.children("li.js-focus")},
focusItem:function(a){if(this.options.selectOnFocus)this.updateSelection(a);else{var c=this.list.children(".js-focus");c.removeClass("js-focus").attr("aria-selected",!1);a.addClass("js-focus").attr("aria-selected",!0);var d=this.getStlBlock("item-focused");b.dom.swapClasses(c,d,"");b.dom.swapClasses(a,"",d);(this.display||this.element).attr("aria-activedescendant",a.attr("id"));this.isOpen&&this.ensureVisible(a,!0)}},toggleItemSelection:function(a,c){a.toggleClass("js-focus",c).attr("aria-selected",
c);b.dom.swapChildrenClasses(a,this.options.sjstate.listItem,c?"deselected":"selected",c?"selected":"deselected")},updateSelection:function(a){(this.display||this.element).attr("aria-activedescendant",a.attr("id"));this.toggleItemSelection(this.getHighlightedItems(),!1);this.toggleItemSelection(a,!0);this.options.selectOnFocus&&a.focus()},updateValue:function(a,b){this.isNodeDisabled(a)||(this.isOpen&&this.ensureVisible(a,!0),this.updateSelection(a),this.setInputValue(a),this.options.showInfoItem&&
this.setupInfoOptionItem(),b&&this.triggerChange())},triggerChange:function(){"function"===typeof this.options.change&&this.inputStatus.trigger("change")},setInputValue:function(a){var b=a.attr("data-value");a=a.attr("data-labelText")||a.attr("data-title");this.inputStatus.text(a);this.inputStatus.attr("data-value",b);this.inputStatus.attr("data-title",a);this.options.modal&&this.options.showLabel&&(this.displayStatus.html(a),this.displayStatus.attr("data-value",b),this.displayStatus.attr("data-title",
a));this.options.modal&&this.getChildElement("display-text").attr("aria-label",a);this.element.hasValue=!!b},setupInfoOptionItem:function(){var a=this.options.infoItemOptionValues;if(a&&0<a.length){var c=this.getChildElement("post-info"),a=a.indexOf(this.getValue());-1<a?((a=this.options.infoItemOptionTooltips[a])&&c.toolTip({content:a,extraClass:"halfWidth"}),b.dom.swapClasses(c,this.options.infoItemDisabledClass,this.options.infoItemEnabledClass)):b.dom.swapClasses(c,this.options.infoItemEnabledClass,
this.options.infoItemDisabledClass)}},_getItemByValue:function(a){return this.list.find("li[data-value\x3d'"+a+"']")},val:function(){return this.inputStatus.attr("data-value")},getValue:function(){return this.val()},dataVal:function(){return this.inputStatus.attr("data-value")},getDataValue:function(){return this.dataVal()},getText:function(){return this.inputStatus.html()||this.inputStatus.text()},setText:function(a){this.inputStatus.html(a)},setValue:function(a,b){a=this._getItemByValue(a);this.updateValue(a,
b)},setValueOrDefault:function(a,b){a=this._getItemByValue(a);a.length?this.updateValue(a,b):this.setValue("",b)},getItemText:function(a){a=this._getItemByValue(a);if(a.length)return a.html()},updateItemText:function(a,b){var c=this._getItemByValue(a);c.length&&(c.attr("data-title",b),c.html(b));a===this.getDataValue()&&this.setInputValue(c)},updateItemValue:function(a,b,d){a=this._getItemByValue(a);a.length&&a.attr("data-value",b);d&&(this.setInputValue(a),this.updateSelection(a))},selectItem:function(a,
b){a=this._getItemByValue(a);b&&(this.setInputValue(a),this.updateSelection(a))},isNodeSelected:function(a){return a.length&&"true"===a.attr("data-selected")},isNodeDisabled:function(a){return a.length&&a.attr("disabled")},getNodeDataValue:function(a){return a.length?a.attr("data-value"):""},disableValue:function(a){a=this._getItemByValue(a);a.length&&a.attr("disabled","disabled")},enableValue:function(a){a=this._getItemByValue(a);a.length&&a.removeAttr("disabled")},hideNode:function(a){a=this._getItemByValue(a);
a.length&&(this.swapClasses(a,"","Select__content__list__list-item--hidden"),a.attr("hidden","hidden"))},showNode:function(a){a=this._getItemByValue(a);a.length&&(this.swapClasses(a,"Select__content__list__list-item--hidden",""),a.removeAttr("hidden"))},hasVisibleNodes:function(){var a=this.list.find("li");return a.length>a.filter("[hidden\x3d'hidden']").length}})})(window.R9,window.jq||window.jQuery);function _slicedToArray(d,e){return _arrayWithHoles(d)||_iterableToArrayLimit(d,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}
function _iterableToArrayLimit(d,e){if(Symbol.iterator in Object(d)||"[object Arguments]"===Object.prototype.toString.call(d)){var a=[],b=!0,c=!1,g=void 0;try{for(var f=d[Symbol.iterator](),h;!(b=(h=f.next()).done)&&(a.push(h.value),!e||a.length!==e);b=!0);}catch(k){c=!0,g=k}finally{try{if(!b&&null!=f["return"])f["return"]()}finally{if(c)throw g;}}return a}}function _arrayWithHoles(d){if(Array.isArray(d))return d}
(function(d,e){d.createComponentClass("common.results.SortDropdown",{sortDropdownWidget:null,placeholderOption:[],unrolledOptions:null,unrolledDropdowns:null,dropdownWidgetType:"dropdown",useDropdownPlaceholderOption:!1,trackInteractions:!1,options:{activeSortType:"rank_a",isSortUnrolled:!1,hasDropdown:!1,hasDropdownSortText:!1,useSelectWidget:!1,styleJamSelect:!1},init:function(){this.options.hasDropdown&&(this.options.styleJamSelect?this.setupStyleJamSelect():this.setupDropdownWidget());this.options.useSelectWidget&&
this.setupSelectWidget();this.options.isSortUnrolled&&this.setupUnrolledOptions();this.options.hasDropdown&&this.options.isSortUnrolled&&(this.options.useSelectWidget||(this.placeholderOption=e(this.sortDropdownWidget.element.find('option[value\x3d""]'))),this.useDropdownPlaceholderOption=!0,this.updatePlaceholderOption())},addEventHandlers:function(){var a=this;this.options.isSortUnrolled&&this.unrolledOptions.click(function(b){a.setSortMode(e(b.currentTarget).attr("data-sort"))});this.subscribe(["resultsHeader.sortType.set",
"resultspage.sortMode.changed"],this.handleSortModeChange.bind(this));this.trackInteractions&&(this.subscribe(["Select.close","Select.closed","Widgets.DropdownDialog.closed"],function(b){b.id===a.id("sorting")&&a.trackToggleAction(!1)}),this.subscribe(["Select.open","Select.opened","Widgets.DropdownDialog.opened"],function(b){b.id===a.id("sorting")&&a.trackToggleAction(!0)}))},trackToggleAction:function(a){d.VestigoEvents&&d.VestigoEvents.sortresults.sort(a?d.VestigoType.Expandable.expand:d.VestigoType.Expandable.collapse)},
setupDropdownWidget:function(){var a=this;this.dropdownWidgetType=this.options.useSelectWidget?"r9Select":this.dropdownWidgetType;(this.sortDropdownWidget=this.getChildElement("sorting")[this.dropdownWidgetType]({change:function(b){return b&&a.setSortMode()}}).getWidget())||this.log.console("SortDropdownWidget is undefined, but hasDropdown is set to true in sortDropdown's velocity template.")},setupStyleJamSelect:function(){var a=this;this.sortDropdownWidget=this.getChildElement("sorting").getWidget();
this.sortDropdownWidget.setOption("change",function(b){return a.setSortMode()})},setupSelectWidget:function(){this.options.isSortUnrolled&&(this.placeholderOption=e(this.sortDropdownWidget.dropdownOptions[0]).detach())},setupUnrolledOptions:function(){this.unrolledOptions=this.getChildElement("sortUnrolled").find("a.sortOption");this.unrolledDropdowns=this.getChildElement("sortUnrolled").find("a.sortDropdown")},setSortMode:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.sortDropdownWidget&&
this.sortDropdownWidget.getValue(),a=e.extend({},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},{sortCode:a});d.events.publish("resultsHeader.sortType.set",a)},handleSortModeChange:function(a){a.sortCode&&(this.setSelectedDropdownOption(a.sortCode),this.setSelectedUnrolled(a.sortCode),this.updatePlaceholderOption())},setSelectedDropdownOption:function(a){if(this.options.hasDropdown){var b=this.findDropdownSortElement(a),c=b&&0<b.length;c&&(this.sortDropdownWidget.setValue(a),this.sortDropdownWidget.setText(b.attr("title")));
this.sortDropdownWidget.element.toggleClass("selected",c).attr("aria-selected",c)}},setSelectedUnrolled:function(a){var b=this;if(this.options.isSortUnrolled){var c=this.unrolledOptions.add(this.unrolledDropdowns);c.each(function(a,c){return b.resetUnrolledOption(c)});var d=a.split("_")[0],c=c.filter("[data-sort*\x3d".concat(d,"]"));a=this.flipSortCodeDirection(a);c.addClass("selected").attr("aria-selected",!0);c.attr("data-sort",a)}},resetUnrolledOption:function(a){e(a).removeClass("selected").attr("aria-selected",
!1);var b=e(a).attr("data-default-sort");b&&e(a).attr("data-sort",b)},flipSortCodeDirection:function(a){var b=a.split("_"),c=_slicedToArray(b,2),b=c[0];return(c=c[1])?(a="a"===c?"b":"a","".concat(b,"_").concat(a)):a},updatePlaceholderOption:function(){if(this.useDropdownPlaceholderOption){var a=this.placeholderOption.text();this.element.find(".sortOption.selected").length?(this.sortDropdownWidget.setText(a),this.sortDropdownWidget.setValue(this.placeholderOption.val(),!1),this.sortDropdownWidget.element.removeClass("selected").attr("aria-selected",
!1)):(this.placeholderOption.removeAttr("selected").attr("aria-selected",!1),this.sortDropdownWidget.element.addClass("selected").attr("aria-selected",!0));this.placeholderOption({disabled:"disabled","aria-disabled":!0,hidden:"hidden","aria-hidden":!0})}},findDropdownSortElement:function(a){return this.options.useSelectWidget?this.sortDropdownWidget.dropdownOptions.filter(function(b,c){return e(c).attr("data-value")===a}):this.options.styleJamSelect?this.sortDropdownWidget.getSelectedItem(a):this.element.find("option[value\x3d"+
a+"]")}})})(window.R9,window.jq||window.jQuery);(function(d,c){d.createComponentClass("hotels.results.HotelSortDropdown","common.results.SortDropdown",{reviewDropdownWidget:null,dropdownDialogList:null,currentSelectedItem:null,dropdownWidgetType:"dropdownDialog",hasSearchLocationChanged:!1,options:{defaultActiveSort:null,hasDropdownSortText:!1,sortStyleLikeQuicklinks:!1,styleJamSelect:!1,msg:{defaultActiveSort:"",defaultActiveSortTitle:""}},init:function(){var a=this;this.options.hasDropdown&&this.options.sortStyleLikeQuicklinks&&!this.options.styleJamSelect?
(this.sortDropdownWidget=this.getChildElement("sorting").dropdownDialog({}).getWidget(),this.dropdownDialogList=this.getChildElement("dropdownDialogList"),this.dropdownDialogList.on("click","a.option",function(b){a.onDropdownDialogChange(c(b.currentTarget).attr("data-sort"))}),this.sortDropdownWidget.element.find(".label").attr("data-title",this.options.msg.defaultActiveSortTitle),this.currentSelectedItem=this.dropdownDialogList.find("a[data-sort\x3d'"+this.options.defaultActiveSort+"']"),null!=this.currentSelectedItem&&
(this.currentSelectedItem.addClass("hidden"),this.currentSelectedItem.attr({"aria-hidden":!0,"aria-selected":!0})),this.updateSortTextTitle()):this.base();this.options.isSortUnrolled&&(this.reviewDropdownWidget=this.getChildElement("review").dropdown({change:function(b){return b&&a.onReviewSortChange()}}).getWidget());this.trackInteractions=d.config.getBoolean("ui.horizon.common.results.SortDropdown.track.enabled",!0)},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultspage.searchId.changed",
function(){a.options.hasDropdown&&null!==a.options.defaultActiveSort&&(a.options.sortStyleLikeQuicklinks?a.sortDropdownWidget.updateLabel(a.options.msg.defaultActiveSort):a.sortDropdownWidget.setValue(a.options.defaultActiveSort,!1));a.updateSortTextTitle()});this.options.hasDropdown&&this.options.styleJamSelect&&(this.subscribe("resultspage.sortMode.changed",function(b){a.sortDropdownWidget.setValue(b.sortCode,!1);a.updateSortTextTitle()}),this.subscribe("hotels.frontdoor.form.location",function(){a.hasSearchLocationChanged=
!0}),this.subscribe("resultsHeader.changed",function(){a.hasSearchLocationChanged&&(a.hasSearchLocationChanged=!1,a.sortDropdownWidget.setValue(a.options.msg.defaultActiveSort,!1),a.updateSortTextTitle())}))},handleSortModeChange:function(a){this.base(a);a.sortCode&&null!=this.reviewDropdownWidget&&-1<a.sortCode.indexOf("userrating")&&this.options.isSortUnrolled&&this.unrolledOptions.hasClass("selected")&&(a=this.unrolledOptions.first().find("select option"),this.reviewDropdownWidget.setValue(a,!1))},
onDropdownDialogChange:function(a){"undefined"!==typeof a&&(this.setSortMode(a,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}),this.sortDropdownWidget.isOpen&&this.sortDropdownWidget.close())},onReviewSortChange:function(){var a={reviewType:this.reviewDropdownWidget.getValue()};this.setSortMode("userrating",a)},setSelectedDropdownOption:function(a){if(this.options.hasDropdown&&!this.options.styleJamSelect){var b=this.sortDropdownWidget.element.find(".label");this.resetSelected();this.currentSelectedItem=
this.getDropdownElementFromSort(a);this.currentSelectedItem.addClass("hidden");this.currentSelectedItem.attr({"aria-hidden":!0,"aria-selected":!0});this.sortDropdownWidget.updateLabel(this.currentSelectedItem.text());b.attr("data-sort",a);b.attr("data-title",this.currentSelectedItem.data("title"))}},resetSelected:function(){var a=this.sortDropdownWidget.element.find(".label");null!=this.currentSelectedItem&&(c(this.currentSelectedItem).removeClass("hidden").attr({"aria-hidden":!1,"aria-selected":!1}),
this.currentSelectedItem=null);this.sortDropdownWidget.updateLabel(this.options.msg.defaultActiveSortTitle);a.attr("data-sort","");a.attr("data-title","")},getDropdownElementFromSort:function(a){var b=this.dropdownDialogList.find("a[data-sort\x3d'".concat(a,"']"));b.length||(a=a.split("_")[0],this.currentSelectedItem=this.dropdownDialogList.find("a[data-sort*\x3d'".concat(a,"']")));return b},updateSortTextTitle:function(){if(this.options.hasDropdownSortText&&this.options.sortStyleLikeQuicklinks){var a=
this.sortDropdownWidget.label;""!==c(a).data("title")&&this.sortDropdownWidget.updateLabel(c(a).text())}else this.base()}})})(window.R9,window.jq||window.jQuery);(function(b){b.createComponentClass("base.results.SimpleHeader",{counts:null,options:{loaderEnabled:!1},init:function(){this.counts=this.getChildElement("counts");this.loadingMessage=this.getChildElement("loadingMessage")},addEventHandlers:function(){var a=this;this.subscribe("displayCounts.newData",function(c){a.getChildElement("count").html(c.data);a.getChildElement("count").find("a").on("click",function(){b.events.publish("filters.reset",{type:"showAll"})})})},updateCountsDisplay:function(a){a&&
(a.hidden?this.swapClasses(this.counts,"ResultsHeader__Count--hidden","ResultsHeader__Count--visible"):this.swapClasses(this.counts,"ResultsHeader__Count--visible","ResultsHeader__Count--hidden"))},updateCountsDisplayWithMessage:function(a){a&&(a.searching?this.swapClasses(this.loadingMessage,"ResultsHeader__LoadingMessage--hidden","ResultsHeader__LoadingMessage--visible"):this.swapClasses(this.loadingMessage,"ResultsHeader__LoadingMessage--visible","ResultsHeader__LoadingMessage--hidden"))}})})(R9);function _slicedToArray(b,c){return _arrayWithHoles(b)||_iterableToArrayLimit(b,c)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}
function _iterableToArrayLimit(b,c){if(Symbol.iterator in Object(b)||"[object Arguments]"===Object.prototype.toString.call(b)){var a=[],d=!0,g=!1,e=void 0;try{for(var f=b[Symbol.iterator](),h;!(d=(h=f.next()).done)&&(a.push(h.value),!c||a.length!==c);d=!0);}catch(k){g=!0,e=k}finally{try{if(!d&&null!=f["return"])f["return"]()}finally{if(g)throw e;}}return a}}function _arrayWithHoles(b){if(Array.isArray(b))return b}
(function(b,c){b.createComponentClass("base.results.ResultsListHeader",{searchId:null,activeSortMode:{sortType:null,ascending:null},overriddenSortMode:null,trackInteractions:b.config.getBoolean("ui.horizon.base.results.ResultsListHeader.track.enabled",!0),options:{sortType:"rank_a",sortUnrolled:!1,quickLinkSort:!1},init:function(){var a=this;this.activeSortMode=this.getSortDataFromString(this.options.sortType);this.answer("resultsHeader.sortMode",function(){return a.activeSortMode})},addEventHandlers:function(){var a=
this;this.subscribe("resultsHeader.changed",function(b){return a.onChange(b)});this.subscribe("resultspage.sortMode.changed",function(b){return a.onChange(b)});this.subscribe("resultsHeader.sortType.set",this.setSortType.bind(this));this.subscribe("resultsHeader.sortType.force",this.forceSortType.bind(this));this.subscribe("resultsHeader.sortType.resetForced",this.resetForcedSortType.bind(this))},onChange:function(a){a.sort?this.activeSortMode=a.sort:a.sortCode&&(this.activeSortMode=this.getSortDataFromString(a.sortCode))},
setSortType:function(a){(a=this.processSortParams(a))&&(a.sortCode!==this.getStringFromSortData(this.activeSortMode)||a.reviewType||a.forceChange)&&(a.isForcedSort||(this.overriddenSortMode=null),a.silent||this.pushSortUpdates(a))},processSortParams:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(a.reviewType)a.sortCode="userrating";else if(!a.sortCode)return this.log.console('missing data sent in "resultsHeader.sortType.set" event.\n                Please publish an object with at least a sortCode or a reviewType property.'),
null;a.sort=this.getSortDataFromString(a.sortCode);"customTicket"===a.sort.sortType&&(a.customTicket=!0);return a},pushSortUpdates:function(a){this.logSortTypeChange(a);b.events.publish("resultsHeader.changed",a)},forceSortType:function(a){if(this.getStringFromSortData(this.activeSortMode)!==a.sortCode){var d=this.activeSortMode;a=c.extend({},a,{isForcedSort:!0});b.events.publish("resultsHeader.sortType.set",a);this.overriddenSortMode=d}},resetForcedSortType:function(){if(this.overriddenSortMode){var a=
{sortCode:this.getStringFromSortData(this.overriddenSortMode)};b.events.publish("resultsHeader.sortType.set",a)}},getSortDataFromString:function(a){a=a.split("_");a=_slicedToArray(a,2);var b=a[1];return{sortType:a[0],ascending:b?"a"===b:null}},getStringFromSortData:function(a){var b=a.sortType;a=a.ascending;return"undefined"===typeof a||null===a?b:"".concat(b,"_").concat(a?"a":"b")},logSortTypeChange:function(a){a.sort&&a.sort.sortType&&(this.trackInteractions&&this.trackSortBy(a.sort.sortType,a.sort.ascending),
a.sort.ascending&&b.Analytics.api.trackEvent({category:"Sort",action:a.sort.sortType,label:this.generateSortLoggingLabel(a.sort.sortType,a.sort.ascending)}))},generateSortLoggingLabel:function(a,b){return"".concat(a,"_").concat(b?"ascending":"descending")},trackSortBy:function(a,d){if(b.VestigoEvents){var c=d?b.VestigoType.Sortable.asc:b.VestigoType.Sortable.desc,e=b.VestigoEvents.sortresults;switch(a){case "price":e.price(c);break;case "distance":e.distance(c);break;case "recommended":case "rank":d&&
e.recommended()}}}})})(window.R9,window.jq||window.jQuery);(function(c,f){c.createComponentClass("hotels.results.HotelResultsListHeader","base.results.ResultsListHeader",{roomDisclaimer:null,mainHeader:null,filterState:null,providerLangHeader:null,options:{showLangHeader:!1,roomDisclaimers:{nightly:null,total:null}},init:function(){this.base();this.providerLangHeader=this.getChildElement("providerLangHeader");this.filterState={};this.roomDisclaimer=this.getChildElement("disclaimer")},addEventHandlers:function(){var a=this;this.base();this.subscribe("searchform.submit",
this.onSearchSubmit.bind(this));this.options.showLangHeader&&(this.subscribe("resultspage.streaming.done",this.setProviderLangHeaderOnInit.bind(this)),this.subscribe("filters.changed",this.setProviderLangHeaderOnFilters.bind(this)));this.subscribe("filters.reset",this.setSortType.bind(this,{sortCode:this.options.sortType}));this.subscribe("resultsHeader.changeVisibility",function(b){return a.element.toggleClass("Hidden",!b)});this.subscribe("results.mapToggle.syncState",this.onMapViewChange.bind(this))},
onChange:function(a){this.base(a);this.updateRoomDisclaimer(a)},onSearchSubmit:function(){this.providerLangHeader.empty()},onMapViewChange:function(a){a&&a.hasOwnProperty("isMapOpen")&&this.element.toggleClass("mapView",a.isMapOpen)},updateRoomDisclaimer:function(a){if(a){var b=this.getChildElement("disclaimer-text");1<a.rooms||1<c.question.ask("hotel-rooms-selected")?("totaltaxes"===a.priceType?b.html(this.options.roomDisclaimers.total):b.html(this.options.roomDisclaimers.nightly),this.roomDisclaimer.removeClass("hidden")):
this.roomDisclaimer.addClass("hidden")}},setProviderLangHeaderOnInit:function(a){var b=this;a.searchId&&0<a.searchId.length&&this.searchId!==a.searchId&&(this.searchId=a.searchId,a=0<this.filterState.length?{searchId:this.searchId,filterState:JSON.stringify(this.filterState)}:{searchId:this.searchId,useViewStateFilterState:!0},c.ajax.execute("hotels/results/ProviderLanguageHeader",{data:a,beforeScript:function(){b.providerLangHeader.empty()},appendTo:b.providerLangHeader}))},setProviderLangHeaderOnFilters:function(a){var b=
this;null===a.state?delete this.filterState[a.name]:this.filterState[a.name]=a.state;this.searchId&&0<this.searchId.length&&(a={data:{searchId:this.searchId,filterState:JSON.stringify(this.filterState)},beforeScript:function(){b.providerLangHeader.empty()},appendTo:b.providerLangHeader},c.ajax.execute("hotels/results/ProviderLanguageHeader",a))},generateSortLoggingLabel:function(a,b){switch(a){case "price":return b?"cheapest":"mostexpensive";case "priceless":return b?"cheapest":"mostexpensive";case "rank":return b?
"best":"worst";case "userrating":return b?"best":"worst";case "stars":return b?"best":"worst";case "distance":return b?"closest":"furthest";default:return"unknown"}},trackSortBy:function(a,b){if(c.VestigoEvents){var e=b?c.VestigoType.Sortable.asc:c.VestigoType.Sortable.desc,d=c.VestigoEvents.sortresults;switch(a){case "userrating":d.reviewscore(e);break;case "reviewscore":d.reviewscore(e);break;case "stars":d.stars(e);break;case "rank":d.recommended();break;default:this.base(a,b)}}}})})(window.R9,
window.jq||window.jQuery);(function(c,e){c.createComponentClass("common.trips.MoveEventDialog",{dialog:null,contentEl:null,loaderEl:null,resultId:null,tripId:null,eventId:null,legNum:-1,templates:{moveEventDialogContent:"moveEventDialogContent",moveEventActionContent:"moveEventSuccessContent",moveErrorContent:"moveEventError"},options:{msg:{upcomingTripsOptionHeader:void 0,pastTripsOptionHeader:void 0,unexpectedErrorMessage:void 0,unexpectedErrorTitle:void 0,accessDeniedTitle:void 0,accessDeniedMessage:void 0},optimisticUpdatesEnabled:!1},
init:function(){this.contentEl=this.getChildElement("contentPlaceholder");this.loaderEl=this.getChildElement("loader");this.options.optimisticUpdatesEnabled=c.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},inlineComponentsReady:function(){this.dialog=this.element.getWidget()},addEventHandlers:function(){var a=this;this.subscribe("trips.move.dialog.open",e.proxy(this.processOpenEvent,this));this.subscribe("trips.move.dialog.close",function(){a.dialog.close()})},showGeneralError:function(a,
b){var f=this;b=b||this.options.msg.unexpectedErrorMessage;a=a||this.options.msg.unexpectedErrorTitle;this.loaderEl.hide();a=c.template.renderElement(this.templates.moveErrorContent,{title:a,message:b});this.contentEl.html(a);this.dialog.isOpen()||this.dialog.open();this.getChildElement("closeBtn").on("click",function(){f.dialog.close()})},handleGeneralError:function(a){a=a&&403===a.status;this.showGeneralError(a?this.options.msg.accessDeniedTitle:this.options.msg.unexpectedErrorTitle,a?this.options.msg.accessDeniedMessage:
this.options.msg.unexpectedErrorMessage)},processOpenEvent:function(a){this.clearData();if(a.tripId&&a.eventId&&a.resultId)this.tripId=a.tripId,this.eventId=a.eventId,this.resultId=a.resultId,a.legNum&&(this.legNum=a.legNum),c.action.execute("common.trips.ajax.EventData",{tripId:a.tripId,eventId:a.eventId}).done(e.proxy(this.onEventContentData,this)).fail(e.proxy(this.handleGeneralError,this)),this.contentEl.html(""),this.loaderEl.show(),this.dialog.open();else throw Error("tripId, eventId and resultId are required");
},generateDropdownOptions:function(a,b){var f=this,d=[];a=a||[];0<a.length&&(d.push({value:null,text:c.Common.Utils.String.formatString(b,a.length),checked:!1,disabled:!0}),e.each(a,function(a,b){d.push({value:b.id,text:b.title,checked:b.id===f.tripId,disabled:!1})}));return d},onEventContentData:function(a){this.loaderEl.hide();var b=a.data;a=this.generateDropdownOptions(b.upcomingTrips,this.options.msg.upcomingTripsOptionHeader);var f=this.generateDropdownOptions(b.pastTrips,this.options.msg.pastTripsOptionHeader),
d=b.event&&b.event.type||b.legs&&b.legs.length&&b.legs[0].type||"generic",b=c.template.renderElement(this.templates.moveEventDialogContent,{hasLegs:null!=b.legs,hasTrips:0<b.upcomingTrips.length||0<b.pastTrips.length,legs:b.legs,event:b.event,showLegTabs:0<=this.legNum,oneLeg:0<=this.legNum&&null!=b.legs?b.legs[this.legNum]:null,eventType:d,eventIsHotel:"hotel"===d,eventIsFlight:"flight"===d,eventIsCar:"car"===d,eventIsUnknown:"generic"===d});this.contentEl.html(b);this.dialog.isOpen()||this.dialog.open();
this.bindMoveEventDialog(a.concat(f))},bindMoveEventDialog:function(a){var b=this,f=new c.common.widgets.dropdown.Dropdown(this.id("dropdown"),{change:function(){c.Analytics.api.trackEvent("move-event/trip-picker ")}});0<a.length&&f.setOptions(a);this.setTabs();var d=this.getChildElement("legs"),k=this.getChildElement("trips"),n=this.getChildElement("tripName"),l=this.getChildElement("error"),h=this.getChildElement("moveBtn");k.on("tabs.change",function(){var b=e(this).data("active");0===b&&0===a.length?
h.attr("disabled","disabled"):h.removeAttr("disabled");c.Analytics.api.trackEvent(0===b?"move-event/existing-trip":"move-event/new-trip")});d.on("tabs.change",function(){var a=e(this).data("active");c.Analytics.api.trackEvent(0===a?"move-event/select-all-legs":"move-event/select-one-leg")});h.on("click",function(){function a(){h.off("click");f.destroy()}c.Analytics.api.trackEvent("move-event/move");b.options.optimisticUpdatesEnabled?b.dialog.close():(b.loaderEl.show(),l.hide());var e=1===d.data("active")?
b.legNum:null,g=1===k.data("active")?n.val():null,m=0===k.data("active")?f.getValue():null;c.action.execute("common.trips.ajax.MoveEventAction",b.getMoveRequestData(m,g,e)).done(function(d){d.success?(a(),b.onEventMove(d)):b.options.optimisticUpdatesEnabled?(a(),b.handleGeneralError(),c.events.publish("trips.move.event.failed")):(b.loaderEl.hide(),l.text(d.data.errorMsg),l.show())}).fail(function(d){a();b.handleGeneralError(d);c.events.publish("trips.move.event.failed")});b.options.optimisticUpdatesEnabled&&
(g||(g=f.getText().split("\u2013")[0].trim()),c.events.publish("trips.move.event.finished",{oldTripId:b.tripId,newTripId:m,newTripName:g,resultId:b.resultId,tripId:m,tripName:g,optimisticMove:!0}))})},onEventMove:function(a){var b=this;c.events.publish("trips.move.event.finished",{oldTripId:this.tripId,newTripId:a.data.newTripId,newTripName:a.data.newTripName,resultId:this.resultId,tripId:a.data.newTripId,tripName:a.data.newTripName,tripUrl:a.data.tripUrl,responseData:a.data});c.events.publish("trips.auto.save.data",
{tripId:a.data.newTripId,tripName:a.data.newTripName});this.options.optimisticUpdatesEnabled||(this.loaderEl.hide(),a=c.template.renderElement(this.templates.moveEventActionContent,a.data),this.contentEl.html(a),this.dialog.isOpen()||this.dialog.open(),this.getChildElement("closeBtn").on("click",function(){b.dialog.close();c.Analytics.api.trackEvent("move-event/success-close")}),this.getChildElement("tripLink").on("click",function(){c.Analytics.api.trackEvent("move-event/success-go-to-new")}))},clearData:function(){this.eventId=
this.tripId=null;this.legNum=-1},setTabs:function(){function a(a){a.data("active",a.find("li.selected").index())}this.element.find(".tabs").parent().each(function(){var b=e(this),c=b.find(".tabs li");a(b);c.click(function(){var d=e(this);b.data("active")!==d.index()&&(c.removeClass("selected"),d.addClass("selected"),b.find(".tab").hide(),b.find("#"+d.attr("rel")).show(),a(b),b.trigger("tabs.change"))})})},getMoveRequestData:function(a,b,c){a={oldTripId:this.tripId,newTripId:a,newTripName:b,eventId:this.eventId,
legNum:c};for(var d in a)null===a[d]&&delete a[d];return a}})})(window.R9,window.jQuery);(function(d,e){d.createComponentClass("common.trips.ResultsSavedItems",{savedItemsListContainer:null,savedItemsListEl:null,savedItemsHeader:null,goToTripEl:null,shareToTripsEl:null,compareLink:null,expiryMessageEl:null,headerTitleEl:null,isExpanded:!1,clickElementsToAvoid:null,options:{tripsURL:void 0,globalUrl:null,tripsFullUrl:null,showShareTripIcon:!1,sharingDialogTitle:"",msg:{viewTrip:void 0,viewTrips:void 0,savedToTripItems:void 0,savedToTripsItems:void 0,tripsCounter:void 0},stickyEnabled:!1,
isSaveInPlaceEnabled:void 0,vertical:void 0,searchPollURL:null,optimisticUpdatesEnabled:!1,extraPollRequest:!0,watchlistMakeoverEnabled:!1,tripToastEnabled:!0},listSize:0,tripsMap:{},searchId:void 0,hasNewSearchId:!1,savedItemsHeaderPlaceholder:null,resultItemClass:d.strings.encodeClassName("Base-Results-HorizonResult"),init:function(){this.goToTripEl=this.getChildElement("tripsLink");this.options.showShareTripIcon&&(this.shareToTripsEl=this.getChildElement("shareTripsLink"));this.savedItemsHeader=
this.getChildElement("header");this.savedItemsHeaderPlaceholder=this.getChildElement("headerPlaceholder");this.tripsToggleEl=this.getChildElement("savedItemsList");this.savedItemsListContainer=this.getChildElement("savedItemsList");this.savedItemsListEl=this.savedItemsListContainer.find(".list");this.compareLink=this.getChildElement("CompareLink");this.expiryMessageEl=this.getChildElement("expiryMessage");this.headerTitleEl=this.getChildElement("headerTitle");this.options.isSaveInPlaceEnabled&&this.savedItemsListContainer.hide();
this.options.optimisticUpdatesEnabled=d.config.getBoolean("ui.trips-optimistic-updates.enabled",!1)},inlineComponentsReady:function(){},initSticky:function(){this.options.stickyEnabled&&this.createStickyHeader()},resultsHeaderChanged:function(a){this.hideSavedItemList();var b=!(!a.hasOwnProperty("refreshResults")||!a.refreshResults);this.onSearchPollResponse(a,b)},addEventHandlers:function(){var a=this;this.subscribe("resultItem.saved",e.proxy(this.onItemSaved,this));this.subscribe("resultItem.removed",
e.proxy(this.onItemRemoved,this));this.subscribe(["resultspage.streaming.done","resultspage.refreshed"],e.proxy(this.onSearchPollResponse,this));this.subscribe(this.options.vertical+".results.savedItems.update",this.onSavedResultsUpdate.bind(this));this.subscribe("resultspage.searchId.changed",e.proxy(this.onSearchIdChange,this));this.subscribe("filters.changed",e.proxy(this.onFiltersChange,this));this.subscribe("resultsHeader.changed",e.proxy(this.resultsHeaderChanged,this));this.subscribe("resultspage.streaming.start",
e.proxy(this.initSticky,this));this.subscribe("trips.move.event.finished",e.proxy(this.onItemMoved,this));this.subscribe("trips.move.event.failed",e.proxy(this.onItemMoveFailed,this));this.subscribe("resultsSavedItems.show",e.proxy(this.updateVisibility,this));this.subscribe("resultsSavedItems.hide",e.proxy(this.hideSavedItemList,this));this.savedItemsListEl.on("click",".bookingLink",this.logBookit);this.goToTripEl.on("click",this.logGoToTrip);var b=this.options;if(b.showShareTripIcon)this.shareToTripsEl.on("click",
function(c){c.stopPropagation();c.preventDefault();var f=a.getFirstTrip();c=a.savedItemsListContainer.find("div[data-resultid]").data("resultid");var g=0===f.tripUrl.indexOf("http")?f.tripUrl:a.options.globalUrl+f.tripUrl,f=e("\x3cdiv\x3e").text(f.tripName).html();d.events.publish("share",{page:b.vertical,sourceId:"saveditems-sharetrip",searchId:a.searchId,resultId:c,tripShareUrl:g,tripSourceName:"\x3cdiv\x3e"+f+"\x3c/div\x3e",hideSharingForm:!0,sharingDialogTitle:b.sharingDialogTitle})});e("#"+this.id("expiryMessage")).click(function(){d.events.publish("show.login.options.dialog",
{forceLogin:!0,trackingLabel:"urgency-message"})});if(d.config.getBoolean("trips.cleanupAfterSearch",!0)){var c=this;this.subscribe("resultspage.cleanup",function(a){a===c.searchId&&c.clearState()})}},onItemMoved:function(a){this.addItemToMap(a.newTripId,a.newTripName,a.responseData.tripUrl,a.optimisticMove);this.removeItemFromMap(a.oldTripId,a.optimisticMove);this.updateTripsLinkAndHeader(this.listSize)},onItemMoveFailed:function(){this.restoreTripsMap();this.updateTripsLinkAndHeader(this.listSize)},
logBookit:function(){d.Analytics.api.trackEvent({subPageId:"saved",category:"clickthrough"})},logGoToTrip:function(){d.Analytics.api.trackEvent({subPageId:"saved",category:"go-to-trip"})},onFiltersChange:function(){this.setShowHideListState(!1,!1)},hideSavedItemList:function(){this.element.removeClass("visible")},onSearchIdChange:function(a){this.searchId!==a.searchId&&this.clearState()},clearState:function(){this.hideSavedItemList();this.listSize=0;this.tripsMap={}},onSearchPollResponse:function(a,
b){null==b&&(b=!1);var c=a.searchId&&0<a.searchId.length&&!a.streaming&&this.searchId!==a.searchId;b=b&&this.searchId&&0<this.searchId.length;this.setShowHideListState(this.tripsToggleEl.data("toggle"),!0);c&&(this.searchId=a.searchId);c||b?(c={searchId:this.searchId},a.hasOwnProperty("priceType")&&e.extend(c,{priceType:a.priceType}),this.ajaxSavedSearchPoll(c)):(this.options.watchlistMakeoverEnabled||this.updateVisibility(),a=this.getFirstTripId(),this.tripsMap.hasOwnProperty(a)&&d.events.publish("trips.auto.save.data",
{tripId:a,tripName:this.tripsMap[a].tripName}))},ajaxSavedSearchPoll:function(a){if(this.options.extraPollRequest){var b=this;a&&(a={data:a,beforeScript:function(){b.savedItemsListEl.empty();b.destroyOldResults.bind(b)},enforceCaptcha:d.config.getBoolean("ui.ajax.enforceCaptcha.savedSearchPoll",!0),appendTo:this.options.isSaveInPlaceEnabled?e("\x3cdiv\x3e"):b.savedItemsListEl},d.ajax.execute(b.options.searchPollURL,a))}},destroyOldResults:function(){this.savedItemsListEl.find("."+this.resultItemClass).each(function(){d.ComponentManager.remove(e(this).attr("id"))})},
onSavedResultsUpdate:function(a){this.listSize=a.listSize;this.tripsMap=a.tripsMap;a.savedSearchId&&this.searchId!==a.savedSearchId&&(this.searchId=a.savedSearchId);var b=this.getFirstTripId();this.tripsMap.hasOwnProperty(b)&&d.events.publish("trips.auto.save.data",{tripId:b,tripName:this.tripsMap[b].tripName});this.updateTripsLinkAndHeader(this.listSize);d.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.options.stickyEnabled&&d.events.publish("trips.counter.setValue",{id:this.id("TripsCounter"),
value:this.listSize});this.updateVisibility();this._toggleCompareLink();var c=this.options.vertical;Object.keys(a.openDetails||{}).each(function(a){d.events.publish(c+".inline.detail.heightChanged",{resultId:a})});this.setExpiryMessage(a.expiryMessage)},_toggleCompareLink:function(){this.compareLink.toggleClass("visible",1<this.listSize)},updateVisibility:function(){this.element.toggleClass("visible",0<this.listSize);0<this.listSize&&d.events.publish("trips.updateHeader")},setShowHideListState:function(a,
b){b&&this.tripsToggleEl.data("toggle",a);this.savedItemsListContainer.toggleClass("visible",a)},showToast:function(a){a=e.extend({},a);!a.eventId&&a.eventID&&(a.eventId=a.eventID);a=d.template.render("saveToTripToast",a);d.Widgets.Toaster.addToast(a,{button:!1,escaped:!0,theme:"centered"})},onItemSaved:function(a){var b=this,c=e("#"+a.resultItemElId);c.length||(c=e('[data-resultid\x3d"'+a.resultItemId+'"]'));var g=d.question.ask("resultsHeader.sortMode"),f=this.options.watchlistMakeoverEnabled&&
"watchlist"!==g.sortType,h=c.hasClass("OpenFlex"),g=function(){var a=f||h?c.clone(!0,!0):c.detach();a.show();a.find(".removeItemOverlay").remove();f&&a.find(".Common-Trips-ResultItemSaveToTrips").trigger("forceSaved",a);b.savedItemsListEl.append(a);a=b.savedItemsListEl.find("a.save");a.html(a.html());a=b.savedItemsListEl.find("a.share");a.html(a.html())};0!==this.listSize||f||this.element.addClass("visible");this.listSize++;this.options.isSaveInPlaceEnabled?c.find(".removeItemOverlay").remove():f||
(h?(g(),d.events.publish("filters.changed",{})):c.fadeOut({duration:100,complete:g}));this.options.stickyEnabled&&(d.events.publish("trips.counter.notification.show",{id:b.id("TripsCounter")}),d.events.publish("trips.counter.increase",{id:b.id("TripsCounter")}),setTimeout(function(){d.events.publish("trips.counter.notification.clear",{id:b.id("TripsCounter")})},3E3));!b.options.watchlistMakeoverEnabled&&b.options.tripToastEnabled&&this.showToast(a);d.events.publish("savedItemsListUpdated",{listSize:this.listSize});
this.addItemToMap(a.tripId,a.tripName,a.tripUrl);this.updateTripsLinkAndHeader(this.listSize);this._toggleCompareLink();this.setExpiryMessage(a.responseData.expiryMessage)},onItemRemoved:function(a){var b=this.getResultItemElement(a.resultItemId,this.savedItemsListContainer);this.listSize--;0===this.listSize&&this.element.removeClass("visible");d.events.publish("savedItemsListUpdated",{listSize:this.listSize});this.removeItemFromMap(a.tripId);this.updateTripsLinkAndHeader(this.listSize);this.options.isSaveInPlaceEnabled?
(b=this.getResultItemElement(a.resultItemId),b.find(".removeItemOverlay").remove(),d.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,remove:!0})):this.options.optimisticUpdatesEnabled?(b.detach(),e("#searchResultsList").find(".normalResults").prepend(b),b.find(".removeItemOverlay").remove(),d.events.publish("common.results.inline.remove.sync",{resultId:a.resultItemId,remove:!0})):b.remove();this._toggleCompareLink();this.options.stickyEnabled&&d.events.publish("trips.counter.decrease",
{id:this.id("TripsCounter")})},removeItemFromMap:function(a,b){var c=this.tripsMap[a];if(b)this.tripsMap.optimisticRemove=c;else if(this.tripsMap.optimisticRemove){delete this.tripsMap.optimisticRemove;return}c&&(c.savedItemsCounter--,0===c.savedItemsCounter&&delete this.tripsMap[a])},addItemToMap:function(a,b,c,d){b={tripId:a,savedItemsCounter:1,tripName:b,tripUrl:c};a=a||"idStub";c=this.tripsMap[a];if(d)this.tripsMap.optimisticSave=b;else if(this.tripsMap.optimisticSave){this.tripsMap.idStub&&(this.tripsMap[a]=
b,delete this.tripsMap.idStub);delete this.tripsMap.optimisticSave;return}c?c.savedItemsCounter++:this.tripsMap[a]=b},restoreTripsMap:function(){var a=this.tripsMap.optimisticSave,b=this.tripsMap.optimisticRemove,c=this.tripsMap[b.tripId];c?c.savedItemsCounter++:this.tripsMap[b.tripId]=b;delete this.tripsMap.optimisticRemove;if(c=this.tripsMap[a.tripId])c.savedItemsCounter--,0===c.savedItemsCounter&&delete this.tripsMap[a.tripId];delete this.tripsMap.optimisticSave},getTripsIds:function(){var a=/^(optimisticRemove|optimisticSave)$/;
return Object.keys(this.tripsMap).filter(function(b){return-1===b.search(a)})},getTripsCount:function(){return this.getTripsIds().length},getFirstTrip:function(){return this.tripsMap[this.getTripsIds()[0]]},getFirstTripId:function(){return this.getTripsIds()[0]||null},updateTripsLinkAndHeader:function(a){var b=this.getTripsIds(),c=b.length;if(c){var e="\x3cstrong\x3e%s\x3c/strong\x3e".format(a),f=this.options.tripsURL;1===c?(b=this.tripsMap[b[0]],c=d.utils.escapeHTML(b.tripName),this.goToTripEl.html(this.options.msg.viewTrip),
this.goToTripEl.attr("href",b.tripUrl),this.headerTitleEl.html(d.Common.Utils.String.formatChoice(this.options.msg.savedToTripItems,a,e,c,b.tripUrl))):(this.goToTripEl.html(this.options.msg.viewTrips),this.goToTripEl.attr("href",f),this.headerTitleEl.html(d.Common.Utils.String.formatChoice(this.options.msg.savedToTripsItems,a,e,c,f)));this.setTripShareUrl(this.getFirstTrip().tripUrl);this.headerTitleEl.find("a").attr("target","_blank");this.goToTripEl.attr("target","_blank")}},setTripShareUrl:function(a){this.options.showShareTripIcon&&
this.shareToTripsEl.attr("href",a)},clearSticky:function(){this.savedItemsHeaderPlaceholder.hide();this.savedItemsHeader.removeClass("sticky layer-sticky")},setSticky:function(){this.savedItemsHeaderPlaceholder.show();this.savedItemsHeader.addClass("sticky layer-sticky");this.savedItemsHeader.css("width",this.element.width())},createStickyHeader:function(a){var b=this;"function"!==typeof a&&(a=e.noop);var c=null;e(document).off("scroll.sticky").on("scroll.sticky",function(){b.savedItemsHeader.is(":visible")&&
null===c&&(c=b.savedItemsHeader.offset().top,b.savedItemsHeaderPlaceholder.height(b.savedItemsHeader.outerHeight()));null!==c&&(e(window).scrollTop()<c?b.clearSticky():b.setSticky())});setTimeout(function(){a()},500)},isSavedItemsOnScreen:function(){return e(window).scrollTop()<this.savedItemsHeader.offset().top+this.savedItemsHeader.outerHeight()},getResultItemElement:function(a,b){a="div[data-resultid\x3d'"+a+"']";return b?b.find(a):e(a)},setExpiryMessage:function(a){this.expiryMessageEl&&(1<this.getTripsCount()?
this.expiryMessageEl.hide():a&&(this.expiryMessageEl.text(d.utils.escapeHTML(a)),this.expiryMessageEl.show()))},avoidElementClick:function(a){return e(a.target).closest(this.clickElementsToAvoid).length}})})(R9,jQuery);(function(a,c){a.createComponentClass("common.results.BookingLinksExpiredDialog",{expiredResultsDialog:null,options:{redirectUrl:""},addEventHandlers:function(){a.events.subscribe("search.expired",this.showBookingLinksExpiredDialog.bind(this))},showBookingLinksExpiredDialog:function(){var b=this;if(null===this.expiredResultsDialog){this.expiredResultsDialog=this.element.dialog({onClose:function(){a.events.publish("resultspage.transition.remove")}}).getWidget();var d=this.options.redirectUrl?this.options.redirectUrl:
"/";this.getChildElement("home-btn").click(function(){a.Analytics.api.trackEvent("booklinkexpired/homepage");window.location=d});this.getChildElement("refresh-btn").click(function(){c(document.body).css("cursor","wait");a.Analytics.api.trackEvent("booklinkexpired/refresh");a.config.getInt("ui.rp.limitExpiredReload",!0)?(a.events.publish("user.refresh.expired"),b.expiredResultsDialog&&b.expiredResultsDialog.close()):window.location.reload()})}this.expiredResultsDialog.open()}})})(R9,jQuery);(function(b){window.showUsSanctionedCountriesPopup=function(){window.open("http://www.treasury.gov/resource-center/sanctions/Programs/Pages/Programs.aspx","_blank")};b.createComponentClass("common.results.SearchFailed",{defaultErrorMessage:null,hasUniqueNoResultsMessage:!1,failureTypes:{BAD_QUERY:"query",NO_RESULTS:"noresults",SERVER_ISSUE:"server",TIMEOUT:"timeout"},init:function(){var a=this;this.defaultErrorMessage=this.getChildElement("reason").html();b.events.when(["common.results.NoResults.ready",
"rentals.results.RentalNoResults.ready"],function(){a.hasUniqueNoResultsMessage=!0})},addEventHandlers:function(){var a=this;b.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this));b.events.subscribe("search.startSearch",this.hideSearchFailedView.bind(this));b.events.subscribe("resultspage.requestResults",this.hideSearchFailedView.bind(this));b.question.answer("SearchFailed.isNoResultsStatus",function(b){return a.failureTypes.NO_RESULTS===b})},handleSearchFailure:function(a){this.hasUniqueNoResultsMessage&&
a&&a.type===this.failureTypes.NO_RESULTS?this.hideSearchFailedView():this.showSearchFailedView(a&&a.userDisplayMessage?a.userDisplayMessage:this.defaultErrorMessage)},showSearchFailedView:function(a){this.getChildElement("reason").html(a);this.element.show()},hideSearchFailedView:function(){this.element.hide()}})})(R9);(function(a){a.createComponentClass("common.results.NoResults","common.results.SearchFailed",{options:{vertical:null},addEventHandlers:function(){this.base();var b=this;a.events.ready("common.results.NoResults.ready",this.element);this.getChildElement("newSearchLink").click(function(c){c.preventDefault();a.events.publish(b.options.vertical+".inline.search.form.show",{focus:!0});return!1});a.events.subscribe("search.searchFailed",this.handleSearchFailure.bind(this))},handleSearchFailure:function(a){a&&
a.type===this.failureTypes.NO_RESULTS&&this.showSearchFailedView()}})})(R9);(function(d,c){d.createComponentClass("common.results.Paginator",{trackCategory:"Pagination",activeIndex:0,pageCount:0,pageNumberTemplateId:"paginatorItem",numbered:!0,loader:null,loading:!1,activeSearch:!1,options:{button:!1,buttonInfinite:!0,infinite:!1,silent:!1,maxPages:5,infiniteScrollingOffset:0,logUserInteraction:!1,disableDuringPolling:!1},init:function(){this.numbered=!this.options.button&&!this.options.infinite;this.numbered||(this.loader=this.getChildElement("loader"))},addEventHandlers:function(){var a=
this;this.subscribe("resultspage.searchId.changed",function(){a.activeSearch=!0});this.subscribe("resultspage.pageNumber.changed",function(b){a.setIndex(b);a.updateDOM()});this.subscribe("paginator.update",function(b){a.setIndex(b.pageNumber);a.updateBounds(b.pageCount);if(a.options.infinite)if(b.pageNumber===b.pageCount)c(window).off("scroll.pagination");else if(1===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));if(a.options.button){if(b.pageNumber>=b.pageCount||1===b.pageNumber||
!a.options.buttonInfinite)c(window).off("scroll.pagination");else if(2===b.pageNumber)c(window).on("scroll.pagination",a.scrollPagination.bind(a));b.pageNumber>=b.pageCount||0===b.pageCount?a.element.removeClass("visible"):a.element.addClass("visible")}a.updateDOM();a.getChildElement("loadMore").blur()});this.subscribe("paginator.hide",function(){a.element.removeClass("visible")});this.numbered?(this.element.find("a.page-Previous").click(function(b){1>=a.activeIndex?b.preventDefault():(a.options.logUserInteraction&&
a.logUserInteraction("Prev"),a.userChangedIndex(--a.activeIndex))}),this.element.find("a.page-Next").click(function(b){a.activeIndex>=a.pageCount?b.preventDefault():(a.options.logUserInteraction&&a.logUserInteraction("Next"),a.userChangedIndex(++a.activeIndex))})):this.subscribe("search.poll.response",function(){a.element.removeClass("loading");a.loading=!1});this.options.button&&(this.getChildElement("loadMore").click(function(){a.element.addClass("loading");a.logUserInteraction("More");a.userChangedIndex(++a.activeIndex)}),
this.getChildElement("loadMore").keypress(function(b){switch(b.which){case d.globals.keyCodes.RETURN:case d.globals.keyCodes.SPACE:a.getChildElement("loadMore").click()}}),this.subscribe("paginator.text.set",function(b){a.getChildElement("loadMore").text(b)}));if(this.options.infinite)c(window).on("scroll.pagination",a.scrollPagination.bind(a));this.options.disableDuringPolling&&(this.subscribe("resultspage.streaming.start",this.disablePaginator.bind(this,!0)),this.subscribe("resultspage.streaming.done",
this.disablePaginator.bind(this,!1)))},logUserInteraction:function(a,b){d.Analytics.api.trackEvent({category:this.trackCategory,action:a,label:b})},scrollPagination:function(){!this.loading&&this.activeSearch&&this.element.offset().top<c(window).scrollTop()+(c(window).height()+this.options.infiniteScrollingOffset)&&(this.element.addClass("loading"),this.loading=!0,this.userChangedIndex(++this.activeIndex))},disablePaginator:function(a){this.element.toggleClass("disabled",a)},userChangedIndex:function(a){this.setIndex(a);
d.events.publish("paginator.change",{pageNumber:a,append:this.options.button||this.options.infinite})},setIndex:function(a){this.activeIndex=a},getIndex:function(){return this.activeIndex},updateBounds:function(a){this.pageCount!==a&&(this.pageCount=a)},updateDOM:function(){var a=this;this.numbered&&!this.options.silent&&c("[page-idx]").each(function(){parseInt(c(this).attr("page-idx"))===a.activeIndex?c(this).removeClass("Paginator-Item-Hidden"):c(this).addClass("Paginator-Item-Hidden")});this.options.infinite||
this.options.button||(1<this.pageCount?(this.element.addClass("visible"),this.numbered&&(this.renderDisplayRange(),this.element.find("a.page-Next, a.page-Previous").removeClass("disabled"),this.activeIndex===this.pageCount?this.element.find("a.page-Next").addClass("disabled"):1===this.activeIndex&&this.element.find("a.page-Previous").addClass("disabled"))):this.element.removeClass("visible"))},renderPageLink:function(a){return d.template.render(this.pageNumberTemplateId,{index:a,cssClass:a===this.activeIndex?
"active":""})},renderEllipsis:function(){return"\x3cspan\x3e\x26nbsp;\x26hellip;\x26nbsp;\x3c/span\x3e"},renderDisplayRange:function(){var a=this,b=this.element.find("div.page-Numbers");b.html("");var d=this.renderPageLink(1),e=0<this.activeIndex-1?this.activeIndex-1:1,f=e+this.options.maxPages-1;f>=this.pageCount&&(f=this.pageCount,e=f-this.options.maxPages+1);for(2<e?d+=this.renderEllipsis():2>e?e=2:--f;e<f;e++)d+=this.renderPageLink(e);f<this.pageCount&&(d+=this.renderEllipsis());d+=this.renderPageLink(this.pageCount);
b.html(d).find("a").click(function(){c(this).parent().hasClass("active")||(a.options.logUserInteraction&&a.logUserInteraction("Page",c(this).data("idx")),a.userChangedIndex(c(this).data("idx")),c(this).parent().addClass("active"))})}})})(R9,jQuery);(function(c,d){c.createComponentClass("hotels.results.HotelResultsFooterDisclaimers",{estimatedDisclaimer:null,taxesEstimated:null,priceType:null,options:{searchId:null,msg:{priceTypeStrings:{daybase:null,daytaxes:null,totaltaxes:null}}},init:function(){this.estimatedDisclaimer=this.getChildElement("estimated-disclaimer");this.priceTypeDisclaimer=this.getChildElement("price-type-disclaimer")},addEventHandlers:function(){var b=this;this.element.find(".pricesNotGuaranteed").on("click",function(){b.element.find(".fullPriceGuaranteeDisclaimer").toggle()});
this.searchIdChangedCallback=c.events.subscribe("resultspage.searchId.changed",function(a){});c.events.subscribe("resultsHeader.changed",function(a){a&&a.hasOwnProperty("priceType")&&(b.priceType=a.priceType,b.updateEstimatedDisclaimer())});c.events.subscribe("resultspage.taxesEstimated.changed",function(a){a&&a.hasOwnProperty("taxesEstimated")&&!b.taxesEstimated&&(b.taxesEstimated=a.taxesEstimated,b.updateEstimatedDisclaimer())});c.events.subscribe("resultspage.priceType.changed",function(a){a&&
a.hasOwnProperty("priceType")&&(b.priceType=a.priceType,b.updatePriceTypeDisclaimer())})},updateEstimatedDisclaimer:function(){this.taxesEstimated||"daytaxes"===this.priceType||"totaltaxes"===this.priceType?this.estimatedDisclaimer.removeClass("hidden"):this.estimatedDisclaimer.addClass("hidden")},updatePriceTypeDisclaimer:function(){this.priceTypeDisclaimer.text(this.options.msg.priceTypeStrings[this.priceType])}})})(R9,jQuery);(function(c,f){c.createComponentClass("common.results.AfterclickContainer",{options:{searchId:"",url:"",rateLimitCount:-1,rateLimitPeriod:864E5,rateLimitStorageKey:"hotel_afterclick_last",inMemory:!1,ignore:!1,rateLimited:!0},memory:[],dialogContent:null,dialog:null,init:function(){var a=this.options;this.dialogContent=this.getChildElement("content");a.rateLimitStorageKey||(a.rateLimitStorageKey="hotel_afterclick_last")},addEventHandlers:function(){var a=this,b=a.options;a.subscribe("multibook.providerClicked",
function(d){d&&d.afterclickIgnore||b.ignore||a.openAfterclick(d.resultId)});a.subscribe("resultspage.searchId.changed",function(d){var c=b.searchId;d&&c!==d.searchId&&(b.searchId=d.searchId,a.update())})},update:function(){var a=this;c.ajax.execute("common/results/AfterclickContainer",{data:a.options,replace:!0,customUpdate:function(b){a.destroy();a.element.replaceWith(b.innerHTML);return!0}})},rateLimit:function(){var a=this.options,b=a.rateLimitStorageKey;return"prevent"===c.storage.get("prevent-afterclick")?
(c.storage.remove("prevent-afterclick"),!0):a.rateLimited?a.inMemory?(b=this.getTimeList(this.memory))?(this.memory=b,!1):!0:c.storage.isAvailable()&&b?(a=this.getTimeList(c.storage.get(b)))?(c.storage.set(b,a),!1):!0:!1:!1},getTimeList:function(a){var b=new Date,d=this.options,c=isNaN(d.rateLimitCount)?2:d.rateLimitCount,d=isNaN(d.rateLimitPeriod)?864E5:d.rateLimitPeriod;if(0===c)return null;"string"===typeof a&&(a=[]);if(!a||a.length<c)return a?a.concat(b.getTime()):[b.getTime()];for(var e=0;e<
c;e++){if(isNaN(a[e]))return[b.getTime()];if(b.getTime()-(new Date(a[e])).getTime()>d)return a[e]=b.getTime(),a}return null},openAfterclick:function(a){var b=this;b.dialog&&b.dialog.isOpen()||!b.options.url||!b.options.searchId||b.rateLimit()||(b.dialog&&b.dialog.setContentDimensions("auto","auto"),a={resultId:a,searchId:b.options.searchId},c.Analytics.api.trackEvent({category:"AfterClick",action:"request"}),c.ajax.execute(b.options.url,{data:a,appendTo:this.dialogContent,replace:!0}).then(function(){b.dialog=
b.getChildElement("afterclickdialog").dialog({extraCssClass:"afterclickModal"}).getWidget();var a=b.getChildElement("content").children().eq(0);if(f("#acerror").length){try{c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:f("#acerror").get(0).innerText.trim()})}catch(g){}console.log(f("#acerror").get(0).innerText)}else c.Analytics.api.trackEvent({category:"AfterClick",action:"displayed"}),b.options.responsive?(b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight(),"95%"),
b.dialog.setViewPortOverflow("hidden")):b.dialog.setContentDimensions(a.outerWidth(),a.outerHeight()),b.dialog.setOption("onClose",function(){c.Analytics.api.trackEvent({category:"AfterClick",action:"closed"})}),b.dialog.open(),c.events.publish("afterclick.dialog.opened")}).fail(function(){c.Analytics.api.trackEvent({category:"AfterClick",action:"failed",label:"ajax"})}))}})})(window.R9,window.jQuery||window.jq);(function(g,c){g.createWidgetClass("text.EmailInput",{options:{maxEmails:-1,placeholder:"",readonly:!1},inputElem:null,init:function(){this.inputElem=this.getChildElement("inputEl");var a=this;setTimeout(function(){a.processValue(a.inputElem.val())},1)},addEventHandlers:function(){var a=this;this.addInputEventHandlers();this.element.on("click",".email",function(){c(this).remove();a.checkRestrictions();a.updateValue()})},addInputEventHandlers:function(){var a=this,d=!0;a.inputElem.on("keyup",function(b){switch(b.which){case 32:a.handleSpaceKey();
break;case 8:b=a.inputElem.val();var e=b.split(" "),e=a.addEmail(e);c.trim(b)!==c.trim(e)&&a.inputElem.val(e);d=!0;break;default:a.checkComma()}}).on("keydown",function(b){switch(b.which){case 13:case 9:a.handleReturnKey(b);break;case 8:0===a.getCaretPosition()&&d&&(a.element.find(".email").last().remove(),a.checkRestrictions(),a.updateValue()),d=!1}}).on("focus",function(){a.element.addClass("focused")}).on("blur",function(b){a.handledReturnID||a.handleReturnKey(b);a.element.removeClass("focused")})},
checkComma:function(){var a=c.trim(this.inputElem.val());","===a[a.length-1]&&(a=this.addEmail([a.substring(0,a.length-1)]),""===c.trim(a)&&this.inputElem.val(""))},handleSpaceKey:function(){""===this.addEmail([this.inputElem[0].value])&&(this.inputElem[0].value="")},handleReturnKey:function(a){var d=this;d.handledReturnID&&clearTimeout(d.handledReturnID);this.handledReturnID=setTimeout(function(){d.handledReturnID=null},100);var b=this.inputElem[0].value,e=b.split(" ");this.addEmail(e,!0);this.inputElem[0].value=
"";if(13===a.which||""!==c.trim(b))a.stopPropagation(),a.preventDefault()},getCaretPosition:function(){var a=0,d=this.inputElem[0];if(document.selection)d.focus(),a=document.selection.createRange(),a.moveStart("character",-d.value.length),a=a.text.length;else if(d.selectionStart||"0"==d.selectionStart)a=d.selectionStart;return a},val:function(a){if("undefined"!==typeof a)this.processValue(a);else return this.getValue()},processValue:function(a){this.element.find(".email").remove();this.inputElem[0].value=
a?this.addEmail(a.split(",")):"";this.updateValue()},isValidEmail:function(a){a=c.trim(a);return"function"===typeof window.validateEmail?validateEmail(a):/^[a-zA-Z0-9.!#$%&\u2019*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(a)},prepareEmailElem:function(a){a=c.trim(a);if(!a)return!1;var d=c("\x3cdiv class\x3d'email'\x3e\x3c/div\x3e");c(document.createTextNode(a)).appendTo(d);return d},addEmail:function(a,d){var b=this,e="";c.each(a,function(c,f){if(0<b.options.maxEmails&&c>=b.options.maxEmails)return!1;
if(b.isValidEmail(f)){if(c=b.prepareEmailElem(f))c.insertBefore(b.inputElem),b.checkRestrictions(),b.updateValue()}else{a.splice(0,c);c=a.join(" ");if(d){if(c=b.prepareEmailElem(c))c.insertBefore(b.inputElem),b.checkRestrictions(),b.updateValue()}else e=c;return!1}});return e},updateValue:function(){var a=this.element.find(".email").map(function(){return c(this).text()}).get().join();this.element.val(a);this.getChildElement("hidnEl").val(a)},getValue:function(){var a=this.element.val(),d=c.trim(this.inputElem.val());
""!==d&&(a+=","+d);return a},checkRestrictions:function(){var a=this.element.find(".email").length;0<this.options.maxEmails&&(a>=this.options.maxEmails?(this.element.addClass("disabled"),this.inputElem.prop("disabled",!0)):(this.element.removeClass("disabled"),this.inputElem.prop("disabled",!1)));a?(this.inputElem.prop("placeholder",""),this.options.readonly&&this.inputElem.prop("readonly","readonly")):(this.inputElem.prop("placeholder",this.options.placeholder),this.options.readonly&&this.inputElem.prop("readonly",
""))}})})(window.R9,window.jq||window.jQuery);/*
 clipboard.js v1.7.1
 https://zenorocha.github.io/clipboard.js

 Licensed MIT  Zeno Rocha
*/
(function(m){"object"==typeof exports&&"undefined"!=typeof module?module.exports=m():"function"==typeof define&&define.amd?define([],m):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=m()})(function(){return function f(h,k,a){function b(d,g){if(!k[d]){if(!h[d]){var c="function"==typeof require&&require;if(!g&&c)return c(d,!0);if(e)return e(d,!0);g=Error("Cannot find module '"+d+"'");throw g.code="MODULE_NOT_FOUND",g;}g=k[d]={exports:{}};
h[d][0].call(g.exports,function(a){return b(h[d][1][a]||a)},g,g.exports,f,h,k,a)}return k[d].exports}for(var e="function"==typeof require&&require,l=0;l<a.length;l++)b(a[l]);return b}({1:[function(f,h,k){"undefined"==typeof Element||Element.prototype.matches||(f=Element.prototype,f.matches=f.matchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector||f.webkitMatchesSelector);h.exports=function(a,b){for(;a&&9!==a.nodeType;){if("function"==typeof a.matches&&a.matches(b))return a;
a=a.parentNode}}},{}],2:[function(f,h,k){function a(a,l,d,g){return function(c){c.delegateTarget=b(c.target,l);c.delegateTarget&&g.call(a,c)}}var b=f("./closest");h.exports=function(b,l,d,g,c){var e=a.apply(this,arguments);return b.addEventListener(d,e,c),{destroy:function(){b.removeEventListener(d,e,c)}}}},{"./closest":1}],3:[function(f,h,k){k.node=function(a){return void 0!==a&&a instanceof HTMLElement&&1===a.nodeType};k.nodeList=function(a){var b=Object.prototype.toString.call(a);return void 0!==
a&&("[object NodeList]"===b||"[object HTMLCollection]"===b)&&"length"in a&&(0===a.length||k.node(a[0]))};k.string=function(a){return"string"==typeof a||a instanceof String};k.fn=function(a){return"[object Function]"===Object.prototype.toString.call(a)}},{}],4:[function(f,h,k){function a(a,b,c){return a.addEventListener(b,c),{destroy:function(){a.removeEventListener(b,c)}}}function b(a,b,c){return Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)}),{destroy:function(){Array.prototype.forEach.call(a,
function(a){a.removeEventListener(b,c)})}}}var e=f("./is"),l=f("delegate");h.exports=function(d,g,c){if(!d&&!g&&!c)throw Error("Missing required arguments");if(!e.string(g))throw new TypeError("Second argument must be a String");if(!e.fn(c))throw new TypeError("Third argument must be a Function");if(e.node(d))return a(d,g,c);if(e.nodeList(d))return b(d,g,c);if(e.string(d))return l(document.body,d,g,c);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");
}},{"./is":3,delegate:2}],5:[function(f,h,k){h.exports=function(a){if("SELECT"===a.nodeName)a.focus(),a=a.value;else if("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName){var b=a.hasAttribute("readonly");b||a.setAttribute("readonly","");a.select();a.setSelectionRange(0,a.value.length);b||a.removeAttribute("readonly");a=a.value}else{a.hasAttribute("contenteditable")&&a.focus();var b=window.getSelection(),e=document.createRange();e.selectNodeContents(a);b.removeAllRanges();b.addRange(e);a=b.toString()}return a}},
{}],6:[function(f,h,k){function a(){}a.prototype={on:function(a,e,l){var b=this.e||(this.e={});return(b[a]||(b[a]=[])).push({fn:e,ctx:l}),this},once:function(a,e,l){function b(){g.off(a,b);e.apply(l,arguments)}var g=this;return b._=e,this.on(a,b,l)},emit:function(a){for(var b=[].slice.call(arguments,1),l=((this.e||(this.e={}))[a]||[]).slice(),d=0,g=l.length;d<g;d++)l[d].fn.apply(l[d].ctx,b);return this},off:function(a,e){var b=this.e||(this.e={}),d=b[a],g=[];if(d&&e)for(var c=0,f=d.length;c<f;c++)d[c].fn!==
e&&d[c].fn._!==e&&g.push(d[c]);return g.length?b[a]=g:delete b[a],this}};h.exports=a},{}],7:[function(f,h,k){(function(a,b){if(void 0!==k)b(h,f("select"));else{var e={exports:{}};b(e,a.select);a.clipboardAction=e.exports}})(this,function(a,b){var e=b&&b.__esModule?b:{default:b},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},d=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(c,b,d){return b&&a(c.prototype,b),d&&a(c,d),c}}();b=function(){function a(c){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.resolveOptions(c);this.initSelection()}return d(a,[{key:"resolveOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action=a.action;
this.container=a.container;this.emitter=a.emitter;this.target=a.target;this.text=a.text;this.trigger=a.trigger;this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var a=this,b="rtl"==document.documentElement.getAttribute("dir");this.removeFake();this.fakeHandlerCallback=function(){return a.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0;this.fakeElem=
document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[b?"right":"left"]="-9999px";this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;this.container.appendChild(this.fakeElem);this.selectedText=(0,e.default)(this.fakeElem);this.copyText()}},
{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null);this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,e.default)(this.target);this.copyText()}},{key:"copyText",value:function(){var a=void 0;try{a=document.execCommand(this.action)}catch(p){a=!1}this.handleResult(a)}},{key:"handleResult",value:function(a){this.emitter.emit(a?
"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus();window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){if(this._action=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"copy","copy"!==this._action&&"cut"!==this._action)throw Error('Invalid "action" value, use either "copy" or "cut"');
},get:function(){return this._action}},{key:"target",set:function(a){if(void 0!==a){if(!a||"object"!==(void 0===a?"undefined":f(a))||1!==a.nodeType)throw Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&a.hasAttribute("disabled"))throw Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(a.hasAttribute("readonly")||a.hasAttribute("disabled")))throw Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');
this._target=a}},get:function(){return this._target}}]),a}();a.exports=b})},{select:5}],8:[function(f,h,k){(function(a,b){if(void 0!==k)b(h,f("./clipboard-action"),f("tiny-emitter"),f("good-listener"));else{var e={exports:{}};b(e,a.clipboardAction,a.tinyEmitter,a.goodListener);a.clipboard=e.exports}})(this,function(a,b,e,f){function d(a){return a&&a.__esModule?a:{default:a}}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function c(a,b){a="data-clipboard-"+a;if(b.hasAttribute(a))return b.getAttribute(a)}var h=d(b);b=d(e);var k=d(f),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},
n=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){return d&&a(b.prototype,d),c&&a(b,c),b}}();f=function(a){function b(a,d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var c;c=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
c=!c||"object"!=typeof c&&"function"!=typeof c?this:c;return c.resolveOptions(d),c.listenClick(a),c}return g(b,a),n(b,[{key:"resolveOptions",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof a.action?a.action:this.defaultAction;this.target="function"==typeof a.target?a.target:this.defaultTarget;this.text="function"==typeof a.text?a.text:this.defaultText;this.container="object"===l(a.container)?a.container:document.body}},{key:"listenClick",
value:function(a){var b=this;this.listener=(0,k.default)(a,"click",function(a){return b.onClick(a)})}},{key:"onClick",value:function(a){a=a.delegateTarget||a.currentTarget;this.clipboardAction&&(this.clipboardAction=null);this.clipboardAction=new h.default({action:this.action(a),target:this.target(a),text:this.text(a),container:this.container,trigger:a,emitter:this})}},{key:"defaultAction",value:function(a){return c("action",a)}},{key:"defaultTarget",value:function(a){if(a=c("target",a))return document.querySelector(a)}},
{key:"defaultText",value:function(a){return c("text",a)}},{key:"destroy",value:function(){this.listener.destroy();this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:["copy","cut"],b=!!document.queryCommandSupported;return("string"==typeof a?[a]:a).forEach(function(a){b=b&&!!document.queryCommandSupported(a)}),b}}]),b}(b.default);a.exports=f})},{"./clipboard-action":7,
"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});(function(d,e){var f={hotels:"hotels/results/HotelShare",cruises:"cruises/results/CruiseShare",cars:"cars/results/CarShare",packages:"packages/results/PackageShare",rentals:"rentals/results/RentalShare",flights:"flights/results/FlightShare",trains:"trains/results/TrainShare"};d.createComponentClass("common.results.Sharing",{dialog:null,urlInput:null,clipper:null,copyTooltip:null,emailFrom:null,emailTo:null,emailMessage:null,message:null,form:null,send:null,hid:null,rating:null,photoColumn:null,cityName:"",
cityImageUrl:"",trackingEnabled:!1,options:{vertical:"hotels",sourceId:void 0,messages:{},photoColumn:!1,hasRating:!1,useStars:!0,smartEmail:!1,trackingEnabled:!1},init:function(){this.form=this.getChildElement("form");this.urlInput=this.getChildElement("url");this.urlInput.attr("data-clipboard-target","#"+this.id("url"));"undefined"!==typeof window.Clipboard?this.clipper=new Clipboard(".clipboardTrigger"):(this.element.find(".col-copy").hide(),this.element.find(".col-url").removeClass("col-url").addClass("col"));
this.copyTooltip=this.getChildElement("tooltip");this.emailFrom=this.getChildElement("emailFrom");this.emailTo=this.getChildElement("emailTo");this.emailMessage=this.getChildElement("emailMessage");this.hid=this.getChildElement("sharing_email_resultid");this.send=this.getChildElement("send");this.message=this.getChildElement("message");this.options.photoColumn&&(this.options.hasRating&&(this.rating=this.getChildElement("rating").children()),this.photoColumn=this.getChildElement("photoColumn"));this.trackingEnabled=
this.options.trackingEnabled&&!!d.Vestigo},addEventHandlers:function(){var a=this;if(null!==this.clipper)this.clipper.on("success",function(b){d.Analytics.api.trackEvent({category:"Share",action:"copy-link"});a.copyTooltip.addClass("show");setTimeout(function(){a.copyTooltip.removeClass("show")},2E3)});d.events.subscribe("share",function(b){if(b&&("flighttracker"===b.page||"explore"===b.page))return b.sourceId&&b.sourceId!==a.options.sourceId||(a.createDialog(),a.dialog.open(),setTimeout(function(){a.urlInput.val(b.url);
a.urlInput.focus()},100)),!1;var c=f[a.options.vertical];c?a.openForm(b,c):console.warn("No share component found for current vertical: "+a.options.vertical)});this.form.on("submit",function(b){a.options.smartEmail?(a.emailTo.getWidget().val(a.emailTo.val().replace(" ","")),a.emailFrom.getWidget().val(a.emailFrom.val().replace(" ",""))):(a.emailTo.val(a.emailTo.val().replace(" ","")),a.emailFrom.val(a.emailFrom.val().replace(" ","")));b=validateEmail(a.emailFrom.val());var c=a.validateToField();a.emailTo.toggleClass("form-error",
!c);a.emailFrom.toggleClass("form-error",!b);c&&b?(a.send.attr("disabled","disabled"),a.showMessage("SHARING_PROGRESS"),e.ajax({type:"POST",url:d.globals.remoteHost+"/s/emailresult",data:a.form.serialize(),headers:{"X-CSRF":d.globals.formtoken},success:function(){var b=a.getChildElement("sharing_email_resultid").val();d.events.publish("share.success",b);a.send.removeAttr("disabled");a.dialog&&a.showSuccess("SHARING_SUCCESS");d.Analytics.api.trackEvent({category:"Share",action:"share-result"});a.trackShare(b)},
error:function(){a.showError("SHARING_ERROR");a.send.removeAttr("disabled")}})):(a.showError("EMAIL_ERROR"),a.options.smartEmail&&(a.emailTo.getWidget().checkRestrictions(),a.emailFrom.getWidget().checkRestrictions()));return!1})},createDialog:function(){var a=this;this.dialog=this.dialog||this.getChildElement("dialog").dialog({isOpenTopZindex:!0,onClose:function(){a.emailTo.removeClass("form-error");a.emailFrom.removeClass("form-error");a.clearMessage();d.Analytics.api.trackEvent({category:"Share",
action:"close-share"});a.options.photoColumn&&a.clearSharingData()}}).getWidget()},openForm:function(a,b){var c=this;this.options.hasRating=null;d.action.execute(b,{searchId:a.searchId,resultId:a.resultId,useCityNames:!!a.useCityNames,filterState:d.question.ask("resultspage.urlFilterState.get")},function(b){var d=a.tripShareUrl?a.tripShareUrl:b.url;a.sharingDialogTitle&&""!==a.sharingDialogTitle&&c.getChildElement("title").html(a.sharingDialogTitle);c.urlInput.val(d);c.createDialog();c.dialog.open();
c.urlInput.focus();c.getChildElement("sharing_email_fs").val(b.fs);c.getChildElement("sharing_email_subject").val(b.emailSubject);c.getChildElement("sharing_email_searchid").val(a.searchId);c.getChildElement("sharing_email_resultid").val(a.resultId);c.options.photoColumn&&c.addSharingData(e.extend({},a,b));a.hideSharingForm&&(c.element.addClass("no-sharing-form"),c.getChildElement("sharingForm").hide())})},addSharingData:function(a){a.hasOwnProperty("tripSourceName")?this.getChildElement("sourceName").html(a.tripSourceName):
a.hasOwnProperty("sourceName")&&this.getChildElement("sourceName").html(a.sourceName);a.hasOwnProperty("hotelName")&&this.getChildElement("sourceName").html(a.hotelName);a.hasOwnProperty("sourceImageUrl")?(this.photoColumn.removeClass("hidden").css({"background-image":"none"}),this.photoColumn.animate({opacity:0},0).css({"background-image":'url("'+a.sourceImageUrl+'")'}).animate({opacity:1},1E3)):d.Common.Utils.String.isEmpty(this.cityImageUrl)&&this.photoColumn.addClass("hidden");this.rating&&(a.hasOwnProperty("rating")?
(this.rating.removeClass(function(a,c){return(c.match(/(^|\s)count-\S+/g)||[]).join(" ")}),this.rating.addClass("count-"+a.rating),this.rating.attr("data-count",a.rating),!a.useStars&&this.options.useStars&&this.rating.removeClass("starIcon").addClass("circleIcon"),a.useStars||this.options.useStars?this.rating.find(".star").removeClass("circle"):this.rating.find(".star").addClass("circle")):this.rating.attr("aria-hidden","true"))},validateToField:function(){var a=this.emailTo.val().split(","),b=!0;
e.each(a,function(a,d){validateEmail(d.replace(" ",""))||(b=!1)});return b},showMessage:function(a){this.message.removeClass("success error").html(this.options.messages[a]);this.dataTestTagToggleSuccessStatus(!1)},showError:function(a){this.message.removeClass("success").addClass("error").html(this.options.messages[a]);this.dataTestTagToggleSuccessStatus(!1)},showSuccess:function(a){this.message.removeClass("error").addClass("success").html(this.options.messages[a]);this.dataTestTagToggleSuccessStatus(!0)},
dataTestTagToggleSuccessStatus:function(a){var b=this.dataTestTag("share-result-success");b&&""!==b&&(a?this.message.attr(b,""):this.message.removeAttr(b))},clearMessage:function(){this.message.html("")},clearSharingData:function(){this.photoColumn.hasClass("hidden")&&this.photoColumn.removeClass("hidden");this.options.hasRating&&null!==this.rating&&this.rating.hasClass("circleIcon")&&this.rating.removeClass("circleIcon").addClass("starIcon")},trackShare:function(a){this.trackingEnabled&&a&&d.VestigoEvents.share.log(a,
d.question.ask("results.HorizonResult.index.of."+a))}})})(window.R9,window.jq||window.jQuery);(function(c,e){c.createComponentClass("common.compareto.v3.RightRailCompareTo",{options:{pageOrigin:null,searchId:null,noUpdateFlash:!1,compareToItems:[],placement:{},type:"",vertical:"",logImpressionsAndClicks:!1},path:"common/compareto/v3/RightRailCompareTo",init:function(){this.button=this.getChildElement("all");this.logImpressions()},addEventHandlers:function(){var b=this,a=b.options;b.subscribe("resultspage.searchId.changed",function(f){var c=a.searchId;f&&c!==f.searchId&&(b.destroy(),a.searchId=
f.searchId,a.noUpdateFlash||b.element.html(""),b.update())});var d={type:a.type,placement:a.placement,searchId:a.searchId};b.button.on("click",function(){window["@r9/cmp2-ui"].onDirectClick(a.compareToItems,d);b.options.logImpressionsAndClicks&&c.Analytics.api.trackEvent({category:"rr",action:"right",label:"compareAll",value:"click"})});b.button.on("mouseup",function(){window["@r9/cmp2-ui"].onDirectMouseUp(a.compareToItems,d)});b.button.on("mousedown",function(){window["@r9/cmp2-ui"].onDirectMouseDown(a.compareToItems,
d)});e(".provider-item-row",b.element).on("click",function(a){a=e(a.currentTarget);c.events.publish("ecommerce.track",{event:"cmp2.rr"});c.events.publish("gtm.update",{event:"compareTo",providerName:a.data("providername")});b.options.logImpressionsAndClicks&&c.Analytics.api.trackEvent({category:"rr",action:"right",label:a.data("providerCode"),value:"click"});return!1})},update:function(){var b=this,a=b.options,d=b.element;c.ajax.execute(b.path,{data:{pageOrigin:a.pageOrigin,searchId:a.searchId,vertical:a.vertical,
compareToPlacement:a.placement},processData:!1,contentType:"application/json;charset\x3dutf-8",dataType:"json",replace:!0,customUpdate:function(a){b.destroy();d.replaceWith(a.innerHTML);b.logImpressions()}}).fail(function(){d.html("")})},logImpressions:function(){this.options.logImpressionsAndClicks&&e(".provider-item-row",this.element).each(function(){c.Analytics.api.trackEvent({category:"rr",action:"right",label:e(this).data("providerCode"),value:"impression"})})}})})(window.R9,window.jQuery||window.jq);(function(d,f,e){d.createComponentClass("common.kn.AdsenseService",{widgets:{},locations:{right:0,bottom:1},init:function(){this.defaultPageOptions={linkTarget:"_blank",adsResponseCallback:this._handleResponseCallback.bind(this),adLoadedCallback:this._handleAdLoadedCallback.bind(this)};this._doAdsenseRefresh=d.Common.Utils.debounce(this._doAdsenseRefresh.bind(this),1E3)},addEventHandlers:function(){this.subscribe("adsense.register.text.widget",this._handleRegisterWidget.bind(this));this.subscribe("adsense.update.text.widget",
this._handleUpdateWidget.bind(this));this.subscribe("adsense.trigger",this._triggerAdsenseRefresh.bind(this));this.subscribe("adsense.update.text.options",this._onUpdateTextOptions.bind(this))},_handleRegisterWidget:function(a){a&&a.id&&!this.widgets[a.id]&&this._addOrUpdateWidget(a)},_handleUpdateWidget:function(a){a&&a.id&&this.widgets[a.id]&&(this.widgets[a.id].refreshed=!1)},_addOrUpdateWidget:function(a){var b=Object.getOwnPropertyNames(this.widgets).length;d.config.getBoolean("ui.horizon.common.kn.adsense.single.req.widget.order.from.location",
!1)&&a.pageLocation&&this.locations.hasOwnProperty(a.pageLocation)&&(b=this.locations[a.pageLocation]);this.widgets[a.id]=e.extend({},{order:b,refreshed:!1},a)},_triggerAdsenseRefresh:function(){var a=this,b=Object.getOwnPropertyNames(this.widgets).map(function(b){return a.widgets[b]});b.filter(function(a){return!a.refreshed}).length===b.length&&this._doAdsenseRefresh()},_doAdsenseRefresh:function(){if(f._googCsa){var a=["ads",this.pageOptions].concat(this._getAdBlocks());f._googCsa.apply(null,a)}},
_handleResponseCallback:function(a){var b=this;a&&Object.getOwnPropertyNames(this.widgets).forEach(function(c){a.hasOwnProperty(c)&&(c=b.widgets[c].impressionURL+a[b.id("ads")],e.get(c))})},_handleAdLoadedCallback:function(a,b){b&&this.widgets.hasOwnProperty(a)&&(this.widgets[a].refreshed=!0,this.widgets[a].adLoadedCallback(a,b))},_getAdBlocks:function(){var a=this;return Object.getOwnPropertyNames(this.widgets).sort(function(b,c){return a.widgets[b].order-a.widgets[c].order}).map(function(b){return a.widgets[b].textAdSettings()}).filter(function(a){return null!=
a})},_onUpdateTextOptions:function(a){var b=a.id;this.widgets[b]&&(this.widgets[b]=e.extend({},this.widgets[b],{impressionURL:a.impressionURL}));this.pageOptions=e.extend({},this.defaultPageOptions,a.pageOptions)}});d.publish("common.kn.AdsenseTextService",{_instance:null,initialize:function(){null===this._instance&&(this._instance=new d.common.kn.AdsenseService)}})})(R9,window,jQuery);(function(b,c){b.createComponentClass("common.kn.Text",{options:{displayOptions:{colorBackground:"#FAFAFC",fontSizeTitle:15,colorTitleLink:"#1E93F5",colorDomainLink:"#D8580B",colorText:"#444",noTitleUnderline:!0,width:void 0},adBlockOptions:null,pageOptions:null,pageLocation:null,title:null,minRefreshRate:null,gptIframeTitle:null,order:null},adTimeout:null,init:function(a){a=new b.common.kn.Mixin;a.loadGPT();a.loadAdsense();this.title=this.getChildElement("title");this.showTitle(!1);this.isAdsenseSingleReqEnabled()&&
b.common.kn.AdsenseTextService.initialize();this.publishAdsRequest()},addEventHandlers:function(){this.subscribe("resultspage.ads.update",this.onResultsPageAdsUpdate.bind(this));this.subscribe("resultspage.adinfo.empty",this.publishAdsRequest.bind(this))},inlineComponentsReady:function(){this.publishAdsRequest();this.hasPageOptions()&&this.checkQAd()},publishAdsRequest:function(){b.events.publish("ads.request",{adType:"textAd",pageLocation:this.options.pageLocation,now:!this.hasPageOptions(),events:["searchform.submit",
"resultsHeader.changed","filters.changed","paginator.change"],minRefreshRate:this.options.minRefreshRate});this.isAdsenseSingleReqEnabled()&&b.events.publish("adsense.register.text.widget",{id:this.id("ads"),pageLocation:this.options.pageLocation,textAdSettings:this.getTextAdSettings.bind(this),adLoadedCallback:this.adLoadedCallback.bind(this)})},onResultsPageAdsUpdate:function(a){if(a=(new b.common.kn.Mixin).findAdDataForType("textAd",this.options.pageLocation,a))this.options.pageOptions=a.pageOptions,
this.options.adBlockOptions=a.adBlockOptions,this.options.impressionURL=a.impressionURL,this.isAdsenseSingleReqEnabled()&&this.hasPageOptions()&&(b.events.publish("adsense.update.text.options",{id:this.id("ads"),pageOptions:a.pageOptions,impressionURL:a.impressionURL}),b.events.publish("adsense.update.text.widget",{id:this.id("ads")})),window.clearTimeout(this.adTimeout),this.adTimeout=window.setTimeout(this.checkQAd.bind(this),b.config.getInt("ui.horizon.ads.delay",1E3))},hasPageOptions:function(){return this.options.pageOptions&&
!c.isEmptyObject(this.options.pageOptions)},getPageOptions:function(){var a=this;return c.extend({linkTarget:"_blank",adsResponseCallback:function(b){b&&b.hasOwnProperty(a.id("ads"))&&a.options&&a.options.impressionURL&&(b=a.options.impressionURL+b[a.id("ads")],c.get(b))},adLoadedCallback:this.adLoadedCallback.bind(this)},this.options.pageOptions||{})},adLoadedCallback:function(a,c){c&&(b.events.publish("textad.loaded"),this.showTitle(!0),this.addFrameTitle())},getTextAdSettings:function(){return this.hasPageOptions()?
c.extend({},this.options.adBlockOptions||{},this.options.displayOptions||{},{container:this.id("ads")}):null},checkQAd:function(){window._googCsa&&this.hasPageOptions()&&(this.isAdsenseSingleReqEnabled()?b.events.publish("adsense.trigger"):window._googCsa("ads",this.getPageOptions(),this.getTextAdSettings()))},showTitle:function(a){null!==this.title&&(a?this.title.removeClass("hidden"):this.title.addClass("hidden"))},addFrameTitle:function(){null!==this.options.gptIframeTitle&&this.getChildElement("ads").find("iframe").first().attr("title",
this.options.gptIframeTitle)},isAdsenseSingleReqEnabled:function(){return b.config.getBoolean("ui.horizon.common.kn.adsence.single.req.enabled",!1)}})})(R9,jQuery);(function(b,c){b.createComponentClass("hotels.results.HotelRightRail","base.results.Rail",{trackCategory:"RightRail",options:{sponsoredDisclaimerEnabled:!1,defaultRailWidth:300,minHeaderHeight:0,maxHeaderHeight:0,buttonMargin:0,dynamicTransitPosition:!1},transitToggle:null,mapCmp2:null,init:function(){this.options.sponsoredDisclaimerEnabled&&(this.sponsoredDisclaimer=this.getChildElement("sponsoredDisclaimer"),this.sponsoredTooltipTrigger=this.getChildElement("sponsoredDisclaimerTooltip"));this.transitToggle=
this.getChildElement("show-transit");this.mapCmp2=this.getChildElement("map-cmp2-wrapper")},addEventHandlers:function(){var a=this;this.subscribe("right.rail.hide",c.proxy(this.hide,this));this.subscribe("right.rail.show",c.proxy(this.show,this));if(this.options.sponsoredDisclaimerEnabled&&this.sponsoredTooltipTrigger.getWidget())this.sponsoredDisclaimer.on("click",function(){a.sponsoredTooltipTrigger.trigger("mouseover")});this.subscribe("right.rail.update.preventDynamicPositioning",this.updatePreventDynamicPositioning.bind(this));
this.subscribe("results.mapToggle.syncState",this.updateRailWidth.bind(this));this.transitToggle&&this.transitToggle.length&&(this.registerEvent("click",this.transitToggle,function(){a.transitToggle.hasClass("checked")?(a.transitToggle.attr("aria-checked",!1),a.transitToggle.removeClass("checked"),b.events.publish("hotels.results.dualViewMap.showTransit",{showTransit:!1})):(a.transitToggle.attr("aria-checked",!0),a.transitToggle.addClass("checked"),b.events.publish("hotels.results.dualViewMap.showTransit",
{showTransit:!0}))}),this.transitToggle.toolTip({content:this.transitToggle.data("message"),extraClass:"fake-avuxi",closeDelay:0,delay:0,edgeOffset:3}));this.subscribe("hotels.results.dualViewMap.mapLoaded",function(){a.transitToggle&&a.transitToggle.length&&a.transitToggle.addClass("loaded");a.mapCmp2&&a.mapCmp2.length&&(a.mapCmp2.addClass("loaded"),a.checkMapCmp2Impression())});this.subscribe("hotels.results.dualViewMap.open",function(){a.transitToggle&&a.transitToggle.length&&a.transitToggle.addClass("visible");
a.mapCmp2&&a.mapCmp2.length&&(a.mapCmp2.addClass("visible"),a.checkMapCmp2Impression())});this.subscribe("hotels.results.dualViewMap.closed",function(){a.transitToggle&&a.transitToggle.length&&a.transitToggle.removeClass("visible");a.mapCmp2&&a.mapCmp2.length&&a.mapCmp2.removeClass("visible")});this.mapCmp2&&this.mapCmp2.length?(this.subscribe("search.startSearch",function(){a.mapCmp2.removeClass("hasData")}),this.subscribe("hotels.results.cmp2.rightrail.loaded",function(b){a.loadMapCmp2(b)}),this.loadMapCmp2(b.question.ask("hotels.results.cmp2.data")),
c(window).scroll(b.Common.Utils.debounce(a.positionAvuxi.bind(a),50)),this.positionAvuxi()):this.options.dynamicTransitPosition&&(c(window).scroll(b.Common.Utils.debounce(a.positionTransitIcon.bind(a),50)),this.positionTransitIcon());this.subscribeForUpdatingPolicyInfo("HotelPolicyInformation","hotelPolicyInfo")},positionTransitIcon:function(){this.transitToggle&&this.transitToggle.length&&this.transitToggle.css({top:Math.max(this.options.minHeaderHeight+this.options.buttonMargin,this.options.maxHeaderHeight+
this.options.buttonMargin-c(window).scrollTop())})},positionAvuxi:function(){this.positionTransitIcon();var a=c(".vxmb.vxclear");if(a&&a.length){var b=this.transitToggle.height()+1.5*this.options.buttonMargin;a.css({"margin-top":Math.max(b,this.options.maxHeaderHeight-this.options.minHeaderHeight+b-c(window).scrollTop())})}else window.setTimeout(this.positionAvuxi.bind(this),50)},loadMapCmp2:function(a){var c=this;a&&a.cmp2Items&&a.cmp2Items.length&&this.mapCmp2&&this.mapCmp2.length&&b.ajax.execute("hotels/results/HotelMapCompareTo",
{data:{compareToItems:JSON.stringify(a.cmp2Items),searchId:a.searchId,showAllButton:!b.Common.Utils.Browsers.isIE(11)},appendTo:this.mapCmp2,replace:!0}).then(function(){c.mapCmp2.addClass("hasData");c.checkMapCmp2Impression()}).fail(function(){c.mapCmp2.removeClass("hasData")})},checkMapCmp2Impression:function(){this.mapCmp2&&this.mapCmp2.length&&this.mapCmp2.hasClass("visible")&&this.mapCmp2.hasClass("loaded")&&this.mapCmp2.hasClass("hasData")&&b.events.publish("hotels.map.cmp2.impression")},hide:function(){var a=
this,d=c.Deferred(),e=d.promise();this.unbindWindowEvents();this.hasAnimation()?(this.element.on(b.Common.Utils.Browsers.ANIMATION_END,function(){d.resolve();a.element.off(b.Common.Utils.Browsers.ANIMATION_END)}),this.element.addClass("animate")):d.resolve();e.then(function(){a.element.addClass("is-hidden");b.events.publish("right.rail.hideAnimationDone")})},show:function(){this.bindWindowEvents();this.element.removeClass("animate");this.element.removeClass("is-hidden");this.onScroll()},hasAnimation:function(){return"0s"!==
this.element.css("animationDuration")},updateRailWidth:function(a){a&&a.hasOwnProperty("isMapOpen")&&(a.isMapOpen?(this.element.css("width","auto"),b.events.publish("pinnedContent.reset")):this.element.css("width",this.options.defaultRailWidth))}})})(R9,jQuery);(function(c){c.createComponentClass("common.compareto.v3.ResultPage",{options:{searchId:"",vertical:""},init:function(){var a=this.options.searchId;if(a)window["@r9/cmp2-ui"].onResultPage({placement:null,requestInformation:null,type:this.getVertical(),searchId:a})},getVertical:function(){var a="";switch(this.options.vertical){case "flights":a="F";break;case "hotels":a="H";break;case "cars":a="C";break;case "packages":a="P";break;case "cruises":a="R";break;case "trains":a="T"}return a},addEventHandlers:function(){var a=
this,d=a.options;a.subscribe("resultspage.cleanup",function(){d.searchId=null});a.subscribe("resultspage.searchId.changed",function(b){b&&b.searchId&&b.searchId!==d.searchId&&(c.ComponentManager.removeSingleton(a._namespace),c.ajax.execute("common/compareto/v3/ResultPage",{data:{searchId:b.searchId,vertical:d.vertical}}))})}})})(window.R9);(function(f){function g(a,b,e){var c=Array.isArray,d=(new Date).getTime();b=isNaN(b)?2:b;e=isNaN(e)?864E5:e;if(1>b)return!1;if(c&&!c(a)||!c&&"[object Array]"!==Object.prototype.toString.call(a))a=[];if(!a||a.length<b)return a?a.concat(d):[d];for(c=0;c<b;c++)if(isNaN(a[c])&&(a[c]=0),d-a[c]>e)return a[c]=d,a;return!1}function h(a,b){if(!f.storage.isAvailable()||!a)return null;(a=f.storage.get(a))||(a={});b in a||(a[b]=[]);return a}f.publish("common.compareto.dialog.TimeUtil",{DeltaTimer:function(a,
b){function e(){var d=Date.now(),g=Math.max((b||0)-(d-f),0);c=setTimeout(e,g);f=d+g;a(d)}var c,d,f;this.start=function(a){d=setTimeout(e,a?a:0);return f=Date.now()};this.stop=function(){clearTimeout(c);clearTimeout(d);return f}},canStartTimer:function(a,b,e,c){return(a=h(a,b))&&-1!==e?!!g(a[b],e,c):!0},addToStorage:function(a,b,e,c){var d=h(a,b);return d?(e=g(d[b],e,c))?(d[b]=e,f.storage.set(a,d),!0):!1:!1}})})(window.R9);(function(b,g,d,f){b.createComponentClass("common.compareto.dialog.CompareToModalDialogTrigger",{options:{url:"",pageOrigin:"",compareToPlacement:null,vertical:"",storageKey:"compareToModal"},eventsGroupName:"",showed:!1,destroyTimerEvents:"",resetTimerEvents:"",init:function(){var a=this.options;this.eventsGroupName=".compareToModal"+this.id();this.destroyTimerEvents=this.getEventsWithGroup(["click"]);this.resetTimerEvents=this.getEventsWithGroup("mousemove keydown scroll touchstart touchmove touchend touchcancel".split(" "));
a.searchId&&this.start()},getEventsWithGroup:function(a){for(var b=this.eventsGroupName,c=[],e=0,d=a.length;e<d;e++)c.push(a[e]+b);return 0<c.length?c.join(" "):null},addEventHandlers:function(){var a=this,b=a.options;a.subscribe("resultspage.searchId.changed",function(c){a.stop();c&&c.searchId&&(b.searchId=c.searchId,a.showed=!1)});a.subscribe("resultspage.streaming.done",function(){a.start()});a.subscribe(["resultspage.cleanup","clickout.open","multibook.providerClicked"],function(){a.stop()})},
start:function(){var a=this,d=a.options;a.starting||(a.starting=!0,a.timer?a.startTimer():b.action.execute("common/compareto/dialog/CompareToModalDialogAction",{searchId:d.searchId},function(b){b&&(a.responseOptions=b,a.createTimer())}))},createTimer:function(){var a=this;a.stop();a.timer=new b.common.compareto.dialog.TimeUtil.DeltaTimer(function(){a.stop();a.openDialog()},a.responseOptions.timeOutTime);f(d).on(a.resetTimerEvents,function(){a.startTimer()}).on(a.destroyTimerEvents,function(){a.stop()});
a.startTimer()},stop:function(){var a=this.eventsGroupName;f(d).off(a);this.timer&&this.timer.stop();this.timer=null},canStartTimer:function(){var a=this.responseOptions;return b.common.compareto.dialog.TimeUtil.canStartTimer(a.storageKey,this.options.vertical,a.rateLimitCount,a.rateLimitPeriod)},startTimer:function(){this.starting=!1;this.timer&&(!this.canStartTimer()||this.showed?this.stop():(this.timer.stop(),this.timer.start(this.responseOptions.timeOutTime)))},openDialog:function(){var a=this.options;
this.showed=!0;b.ajax.execute(a.url,{data:{pageOrigin:a.pageOrigin,compareToPlacement:a.compareToPlacement,searchId:a.searchId,vertical:a.vertical},processData:!1,contentType:"application/json;charset\x3dutf-8",dataType:"json",replace:!0}).then(function(){b.events.publish(["common.dropdown.closeAll","common.widgets.tooltip.closeAll"])})},destroy:function(){this.stop();this.base()}})})(window.R9,window,window.document,window.jq||window.jQuery);(function(e,g){var h=e.config.getBoolean("ui.whisky.modal.enabled",!1);e.createComponentClass("common.booking.ClickoutController","framework.JavaScriptComponent",{options:{postClickDelay:200},resultsOrderLogString:null,searchIdExpirationCheckFailed:!1,hotelCarsPostClickXSellRequested:!1,addEventHandlers:function(){this.base();var a=this;this.subscribe("clickout.open",function(b){a.searchIdExpirationCheckFailed?(e.Analytics.api.trackEvent("searchidexpired/bestclick"),e.events.publish("results.expired")):
a.open(b)});this.subscribe("clickout.resultsOrder.update",function(b){a.resultsOrderLogString=b});this.subscribe("searchid.expiration.check.failed",function(){a.searchIdExpirationCheckFailed=!0});this.subscribe("resultspage.cleanup",function(){a.searchIdExpirationCheckFailed=!1})},open:function(a){var b=a.data||{},c=g(a.element),d=a.event;a=a.callback||g.noop;var f=d&&(d.metaKey||d.ctrlKey);c.length&&("A"!==c.get(0).nodeName&&(c=c.find("a").eq(0)),b.target=b.target||c.attr("target"),b.url=b.url||
c.attr("href"),b.name=b.name||c.data("name"),b.code=b.code||c.data("code"),b.splitProvider=b.splitProvider||c.data("split-provider"),b.element=c,b.showWhiskyModal=!!b.showWhiskyModal,void 0===b.clickoutWarningDialog&&(b.clickoutWarningDialog=c.data("clickout-warning-dialog")),void 0===b.clickoutAlternateOptionsDialog&&(b.clickoutAlternateOptionsDialog=c.data("clickout-alternate-options-dialog")));d&&d.preventDefault();b.noExternalRedirect=this.isNoExternalRedirect(b);"undefined"===typeof b.showAfterclick&&
(b.showAfterclick=!b.noExternalRedirect);b.noExternalRedirect?this.postClick(b,a,f):(b.target=b.target||"_blank",(c="self"===b.target)&&this.postClick(b,a,f),d=b.url,this.resultsOrderLogString&&(d+=(1>d.indexOf("?")?"?":"\x26")+"resultsOrder\x3d"+encodeURIComponent(this.resultsOrderLogString)),"undefined"===typeof b.code||"BOOKINGDOTCOMPV"!==b.code&&"BOOKINGDOTCOMGENIUS"!==b.code&&"BOOKINGDOTCOMGENIUSCORE"!==b.code||!0!==e.question.ask("hotels_bdc_should_clickout")?(h&&b.showWhiskyModal?e.events.publish("cars.whisky.modal.startWatching",
{url:d+"\x26_kw_whiskyModal\x3dtrue"}):window.open(d,b.target),c||setTimeout(this.postClick.bind(this,b,a,f),this.options.postClickDelay)):e.events.publish("genius.show.interstitial",b))},postClick:function(a,b,c){a.clickoutDetailsDialog||a.clickoutAlternateOptionsDialog||a.clickoutInline||e.events.publish(["multibook.providerClicked","provider.book.click"],g.extend({resultId:a.resultId,uiResultId:a.uiResultId,providerName:a.name,providerCode:a.code,splitProvider:a.splitProvider,clickoutDetailsDialog:a.clickoutDetailsDialog,
clickoutInline:a.clickoutInline,clickoutWarningDialog:a.clickoutWarningDialog,clickoutAlternateOptionsDialog:a.clickoutAlternateOptionsDialog,afterclickIgnore:!a.showAfterclick||c},a.customPostClickData));!this.publishAlternateClickout(a)&&a.splitProvider&&e.events.publish("multibook.splitProvider.click",{resultId:a.resultId,element:a.element});!a.noExternalRedirect&&"flights"===this.options.vertical&&e.config.getBoolean("ui.post.click.xsell.enabled",!1)&&this.launchPostClickXSell(a);b(a)},publishAlternateClickout:function(a){var b=
!1,c,d,f;if(a.splitProvider&&!a.clickoutInline&&!a.clickoutDetailsDialog)return!1;a.clickoutDetailsDialog?f="multibook.modalDetailsDialog.show":a.clickoutInline?(d={activeTab:"rates",force:!0},f="flightResult.details.clickout.toggleOpen"):a.clickoutAlternateOptionsDialog?f="multibook.clickoutAlternateOptions.show":a.clickoutWarningDialog&&(f="multibook.clickoutWarning.show");if(f){d=g.extend(d||{},a);c=g.extend(d,this.getSubscriptionResetData(function(){b=!0}));e.events.publish(f,d);if(!b)this.onClickoutWarningFailure(c);
e.events.publish("track.result.details.open",{resultId:a.resultId,source:"cta"});return!0}return!1},getSubscriptionResetData:function(a){return{clickoutWarningDialog:!1,clickoutAlternateOptionsDialog:!1,clickoutDetailsDialog:!1,clickoutInline:!1,noExternalRedirect:!1,verifySubscriptionCallback:a}},isNoExternalRedirect:function(a){return a.noExternalRedirect||a.splitProvider||a.clickoutWarningDialog||a.clickoutDetailsDialog||a.clickoutInline||a.clickoutAlternateOptionsDialog},onClickoutWarningFailure:function(a){var b=
g.extend({},a,this.getSubscriptionResetData(void 0)),c;try{c=JSON.stringify(a)}finally{this.open({data:b}),this.log.error("Failed to open clickout dialog. Subscription for result "+a.resultId+" not registered.\nPublish data: "+c)}},launchPostClickXSell:function(a){if(!this.hotelCarsPostClickXSellRequested){this.hotelCarsPostClickXSellRequested=!0;e.Analytics.api.trackEvent("flight-hotel-xsell/impression");var b=a.element.parents(".Base-Results-HorizonResult");b.length&&e.ajax.execute("flights/results/xsells/HotelCarsPostClickXSell",
{data:{searchId:a.searchId},appendTo:b,insertBefore:!0,replace:!1})}}})})(R9,jQuery);(function(b,d){b.createComponentClass("common.booking.SearchIdExpirationChecker","framework.JavaScriptComponent",{options:{},searchId:null,searchIdLikelyValid:!0,checkTimer:null,init:function(){this.options.searchId&&(this.searchId=this.options.searchId)},addEventHandlers:function(){var a=this;this.base();this.subscribe("resultspage.streaming.done",this.searchEnded.bind(this));this.subscribe("resultspage.refreshed",this.searchEndedWait.bind(this));this.subscribe(["search.startSearch","resultspage.searchId.changed",
"search.expired","results.expired"],this.clearCheckTimer.bind(this));d("a.bookingLink").click(function(){return a.interceptClick()})},interceptClick:function(){if(this.searchIdLikelyValid)return!0;b.Analytics.api.trackEvent("searchidexpired/booklink");b.events.publish("results.expired");return!1},clearCheckTimer:function(){this.checkTimer&&(clearTimeout(this.checkTimer),this.checkTimer=null)},searchEndedWait:function(a){var b=this;setTimeout(function(){b.searchEnded(a)},100)},searchEnded:function(a){this.clearCheckTimer();
a&&a.searchId?(this.searchId=a.searchId,this.searchIdLikelyValid=!0,this.startCheckTimer()):a&&"streaming"in a&&!a.streaming?this.startCheckTimer():this.searchId=null},startCheckTimer:function(){if(!this.checkTimer){var a=this;this.checkTimer=setTimeout(function(){a.validateFromServer();a.checkTimer=null},this.options.checkTimeout)}},validateFromServer:function(){if(this.searchId){var a=this;d.ajax({type:"POST",url:"/s/horizon/common/booking/SearchIdValidationAction",headers:{"X-CSRF":b.globals.formtoken},
data:{searchId:this.searchId},success:function(c){c&&(a.searchIdLikelyValid=!c.isExpired,c.isExpired&&b.events.publish("searchid.expiration.check.failed"))}})}}})})(R9,jQuery);(function(b,a){b.createComponentClass("common.authentication.LoginOptionsDialog",{trackingCategory:"anon-trips-login",trackingLabel:null,init:function(){this.optionsDialog=this.element.dialog().getWidget();this.confirmationDialog=a("#"+this.id("confirmation")).dialog().getWidget()},addEventHandlers:function(){b.events.subscribe("show.login.options.dialog",a.proxy(this.openDialog,this));a("#"+this.id("regularAuth")).click(a.proxy(this.regularAuth,this));a("#"+this.id("guestAuth")).click(a.proxy(this.guestAuth,
this));a("#"+this.id("guestConfirmation")).click(a.proxy(this.continueAsGuest,this));a("#"+this.id("googleAuth")).click(a.proxy(this.googleAuth,this));a("#"+this.id("fbAuth")).click(a.proxy(this.fbAuth,this));a("#"+this.id("signUp")).click(a.proxy(this.signUp,this))},openDialog:function(a){a=a||{};this.trackingLabel=a.trackingLabel||null;a.forceLogin||!this.stayAnon?this.showDialog():this.continueAsGuest()},showDialog:function(){this.track("display-dialog");var c=this;a.when(b.Social.FB.ensureAPILoaded(),
b.Social.Google.ensureAPILoaded()).always(function(){c.optionsDialog.open()})},closeOptionsDialog:function(){b.events.unsubscribe("continue.as.guest");this.optionsDialog.close()},regularAuth:function(){this.track("use-email-address");this.closeOptionsDialog();b.authentication.showLogin()},continueAsGuest:function(){this.track("continue-as-guest");this.confirmationDialog.close();b.events.publish("continue.as.guest");this.stayAnon=!0;this.closeOptionsDialog()},guestAuth:function(){this.track("guest-confirm");
this.optionsDialog.close();b.config.getBoolean("ui.trips.anon.second-step-dialog.enabled",!1)?this.continueAsGuest():this.confirmationDialog.open()},signUp:function(){this.track("guest-sign-me-up");this.confirmationDialog.close();this.optionsDialog.open()},fbAuth:function(){this.closeOptionsDialog();b.events.subscribe("fbauth.login.success",function(){window.location.reload(!0)});b.authentication.external.facebook.login(null,null,null,null,{category:this.trackingCategory,label:this.trackingLabel})},
googleAuth:function(){this.closeOptionsDialog();b.events.subscribe("googleauth.login.success",function(){window.location.reload(!0)});b.authentication.external.google.login(null,null,null,{category:this.trackingCategory,label:this.trackingLabel})},track:function(a){b.Analytics.api.trackEvent({category:this.trackingCategory,action:a,label:this.trackingLabel})}})})(R9,jQuery);(function(c,d){c.createComponentClass("hotels.results.HotelPriceAlertsController","framework.JavaScriptComponent",{options:{anonUser:!0,showUnconfirmedWarning:!1,driveByAnon:!1,initialFormData:null,alertSavedMessage:null,alertSavedMessageShort:null,alertUpdatedMessage:null,alertManageLinkMessage:null,showManageLink:!0,searchId:"",hotelId:""},alertFormData:{city:"",cityId:"",hId:"",checkInDate:null,formattedCheckinDate:null,checkOutDate:null,formattedCheckoutDate:null,numRooms:0,guests:0,adults:0,
children:0,alertid:null},startDate:null,endDate:null,alertId:null,init:function(){this.alertFormData=d.extend({},this.alertFormData,this.options.initialFormData);this.options.initialFormData&&(this.startDate=moment(this.alertFormData.checkInDate),this.endDate=moment(this.alertFormData.checkOutDate));this.options.hotelId&&(this.alertFormData.hId=this.options.hotelId)},addEventHandlers:function(){var a=this;this.base();this.subscribe("hotels.results.alerts.create",this.createPriceAlert.bind(this));
this.subscribe("hotels.results.alerts.delete",this.deletePriceAlert.bind(this));this.subscribe("hotels.results.existingAlert",function(b){a.alertFormData.alertid=b;a.alertId=b});this.subscribe(["searchform.submit","inlineSearchFormUpdated"],function(b){a.updateFormData(b)});this.subscribe("resultspage.searchId.changed",function(b){a.options.searchId=b.searchId});this.subscribe("search.poll.response",function(b){(b=b.existingAlertId)&&0<b?(a.alertFormData.alertid=b,a.alertId=b):(a.alertFormData.alertid=
null,a.alertId=null)});this.subscribe("common.results.resendConfirmationEmail",this.resendConfirmationEmail.bind(this))},updateFormData:function(a){this.alertFormData.checkInDate=a.checkInDate;this.alertFormData.checkOutDate=a.checkOutDate;this.startDate=moment(this.alertFormData.checkInDate);this.endDate=moment(this.alertFormData.checkOutDate);this.alertFormData.guests=a.guests?a.guests:a.adults+a.children;this.alertFormData.numRooms=a.rooms;this.alertFormData.cityId=a.cityId;this.alertFormData.city=
a.location;this.alertFormData.hId=a.hotelId},createPriceAlert:function(a){this.options.driveByAnon&&this.options.anonUser?this.showDriveByAnon(a):this.options.showUnconfirmedWarning?c.events.publish("common.results.unconfirmedWarning",{sendEmailBeforeOpeningDialog:!0}):this.addPriceAlert(a)},showDriveByAnon:function(a){c.ajax.execute("hotels/results/HotelPriceAlertDriveBy",{data:{searchId:this.options.searchId,sourceId:a&&a.sourceId?a.sourceId:null},replace:!0})},addPriceAlert:function(a){if(this.options.anonUser){var b=
{promoType:"alert",promo:"pricealert",sourceId:this.options.sourceId,showSingleImage:!0,messageParams:[this.alertFormData.city,[this.alertFormData.checkInDate,this.alertFormData.checkOutDate].join(" - ")],success:this.handleWatch.bind(this)};c.authentication.showLogin(b)}else this.handleWatch();a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"create",value:"new"})},deletePriceAlert:function(a){this.options.anonUser?window.location="/alerts":
(this.showFeedbackMessage=!0,this.deleteEmailPriceAlert());a&&a.vsLog&&c.Analytics.api.trackEvent(a.vsLog);c.Analytics.api.trackEvent({category:"Price-Alert",action:"delete",value:this.alertFormData.alertid})},deleteEmailPriceAlert:function(){var a=this,b={action:"delete",alertid:a.alertFormData.alertid};this.alertFormData.hid?c.events.publish("trips.hotels.removeHotel",{hid:this.alertFormData.hid}):d.ajax({type:"POST",url:"/h/hermes/prefs/ajax/alert/v1",headers:{"X-CSRF":c.globals.formtoken},data:b,
success:function(){a.alertId="";a.alertFormData.alertid=""},error:function(a,b){c.events.publish("error.alert",{messages:b})}})},showAlertAuth:function(a,b){var e=this;a=d.extend({},a,{promoType:"alerts"});a={promo:"priceAlert",promoType:a.promoType,username:a.username,success:function(){c.authentication.cached_dialog.close();e.showFeedbackMessage=!0;e.alertFormData.createFromButton=!0;setTimeout(function(){window.location.reload()},1E4)}};b?c.authentication.showLogin(a):c.authentication.showSignup(a)},
handleWatch:function(){var a=this,b={method:"post",headers:{"X-CSRF":c.globals.formtoken},data:{dt:"0"===this.alertFormData.hId||""===this.alertFormData.hId?4:5,startDate:this.startDate.format(c.globals.apiDateFormat),endDate:this.endDate.format(c.globals.apiDateFormat),sendFrequency:1,"deliveryType[]":"email",citycode:this.alertFormData.cityId,hid:this.alertFormData.hId,rooms:this.alertFormData.numRooms,guests:this.alertFormData.guests||this.alertFormData.adults+this.alertFormData.children,email:!0}};
this.alertFormData.hid?(c.events.publish("trips.hotels.saveHotel",{hid:this.alertFormData.hid}),c.events.publish("alertsaved.success",{searchId:a.options.searchId})):d.ajax("/h/hermes/prefs/ajax/alert/v1",b).then(function(b){b.success&&(a.alertId=b.alertId,a.alertFormData.alertid=b.alertId,c.events.publish("alertsaved.success",{searchId:a.options.searchId}))})},resendConfirmationEmail:function(a){var b=d.Deferred();a&&a.email&&(this.alertFormData.email=a.email);d.ajax({type:"POST",headers:{"X-CSRF":c.globals.formtoken},
url:"/trips/mustconfirm/resend",data:this.serialize(),dataType:"script",error:function(a,d){c.events.publish("error.alert",{messages:d});b.reject()},success:function(){b.resolve()}})},serialize:function(){var a=this;return Object.keys(a.alertFormData).map(function(b){var c=a.alertFormData[b];return null===c||void 0===c||""===c?"":encodeURIComponent(b)+"\x3d"+encodeURIComponent(c)}).join("\x26")}})})(R9,jQuery);(function(d,c){d.createComponentClass("hotels.results.HotelBigCarouselOverlay",{popupDetails:null,popupDetailsContent:null,pendingDetails:!1,searchFinished:!1,contentHid:null,contentIndex:null,showThumbs:!0,bookingLinkMapJSON:"",options:{searchId:null,showThumbs:!0},init:function(){this.popupDetails=this.element;this.popupDetailsContent=this.getChildElement("bigCarouselContent")},addEventHandlers:function(){var a=this;this.subscribe("resultspage.searchId.changed",function(b){a.options.searchId=b.searchId});
this.subscribe("resultspage.streaming.start",function(){a.searchFinished=!1});this.subscribe("resultspage.streaming.done",function(){a.searchFinished=!0;a.pendingDetails&&(a.showPopupDetails(a.contentHid,a.contentIndex,a.bookingLinkMapJSON),a.pendingDetails=!1)});this.subscribe("hotels.bigCarousel.show",function(b){a.contentHid=b.hid;a.contentIndex=b.index||0;a.bookingLinkMapJSON=b.bookingLinkMapJSON||"";a.showThumbs="undefined"===typeof b.showThumbs?!0:!!b.showThumbs;b.searchId&&(a.options.searchId=
b.searchId);b.priceType&&(a.options.priceType=b.priceType);a.searchFinished||b.force?a.showPopupDetails(a.contentHid,a.contentIndex,a.bookingLinkMapJSON,a.showThumbs):a.pendingDetails=!0});this.subscribe("hotels.bigCarousel.hide",function(){c("header").css({visibility:"visible"});c(".cheapflightsHeader").css({visibility:"visible"});c("body").css({overflow:"visible"}).unbind("keydown");a.popupDetails.removeClass("open").removeClass("loading")});this.element.bind("click",function(){d.events.publish("hotels.bigCarousel.hide")})},
showPopupDetails:function(a,b,c,d){this.popupDetailsContent.html("");this.popupDetails.addClass("loading");this.loadDetails(a,b,c,d)},unveil:function(){c("header").css({visibility:"hidden"});c(".cheapflightsHeader").css({visibility:"hidden"});c("body").css({overflow:"hidden"});c("body").bind("keydown",function(a){if("ArrowLeft"===a.key||"Left"===a.key)d.events.publish("horizon.bigCarousel.previousPhoto"),a.preventDefault();else if("ArrowRight"===a.key||"Right"===a.key)d.events.publish("horizon.bigCarousel.nextPhoto"),
a.preventDefault();else if("Escape"===a.key||"Esc"===a.key)d.events.publish("hotels.bigCarousel.hide"),a.preventDefault()});this.popupDetails.removeClass("loading").addClass("open")},loadDetails:function(a,b,f){var e=this;d.ajax.execute("hotels/results/HotelBigCarouselContent",{data:{hid:a,index:b,searchId:e.options.searchId,priceType:e.options.priceType,bookingLinkMapJSON:f,showThumbs:e.showThumbs},appendTo:e.popupDetailsContent,replace:!0}).then(function(a,b){c(".resultsContainer").css({cursor:"unset"});
a.id?e.unveil():d.events.publish("hotels.bigCarousel.hide")})}})})(R9,jQuery);(function(b){b.createComponentClass("common.authentication.GeniusLinker",{options:{finalUrl:null,alteredUrl:null,userEmail:null,userNickname:null,userFirstName:null,userLastName:null,isBdcAuthorized:!1,isBdcAuthSeen:!1,isBdcClickoutEnabled:!1,geniusLevel:"NO_LEVEL",isGenius:!1,isAnon:!1,code:null},linkButton:null,cancelButton:null,init:function(){var a=this;this.linkButton=this.getChildElement("link");this.cancelButton=this.getChildElement("cancel");b.question.answer("hotels_bdc_authorized",function(){return a.options.isBdcAuthorized});
b.question.answer("hotels_bdc_clickout",function(){return a.options.isBdcClickoutEnabled});b.question.answer("hotels_bdc_should_clickout",function(){return a.options.isBdcClickoutEnabled&&!a.options.isAnon&&!a.options.isBdcAuthSeen&&!a.options.isBdcAuthorized&&(a.options.isGenius||"LEVEL_ZERO"==a.options.geniusLevel)})},addEventHandlers:function(){var a=this;window.onfocus=$.proxy(function(){b.events.publish("genius.update.status")});b.events.subscribe("genius.show.interstitial",function(b){a.options.code=
b.code;a.showMe(b)});b.events.subscribe("genius.update.status",function(){a.updateUserState("status")});b.events.subscribe("genius.hide.interstitial",function(){a.hideMe()});b.events.subscribe("genius.auth.reset",function(){a.updateUserState("reset")});this.subscribe(["resultspage.streaming.done","resultspage.cleanup"],function(){a.updateUserState("status")});this.linkButton.bind("click",function(c){setMetaCookie("bdcAuthComplete","true");a.options.isBdcAuthorized=!0;a.options.alteredUrl=a.getAlteredUrl();
b.Analytics.api.trackEvent("bdc/interstitial/auth/continue/"+a.options.code);a.updateUserState("continue");window.open(a.options.alteredUrl,"_blank");a.hideMe();b.events.publish("BdcLinkContinue.clicked",a.options)});this.cancelButton.bind("click",function(c){window.open(a.options.finalUrl,"_blank");b.events.publish("BdcLinkCancel.clicked",a.id());b.Analytics.api.trackEvent("bdc/interstitial/auth/skip/"+a.options.code);a.updateUserState("skip");a.hideMe()})},updateUserState:function(a){a||(a="status");
var c=this;setMetaCookie("bdcAuthSeen","false");setMetaCookie("bdcAuthComplete","false");b.action.execute("common/authentication/GeniusStateAction",{command:a},function(a){a&&(c.options.isBdcAuthorized=a.isBdcAuthorized,c.options.isAnon=a.isAnon,c.options.isGenius=a.isGenius,c.options.isBdcClickoutEnabled=a.isBdcClickoutEnabled,c.options.geniusLevel=a.geniusLevel,c.options.isBdcAuthSeen=a.isBdcAuthSeen)})},getAlteredUrl:function(){return this.options.finalUrl+"\x26authType\x3dbdc"},showMe:function(a){jq(".Hotels-Results-HotelResultsPage").addClass("hidden");
this.element.removeClass("hidden").addClass("showLogo");setMetaCookie("bdcAuthSeen","true");this.options.isBdcAuthSeen=!0;b.Analytics.api.trackEvent("bdc/interstitial/auth/impression/"+a.code);jq(window).scrollTop(0);this.options.finalUrl=a.url},hideMe:function(){jq(".Hotels-Results-HotelResultsPage").removeClass("hidden");this.element.addClass("hidden").removeClass("showLogo")}})})(R9);(function(c,e,f){var g=c.config.getBoolean("ui.horizon.results.searchPoll.includePollNumberInQuery",!0),h={trains:"trains/results/TrainsSearchPoll",flights:"flights/results/FlightSearchPoll",hotels:"hotels/results/HotelSearchPoll",packages:"packages/results/PackageSearchPoll",cars:"cars/results/CarSearchPoll",deals:"deals/results/DealSearchPoll",cruises:"cruises/results/CruiseSearchPoll",rentals:"rentals/results/RentalSearchPoll",activities:"activities/results/ActivitiesSearchPoll",cityhotels:"hotels/cityhotels/CityHotelsPoll",
restaurants:"restaurants/results/RestaurantSearchPoll",essentials:"essentials/results/EssentialsSearchPoll"},k={trains:"trains/results/TrainsResultDetails",flights:"flights/results/FlightResultDetails",hotels:"hotels/results/HotelResultDetails",packages:"packages/results/PackageResultDetails",rentals:"rentals/results/HotelResultDetails",activities:"activities/results/ActivitiesResultDetails"};c.publish("base.results.AjaxSearchPoll",f.extend({searchUrl:null,detailsUrl:null,options:{vertical:null,searchId:null,
appendTo:null},pollNumber:0,searchId:null,constructor:function(a){this.options=e.extend({},this.options,a);if(!a.vertical)throw"AjaxSearchPoll requires a vertical to be properly initialized";this.searchId=this.options.searchId;this.searchUrl=h[this.options.vertical];this.detailsUrl=k[this.options.vertical];"cityhotels"===this.options.vertical&&this.options.citycode&&(this.searchUrl+="?citycode\x3d"+this.options.citycode)},fetchResults:function(a,b){a=e.extend({data:e.extend({searchId:this.searchId,
poll:!0,pollNumber:this.pollNumber},a||{}),appendTo:this.options.appendTo,replace:!1,logServerErrors:c.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1),enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.searchPoll",!0)},b||{});c.config.getBoolean("ui.ssajax.last.action.abort",!1)&&(a.data.ajaxts=(new Date).getTime());b=this.searchUrl;g&&(b+="?p\x3d"+this.pollNumber);this.searchId=a.data.searchId;this.pollNumber++;return c.ajax.execute(b,a)},fetchDetails:function(a,b){b={data:{resultId:a,
searchId:this.searchId},appendTo:b,enforceCaptcha:c.config.getBoolean("ui.ajax.enforceCaptcha.inlineDetails",!0)};if(null===b.searchId)throw"Cannot request result details for %s: No searchId tied to this instance of AjaxSaerchPoll.".format(a);return c.ajax.execute(this.detailsUrl,b)}}));c.publish("resultsMetaData",{PROPERTIES:"code selected minPrice count displayValue displayOrder resetState defaultSelectedState dynamicFilteredStatus ignoreOnly hideOnly href noSelect disabled cssClass showAllState noPrice pluralDisplayValue minDuration minDurationValue meta".split(" "),
publish:function(a){a.hasOwnProperty("filtersData")&&this.remapFilters(a.filtersData);c.events.publish("search.poll.response",a)},remapFilters:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++){var d=a[b[c]];d.valueMap||d.headingValueMap?this.remapValueSetFilter(d):(d.legValues||d.legHeadingValues)&&this.remapPerLegValueSetFilter(d)}},remapValueSetFilter:function(a){if(a.valueMap)Object.values(a.valueMap).forEach(this.remapValueData.bind(this));else if(a.headingValueMap)for(var b in a.headingValueMap)Object.values(a.headingValueMap[b]).forEach(this.remapValueData.bind(this))},
remapPerLegValueSetFilter:function(a){if(a.legValues)Object.values(a.legValues).forEach(this.remapValueSetFilter.bind(this));else if(a.legHeadingValues)for(var b=0;b<a.legHeadingValues.length;b++)Object.values(a.legHeadingValues[b]).forEach(this.remapValueSetFilter.bind(this))},remapValueData:function(a){for(var b=a.rawState?a.rawState.split(";"):[],c=0;c<b.length;c++){var d=b[c];d.length&&(a[this.PROPERTIES[c]]=this.castValue(this.PROPERTIES[c],d))}if(a.hasOwnProperty("dynamicFilteredStatus")){a.filtered=
!1;a.partiallyFiltered=!1;switch(a.dynamicFilteredStatus){case 1:a.filtered=!0;break;case 2:a.partiallyFiltered=!0}delete a.dynamicFilteredStatus}a.hasOwnProperty("noPrice")&&a.noPrice&&(a[a.noPrice]=!0,delete a.noPrice);delete a.rawState},castValue:function(a,b){switch(a){case "code":case "displayValue":case "minPrice":case "pluralDisplayValue":case "cssClass":case "minDuration":case "href":case "noPrice":return b;case "selected":case "count":case "displayOrder":case "showAllState":case "resetState":case "defaultSelectedState":case "minDurationValue":case "dynamicFilteredStatus":return parseInt(b);
case "ignoreOnly":case "hideOnly":case "noSelect":case "disabled":return"1"===b;default:return b}}})})(R9,jQuery,base2.Base);(function(f,k,l){var m=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDetails",!0),n=f.config.getBoolean("ui.horizon.resultspage.reconcile.openDialogs",!0);f.publish("base.results.ResultsPageDOMUtils",{mergeOpenResults:function(a,d){if(m){var c=a.find(".Base-Results-HorizonResult.DetailOpen");c.length&&this.mergeOpenDetails(c,a)}n&&(c=k(".Common-Widgets-Dropdown-DropdownDialog-Content.open"),c.length&&this.mergeOpenDialogs(c,a,d))},mergeOpenDialogs:function(a,d,c){for(var b=0;b<a.length;b++){var e=
a[b].getAttribute("data-dropdown-owner");if(e&&d.find("#"+e).length){e=c.find("#"+a[b].id);if(e.length){var g=e.attr("id").split("-")[0],h=k("#"+g),g=c.find("#"+g);if(h.length&&g.length&&h.index()===g.index()){a[b].setAttribute("reconcile-ignore","attributes");f.dom.merge(a[b],e[0]);e[0].remove();continue}}a[b].remove()}}},mergeOpenDetails:function(a,d){for(var c=0;c<a.length;c++)if(!d.find("#"+a[c].id).hasClass("DetailOpen")){a[c].setAttribute("reconcile-ignore","attributes");var b=a[c].getElementsByClassName("detailsWrapper");
1===b.length&&(b[0].setAttribute("reconcile-ignore","all"),b=b[0].getElementsByClassName("detailsContent"),b.length&&b[0].children.length&&b[0].children[0].setAttribute("do-not-destroy","true"))}}});f.publish("base.results.AdsHelper",l.extend({adRequestInfo:null,adsResponseDate:null,adUpdateTimerID:null,constructor:function(a){this.adRequestInfo={}},updateAds:function(a){f.config.getBoolean("ui.ads.copyPollAdsData",!0)&&(a=k.extend(!0,{},a));if(f.config.getBoolean("ui.ads.nowAfterResponse",!0)&&this.adRequestInfo)for(var d in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(d)){var c=
this.adRequestInfo[d];if(c)for(var b=0;b<c.length;b++)c[b].now=0}this.adsResponseDate=Date.now();window.clearTimeout(this.adUpdateTimerID);this.adUpdateTimerID=setTimeout(function(){f.events.publish("resultspage.ads.update",a)},f.config.getInt("ui.horizon.resultspage.ads.updateDelay",100))},requiresAdsPoll:function(){if(!f.config.getBoolean("ui.horizon.resultspage.requireAdsPoll",!0)||this.adsResponseDate||!this.adRequestInfo)return!1;for(var a in this.adRequestInfo)if(this.adRequestInfo.hasOwnProperty(a)){var d=
this.adRequestInfo[a];if(d&&d.pop)for(var c=0;c<d.length;c++)if(d[c].now)return!0}return!1},clearAdRequestInfo:function(a){this.adRequestInfo&&(this.adRequestInfo[a]=[])},onSetupAdsRequest:function(a){if(a&&a.adType&&a.pageLocation){this.adRequestInfo||(this.adRequestInfo={});this.adRequestInfo[a.adType]||(this.adRequestInfo[a.adType]=[]);for(var d=this.adRequestInfo[a.adType],c,b=0;b<d.length;b++)d[b]&&d[b].pageLocation===a.pageLocation&&(c=1,d[b]=a);c||d.push(a)}},setAdRequestSearchOptions:function(a,
d){if(a&&this.adRequestInfo){var c="",b="",e,g,h=function(a){if(!a||!a.length)return"";for(var c="",b,e=0;e<a.length;e++)(b=a[e])&&b.pageLocation&&(!isNaN(b.minRefreshRate)&&(0<b.minRefreshRate||0===b.minRefreshRate)&&(g=void 0===g?b.minRefreshRate:Math.min(g,b.minRefreshRate)),b.now||b.events&&b.events.pop&&"string"===typeof d&&0<=b.events.indexOf(d))&&(f.config.getBoolean("ui.ads.nowAfterResponse",!0)||(b.now=0),c+=b.pageLocation+",");return c};for(e in this.adRequestInfo)this.adRequestInfo.hasOwnProperty(e)&&
("displayAd"===e?c=h(this.adRequestInfo[e]):"textAd"===e&&(b=h(this.adRequestInfo[e])));d&&f.events.publish("resultspage.ads.options");!a.forceRefreshAds&&this.adsResponseDate&&0<g&&Date.now()-this.adsResponseDate<g||(b&&(a.textAdPageLocations=b.substr(0,b.length-1)),c&&(a.displayAdPageLocations=c.substr(0,c.length-1)),a.existingAds=!!this.adsResponseDate)}}}))})(R9,jQuery,base2.Base);(function(c){c.ellipsisTooltip=function(a){this.init(a||{});return this};c.extend(c.ellipsisTooltip,{checkIfPossible:function(){return void 0!==c.fn.textOverflow&&void 0!==c.fn.tipTip},prototype:{settings:{activation:"hover",position:"top",edgeOffset:3,delay:0,fadeIn:200,fadeOut:200,content:"",ellipseString:"\x26#x2026;"},init:function(a){this.settings=c.extend({},this.settings,a)},processNode:function(a){a=c(a);var b=c.support.textOverflow?a.width():null,e=a.text();if(c.support.textOverflow){if(this.getTextWidth(a)<
b+1)return}else if(a.textOverflow(this.settings.ellipseString),!a.text().match(/\u00e2\u0080\u0160$/))return;a.tipTip(c.extend(this.settings,{content:e}))},getTextWidth:function(a){var b=a.clone();b.css({width:"auto",display:"none","max-width":"none"});b.appendTo(a.parent());a=b.width();b.remove();return a}}});c.fn.ellipsisTooltip=function(a){return c.ellipsisTooltip.checkIfPossible()?this.each(function(){(new c.ellipsisTooltip(a)).processNode(this)}):this}})(window.jq||window.jQuery);
(function(c){function a(d){return d?null!=b[d]?(R9.utils.log("Duplicate instance creation was attempted. ID -\x3e ",d),d=++p,null==b[d]?d:a()):d:(d=++p,null==b[d]?d:a())}var b={},e={},g={},f=null,p=0;R9.extend({ViewState:function(d,c){this.instanceId=a(d);this.setOptions(c);this.lastURLViewState=this.options.currentUrlState;b[this.instanceId]=this}});R9.extend("ViewState",{getInstance:function(d,c){if(!d&&!c||"object"==typeof d&&!c)f=f||a();var q=f||d;null!=f&&(c=d);null==b[q]?b[q]=new R9.ViewState(q,
c||{}):null!=c&&b[q].setOptions(c);return b[q]},getStateString:function(d){return R9.ViewState.getInstance(d).getStateString()},saveState:function(d,a){return R9.ViewState.getInstance(a).saveState(!1,d)},getUrlStateString:function(d){return this.getInstance(d).getUrlStateString()},isPageReloadState:function(){return!0},isLegacyLocationURL:function(){return 0<=window.location.pathname.indexOf("/r/")}});R9.extend("ViewState.prototype",{instanceId:null,lastURLViewState:"",options:{currentUrlState:"",
stateDelimiter:";",vertical:null,searchBaseUrl:null,urlStateRequestKey:"urlViewState",saving:{url:"/s/sparkle",searchIdKey:"searchid",searchType:"type",requestType:"POST",dataType:"json",actionKey:"action",actionValue:"viewState",ignoreWindowScrollPositionOnce:!1,requestKey:"viewState",resetValue:"RESET"},viewStatesKeys:{windowScroll:"ws",clickedResultIdListKey:"t",lastClickedResultIdKey:"lt",hotelDetailsOpenedIndex:"hdoix",hotelDetailsOpenedId:"hdoid",hotelDetailsOpenedTab:"hdot",hotelMiniDetailsOpenedId:"hmdoid",
hotelMiniDetailsOpenedTab:"hmdot",hotelMiniDetailsOpenedIdPage:"hmdoip",hotelMapFilterOpenedId:"hmfoid",showLayoverFilter:"lay",resultPageNumber:"pn",showMatrix:"mtx",showPlusMinusThree:"fflx",flightMatrixGridRawVisible:"fmgr",mapViewPortCenter:"mvpc",mapZoomLevel:"mzl",landingTimeSliders:"lts",flightDetailsOpenedIndexes:"fodi",carDetailsOpenedIndexes:"codi",carClassGroupsFiltered:"ccids",hotelMapMiniDetailsId:"hmmd",multiCityFlightFilterLeg:"mcleg",chosenDepartureId:"cdid",chosenReturnId:"crid",
activeDestinationAirport:"frdest"},urlViewStateKeys:{resultViewMode:"vw",mapTypeId:"mtid"},noPushState:!1},setOptions:function(d){this.options=c.extend(!0,{},this.options,d||{})},add:function(d,a){null==e[this.instanceId]&&(e[this.instanceId]={});d?e[this.instanceId][d]=a:R9.utils.log("State name cannot be empty: ",d);return this},addUrlState:function(d,a){null==g[this.instanceId]&&(g[this.instanceId]={});d?g[this.instanceId][d]=a:R9.utils.log("State name cannot be empty: ",d);return this},get:function(d){if(d){if(null!=
e[this.instanceId]&&null!=e[this.instanceId][d])return e[this.instanceId][d];if(null!=g[this.instanceId]&&null!=g[this.instanceId][d])return g[this.instanceId][d]}return null},remove:function(d){d&&null!=e[this.instanceId]&&null!=e[this.instanceId][d]&&delete e[this.instanceId][d];d&&null!=g[this.instanceId]&&null!=g[this.instanceId][d]&&delete g[this.instanceId][d];return this},restore:function(d){try{"string"==typeof d&&(d=c.parseJSON(d)),"object"==typeof e[this.instanceId]?c.extend(e[this.instanceId],
d):e[this.instanceId]=d}catch(q){R9.utils.log("Failed to parse JSON string: ",q)}return this},restoreUrlStates:function(d){try{"string"==typeof d&&(d=c.parseJSON(d)),g[this.instanceId]=d}catch(q){R9.utils.log("Failed to parse JSON string: ",q)}return this},reset:function(){e[this.instanceId]=null;return this},getStateString:function(){this.refreshRequiredViewStates();var d=c.extend({},g[this.instanceId]||{},e[this.instanceId]||{});c.isArray(d.ws)||"undefined"===typeof d.ws||delete d.ws;return m.stringify(d)},
getUrlStateString:function(){return this.options.currentUrlState},saveState:function(d,a){var b={};b[this.options.saving.actionKey]=this.options.saving.actionValue;b[this.options.saving.searchIdKey]=window.SearchID;b[this.options.saving.searchType]=R9.globals.vertical;b[this.options.saving.requestKey]=this.getStateString();var f=this;c.ajax(this.options.saving.url,{type:this.options.saving.requestType,dataType:this.options.saving.dataType,data:b,success:function(b){b&&0<parseInt(b.status,10)&&(f.restoreUrlStates(b.stateValues),
f.updateUrlState(b.state));(d||1==parseInt(b.reset,10))&&f.reset();"function"==typeof a&&a()},error:function(){}});return this},updateUrlState:function(d){if(!this.options.vertical||!this.options.searchBaseUrl&&!R9.ViewState.isLegacyLocationURL()||this.lastURLViewState==d)return this;this.options.currentUrlState=d;if(this._handleLegacyURLUpdate(d))return this;this.lastURLViewState=d;d=this.options.searchBaseUrl||"";var a=this.getUrlStateString();a&&(d+=this.options.stateDelimiter+a);var a=window.location.pathname.indexOf("/"+
this.options.vertical),b=window.location.hash.indexOf("/"+this.options.vertical);if(0>a&&0>b)return this;R9.ViewState.isPageReloadState()&&(d="/"+this.options.vertical+"/"+d,R9.Tabs&&R9.Tabs.SearchTabs?(R9.Tabs.SearchTabs.changeCurrentTabUrl(d),void 0!==history.pushState?history.replaceState(history.state,document.title,d):R9App.AppInstance.updateBrowserLocationWithoutNavigation(d)):window.location.pathname=d);return this},refreshRequiredViewStates:function(){if(this.options.saving.ignoreWindowScrollPositionOnce)return this.options.saving.ignoreWindowScrollPositionOnce=
!1,this;this.add(this.options.viewStatesKeys.windowScroll,[this.getScrollPositionHorizontalWindow(),this.getScrollPositionVerticalWindow()]);return this},getScrollPositionHorizontal:function(d){return c(d).length?c(d).get(0).scrollLeft:0},getScrollPositionVertical:function(d){return c(d).length?c(d).get(0).scrollTop:0},getScrollPositionHorizontalWindow:function(){return window.scrollX||window.pageXOffset||0},getScrollPositionVerticalWindow:function(){return window.scrollY||window.pageYOffset||0},
addResultClicked:function(d){value=this.getNormalizedIntegerValue(d);if(0<=value){this.add(this.options.viewStatesKeys.lastClickedResultIdKey,value);var a=c.isArray(this.get(this.options.viewStatesKeys.clickedResultIdListKey))?this.get(this.options.viewStatesKeys.clickedResultIdListKey):[];0>c.inArray(value,a)&&a.push(value);this.add(this.options.viewStatesKeys.clickedResultIdListKey,a);d=c("#tbd"+d);d.parent().children(".lastclicked").removeClass("lastclicked");d.addClass("clicked lastclicked")}return this},
addHotelDetailsOpenedValues:function(d,a,b){d=this.getNormalizedIntegerValue(d);this.addResultClicked(d);this.add(this.options.viewStatesKeys.hotelDetailsOpenedIndex,d);a=this.getNormalizedIntegerValue(a);0<=a&&(this.add(this.options.viewStatesKeys.hotelDetailsOpenedId,a),this.addHotelDetailsOpenTabValue(b));return this},addHotelDetailsOpenTabValue:function(a){this.add(this.options.viewStatesKeys.hotelDetailsOpenedTab,a);return this},addHotelMiniDetailsOpenedValues:function(a,b,c){a=this.getNormalizedIntegerValue(a);
this.addResultClicked(a);this.add(this.options.viewStatesKeys.hotelDetailsOpenedIndex,a);b=this.getNormalizedIntegerValue(b);0<=b&&(a=this.get(this.options.viewStatesKeys.hotelMiniDetailsOpenedIdPage)||{},a[b]=c,this.add(this.options.viewStatesKeys.hotelMiniDetailsOpenedIdPage,a));return this},getHotelMiniDetailsOpened:function(){return this.get(this.options.viewStatesKeys.hotelMiniDetailsOpenedIdPage)},removeHotelMiniDetailsOpenedValues:function(){this.remove(this.options.viewStatesKeys.hotelMiniDetailsOpenedIdPage);
return this},removeSingleHotelMiniDetailsOpenedValues:function(a){a=this.getNormalizedIntegerValue(a);if(0<=a){var d=this.get(this.options.viewStatesKeys.hotelMiniDetailsOpenedIdPage)||{};null!=d[a]&&delete d[a];this.add(this.options.viewStatesKeys.hotelMiniDetailsOpenedIdPage,d)}return this},removeHotelDetailsOpenedValues:function(){this.remove(this.options.viewStatesKeys.hotelDetailsOpenedId);this.remove(this.options.viewStatesKeys.hotelDetailsOpenedTab);return this},addResultViewModeValue:function(a,
b){this.addUrlState(this.options.urlViewStateKeys.resultViewMode,a);this.options.noPushState=b;return this},addActiveDestinationAirport:function(a){this.add(this.options.viewStatesKeys.activeDestinationAirport,a);return this},addResultPageNumber:function(a){a=parseInt(a,10);a=isNaN(a)||0>=a?0:a-1;this.add(this.options.viewStatesKeys.resultPageNumber,a);this.resetViewStatesOnPageChange();return this},resetViewStatesOnPageChange:function(){this.resetOpenedFlightDetails();this.resetOpenedCarDetails();
return this},resetViewStatesOnFilters:function(){this.addResultPageNumber(0);this.resetOpenedFlightDetails();this.resetOpenedCarDetails();return this},resetViewStatesOnSort:function(){this.addResultPageNumber(0);this.resetOpenedFlightDetails();this.resetOpenedCarDetails();return this},addMapTypeId:function(a){this.addUrlState(this.options.urlViewStateKeys.mapTypeId,a);return this},addMapCenterPoint:function(a,b){null!=a&&null!=b&&this.add(this.options.viewStatesKeys.mapViewPortCenter,{lat:a,lng:b});
return this},addMapZoomLevel:function(a){a&&this.add(this.options.viewStatesKeys.mapZoomLevel,a);return this},addToOpenedDetailsList:function(a,b){b=this.getNormalizedIntegerValue(b);if(!(0>b)){var d=c.isArray(this.get(a))?this.get(a):[];0>c.inArray(b,d)&&(d.push(b),this.addResultClicked(b));var f=-1*b;for(b=0;b<d.length;b++)if(1/d[b]===1/f){d.splice(b,1);break}this.add(a,d);return this}},removeFromOpenedDetailsList:function(a,b){b=this.getNormalizedIntegerValue(b);if(!(0>b)){var d,f=c.isArray(this.get(a))?
this.get(a):[];for(d=0;d<f.length;d++)if(f[d]==b){f.splice(d,1);break}b*=-1;0>c.inArray(b,f)&&f.push(b);this.add(a,f);return this}},resetOpenedDetailsList:function(a){this.add(a,this.options.saving.resetValue);return this},addOpenedFlightDetails:function(a){return this.addToOpenedDetailsList(this.options.viewStatesKeys.flightDetailsOpenedIndexes,a)},removeOpenedFlightDetails:function(a){return this.removeFromOpenedDetailsList(this.options.viewStatesKeys.flightDetailsOpenedIndexes,a)},resetOpenedFlightDetails:function(){return this.resetOpenedDetailsList(this.options.viewStatesKeys.flightDetailsOpenedIndexes)},
addOpenedCarDetails:function(a){return this.addToOpenedDetailsList(this.options.viewStatesKeys.carDetailsOpenedIndexes,a)},addCarClassGroupsFiltered:function(a){return this.add(this.options.viewStatesKeys.carClassGroupsFiltered,a)},resetCarClassGroupsFiltered:function(){return this.addCarClassGroupsFiltered("")},removeOpenedCarDetails:function(a){return this.removeFromOpenedDetailsList(this.options.viewStatesKeys.carDetailsOpenedIndexes,a)},resetOpenedCarDetails:function(){return this.resetOpenedDetailsList(this.options.viewStatesKeys.carDetailsOpenedIndexes)},
addHotelMapMiniDetailsId:function(a){a=this.getNormalizedIntegerValue(a);0<=a&&this.add(this.options.viewStatesKeys.hotelMapMiniDetailsId,a);return this},removeHotelMapMiniDetailsId:function(){this.add(this.options.viewStatesKeys.hotelMapMiniDetailsId,-1);return this},addFlightLayoverAirportsState:function(a){"undefined"==typeof a&&(a=!0);this.add(this.options.viewStatesKeys.showLayoverFilter,a);return this},addFlightMultiCityFilterLegState:function(a){"undefined"!=typeof a&&this.add(this.options.viewStatesKeys.multiCityFlightFilterLeg,
a);return this},setIsAirlineFilterInAirlineView:function(a){"undefined"!=typeof a&&this.add(this.options.viewStatesKeys.airlineFilterIsAirlineView,a);return this},addFlightLandingTimeSlidersFilterState:function(a){"undefined"==typeof a&&(a=!0);this.add(this.options.viewStatesKeys.landingTimeSliders,a);return this},addShowMatrixViewState:function(a){"undefined"==typeof a&&(a=!1);this.add(this.options.viewStatesKeys.showMatrix,a);return this},addShowPlusMinusThreeViewState:function(a){"undefined"==
typeof a&&(a=!1);this.add(this.options.viewStatesKeys.showPlusMinusThree,a);return this},addflightMatrixGridRawVisibleState:function(a){"undefined"==typeof a&&(a=-1);this.add(this.options.viewStatesKeys.flightMatrixGridRawVisible,a);return this},setIgnoreWindowScrollPositionOnce:function(){this.options.saving.ignoreWindowScrollPositionOnce=!0;return this},getNormalizedIntegerValue:function(a){a=parseInt(a,10);"number"!=typeof a&&(a=-1);return a},addHotelMapFilterOpenedId:function(a){this.add(this.options.viewStatesKeys.hotelMapFilterOpenedId,
a);return this},removeHotelMapFilterOpenedId:function(a){this.get(this.options.viewStatesKeys.hotelMapFilterOpenedId)==a&&this.add(this.options.viewStatesKeys.hotelMapFilterOpenedId,"none_opened");return this},_handleLegacyURLUpdate:function(a){if(!R9.ViewState.isLegacyLocationURL())return!1;var b=window.location.pathname,d=b.indexOf(this.options.stateDelimiter+this.lastURLViewState);0<=d&&(b=b.substring(0,d));if(!a)return window.location.pathname=b,!0;a="";(d=this.getUrlStateString())&&(a+=this.options.stateDelimiter+
d);window.location.pathname=b+a;return!0},addChosenDepartureId:function(a){"undefined"!=typeof a&&this.add(this.options.viewStatesKeys.chosenDepartureId,a);return this},addChosenReturnId:function(a){"undefined"!=typeof a&&this.add(this.options.viewStatesKeys.chosenReturnId,a);return this},removeChosenDepartureId:function(){this.add(this.options.viewStatesKeys.chosenDepartureId,"RESET");return this},removeChosenReturnId:function(){this.add(this.options.viewStatesKeys.chosenReturnId,"RESET");return this}});
var m=window.JSON;"undefined"===typeof m&&(m={});"undefined"===typeof m.stringify&&c.extend(m,{stringify:function(a){var b=[];switch(typeof a){case "string":return'"'+a.replace(/(["\\\/\b\f\n\r\t]{1})/g,"{1}")+'"';case "number":case "boolean":return a.toString();case "undefined":return"undefined";case "object":if(c.isArray(a)){for(var d=0;d<a.length;d++)b.push(m.stringify(a[d]));return"["+b.join(",")+"]"}if(null==a)return"null";for(d in a)a.hasOwnProperty(d)&&b.push('"'+d.toString()+'":'+m.stringify(a[d]));
return"{"+b.join(",")+"}"}return""}})})(jq||jQuery);
(function(c){function a(a,c,g,f){f.garbageCollectorInterval||(f.garbageCollectorInterval=setInterval(function(){var a=(new Date).getTime(),b;for(b in f.cache)f.cache.hasOwnProperty(b)&&a-f.cache[b].timeCreated>=f.cache[b].lifeSpam&&delete f.cache[f.orderedKeys.splice(f.orderedKeys.indexOf(b),1)[0]];0==f.orderedKeys.length&&clearInterval(f.garbageCollectorInterval)},f.garbageCollectionTime));g=g||f.defaultLifeSpam;g>f.maxLifeSpam&&(g=f.maxLifeSpam);f.orderedKeys.length>=f.maxCacheEntrySize&&delete f.cache[f.orderedKeys.splice(0,
1)[0]];f.cache[a]?(f.cache[a].value=c,f.cache[a].timeCreated=(new Date).getTime(),f.cache[a].lifeSpam=g,f.orderedKeys.push(f.orderedKeys.splice(f.orderedKeys.indexOf(a),1))):(f.cache[a]={value:c,timeCreated:(new Date).getTime(),lifeSpam:g},f.orderedKeys.push(a))}R9.extend("Common",{Cache:function(b){var e=c.extend({},this.options,b,{cache:{},orderedKeys:[],garbageCollectorInterval:null});c.extend(this,{get:function(a){a=e.cache[a]?e.cache[a].value:void 0;return a},set:function(b,c,p){a(b,c,p,e)},
getKeys:function(){var a=[];for(key in e.cache)a.push(key);return a}})}});R9.extend("Common.Cache.prototype",{options:{maxLifeSpam:9E5,defaultLifeSpam:6E4,garbageCollectionTime:3E4,maxCacheEntrySize:15},get:function(){},set:function(){}})})(jq||jQuery);
R9.extend("Common.Patterns",{Observable:function(){var c=[];jq.extend(this,{registerListener:function(a,b,e,g){a=a||"default";!c[a]&&(c[a]=[]);jq.each(c[a],function(b,g){g.callback===e&&c[a].splice(g,1)});c[a].push({id:b,callback:e,scope:g})},registerListeners:function(a){var b=this;jq.each(a,function(a,c){b.registerListener.apply(b,c)})},notifyListeners:function(a,b,e){a=a||"default";jq.each(c[a]||[],function(c,f){f&&f.scope?f.callback.call(f.scope,a,b,e):f&&f.callback(a,b,e)})},unregisterListener:function(a,
b){a=a||"default";c[a]&&jq.each(c[a],function(e,g){g.callback===b&&c[a].splice(g,1)})},unregisterListeners:function(a){var b=this;jq.each(a,function(a,c){b.unregisterListener.apply(b,c)})},unregisterAllListeners:function(){this.unregisterListeners(c)}})}});R9.extend("Common.Patterns.Observable.prototype",{registerListener:function(){},notifyListeners:function(){},unregisterListener:function(){}});
R9.extend("Common.Patterns",{Factory:function(){var c={};return{registerProduct:function(a,b){c[a]=b;c[a].registry=new R9.Common.Cache({maxLifeSpam:9E5,defaultLifeSpam:3E5,garbageCollectionTime:3E4,maxCacheEntrySize:20})},newInstance:function(a,b){return c[a].createProduct.apply(c[a],b)}}}});R9.extend("Common.Patterns.MVC",{Model:function(){return new R9.Common.Patterns.Observable}});R9.extend("Common.Patterns.MVC",{View:function(){R9.Common.Patterns.Observable.apply(this,arguments)}});
R9.extend("Common.Patterns.MVC.View.prototype",jq.extend(!0,{},R9.Common.Patterns.Observable.prototype,{initialize:function(){},destroy:function(){}}));R9.extend("Common.Patterns.MVC",{Controller:function(){return new R9.Common.Patterns.Observable}});
R9.extend("Common.Communication",{ServerRequestService:function(){function c(a,b,c){jq.ajax({url:c,data:{id:a,searchtype:window.SearchType},dataType:"json"}).done(b)}var a,b=new R9.Common.Cache({maxLifeSpam:9E5,defaultLifeSpam:3E5,garbageCollectionTime:3E4,maxCacheEntrySize:20}),e={cluster:function(a,b,c,d,e,g){a={searchid:a,action:"cluster",ne:b.toUrlValue(),sw:c.toUrlValue(),zoom:d,r:e,callback:g};window.ssUserAction||(window.ssUserAction=window.parent.ssUserAction);ssUserAction("cluster",function(){},
a)},getHotelPhotos:function(a,c,e,d){var f="/h/run/hotel/photos?hid\x3d"+a;c&&(f+="\x26width\x3d"+c);e&&(f+="\x26height\x3d"+e);var g=b.get(f);g?setTimeout(function(){d(jq.parseJSON(g))},0):jq.ajax({url:f}).done(function(a){b.set(f,a);d(jq.parseJSON(a))})},addFavorite:function(a,b){c(a,b,"/favorites/add")},removeFavorite:function(a,b){c(a,b,"/favorites/remove")},setRecentlyViewedHotel:function(a,b){var c={action:"setRecentlyViewedHotel",hid:a};setTimeout(function(){ssUserAction("setRecentlyViewed",
b,c)},0)},getPlaceDetails:function(c,e,g){var d=c.reference,f=b.get(d);f?setTimeout(function(){g(f)},0):(!a&&(a=new google.maps.places.PlacesService(e)),a.getDetails({reference:d},function(a){b.set(d,a);g(a)}))},updateXSell:function(a,b,c,d,e,g){a={ctid:a,checkIn:b,checkOut:c,guests:d,tabType:R9.globals.vertical};e&&(a.originCode=e);g&&(a.destinationCode=g);(new R9.Ajax("/s/run/fd/xsell/common",{data:a})).execute()},updateXSellByForm:function(a){(new R9.Ajax("/s/run/fd/xsell/"+a.tab.value,{data:jq(a).serialize(),
type:"POST"})).execute()}};if(R9.Common.Places&&window.google&&google.maps&&google.maps.places){var g={};jq.each(R9.Common.Places,function(b,c){g["poll"+b.camelizeUpper()]=function(f,d,e){!a&&(a=new google.maps.places.PlacesService(d));R9.Analytics.api.trackEvent("placesService/search/core");a.search({location:f.getLocation().googleLatLon,radius:600,types:c},function(a,d){d===google.maps.places.PlacesServiceStatus.OK?g[b]=a:jq.extend(g,{success:!1,error:d});e(g)});var g={success:!0}}});jq.extend(e,
g)}return e}()});
R9.extend("Common.Model",{Hotel:function(){return function(c){var a=R9.Common.Patterns.MVC.Model(),b={};jq.extend(a,{registerPropertyUpdatedListener:function(c,g){if(void 0===b[c]){var f={};f[c]=void 0;a.update(f)}b[c].registerListener(R9.Common.Model.HotelProperty.Events.PROPERTY_UPDATED,"propertyUpdated",g)},unregisterPropertyUpdatedListener:function(a,c){b[a]&&b[a].unregisterListener(R9.Common.Model.HotelProperty.Events.PROPERTY_UPDATED,c)},update:function(c){function g(){return{googleLatLon:new google.maps.LatLng(c.lat,c.lon)}}
var e=void 0;c.id&&(a.id=c.id);c.location&&(a.location=c.location);window.google&&c.lat&&c.lon&&(e=g(),a.location=e);jq.each(c,function(c,e){b[c]||(b[c]=R9.Common.Model.HotelProperty(c),b[c].hotel=a,a["get"+c.camelizeUpper()]=function(){return b[c].getValue()},a["set"+c.camelizeUpper()]=function(a){b[c].setValue(a)});b[c].setValue(e)});!a.getLocation&&(a.getLocation=function(){window.google&&void 0===e&&(e=g());return e});a.notifyListeners(R9.Common.Model.Hotel.Events.HOTEL_UPDATED,a,{data:c})}});
if(R9.Common.Places&&window.google&&google.maps&&google.maps.places){var e=0,g={};jq.each(R9.Common.Places,function(b,c){g["poll"+b.camelizeUpper()]=function(c,d){function g(a){return{id:a.id,name:a.name,reference:a.reference,location:{googleLatLon:a.geometry.location},getLocation:function(){return this.location}}}e++;R9.Common.Communication.ServerRequestService["poll"+b.camelizeUpper()](a,c.getGMap(),function(c){if(c.success||c.error&&"ZERO_RESULTS"===c.error){var e={};e[b]=e[b]||[];jq.each(c[b]||
[],function(a,c){e[b].push(g(c))});a.update(e);d&&d()}})}});jq.extend(a,g)}a.update(c);return a}}()});R9.Common.Model.Hotel.Events={HOTEL_UPDATED:"hotelUpdated"};
R9.extend("Common.Model",{HotelList:function(){var c;return function(){if(c)return c;c=R9.Common.Patterns.MVC.Model();var a={},b=[],e=[];jq.extend(c,{add:function(g){a[g.id]=g;g.getStars&&(!b[g.getStars()]&&(b[g.getStars()]=[]),b[g.getStars()].push(g));g.getIndex&&g.getIndex()&&(e[g.getIndex()]=g);c.notifyListeners(R9.Common.Model.HotelList.Events.HOTEL_ADDED,c,{hotel:g})},hotelsByStars:function(a){return b[a]},getHotelById:function(b){return a[b]},clear:function(){a={};b=[]},list:function(){var b=
[],c;for(c in a)b.push(a[c]);return b},addFromSearchResult:function(b){jq.each(b,function(b,g){g.defaultSortIdx=b;var f=a[g.id];f?f.update(g):(f=R9.Common.Model.Hotel(g),c.add(f));e[b]=f})},getHotelByDefaultSortIdx:function(a){return e[a]}});return c}}()});R9.Common.Model.HotelList.Events={HOTEL_ADDED:"hotelAdded"};R9.Common.Model.Landmark=R9.Common.Model.Hotel;R9.Common.Model.LandmarkList=R9.Common.Model.HotelList;
R9.extend("Common.Model",{HotelProperty:function(c){var a,b=R9.Common.Patterns.MVC.Model();jq.extend(b,{setValue:function(c){a=c;b.notifyListeners(R9.Common.Model.HotelProperty.Events.PROPERTY_UPDATED,b,{value:c})},getValue:function(){return a}});return b}});R9.Common.Model.HotelProperty.Events={PROPERTY_UPDATED:"propertyUpdated"};R9.extend("Common.Widgets.Maps",{});
R9.extend("Common.Widgets.Maps",{Map:function(){return function(c){function a(){h.mapTypeControl&&h.mapTypeListen&&google.maps.event.addListener(l,"maptypeid_changed",b);google.maps.event.addListener(l,"zoom_changed",q);B=google.maps.event.addListener(l,R9.Common.Widgets.Maps.Map.Events.MAP_TILES_LOADED,f);google.maps.event.addListener(l,R9.Common.Widgets.Maps.Map.Events.MAP_DRAG_END,function(){k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MAP_DRAG_END,k,{})});google.maps.event.addListener(l,
R9.Common.Widgets.Maps.Map.Events.MAP_CLICK,function(){k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MAP_CLICK,k,{})})}function b(){h.mapTypeListen?l.getMapTypeId()==google.maps.MapTypeId.ROADMAP?e():R9.ViewState.getInstance().addMapTypeId(l.getMapTypeId()).saveState():e()}function e(a,b){l.getStyle=function(){return null==b?h.mapStyle:b};l.mapTypes.set(null==a?"mapType":a,null==b?h.mapStyle.getGoogleStyle():b.getGoogleStyle());l.setMapTypeId(a||"mapType")}function g(){google.maps.event.addListener(l,
"tilesloaded",function(){v.find("img").attr("nopin","nopin")})}function f(){function a(){k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.STREET_VIEW_SET,k,{});google.maps.event.removeListener(A);C=google.maps.event.addListener(d,"closeclick",b)}function b(){k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.STREET_VIEW_UNSET,k,{});A=google.maps.event.addListener(d,"visible_changed",a);google.maps.event.removeListener(C)}function c(){var a={strokeColor:"#000000",strokeOpacity:.05,strokeWeight:1,
fillColor:"#000000",fillOpacity:0,map:l,bounds:l.getBounds()};e.setOptions(a)}google.maps.event.removeListener(B);g();h.hideMarkersOnRefresh?google.maps.event.addListener(l,R9.Common.Widgets.Maps.Map.Events.MAP_IDLE,function(){$(".map.topAttractionsMap .marker").hide();setTimeout(function(){w();$(".map.topAttractionsMap .marker").show();h.delay=0},h.delay)}):google.maps.event.addListener(l,"dragend",function(){w()});h.zoom=l.getZoom();var d=l.getStreetView();A=google.maps.event.addListener(d,"visible_changed",
a);k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MAP_INITIALIZED,k,{});var e=new google.maps.Rectangle;google.maps.event.addListener(l,"center_changed",c);google.maps.event.addListener(l,R9.Common.Widgets.Maps.Map.Events.MAP_IDLE,function(){k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MAP_IDLE,k,{})});c()}function p(a,b,c){1<c.marker.getMarkers().length?k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.CLUSTER_CLICKED,k,{cluster:c.marker}):k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MARKER_CLICKED,
k,{marker:c.marker.getMarkers()[0]})}function m(a,b,c){1<c.marker.getMarkers().length?k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.CLUSTER_OVER,k,{cluster:c.marker}):k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MARKER_OVER,k,{marker:c.marker.getMarkers()[0]})}function d(a,b,c){1<c.marker.getMarkers().length?k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.CLUSTER_OUT,k,{cluster:c.marker}):k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MARKER_OUT,k,{marker:c.marker.getMarkers()[0]})}
function q(){function a(){k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.ZOOM_CHANGED,k,{oldZoom:h.zoom,zoom:b});google.maps.event.removeListener(d);w()}var b=l.getZoom();if(!(20<b||b<t.minZoom)){var c=h.zoom;h.zoom=b;var d;c!=b&&(h.cluster?h.serverClustering?k.markerManager.refresh():k.markerManager.removeAll():(c=k.getMarkers(),k.removeAllMarkers(),k.addMarkers(c)),d=google.maps.event.addListener(l,"tilesloaded",a))}}function w(){if(h.cluster)if(h.serverClustering){if(window.searchid&&Streaming&&
Streaming.done){var a,b,c=l.getZoom();if(h.serverClusteringBoundsAdjustZoom&&c<=h.serverClusteringBoundsAdjustZoom)b=new google.maps.LatLng(89.999999,179.999999),a=new google.maps.LatLng(-89.999999,-179.999999),c=1;else{if(h.serverClusteringBoundsExtended){b=new google.maps.LatLngBounds(l.getBounds().getSouthWest(),l.getBounds().getNorthEast());a=r.getProjection();var d=new google.maps.LatLng(b.getNorthEast().lat(),b.getNorthEast().lng()),e=new google.maps.LatLng(b.getSouthWest().lat(),b.getSouthWest().lng()),
d=a.fromLatLngToDivPixel(d);d.x+=512;d.y-=512;e=a.fromLatLngToDivPixel(e);e.x-=512;e.y+=512;d=a.fromDivPixelToLatLng(d);a=a.fromDivPixelToLatLng(e);b.extend(d);b.extend(a);a=b}else a=l.getBounds();b=a.getNorthEast();a=a.getSouthWest()}e="";0<h.serverClusteringCallbackName.length&&(e=h.serverClusteringCallbackName);R9.Common.Communication.ServerRequestService.cluster(window.searchid,b,a,c,h.serverClusteringRadius,e)}}else x.redraw(),k.markerManager.removeAll(),k.markerManager.addMarkers(x.getClusters());
else k.markerManager.refresh()}function n(a,b){function c(a,c){a+='\x3ctable BORDER CELLSPACING\x3d"5"\x3e';a+="\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3eFeature type\x3c/td\x3e\x3ctd\x3eElement type\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e";b.each(R9.Common.Widgets.Maps.Styles[c].getGoogleStyle().styles,function(b,c){a+="\x3ctr\x3e\x3ctd\x3e \x3c/td\x3e\x3ctd\x3e"+c.featureType+"\x3c/td\x3e\x3ctd\x3e"+c.elementType+'\x3c/td\x3e\x3ctd\x3e\x3cinput class\x3d"stylelist_edit" type\x3d"submit" value\x3d"edit" data-index\x3d"'+
b+'"/\x3e\x3cinput class\x3d"stylelist_delete" type\x3d"submit" value\x3d"delete" data-index\x3d"'+b+'"/\x3e\x3c/td\x3e\x3c/tr\x3e'});return a+="\x3c/table\x3e"}function d(a,c,d){a+='\x3cselect id\x3d"'+d+'"\x3e';b.each(c,function(b,c){a+='\x3coption title\x3d"'+c.desc+'" value\x3d"'+c.name+'"\x3e'+c.name+"\x3c/option\x3e"});return a+="\x3c/select\x3e"}function g(){var a=r.find("#stylepicker_list").val();e(a,{getGoogleStyle:function(){return new google.maps.StyledMapType(n,{name:a})}})}function f(a,
c){a+='\x3cdiv style\x3d"padding-bottom:10px;font-weight: bold"\x3eRule editor\x3c/div\x3e';a+='\x3cdiv style\x3d"padding-bottom:10px;"\x3eFeature Type: ';a=d(a,l,"styleeditor_feature_type");a+='\x3c/div\x3e\x3cdiv style\x3d"padding-bottom:20px;"\x3eElement Type: ';a=d(a,y,"styleeditor_element_type");a+='\x3c/div\x3e\x3cdiv style\x3d""\x3e\x3ctable BORDER CELLSPACING\x3d"5"\x3e';a+="\x3ctr\x3e\x3ctd\x3eType\x3c/td\x3e\x3ctd\x3eValue\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e";c&&b.each(c.stylers,
function(c,d){b.each(d,function(b,d){a+="\x3ctr\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd\x3e\x3cinput class\x3d"styleeditor_delete" type\x3d"submit" value\x3d"delete" data-index\x3d"'+c+'"/\x3e\x3c/td\x3e\x3c/tr\x3e'})});a+="\x3ctr\x3e\x3ctd\x3e"+d("",t,"styleeditor_styler_type")+'\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"styleeditor_styler_value" type\x3d"text" value\x3d"" /\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"styleeditor_add" type\x3d"submit" value\x3d"add" /\x3e\x3c/td\x3e\x3c/tr\x3e';
return a+='\x3c/table\x3e \x3cbr\x3e\x3cbr\x3e \x3cinput id\x3d"styleeditor_save" type\x3d"submit" value\x3d"Save" /\x3e'}function h(a){var c=!1;a||(a={stylers:[]},c=!0);m.html(f("",a));b("#styleeditor_feature_type").val(a.featureType);b("#styleeditor_element_type").val(a.elementType);b(".styleeditor_delete").on("click",function(){var c=b(this).data("index");a.stylers.splice(c,1);h(a)});b("#styleeditor_add").on("click",function(){var d=b("#styleeditor_styler_type").val(),e=b("#styleeditor_styler_value").val(),
f=!0;b.each(a.stylers,function(a,b){b[d]&&(b[d]=e,f=!1)});if(f){var l={};l[d]=e;a.stylers.push(l)}c&&(a.featureType=b("#styleeditor_feature_type").val(),a.elementType=b("#styleeditor_element_type").val(),n.push(a),g(),k());h(a)});b("#styleeditor_save").on("click",function(){a.featureType=b("#styleeditor_feature_type").val();a.elementType=b("#styleeditor_element_type").val();c&&n.push(a);h(null);g();k()})}function k(){var a=r.find("#stylepicker_list").val();n=R9.Common.Widgets.Maps.Styles[a].getGoogleStyle().styles;
p.html(c("",a));p.find(".stylelist_edit").on("click",function(){var a=b(this).data("index");n&&h(n[a])});p.find(".stylelist_delete").on("click",function(){var a=b(this).data("index");n&&(n.splice(a,1),k());g()})}var l=[{name:"administrative",desc:"Apply the rule to administrative areas."},{name:"administrative.country",desc:"Apply the rule to countries."},{name:"administrative.land_parcel",desc:"Apply the rule to land parcels."},{name:"administrative.locality",desc:"Apply the rule to localities."},
{name:"administrative.neighborhood",desc:"Apply the rule to neighborhoods."},{name:"administrative.province",desc:"Apply the rule to provinces."},{name:"all",desc:"Apply the rule to all selector types."},{name:"landscape",desc:"Apply the rule to landscapes."},{name:"landscape.man_made",desc:"Apply the rule to man made structures."},{name:"landscape.natural",desc:"Apply the rule to natural features."},{name:"landscape.natural.landcover",desc:"Apply the rule to landcover."},{name:"landscape.natural.terrain",
desc:"Apply the rule to terrain."},{name:"poi",desc:"Apply the rule to points of interest."},{name:"poi.attraction",desc:"Apply the rule to attractions for tourists."},{name:"poi.business",desc:"Apply the rule to businesses."},{name:"poi.government",desc:"Apply the rule to government buildings."},{name:"poi.medical",desc:"Apply the rule to emergency services (hospitals, pharmacies, police, doctors, etc)."},{name:"poi.park",desc:"Apply the rule to parks."},{name:"poi.place_of_worship",desc:"Apply the rule to places of worship, such as churches, temples, or mosques."},
{name:"poi.school",desc:"Apply the rule to schools."},{name:"poi.sports_complex",desc:"Apply the rule to sports complexes."},{name:"road",desc:"Apply the rule to all roads."},{name:"road.arterial",desc:"Apply the rule to arterial roads."},{name:"road.highway",desc:"Apply the rule to highways."},{name:"road.highway.controlled_access",desc:"Apply the rule to controlled-access highways."},{name:"road.local",desc:"Apply the rule to local roads."},{name:"transit",desc:"Apply the rule to all transit stations and lines."},
{name:"transit.line",desc:"Apply the rule to transit lines."},{name:"transit.station",desc:"Apply the rule to all transit stations."},{name:"transit.station.airport",desc:"Apply the rule to airports."},{name:"transit.station.bus",desc:"Apply the rule to bus stops."},{name:"transit.station.rail",desc:"Apply the rule to rail stations."},{name:"water",desc:"Apply the rule to bodies of water."}],y=[{name:"all",desc:"Apply the rule to all elements of the specified feature."},{name:"geometry",desc:"Apply the rule to the feature's geometry."},
{name:"geometry.fill",desc:"Apply the rule to the fill of the feature's geometry."},{name:"geometry.stroke",desc:"Apply the rule to the stroke of the feature's geometry."},{name:"labels",desc:"Apply the rule to the feature's labels."},{name:"labels.icon",desc:"Apply the rule to icons within the feature's labels."},{name:"labels.text",desc:"Apply the rule to the text in the feature's label."},{name:"labels.text.fill",desc:"Apply the rule to the fill of the text in the feature's labels."},{name:"labels.text.stroke",
desc:"Apply the rule to the stroke of the text in the feature's labels."}],t=[{name:"color",type:"string",desc:"Sets the color of the feature. Valid values: An RGB hex string, i.e. '#ff0000'."},{name:"gamma",type:"number",desc:"Modifies the gamma by raising the lightness to the given power. Valid values: Floating point numbers, [0.01, 10], with 1.0 representing no change."},{name:"hue",type:"string",desc:"Sets the hue of the feature to match the hue of the color supplied. Note that the saturation and lightness of the feature is conserved, which means that the feature will not match the color supplied exactly. Valid values: An RGB hex string, i.e. '#ff0000'."},
{name:"invert_lightness",type:"boolean",desc:"A value of true will invert the lightness of the feature while preserving the hue and saturation. "},{name:"lightness",type:"number",desc:"Shifts lightness of colors by a percentage of the original value if decreasing and a percentage of the remaining value if increasing. Valid values: [-100, 100]."},{name:"saturation",type:"number",desc:"Shifts the saturation of colors by a percentage of the original value if decreasing and a percentage of the remaining value if increasing. Valid values: [-100, 100]."},
{name:"visibility",type:"string",desc:"Sets the visibility of the feature. Valid values: 'on', 'off' or 'simplified'."},{name:"weight",type:"number",desc:"Sets the weight of the feature, in pixels. Valid values: Integers greater than or equal to zero."}];b("body").append('\x3cdiv id\x3d"style_main" style\x3d"position: fixed; top:0; height: 100%; overflow-y: auto; right: 0;background-color: white;width: 450px;z-index:999999"\x3e\x3cdiv style\x3d"background-color: #000000; color: white;padding:5px;"\x3eKAYAK MAP THEMES \x3ca id\x3d"style_toggle" style\x3d"float:right"\x3etoggle\x3c/a\x3e\x3c/div\x3e\x3cdiv style\x3d"padding:5px;" id\x3d"stylepicker"\x3e\x3c/div\x3e\x3cdiv style\x3d"padding:5px;height: 250px; overflow-y: scroll; " id\x3d"stylelist"\x3e\x3c/div\x3e\x3cdiv style\x3d"padding:5px;background-color: #f4f4f4;" id\x3d"styleeditor"\x3e\x3c/div\x3e\x3c/div\x3e');
var r=b("#stylepicker"),p=b("#stylelist"),m=b("#styleeditor"),n=null;r.html(function(a){a+='\x3cselect id\x3d"stylepicker_list"\x3e';for(var b in R9.Common.Widgets.Maps.Styles)a+='\x3coption value\x3d"'+b+'"\x3e'+b+"\x3c/option\x3e";return a+'\x3c/select\x3e\x3cinput type\x3d"submit" id\x3d"stylepicker_btn" value\x3d"Load style" /\x3e\x3cinput type\x3d"submit" id\x3d"stylepicker_new" value\x3d"Add styling rule" /\x3e\x3cinput type\x3d"submit" id\x3d"stylepicker_export" value\x3d"Export Style" /\x3e'}(""));
r.find("#stylepicker_btn").on("click",function(){k();h();g()});r.find("#stylepicker_new").on("click",function(){var a=r.find("#stylepicker_list").val();n=R9.Common.Widgets.Maps.Styles[a].getGoogleStyle().styles;h()});r.find("#stylepicker_export").on("click",function(){var a="data:text/json;charset\x3dutf-8,"+encodeURI(JSON.stringify(n,null,4)),b=document.createElement("a");b.setAttribute("href",a);b.setAttribute("download","style.json");b.click()});b("#style_toggle").on("click",function(){p.is(":visible")?
(b("#style_main").css("height","auto"),p.hide(),m.hide(),r.hide()):(b("#style_main").css("height","100%"),p.show(),m.show(),r.show())})}var u=R9.config.getString("ui.maps.style","MapPastelStyle"),h=jq.extend({},{cls:"",lat:10.47,lon:-66.87,center:null,zoom:14,height:300,mapStyle:R9.Common.Widgets.Maps.Styles[u],cluster:!1,clientClusteringGridSize:25,clientClusterUseGridOptimization:!1,serverClustering:!1,serverClusteringCallbackName:"",serverClusteringOnDrag:!0,serverClusteringRadius:26,serverClusteringBoundsExtended:!0,
serverClusteringBoundsAdjustZoom:null,mapTypeControl:!0,mapTypeId:"mapType",scrollwheel:!1,minZoom:5,maxZoom:20,mapTypeListen:!0,useMarkerManager:!0,googleMapOptions:null,xOffset:0,yOffset:0,delay:0},c),t={center:h.mapCenter||new google.maps.LatLng(h.lat,h.lon),scrollwheel:h.scrollwheel,zoom:h.zoom,mapTypeId:h.mapTypeId||"mapType",mapTypeControl:h.mapTypeControl,panControl:!1,streetViewControl:!0,scaleControl:!0,minZoom:h.minZoom,maxZoom:h.maxZoom};c.googleMapOptions&&jq.extend(t,c.googleMapOptions);
var l,r,z,B,A,C,x,D="map_"+R9.Common.Utils.getId(),k=new R9.Common.Patterns.Observable,v=jq("\x3cdiv/\x3e",{id:D,"class":h.cls}).css("height",h.height);jq.extend(k,{initialize:function(b){v.appendTo(b);l=new google.maps.Map(document.getElementById(D),t);R9.config.getBoolean("ui.features.map.style.admin",!1)&&n(l,jq);h.cluster&&!h.serverClustering&&(x=new R9.Common.Widgets.Maps.Clusterer(this,[],{clusterConstructor:h.clusterConstructor,gridSize:h.clientClusteringGridSize,useGrid:h.clientClusterUseGridOptimization}));
b=new R9.Common.Widgets.Maps.MarkerManager({map:l,onMarkerClick:p,onMarkerOver:m,onMarkerOut:d});k.markerManager=b;r=new google.maps.OverlayView;r.onAdd=function(){};r.draw=function(){};r.setMap(l);a();e(t.mapTypeId)},setStreetViewControl:function(a){t.streetViewControl=a},setCustomControls:function(a,b){var c=this.getGMap();c&&a&&(b||(b=google.maps.ControlPosition.TOP_LEFT),c.controls[b].push(a))},disableDefaultUI:function(){t.disableDefaultUI=!0},setZoomControlOptions:function(a){t.zoomControlOptions=
a},setMapTypeControlOptions:function(a){t.mapTypeControlOptions=a},hideMapTypeControlOptions:function(){t.mapTypeControl=!1},setHeight:function(a){v.height(a);k.fixDimensions()},fixDimensions:function(){google.maps.event.trigger(l,"resize");clearTimeout(z);z=setTimeout(function(){k.triggerClustering()},1E3)},removeAllMarkers:function(){k.markerManager.removeAll();h.cluster&&!h.serverClustering&&x.removeAllMarkers()},removeMarkerById:function(a){k.markerManager.removeMarkerById(a)},getMarkers:function(){return k.markerManager.markers},
getMarkerById:function(a){return k.markerManager.markers[a]},addMarkers:function(a,b){h.cluster&&!h.serverClustering?(x.setClusterConstructor(b),x.addMarkers(a,!0),x.redraw(),k.markerManager.removeAll(),k.markerManager.addMarkers(x.getClusters())):k.markerManager.addMarkers(a)},calculateZoom:function(a,b,c){idleListener=google.maps.event.addListener(l,"idle",function(){google.maps.event.removeListener(idleListener);var a=l.getCenter();R9.ViewState.getInstance().addMapCenterPoint(a.lat(),a.lng()).addMapZoomLevel(l.getZoom()).saveState();
b&&b()});if(R9.config.getBoolean("ui.better.map.zoom",!1)&&c){var d=new google.maps.LatLng(c.lat,c.lng),e=0,g=0,f=[];jq.each(a,function(a,b){a=new google.maps.LatLng(b.lat,b.lon);var c=google.maps.geometry.spherical.computeDistanceBetween(d,a);f.push({distance:c,marker:b,point:a});g+=c;e++});var h=g/e,k=new google.maps.LatLngBounds;jq.each(f,function(b,c){c.distance<h*(30<a.length?.5:1)&&k.extend(c.point)});l.setCenter(d);l.fitBounds(k)}else if(0!=a.length){var r=-90,n=90,t=-180,p=180,m,y;jq.each(a,
function(a,b){m=b.lat||b.getPosition&&b.getPosition().lat();y=b.lon||b.getPosition&&b.getPosition().lng();m>=r&&(r=m);m<=n&&(n=m);y>=t&&(t=y);y<=p&&(p=y)});c=new google.maps.LatLngBounds(new google.maps.LatLng(n,p),new google.maps.LatLng(r,t));if(0<this.xOffset||0<this.yOffset){var q=Math.pow(2,l.getZoom()),v=c.getSouthWest(),v=l.getProjection().fromLatLngToPoint(v),q=new google.maps.Point(this.xOffset/q||0,this.yOffset/q||0),v=new google.maps.Point(v.x+q.x,v.y+q.y);c.extend(l.getProjection().fromPointToLatLng(v))}l.fitBounds(c);
if(0<this.xOffset||0<this.yOffset)c=l.getProjection().fromLatLngToPoint(latlng),c=new google.maps.Point(c.x-q.x,c.y-q.y),c=l.getProjection().fromPointToLatLng(c),l.setCenter(c)}},centerAt:function(a){null==a||l.getCenter().equals(a.getPosition())||(l.panTo(a.getPosition()),h.hideMarkersOnRefresh?(h.delay=400,k.notifyListeners(R9.Common.Widgets.Maps.Map.Events.MAP_IDLE,k,{})):k.triggerClustering())},centerAtNFC:function(a){l.getCenter().equals(a.getPosition())||l.panTo(a.getPosition())},centerAtLocation:function(a){l.panTo(a);
k.triggerClustering()},panBy:function(a,b){l.panBy(a,b)},getGMap:function(){return l},getZoom:function(){return l.getZoom()},triggerClustering:function(){w()},getProjection:function(){return r.getProjection()}});return k}}()});
R9.Common.Widgets.Maps.Map.Events={CLUSTER_OVER:"clusterOver",CLUSTER_OUT:"clusterOut",CLUSTER_CLICKED:"clusterClicked",MARKER_OVER:"markerOver",MARKER_OUT:"markerOut",MARKER_CLICKED:"markerClicked",ZOOM_CHANGED:"zoomChanged",STREET_VIEW_SET:"streetViewSet",STREET_VIEW_UNSET:"streetViewUnset",MAP_INITIALIZED:"mapInitialized",MAP_DRAG_END:"dragend",MAP_CLICK:"click",MAP_IDLE:"idle",MAP_TILES_LOADED:"tilesloaded"};
(function(c){R9.extend("Common.Widgets.Maps",{MarkerManager:function(a){this.options=c.extend({},this.options,a);R9.Common.Patterns.Observable.apply(this,arguments);this.init()}});R9.extend("Common.Widgets.Maps.MarkerManager.prototype",c.extend(!0,{},R9.Common.Patterns.Observable.prototype,{markers:null,node:null,overlay:null,options:{map:null,onMarkerClick:null,onMarkerOver:null,onMarkerOut:null},init:function(){this.markers={};this.node=jq("\x3cdiv\x3e\x3c/div\x3e");this.overlay=new google.maps.OverlayView;
this.options.onMarkerClick&&this.registerListener(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_CLICKED,"",this.options.onMarkerClick);this.options.onMarkerOver&&this.registerListener(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_OVER,"",this.options.onMarkerOver);this.options.onMarkerOut&&this.registerListener(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_OUT,"",this.options.onMarkerOut);var a=this;this.overlay.onAdd=function(){a.overlay.getPanes().overlayMouseTarget.appendChild(a.node[0])};
this.overlay.draw=function(){};this.overlay.setMap(this.options.map)},addMarkers:function(a){var b=document.createDocumentFragment(),c=this;jq.each(a,function(a,e){c.markers[e.id]||(a=c.createMarker(e),b.appendChild(a.get(0)),c.pushMarker(e))});this.node.append(b)},addMarker:function(a){var b=this;if(!this.markers[a.id]){var c=a.getMarkerNode();c.css({top:Math.round(this.overlay.getProjection().fromLatLngToDivPixel(a.getPosition()).y),left:Math.round(this.overlay.getProjection().fromLatLngToDivPixel(a.getPosition()).x)});
c.click(function(c){b.notifyListeners(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_CLICKED,b,{marker:a})});c.mouseenter(function(){b.notifyListeners(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_OVER,b,{marker:a})});c.mouseleave(function(){b.notifyListeners(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_OUT,b,{marker:a})});this.node.append(c);this.pushMarker(a)}},pushMarker:function(a){var b=this;1<a.getMarkers().length&&c.each(a.getMarkers(),function(c,g){b.markers[g.id]=a});this.markers[a.id]=
a},getNode:function(){return this.node},removeAll:function(){this.node.children().remove();this.markers={}},removeMarker:function(a){this.markers[a.id]&&(this.markers[a.id].getMarkerNode().remove(),delete this.markers[a.id])},removeMarkerById:function(a){this.markers[a]&&this.removeMarker(this.markers[a])},refresh:function(){var a=[];c.each(this.markers,function(b,c){a.push(c)});this.removeAll();this.addMarkers(a)},createMarker:function(a){var b=a.getMarkerNode();b.css({top:Math.round(this.overlay.getProjection().fromLatLngToDivPixel(a.getPosition()).y),
left:Math.round(this.overlay.getProjection().fromLatLngToDivPixel(a.getPosition()).x)});var c=this;b.click(function(b){c.notifyListeners(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_CLICKED,c,{marker:a})});b.mouseenter(function(){c.notifyListeners(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_OVER,c,{marker:a})});b.mouseleave(function(){c.notifyListeners(R9.Common.Widgets.Maps.MarkerManager.Events.MARKER_OUT,c,{marker:a})});return b}}));R9.extend("Common.Widgets.Maps.MarkerManager",jq.extend(!0,
{},{Events:{MARKER_OVER:"markerOver",MARKER_OUT:"markerOut",MARKER_CLICKED:"markerClicked"}}))})(window.jq||window.jQuery);
(function(c){R9.extend("Common.Widgets.Maps.Markers",{BaseMarker:function(a){this.options=c.extend({},this.options,a);this.id=this.options.data&&this.options.data.id||this.options.data&&this.options.data.getId&&this.options.data.getId()||R9.Common.Utils.getId()}});R9.extend("Common.Widgets.Maps.Markers.BaseMarker.prototype",{node:null,id:null,options:{cluster:!0,map:null,data:null,position:null},isClusterable:function(){return this.options.cluster},getPosition:function(){var a=this.options.position;
return null==a?(a=this.getData(),a.location?a.location.googleLatLon:a.getLocation&&a.getLocation()?a.getLocation().googleLatLon:a.getLat&&void 0!==a.getLat()&&null!==a.getLat()&&a.getLon&&void 0!==a.getLon()&&null!==a.getLon()?new google.maps.LatLng(a.getLat(),a.getLon()):null):a},getData:function(){return this.options.data},getMarkers:function(){return[this]},addClass:function(a){this.node.addClass(a)},hasClass:function(a){this.node.hasClass(a)},removeClass:function(a){this.node.removeClass(a)},
getMarkerNode:function(){return this.node},getClusterNode:function(){return this.node}})})(window.jq||window.jQuery);
(function(c){R9.extend("Common.Widgets.Maps.Markers",{StarMarker:function(a){this.options=c.extend({},this.options,a);R9.Common.Widgets.Maps.Markers.BaseMarker.apply(this,arguments);this.init()}});R9.extend("Common.Widgets.Maps.Markers.StarMarker.prototype",c.extend(!0,{},R9.Common.Widgets.Maps.Markers.BaseMarker.prototype,{options:{cluster:!1,infoWindowType:"landmarkSummary",markerClass:"marker starMarker"},getInfoWindowType:function(){return this.options.infoWindowType},init:function(){this.node=
jq("\x3cdiv/\x3e",{"class":this.options.markerClass,html:"\x26#9733;"})},getClusterClass:function(){return this.options.markerClass},getClusterMarkerConstructor:function(){return R9.Common.Widgets.Maps.Markers.StarMarker}}))})(window.jq||window.jQuery);
(function(c){R9.extend("Common.Widgets.Maps.Markers",{PriceMarker:function(a){this.options=c.extend({},this.options,a);R9.Common.Widgets.Maps.Markers.BaseMarker.apply(this,arguments);this.init()}});R9.extend("Common.Widgets.Maps.Markers.PriceMarker.prototype",c.extend(!0,{},R9.Common.Widgets.Maps.Markers.BaseMarker.prototype,{wrapperNode:null,markerNode:null,priceNode:null,options:{infoWindowType:"exploreSummary",markerPositionClass:"marker",markerWrapperClass:"priceMarkerWrapper withPoint",markerClass:"priceMarker",
priceClass:"price",index:"",text:""},getInfoWindowType:function(){return this.options.infoWindowType},init:function(){this.node=jq("\x3cdiv\x3e",{"class":this.options.markerPositionClass});this.wrapperNode=jq("\x3cdiv\x3e",{"class":this.options.markerWrapperClass});this.markerNode=jq("\x3cdiv\x3e",{"class":this.options.markerClass});this.priceNode=jq("\x3cspan/\x3e",{"class":this.options.priceClass,text:this.options.text});this.markerNode.html(this.priceNode);this.wrapperNode.html(this.markerNode);
this.node.html(this.wrapperNode)},getClusterClass:function(){return"marker"},getClusterMarkerConstructor:function(){return this}}))})(window.jq||window.jQuery);
R9.extend("Common.Widgets.Maps",{Clusterer:function(c,a,b){function e(a){d[a.id]||(d[a.id]=n.clusterConstructor);a.isAdded=!1;p.push(a)}function g(a){for(a=""+a;a.length<n.minGridKeySize;)a="0"+a;return a}function f(){if(w){var a=new google.maps.LatLngBounds(c.getGMap().getBounds().getSouthWest(),c.getGMap().getBounds().getNorthEast()),b=u.getExtendedBounds(a),e,f;jq.each(p,function(a,h){function l(a){var b=[],c=a.getPosition();a=[];for(var d=Math.floor((c.lat()+90)/n.gridDegreesLat),c=Math.floor((c.lng()+
180)/n.gridDegreesLat),e=d-1;e<=d+1;e++)for(var f=c-1;f<=c+1;f++)a.push(g(e)+g(f));for(d=0;d<a.length;d++)if(q[a[d]])for(c=q[a[d]],e=0;e<c.length;e++)b.push(c[e]);return b}function t(a){var b=a.getPosition();f=new d[a.id]({cluster:a.isClusterable(),marker:a,gridSize:n.gridSize,map:c,position:new google.maps.LatLng(b.lat(),b.lng())});f.addMarker(a);m.push(f);n.useGrid&&(b=a.getPosition(),a=Math.floor((b.lat()+90)/n.gridDegreesLat),b=Math.floor((b.lng()+180)/n.gridDegreesLat),a=g(a)+g(b),(b=q[a])?b.push(f):
(b=[],b.push(f),q[a]=b))}if(h.isClusterable()){if(a=!1,!h.isAdded&&b.contains(h.getPosition())){var p=n.useGrid?l(h):m;for(e=0;f=p[e];e++)if(!a&&f.getPosition()&&f.isMarkerInClusterBounds(h)){a=!0;f.addMarker(h);break}a||t(h)}}else t(h)});var z=[];jq.each(m,function(a,b){1===b.getMarkers().length?z.push(b.getMarkers()[0]):z.push(b)});m=z}}var p=[],m=[],d={},q={},w=!1,n=jq.extend({},{clusterConstructor:R9.Common.Widgets.Maps.Cluster,gridSize:25,maxZoom:null,useGrid:!1,gridDegreesLat:5,gridDegreesLon:5,
minGridKeySize:3},b),u=jq.extend(new google.maps.OverlayView,{setClusterConstructor:function(a){a||(a=R9.Common.Widgets.Maps.Cluster);n.clusterConstructor=a},onAdd:function(){w||(w=!0,f())},draw:function(){},getMarkers:function(){return p},getClusters:function(){return m},setMaxZoom:function(a){n.maxZoom=a},getMaxZoom:function(){return n.maxZoom||c.getGMap().mapTypes[c.getGMap().getMapTypeId()].maxZoom},addMarkers:function(a,b){for(var c=0,d;d=a[c];c++)e(d);b||u.redraw()},addMarker:function(a,b){e(a);
b||u.redraw()},getClusterFromMarker:function(a){return m.filter(function(b){return b.isMarkerAlreadyAdded(a)})[0]},isMarkerInCluster:function(a){return m.some(function(b){return b.isMarkerAlreadyAdded(a)&&b.isVisible()})},removeAllMarkers:function(){jq.each(p,function(a,b){b.isAdded=!1});p=[];m=[];d={};q={}},getMap:function(){return c.getGMap()},getGridSize:function(){return n.gridSize},getExtendedBounds:function(a){var b=u.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),
d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),c=b.fromLatLngToDivPixel(c);c.x+=n.gridSize;c.y-=n.gridSize;d=b.fromLatLngToDivPixel(d);d.x-=n.gridSize;d.y+=n.gridSize;c=b.fromDivPixelToLatLng(c);b=b.fromDivPixelToLatLng(d);a.extend(c);a.extend(b);return a},resetViewport:function(){u.removeAllMarkers();u.redraw()},redraw:function(){m=[];q={};f()}});u.setMap(c.getGMap());a&&a.length&&u.addMarkers(a,!1);return u}});
(function(c){R9.extend("Common.Widgets.Maps",{type:"Cluster",Cluster:function(a){this.options=c.extend({},this.options,a);this.init()}});R9.extend("Common.Widgets.Maps.Cluster.prototype",{markers:null,markersById:null,center:null,node:null,id:null,hasTripsSavedMarker:!1,options:{cluster:!0,map:null,position:null,markerClass:"marker defaultMarker small",gridSize:8},init:function(){this.markers=[];this.markersById={};this.node=jq("\x3cdiv/\x3e",{"class":this.options.markerClass})},getPosition:function(){return this.options.position},
getMarkerById:function(a){return this.markersById[a]},getMarkers:function(){return this.markers},getMarkerNode:function(){return this.node},getInfoWindowType:function(){return this.markers[0].getInfoWindowType()},addMarker:function(a){this.markersById[a.id]||(this.markers.push(a),this.markersById[a.id]=a,this.options.position||(this.options.position=this.markers[0].getPosition()),this.hasTripsSavedMarker||(this.node.attr("class",a.getClusterClass()),this.hasTripsSavedMarker="Common.Widgets.Maps.Markers.SavedToTripsMarker"==
a.type),this.id=R9.Common.Utils.getId());return!0},addClass:function(a){this.node.addClass(a)},removeClass:function(a){this.node.removeClass(a)},isMarkerInClusterBounds:function(a){if(!this.options.cluster)return!1;var b=this.options.map.getProjection(),c=b.fromLatLngToDivPixel(this.getPosition()),g=c.x,c=c.y,b=b.fromLatLngToDivPixel(a.getPosition());a=b.x;b=b.y;return Math.sqrt((g-a)*(g-a)+(c-b)*(c-b))<this.options.gridSize}})})(window.jq||window.jQuery);
(function(c){R9.extend("Common.Widgets.Maps.Markers",{DefaultMarker:function(a){this.options=c.extend({},this.options,a);R9.Common.Widgets.Maps.Markers.BaseMarker.apply(this,arguments);this.init()}});R9.extend("Common.Widgets.Maps.Markers.DefaultMarker.prototype",c.extend(!0,{},R9.Common.Widgets.Maps.Markers.BaseMarker.prototype,{options:{infoWindowType:"hotelSummary",markerClass:"marker defaultMarker small"},getInfoWindowType:function(){return this.options.infoWindowType},getSearchId:function(){return window.searchid},
init:function(){if(R9.config&&R9.config.getBoolean("ui.hotels.map.result.items.enabled",!1)){var a=this.options.infoWindowType;if(a&&"hotelSummary"===a){var b=this.options.data,a=b&&"function"===typeof b.getShowPrvRate&&b.getShowPrvRate(),b=b&&"function"===typeof b.getShowPrvRatePromo&&b.getShowPrvRatePromo();if(a||b)this.options.markerClass+=" privateRateMarker"}}this.node=c("\x3cdiv/\x3e",{"class":this.options.markerClass,"data-id":this.id});if("hotelSummaryOverlay"===R9.config.getString("ui.hotels.map.tooltip",
"hotelSummary")){var e=this;e.node.click(function(){e.showOverlay()})}},showOverlay:function(){var a=this,b=null!=this.getHotelData?this.getHotelData():this.getData();if(b.getId())if(c(".infoOverlay").hide(),null==a.overlay){var e=c("#nrMapBody"),g=e.height(),f=["resultId\x3d"+b.getId(),"hotelId\x3d"+b.getId(),"searchId\x3d"+a.getSearchId(),"index\x3d"+b.getIndex()];b.getAutosaveTripId&&b.getAutosaveTripId()&&f.push("tripId\x3d"+b.getAutosaveTripId());a.overlay=c('\x3cdiv class\x3d"infoOverlay" /\x3e');
a.overlay.append('\x3cdiv  style\x3d"height: '+g+'px;" class\x3d"map-details-overlay"\x3e\x3cdiv class\x3d"map-details-overlay-inner" style\x3d"height: '+(g-30)+'px;"\x3e\x3cdiv class\x3d"map-details-overlay-wrapper"\x3e\x3cdiv class\x3d"hmd-close"\x3e\x3c/div\x3e\x3c/div\x3e\x3ciframe class\x3d"map-details-overlay-iframe" src\x3d"/s/horizon/hotels/details/HotelMapDetailsPage?'+f.join("\x26")+'"\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e');c(window).on("resize",function(){var b=e.height();a.overlay.find(".map-details-overlay").css("height",
b+"px");a.overlay.find(".map-details-overlay-inner").css("height",b-30+"px")});e.append(a.overlay);a.overlay.find(".hmd-close").on("click",function(){a.overlay.hide()})}else a.overlay.show()},getClusterClass:function(){return this.options.markerClass},getClusterMarkerConstructor:function(){return this}}))})(window.jq||window.jQuery);
(function(c){R9.extend("Common.Widgets.Maps.InfoWindows",{InfoWindowState:function(a){this.options=c.extend({},this.options,a||{})}});R9.extend("Common.Widgets.Maps.InfoWindows.InfoWindowState.prototype",{lastOpened:null,lastMarkerType:null,options:{beforeOpen:null,beforeClose:null,canShow:!0,extendedInfoWindowOptions:null},canShow:function(a){"undefined"!=typeof a&&(this.options.canShow=a);return this.options.canShow},close:function(a){this.lastOpened&&(this.options.beforeClose&&this.options.beforeClose(this.lastMarkerType),
this.lastOpened.close(a)&&(this.lastMarkerType.unregisterAllListeners(),this.lastMarkerType=this.lastOpened=void 0))},open:function(a,b,c,g){this.lastMarkerType=a;this.lastOpened=new R9.Common.Widgets.Maps.InfoWindows.NewInfoWindowView(a,this.options.extendedInfoWindowOptions);this.lastOpened.id=R9.Common.Utils.getId();this.options.beforeOpen&&this.options.beforeOpen(this.lastMarkerType);this.lastOpened.open(b,c,g)},redraw:function(){this.lastOpened.redraw()}})})(window.jq||window.jQuery);
R9.extend("Common.Widgets.Maps.InfoWindows",{InfoWindowFactory:function(){return R9.Common.Patterns.Factory()}()});
R9.extend("Common.Widgets.Maps.InfoWindows",{NewInfoWindowView:function(){return function(c,a){var b=new R9.Common.Patterns.MVC.View,e,g,f={content:"",disableAutoPan:!0,zIndex:null,boxClass:"infoWindow",closeBoxWrapperClass:"infoWindowCloseWrapper",closeBoxClass:"infoWindowClose",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1,alignBottom:R9.config.getBoolean("ui.maps.InfoBox.alignBottom",!0)};a&&(f=jq.extend(!0,{},f,a));var p=new InfoBox(f);jq.extend(b,
{open:function(a,f,m){e&&clearTimeout(e);p.open(a,f);g=jq("\x3cdiv/\x3e",{"class":"infoWindowBox "+c.getClass()}).append(c.getView()).mouseleave(function(){e=setTimeout(function(){b.close()},500)});g.on("mousewheel",function(a){a.stopPropagation()});p.draw(g);"function"==typeof m&&m.call(b,g)},close:function(a){return a||c.canClose()?(c.close(),p.close(),!0):!1},removeAutoClose:function(){g.off("mouseleave")},redraw:function(){p.draw(g)}});var m=google.maps.event.addListener(p,"closeclick",function(){b.notifyListeners(R9.Common.Widgets.Maps.InfoWindows.NewInfoWindowView.Events.CLOSE_CLICKED,
b,{});google.maps.event.removeListener(m);c.close()});return b}}()});R9.Common.Widgets.Maps.InfoWindows.NewInfoWindowView.Events={ELEMENT_CLICKED:"elementClicked",CLOSE_CLICKED:"closeClicked"};
(function(c){R9.extend("Common.Widgets.Maps.InfoWindows.Types",{InfoWindowTypeBase:function(){R9.Common.Patterns.Observable.apply(this,arguments)}});R9.extend("Common.Widgets.Maps.InfoWindows.Types.InfoWindowTypeBase.prototype",jq.extend(!0,{},R9.Common.Patterns.Observable.prototype,{getClass:function(){return""},canClose:function(){return!0},getView:function(){},close:function(){}}));R9.extend("Common.Widgets.Maps.InfoWindows.Types.InfoWindowTypeBase",{Events:{CLICK:"click"}})})(jq||jQuery);
R9.extend("Common.Widgets.Maps.Styles",{MapHRPStyle:function(){var c=[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#cdd9ea"},{saturation:-20}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#95abcc"},{lightness:15}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#eeeeee"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#cccccc"}]},
{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#c9c9c9"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#bbbbbb"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{color:"#c9c9c9"},{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#666666"}]},{featureType:"poi",
elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#dddddd"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#e4e4e4"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#e4e4e4"}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:-43},{gamma:1.64}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"on"},{lightness:48}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#bbbbbb"}]},
{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#e5e9db"},{lightness:15}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#bbbbbb"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"labels.text",stylers:[{visibility:"on"}]},
{featureType:"poi",elementType:"labels.text",stylers:[{color:"#888888"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{saturation:-83}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"on"},{saturation:-100}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"poi.business",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#888888"}]},{featureType:"landscape",elementType:"labels.icon",stylers:[{visibility:"on"},
{saturation:-100}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{color:"#999999"}]}],a={name:"HRPStyle"};return{getGoogleStyle:function(){return new google.maps.StyledMapType(c,a)},getClass:function(a){return""}}}()});
R9.extend("Common.Widgets.Maps.Styles",{MapHRPDarkStyle:function(){var c=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},
{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",
elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],a={name:"HRPDarkStyle"};return{getGoogleStyle:function(){return new google.maps.StyledMapType(c,
a)},getClass:function(a){return""}}}()});
R9.extend("Common.Widgets.Maps.Styles",{MapInlineDetailsStyle:function(){var c=[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#cdd9ea"},{saturation:-20}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#95abcc"},{lightness:15}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#eeeeee"}]},{featureType:"administrative.country",elementType:"geometry.stroke",
stylers:[{color:"#cccccc"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{color:"#c9c9c9"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#bbbbbb"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{color:"#c9c9c9"},{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#666666"}]},
{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#dddddd"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#e4e4e4"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#e4e4e4"}]},{featureType:"road",elementType:"labels.icon",stylers:[{saturation:-43},{gamma:1.64}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"on"},{lightness:48}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#bbbbbb"}]},
{featureType:"poi",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#e5e9db"},{lightness:15}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#bbbbbb"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"labels.text",stylers:[{visibility:"on"}]},
{featureType:"poi",elementType:"labels.text",stylers:[{color:"#888888"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"on"},{saturation:-83}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"on"},{saturation:-100}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"poi.business",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#888888"}]},{featureType:"landscape",elementType:"labels.icon",
stylers:[{visibility:"on"},{saturation:-100}]},{featureType:"landscape",elementType:"labels.text.fill",stylers:[{color:"#999999"}]}],a={name:"Map"};return{getGoogleStyle:function(){return new google.maps.StyledMapType(c,a)},getLocalizedGoogleStyle:function(b){a.name=b;return new google.maps.StyledMapType(c,a)},getClass:function(a){return""}}}()});
R9.extend("Common.Widgets.Maps.Styles",{MapMMHRPStyle:function(){var c=[{featureType:"transit",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.attraction",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.sports_complex",
elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.place_of_worship",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.attraction",elementType:"labels.text.fill",stylers:[{color:"#808080"}]},{featureType:"poi.sports_complex",elementType:"labels.text.fill",stylers:[{color:"#808080"}]},{featureType:"poi.place_of_worship",elementType:"labels.text.fill",stylers:[{color:"#808080"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{visibility:"on"}]},
{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{visibility:"on"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#F4F1F1"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#cccccc"}]}],a={name:"MMHRPStyle"};return{getGoogleStyle:function(){return new google.maps.StyledMapType(c,a)},getClass:function(a){return 0===Math.floor(a/10)?"small":0===Math.floor(a/100)?"medium":
"large"}}}()});
R9.extend("Common.Widgets.Maps.Styles",{MapNeighborhoodsHRPStyle:function(){var c=[{featureType:"transit",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.attraction",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.sports_complex",
elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.place_of_worship",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.attraction",elementType:"labels.text.fill",stylers:[{color:"#808080"}]},{featureType:"poi.sports_complex",elementType:"labels.text.fill",stylers:[{color:"#808080"}]},{featureType:"poi.place_of_worship",elementType:"labels.text.fill",stylers:[{color:"#808080"}]},{featureType:"administrative.neighborhood",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",
elementType:"labels.text.fill",stylers:[{visibility:"on"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#F4F1F1"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#cccccc"}]}],a={name:"MMHRPStyle"};return{getGoogleStyle:function(){return new google.maps.StyledMapType(c,a)},getClass:function(a){return 0===Math.floor(a/10)?"small":0===Math.floor(a/100)?"medium":"large"}}}()});(function(c,e){var l=/attempt=([0-9]+)/,m=/lastms=([0-9]{13})/,p=c.config.getBoolean("ui.ajax.logServerErrors.searchPoll",!1);c.createComponentClass("base.results.ResultsPage",{searchRunner:null,searchId:null,priceType:null,searchStartParams:null,vertical:null,urlSearchStartSupported:!1,loggingPrefix:"resultspage",poll:{pollingId:null,sent:0,activeRequest:null,ended:!1,nextPollTimeoutId:null,firstPhaseCompleted:!1,consecutiveEmptyResponses:0,lastPollTotalCount:-1,started:null,usingPreservedFilters:!1,
reason:"POLL"},filterState:null,urlFilterState:null,filtersData:null,useUrlFilterState:!0,useViewStateFilterState:!0,resultsList:e(),listBody:e(),listCol:null,progressBar:null,paginator:null,viewState:null,leftRail:null,rightRail:null,backToTop:null,clientTimeoutId:null,idleTimeoutId:null,secondPhaseTimeoutId:null,frenchWarning:null,ariaResultMsgWidget:null,ajaxAppendTo:null,preserveFilters:!1,preservedFilters:null,adsHelper:null,lastLimitedDateMs:null,lastLimitedMinMS:18E5,activeRequests:{},options:{infinite:!1,
button:!1,startSearchImmediately:!1,searchParams:null,ajaxParams:null,poll:!0,pageNumber:1,searchId:null,completed:!1,sortMode:null,quickLinkType:null,ascending:null,priceType:null,centerPointLat:null,centerPointLong:null,urlFilterState:null,pollingTimeout:16E3,exponentialBackoffDelay:!1,pollDelay:250,maxPollDelay:5E3,pollingId:null,windowScroll:"",persistWindowScroll:!1,filtersData:null,quickLinkData:null,useTwoPhasePolling:!1,visible:!1,useBuzz:!1,fastCover:!1,showExpiredResultsMessage:!0,secondPhaseWait:null,
secondPhaseTimeout:null,idleExpireMinutes:120,enforceIdleTimeout:!0,showFilteredButSimilar:!1,scrollTopOnFilterChange:!1,defaultSortType:null,useUrlSortMode:!1,msg:{expired_search:"",filters_removed:""},ariaMsg:{resultsLoading:"",resultsReady:"",noResultsFound:""},nonClearablePreservedFilters:[],forceLoadingTreatmentSkip:!1,placeholderDelay:0,defaultPaddingLeft:30,watchedResultId:"",animateInlineSearch:!0,useActiveRequestsMap:!1},init:function(){this.appendResults=this.options.infinite||this.options.button;
this.filterState={};this.viewState={openDetails:{}};this.leftRail=this.getChildElement("leftRail");this.rightRail=this.getChildElement("rightRail");this.backToTop=this.getChildElement("backToTop");this.resultsList=this.getChildElement("list");this.listBody=this.element.find(".listBody");this.listCol=this.getChildElement("listCol");this.resultsListCover=this.listBody.find(".resultsListCover");this.loadingMessage=this.element.find(".loadingMessage");this.progressBar=this.getChildElement("progress");
this.frenchWarning=this.getChildElement("frenchWarning");this.searchId=this.options.searchId;this.priceType=this.options.priceType;this.poll.pollingId=this.options.pollingId;this.urlFilterState=this.options.urlFilterState;this.searchStartParams=this.options.searchStartParams||{};this.ariaResultMsgWidget=this.getChildElement("aria-result-msg").getWidget();c.events.publish("paginator.hide");this.options.filtersData&&c.resultsMetaData.remapFilters(this.options.filtersData)},addEventHandlers:function(){var a=
this,b=null,d=function(){null!==b&&clearTimeout(b);b=setTimeout(function(){c.action.execute("common/utils/history/UserStateUpdateAction",{storageType:"viewState",searchId:a.searchId,key:"openDetails",value:JSON.stringify(a.viewState.openDetails)})},1E3)};this.subscribe(["searchform.submit","multilocale.search.submit"],this.startSearchFromSearchForm.bind(this));var g=this.onFilterStateChange.bind(this);g.priority=0;this.subscribe("filters.changed",g);this.subscribe("filters.changed.all",this.onAllFilterStateChange.bind(this));
g=this.preprocessResponse.bind(this);g.priority=0;this.subscribe("search.poll.response",g);this.subscribe("resultspage.filters.sync",this.syncFilterState.bind(this));this.subscribe("paginator.change",this.onPaginatorChange.bind(this));this.subscribe("resultsHeader.changed",this.onResultsListHeaderChange.bind(this));this.subscribe("resultspage.view.setvisible",this.setVisible.bind(this));this.subscribe("resultspage.results.refresh",this.refreshResults.bind(this));this.subscribe("resultspage.transition.remove",
this.removeTransitionClass.bind(this));this.subscribe(["result.details.opened","result.details.tab.changed"],function(b){a.viewState.openDetails[b.resultId]=b.activeTab||"overview";d()});this.subscribe("result.details.closed",function(b){delete a.viewState.openDetails[b.resultId];d()});this.subscribe("searchForm.changed",this.toggleSearchFormChanged.bind(this));this.subscribe("unbind.scroll.search.event",this.toggleSearchFormChanged.bind(this,!1));this.subscribe(["results.expired","user.refresh.expired"],
this.reloadExpiredResults.bind(this));this.subscribe("resultspage.showLowest",function(){c.events.publish("filters.reset",{type:"showAll"});c.events.publish("resultsHeader.sortType.set",{sortCode:"price_a"})});this.subscribe("ads.request",function(b){a.getAdsHelper().onSetupAdsRequest(b)});this.subscribe("results.quickLinkType.setDefault",function(b){b.hasOwnProperty("quickLinkType")&&(a.options.quickLinkType=b.quickLinkType)});this.answer("resultspage.filterState.is",function(b){return b&&a.filterState?
a.filterState[b]:a.filterState});this.answer("resultspage.filterData.get",function(){return a.filtersData?a.filtersData:a.options.filtersData});this.answer("resultspage.priceType.get",function(){return a.priceType});this.answer("resultspage.sortMode.get",function(){return a.options.sortMode});this.answer("resultspage.searchFailed",function(){return a.listBody.hasClass("failed")});this.answer("resultspage.urlFilterState.get",function(){return a.urlFilterState});this.answer("resultspage.leftMargin",
this.getPageContainerLeftMargin.bind(this));this.answer("resultspage.poll.ended",function(){return a.poll.ended});this.answer("resultspage.searchId.get",function(){return a.searchId});this.appendResults&&(this.backToTop.click(this.setupBackToTopClick.bind(this)),this.subscribe("resultspage.pageNumber.changed",this.setupBackToTopPosition.bind(this)));this.subscribe("results.leftRail.toggleCollapsed",this.toggleLeftRailCollapsed.bind(this));e(window.document).on("mouseleave.horizonResult",function(){c.events.publish("document.mouseLeave")});
e(window).on("keydown.landmark_nav",function(b){var c=b.which,d=b.shiftKey,g=b.altKey,f=b.metaKey;b=b.ctrlKey;if(9===c&&g&&f||9===c&&g&&b)if(b=e("*:focus"),c=e("[role\x3dform],[role\x3dsearch],[role\x3dmain]"),g=d?-1:c.length,f=d?c.length-1:0,d=d?-1:1,b.length){var n=b.closest("[role\x3dform],[role\x3dsearch],[role\x3dmain]");n.length?(b=e(n[0]).index("[role\x3dform],[role\x3dsearch],[role\x3dmain]"),d=b+d,d===g&&(d=f),c[d].focus()):(d=a.nextInDOM("[role\x3dform],[role\x3dsearch],[role\x3dmain]",
b))&&d.focus()}else c[0].focus()})},nextInDOM:function(a,b){for(b=this.getNext(b);0!==b.length;){var c=this.searchFor(a,b);if(null!=c)return c;b=this.getNext(b)}return null},getNext:function(a){return 0<a.next().length?a.next():this.getNext(a.parent())},inlineComponentsReady:function(){c.config.getBoolean("ui.rp.alwaysReqAdSetup",!0)&&c.events.publish("resultspage.adinfo.empty");this.options.visible&&c.events.publish("resultspage.view.setvisible",!0);if(this.options.searchId){c.utils.performance.setEnabled(this.shouldTrackStreamingPerformance());
this.setupStreaming(this.options.searchId,this.options.completed);if(this.options.windowScroll&&0<this.options.windowScroll.length&&this.options.persistWindowScroll){var a=this.options.windowScroll.split(";");e(window).scrollTop(a[0]);e(window).scrollLeft(a[1])}null!==this.options.quickLinkData&&c.events.publish("resultspage.quickLinkData.changed",this.options.quickLinkData)}else this.options.startSearchImmediately&&this.startSearch(this.options.searchParams,this.options.ajaxParams)},searchFor:function(a,
b){var c=this;if(b.is(a))return b;var g=null;b.children().each(function(){g=c.searchFor(a,e(this));if(null!=g)return!1});return g},setVisible:function(a){(this.options.visible=a)?this.element.addClass("ResultsVisible"):this.element.removeClass("ResultsVisible");this.setColumnsVisible(a,400)},setupStreaming:function(a,b){this.searchId=this.options.searchId;this.searchRunner=new c.base.results.AjaxSearchPoll({searchId:a,vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList,
replace:!this.appendResults});c.events.publish("resultspage.searchId.changed",{searchId:this.searchId,searchStartParams:this.searchStartParams});window.SearchID=this.searchId;null!==this.options.filtersData&&(this.filtersData=this.options.filtersData,c.events.publish("resultspage.filtersData.changed",this.filtersData));b&&this.getAdsHelper().requiresAdsPoll()&&(b=!1);this.logSmartyInteractions();b&&c.config.getBoolean("ui.horizon.resultspage.%s.handleCompleted".format(this.vertical||"base"),!1)?this.endPolling():
(c.events.publish("resultspage.streaming.start"),this.listBody.addClass("streaming-in-progress"),this.resultsReason="init",this.poll.reason="POLL",this.getResults(),this.startedStreaming())},logSmartyInteractions:function(){c.config.getBoolean("ui.smarty.r9LogOptions",!0)&&this.searchId&&c.events.publish("smartylogger.log.searchId",this.searchId)},startSearchFromSearchForm:function(a){if(!(a&&a.stopSearch&&a.navigateToResults))if(this.resultsReason="searchform.submit",a.tab!==this.vertical)c.Analytics.api.trackEvent("resultspage/search/vertical-mismatch"),
window.location.href=a.url;else{if(a.searchFormFilterState){var b="";Object.keys(a.searchFormFilterState).each(function(c){b&&(b+=";");b+=c+"\x3d"+a.searchFormFilterState[c]});this.urlFilterState=b;this.useViewStateFilterState=this.useUrlFilterState=!!b;delete a.filterState}else this.urlFilterState=null;a.preserveFilters?(this.preserveFilters=!0,this.useUrlFilterState=!1,this.urlFilterState&&this.urlFilterState.split(";").forEach(function(a){a=a.split("\x3d");this.filterState[a[0]]=a[1]},this),this.setPreservedFilterState(a)):
(this.preservedFilters=null,this.preserveFilters=!1);delete a.searchFormFilterState;this.options.visible&&this.options.animateInlineSearch&&this.bounceResults();a.navigateToResults||this.startSearch(a)}},startSearch:function(a){this.ariaResultMsgWidget.activateLoadMessage(this.options.ariaMsg.resultsLoading);this.resultsList.attr("aria-busy",!0);if(a.url&&c.authentication.needsRefresh)window.location="/"===a.url[0]?a.url:"/"+a.url;else{c.Vestigo&&c.Vestigo.view();c.events.publish("search.startSearch",
a);c.events.publish("resultspage.streaming.start",a);this.resultsList.removeClass("hidden");this.searchRunner=new c.base.results.AjaxSearchPoll({vertical:this.vertical,appendTo:this.ajaxAppendTo?this.ajaxAppendTo:this.resultsList});this.searchId&&this.cleanupExistingSearch(a);this.poll.sent=0;this.poll.ended=!this.options.poll;this.poll.pollingId=""+Math.floor(65536*Math.random())+1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=0;this.preservedFilters&&Object.keys(this.preservedFilters).length&&
(this.poll.usingPreservedFilters=!0);this.options.pageNumber=1;var b=e.extend(this.options.searchParams,a);this.getAdsHelper().setAdRequestSearchOptions(b,this.resultsReason);this.searchStartParams=b;c.utils.performance.setEnabled(this.shouldTrackStreamingPerformance());c.utils.performance.clearMarks(["search_start","first_result","first_phase_complete","polling_complete","first_result_rendered"]);this.getResults(0,b);this.skipLoadingTreatment()||this.addTransitionClass(a)}},abortPollActiveRequests:function(){var a=
this;this.options.useActiveRequestsMap&&this.activeRequests?Object.keys(this.activeRequests).forEach(function(b){a.activeRequests[b].abort();delete a.activeRequests[b]}):this.poll.activeRequest&&this.poll.activeRequest.abort()},cleanupExistingSearch:function(){this.abortPollActiveRequests();c.events.publish("resultspage.cleanup",this.searchId);this.stopIdleTimeout();this.destroyOldResults();this.resultsList.find("#searchResultsList").html("");this.listBody.removeClass("failed").attr("aria-hidden",
!1);this.searchId=null;this.poll.pollingId=null;this.preserveFilters||(this.filterState={});this.priceType=null;c.events.publish("paginator.hide");this.poll.firstPhaseCompleted=!1;this.poll.lastPollTotalCount=-1;this.poll.consecutiveEmptyResponses=0;this.poll.reason=null;this.poll.usingPreservedFilters=!1;this.options.filtersData=null;this.options.completed=!1;this.searchStartParams={};this.lastLimitedDateMs=null;!this.preservedFilters&&this.options.defaultSortType&&this.resetSortTypeForNewSearch(this.options.defaultSortType);
this.options.watchedResultId=null},resetSortTypeForNewSearch:function(a,b){this.options.sortMode=null;c.events.publish("resultsHeader.sortType.set",{sortCode:a,silent:"boolean"===typeof b?b:!0})},destroyOldResults:function(){c.ComponentManager.remove(this.resultsList.find("#searchResultsList"),!1);var a=this.element.find("#savedResultsListContainer");a.length&&c.ComponentManager.remove(a,!1)},destroyBuzzResults:function(){},beforeAppendNewResults:function(){},beforeUpdateDOM:function(a,b){a=e(a.parsedContent);
if(b)return this.beforeAppendNewResults();0===a.length&&c.config.getBoolean("ui.horizon.rp.skipEmptyPoll",!0)||(!this.poll.ended&&a.find(".Base-Results-HorizonResult").length&&c.utils.performance.mark("first_result"),this.doCustomUpdate({append:b})&&c.base.results.ResultsPageDOMUtils.mergeOpenResults(this.listBody,a),this.destroyOldResults(a))},publishAfterUpdateDOMEvent:function(){},getResults:function(a,b,d,g){var f=this;b=b||{};var h=e.extend(this.getFetchResultsOpts(b.fetchOpsParams),b);a=void 0!==
a?a:this.options.pollDelay;var k={beforeScript:function(){f.beforeUpdateDOM(this.response,h.append)},replace:!h.append,afterUpdateDOM:function(){f.publishAfterUpdateDOMEvent();f.poll.ended&&f.removeTransitionClass();if(h.append&&c.config.getBoolean("ui.resultspage.aria.focusOnPaginate",!0)){var a=f.resultsList.find("#"+f.options.searchId+"-"+f.options.pageNumber).children("[tabbable]").eq(0);a.length&&a.get(0).focus()}"function"===typeof g&&g()}};this.preservedFilters&&Object.keys(this.preservedFilters).length&&
(h.filterState=JSON.stringify(this.preservedFilters));this.doCustomUpdate(h)&&(k=e.extend(k,{customUpdate:f.updateDOM.bind(this)}));k=this.addCustomPollAjaxParams(k);d&&(h.isSecondPhase=!1);this.abortPollActiveRequests();b.resetFilters&&(h=e.extend({},h,{useViewStateFilterState:!1}));d=function(){c.utils.performance.mark("search_start");f.poll.sent++;var a=f.poll.sent,b=f.searchRunner.fetchResults(h,k);b.then(function(b,c){f.checkSearchExpired(b,c);f.options.useActiveRequestsMap?delete f.activeRequests[a]:
delete f.poll.activeRequest}).fail(function(a,b){var c=e.extend({type:"ajax"},a||{});a.type&&(c.ajaxErrorType=a.type);b&&!c.status&&(c.status=b);f.handleError(c)});f.options.useActiveRequestsMap?f.activeRequests[a]=b:f.poll.activeRequest=b;c.events.publish("resultspage.requestResults")};clearTimeout(this.poll.nextPollTimeoutId);0<a||c.config.getBoolean("ui.horizon.resultspage.pollTimeout.always",!1)?this.poll.nextPollTimeoutId=setTimeout(d,a):d()},checkSearchExpired:function(a,b){b&&202===b.status&&
(this.endPolling(),c.events.publish("search.expired"))},doCustomUpdate:function(){return!1},addCustomPollAjaxParams:function(a){return a},endPolling:function(a,b){var d="pausedetails"===a;this.ariaResultMsgWidget.deactivateLoadMessage(this.options.ariaMsg.resultsReady);this.poll.ended||(d||(c.utils.performance.mark("polling_complete"),this.poll.ended=!0,this.log.console("Ended polling")),this.removeTransitionClass(),this.listBody.removeClass("streaming-in-progress"),this.stopClientTimeout(),this.stopSecondPhaseTimeout(),
d||(c.events.publish("resultspage.streaming.done",{searchId:this.searchId,reason:a,error:b}),a&&(b&&"object"===typeof b&&b.type&&(a+="/"+b.type),c.Analytics.api.trackEvent({category:"ResultsPage",action:"search_finished",label:a})),this.useViewStateFilterState=this.useUrlFilterState=!1),this.resultsList.attr("aria-busy",!1))},clearPreservedFilters:function(){this.preservedFilters=null;this.preserveFilters=!1},handleError:function(a){if(!a||"object"!==typeof a||0!==a.status&&!a.aborted){if("object"===
typeof a){if(a.searchExpired&&!a.avoidReload){this.reloadExpiredResults();return}if(a.type){var b=a.message||a.status;"ajax"===a.type?(p||!a.status||500>a.status)&&this.log.error("RP ajax error:"+(b?" ("+b+")":""),a):"limitreload"===a.type&&c.config.getBoolean("ui.rp.limitReloadError",!1)?this.log.error(a.message,a):c.Analytics.api.trackEvent({category:this.loggingPrefix,action:"error",label:a.type,value:b})}}this.endPolling("error",a);this.resultsList.addClass("hidden");c.events.publish("paginator.hide");
this.removeTransitionClass();this.listBody.addClass("failed").attr("aria-hidden",!0);c.events.publish("search.searchFailed",a);a&&"noresults"===a.type&&a.response&&a.response.filtersData&&(a=Object.keys(a.response.filtersData),0<a.length&&(a.forEach(function(a){c.events.publish("filter.show",{name:a})}),c.events.publish("resultspage.filterList.show")))}},getFetchResultsOpts:function(a){a=e.extend(a||{},{applyFilters:!0,filterState:null,useViewStateFilterState:this.useViewStateFilterState,pageNumber:this.options.pageNumber,
watchedResultId:this.options.watchedResultId});a.append=1<this.options.pageNumber&&this.appendResults;null!==this.poll.pollingId&&(a.pollingId=this.poll.pollingId);null!==this.options.sortMode&&(a.sortMode=this.options.sortMode,null!==this.options.ascending&&(a.ascending=this.options.ascending));null!==this.priceType&&(a.priceType=this.priceType);this.useUrlFilterState&&this.urlFilterState?a.filterState=this.urlFilterState:this.filterState&&0<Object.keys(this.filterState).length&&(a.filterState=JSON.stringify(this.filterState));
this.changingFilter&&(a.changingFilter=JSON.stringify(this.changingFilter),this.changingFilter=null);if(this.options.persistWindowScroll&&this.poll.ended&&(!this.appendResults||1===this.options.pageNumber)){var b=e(window).scrollTop().toFixed(),c=e(window).scrollLeft().toFixed();a.windowScroll=""+(0<b?b:0)+";"+(0<c?c:0)}!this.poll.ended&&-1<this.poll.lastPollTotalCount&&(a.lastPollTotalCount=this.poll.lastPollTotalCount);a.requestReason="string"===typeof this.poll.reason?this.poll.reason:"POLL";this.options.phoenixRising&&
(a.phoenixRising=!0);a.isSecondPhase=this.poll.firstPhaseCompleted;this.getAdsHelper().setAdRequestSearchOptions(a,this.resultsReason);a.openDetails=this.viewState.openDetails;return a},setupNewlyCreatedSearch:function(a){this.searchRunner.searchId=this.searchId=a.searchId;this.log.console("setting up searchId",this.searchId);c.events.publish("resultspage.searchId.changed",{searchId:this.searchId,searchStartParams:this.searchStartParams});window.SearchID=this.searchId;"pageTitle"in a&&(document.title=
a.pageTitle);"viewState"in a&&"priceType"in a.viewState&&(this.priceType=a.viewState.priceType,c.events.publish("resultspage.priceType.changed",{priceType:this.priceType}));this.logSmartyInteractions();this.options.pollingTimeout=a.uiTimeout;this.startedStreaming()},firstResultsRendered:function(){},isFirstResults:function(a,b){return a&&b&&0<b.totalCount&&0>this.poll.lastPollTotalCount},preprocessResponse:function(a){if(this.searchId||"searchId"in a){var b=this.options.poll&&!this.poll.ended,d=this.isFirstResults(b,
a);if(a&&(!this.poll.firstPhaseCompleted||!a.secondPhaseWait||a.completed||a.error)){this.log.console("received response",a);!this.searchId&&"searchId"in a&&"string"===typeof a.searchId&&this.setupNewlyCreatedSearch(a);d&&(c.events.publish("resultspage.streaming.firstResults"),this.firstResultsRendered(a));this.options.completed=a.completed;if(a.error){b={type:"server",message:a.errorMessage,searchExpired:a.searchExpired};a.searchStartError&&(b={type:"query",userDisplayMessage:a.queryErrors.reduce(function(a,
b){return a+"\x3c/br\x3e"+b})});this.handleError(b);return}var g="isCustomTicket"in a&&a.isCustomTicket;"isMultiAirport"in a&&c.events.publish("resultspage.multiAirport.changed",a.isMultiAirport);if("filtersData"in a){this.filtersData=a.filtersData;var e=function(){this.log.time("filterUpdate");c.events.publish("resultspage.filtersData.changed",a.filtersData);c.events.publish("%s.resultspage.filtersData.changed.done".format(this.vertical),a.filtersData);this.log.timeEnd("filterUpdate")}.bind(this);
b&&d&&c.config.getBoolean("ui.horizon.resultspage.delayFilterPaint",!0)?setTimeout(e,c.config.getInt("ui.horizon.resultspage.delayFilterPaint.time",100)):e()}"urlFilterState"in a&&!this.useUrlFilterState&&(this.urlFilterState=a.urlFilterState,this.options.useUrlFilterState&&!g&&this.updateUrlFilterState(a.urlFilterState));"quickLinkData"in a&&c.events.publish("resultspage.quickLinkData.changed",a.quickLinkData);"sortMode"in a&&(this.options.useUrlSortMode&&!g&&this.updateUrlSortState(a.sortMode),
c.events.publish("resultspage.sortMode.changed",{customTicket:g,sortCode:a.sortMode}));"taxesEstimated"in a&&c.events.publish("resultspage.taxesEstimated.changed",{taxesEstimated:a.taxesEstimated});"viewState"in a&&"priceType"in a.viewState&&c.events.publish("resultspage.priceType.changed",{priceType:a.viewState.priceType});"warnDestinationCC"in a&&c.events.publish("resultspage.warnDestinationCC.changed",{warnDestinationCC:a.warnDestinationCC});"swindle"in a&&c.Common&&c.Common.SwindlePublisher&&
c.Common.SwindlePublisher.publish(a.swindle);a.ads&&(this.resultsReason=null,this.getAdsHelper().updateAds(a.ads));if(a.completed){if(0===a.totalCount&&0===a.filteredCount){this.handleError({type:"noresults",message:"Finished search but failed to find results",response:a});this.ariaResultMsgWidget.deactivateLoadMessage(this.options.ariaMsg.noResultsFound);return}this.endPolling("completed",null,a);b=this.options.poll&&!this.poll.ended}if(this.checkFilteredCount(a)||a.error)this.removeTransitionClass(),
a.allResultsWereFiltered&&!this.options.showFilteredButSimilar&&this.listBody.addClass("failed").attr("aria-hidden",!0);this.setFirstPhaseCompleted(a);(a.completed||0<a.filteredCount&&0<a.totalCount)&&c.events.publish("resultspage.results.count.changed",{filtered:a.filteredCount,total:a.totalCount});c.events.publish("paginator.update",{pageNumber:a.pageNumber,pageCount:a.pageCount});c.events.publish("resultspage.refreshed",{streaming:!a.completed});this.didReceiveResults(a);this.poll.ended&&c.events.publish("paginator.getmoreresults.completed")}b&&
this.setupNextPollRequest(a,d);this.updateCubaWarning(a);this.resultsList.removeClass("hidden")}},checkFilteredCount:function(a){return 0<a.filteredCount||a.allResultsWereFiltered},setupNextPollRequest:function(a,b){"totalCount"in a&&0<a.totalCount&&a.totalCount!==this.poll.lastPollTotalCount?(this.poll.consecutiveEmptyResponses=0,this.poll.lastPollTotalCount=a.totalCount):this.poll.consecutiveEmptyResponses++;var c=this.options.pollDelay;!a.cached&&this.options.exponentialBackoffDelay&&(c=this.options.pollDelay+
1E3*Math.log(this.poll.consecutiveEmptyResponses+1));a=Math.min(c,this.options.maxPollDelay);this.poll.firstPhaseCompleted&&0<=this.options.secondPhaseWait&&(a=this.options.secondPhaseWait);b&&(a=0);this.poll.reason="POLL";this.getResults(a)},setFirstPhaseCompleted:function(a){this.poll.firstPhaseCompleted!==a.firstPhaseCompleted&&(this.poll.firstPhaseCompleted=a.firstPhaseCompleted,this.poll.firstPhaseCompleted&&(c.events.publish("resultspage.streaming.firstPhase.done"),this.startSecondPhaseTimeout(),
c.utils.performance.mark("first_phase_complete")))},syncState:function(a,b){null===b.state?delete a[b.name]:b.name&&(a[b.name]=b.state)},syncFilterState:function(a){this.syncState(this.filterState,a);this.preserveFilters&&a.syncPreservedState&&this.syncPreservedFilters(a)},syncPreservedFilters:function(a){this.syncState(this.preservedFilters,a)},setPageNumber:function(a){this.options.pageNumber!==a&&(this.options.pageNumber=a,c.events.publish("resultspage.pageNumber.changed",a),c.action.execute("common/utils/history/UserStateUpdateAction",
{storageType:"viewState",searchId:self.searchId,key:"pageNumber",value:a.toString()}))},onFilterStateChange:function(a){this.useViewStateFilterState=this.useUrlFilterState=!1;this.resultsList.removeClass("hidden");this.syncFilterState(a);this.preserveFilters&&!a.syncPreservedState&&this.syncPreservedFilters(a);a.name&&a.changeData&&(this.changingFilter=e.extend({name:a.name},a.changeData));a.skipPageReset||this.setPageNumber(1);this.resultsReason="filters.changed";this.poll.reason="FILTER";a.reset&&
(this.poll.reason+=".RESET");this.refreshResults(a)},onAllFilterStateChange:function(a){var b=this;this.useUrlFilterState=!1;this.resultsList.removeClass("hidden");Object.entries(a.allChanges).forEach(function(a){b.syncFilterState({name:a[0],state:a[1]})});a.changingFilter&&(this.changingFilter=e.extend({},a.changingFilter));this.resultsReason="filters.changed";this.poll.reason="FILTER";this.refreshResults()},onPaginatorChange:function(a){a.append||e(window).scrollTop(0).trigger("scroll");c.Analytics.api.trackEvent("page/"+
a.pageNumber);this.setPageNumber(a.pageNumber);this.resultsReason="paginator.change";this.poll.reason="PAGINATE";this.refreshResults({append:a.append})},onResultsListHeaderChange:function(a){a.rpIgnore||(void 0!==a.sort?(this.options.sortMode=a.sort.sortType,this.options.ascending=a.sort.ascending,this.poll.reason="SORT",c.Analytics.api.trackEvent(this.loggingPrefix+"/sort/"+(a.sort.ascending?"":"-")+a.sort.sortType)):void 0!==a.priceType?(this.priceType=this.options.priceType=a.priceType,this.poll.reason=
"PRICETYPE",c.Analytics.api.trackEvent(this.loggingPrefix+"/priceType/"+a.priceType)):this.poll.reason="SORT",void 0!==a.reviewType&&(this.options.reviewType=a.reviewType,c.Analytics.api.trackEvent(this.loggingPrefix+"/reviewType/"+a.reviewType)),void 0!==a.quickLinkType&&(this.options.quickLinkType=a.quickLinkType,c.Analytics.api.trackEvent(this.loggingPrefix+"/quickLinkType/"+a.quickLinkType)),this.updateFrenchWarning(),this.setPageNumber(1),this.resultsReason="resultsHeader.changed",this.refreshResults())},
updateFrenchWarning:function(){this.frenchWarning&&this.frenchWarning.toggleClass("hidden",this.options.defaultSortType&&-1===this.options.defaultSortType.indexOf(this.options.sortMode))},updateCubaWarning:function(a){var b=this.getChildElement("cubaWarning"),c=this.getChildElement("cubaWarningWrapper");a.hasOwnProperty("cubanQuery")&&a.cubanQuery?(b.addClass("visible"),c.addClass("visible").attr("aria-hidden",!1)):b.hasClass("visible")&&(c.removeClass("visible","aria-hidden",!0),b.addClass("visible"))},
addTransitionClass:function(a){if(!this.options.forceLoadingTreatmentSkip||!this.skipLoadingTreatment()){var b=[];this.options.blurTransition&&(b.push("blur"),this.resultsList.addClass("blur"));this.options.spinnerTransition&&b.push("loading");this.options.fastCover?(this.resultsListCover.addClass(b.join(" ")),a&&a.overlayTop&&this.resultsListCover.css("top",a.overlayTop-this.listBody.position().top)):this.listBody.addClass(b.join(" "))}},removeTransitionClass:function(){this.options.blurTransition&&
this.resultsList.removeClass("blur");this.resultsListCover.removeClass("loading blur").css("top",null);this.listBody.removeClass("loading blur");this.loadingMessage.addClass("hidden")},refreshResults:function(a){if(this.searchRunner){!this.searchId&&c.config.getBoolean("horizon.resultspage.dontRefreshBeforeSearchStart",!0)&&this.searchStartParams&&(a=e.extend({},a,this.searchStartParams));a&&a.customRequest&&(this.resultsReason=a.customRequest,"details.unpause"===this.resultsReason&&(this.listBody.addClass("streaming-in-progress"),
this.poll.reason="POLL"));this.ariaResultMsgWidget.activateLoadMessage(this.options.ariaMsg.resultsLoading);var b=this.poll.reason&&-1<this.poll.reason.indexOf("FILTER")?200:0,d=a&&a.afterUpdateFn;d&&delete a.afterUpdateFn;this.getResults(b,a,!0,d);"undefined"!==typeof a&&"undefined"!==typeof a.append&&a.append||(c.dom.schedule(this.addTransitionClass.bind(this,a)),this.listBody.removeClass("failed").attr("aria-hidden",!1))}},reloadExpiredResults:function(){this.addTransitionClass();this.log.console("reloading expired results");
this.options.showExpiredResultsMessage&&(this.options.msg.expired_search&&this.loadingMessage.text(this.options.msg.expired_search),this.resultsListCover.addClass("expired"),this.loadingMessage.removeClass("hidden"));c.Analytics.api.trackEvent(this.loggingPrefix+"/searchexpired");var a;if(c.config.getInt("ui.rp.limitExpiredReload",!0)){if(a=this.limitedReloadUrl(),!a)return}else a=this.mergeFilterStateWithUrl(this.urlFilterState);window.location.href=a},stopSearch:function(a){e.get("/s/sparkle?action\x3dkillseeker\x26searchid\x3d%s\x26formtoken\x3d%s".format(a||
this.searchId,c.globals.formtoken))},clientTimeout:function(){this.log.console("client timed out");if(c.config.getBoolean("ui.horizon.rp.streaming.timeout.reload",!0)){this.stopSearch();var a=this.limitedReloadUrl();a&&(this.handleError({type:"timeout",message:"Reached polling timeout without completing"}),window.location=this.mergeStateWithUrl("true","force",a))}},limitedReloadUrl:function(){var a=l.exec(window.location.search),b=1;if(a&&1<a.length&&(b=window.parseInt(a[1])+1,!isNaN(b)&&b>c.config.getInt("ui.horizon.rp.streaming.timeout.reload.limit",
3))){a=(a=m.exec(window.location.search))&&1<a.length?window.parseInt(a[1]):this.lastLimitedDateMs;if(!isNaN(a)&&0<a&&0<this.lastLimitedMinMS&&Date.now()-a>this.lastLimitedMinMS)return this.lastLimitedDateMs=null,this.mergeFilterStateWithUrl(this.urlFilterState).replace(l,"").replace(m,"");this.handleError({type:"limitreload",message:"Reached max consecutive poll timeouts",attempts:b,last:a,searchExpired:!0,avoidReload:!0});return null}this.lastLimitedDateMs=Date.now();return this.mergeStateWithUrl(""+
this.lastLimitedDateMs,"lastms",this.mergeStateWithUrl(""+b,"attempt"))},startSecondPhaseTimeout:function(){var a=this;c.config.getBoolean("ui.horizon.killSecondPhase",!1)&&(this.stopSecondPhaseTimeout(),this.secondPhaseTimeoutId=window.setTimeout(function(){a.poll.ended||(a.stopSearch(),window.setTimeout(function(){a.endPolling("2ftimeout")},5E3))},this.options.secondPhaseTimeout-5E3))},stopSecondPhaseTimeout:function(){window.clearTimeout(this.secondPhaseTimeoutId);this.secondPhaseTimeoutId=null},
startIdleTimeout:function(a){this.idleTimeoutId=window.setTimeout(function(){e(window).one("mousemove",function(){c.events.publish("results.expired")})},a)},stopIdleTimeout:function(){window.clearTimeout(this.idleTimeoutId);this.idleTimeoutId=null},startClientTimeout:function(a){var b=this;a+=5E3;var c=this.searchId;this.stopClientTimeout();this.clientTimeoutId=window.setTimeout(function(){c===b.searchId&&b.clientTimeout()},a)},stopClientTimeout:function(){window.clearTimeout(this.clientTimeoutId);
this.clientTimeoutId=null},startedStreaming:function(){this.options.enforceIdleTimeout&&this.startIdleTimeout(6E4*this.options.idleExpireMinutes);null===this.clientTimeoutId&&this.startClientTimeout(2*this.options.pollingTimeout);var a=c.storage.get("search_submit_pageId"),b="RP";a&&"results"!==a&&(b="FD",c.storage.remove("search_submit_pageId"));c.Analytics.api.trackEvent({category:"ResultsPage",action:"search_started",label:b})},didReceiveResults:function(){},updateDOM:function(a){try{this.log.time("updateDOM");
for(var b=0;b<a.children.length;b++)if(!c.dom.merge(this.element.find("#"+a.children[b].id).get(0),a.children[b]))return!1;return!0}catch(d){return!1}finally{this.log.timeEnd("updateDOM")}},checkFilteredCountForPreservedFilters:function(a){var b=this;if(this.preserveFilters){var d={};this.options.nonClearablePreservedFilters.forEach(function(a){b.preservedFilters.hasOwnProperty(a)&&(d[a]=b.preservedFilters[a])});this.clearPreservedFilters();if(0===a.filtered||a.filtered<this.options.removeFiltersThreshold&&
a.total>=this.options.removeFiltersThreshold)c.Widgets.Toaster.addToast(this.options.msg.filters_removed,{button:!0,escaped:!1,auto:!0,theme:"centered filters-cleared-toast"}),this.preservedFilters=0<Object.keys(d).length?d:null,this.filterState=0<Object.keys(d).length?d:{},this.refreshResults({resetFilters:!0})}},mergeStateWithUrl:function(a,b,c){if(b){var d=c||window.location.href.split("#")[0],e="string"!==typeof a;c=d.split("?");if(1<c.length){for(var h=c[1].split("\x26"),k=!1,d=0;d<h.length;d++)h[d].startsWith(b)&&
(k=e?null:b+"\x3d"+a,-1<h[d].indexOf(";map")&&(k=(k||"")+";"+h[d].split(";")[1]),h[d]=k,k=!0);k||e||h.push(b+"\x3d"+a);a=h.filter(function(a){return"string"===typeof a&&a.length});b=a.length?"?":"";for(d=0;d<a.length;d++)";map"!==a[d]&&0!==d&&(b+="\x26"),b+=a[d];d=c[0]+b}else e||(d+="?"+b+"\x3d"+a);return d}},mergeFilterStateWithUrl:function(a){return this.mergeStateWithUrl(a,"fs")},mergeSortStateWithUrl:function(a){return this.mergeStateWithUrl(a,"sort")},updateUrlFilterState:function(a){window.history&&
window.history.replaceState&&window.history.replaceState(null,null,this.mergeFilterStateWithUrl(a))},updateUrlSortState:function(a){window.history&&window.history.replaceState&&window.history.replaceState(null,null,this.mergeSortStateWithUrl(a))},toggleLeftRailCollapsed:function(){this.element.find(".col-left-rail").toggleClass("collapsed")},shouldTrackStreamingPerformance:function(){return c.config.getBoolean("ui.horizon.resultspage.streamingPerformance.trackForAllSearches",!0)},getAdsHelper:function(){this.adsHelper||
(this.adsHelper=new c.base.results.AdsHelper);return this.adsHelper},skipLoadingTreatment:function(){return!1},destroy:function(){this.base();c.events.publish("resultspage.JavaScriptComponent.cleanup",this.vertical);e(window).off("scroll.searchAndScrollListener")},setColumnsVisible:function(a,b){var c=this,e=function(){a?(c.listCol.removeClass("hidden"),c.leftRail.removeClass("hidden"),c.rightRail.removeClass("hidden")):(c.listCol.addClass("hidden"),c.leftRail.addClass("hidden"),c.rightRail.addClass("hidden"))};
b?setTimeout(e.bind(c),b):e()},setPreservedFilterState:function(){this.preservedFilters=e.extend({},this.filterState)},bounceResults:function(){var a=this.listCol.get(0),b=this.leftRail.get(0),c=this.rightRail.get(0);a.classList.remove("reload");a.classList.add("reload");b&&b.classList.add("reload");c&&c.classList.add("reload");setTimeout(function(){b&&b.classList.remove("reload");c&&c.classList.remove("reload");a&&a.classList.remove("reload")},2E3)},getPageContainerLeftMargin:function(){var a=this.element.find(".pageContainer").first(),
b=Number(a.css("padding-left").replace("px","")),b=0===b?this.options.defaultPaddingLeft:b;return Number(a.css("margin-left").replace("px",""))+b},toggleSearchFormChanged:function(a){e(window).off("scroll.searchAndScrollListener");if(a&&this.options.visible)e(window).on("scroll.searchAndScrollListener",c.Common.Utils.debounce(this.toggleScrollSearchBanner.bind(this,!0),100));else this.toggleScrollSearchBanner(!1)},scrollSearchBannerThreshold:200,toggleScrollSearchBanner:function(a){c.events.publish("scrollSearchBanner.toggleVisibility",
a&&e(window).scrollTop()>this.scrollSearchBannerThreshold)},setupBackToTopClick:function(){"parentIFrame"in window?window.parentIFrame.scrollTo(0,0):e(window).scrollTop(0).trigger("scroll");c.Analytics.api.trackEvent({subPageId:"ResultsPage",category:"backToTop",action:"click"})},setupBackToTopPosition:function(){"parentIFrame"in window?this.setupBackToTopPositionForCrossDomainIFrames():this.setupBackToTopPositionDefault()},setupBackToTopPositionDefault:function(){var a=this,b=e(window).scrollTop();
e(window).unbind("scroll.backToTop").bind("scroll.backToTop",function(){var c=e(this).scrollTop();c>2*e(this).height()&&b>c?a.backToTop.addClass("visible"):a.backToTop.removeClass("visible");b=c})},setupBackToTopPositionForCrossDomainIFrames:function(){var a=this,b=0,c=!1;setInterval(function(){window.parentIFrame.getPageInfo(function(d){var e=d.scrollTop;a.backToTop.removeClass("visible");e===b&&e>2*d.clientHeight&&c?(a.backToTop.addClass("visible"),a.backToTop.css({position:"absolute",bottom:"auto"}),
a.backToTop.css({top:d.scrollTop-d.offsetTop+d.clientHeight-85+"px"})):(c=b>e,b=e)})},500)}})})(R9,jq||jQuery);(function(b,d){function a(a){this.searchId=a.searchId;this.hotelId=a.hotelId;this.containerElement=a.containerElement;this.minimumDelay=a.minimumDelay||c.minimumDelay;this.spacingDelay=a.spacingDelay||c.spacingDelay;this.toastLength=a.toastLength||c.toastLength;this.url=a.url||c.url;this.messages=[];this.timeoutId=null;if(!this.searchId)throw console.error("Cannot instantiate an UrgencyMessaging object without a valid search ID."),Error("Cannot instantiate an UrgencyMessaging object without a valid search ID.");
}var c={minimumDelay:4E3,spacingDelay:2E3,toastLength:6E3,url:"/s/run/hotelbookmsg"};a.prototype.fetchAndDisplay=function(){var a=this,b=0;this.timeoutId=setTimeout(function(){2===++b&&a.showNextMessage()},a.minimumDelay);var c={searchid:a.searchId};a.hotelId&&(c.hid=a.hotelId,a.containerElement&&(c.inline=!0));d.ajax({type:"POST",dataType:"json",url:a.url,data:c,success:function(c){a.messages=c;2===++b&&a.showNextMessage()},error:function(a,b,c){console.error("UrgencyMessaging.fetchAndDisplay failed: "+
b)}})};a.prototype.showNextMessage=function(){var a=this;if(a.messages&&0<a.messages.length){var c=a.messages.shift();b.Widgets.Toaster.addToast(c.message,{escaped:!0,delay:a.toastLength,icon:c.icon||null,containerElement:a.containerElement});a.timeoutId=setTimeout(function(){a.showNextMessage()},a.spacingDelay)}};a.prototype.cleanUp=function(){clearTimeout(this.timeoutId);b.Widgets.Toaster.removeAllToasts()};b.Hotels=b.Hotels||{};b.Hotels.UrgencyMessaging=a})(R9,jq);
(function(b,d){b.createComponentClass("hotels.results.HotelResultsPage","base.results.ResultsPage",{vertical:"hotels",urgencyMessenger:void 0,resultsBannerId:void 0,loggingPrefix:"hotelresultspage",usedHighlightsArray:null,buzzListCache:{},topHotelsContainer:null,complicated:null,horizontalFiltersWrapper:null,horizontalFiltersWrapperFixed:null,insightsWrapper:null,filtersPinned:!1,dualViewMapPinned:!0,pageView:"list",bestplaceholder:null,nonInstantBookingBannerVisible:!1,mapViewOpened:!1,options:{},
_options:{showUrgencyBubbles:!0,urgencyOnscreenMillis:6E3,location:null,showResultsBanner:!1,pastBookingAjaxEnabled:!1,showHackerStayCallout:!1,useTopBannerContainer:!1,suppressRegionDistance:!1,sortAmbianceCodes:null,dualReactMapEnabled:!1,permanentlyPinnedFilters:!1,horizontalFiltersStickyV2:!1,mapVersionCode:"fullscreen",hotelTagsEnabled:!1,showMap:!1,drawOnMapEnabled:!1,isMomondo:!1,countryCode:"",resultsPlaceholderEnabled:!1,horizontalFiltersScrollOffsetY:157,dualViewFooterScrollOffsetY:636,
dualViewMapOffsetX:764,contentWidth:1340,edgeToEdgeMap:!1,showVerified:!1,premiumHomesEnabled:!1,premiumHomesCtids:[],minNumNightsForPremium:1,citySpecificMinNights:{},minDaysOutPremium:2,covidLoadingModal:!1,manualScrolling:!1},init:function(){this.options=d.extend(this._options,this.options);this.options.ajaxParams={customUpdate:this.updateDOM.bind(this)};this.base();this.searchId&&this.fetchUrgencyMessaging();!this.options.visible&&this.options.useBuzz&&this.fetchBuzzResults();this.usedHighlightsArray=
[];this.topHotelsContainer=d("#bestHotelContainer");this.complicated=d("#complicatedTax");if(this.options.horizontalFiltersStickyV2||"dualview"===this.options.mapVersionCode)this.horizontalFiltersWrapper=this.getChildElement("horizontalFiltersWrapper"),this.horizontalFiltersWrapperFixed=this.getChildElement("horizontalFiltersWrapperFixed");this.options.resultsPlaceholderEnabled&&(this.resultsPlaceholder=this.getChildElement("placeholder"),this.bestplaceholder=this.getChildElement("bestplaceholder"));
this.insightsWrapper=d("#insightsWrapper");this.setupHotelsComparePromo();this.showPlaceholders()},addEventHandlers:function(){var a=this;this.base();!a.options.visible&&a.options.useBuzz&&a.subscribe("hotels.frontdoor.form.location",function(b){!a.options.visible&&b.cityId&&(a.destroyBuzzResults(),a.fetchBuzzResults(b.cityId))});this.subscribe("hotels.showUrgencyBubbles.value",function(b){"boolean"===typeof b&&(a._options.showUrgencyBubbles=b,!b&&a.urgencyMessenger&&a.urgencyMessenger.cleanUp())});
this.subscribe("hotels.rp.fullScreenMap.opened",function(){a.element.addClass("MapOpen");b.events.publish("horizontalFilters.resizeContent")});this.subscribe("hotels.rp.fullScreenMap.closed",function(){a.element.removeClass("MapOpen");b.events.publish("horizontalFilters.resizeContent")});this.subscribe("resultspage.cleanup",function(){a.element.removeClass("MapOpen");b.events.publish("horizontalFilters.resizeContent");a.topHotelsContainer&&a.topHotelsContainer.html("")});this.subscribe(["show.right.rail.map.item"],
function(b){a.showMapResultItem(b)});if(this.options.rentalsXSellTopEnabled||this.options.rentalsXSellBottomEnabled)this.subscribe("resultspage.searchId.changed",function(b){a.fetchRentalsXSell(b.searchId)}),this.subscribe("search.startSearch",function(){a.clearRentalXSell()});this.options.emergencyAlertsEnabled&&(this.subscribe("resultspage.searchId.changed",function(b){a.fetchEmergencyAlerts(b.searchId)}),this.subscribe("search.startSearch",function(){a.clearEmergencyAlerts()}));this.options.nonInstantBookingBannerEnabled&&
this.subscribe("search.startSearch",function(){a.nonInstantBookingBannerVisible=!1;a.clearNonInstantBookingBanner()});this.subscribe("search.startSearch",this.showPlaceholders.bind(this));this.subscribe("search.startSearch",function(){a.insightsWrapper&&a.insightsWrapper.html("")});this.subscribe("resultspage.streaming.done",this.hidePlaceholders.bind(this));this.subscribe("resultspage.streaming.done",this.logIfEmployeeVerified.bind(this));this.subscribe("resultspage.streaming.done",this.positionFiltersList.bind(this));
this.options.premiumHomesEnabled&&this.subscribe("resultspage.streaming.start",this.showPremiumContent.bind(this));this.subscribe("inlineSearchFormUpdated",function(){a.options.pinnedHid=null});b.config.getBoolean("ui.horizon.hotels.useBuzzForInlineSearches",!0)&&this.subscribe("inlineSearchFormUpdated",function(b){a.fetchBuzzResults(b.cityId)});a.options.suppressRegionDistance&&this.subscribe("search.poll.response",function(a){a.regionSearch?(jq("div.Common-Results-Filters-DistanceFilter:not(.Common-Results-Filters-FilterDropdownDialog-Content)").hide(),
b.events.publish("results.distance.sort.hide")):(jq("div.Common-Results-Filters-DistanceFilter:not(.Common-Results-Filters-FilterDropdownDialog-Content)").show(),b.events.publish("results.distance.sort.show"))});"dualview"===this.options.mapVersionCode?(this.subscribe("hotels.results.dualViewMap.toggle",this.toggleDualViewMap.bind(this)),this.setupStickyDualViewMap(),this.options.showMap&&(this.toggleDualViewMap(),setTimeout(function(){b.events.publish("hotels.results.dualViewMap.open")},1E3))):"fullscreendrawer"===
this.options.mapVersionCode&&(this.subscribe("hotels.results.dualViewMap.toggle",this.toggleFullscreenDrawerMap.bind(this)),this.options.showMap&&(this.toggleFullscreenDrawerMap(),setTimeout(function(){b.events.publish("hotels.results.dualViewMap.open")},1E3)));this.subscribe("hotels.taxes.complicated.show",function(){a.complicated.removeClass("hidden");a.complicated.find(".complex").addClass("hidden");var b=a.complicated.find("."+a.options.countryCode);b&&0!==b.length?b.removeClass("hidden"):a.complicated.find(".ALL").removeClass("hidden")});
this.subscribe("hotels.taxes.complicated.hide",function(){a.complicated.addClass("hidden");a.complicated.find(".complex").addClass("hidden")});this.registerEvent("click",this.getChildElement("comparePromoClose"),function(){a.getChildElement("hotelComparePromo").hide()});if(this.options.horizontalFiltersStickyV2||"dualview"===this.options.mapVersionCode)this.setupStickyHorizontalFilters(),b.question.answer("hotels.results.filtersPinned",function(){return a.filtersPinned});this.options.hotelTagsEnabled&&
(this.subscribe("hotels.results.hotelTags.filters.change",this.updateHotelTagsDisplay.bind(this)),this.subscribe("hotels.results.dualViewMap.open",this.updateHotelTagsDisplay.bind(this,{visible:!1})),this.subscribe("hotels.results.dualViewMap.closed",this.updateHotelTagsDisplay.bind(this,{visible:!0})));this.options.drawOnMapEnabled&&this.subscribe("hotels.results.callStartSearch",this.startSearch.bind(this));if(this.options.isMomondo){var a=this,c=this.getChildElement("expandMapTrigger");this.subscribe("hotels.map.fullscreen.close",
function(){a.element.removeClass("map-expanded")});c.click(function(){b.events.publish("hotels.map.fullscreen.open");a.element.addClass("map-expanded")})}this.answer("inlineSearch.height",function(){return a.getChildElement("inlineSearch").is(":visible")?a.getChildElement("inlineSearch").outerHeight():0});this.answer("hotels.resultspage.pageView",function(){return a.pageView});this.answer("hotels.resultspage.pageView.shouldLogFilter",function(b){return null!=b&&b.hasOwnProperty("filterEl")?(b=d(b.filterEl).hasClass("horizontal"))&&
"map"===a.pageView||!b&&"list"===a.pageView:!1});this.options.covidLoadingModal&&this.subscribe("resultspage.streaming.start",function(){setTimeout(function(){b.events.publish("hotels.results.covid.loadingModal.show")},700)});this.answer("hotels.resultspage.isMapViewOpened",function(){return a.mapViewOpened})},logIfEmployeeVerified:function(){this.options.showVerified&&b.Analytics.api.trackEvent({subPageId:"ResultsPage",category:"employeeVerified",action:"shown/"+this.searchId})},inlineComponentsReady:function(){this.base();
var a=b.storage.get("R9ScrollY");a&&(this.options.manualScrolling?b.events.subscribe("resultspage.streaming.done",function(){window.scrollTo(0,a);b.storage.remove("R9ScrollY")}):(window.scrollTo(0,a),b.storage.remove("R9ScrollY")));this.positionFiltersList()},startSearch:function(a){this.base(a);this.showPlaceholders()},showPlaceholders:function(a){this.options.resultsPlaceholderEnabled&&(a||"undefined"===typeof a?(d("#searchResultsList").addClass("hidden"),this.resultsPlaceholder.addClass("visible"),
this.bestplaceholder&&this.bestplaceholder.addClass("visible")):(this.resultsPlaceholder.removeClass("visible"),d("#searchResultsList").removeClass("hidden"),this.bestplaceholder&&this.bestplaceholder.removeClass("visible")))},hidePlaceholders:function(){this.showPlaceholders(!1)},onFilterStateChange:function(a){this.base(a);this.options.scrollTopOnFilterChange&&window.scrollTo(0,0)},checkFilteredCountForPreservedFilters:function(){var a=this;this.preserveFilters&&(this.options.nonClearablePreservedFilters.forEach(function(b){a.preservedFilters.hasOwnProperty(b)}),
this.clearPreservedFilters())},showMapResultItem:function(a){var c=this,d=this.getChildElement("mapitem");d.html('\x3cdiv style\x3d"height:665px;"\x3e\x26nbsp;\x3c/div\x3e');d.css({display:"block",minHeight:"202px"});b.ajax.execute("hotels/results/HotelSideMapResultItem",{appendTo:d,replace:!0,data:{searchId:a.searchId,resultId:a.resultId,isSeo:b.globals.isSeo},afterScript:function(){c.element.find(".map-result-item-close").on("click",function(){d.html("");d.css({display:"none",minHeight:"0"})})}}).then(function(a,
c){202===c.status&&b.events.publish("results.expired")});b.Analytics.api.trackEvent("fullscreenmap/openDetails")},destroyBuzzResults:function(){this.resultsList.find(".buzzResult, .placeholder").remove()},didReceiveResults:function(a){a.completed?(b.events.ready("hotels.results.search.finished",a),this.fetchUrgencyMessaging(),this.checkFilteredCountForPreservedFilters({filtered:a.filteredCount,total:a.totalCount}),this.options.showHackerStayCallout&&a.containsHackerStay&&b.events.publish("hotels.results.hackerStayCallout.show"),
d("#searchResultsList").addClass("finished"),this.buzzPromise&&this.buzzPromise.abort&&this.buzzPromise.abort()):b.events._globals["hotels.results.search.finished"]&&(b.events.unready("hotels.results.search.finished"),d("#searchResultsList").hasClass("finished")&&d("#searchResultsList").removeClass("finished"));if(a.showPriceAlerts){var c={view:"create"};a.existingAlertId&&(c.view="edit");b.events.publish("hotels.priceAlert.setview",c)}a.hasOwnProperty("resultsOrderLogString")&&b.events.publish("clickout.resultsOrder.update",
a.resultsOrderLogString);a.hasOwnProperty("paginatorText")&&b.events.publish("paginator.text.set",a.paginatorText);this.options.countryCode=a.countryCode;a.taxesComplicated?b.events.publish("hotels.taxes.complicated.show"):b.events.publish("hotels.taxes.complicated.hide");a.showAmbianceSort?b.events.publish("hotels.curatedSortSelector.show"):b.events.publish("hotels.curatedSortSelector.hide");a.comparisonModalParams&&b.events.publish("hotels.results.compare.modal.reset",a.comparisonModalParams);this.options.dualReactMapEnabled&&
this.publishReactMapEvents(a)},publishReactMapEvents:function(a){(a.searchStartedThisPoll||a.completed)&&b.events.publish("hotels.results.react.searchUpdated",{searchId:a.searchId,priceMode:a.priceMode,savedHids:a.savedResultIds?a.savedResultIds.map(function(a){return parseInt(a,10)}):null,filtersData:a.completed?a.encodedFilteredBitset:null});if(a.filtersData&&a.filtersData.location){a=a.filtersData.location;var c="adr"===a.lmType;a.lmId||c?b.events.publish("hotels.results.react.pinnedLandmark",
{pinnedLandmark:a}):b.events.publish("hotels.results.react.clearPinnedLandmark")}else b.events.publish("hotels.results.react.clearPinnedLandmark")},cleanupExistingSearch:function(){this.base();this.urgencyMessenger&&(this.urgencyMessenger.cleanUp(),this.urgencyMessenger=void 0)},onResultsListHeaderChange:function(a){this.options.sortAmbianceCodes=a.sort&&"ambiance"===a.sort.sortType?a.sortCode.replace("ambiance_",""):null;this.base(a)},mergeSortStateWithUrl:function(a){var b;b=a&&-1<a.indexOf("ambiance_")&&
this.options.sortAmbianceCodes?this.mergeStateWithUrl(this.options.sortAmbianceCodes,"amb"):this.mergeStateWithUrl(!0,"amb");return this.mergeStateWithUrl(a,"sort",b)},getFetchResultsOpts:function(){var a=this.base();null!==this.options.reviewType&&(a.reviewType=this.options.reviewType);null!==this.options.quickLinkType&&(a.quickLinkType=this.options.quickLinkType);null!==this.options.centerPointLat&&null!==this.options.centerPointLong&&(a.centerPointLat=this.options.centerPointLat,a.centerPointLong=
this.options.centerPointLong);null!==this.options.pinnedHid&&(a.pinnedHid=this.options.pinnedHid);this.options.sortAmbianceCodes&&(a.ambianceCodes=this.options.sortAmbianceCodes);a.collectFilteredHids=this.options.dualReactMapEnabled;return a},handleError:function(a){this.base(a);this.options.useBuzz&&this.destroyBuzzResults()},preprocessResponse:function(a){this.base(a);(this.searchId||"searchId"in a)&&a&&(!1===this.poll.firstPhaseCompleted||a.completed)&&b.events.publish("resultspage.update.location");
a&&"showPriceAlerts"in a&&b.events.publish("hotels.results.priceAlertEnabled",{visible:a.showPriceAlerts,enabled:a.priceAlertsEnabled});this.options.nonInstantBookingBannerEnabled&&a.containsNonInstantBookingProviders&&this.fetchNonInstantBookingBanner();this.options.neighborhoodCardEnabled&&this.populateNeighborhoodCard(a)},populateNeighborhoodCard:function(a){b.events.publish("hotels.results.neighborhood-information",{name:a.sharingData?a.sharingData.cityName:"",imageUrl:a.sharingData?a.sharingData.cityImageUrl:
"",neighborhoods:d.extend({},a.neighborhoods),nhFilter:d.extend({},a.filtersData.neighborhoods),searchId:this.searchId})},fetchUrgencyMessaging:function(){if(void 0===this.urgencyMessenger&&this.options.showUrgencyBubbles&&this.searchId&&this.options.sparkleUrgencyMessage)try{this.urgencyMessenger=this.makeUrgencyMessenger(),this.urgencyMessenger.fetchAndDisplay()}catch(a){}},makeUrgencyMessenger:function(a){var c={searchId:this.searchId,containerElement:document.body,url:"/s/run/hotelbookmsg",toastLength:this.options.urgencyOnscreenMillis};
void 0!==a&&(c.hotelId=a,c.url+="/hid",c.containerElement=document.getElementById(a));return new b.Hotels.UrgencyMessaging(c)},endPolling:function(){this.base.apply(this,arguments);this.fetchResultsBannerPercentage();d("#searchResultsList").addClass("finished")},fetchResultsBannerPercentage:function(){var a=this;this.options.showResultsBanner&&this.searchId&&this.resultsBannerId!==this.searchId&&(this.resultsBannerId=this.searchId,d.ajax({type:"POST",dataType:"json",url:"/s/run/hotelbookmsg/fillrate",
data:{searchid:this.searchId},success:function(b){b&&b.hasOwnProperty("fillRate")&&.3<b.fillRate&&.9>=b.fillRate&&a.fetchResultsBanner(b)},error:function(a,b){console.error("FillRate.fetchAndDisplay failed: "+b)}}))},clearRentalXSell:function(){this.options.rentalsXSellTopEnabled&&this.getChildElement("rentalXSellTop").empty();this.options.rentalsXSellBottomEnabled&&this.getChildElement("rentalXSellBottom").empty()},fetchRentalsXSell:function(a){a&&(this.options.rentalsXSellTopEnabled&&b.ajax.execute("hotels/results/RentalsXSell",
{data:{searchId:this.searchId,aboveResults:!0},appendTo:this.getChildElement("rentalXSellTop"),replace:!0}),this.options.rentalsXSellBottomEnabled&&b.ajax.execute("hotels/results/RentalsXSell",{data:{searchId:this.searchId,aboveResults:!1},appendTo:this.getChildElement("rentalXSellBottom"),replace:!0}))},fetchEmergencyAlerts:function(a){a&&b.ajax.execute("hotels/results/HotelQueryAlerts",{data:{searchId:a},appendTo:this.getChildElement("emergencyAlertsContainer"),replace:!0})},clearEmergencyAlerts:function(){this.getChildElement("emergencyAlertsContainer").empty()},
clearNonInstantBookingBanner:function(){this.options.nonInstantBookingBannerEnabled&&this.getChildElement("nonInstantBookingBanner").empty()},fetchNonInstantBookingBanner:function(){var a=sessionStorage.getItem("nonInstantBannerHidden");this.nonInstantBookingBannerVisible||a||(this.nonInstantBookingBannerVisible=!0,b.Analytics.api.trackEvent({category:"nonInstantBookingBanner",action:"show"}),b.ajax.execute("hotels/results/NonInstantBookingBanner",{appendTo:this.getChildElement("nonInstantBookingBanner"),
replace:!0}))},logPromiseError:function(a){console.error(a)},fetchResultsBanner:function(a){var c;c=a.hasOwnProperty("cityID")?a.cityID:this.getSearchCityId();a.hasOwnProperty("fillRate")&&null!==c&&(a=parseInt(Math.round(100*a.fillRate),10),c={searchId:this.searchId,cityId:c,percentage:a},a=this.options.useTopBannerContainer?"resultBannerContainerTop":"resultBannerContainer",b.ajax.execute("hotels/results/HotelResultsBanner",{data:c,appendTo:this.getChildElement(a),replace:!0}),this.options.flexDatesCardLayout&&
(a=this.options.useTopBannerContainer?"flexDatesContainerTop":"flexDatesContainer",b.ajax.execute("hotels/results/CityFillRateAlternativeDates",{data:c,appendTo:this.getChildElement(a),replace:!0})))},getSearchCityId:function(){return b.question.ask("hotels.rp.searchform.citycode")||b.question.ask("hotels.fd.searchform.citycode")},getSearchNumNights:function(){return b.question.ask("hotels.rp.searchform.numNights")||b.question.ask("hotels.fd.searchform.numNights")},getSearchDaysOut:function(){return b.question.ask("hotels.rp.searchform.daysOut")||
b.question.ask("hotels.fd.searchform.daysOut")},fetchBuzzResults:function(a){var c=this,e=a||b.question.ask("hotels.fd.searchform.citycode")||b.question.ask("hotels.rp.searchform.citycode");a="city"===b.question.ask("hotels.results.searchType");e&&a&&(this.buzzListCache[e]?(d("#searchResultsList").replaceWith(this.buzzListCache[e].clone()),this.removeTransitionClass()):e&&0<e&&(this.buzzPromise=b.ajax.execute("hotels/results/HotelBuzzResultsList",{data:{cityId:e},appendTo:c.resultsList,replace:!0,
afterScript:function(){var a=d("#searchResultsList");a.find(".buzzResult").length&&(c.buzzListCache[e]=a.clone(),c.removeTransitionClass())}}),this.subscribe("searchform.submit",function(){c.buzzPromise.abort()})))},removeTransitionClass:function(){this.hidePlaceholders();this.base()},doCustomUpdate:function(a){return!a.append&&b.config.getBoolean("ui.horizon.hotels.resultspage.mergeDOM",!0)},getHotelIdsOnPage:function(){var a=this.element.find(".Hotels-Results-HotelResultItem");return a.length?a.map(function(){return d(this).data("resultid")}).get():
[]},firstResultsRendered:function(){this.options.useBuzz&&(this.doCustomUpdate({})||this.destroyBuzzResults())},skipLoadingTreatment:function(){return this.options.resultsPlaceholderEnabled||this.options.useBuzz&&0<this.resultsList.find(".Hotels-Results-HotelResultItem").length},toggleDualViewMap:function(){var a=this;this.element.hasClass("dual-view-map")?(this.filtersPinned&&(this.horizontalFiltersWrapper.append(this.horizontalFiltersWrapperFixed.children().detach()),this.horizontalFiltersWrapperFixed.removeClass("fixed"),
this.filtersPinned=!1),this.element.removeClass("dual-view-map"),this.element.addClass("dual-view-map-slide-out"),a.options.edgeToEdgeMap&&this.element.removeClass("edge-to-edge-map"),setTimeout(function(){a.element.removeClass("dual-view-map-slide-in");a.element.removeClass("dual-view-map-slide-out");b.events.publish("hotels.results.dualViewMap.finished-closing-animation")},500),b.events.publish("hotels.results.dualViewMap.closed"),this.pageView="list",this.mapViewOpened=!1):(this.element.addClass("dual-view-map-slide-in"),
setTimeout(function(){a.element.addClass("dual-view-map")},this.options.dualReactMapEnabled?0:500),a.options.edgeToEdgeMap&&this.element.addClass("edge-to-edge-map"),b.events.publish("hotels.results.dualViewMap.open"),this.pageView="map",this.mapViewOpened=!0);this.toggleDualReactMap();b.events.publish("hotels.results.dualViewMap.initMap")},toggleDualReactMap:function(){if(this.options.dualReactMapEnabled){var a="list"===this.pageView;b.Analytics.api.trackEvent({category:"reactMap",action:a?"hide":
"show"});window.scrollTo(0,0);a?(jq(".pageGrid").css("display","flex"),jq(".react-map-view").css("display","none"),jq("footer").css("display","block"),this.backToTop.removeClass("mapView"),this.options.permanentlyPinnedFilters&&(jq(".inlineSearch").css("display","block"),this.horizontalFiltersWrapper.append(this.horizontalFiltersWrapperFixed.children().detach()),this.horizontalFiltersWrapperFixed.removeClass("fixed"),this.filtersPinned=!1)):(this.backToTop.addClass("mapView"),jq(".pageGrid").css("display",
"none"),jq(".react-map-view").css("display","flex"),jq("footer").css("display","none"),b.events.publish("hotels.results.reactmap.recenter"),this.options.permanentlyPinnedFilters&&(jq(".inlineSearch").css("display","none"),this.horizontalFiltersWrapperFixed.append(this.horizontalFiltersWrapper.children().detach()).addClass("fixed"),this.filtersPinned=!0))}},toggleFullscreenDrawerMap:function(){var a=this,c=this.element.hasClass("map-open");this.element.hasClass("map-closed")?(this.element.removeClass("map-closed"),
this.element.addClass("map-open"),this.element.addClass("map-open-animating"),setTimeout(function(){a.element.removeClass("map-open-animating");b.events.publish("hotels.results.dualViewMap.finished-opening-animation")},2E3),b.events.publish("hotels.results.dualViewMap.open")):c&&(this.element.removeClass("map-open"),this.element.addClass("map-closed"),this.element.addClass("map-closed-animating"),setTimeout(function(){a.element.removeClass("map-closed-animating");b.events.publish("hotels.results.dualViewMap.finished-closing-animation")},
2E3),b.events.publish("hotels.results.dualViewMap.closed"));b.events.publish("hotels.results.dualViewMap.initMap")},updateHotelTagsDisplay:function(a){if(a||a.hasOwnProperty("visible")){var b=this.element.hasClass("dual-view-map");this.element.toggleClass("tags-list-enabled",a.visible&&!b)}},setupHotelsComparePromo:function(){var a=this.getChildElement("hotelComparePromo");this.checkShowHotelsCompareBanner()&&(a.show(),this.disableHotelsCompareBanner())},disableHotelsCompareBanner:function(){b.storage.set("disableHotelsCompareBanner",
"true")},checkShowHotelsCompareBanner:function(){return b.storage.get("disableHotelsCompareBanner")?!1:!0},setupStickyHorizontalFilters:function(){window.addEventListener("scroll",this.positionFiltersList.bind(this))},showPremiumContent:function(){var a=this.getSearchCityId(),c=this.getSearchNumNights(),d=this.getSearchDaysOut();this.isPremiumEnabled(a,c,d)&&b.events.publish("hotels.results.showPremiumContent",{premiumCount:0,cityId:a})},isPremiumEnabled:function(a,b,d){var c=this._options.citySpecificMinNights[a];
return a&&0<=this._options.premiumHomesCtids.indexOf(a)&&b&&b>=this.options.minNumNightsForPremium&&("undefined"===typeof c||c<=b)&&d&&d>=this.options.minDaysOutPremium},positionFiltersList:function(){if(!this.options.permanentlyPinnedFilters){var a=this.options.horizontalFiltersScrollOffsetY,c=!1;!this.filtersPinned&&window.pageYOffset>a&&this.element.hasClass("dual-view-map")?(this.horizontalFiltersWrapperFixed.append(this.horizontalFiltersWrapper.children().detach()).addClass("fixed"),c=!this.filtersPinned,
this.filtersPinned=!0):this.filtersPinned&&window.pageYOffset<=a&&(this.horizontalFiltersWrapper.append(this.horizontalFiltersWrapperFixed.children().detach()),this.horizontalFiltersWrapperFixed.removeClass("fixed"),c=this.filtersPinned,this.filtersPinned=!1);c&&b.events.publish("hotels.results.horizontalFilters.pinned",{filtersPinned:this.filtersPinned})}},setupStickyDualViewMap:function(){var a=this;window.addEventListener("scroll",function(){var b=a.element.hasClass("dual-view-map");a.updateDualViewMapYPosition(b);
b&&!a.options.edgeToEdgeMap&&d(window).width()<a.options.contentWidth&&a.getChildElement("rightRail").css("transform","translateX("+(a.options.dualViewMapOffsetX-window.scrollX)+"px)")});d(window).resize(function(){d(window).width()>=a.options.contentWidth&&a.getChildElement("rightRail").css("transform","")});this.subscribe(["hotel.result.click","hotel.inline.detail.loaded","hotel.inline.detail.heightChanged","horizontal.multibook.showOverflow","dialog.close"],function(){setTimeout(function(){a.updateDualViewMapYPosition(a.element.hasClass("dual-view-map"))},
400)});this.subscribe("paginator.update",function(){a.updateDualViewMapYPosition(a.element.hasClass("dual-view-map"))})},updateDualViewMapYPosition:function(a){var b=this.options.dualViewFooterScrollOffsetY;this.dualViewMapPinned&&a&&this.calcScrollYOffset()<=b?(this.getChildElement("rightRail").addClass("dual-view-map-fixed-bottom"),this.dualViewMapPinned=!1):this.dualViewMapPinned||a&&!(this.calcScrollYOffset()>b)||(this.getChildElement("rightRail").removeClass("dual-view-map-fixed-bottom"),this.dualViewMapPinned=
!0)},calcScrollYOffset:function(){return d(document).height()-d(window).height()-d(window).scrollTop()},toggleMapVisibility:function(a){"open"===a?(this.rightRail.classList.add("map-expanded"),this.hotelsResultsHotelResultsPage.classList.add("map-expanded")):(this.rightRail.classList.remove("map-expanded"),this.hotelsResultsHotelResultsPage.classList.remove("map-expanded"))},mergeStateWithUrl:function(a,b,d){return this.base(a,b,d)}})})(R9,jQuery);(new R9.logger).timeEnd("combined");