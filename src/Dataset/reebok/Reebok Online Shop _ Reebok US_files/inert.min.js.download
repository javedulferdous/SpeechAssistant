(function(h,k){"object"===typeof exports&&"undefined"!==typeof module?k():"function"===typeof define&&define.amd?define("inert",k):k()})(this,function(){function h(c,a,d){if(c.nodeType==Node.ELEMENT_NODE){a&&a(c);var b=c.shadowRoot||c.webkitShadowRoot;if(b){h(b,a,b);return}if("content"==c.localName){c=c.getDistributedNodes?c.getDistributedNodes():[];for(b=0;b<c.length;b++)h(c[b],a,d);return}if("slot"==c.localName){c=c.assignedNodes?c.assignedNodes({flatten:!0}):[];for(b=0;b<c.length;b++)h(c[b],a,
d);return}}for(c=c.firstChild;null!=c;)h(c,a,d),c=c.nextSibling}function k(c){if(!c.querySelector("style#inert-style")){var a=document.createElement("style");a.setAttribute("id","inert-style");a.textContent="\n[inert] {\n\tpointer-events: none;\n\tcursor: default;\n}\n\n[inert], [inert] * {\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n}\n";c.appendChild(a)}}var m=function(c,a){var d=window.Element.prototype;d=d.matches||d.mozMatchesSelector||
d.msMatchesSelector||d.oMatchesSelector||d.webkitMatchesSelector;if(!c||1!==c.nodeType)return!1;var b=c.parentNode;if(d)return d.call(c,a);a=b.querySelectorAll(a);d=a.length;for(b=0;b<d;b++)if(a[b]===c)return!0;return!1},n=function(c,a){if(!(c instanceof a))throw new TypeError("Cannot call a class as a function");},p=function(){function c(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(a,
d,b){d&&c(a.prototype,d);b&&c(a,b);return a}}(),l=Array.prototype.slice,q=function(){function c(a,d){n(this,c);this._inertManager=d;this._rootElement=a;this._managedNodes=new Set([]);this._rootElement.hasAttribute("aria-hidden")&&(this._savedAriaHidden=this._rootElement.getAttribute("aria-hidden"));this._rootElement.setAttribute("aria-hidden","true");this._makeSubtreeUnfocusable(this._rootElement);this._observer=new MutationObserver(this._onMutation.bind(this));this._observer.observe(this._rootElement,
{attributes:!0,childList:!0,subtree:!0})}p(c,[{key:"destructor",value:function(){this._observer.disconnect();this._observer=null;this._rootElement&&(this.hasSavedAriaHidden?this._rootElement.setAttribute("aria-hidden",this.savedAriaHidden):this._rootElement.removeAttribute("aria-hidden"));this._rootElement=null;this._managedNodes.forEach(function(a){this._unmanageNode(a.node)},this);this._inertManager=this._managedNodes=null}},{key:"managedNodes",get:function(){return new Set(this._managedNodes)}},
{key:"hasSavedAriaHidden",get:function(){return"_savedAriaHidden"in this}},{key:"savedAriaHidden",set:function(a){this._savedAriaHidden=a},get:function(){return this._savedAriaHidden}},{key:"_makeSubtreeUnfocusable",value:function(a){var d=this;h(a,function(f){return d._visitNode(f)});var b=document.activeElement;if(!document.body.contains(a)){for(var e=a,g=void 0;e;){if(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE){g=e;break}e=e.parentNode}g&&(b=g.activeElement)}a.contains(b)&&(b.blur(),b===document.activeElement&&
document.body.focus())}},{key:"_visitNode",value:function(a){a.nodeType===Node.ELEMENT_NODE&&(a!==this._rootElement&&a.hasAttribute("inert")&&this._adoptInertRoot(a),(m(a,"a[href],area[href],input:not([disabled]),select:not([disabled]),textarea:not([disabled]),button:not([disabled]),iframe,object,embed,[contenteditable]")||a.hasAttribute("tabindex"))&&this._manageNode(a))}},{key:"_manageNode",value:function(a){a=this._inertManager.register(a,this);this._managedNodes.add(a)}},{key:"_unmanageNode",
value:function(a){(a=this._inertManager.deregister(a,this))&&this._managedNodes.delete(a)}},{key:"_unmanageSubtree",value:function(a){var d=this;h(a,function(b){return d._unmanageNode(b)})}},{key:"_adoptInertRoot",value:function(a){var d=this._inertManager.getInertRoot(a);d||(this._inertManager.setInert(a,!0),d=this._inertManager.getInertRoot(a));d.managedNodes.forEach(function(b){this._manageNode(b.node)},this)}},{key:"_onMutation",value:function(a,d){a.forEach(function(b){var e=b.target;if("childList"===
b.type)l.call(b.addedNodes).forEach(function(f){this._makeSubtreeUnfocusable(f)},this),l.call(b.removedNodes).forEach(function(f){this._unmanageSubtree(f)},this);else if("attributes"===b.type)if("tabindex"===b.attributeName)this._manageNode(e);else if(e!==this._rootElement&&"inert"===b.attributeName&&e.hasAttribute("inert")){this._adoptInertRoot(e);var g=this._inertManager.getInertRoot(e);this._managedNodes.forEach(function(f){e.contains(f.node)&&g._manageNode(f.node)})}},this)}}]);return c}(),r=
function(){function c(a,d){n(this,c);this._node=a;this._overrodeFocusMethod=!1;this._inertRoots=new Set([d]);this._destroyed=!1;this.ensureUntabbable()}p(c,[{key:"destructor",value:function(){this._throwIfDestroyed();this._node&&(this.hasSavedTabIndex?this._node.setAttribute("tabindex",this.savedTabIndex):this._node.removeAttribute("tabindex"),this._overrodeFocusMethod&&delete this._node.focus);this._inertRoots=this._node=null;this._destroyed=!0}},{key:"destroyed",get:function(){return this._destroyed}},
{key:"_throwIfDestroyed",value:function(){if(this.destroyed)throw Error("Trying to access destroyed InertNode");}},{key:"hasSavedTabIndex",get:function(){return"_savedTabIndex"in this}},{key:"node",get:function(){this._throwIfDestroyed();return this._node}},{key:"savedTabIndex",set:function(a){this._throwIfDestroyed();this._savedTabIndex=a},get:function(){this._throwIfDestroyed();return this._savedTabIndex}},{key:"ensureUntabbable",value:function(){var a=this.node;m(a,"a[href],area[href],input:not([disabled]),select:not([disabled]),textarea:not([disabled]),button:not([disabled]),iframe,object,embed,[contenteditable]")?
-1===a.tabIndex&&this.hasSavedTabIndex||(a.hasAttribute("tabindex")&&(this._savedTabIndex=a.tabIndex),a.setAttribute("tabindex","-1"),a.nodeType===Node.ELEMENT_NODE&&(a.focus=function(){},this._overrodeFocusMethod=!0)):a.hasAttribute("tabindex")&&(this._savedTabIndex=a.tabIndex,a.removeAttribute("tabindex"))}},{key:"addInertRoot",value:function(a){this._throwIfDestroyed();this._inertRoots.add(a)}},{key:"removeInertRoot",value:function(a){this._throwIfDestroyed();this._inertRoots.delete(a);0===this._inertRoots.size&&
this.destructor()}}]);return c}(),u=new (function(){function c(a){n(this,c);if(!a)throw Error("Missing required argument; InertManager needs to wrap a document.");this._document=a;this._managedNodes=new Map;this._inertRoots=new Map;this._observer=new MutationObserver(this._watchForInert.bind(this));k(a.head||a.body||a.documentElement);"loading"===a.readyState?a.addEventListener("DOMContentLoaded",this._onDocumentLoaded.bind(this)):this._onDocumentLoaded()}p(c,[{key:"setInert",value:function(a,d){if(d){if(!this._inertRoots.has(a)&&
(d=new q(a,this),a.setAttribute("inert",""),this._inertRoots.set(a,d),!this._document.body.contains(a)))for(a=a.parentNode;a;)11===a.nodeType&&k(a),a=a.parentNode}else this._inertRoots.has(a)&&(this._inertRoots.get(a).destructor(),this._inertRoots.delete(a),a.removeAttribute("inert"))}},{key:"getInertRoot",value:function(a){return this._inertRoots.get(a)}},{key:"register",value:function(a,d){var b=this._managedNodes.get(a);void 0!==b?(b.addInertRoot(d),b.ensureUntabbable()):b=new r(a,d);this._managedNodes.set(a,
b);return b}},{key:"deregister",value:function(a,d){var b=this._managedNodes.get(a);if(!b)return null;b.removeInertRoot(d);b.destroyed&&this._managedNodes.delete(a);return b}},{key:"_onDocumentLoaded",value:function(){l.call(this._document.querySelectorAll("[inert]")).forEach(function(a){this.setInert(a,!0)},this);this._observer.observe(this._document.body,{attributes:!0,subtree:!0,childList:!0})}},{key:"_watchForInert",value:function(a,d){a.forEach(function(b){switch(b.type){case "childList":l.call(b.addedNodes).forEach(function(g){if(g.nodeType===
Node.ELEMENT_NODE){var f=l.call(g.querySelectorAll("[inert]"));m(g,"[inert]")&&f.unshift(g);f.forEach(function(t){this.setInert(t,!0)},this)}},this);break;case "attributes":if("inert"===b.attributeName){b=b.target;var e=b.hasAttribute("inert");this.setInert(b,e)}}},this)}}]);return c}())(document);Object.defineProperty(Element.prototype,"inert",{enumerable:!0,get:function(){return this.hasAttribute("inert")},set:function(c){u.setInert(this,c)}})});
