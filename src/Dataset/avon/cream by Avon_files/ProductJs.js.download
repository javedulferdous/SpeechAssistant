var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},MobileNavigationModule,MobileProductListModule,ShopByLineNumberServiceModule,ProductDetailModule,ProductListModule,ShopByLineNumberModule;(function(n){var t=function(n){function t(t,i,r,u){var f=this;n.call(this,t);this.$commonScope=t;this.$window=i;this.intersectionObserverService=r;this.$q=u;this.powerReviewsObservedCallback=function(n,t,i){for(var o,u,r=0,e=n;r<e.length;r++)o=e[r],o.isIntersecting&&(u=document.createElement("script"),u.type="text/javascript",u.src="https://ui.powerreviews.com/stable/4.0/ui.js",document.head.appendChild(u),f.waitForPowerReviewsToBeDefined().then(function(){f.$window.POWERREVIEWS.display.render({api_key:i.prApiKey,locale:i.prLocale,merchant_group_id:i.prMerchantGrouId,merchant_id:i.prMerchantId,page_id:i.productId,review_wrapper_url:i.reviewProductUrl,components:{ReviewDisplay:i.containerId},languages:[{name:i.prLanguage,locale:i.prLocale,merchant_id:i.prMerchantId},{name:i.prLanguage2,locale:i.prLocale2,merchant_id:i.prMerchantId2}]})}),f.intersectionObserverService.Unobserve(t,o.target))};t.product=AVON.product;t.ShowPDPCarouselTopCrossSells=function(){var n=t.product.HasCrossSells&&t.product.CrossSellProductIds.length>0&&t.DisplayCrossSells;return n||f.isCertonaProductAvailable("product1_rr")};t.ShowPDPCarouselBottomCrossSells=function(){var n=t.product.CustomerBuys&&t.product.CustomerBuys.length>0&&t.DisplayCustomerBuys;return n||f.isCertonaProductAvailable("product2_rr")};t.InitPowerReviewsContainer=function(n,t,i,r,u,e,o,s,h,c,l){_.delay(function(){f.lazyLoadPowerReviewsContent({containerId:n,prApiKey:t,prLocale:i,prMerchantGrouId:r,prMerchantId:u,productId:e,reviewProductUrl:o,prLanguage:s,prLocale2:h,prMerchantId2:c,prLanguage2:l})},1e3)}}return __extends(t,n),t.prototype.checkCertonaProductAvailability=function(n){var t=!1;for(var i in this.$commonScope.LoadedProducts)if(this.$commonScope.LoadedProducts.hasOwnProperty(i)&&n.ProductIds.indexOf(+i)>=0){t=!0;break}return t},t.prototype.isCertonaProductAvailable=function(n){var t=this.$commonScope.ProductRecommendations[n],i=t&&t.ProductIds.length>0;return i&&this.checkCertonaProductAvailability(t)},t.prototype.lazyLoadPowerReviewsContent=function(n){var r=this,t=angular.element("#"+n.containerId),i;t&&(i={threshold:[.01],rootMargin:"50px 0px"},this.intersectionObserverService.Observe(t,function(t,i){r.powerReviewsObservedCallback(t,i,n)},i))},t.prototype.waitForPowerReviewsToBeDefined=function(){var n=this,t=this.$q.defer();return this.wait(function(){return n.$window.POWERREVIEWS?!0:!1},function(){t.resolve(n.$window)}),t.promise},t.prototype.wait=function(n,t){var i=this;n()?t():setTimeout(function(){i.wait(n,t)},200)},t}(BaseAngularController);n.CommonProductDetailController=t})(ProductDetailModule||(ProductDetailModule={})),function(n){var t=function(n){function t(t,i,r){n.call(this,t,i);this.$scope=t;this.trackingService=r;this.sortingFilters=SortingCriteriaProviderModule.SortingCriteriaProvider.GetSortingFilters(t.isCustomerAttachedOrCookiedToRep())}return __extends(t,n),t.prototype.trackSearchResultsEvent=function(){var t=0,i,n;this.$scope.products&&this.$scope.products[0]!=null&&(t=this.$scope.AutoCorrectedSearchTerm.length==0&&this.$scope.products.length>0&&this.$scope.IsDeadEndSearch?0:this.$scope.products.length);i=location.href;n=document.referrer;n&&(n.indexOf("?")>-1&&(n=n.split("?")[0]),i=n.replace(/^[^:]+:\/\/[^/]+/,"").replace(/#.*/,""));this.trackingService.TrackViewEvent({event_name:"site_search",site_search_query:AVON.SearchTerm,site_search_results:t===0?"ZERO":t,site_search_status:t===0?"FAIL":"SUCCESS",site_search_page:i})},t.prototype.productInBetweenSelectedPrice=function(n){if(_.isUndefined(this.$scope.priceRangeModel)||!this.$scope.PriceRangeFacetSelected||this.$scope.priceRangeModel.minimum===0&&this.$scope.priceRangeModel.maximum===0)return!0;var t=this.getLowestProductPrice(n);return t>=this.$scope.priceRangeModel.minimum&&t<=this.$scope.priceRangeModel.maximum?!0:!1},t.prototype.getLowestProductPrice=function(n){var i=this.$scope.isCustomerAttachedOrCookiedToRep(),t=n.PriceModel.SalePrice,r=n.PriceModel.ListPrice;return i&&t>0?t:r},t}(BaseAngularController);n.CommonProductListController=t}(ProductListModule||(ProductListModule={})),function(n){var t=function(){function n(){}return n.Brand="B",n.Category="C",n.Search="S",n}();n.DeptType=t}(MobileProductListModule||(MobileProductListModule={})),function(n){(function(n){n[n.None=0]="None";n[n.Filter=1]="Filter";n[n.Sort=2]="Sort"})(n.FacetHeaderType||(n.FacetHeaderType={}));var t=n.FacetHeaderType}(MobileProductListModule||(MobileProductListModule={})),function(n){var t=function(){function n(){}return n.Brands="Brands",n.BrandsES="Marcas",n.Category="Category",n.CategoryES="Categoría",n.Categories="Categories",n.CategoriesES="Categorías",n.GoodBuys="Good Buys",n}();n.GroupName=t}(MobileProductListModule||(MobileProductListModule={})),function(n){(function(n){n[n.None=0]="None";n[n.AddToBag=1]="AddToBag";n[n.SelectVariant=2]="SelectVariant";n[n.NotifyMe=3]="NotifyMe"})(n.PlpActionButton||(n.PlpActionButton={}));var t=n.PlpActionButton}(MobileProductListModule||(MobileProductListModule={})),function(n){var t=function(n){function t(t){n.call(this,t);this.$scope=t}return __extends(t,n),t.$inject=["$scope"],t}(NavigationModule.BaseNavigationController);n.MobileNavigationController=t}(MobileNavigationModule||(MobileNavigationModule={}));app.controller("MobileNavigationController",MobileNavigationModule.MobileNavigationController),function(n){var t=function(){function n(){}return n}();n.ProductListProductViewModel=t}(MobileProductListModule||(MobileProductListModule={})),function(n){var t=function(t){function i(r,u,f,e,o,s,h,c,l,a,v,y,p){var w=this;t.call(this,r,p,o);this.historyService=y;this.debounceDiscountSliderMaxRight=_.debounce(function(){return w.sliderMaxRight($("#discountSlider > rzslider > span:nth-child(9)"),$("#discountSlider > rzslider > span:nth-child(1) > span"))},250,!1);this.debouncePriceSliderMaxRight=_.debounce(function(){return w.sliderMaxRight($("#priceSlider > rzslider > span:nth-child(9)"),$("#priceSlider > rzslider > span:nth-child(1) > span"))},250,!1);this.sliderMaxRight=function(n,t){var u=parseInt(n.css("left")),i=parseInt(t.css("left"))+parseInt(t.css("width")),r=parseInt(n.css("width"));u>i-r&&n.css("left",i-r+"px")};this.navigationController=new MobileNavigationModule.MobileNavigationController(r);u.$broadcast("ProductListController.CategoryLoading");n.ProductListScope=r;n.ProductListScope.ratingFacets=[];n.ProductListScope.brandFacets=[];n.ProductListScope.SelectedFacetIds=[];n.ProductListScope.PriceSliderChangeIndex=0;n.ProductListScope.DiscountSliderChangeIndex=0;n.ProductListScope.AllProductCategoryIds=[];n.ProductListScope.StateIndex=0;AVON.Navigation&&(n.ProductListScope.Navigation=AVON.Navigation);n.ProductListScope.categoryDeepLinkModel=AVON.CategoryDeepLinksModel;n.ProductListScope.HasContent=AVON.HasContent;n.ProductListScope.ShowProductList=AVON.ShowProductList==null?!0:AVON.ShowProductList;n.ProductListScope.ProductsLoaded=!1;n.ProductListScope.products=AVON.productList||[];_.each(n.ProductListScope.products,function(t){t.Name=n.ProductListScope.SecureHtml(t.Name)});n.ProductListScope.isShopAllPage=AVON.IsShopAllPage?!0:!1;n.ProductListScope.deptFacetsToShow=[];n.ProductListScope.facetsToShow=[];n.ProductListScope.facetClicked=!1;n.ProductListScope.validRatings=[];n.ProductListScope.selectedFacetHeader=n.FacetHeaderType.None;n.ProductListScope.facetHeaderTypes={None:n.FacetHeaderType.None,Filter:n.FacetHeaderType.Filter,Sort:n.FacetHeaderType.Sort};n.ProductListScope.setRatingFacet=function(t){n.ProductListScope.RatingSelected=!0;w.updateRatingsFacetList(t);w.updateFacetCheckboxes("rating",t);w.updateDiscountAndPriceModel()};n.ProductListScope.setBrandFacet=function(n,t){w.updateBrandsFacetList(n);w.updateFacetCheckboxes("brand",n,t)};n.ProductListScope.UpdateSelectedFacets=function(t,r,u,f,e){var s,o,c,l,h;n.ProductListScope.SkipPushState||(n.ProductListScope.SelectedFacetIds=[]);s=t&&t.target.checked;e?s&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(u)<0?AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.push(u):!s&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(u)>=0&&(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=_(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).without(u)):(o=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:r}),o==null&&(o={Title:r,Facets:[],ValidDeptIds:[],IsDepartmentShopBy:e},AvonModule.AvonScope.LeftNavigationSelectedFacets.push(o)),s&&_(o.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(u)<0?(c={Id:u,Text:f},o.Facets.push(c)):!s&&_(o.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(u)>=0&&(o.Facets=_(o.Facets).filter(function(n){return n.Id!=u}),AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0})));n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!w.historyService.IsPushStateSupported||(w.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),w.getSelectedFacetIds(),l=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.FacetQueryStringParamName,n.ProductListScope.SelectedFacetIds),h=w.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,h,l),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=h));w.updateFacets();n.ProductListScope.facetClicked=!0;w.updateDiscountAndPriceModel()};y.OnPopState(i.HistoryStateKey,function(t){var i,r;if(t.state){if(n.ProductListScope.SkipPushState=!0,i=t.state,r=void 0,i&&i.Index!==undefined&&(r=n.ProductListScope.PopStateIndex!==undefined?i.Index>0&&i.Index<n.ProductListScope.PopStateIndex?"back":"forward":i.Index>0&&i.Index<n.ProductListScope.StateIndex?"back":"forward",n.ProductListScope.PopStateIndex=i.Index),(!r||r==="back")&&w.pageStateIsUnchanged(i)){n.ProductListScope.ShowLoading("");y.Go(-1);return}var f=app.GetQuerystringParameterByName(n.ProductListScope.FacetQueryStringParamName),h=app.GetQuerystringParameterByName(n.ProductListScope.RatingsQueryStringParamName),e=app.GetQuerystringParameterByName(n.ProductListScope.PriceQueryStringParamName),o=app.GetQuerystringParameterByName(n.ProductListScope.DiscountQueryStringParamName),s=app.GetQuerystringParameterByName(n.ProductListScope.SortByQueryStringParamName);i&&i.SelectedFacetIds?(n.ProductListScope.SelectedFacetIds.length>0&&w.updateFacetsFromState(n.ProductListScope.SelectedFacetIds,f),n.ProductListScope.ratingFacets.length>0&&w.navigationController.updateRatings(n.ProductListScope.ratingFacets,f),n.ProductListScope.SelectedFacetIds=i.SelectedFacetIds,n.ProductListScope.ratingFacets=i.SelectedRatings,n.ProductListScope.PriceRangeFacetSelected=i.SelectedPriceRange.PriceRangeFacetSelected,n.ProductListScope.DiscountRangeFacetSelected=i.SelectedDiscountRange.DiscountRangeFacetSelected):n.ProductListScope.SelectedFacetIds.length===0&&(_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.ProductListScope.SelectedFacetIds.push(t.Id)})}),n.ProductListScope.SelectedFacetIds=n.ProductListScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets));n.ProductListScope.PriceRangeFacetSelected&&i&&i.SelectedDiscountRange&&e.length>0?(n.ProductListScope.priceRangeModel.minimumDisplayValue=i.SelectedPriceRange.Minimum,n.ProductListScope.priceRangeModel.maximumDisplayValue=i.SelectedPriceRange.Maximum,n.ProductListScope.priceRangeModel.floor=0,n.ProductListScope.priceRangeModel.ceil=i.SelectedPriceRange.Ceil,n.ProductListScope.onPriceRangeSliderChange(),n.ProductListScope.SafeApply()):(n.ProductListScope.PriceRangeFacetSelected=!1,e.length===0?w.updateDiscountAndPriceModel():(n.ProductListScope.priceRangeModel.minimumDisplayValue=n.ProductListScope.PageLoadPriceRange.minimumDisplayValue,n.ProductListScope.priceRangeModel.maximumDisplayValue=n.ProductListScope.PageLoadPriceRange.maximumDisplayValue,n.ProductListScope.priceRangeModel.floor=0,n.ProductListScope.priceRangeModel.ceil=n.ProductListScope.PageLoadPriceRange.ceil,n.ProductListScope.onPriceRangeSliderChange()),n.ProductListScope.SafeApply());n.ProductListScope.DiscountRangeFacetSelected&&i&&i.SelectedDiscountRange&&o.length>0?(n.ProductListScope.discountLevelModel.minimum=i.SelectedDiscountRange.Minimum,n.ProductListScope.discountLevelModel.maximum=i.SelectedDiscountRange.Maximum,n.ProductListScope.discountLevelModel.floor=0,n.ProductListScope.discountLevelModel.ceil=i.SelectedDiscountRange.Ceil,n.ProductListScope.onDiscountLevelSliderChange(),n.ProductListScope.SafeApply()):(n.ProductListScope.DiscountRangeFacetSelected=!1,o.length===0?w.updateDiscountAndPriceModel():(n.ProductListScope.discountLevelModel.minimum=n.ProductListScope.PageLoadDiscountRange.minimum,n.ProductListScope.discountLevelModel.maximum=n.ProductListScope.PageLoadDiscountRange.maximum,n.ProductListScope.discountLevelModel.floor=0,n.ProductListScope.discountLevelModel.ceil=n.ProductListScope.PageLoadDiscountRange.ceil,n.ProductListScope.onDiscountLevelSliderChange()),n.ProductListScope.SafeApply());s.length===0&&u.$broadcast("productListScope.SortByUpdated",SortOption.None);w.navigationController.updateRatings(n.ProductListScope.ratingFacets,h);w.updateFacetsFromState(n.ProductListScope.SelectedFacetIds,f);w.updateSort(s);_.defer(function(){n.ProductListScope.SkipPushState=!1;n.ProductListScope.facetClicked=!n.ProductListScope.facetClicked&&f.length>0;n.ProductListScope.RatingSelected=!n.ProductListScope.RatingSelected&&h.length>0;n.ProductListScope.PriceRangeFacetSelected=!n.ProductListScope.PriceRangeFacetSelected&&e.length>0||i&&i.SelectedPriceRange&&i.SelectedPriceRange.PriceRangeFacetSelected;n.ProductListScope.DiscountRangeFacetSelected=!n.ProductListScope.DiscountRangeFacetSelected&&o.length>0||i&&i.SelectedDiscountRange&&i.SelectedDiscountRange.DiscountRangeFacetSelected;n.ProductListScope.SortingSelected=!n.ProductListScope.SortingSelected&&s.length>0})}});n.ProductListScope.filterLeftNavByProducts=function(){var t=n.ProductListScope.products;return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){t=_.filter(t,function(t){var i=!0;return _.each(n.Facets,function(n){_.contains(t.Facets,n.Id)||(i=!1)}),i})}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(t=_.filter(t,function(n){var t=!0;return _.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(i){_.contains(n.CategoryIds,i)||(t=!1)}),t})),t=_.filter(t,function(n){return w.productHasSelectedRating(n)})};n.ProductListScope.filterLeftNavRatingsByProducts=function(){var t=n.ProductListScope.products;return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){t=_.filter(t,function(t){var i=_(n.Facets).chain().pluck("Id").flatten().uniq().intersection(t.Facets).value().length>0,r=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(t.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0;return i&&r})}):AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(t=_.filter(t,function(n){return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0})),t};n.ProductListScope.filterLeftNavDeptByProducts=function(){var t=n.ProductListScope.products;return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){t=_.filter(t,function(t){var i=_(n.Facets).chain().pluck("Id").flatten().uniq().intersection(t.Facets).value().length>0;return w.productHasSelectedRating(t)&&i})}):t=_.filter(t,function(n){return w.productHasSelectedRating(n)}),t};n.ProductListScope.filterLeftNavByFacets=function(t,i){var r=_(t).chain().pluck("Facets").flatten().value(),f=r,u,e;return i&&(_.each(r,function(n){n.IsEnabled=!0}),AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){var i=_.find(t,function(t){return t.Title===n.Title}),u=i.Facets;r=w.getFacetsFromAvailableProducts(r,!0,u,n)}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(u=_.find(t,function(n){return n.IsDepartmentShopBy}),e=u.Facets,r=w.getFacetsFromAvailableProducts(r,!1,e,u)),n.ProductListScope.ratingFacets&&n.ProductListScope.ratingFacets.length>0&&(r=w.getFacetsFromAvailableProducts(r,!1,null,null)),f=_.filter(r,function(n){return n.IsEnabled===!0})),f};n.ProductListScope.setFacetHeaderItemActive=function(t,i){t=w.setFacetHeaderItemToNoneIfAlreadyActive(t);t===n.FacetHeaderType.Filter&&(e(function(){r.$broadcast("rzSliderForceRender");w.resetScrollPositionForFilterBody()},100),_.each(n.ProductListScope.brandFacets,function(n){n.selected&&$("#brand-"+n.id).prop("checked",!0)}));t===n.FacetHeaderType.None&&i===!0&&n.ProductListScope.ClearAllFacets();n.ProductListScope.selectedFacetHeader=t};n.ProductListScope.ClearAllFacets=function(){n.ProductListScope.clearBrands();n.ProductListScope.clearCustomShopBys();n.ProductListScope.clearRatings();n.ProductListScope.clearPriceRange();n.ProductListScope.clearDiscountLevel();w.updateFacets();n.ProductListScope.SafeApply()};n.ProductListScope.applyFacetContainerActiveClass=function(n){return w.isFacetHeaderItemActive(n)?"active":""};n.ProductListScope.applySortingActiveClass=function(t){return n.ProductListScope.isSortOptionActive(t)?"active":""};n.ProductListScope.isSortOptionActive=function(t){return n.ProductListScope.selectedSortingValue===parseInt(t)};n.ProductListScope.onDiscountLevelSliderTranslate=function(n){return n+"%"};n.ProductListScope.onPriceRangeSliderTranslate=function(n){return"$"+n};n.ProductListScope.onDiscountLevelSliderChange=function(){return w.applySliderChangeToFacetModel(n.ProductListScope.discountLevelModel,SliderFacetModelNames.discountLevelModel),w.debounceDiscountSliderMaxRight()};n.ProductListScope.onPriceRangeSliderChange=function(){return w.applySliderChangeToFacetModel(n.ProductListScope.priceRangeModel,SliderFacetModelNames.priceRangeModel),w.debouncePriceSliderMaxRight()};n.ProductListScope.showPriceRange=function(){return w.showSliderFacet(SliderFacetModelNames.priceRangeModel)};n.ProductListScope.showDiscountLevel=function(){return w.showSliderFacet(SliderFacetModelNames.discountLevelModel)};n.ProductListScope.showRatings=function(){return n.ProductListScope.ratingFacets.length>0};n.ProductListScope.showBrandsFacetGroup=function(){return n.ProductListScope.brandFacets.length>0};n.ProductListScope.showBrands=function(){return _.any(n.ProductListScope.brandFacets,function(n){return n.selected})};n.ProductListScope.showFacetClear=function(t){if(t==="Brands")return _.any(n.ProductListScope.brandFacets,function(n){return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(n.id)>=0});var i=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t});return i!=null&&i.Facets.length>0};n.ProductListScope.clearFacets=function(t){var r,f,e,u;if(w.getSelectedFacetIds(),r=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t}),t==="Brands"&&(n.ProductListScope.clearBrands(),w.updateFacets(),n.ProductListScope.SafeApply()),r!=null){_.each(r.Facets,function(t){var i=n.ProductListScope.SelectedFacetIds.indexOf(t.Id);i>-1&&n.ProductListScope.SelectedFacetIds.splice(i,1)});for(f in r.Facets)$("input#brand-"+r.Facets[f].Id).prop("checked",!1);r.Facets=[];AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0});w.updateFacets();n.ProductListScope.facetClicked=!0}!n.ProductListScope.ProductSearchLoaded&&w.historyService.IsPushStateSupported&&(e=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.FacetQueryStringParamName,n.ProductListScope.SelectedFacetIds),w.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),u=w.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,u,e),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=u));w.updateDiscountAndPriceModel()};n.ProductListScope.clearPriceRange=function(){var r=_.reduce(n.ProductListScope.products,function(n,t){return n.push(w.getLowestProductPrice(t)),n},[]),u,t;n.ProductListScope.priceRangeModel&&(n.ProductListScope.priceRangeModel.minimum=Math.floor(_.min(r)),n.ProductListScope.priceRangeModel.maximum=Math.floor(_.max(r)));n.ProductListScope.PriceRangeFacetSelected=!1;w.updateDiscountAndPriceModel();w.updateFacets();!n.ProductListScope.ProductSearchLoaded&&w.historyService.IsPushStateSupported&&(u=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.PriceQueryStringParamName,null),w.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),t=w.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,t,u),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=t))};n.ProductListScope.clearDiscountLevel=function(){var u=_.reduce(n.ProductListScope.products,function(n,t){return n.push(w.getProductDiscountPercent(t)),n},[]),r,t;n.ProductListScope.discountLevelModel&&(n.ProductListScope.discountLevelModel.minimum=0,n.ProductListScope.discountLevelModel.maximum=_.max(u));n.ProductListScope.DiscountRangeFacetSelected=!1;w.updateDiscountAndPriceModel();w.updateFacets();!n.ProductListScope.ProductSearchLoaded&&w.historyService.IsPushStateSupported&&(r=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.DiscountQueryStringParamName,null),w.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),t=w.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,t,r),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=t))};n.ProductListScope.clearRatings=function(){var r,t;n.ProductListScope.RatingSelected=!1;n.ProductListScope.SkipPushState=!0;n.ProductListScope.ratingFacets.forEach(function(n){w.updateRatingsFacetList(n);w.updateFacetCheckboxes("rating",n,!1)});n.ProductListScope.SkipPushState=!1;n.ProductListScope.ratingFacets=[];!n.ProductListScope.ProductSearchLoaded&&w.historyService.IsPushStateSupported&&(r=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.RatingsQueryStringParamName,n.ProductListScope.ratingFacets),w.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),t=w.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,t,r),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=t));w.updateDiscountAndPriceModel()};n.ProductListScope.clearBrands=function(t){_.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(i){$("#brand-"+i).prop("checked",!1);t&&t.push(i);var r=n.ProductListScope.SelectedFacetIds.indexOf(i);r>-1&&n.ProductListScope.SelectedFacetIds.splice(r,1)});AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=[]};n.ProductListScope.clearCustomShopBys=function(){_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n.ProductListScope.clearFacets(t.Title)})};n.ProductListScope.isValidRating=function(t){return n.ProductListScope.RatingSelected&&$("#rating-"+t).prop("checked")===!0?!0:n.ProductListScope.validRatings.indexOf(t)>=0};n.ProductListScope.filterProductsByFacets=function(n){return n.visible=w.isProductVisible(n),w.updatedRefinedProductsCount(),n.visible};n.ProductListScope.facetsApplied=function(){return n.ProductListScope.numberOfFacetsUsed=0,n.ProductListScope.showBrands()&&(n.ProductListScope.numberOfFacetsUsed+=1),n.ProductListScope.showRatings()&&(n.ProductListScope.numberOfFacetsUsed+=1),n.ProductListScope.showDiscountLevel()&&(n.ProductListScope.numberOfFacetsUsed+=1),n.ProductListScope.showPriceRange()&&(n.ProductListScope.numberOfFacetsUsed+=1),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(n.ProductListScope.numberOfFacetsUsed+=1),_(AvonModule.AvonScope.LeftNavigationSelectedFacets).each(function(t){t.Facets.length>0&&(n.ProductListScope.numberOfFacetsUsed+=1)}),n.ProductListScope.numberOfFacetsUsed>0};n.ProductListScope.isFacetModelReady=function(t){return!_.isEmpty(t)&&t.facets.length>0&&!n.ProductListScope.ProductSearchLoaded};n.ProductListScope.defaultSliderModel={discountLevelModel:{},priceRangeModel:{}};n.ProductListScope.IsPromotionsPage=$("body").hasClass("Controller_Promotions");n.ProductListScope.CategoryDepth=AVON.CategoryDepth||1;n.ProductListScope.SelectedCategoryId=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLink=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLinkParent=AVON.SelectedCategoryId;n.ProductListScope.SelectedCategoryName=AVON.SelectedCategoryName;n.ProductListScope.SelectedCategoryType=AVON.SelectedCategoryType;n.ProductListScope.SelectedCategoryBrandType=AVON.SelectedCategoryBrandType;n.ProductListScope.InitialSubcategoryId=AVON.InitialSubCategoryId;n.ProductListScope.InitialSubcategoryName=AVON.InitialSubCategoryName;n.ProductListScope.topCategoryName=AVON.TopCategoryName||"";n.ProductListScope.level3CategoryName=AVON.Level3CategoryName||"";n.ProductListScope.level4CategoryName=AVON.Level4CategoryName||"";n.ProductListScope.selectedSortingValue=SortOption.None;n.ProductListScope.sortingOptions={None:SortOption.None,Default:SortOption.Default,Price:SortOption.Price,Rating:SortOption.Rating,Name:SortOption.Name,Relevance:SortOption.Relevance,Discount:SortOption.Discount,SearchRelevance:SortOption.SearchRelevance};n.ProductListScope.sortingFilterValue=this.sortingFilters.Default;AVON.SearchTerm!==undefined?(n.ProductListScope.searchTerm=AVON.SearchTerm,n.ProductListScope.sortingFilterValue=this.sortingFilters.SearchRelevance,f.GetProductsBySearch(AVON.SearchTerm)):n.ProductListScope.SelectedCategoryId&&f.GetProductsInCategory(n.ProductListScope.SelectedCategoryId);n.ProductListScope.CustomMessages="";n.ProductListScope.RefinedProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryTotalProductCount=n.ProductListScope.products.length;n.ProductListScope.selectedView="list";n.ProductListScope.getConditionForSelectedCategoryBrandType=function(t,i){i===void 0&&(i=!1);switch(t){case 3:return i?n.ProductListScope.SelectedCategoryBrandType<t:n.ProductListScope.SelectedCategoryBrandType>=t;case 4:if(i)return n.ProductListScope.SelectedCategoryBrandType<t}};n.ProductListScope.anyProductsOnPage=function(){return n.ProductListScope.products.length>0};n.ProductListScope.isBrandDeptType=function(){return n.ProductListScope.DeptType===n.DeptType.Brand};n.ProductListScope.isCategoryDeptType=function(){return n.ProductListScope.DeptType===n.DeptType.Category};n.ProductListScope.searchShowAmountLimit=n.ProductListScope.ClientConfiguration.MobileProductListPageSize;n.ProductListScope.SegmentAsSubSegmentUrl=function(t,i){return t.replace(n.ProductListScope.topCategoryName.formatUrlNugget(),n.ProductListScope.topCategoryName.formatUrlNugget()+"/"+i)};n.ProductListScope.selectSortingValue=function(t,r){var f,e,u;n.ProductListScope.selectedSortingValue=parseInt(t,10);n.ProductListScope.selectedSortingValue===SortOption.Default&&AVON.SearchTerm!==undefined&&(n.ProductListScope.selectedSortingValue=SortOption.SearchRelevance);switch(n.ProductListScope.selectedSortingValue){case SortOption.Price:n.ProductListScope.sortingFilterValue=w.sortingFilters.Price;break;case SortOption.Rating:n.ProductListScope.sortingFilterValue=w.sortingFilters.Rating;break;case SortOption.Name:n.ProductListScope.sortingFilterValue=w.sortingFilters.Name;break;case SortOption.Relevance:n.ProductListScope.sortingFilterValue=w.sortingFilters.Relevance;break;case SortOption.SearchRelevance:n.ProductListScope.sortingFilterValue=w.sortingFilters.SearchRelevance;break;case SortOption.Default:case SortOption.None:n.ProductListScope.sortingFilterValue=w.sortingFilters.Default;break;case SortOption.Discount:n.ProductListScope.sortingFilterValue=w.sortingFilters.Discount}r&&r.stopPropagation();n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!w.historyService.IsPushStateSupported||n.ProductListScope.selectedSortingValue===SortOption.None||(f=[n.ProductListScope.selectedSortingValue],e=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.SortByQueryStringParamName,f),w.hasUserSelectedFacets()||y.PushStateUrl(window.location.href),u=w.getCurrentPageState(),y.ReplaceState(i.HistoryStateKey,u,e),n.ProductListScope.SkipPushState||(n.ProductListScope.SortingSelected=!0),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=u));n.ProductListScope.setFacetHeaderItemActive(n.ProductListScope.facetHeaderTypes.None)};n.ProductListScope.showSortByDiscount=function(){return _.isUndefined(n.ProductListScope.discountLevelModel)?!1:n.ProductListScope.discountLevelModel.facets.length>0};n.ProductListScope.IncreaseSearchShowAmountLimit=function(){n.ProductListScope.searchShowAmountLimit+=n.ProductListScope.ClientConfiguration.MobileProductListPageSize;n.ProductListScope.VisibleProductsCount=n.ProductListScope.RefinedProductCount>n.ProductListScope.searchShowAmountLimit?n.ProductListScope.searchShowAmountLimit:n.ProductListScope.RefinedProductCount;n.ProductListScope.VisibleProductsCount>n.ProductListScope.products.length&&(n.ProductListScope.VisibleProductsCount=n.ProductListScope.products.length);n.ProductListScope.SafeApply()};n.ProductListScope.GetSelectedCategoryNameEncoded=function(){switch(n.ProductListScope.CategoryDepth){case 3:return n.ProductListScope.level3CategoryName;case 3:return n.ProductListScope.level4CategoryName;default:return n.ProductListScope.TopLevelCategoryName}};n.ProductListScope.ShowPromotionOverlay=function(n){var i=$(angular.element(n.currentTarget)[0]),t=$(i).parents(".ProductSummary").find(".Expandable");t.hasClass("Expanded")?t.removeClass("Expanded"):t.addClass("Expanded")};n.ProductListScope.HidePromotionOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);$(t).parents(".Expandable.Expanded").removeClass("Expanded")};n.ProductListScope.GoToProductPage=function(t,i){if($(".ie").length>0){var r=[];$("div[data-product-summary-id]").each(function(){var n=parseInt($(this).attr("data-product-summary-id"),10);n>0&&r.push(n)});n.ProductListScope.SetValueIntoSessionStorage("ListedProductsIdsOrder",r)}n.ProductListScope.RedirectToUrl(n.ProductListScope.Url.Action("Details","Product",i+"-"+t),!0)};n.ProductListScope.IsCategoryGoodBuys=function(){return n.ProductListScope.TopLevelCategoryName===n.GroupName.GoodBuys};n.ProductListScope.GetPageHeading=function(){var t=n.ProductListScope.InitialSubcategoryName?n.ProductListScope.InitialSubcategoryName:n.ProductListScope.SelectedCategoryName;return n.ProductListScope.IsCategoryGoodBuys()&&t.indexOf(n.GroupName.GoodBuys)<0&&(t+=" "+n.GroupName.GoodBuys),t};n.ProductListScope.addToBag=function(n){var t={Sku:n,Quantity:1};u.$broadcast("AddToBag",t)};n.ProductListScope.UpdateSelectedCategory=function(t,i,r,u){$(window).scrollTop(0);n.ProductListScope.topCategoryName=t;u?(n.ProductListScope.level3CategoryName=r,n.ProductListScope.level4CategoryName=""):n.ProductListScope.level4CategoryName=r;n.ProductListScope.SelectedCategoryName=r;n.ProductListScope.SelectedCategoryId=i;u&&(n.ProductListScope.ShowLoading(AVON.messages.spinner_loading),f.GetProductsInCategory(n.ProductListScope.SelectedCategoryId));n.ProductListScope.updateContentData();n.ProductListScope.SafeApply();n.ProductListScope.selectedSortingValue=SortOption.None};n.ProductListScope.updateContentData=function(){$(".SupplementHeroHeader").addClass("Hidden");$(".LeftNavPromotionSpot.BottomSpot").addClass("Hidden");f.LoadCategoryHeroAndPromoSpots(n.ProductListScope.topCategoryName,n.ProductListScope.level3CategoryName,n.ProductListScope.level4CategoryName)};n.ProductListScope.hasCategoryChildren=function(t){return n.ProductListScope.GetChildCategories(t.groupName).length>0};n.ProductListScope.isCategoryDepthTopLevel=function(){return n.ProductListScope.GetCategoryDepth()===2};n.ProductListScope.GetCategoryDepth=function(){return n.ProductListScope.level4CategoryName!==""?4:n.ProductListScope.level3CategoryName!==""?3:2};n.ProductListScope.IsProductVisible=function(n){return n.IsVisible};n.ProductListScope.CategoryHasActiveProducts=function(t){return _.contains(n.ProductListScope.AllProductCategoryIds,t)};n.ProductListScope.$on("ProductListService.HeroSpotLoaded",function(t,i){i.indexOf('<div id="ErrorInfo">')<0&&(n.ProductListScope.rawHeroModule=i,n.ProductListScope.SafeApply(),e(function(){$(".ProductHeroSpot .BodyModuleContainers").children().length===0?$(".SupplementHeroHeader").removeClass("Hidden"):$(".ProductHeroSpot").removeClass("Hidden")}),_.delay(function(){$(".ProductHeroSpot .BodyModuleContainers").children().length===0?$(".SupplementHeroHeader").removeClass("Hidden"):$(".ProductHeroSpot").removeClass("Hidden")},500))});n.ProductListScope.ValidSortOptions=_.reduce(n.ProductListScope.sortingOptions,function(n,t){return n.push(t),n},[]);n.ProductListScope.$on("ProductListService.ProductCategoryLoaded",function(t,i){var f,e,r;n.ProductListScope.AllProductCategoryIds=i.AllProductCategoryIds;i.SelectedCategoryId!==null?(e=_.filter(i.Products,function(t){return _.contains(t.CategoryIds,n.ProductListScope.InitialSubcategoryId)}),f=w.getUniqueProductsList(e)):f=w.getUniqueProductsList(i.Products);n.ProductListScope.products=w.InitializeViewModel(f);w.updateMenuItemGroupNames();w.populateBrandAndCategoryFacets();n.ProductListScope.ShowRatings=w.showRatings();n.ProductListScope.AvailableProductRatings=n.ProductListScope.products.filter(function(t){return n.ProductListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating)});n.ProductListScope.AvailableProductRatings=_.uniq(n.ProductListScope.AvailableProductRatings);r=w.getDiscountAndPriceModel();r&&(n.ProductListScope.discountLevelModel=r.discountLevelModel,n.ProductListScope.priceRangeModel=r.priceRangeModel,w.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),w.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),n.ProductListScope.PageLoadPriceRange=$.extend({},n.ProductListScope.priceRangeModel),n.ProductListScope.PageLoadDiscountRange=$.extend({},n.ProductListScope.discountLevelModel));n.ProductListScope.HasContent||(n.ProductListScope.ShowProductList=!0);u.$broadcast("ProductListController.CategoryLoaded");n.ProductListScope.ProductsLoaded=!0;n.ProductListScope.searchShowAmountLimit=n.ProductListScope.products.length;n.ProductListScope.RefinedProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryTotalProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryDeepLinkModel&&_.defer(function(){w.processQueryStringFromFacets()});w.updateFacets();n.ProductListScope.SafeApply();n.ProductListScope.PageLoadUrl=document.location.href});n.ProductListScope.$on("productListScope.UpdateDiscountAndPriceModel",function(){w.updateDiscountAndPriceModel()});n.ProductListScope.$on("ProductListService.ProductSearchRedirection",function(t,i){n.ProductListScope.RedirectToUrl(i)});n.ProductListScope.$on("ProductListService.ProductSearchLoaded",function(t,i){n.ProductListScope.ProductSearchLoaded=!0;n.ProductListScope.products=w.InitializeViewModel(i.Data.products);n.ProductListScope.IsDeadEndSearch=i.Data.IsDeadEndSearch;n.ProductListScope.IsLineNumberSearch=i.Data.IsLineNumberSearch;n.ProductListScope.AutoCorrectedSearchTerm=i.Data.AutoCorrectedSearchTerm;n.ProductListScope.CustomMessages=i.Data.CustomMessages;n.ProductListScope.VisibleProductsCount=n.ProductListScope.ClientConfiguration.MobileProductListPageSize>n.ProductListScope.products.length?n.ProductListScope.products.length:20;n.ProductListScope.RefinedProductCount=n.ProductListScope.products.length;n.ProductListScope.categoryTotalProductCount=n.ProductListScope.products.length;n.ProductListScope.ShowRatings=w.showRatings();n.ProductListScope.searchTerm!==undefined&&(n.ProductListScope.IsDeadEndSearch?$("#SearchArea .InputContainer").addClass("NoResults"):$("#HeaderSearchInput").val(n.ProductListScope.searchTerm));n.ProductListScope.ProductsLoaded=!0;n.ProductListScope.SafeApply();n.ProductListScope.selectedSortingValue=SortOption.None;n.ProductListScope.HideLoading();w.trackSearchResultsEvent();var r=h.Initialize();r.qwisersearchsessionid=i.Data.CelebrosSessionId;r.qwisersearchloghandle=i.Data.CelebrosLogHandle;r.pagereferrer=document.referrer;h.LogSearchResult(r);n.ProductListScope.MenuItems=i.Data.leftNavigationModel.MenuItems;n.ProductListScope.SubCategoryId=i.Data.leftNavigationModel.SubCategoryId;n.ProductListScope.TopLevelCategoryName=i.Data.leftNavigationModel.TopLevelCategoryName;n.ProductListScope.DeptType=i.Data.leftNavigationModel.DeptType;w.updateMenuItemGroupNames();w.updateFacets();n.ProductListScope.SafeApply()});n.ProductListScope.ShowAllProducts=function(){n.ProductListScope.HasContent=!1;n.ProductListScope.ShowProductList=!0;y.PushState(i.HistoryStateKey,null,"#all-products");n.ProductListScope.SafeApply();y.OnPopState(i.HistoryStateKey,function(){n.ProductListScope.HasContent=!0;n.ProductListScope.ShowProductList=!1;n.ProductListScope.SafeApply()})};AVON.LeftNavigation&&(n.ProductListScope.MenuItems=AVON.LeftNavigation.MenuItems,n.ProductListScope.SubCategoryId=AVON.LeftNavigation.SubCategoryId,n.ProductListScope.TopLevelCategoryName=AVON.LeftNavigation.TopLevelCategoryName,n.ProductListScope.Level3CategoryName=AVON.Level3CategoryName,n.ProductListScope.DeptType=AVON.LeftNavigation.DeptType);n.ProductListScope.AllGroupNames=[];n.ProductListScope.CategoryGroupNames=[];n.ProductListScope.GetCategoryGroups=function(){return _.filter(n.ProductListScope.AllGroupNames,function(t){return n.ProductListScope.IsGroupNameCategories(t.groupName)})};n.ProductListScope.GetBrandGroups=function(){return _.filter(n.ProductListScope.AllGroupNames,function(t){return n.ProductListScope.IsGroupNameBrands(t.groupName)})};n.ProductListScope.GetShopByGroups=function(t){var i=_.filter(n.ProductListScope.AllGroupNames,function(i){return!n.ProductListScope.IsGroupNameCategories(i.groupName)&&(t||!n.ProductListScope.IsGroupNameBrands(i.groupName))});return n.ProductListScope.DeptType===n.DeptType.Brand&&_.each(i,function(t){n.ProductListScope.IsGroupNameBrands(t.groupName)&&(t.Caption=n.ProductListScope.LanguageCode=="es"?"Submarcas":"Sub-Brands")}),i};n.ProductListScope.GetChildCategories=function(t){var r=_.find(n.ProductListScope.AllGroupNames,function(n){return n.groupName===t}),i,u;return r?(i=r.menuItem.GroupedChildren[r.groupName],n.ProductListScope.IsGroupTypeCategories(t)&&n.ProductListScope.level3CategoryName&&(u=_.find(i,function(t){return t.Id==n.ProductListScope.SelectedCategoryId}),u&&(i=u.Children)),_.filter(i,function(n){return n.IncludeInLeftNavigation})):[]};n.ProductListScope.GetFeaturedCategories=function(t){var i=_.find(n.ProductListScope.AllGroupNames,function(n){return n.groupName===t}),r;return i?(r=i.menuItem.Featured,_.filter(r,function(n){return n.IncludeInLeftNavigation})):[]};n.ProductListScope.RedirectToCategory=function(t){n.ProductListScope.RedirectToUrl(t.Url,!0)};n.ProductListScope.IsGroupTypeCategories=function(t){return n.ProductListScope.DeptType!==n.DeptType.Search&&n.ProductListScope.SubCategoryId==0||n.ProductListScope.DeptType===n.DeptType.Brand&&n.ProductListScope.IsGroupNameBrands(t)||n.ProductListScope.DeptType===n.DeptType.Category&&n.ProductListScope.IsGroupNameCategories(t)};n.ProductListScope.IsGroupNameCategories=function(t){return t===n.GroupName.Categories||t===n.GroupName.CategoriesES||t===n.GroupName.Category||t==n.GroupName.CategoryES};n.ProductListScope.IsGroupNameBrands=function(t){return t===n.GroupName.Brands||t===n.GroupName.BrandsES};n.ProductListScope.$on("ProductListService.ProductSearchLoaded",function(t,i){n.ProductListScope.MenuItems=i.Data.leftNavigationModel.MenuItems;n.ProductListScope.SubCategoryId=i.Data.leftNavigationModel.SubCategoryId;n.ProductListScope.TopLevelCategoryName=i.Data.leftNavigationModel.TopLevelCategoryName;n.ProductListScope.DeptType=i.Data.leftNavigationModel.DeptType;w.updateMenuItemGroupNames();w.updateFacets();n.ProductListScope.SafeApply()});n.ProductListScope.ToggleMenu=function(t){n.ProductListScope.FilterMenuSelected=n.ProductListScope.FilterMenuSelected!==t?t:"None"};n.ProductListScope.SelectSubcategory=function(t){n.ProductListScope.ToggleMenu("");n.ProductListScope.ShowLoading(AVON.messages.spinner_loading);n.ProductListScope.RedirectToUrl(t.Url)};n.ProductListScope.ShowLinkGroup=function(t){var i=_(t.Links).findWhere({Id:n.ProductListScope.SelectedCategoryId});return i!=undefined&&t.Title.toLocaleLowerCase()!="featured"&&t.Title.toLocaleLowerCase()!="destacado"&&t.Links.length>0&&i.SubLinks.length>0};n.ProductListScope.GetValidLinks=function(t){var i=_(t.Links).findWhere({Id:n.ProductListScope.SelectedCategoryId});return i!=undefined?i.SubLinks:[]};n.ProductListScope.FacetsToShow=function(){return _(n.ProductListScope.products).chain().pluck("Facets").flatten().uniq().value()};n.ProductListScope.DepartmentFacetsToShow=function(){return _(n.ProductListScope.products).chain().pluck("CategoryIds").flatten().uniq().value()};n.ProductListScope.filterFacets=function(t){return n.ProductListScope.FacetsToShow().indexOf(t.Id)>=0};n.ProductListScope.filterDepartmentFacets=function(t){return n.ProductListScope.DepartmentFacetsToShow().indexOf(t.Id)>=0};n.ProductListScope.filterShopBysByDepartment=function(t){var i=t.IsDepartmentShopBy||t.ValidDeptIds.indexOf(AvonModule.AvonScope.LeftNavigationSelectedLink)>=0,r=t.IsDepartmentShopBy?c("filter")(t.Facets,n.ProductListScope.filterDepartmentFacets).length>0:c("filter")(t.Facets,n.ProductListScope.filterFacets).length>0;return i&&r};n.ProductListScope.isEnabledFacet=function(t,i,r){if(r===void 0&&(r=!1),!n.ProductListScope.facetClicked&&!n.ProductListScope.RatingSelected||$("#brand-"+i.Id).prop("checked")===!0)return!0;var u;return u=r?n.ProductListScope.deptFacetsToShow.indexOf(i.Id)>-1:n.ProductListScope.facetsToShow.indexOf(i.Id)>-1,i.IsEnabled=u,u};n.ProductListScope.ShowWishListIcon=function(){return n.ProductListScope.Session.Customer.IsLoggedIn};n.ProductListScope.GetCategorySelectorAnalyticsValue=function(n){var t;return AVON.TopCategoryName?t=AVON.TopCategoryName:AVON.breadcrumbs.length>1&&(t=AVON.breadcrumbs[1].Text),t.toLowerCase()+(n?"-qcklnks-ftrs":"-qcklnks-cat")};n.ProductListScope.GetCategoryLinkAnalyticsValue=function(){for(var n=[],t=0;t<arguments.length;t++)n[+t]=arguments[t];return AVON.TopCategoryName?n.unshift(AVON.TopCategoryName):AVON.breadcrumbs.length>1&&n.unshift(AVON.breadcrumbs[1].Text),l.GetAnalyticsAttributeValue("navbtm",n)};n.ProductListScope.SelectVariantClicked=function(n){n.VariantsContainerOpen=!n.VariantsContainerOpen;n.VariantsContainerOpen&&(n.ShowVariantsList=!0,n.VariantGroups&&n.VariantGroups.length!=0||(n.LoadingVariants=!0,s.GetProductWithId(n.Id).then(function(t){t?(n.VariantGroups=w.initializeVariantsViewModel(t.VariantGroups),n.LoadingVariants=!1):r.RedirectToUrl(r.Url.Action("Details","Product",n.SeoName+"-"+n.Id),!0)})))};n.ProductListScope.VariantsCloseButtonClicked=function(n){n.VariantsContainerOpen=!1};n.ProductListScope.VariantButtonClicked=function(n,t,i){t.SelectedVariant=i;t.ShowVariantsList=!1;var r=$(n.currentTarget).closest(".ProductSummary").offset().top-$("#FixedMenu").height();$("html, body").stop().animate({scrollTop:r},500,"swing")};n.ProductListScope.VariantSelectButtonClicked=function(n){n.ShowVariantsList=!0};n.ProductListScope.AddToBagButtonClicked=function(t){var s=1e3,o=_.throttle(function(n){r.SafeApply(function(){t.AddingToBagStatus=n});n==AddingToBagStatus.Added&&_.delay(function(){r.SafeApply(function(){t.AddingToBagStatus=AddingToBagStatus.None})},s)},1e3),i=new AddBagItem,u,f,e;i.Quantity=1;u=null;o(AddingToBagStatus.Adding);t.HasVariants&&t.TotalVariants>1?(u=t.SelectedVariant,f=u.Sku):t.Sku&&(f=t.Sku);f?(i.Sku=f,e=a.addItemToBag(i,!1,n.ProductListScope.FindingMethod())):(i.LineNumber=t.DisplayLineNumber,e=a.lineEntryAddSingleProductToBag(i,n.ProductListScope.FindingMethod()));e.then(function(n){n.ItemsFailed&&n.ItemsFailed.length?r.RedirectToUrl(r.Url.Action("Details","Product",t.SeoName+"-"+t.Id),!0):(w.incrementAndResetAddToBagButton(t,u),o(AddingToBagStatus.Added))})};n.ProductListScope.FindingMethod=function(){return window.location.href.indexOf("/search")!==-1?TrackingAddToCartType.Search:window.location.href.indexOf("/category")!==-1||window.location.href.indexOf("/promotions")!==-1?TrackingAddToCartType.Category:TrackingAddToCartType.TrackingAddToCartType};n.ProductListScope.DisplayVariantLineNumber=function(n,t){return ProductHelper.DisplayVariantLineNumber(n.LineNumber,t)};n.ProductListScope.IsVariantAvailableSoon=function(n){return n.Availability===CanBuy.AvailableSoon};n.ProductListScope.GetVariantSelectPlaceholderText=function(n,t,i){return t==VariantType.Unknown?i:n+" "+AVON.VariantTypesLocalized[t].toLocaleLowerCase()};n.ProductListScope.NotifyMeButtonClicked=function(n,t){var u=null,i=0;return r.IsBlog()&&$("html").hasClass("Mobile")&&(u="modalTop",i=135,$(".search-results-container").length>0&&$(".ResultsContent").length>0&&(i+=$(".search-results-container").height()-$(".ResultsContent").height())),v.OpenNotifyMeModal(n,t,u,i)};n.ProductListScope.GetButtonToDisplay=function(t){return t.PriceModel.AutoReplenishmentPrice?n.PlpActionButton.None:t.IsAvailable||t.CanBuy!==CanBuy.AvailableSoon?t.HasVariants&&t.TotalVariants>1?n.PlpActionButton.SelectVariant:n.PlpActionButton.AddToBag:n.PlpActionButton.NotifyMe};n.ProductListScope.ProductIsAvailableOrAvailableSoon=function(n){return n.IsAvailable||!n.IsAvailable&&n.CanBuy===CanBuy.AvailableSoon};n.ProductListScope.IsOptionDisabled=function(n){return n==null||n.Availability===CanBuy.Available||n.Availability===CanBuy.AvailableSoon||n.Availability===CanBuy.AutoReplenishmentOnly?!1:!0};r.ShowFilterAndProducts=function(){return r.products.length>0&&r.ShowProductList}}return __extends(i,t),i.prototype.InitializeViewModel=function(n){var t=this;return _.map(n,function(n){var i=n;return i.SelectedVariant=null,i.AddedToBagCount=0,i.AddingToBagStatus=AddingToBagStatus.None,i.ShowVariantsList=!1,i.VariantsContainerOpen=!1,i.LoadingVariants=!1,i.VariantGroups=t.initializeVariantsViewModel(n.VariantGroups),i})},i.prototype.initializeVariantsViewModel=function(n){return _.map(n,function(n){var t=n;return t.Variants=_.map(t.Variants,function(n){var t=n;return t.AddedToBagCount=0,t}),t})},i.prototype.getVisibleUniqueProducts=function(){var t=n.ProductListScope.products;return(AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.ProductListScope.ratingFacets&&n.ProductListScope.ratingFacets.length>0)&&(t=_.filter(n.ProductListScope.products,function(t){return n.ProductListScope.filterProductsByFacets(t)})),t},i.prototype.getDiscountAndPriceModel=function(){var t=this,f=this.getVisibleUniqueProducts(),n=_.reduce(f,function(n,i){var r,u;return i.PriceModel.DiscountPercent>0&&(r=t.facetValueExists(n.discountLevelFacets,i.PriceModel.DiscountPercent),r||n.discountLevelFacets.push({isChecked:!1,value:i.PriceModel.DiscountPercent,facetModelName:SliderFacetModelNames.discountLevelModel})),u=t.facetValueExists(n.priceRangeFacets,t.getLowestProductPrice(i)),u||n.priceRangeFacets.push({isChecked:!1,value:t.getLowestProductPrice(i),facetModelName:SliderFacetModelNames.priceRangeModel}),n},{discountLevelFacets:[],priceRangeFacets:[]}),r=_.max(n.discountLevelFacets,this.getMinimumMaximumPriceIterator).value,i;_.isUndefined(r)&&(r=0);i={facets:this.sortFacetsByValue(n.discountLevelFacets),minimum:0,maximum:r,floor:0};this.debounceDiscountSliderMaxRight();var e=Math.floor(_.min(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),o=Math.ceil(_.max(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),u={facets:this.sortFacetsByValue(n.priceRangeFacets),minimum:Math.floor(_.min(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),maximum:Math.ceil(_.max(n.priceRangeFacets,this.getMinimumMaximumPriceIterator).value),minimumDisplayValue:e,maximumDisplayValue:o,floor:0};return this.debouncePriceSliderMaxRight(),i.ceil=i.maximum,u.ceil=u.maximum,{discountLevelModel:i,priceRangeModel:u}},i.prototype.setDefaultSliderModelValues=function(t){n.ProductListScope.defaultSliderModel[t].maximum=n.ProductListScope[t].maximum;n.ProductListScope.defaultSliderModel[t].minimum=n.ProductListScope[t].minimum},i.prototype.sortFacetsByValue=function(n){return _.sortBy(n,function(n){return n.value})},i.prototype.getMinimumMaximumPriceIterator=function(n){return n.value},i.prototype.processQueryStringFromFacets=function(){var t=this;_.each(n.ProductListScope.categoryDeepLinkModel.Filters,function(i){switch(i.Name.toLowerCase()){case n.ProductListScope.RatingsQueryStringParamName:t.processRatingsFacetDeepLinks(i.Value);break;case n.ProductListScope.DiscountQueryStringParamName:t.processFacetModelDeepLinks(SliderFacetModelNames.discountLevelModel,i.Value);break;case n.ProductListScope.PriceQueryStringParamName:t.processFacetModelDeepLinks(SliderFacetModelNames.priceRangeModel,i.Value);break;case n.ProductListScope.FacetQueryStringParamName:t.processBrandFacetDeepLinks(i.Value);break;case n.ProductListScope.SortByQueryStringParamName:t.processSortByDeepLinks(i.Value)}});n.ProductListScope.categoryDeepLinkModel&&n.ProductListScope.categoryDeepLinkModel.Filters&&(n.ProductListScope.categoryDeepLinkModel.Filters=[])},i.prototype.processRatingsFacetDeepLinks=function(t){var i=this;n.ProductListScope.SkipPushState=!0;_.each(t,function(t){n.ProductListScope.AvailableProductRatings&&n.ProductListScope.AvailableProductRatings.indexOf(t)>-1&&(i.updateRatingsFacetList(t),i.updateFacetCheckboxes("rating",t,!0))});this.updateDiscountAndPriceModel();n.ProductListScope.SkipPushState=!1},i.prototype.updateFacetCheckboxes=function(n,t,i){var r=$("#"+n+"-"+t);i!==null&&r.prop("checked",i)},i.prototype.processBrandFacetDeepLinks=function(t){var r=this;_.defer(function(){n.ProductListScope.SkipPushState=!0;_.each(t,function(n){var t=$("#brand-"+n);t.length>0&&t.trigger("click")});n.ProductListScope.SkipPushState=!1;n.ProductListScope.DeepLinkPageState=r.getCurrentPageState();r.historyService.ReplaceState(i.HistoryStateKey,n.ProductListScope.DeepLinkPageState,window.location.href)})},i.prototype.processSortByDeepLinks=function(t){if(t&&t.length>0){var i=_.indexOf(n.ProductListScope.ValidSortOptions,t[0])!==-1;i&&(n.ProductListScope.selectedSortingValue=t[0],n.ProductListScope.selectSortingValue(n.ProductListScope.selectedSortingValue.toString()))}},i.prototype.processFacetModelDeepLinks=function(t,i){var h=_.any(i,function(n){return n===null});if(!h){var s=!1,r=n.ProductListScope[t],u=i[0],f=i[1],e,o;t===SliderFacetModelNames.priceRangeModel&&(e=this.centsToDollars(u),o=this.centsToDollars(f),u=parseFloat(e),f=parseFloat(o));u>=r.floor&&u<=r.maximum&&(s=!0,r.minimum=u,e&&(r.minimumDisplayValue=Math.floor(e)));f<=r.maximum&&f>=r.minimum&&(s=!0,r.maximum=f,o&&(r.maximumDisplayValue=Math.ceil(o)));_.each(r.facets,function(n){n.value>=r.minimum&&n.value<=r.maximum&&(n.isChecked=!0)});s&&(this.updateFacets(),t===SliderFacetModelNames.discountLevelModel&&(n.ProductListScope.DiscountRangeFacetSelected=!0,n.ProductListScope.PageLoadDiscountRange=$.extend({},r)),t===SliderFacetModelNames.priceRangeModel&&(n.ProductListScope.PriceRangeFacetSelected=!0,n.ProductListScope.PageLoadPriceRange=$.extend({},r)))}},i.prototype.centsToDollars=function(n){return parseInt(n)===0?n:(parseInt(n,10)/100).toFixed(2)},i.prototype.updateDiscountAndPriceModel=function(){var t=this.getDiscountAndPriceModel();t&&(n.ProductListScope.DiscountRangeFacetSelected||(n.ProductListScope.discountLevelModel=t.discountLevelModel,this.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),n.ProductListScope.PageLoadDiscountRange=$.extend({},n.ProductListScope.discountLevelModel)),n.ProductListScope.PriceRangeFacetSelected||(n.ProductListScope.priceRangeModel=t.priceRangeModel,this.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),n.ProductListScope.PageLoadPriceRange=$.extend({},n.ProductListScope.priceRangeModel)))},i.prototype.updateFacets=function(){var i,r,u,t;this.facetsLogicUseAnd()?(t=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.ProductListScope.ratingFacets.length>0?n.ProductListScope.filterLeftNavByProducts():n.ProductListScope.products,n.ProductListScope.facetsToShow=_(t).chain().pluck("Facets").flatten().value(),n.ProductListScope.deptFacetsToShow=_(t).chain().pluck("CategoryIds").flatten().uniq().value(),n.ProductListScope.validRatings=_(t).chain().filter(function(t){return n.ProductListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+.3)}).uniq().sortBy(function(n){return n}).value()):(i=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0?n.ProductListScope.filterLeftNavRatingsByProducts():n.ProductListScope.products,r=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||n.ProductListScope.ratingFacets.length>0?n.ProductListScope.filterLeftNavDeptByProducts():n.ProductListScope.products,n.ProductListScope.facetsToShow=[],AVON.Navigation&&AVON.Navigation.ShopBys&&(u=n.ProductListScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.ProductListScope.ratingFacets.length>0?n.ProductListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!0):n.ProductListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!1),n.ProductListScope.facetsToShow=_(u).chain().pluck("Id").flatten().uniq().value()),n.ProductListScope.deptFacetsToShow=_(r).chain().pluck("CategoryIds").flatten().uniq().value(),n.ProductListScope.validRatings=_(i).chain().filter(function(t){return n.ProductListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+.3)}).uniq().sortBy(function(n){return n}).value())},i.prototype.facetsLogicUseAnd=function(){return!0},i.prototype.productHasSelectedRating=function(t){if(this.facetsLogicUseAnd()){for(var i in n.ProductListScope.ratingFacets)return n.ProductListScope.ratingFacets[i]!==Math.floor(t.Rating+.3)?!1:n.ProductListScope.ShowProductRating(t);return!0}return n.ProductListScope.ratingFacets.length===0||n.ProductListScope.ShowProductRating(t)&&_.contains(n.ProductListScope.ratingFacets,Math.floor(t.Rating+.3))},i.prototype.updateRatingsFacetList=function(t){var u,r;_.contains(n.ProductListScope.ratingFacets,t)?n.ProductListScope.ratingFacets=_.reject(n.ProductListScope.ratingFacets,function(n){return n===t}):n.ProductListScope.ratingFacets.push(t);n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!this.historyService.IsPushStateSupported||(u=n.ProductListScope.GetUpdatedUrl(n.ProductListScope.RatingsQueryStringParamName,n.ProductListScope.ratingFacets),this.hasUserSelectedFacets()||this.historyService.PushStateUrl(window.location.href),r=this.getCurrentPageState(),this.historyService.ReplaceState(i.HistoryStateKey,r,u),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=r));this.updateFacets()},i.prototype.updateBrandsFacetList=function(t){_.each(n.ProductListScope.brandFacets,function(n){n.id==t&&(n.selected=!n.selected)});this.updateFacets()},i.prototype.setFacetHeaderItemToNoneIfAlreadyActive=function(t){return this.isFacetHeaderItemActive(t)&&(t=n.FacetHeaderType.None),t},i.prototype.resetScrollPositionForFilterBody=function(){$("#filter-body").scrollTop(0)},i.prototype.getFacetsFromAvailableProducts=function(t,i,r,u){var f=this,e=_.filter(n.ProductListScope.products,function(n){var t=!0,r;return i&&(t=_(u.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0),r=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0,f.productHasSelectedRating(n)&&t&&r}),o=_(e).chain().pluck("Facets").flatten().uniq().value();return _.each(t,function(n){var t=_.any(o,function(t){return t===n.Id}),i=_.any(r,function(t){return t.Id===n.Id});t||i||(n.IsEnabled=!1)}),t},i.prototype.productIsVisible=function(n){var t,i;if(this.facetsLogicUseAnd()){for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0)for(i in AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets)if(!_.contains(n.Facets,AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets[i].Id))return!1}else for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0&&_(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length===0)return!1;return!0},i.prototype.productIsVisibleByDepartment=function(n){if(this.facetsLogicUseAnd()){for(var t in AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)if(!_.contains(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets[t]))return!1;return!0}return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0},i.prototype.isProductVisible=function(n){var t=this.productIsVisible(n),i=this.productIsVisibleByDepartment(n);return this.productHasSelectedRating(n)&&this.productHasSelectedBrand(n)&&this.productInBetweenSelectedDiscounts(n)&&this.productInBetweenSelectedPrice(n)&&t&&i},i.prototype.updatedRefinedProductsCount=function(){n.ProductListScope.RefinedProductCount=_.filter(n.ProductListScope.products,function(n){return n.visible}).length;n.ProductListScope.VisibleProductsCount=n.ProductListScope.searchShowAmountLimit>n.ProductListScope.RefinedProductCount?n.ProductListScope.RefinedProductCount:n.ProductListScope.searchShowAmountLimit>n.ProductListScope.ClientConfiguration.MobileProductListPageSize?n.ProductListScope.searchShowAmountLimit:n.ProductListScope.ClientConfiguration.MobileProductListPageSize},i.prototype.productHasSelectedBrand=function(t){var i=_.reduce(n.ProductListScope.brandFacets,function(n,t){return t.selected&&n.push(t.id),n},[]);return i.length===0?!0:_.any(i,function(n){return _.any(t.CategoryIds,function(t){return t===n})})},i.prototype.productInBetweenSelectedDiscounts=function(t){return _.isUndefined(n.ProductListScope.discountLevelModel)||!n.ProductListScope.DiscountRangeFacetSelected?!0:t.DiscountPercent>=n.ProductListScope.discountLevelModel.minimum&&t.DiscountPercent<=n.ProductListScope.discountLevelModel.maximum?!0:!1},i.prototype.isFacetHeaderItemActive=function(t){return n.ProductListScope.selectedFacetHeader===t},i.prototype.dollarsToCents=function(n){return(n*100).toFixed(2)},i.prototype.sliderValueChangedFromDefault=function(t){return _.isUndefined(n.ProductListScope[t])?!1:n.ProductListScope[t].minimum!==n.ProductListScope.defaultSliderModel[t].minimum||n.ProductListScope[t].maximum!==n.ProductListScope.defaultSliderModel[t].maximum},i.prototype.applySliderChangeToFacetModel=function(t,r){var e,o,f,u,h,c,s;r===SliderFacetModelNames.priceRangeModel&&(e=t.minimumDisplayValue,o=t.maximumDisplayValue,t.minimum=e,t.maximum=o);f=this.sliderValueChangedFromDefault(r);r===SliderFacetModelNames.priceRangeModel?n.ProductListScope.PriceRangeFacetSelected=f:n.ProductListScope.DiscountRangeFacetSelected=f;n.ProductListScope.ProductSearchLoaded||n.ProductListScope.SkipPushState||!this.historyService.IsPushStateSupported||(u=[],h=r===SliderFacetModelNames.priceRangeModel?n.ProductListScope.PriceQueryStringParamName:n.ProductListScope.DiscountQueryStringParamName,f&&(r===SliderFacetModelNames.priceRangeModel?(u.push(Math.floor(this.dollarsToCents(e))),u.push(Math.ceil(this.dollarsToCents(o)))):(u.push(t.minimum),u.push(t.maximum))),c=n.ProductListScope.GetUpdatedUrl(h,u),this.hasUserSelectedFacets()||this.historyService.PushStateUrl(window.location.href),s=this.getCurrentPageState(),this.historyService.ReplaceState(i.HistoryStateKey,s,c),n.ProductListScope.DeepLinkPageState&&(n.ProductListScope.DeepLinkPageState=s));n.ProductListScope[r]=t;_.each(n.ProductListScope[r].facets,function(n){n.value>=t.minimum&&n.value<=t.maximum&&(n.isChecked=!0)})},i.prototype.getProductDiscountPercent=function(n){return n.PriceModel.DiscountPercent>0?n.PriceModel.DiscountPercent:0},i.prototype.showSliderFacet=function(t){return!_.isUndefined(n.ProductListScope[t])&&!isNaN(n.ProductListScope[t].minimum)&&!isNaN(n.ProductListScope.defaultSliderModel[t].minimum)&&!isNaN(n.ProductListScope[t].maximum)&&!isNaN(n.ProductListScope.defaultSliderModel[t].maximum)?n.ProductListScope[t].minimum!==n.ProductListScope.defaultSliderModel[t].minimum||n.ProductListScope[t].maximum!==n.ProductListScope.defaultSliderModel[t].maximum:!1},i.prototype.updateMenuItemGroupNames=function(){var e=[],o=[],t,i,r,u,f;if(n.ProductListScope.MenuItems)for(t=0;t<n.ProductListScope.MenuItems.length;t++)for(i=n.ProductListScope.MenuItems[t],r=0;r<i.GroupNames.length;r++)u=i.GroupNames[r],f={menuItem:i,groupName:u,Caption:u},o.push(f),n.ProductListScope.IsGroupTypeCategories(u)&&(n.ProductListScope.level4CategoryName||e.push(f));n.ProductListScope.CategoryGroupNames=e;n.ProductListScope.AllGroupNames=o},i.prototype.populateBrandAndCategoryFacets=function(){var t=this.getCategoriesBrandsIdsForProducts();n.ProductListScope.brandFacets=this.constructFacets(n.ProductListScope.GetBrandGroups(),t)},i.prototype.constructFacets=function(t,i){var r=[];return _.each(t,function(t){var i=n.ProductListScope.GetChildCategories(t.groupName);_.each(i,function(n){r.push({id:n.Id,caption:n.Caption,selected:!1})})}),_.filter(r,function(n){return _.contains(i,n.id)})},i.prototype.getCategoriesBrandsIdsForProducts=function(){var i=[],t=[];return _.each(n.ProductListScope.products,function(n){i.push(n.CategoryIds)}),t=t.concat.apply(t,i),_.uniq(t,!1,function(n){return n})},i.prototype.getUniqueProductsList=function(n){return _.uniq(n,!1,function(n){return n.Sku})},i.prototype.facetValueExists=function(n,t){return _.any(n,function(n){return n.value===t})},i.prototype.getCurrentPageState=function(){this.getSelectedFacetIds();return{Index:n.ProductListScope.StateIndex++,SelectedFacetIds:n.ProductListScope.SelectedFacetIds,SelectedRatings:n.ProductListScope.ratingFacets,SelectedPriceRange:{PriceRangeFacetSelected:n.ProductListScope.PriceRangeFacetSelected,Minimum:n.ProductListScope.priceRangeModel.minimumDisplayValue,Maximum:n.ProductListScope.priceRangeModel.maximumDisplayValue,Floor:n.ProductListScope.priceRangeModel.floor,Ceil:n.ProductListScope.priceRangeModel.ceil},SelectedDiscountRange:{DiscountRangeFacetSelected:n.ProductListScope.DiscountRangeFacetSelected,Minimum:n.ProductListScope.discountLevelModel.minimum,Maximum:n.ProductListScope.discountLevelModel.maximum,Floor:n.ProductListScope.discountLevelModel.floor,Ceil:n.ProductListScope.discountLevelModel.ceil},SelectedSortByValue:n.ProductListScope.selectedSortingValue}},i.prototype.compareWithDeepLinkPageState=function(t){var i=!1;return n.ProductListScope.DeepLinkPageState&&(t?(i=n.ProductListScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===t.SelectedFacetIds.sort().join(","),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedRatings.sort().join(",")===t.SelectedRatings.sort().join(",")),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedSortByValue===t.SelectedSortByValue),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Minimum===t.SelectedPriceRange.Minimum&&n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Maximum===t.SelectedPriceRange.Maximum),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Minimum===t.SelectedDiscountRange.Minimum&&n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Maximum===t.SelectedDiscountRange.Maximum)):(i=n.ProductListScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===n.ProductListScope.SelectedFacetIds.sort().join(","),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedRatings.sort().join(",")===n.ProductListScope.ratingFacets.sort().join(",")),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedSortByValue===n.ProductListScope.selectedSortingValue),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Minimum===n.ProductListScope.priceRangeModel.minimumDisplayValue&&n.ProductListScope.DeepLinkPageState.SelectedPriceRange.Maximum===n.ProductListScope.priceRangeModel.maximum),i&&(i=n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Minimum===n.ProductListScope.discountLevelModel.minimum&&n.ProductListScope.DeepLinkPageState.SelectedDiscountRange.Maximum===n.ProductListScope.discountLevelModel.maximum))),i},i.prototype.pageStateIsUnchanged=function(t){return t?this.compareWithDeepLinkPageState(t):n.ProductListScope.DeepLinkPageState?this.compareWithDeepLinkPageState(t):n.ProductListScope.SelectedFacetIds.length===0&&n.ProductListScope.ratingFacets.length===0&&n.ProductListScope.selectedSortingValue===SortOption.None&&!n.ProductListScope.PriceRangeFacetSelected&&!n.ProductListScope.DiscountRangeFacetSelected},i.prototype.showRatings=function(){var t=window.ProductModule,i;return t!=null&&t.productScope!=null?(i=_.any(n.ProductListScope.products,function(n){return t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")}),i&&_.each(n.ProductListScope.products,function(n){t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")||(n.Rating=0)}),i):!0},i.prototype.getSelectedFacetIds=function(){n.ProductListScope.SelectedFacetIds=[];_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.ProductListScope.SelectedFacetIds.push(t.Id)})});n.ProductListScope.SelectedFacetIds=n.ProductListScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)},i.prototype.hasUserSelectedFacets=function(){return n.ProductListScope.PageLoadUrl!==document.location.href},i.prototype.updateSort=function(t){n.ProductListScope.selectedSortingValue=t.length===0?SortOption.None:parseInt(t);var i=_.indexOf(n.ProductListScope.ValidSortOptions,n.ProductListScope.selectedSortingValue)!==-1;i&&(n.ProductListScope.selectSortingValue(n.ProductListScope.selectedSortingValue.toString()),n.ProductListScope.SafeApply())},i.prototype.updateFacetsFromState=function(n,t){_.each(n,function(n){var i=$("#brand-"+n);i&&i.is(":checked")&&t.indexOf(n.toString())===-1&&i.trigger("click");i&&!i.is(":checked")&&t.indexOf(n.toString())>=0&&i.trigger("click")})},i.prototype.incrementAndResetAddToBagButton=function(n,t){t===void 0&&(t=null);t?t.AddedToBagCount=t.AddedToBagCount?t.AddedToBagCount+1:1:n.AddedToBagCount=n.AddedToBagCount?n.AddedToBagCount+1:1},i.$inject=["$scope","$rootScope","productListService","$timeout","trackingService","productService","celebrosService","$filter","analyticsService","bagService","NotifyMeService","historyService","$window"],i.HistoryStateKey="LayoutLeftNavigation",i}(ProductListModule.CommonProductListController);n.MobileProductListCtrl=t}(MobileProductListModule||(MobileProductListModule={}));app.controller("MobileProductListController",MobileProductListModule.MobileProductListCtrl),function(n){var t=function(n){function t(t,i){n.call(this,t);this.shopByLineNumberService=i}return __extends(t,n),t.prototype.getProductNameByLineNumber=function(n,t,i,r){var u={RowId:n,LineNumber:t,CampaignNumber:i};return this.shopByLineNumberService.getProductNameByLineNumber(u,r)},t.prototype.getNumberFromCampaignString=function(){var t=this.getCurrentCampaign(),n=t.substring(4);return n.substring(0,1)==="0"&&(n=n.substring(1)),parseInt(n,10)},t.prototype.getCampaignNumbers=function(){var i=this.getCurrentCampaign(),r,u,e,o,f,n,t;if(i.length!==6)return["000000","000000"];if(r=i.substring(0,4),u=this.getNumberFromCampaignString(),u===1)return e=(parseInt(r,10)-1).toString(),[i,e+"26"];for(o=2,f=[],t=0;t<o;t+=1)n=(u-t).toString(),n=n.length<2?"0"+n:n,f[t]=r+n;return f},t.prototype.getFormattedCampaignNumbers=function(){for(var r,t=this.getCampaignNumbers(),i=[],n=0;n<t.length;n++)r={label:t[n].substring(4).toString(),value:parseInt(t[n])},i.push(r);return i},t.prototype.getCurrentCampaign=function(){return AVON.campaign.toString()},t}(BaseAngularController);n.BaseShopByLineNumberController=t}(ShopByLineNumberModule||(ShopByLineNumberModule={})),function(n){var t=function(n){function t(t,i,r){n.call(this,t,i,r);this.$rootScope=t}return __extends(t,n),t.prototype.getProductNameByLineNumber=function(n){return this.PostJson("/api/shopbylinenumber/getproductnamebylinenumber",n).error(function(){})},t.prototype.searchProductsByName=function(n){return this.PostJson("/api/shopbylinenumber/searchproductsbyname",{SearchTerm:n.searchTerm,CampaignNumber:n.campaignNumber}).then(function(n){return n.data})},t.$inject=["$rootScope","$http","$q"],t}(BaseAvonService);n.ShopByLineNumberService=t}(ShopByLineNumberServiceModule||(ShopByLineNumberServiceModule={}));app.service("shopByLineNumberService",ShopByLineNumberServiceModule.ShopByLineNumberService);__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t=function(t){function i(i,r,u,f,e,o){var s,h,c,l;if(t.call(this,i,f,e,o),this.$scope=i,n.productDetailScope=i,n.productDetailScope.reviewsLoaded=!1,n.productDetailScope.DisplayProductReviews=!1,n.productDetailScope.DisplayCrossSells=!1,n.productDetailScope.DisplayCustomerBuys=!1,n.productDetailScope.ShowCaroselSlide=function(t,i){var r=i!=null&&i.IsAvailable,u=t;return r&&(u===CarouselType.CustomerBuys?n.productDetailScope.DisplayCustomerBuys=!0:u===CarouselType.CrossSells&&(n.productDetailScope.DisplayCrossSells=!0)),r},s=n.productDetailScope.GetValueFromSessionStorage("ListedProductsIdsOrder"),s){if(h=s.indexOf(n.productDetailScope.product.Id),h<0){n.productDetailScope.SetValueIntoSessionStorage("ListedProductsIdsOrder",[]);return}h>0&&(c=s[h-1],$("head").append('<link rel="prev" href="'+n.productDetailScope.Url.Action("Details","Product")+"/"+c+'" />'));h<s.length-1&&(l=s[h+1],$("head").append('<link rel="next" href="'+n.productDetailScope.Url.Action("Details","Product")+"/"+l+'" />'))}n.productDetailScope.SessionService.WhenReady().then(function(){var t=u.Initialize();t.pagereferrer=document.referrer;t.productsku=n.productDetailScope.product.Sku;t.productname=n.productDetailScope.product.Name;t.productprice=n.productDetailScope.product.PriceModel.ListPrice.toString();t.websessionid=n.productDetailScope.Session.WebSessionId;t.qwisersearchsessionid=n.productDetailScope.Session.Search.SessionId;t.qwisersearchloghandle=n.productDetailScope.Session.Search.LogHandle;u.LogProductResult(t)})}return __extends(i,t),i.$inject=["$scope","$rootScope","celebrosService","$window","intersectionObserverService","$q"],i}(n.CommonProductDetailController);n.ProductDetailController=t}(ProductDetailModule||(ProductDetailModule={}));app.controller("ProductDetailController",ProductDetailModule.ProductDetailController),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h,c){var l=this,v,y,p,a;t.call(this,i,h,o);this.$rootScope=r;this.productListService=u;this.getDiscountAndPriceModel=function(){var f=l.getVisibleUniqueProducts(),t,i;if(f.length>0){t=_.reduce(f,function(n,t){var i,r;return t.PriceModel.DiscountPercent>0&&(i=l.facetValueExists(n.discountLevelFacets,t.PriceModel.DiscountPercent),i||n.discountLevelFacets.push({isChecked:!1,value:t.PriceModel.DiscountPercent,facetModelName:SliderFacetModelNames.discountLevelModel})),r=l.facetValueExists(n.priceRangeFacets,l.getLowestProductPrice(t)),r||n.priceRangeFacets.push({isChecked:!1,value:l.getLowestProductPrice(t),facetModelName:SliderFacetModelNames.priceRangeModel}),n},{discountLevelFacets:[],priceRangeFacets:[]});i=_.max(t.discountLevelFacets,l.getMinimumMaximumPriceIterator).value;_.isUndefined(i)&&(i=0);var r={facets:l.sortFacetsByValue(t.discountLevelFacets),minimum:0,maximum:i,floor:0},e=Math.floor(_.min(t.priceRangeFacets,l.getMinimumMaximumPriceIterator).value),o=Math.ceil(_.max(t.priceRangeFacets,l.getMinimumMaximumPriceIterator).value),u={facets:l.sortFacetsByValue(t.priceRangeFacets),minimum:e,maximum:o,minimumDisplayValue:e,maximumDisplayValue:o,floor:0};return r.floor=0,r.ceil=r.maximum,u.floor=0,n.productListScope.PriceRangeFacetSelected||(u.ceil=u.maximumDisplayValue),{discountLevelModel:r,priceRangeModel:u}}return null};this.getVisibleUniqueProducts=function(){var t=n.productListScope.productCategoryStructure.Products.length>0?n.productListScope.productCategoryStructure.Products:n.productListScope.uniqueProducts;return(AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.productListScope.ratings&&n.productListScope.ratings.length>0)&&(t=_.filter(n.productListScope.productCategoryStructure.Products,function(t){return n.productListScope.filterProductsByFacets(t)})),t};this.sortFacetsByValue=function(n){return _.sortBy(n,function(n){return n.value})};this.getMinimumMaximumPriceIterator=function(n){return n.value};this.getStructureForBrandWithSubBrands=function(t,i){var r={};return angular.copy(t,r),r.Children=[],r.Products=[],_.each(t.Children,function(n){_.each(n.Products,function(n){_.contains(n.CategoryIds,i)&&r.Products.push(n)})}),n.productListScope.uniqueProducts=l.getUniqueProducts(r.Products),r.Products=n.productListScope.uniqueProducts,r};n.productListScope=i;n.productListScope.minimumNumberOfProductsForSort=12;n.productListScope.ShowProductList=AVON.ShowProductList==null?!0:AVON.ShowProductList;n.productListScope.CategoryDeepLinkModel=AVON.CategoryDeepLinksModel;n.productListScope.products=AVON.productList||[];_.each(n.productListScope.products,function(t){t.Name=n.productListScope.SecureHtml(t.Name)});n.productListScope.uniqueProducts=[];n.productListScope.SelectedFacetIds=[];n.productListScope.SelectedCategoryId=AVON.SelectedCategoryId;n.productListScope.SelectedCategoryName=AVON.SelectedCategoryName;n.productListScope.SelectedCategoryType=AVON.SelectedCategoryType;n.productListScope.InitialSubCategoryId=AVON.InitialSubCategoryId;n.productListScope.topCategoryName=AVON.TopCategoryName||"";n.productListScope.level3CategoryName=AVON.Level3CategoryName||"";n.productListScope.level4CategoryName=AVON.Level4CategoryName||"";n.productListScope.RatingFudge=.3;n.productListScope.selectedFacets={};n.productListScope.flatSelectedFacets=[];n.productListScope.primeFacets=[];n.productListScope.ratings=[];n.productListScope.facetNames={};n.productListScope.defaultSliderModel={discountLevelModel:{},priceRangeModel:{}};n.productListScope.initialProductLoad=!1;n.productListScope.CustomMessages="";n.productListScope.searchShowAmountLimit=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize;n.productListScope.FilterNavigationSelectedDepartmentFacets=function(t){if(!n.productListScope.ProductSearchLoaded||!n.productListScope.SelectedFlitersToShowInSearchUi)return!0;var i=_.find(n.productListScope.SelectedFlitersToShowInSearchUi,function(n){return n.FacetId===t});return!i||!i.ExcludeFacetFromShowingInUi};n.productListScope.selectedSortingValue=SortOption.None;n.productListScope.sortingOptions={None:SortOption.None,Default:SortOption.Default,Price:SortOption.Price,Rating:SortOption.Rating,Name:SortOption.Name,Relevance:SortOption.Relevance,Discount:SortOption.Discount,SearchRelevance:SortOption.SearchRelevance};n.productListScope.sortingFilterValue=this.sortingFilters.Default;n.productListScope.productCategoryStructure={};n.productListScope.temporaryProductCategoryStructure={};n.productListScope.filterCategoryStructureByMenuLevel=function(t){switch(t.MenuLevel){case Level.Level2:return n.productListScope.SelectedCategoryHasChildCategoryDepartments?ProductCategorySection.Category:ProductCategorySection.Featured;case Level.PDept:return ProductCategorySection.None}};n.productListScope.isSortByContainerAllowedToShow=function(){if(_.isEmpty(n.productListScope.productCategoryStructure))return!1;var t=0;return!l.productCategoryStructureHasZeroChildren()&&(_.each(n.productListScope.productCategoryStructure.Children,function(n){t+=n.Products.length}),t>n.productListScope.minimumNumberOfProductsForSort)?!0:n.productListScope.productCategoryStructure.Products.length>n.productListScope.minimumNumberOfProductsForSort?!0:!1};n.productListScope.$on("productListScope.SortByUpdated",function(t,i){n.productListScope.selectedSortingValue=i;v();n.productListScope.SafeApply()});v=function(){var t,i,u;n.productListScope.SortByUpdated=!0;t=parseInt(n.productListScope.selectedSortingValue,10);switch(t){case SortOption.Price:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=l.sortingFilters.Price;break;case SortOption.Rating:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=l.sortingFilters.Rating;break;case SortOption.Name:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=l.sortingFilters.Name;break;case SortOption.Default:case SortOption.None:a();n.productListScope.sortingFilterValue=l.sortingFilters.Default;break;case SortOption.Relevance:n.productListScope.sortingFilterValue=l.sortingFilters.Relevance;break;case SortOption.SearchRelevance:n.productListScope.sortingFilterValue=l.sortingFilters.SearchRelevance;break;case SortOption.Discount:l.swapProductsWithUniqueProducts();n.productListScope.sortingFilterValue=l.sortingFilters.Discount}!n.productListScope.ProductSearchLoaded&&c.IsPushStateSupported&&n.productListScope.selectedSortingValue!==SortOption.None&&(i=[t],u=n.productListScope.GetUpdatedUrl(n.productListScope.SortByQueryStringParamName,i),r.$broadcast("productListScope.setSortUrl",u,t));n.productListScope.SortByUpdated=!1};i.$watch("selectedSortingValue",function(){v()});n.productListScope.showSortBySubBrand=function(){return n.productListScope.SelectedCategoryType==CategoryType.Brand&&!l.isCurrentMenuLevelDept()&&!l.isSortOptionNoneOrDefault()};n.productListScope.showSortByCategory=function(){return n.productListScope.SelectedCategoryType==CategoryType.Category&&!l.isCurrentMenuLevelDept()&&!l.isSortOptionNoneOrDefault()};n.productListScope.showSortByRelevance=function(){return!l.isSortOptionNoneOrDefault()&&n.productListScope.SelectedCategoryType===undefined&&AVON.SearchTerm==undefined};n.productListScope.showSortBySearchRelevance=function(){return!l.isSortOptionNoneOrDefault()&&n.productListScope.SelectedCategoryType===undefined&&AVON.SearchTerm!==undefined};n.productListScope.showSortByDiscount=function(){return _.isUndefined(n.productListScope.discountLevelModel)?!1:n.productListScope.discountLevelModel.facets.length>0};n.productListScope.IncreaseSearchShowAmountLimit=function(){n.productListScope.searchShowAmountLimit+=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize;n.productListScope.visibleProductsCount=n.productListScope.RefinedProductCount>n.productListScope.searchShowAmountLimit?n.productListScope.searchShowAmountLimit:n.productListScope.RefinedProductCount;n.productListScope.visibleProductsCount>n.productListScope.products.length&&(n.productListScope.visibleProductsCount=n.productListScope.products.length);n.productListScope.visibleProductsCountUpdated=!0;n.productListScope.SafeApply()};n.productListScope.GoToProductPage=function(t,i){if($(".ie").length>0){var r=[];$("div[data-product-summary-id]").each(function(){var n=parseInt($(l).attr("data-product-summary-id"),10);n>0&&r.push(n)});n.productListScope.SetValueIntoSessionStorage("ListedProductsIdsOrder",r)}n.productListScope.RedirectToUrl(n.productListScope.Url.Action("Details","Product")+"/"+i+"-"+t)};n.productListScope.GetPageHeading=function(){var i=$(".LeftNavItem  .SelectedCategory:first, .LeftNavFeaturedItem .SelectedCategory:first"),t=i.text();return n.productListScope.initialProductLoad?"":t.length>0?t:n.productListScope.SelectedCategoryName};n.productListScope.addToBag=function(n){var t={Sku:n,Quantity:1};r.$broadcast("AddToBag",t)};n.productListScope.updateSelectedFacets=function(t,i,r,u){var f,e;n.productListScope.SelectedFacetIds=[];u?AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(i)>=0&&(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=_(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).without(i)):(f=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t}),_(f.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(i)>=0&&(f.Facets=_(f.Facets).filter(function(n){return n.Id!=i}),AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0})));$("#LeftNavCheckbox-"+i).prop("checked",!1);AvonModule.AvonScope.$broadcast("productListScope.UpdateFacetState");AvonModule.AvonScope.$broadcast("productListScope.facetRemoved",i);AvonModule.AvonScope.$broadcast("productListScope.EnableFacetClear",i);n.productListScope.ProductSearchLoaded||l.updateDiscountAndPriceModel();a();n.productListScope.ProductSearchLoaded&&AVON.NavigationOriginalSearchFacets&&(n.productListScope.MatchedHiddenFacetsForSearch||(n.productListScope.MatchedHiddenFacetsForSearch=_.filter(AVON.NavigationOriginalSearchFacets,function(n){return n.Text===r&&n.Id!==i})),n.productListScope.MatchedHiddenFacetsForSearch&&(n.productListScope.MatchedHiddenFacetsForSearch.length>0?(e=n.productListScope.MatchedHiddenFacetsForSearch.pop(),n.productListScope.updateSelectedFacets(t,e.Id,e.Text,u)):n.productListScope.MatchedHiddenFacetsForSearch=null))};n.productListScope.getDepartmentName=function(n){return $("#facet-"+n).text().trim()};n.productListScope.setExclusiveFacet=function(t,i){n.productListScope.selectedFacets={};n.productListScope.selectedFacets[t]=[];n.productListScope.selectedFacets[t].push(i);n.productListScope.flatSelectedFacets=[];n.productListScope.flatSelectedFacets.push(i);n.productListScope.hiddenExclusiveFacet=i;n.productListScope.updatedRefinedProductsCount()};n.productListScope.updateRatings=function(t){if(n.productListScope.ratings=t,n.productListScope.ratings.length===0){a();AvonModule.AvonScope.$broadcast("productListScope.facetRemoved");return}l.swapProductsWithUniqueProducts();n.productListScope.SafeApply();n.productListScope.updatedRefinedProductsCount();AvonModule.AvonScope.$broadcast("productListScope.facetRemoved");l.updateDiscountAndPriceModel()};n.productListScope.removeRating=function(t){var i=_.indexOf(n.productListScope.ratings,t),r;i!==-1&&(n.productListScope.ratings.splice(i,1),$("#rating-"+t).prop("checked",!1),n.productListScope.updateRatings(n.productListScope.ratings));!n.productListScope.ProductSearchLoaded&&c.IsPushStateSupported&&(r=n.productListScope.GetUpdatedUrl(n.productListScope.RatingsQueryStringParamName,n.productListScope.ratings),c.ReplaceStateUrl(r));AvonModule.AvonScope.$broadcast("productListScope.facetRemoved");AvonModule.AvonScope.$broadcast("productListScope.RatingRemoved",t);l.updateDiscountAndPriceModel()};n.productListScope.filterProductsByFacets=function(t){var i=l.productIsVisible(t),r=l.productIsVisibleByDepartment(t);return t.visible=l.productHasSelectedRating(t)&&l.productInBetweenSelectedDiscounts(t)&&l.productInBetweenSelectedPrice(t)&&i&&r,t.Id===n.productListScope.products[n.productListScope.products.length-1].Id&&n.productListScope.updatedRefinedProductsCount(),t.visible};n.productListScope.filterLeftNavRatingsByProducts=function(n){return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n=_.filter(n,function(n){var i=_(t.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0,r=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0;return i&&r})}):AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(n=_.filter(n,function(n){return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0})),n};n.productListScope.filterLeftNavDeptByProducts=function(n){return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0?_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n=_.filter(n,function(n){var i=_(t.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0;return l.productHasSelectedRating(n)&&i})}):n=_.filter(n,function(n){return l.productHasSelectedRating(n)}),n};n.productListScope.filterLeftNavByProducts=function(n){return AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){n=_.filter(n,function(n){var i=!0;return _.each(t.Facets,function(t){_.contains(n.Facets,t.Id)||(i=!1)}),i})}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(n=_.filter(n,function(n){var t=!0;return _.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(i){_.contains(n.CategoryIds,i)||(t=!1)}),t})),n=_.filter(n,function(n){return l.productHasSelectedRating(n)})};n.productListScope.filterLeftNavByFacets=function(t,i,r){var u=_(t).chain().pluck("Facets").flatten().value(),e=u,f,o;return i&&(_.each(u,function(n){n.IsEnabled=!0}),AvonModule.AvonScope.LeftNavigationSelectedFacets&&AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0&&_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){var i=_.find(t,function(t){return t.Title===n.Title}),f=i.Facets;u=l.getFacetsFromAvailableProducts(u,!0,f,n,r)}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0&&(f=_.find(t,function(n){return n.IsDepartmentShopBy}),o=f.Facets,u=l.getFacetsFromAvailableProducts(u,!1,o,f,r)),n.productListScope.ratings&&n.productListScope.ratings.length>0&&(u=l.getFacetsFromAvailableProducts(u,!1,null,null,r)),e=_.filter(u,function(n){return n.IsEnabled===!0})),e};n.productListScope.updatedRefinedProductsCount=function(){if(n.productListScope.RefinedProductCount=_.filter(n.productListScope.productCategoryStructure.Products,function(n){return n.visible}).length,!n.productListScope.visibleProductsCountUpdated){var t=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize;n.productListScope.visibleProductsCount=n.productListScope.searchShowAmountLimit>n.productListScope.RefinedProductCount?n.productListScope.RefinedProductCount:n.productListScope.searchShowAmountLimit>t?n.productListScope.searchShowAmountLimit:t}};n.productListScope.productSelectedByFacets=function(t){for(var i in n.productListScope.selectedFacets)if(n.productListScope.selectedFacets[i].length>0&&_.intersection(n.productListScope.selectedFacets[i],t).length===0)return!1;return!0};n.productListScope.getFacetNames=function(){var t,i;if(AVON.Navigation!=null){t=_(AVON.Navigation.ShopBys).chain().pluck("Facets").flatten().value();for(i in t)n.productListScope.facetNames["facet"+t[i].Id]=t[i].Text}};n.productListScope.getPromoSpot=function(t,i,r){var f,o,u,e;if(n.productListScope.promotionSpots!=null&&(n.productListScope.flatSelectedFacets==null||n.productListScope.flatSelectedFacets.length===0)&&(n.productListScope.ratings==null||n.productListScope.ratings.length===0)&&n.productListScope.selectedSortingValue==SortOption.None){if(f=[],AVON.IsShopAllPage){for(o=[],u=0;u<n.productListScope.promotionSpots.length;u++)n.productListScope.promotionSpots[u].CategoryLeafName.toLowerCase()===i.toLowerCase()&&o.push(n.productListScope.promotionSpots[u]);f=o}else f=n.productListScope.promotionSpots;for(u=0;u<f.length;u++)if(e=f[u],r){if(e.IndexLocation>t)return l.isPromoStackEmpty(l.getCurrentPromo(e,i))}else if(e.IndexLocation==t)return l.isPromoStackEmpty(l.getCurrentPromo(e,i))}return null};n.productListScope.$on("productListScope.UpdateSelectedCategory",function(n,t,i,r,u,f){l.UpdateSelectedCategory(t,i,r,u,f)});n.productListScope.$on("productListScope.UpdateSelectedFacets",function(){n.productListScope.visibleProductsCountUpdated=!1});n.productListScope.$on("productListScope.SetExclusiveFacet",function(t,i,r){n.productListScope.setExclusiveFacet(i,r);n.productListScope.visibleProductsCountUpdated=!1});n.productListScope.$on("productListScope.UpdateMultipleSelectedFacets",function(t,i,r){for(var u=0;u<r.length;u++);n.productListScope.visibleProductsCountUpdated=!1;n.productListScope.ShowProductList=!0});n.productListScope.$on("productListScope.UpdateRatings",function(t,i){n.productListScope.updateRatings(i);n.productListScope.visibleProductsCountUpdated=!1});n.productListScope.$on("productListScope.updateFacets",function(n,t,i){l.updateFacets(t,i)});n.productListScope.$on("ProductListService.HeroSpotLoaded",function(t,i){i.indexOf('<div id="ErrorInfo">')<0&&(n.productListScope.rawHeroModule=i,n.productListScope.SafeApply(),e(function(){$(".ProductHeroSpot .BodyModuleContainers").children().length===0?$(".SupplementHeroHeader").removeClass("Hidden"):$(".ProductHeroSpot").removeClass("Hidden");_.delay(function(){n.productListScope.ShowProductList=AVON.ShowProductList==null?!0:AVON.ShowProductList;n.productListScope.HideLoading()},500)}))});n.productListScope.$on("ProductListService.BottomContentLoaded",function(t,i){i.indexOf('<div id="ErrorInfo">')<0&&(n.productListScope.rawBottomModule=i,n.productListScope.SafeApply(),e(function(){$(".ProductBottomContent .ContentModule").length===0?$(".ProductBottomContent").addClass("Hidden"):$(".ProductBottomContent").removeClass("Hidden")}))});n.productListScope.$on("ProductListService.ProductSpotsLoaded",function(t,i){i.PageTitle.length>0?$(document).prop("title",i.PageTitle):$(document).prop("title",n.productListScope.SelectedCategoryName+" | AVON");n.productListScope.promotionSpots=i.ProductPromotionSpots;n.productListScope.SafeApply()});n.productListScope.clearPriceRange=function(t){t===void 0&&(t=!0);n.productListScope.PriceRangeFacetSelected=!1;n.productListScope.hasInitialPriceFilter=!1;n.productListScope.priceRangeModel&&n.productListScope.defaultSliderModel&&(n.productListScope.priceRangeModel.minimum=n.productListScope.defaultSliderModel[SliderFacetModelNames.priceRangeModel].minimum,n.productListScope.priceRangeModel.maximum=n.productListScope.defaultSliderModel[SliderFacetModelNames.priceRangeModel].maximum);l.updateDiscountAndPriceModel();r.$broadcast("productListScope.PriceRangeCleared",t);a()};n.productListScope.clearDiscountLevel=function(t){t===void 0&&(t=!0);n.productListScope.DiscountRangeFacetSelected=!1;n.productListScope.hasInitialDiscountFilter=!1;n.productListScope.discountLevelModel&&n.productListScope.defaultSliderModel&&(n.productListScope.discountLevelModel.minimum=n.productListScope.defaultSliderModel[SliderFacetModelNames.discountLevelModel].minimum,n.productListScope.discountLevelModel.maximum=n.productListScope.defaultSliderModel[SliderFacetModelNames.discountLevelModel].maximum);l.updateDiscountAndPriceModel();r.$broadcast("productListScope.DiscountRangeCleared",t)};n.productListScope.$on("productListScope.SetDiscountRangeSelected",function(t,i){n.productListScope.hasInitialDiscountFilter=!1;n.productListScope.DiscountRangeFacetSelected=i});n.productListScope.$on("productListScope.SetPriceRangeSelected",function(t,i){n.productListScope.hasInitialPriceFilter=!1;n.productListScope.PriceRangeFacetSelected=i});n.productListScope.showPriceRange=function(){return l.showSliderFacet(SliderFacetModelNames.priceRangeModel,n.productListScope.hasInitialPriceFilter)};n.productListScope.showDiscountLevel=function(){return l.showSliderFacet(SliderFacetModelNames.discountLevelModel,n.productListScope.hasInitialDiscountFilter)};n.productListScope.showListFilter=function(){var t=n.productListScope.LeftNavigationSelectedDepartmentFacets.length>0||n.productListScope.LeftNavigationSelectedFacets.length>0||n.productListScope.ratings&&n.productListScope.ratings.length>0;return t=t||n.productListScope.productCategoryStructure.Children&&n.productListScope.productCategoryStructure.Children.length===0&&(n.productListScope.showPriceRange()||n.productListScope.showDiscountLevel()),t=t||n.productListScope.isSortByContainerAllowedToShow()&&n.productListScope.ShowProductList,t||AVON.SearchTerm!==undefined&&!t};y=function(){var t=window.ProductModule,i;return t!=null&&t.productScope!=null?(i=_.any(n.productListScope.products,function(n){return t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")}),i&&_.each(n.productListScope.uniqueProducts,function(n){t.productScope.displayProductBasedOnShowHideFlag(n,"IncludeInPowerReviews")||(n.Rating=0)}),i):!0};n.productListScope.$on("ProductListService.ProductCategoryLoaded",function(t,i){n.productListScope.temporaryProductCategoryStructure={};l.populateProductCategoryStructureWithProducts(i.ProductCategoryStructure,i.Products);_.isNull(i.SelectedCategoryId)||i.ProductCategoryStructure.Id===i.SelectedCategoryId?n.productListScope.productCategoryStructure=i.ProductCategoryStructure:(_.isEmpty(n.productListScope.temporaryProductCategoryStructure)&&(n.productListScope.temporaryProductCategoryStructure=i.ProductCategoryStructure),n.productListScope.productCategoryStructure=_.findWhere(n.productListScope.temporaryProductCategoryStructure.Children,{Id:i.SelectedCategoryId}));n.productListScope.SelectedCategoryHasChildCategoryDepartments=_.find(n.productListScope.productCategoryStructure.Children,function(n){return n.Section===ProductCategorySection.Category&&n.IncludeInLeftMenu});n.productListScope.products=i.Products;n.productListScope.uniqueProducts=l.getUniqueProducts(n.productListScope.products);n.productListScope.ShowRatings=y();AvonModule.AvonScope.$broadcast("ProductListController.ProductsLoaded",n.productListScope.ShowRatings);n.productListScope.AvailableProductRatings=n.productListScope.uniqueProducts.filter(function(t){return n.productListScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating)});n.productListScope.AvailableProductRatings=_.uniq(n.productListScope.AvailableProductRatings);var u=l.getDiscountAndPriceModel();u&&(n.productListScope.discountLevelModel=u.discountLevelModel,l.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),r.$broadcast("productListScope.discountLevelModelPopulated",n.productListScope.discountLevelModel),n.productListScope.priceRangeModel=u.priceRangeModel,l.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),r.$broadcast("productListScope.priceRangeModelPopulated",n.productListScope.priceRangeModel));l.populatePromotionsToLoad(n.productListScope.products);n.productListScope.RefinedProductCount=n.productListScope.productCategoryStructure.Products.length;n.productListScope.categoryTotalProductCount=n.productListScope.productCategoryStructure.Products.length;_.defer(function(){n.productListScope.initialProductLoad&&(n.productListScope.initialProductLoad=!1,n.productListScope.ShowProductList=!0,$("#link"+n.productListScope.InitialSubCategoryId).click());var t=!1;_.each(n.productListScope.CategoryDeepLinkModel.Filters,function(i){switch(i.Name.toLowerCase()){case n.productListScope.RatingsQueryStringParamName:l.processRatingsFacetDeepLinks(i.Value);break;case n.productListScope.DiscountQueryStringParamName:l.processFacetModelDeepLinks(SliderFacetModelNames.discountLevelModel,i.Value);n.productListScope.hasInitialDiscountFilter=!0;break;case n.productListScope.PriceQueryStringParamName:l.processFacetModelDeepLinks(SliderFacetModelNames.priceRangeModel,i.Value);n.productListScope.hasInitialPriceFilter=!0;break;case n.productListScope.FacetQueryStringParamName:l.processCategoryFacetDeepLinks(i.Value);break;case n.productListScope.SortByQueryStringParamName:t=!0}});t&&l.processSortByDeepLinks();n.productListScope.CategoryDeepLinkModel&&n.productListScope.CategoryDeepLinkModel.Filters&&n.productListScope.CategoryDeepLinkModel.Filters.length>0&&(AvonModule.AvonScope.$broadcast("ProductListController.DeepLinkProcessed"),n.productListScope.CategoryDeepLinkModel.Filters=[]);n.productListScope.SafeApply()});n.productListScope.promotionSpots=AVON.ProductPromotionSpots;AVON.FindMostSpecificLevel&&p(i.SelectedCategoryId)});p=function(n){var i=window.location.pathname.split("/").pop(),t;_.each(AVON.Navigation.LinkGroups,function(n){_.each(n.Links,function(n){if(n.Text.formatUrlNugget()===i.formatUrlNugget()){t=n;return}})});t&&t.Id!==n&&r.$broadcast("ProductListController.UpdateSelectedCategory",t)};n.productListScope.$on("productListScope.EnableFacetClear",function(t,i){var f=$("#LeftNavCheckbox-"+i),r=f.parents(".LeftNavGroupItem"),u=r.find(".LeftNavClearItem");r.find("input:checked").length?u.addClass("Active"):u.removeClass("Active");n.productListScope.SafeApply()});n.productListScope.$on("productListScope.UpdateDiscountAndPriceModel",function(){l.updateDiscountAndPriceModel()});n.productListScope.$on("ProductListService.ProductSearchRedirection",function(t,i){n.productListScope.RedirectToUrl(i)});n.productListScope.$on("ProductListService.ProductSearchLoaded",function(t,i){var o,u,e,r,f;for(n.productListScope.ProductSearchLoaded=!0,n.productListScope.productCategoryStructure.Products=i.Data.products,n.productListScope.productCategoryStructure.Children=[],n.productListScope.getFacetNames(),n.productListScope.IsDeadEndSearch=i.Data.IsDeadEndSearch,n.productListScope.IsLineNumberSearch=i.Data.IsLineNumberSearch,n.productListScope.products=i.Data.products,n.productListScope.RefinedProductCount=n.productListScope.products.length,n.productListScope.categoryTotalProductCount=n.productListScope.products.length,n.productListScope.AutoCorrectedSearchTerm=i.Data.AutoCorrectedSearchTerm,n.productListScope.CustomMessages=i.Data.CustomMessages,n.productListScope.ShowRatings=y(),n.productListScope.SafeApply(),n.productListScope.HideLoading(),o=n.productListScope.IsBlog()?n.productListScope.ClientConfiguration.BlogProductListPageSize:n.productListScope.ClientConfiguration.ProductListPageSize,n.productListScope.visibleProductsCount=o>n.productListScope.products.length?n.productListScope.products.length:o,n.productListScope.visibleProductsCountUpdated=!0,u=[],e=0;e<n.productListScope.products.length;e++)if(r=n.productListScope.products[e],r&&r.HasPromotion)for(f=0;f<r.Promotions.length;f++)u.indexOf(r.Promotions[f].PromotionId)<0&&u.push(r.Promotions[f].PromotionId);u.length>0&&AvonModule.AvonScope.$broadcast("GlobalProductController.LoadPromotions",u);AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.UpdatePrimeFacets",n.productListScope.primeFacets);l.trackSearchResultsEvent();n.productListScope.SessionService.WhenReady().then(function(){var t=s.Initialize();t.pagereferrer=document.referrer;t.websessionid=n.productListScope.Session.WebSessionId;t.qwisersearchsessionid=n.productListScope.Session.Search.SessionId;t.qwisersearchloghandle=n.productListScope.Session.Search.LogHandle;s.LogSearchResult(t)});$("#ProductsSortBy").val($("#ProductsSortBy option:first").val())});n.productListScope.$on("Navigation.SelectedLinkUpdated",function(){u.GetProductsInCategory(AvonModule.AvonScope.LeftNavigationSelectedLink);n.productListScope.SkipPushState=!0;n.productListScope.clearPriceRange(!1);n.productListScope.clearDiscountLevel(!1);n.productListScope.SkipPushState=!1});n.productListScope.$on("layoutLeftNavigationScope.ClearPriceAndDiscount",function(){n.productListScope.clearDiscountLevel(!0);n.productListScope.clearPriceRange(!0)});n.productListScope.$on("layoutLeftNavigationScope.FacetAdded",function(t,i,r,u){if(n.productListScope.visibleProductsCountUpdated=!1,l.swapProductsWithUniqueProducts(),n.productListScope.ProductSearchLoaded){n.productListScope.SelectedFlitersToShowInSearchUi||(n.productListScope.SelectedFlitersToShowInSearchUi=[]);var f={Text:r,FacetId:i,ExcludeFacetFromShowingInUi:u};_.findWhere(n.productListScope.SelectedFlitersToShowInSearchUi,f)||n.productListScope.SelectedFlitersToShowInSearchUi.push(f)}});a=function(){var t=parseInt(n.productListScope.selectedSortingValue,10);_.isEmpty(n.productListScope.temporaryProductCategoryStructure)||AvonModule.AvonScope.LeftNavigationSelectedFacets.length!==0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length!==0||n.productListScope.PriceRangeFacetSelected||n.productListScope.DiscountRangeFacetSelected||t!==SortOption.Default&&t!==SortOption.None||n.productListScope.level4CategoryName||n.productListScope.ratings.length!==0||l.swapProductsWithUniqueProducts(!0)};n.productListScope.$on("layoutLeftNavigationScope.FacetRemoved",function(){n.productListScope.visibleProductsCountUpdated=!1;a()});n.productListScope.getFacetNames();n.productListScope.ShowProductList&&n.productListScope.ShowLoading(AVON.messages.spinner_loading);_.defer(function(){AVON.SearchTerm!==undefined?($("#BreadCrumbs").addClass("HideBreadcrumbs"),n.productListScope.sortingFilterValue=l.sortingFilters.SearchRelevance,u.GetProductsBySearch(AVON.SearchTerm.trim())):(n.productListScope.SelectedCategoryId!=n.productListScope.InitialSubCategoryId&&(n.productListScope.initialProductLoad=!0,n.productListScope.ShowProductList=!1,n.productListScope.ShowLoading(AVON.messages.spinner_loading)),u.GetProductsInCategory(n.productListScope.SelectedCategoryId),n.productListScope.searchShowAmountLimit=9006);n.productListScope.SafeApply()})}return __extends(i,t),i.prototype.UpdateContentData=function(t,i,r){$(".SupplementHeroHeader").addClass("Hidden");$(".LeftNavPromotionSpot.BottomSpot").addClass("Hidden");n.productListScope.promotionSpots=[];n.productListScope.ShowProductList=!1;this.productListService.LoadCategoryHeroAndPromoSpots(t,i,r)},i.prototype.UpdateSelectedCategory=function(t,r,u,f,e){var o,c,h,a;if($(window).scrollTop(0),n.productListScope.primeFacets=[],n.productListScope.ratings=[],n.productListScope.topCategoryName=t,n.productListScope.SelectedCategoryName=r.Caption,n.productListScope.SelectedCategoryId=r.Id,n.productListScope.selectedSortingValue=SortOption.None,_.isEmpty(n.productListScope.temporaryProductCategoryStructure)&&angular.copy(n.productListScope.productCategoryStructure,n.productListScope.temporaryProductCategoryStructure),r.Url!=""&&(o=r.Url.match(i.CategoryUrlRegex),n.productListScope.level3CategoryName=o.length>=3?o[2]:"",n.productListScope.level4CategoryName=o.length>=5&&o[4]!==undefined?o[4]:""),e?r.Url===""&&(n.productListScope.level3CategoryName=r.Caption,n.productListScope.level4CategoryName=""):(r.Url===""&&(n.productListScope.level4CategoryName=r.Caption),n.productListScope.temporaryProductCategoryStructure.Children&&n.productListScope.temporaryProductCategoryStructure.Children.length?(c=_.findWhere(n.productListScope.temporaryProductCategoryStructure.Children,{Id:r.Id}),n.productListScope.productCategoryStructure=_.isUndefined(c)?this.getStructureForBrandWithSubBrands(n.productListScope.temporaryProductCategoryStructure,n.productListScope.SelectedCategoryId):c):n.productListScope.productCategoryStructure=this.getStructureForBrandWithoutSubBrands(n.productListScope.temporaryProductCategoryStructure,n.productListScope.SelectedCategoryId)),h=this.getDiscountAndPriceModel(),h&&(n.productListScope.discountLevelModel=h.discountLevelModel,this.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),this.$rootScope.$broadcast("productListScope.discountLevelModelPopulated",n.productListScope.discountLevelModel),n.productListScope.priceRangeModel=h.priceRangeModel,this.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),this.$rootScope.$broadcast("productListScope.priceRangeModelPopulated",n.productListScope.priceRangeModel)),n.productListScope.ShowLoading(AVON.messages.spinner_loading),AVON.languageId===2){var l="",s="",v="";e?(l=t,s=n.productListScope.SelectedCategoryName):(l=t,s=n.productListScope.temporaryProductCategoryStructure.NuggetName,a=_.find(n.productListScope.temporaryProductCategoryStructure.Children,function(t){return t.Id===n.productListScope.SelectedCategoryId}),a&&(v=a.NuggetName));s.formatUrlNugget()===n.productListScope.level4CategoryName&&(s=n.productListScope.temporaryProductCategoryStructure.NuggetName);this.UpdateContentData(l,s,n.productListScope.level4CategoryName)}else this.UpdateContentData(t,n.productListScope.level3CategoryName,n.productListScope.level4CategoryName);n.productListScope.SafeApply();n.productListScope.RefinedProductCount=n.productListScope.productCategoryStructure.Products.length},i.prototype.facetValueExists=function(n,t){return _.any(n,function(n){return n.value===t})},i.prototype.getUniqueProducts=function(n){return _.uniq(n,!1,function(n){return n.Sku})},i.prototype.getStructureForBrandWithoutSubBrands=function(t,i){var r={},u;return angular.copy(t,r),u=_.filter(r.Products,function(n){return _.contains(n.CategoryIds,i)}),n.productListScope.uniqueProducts=this.getUniqueProducts(u),r.Products=n.productListScope.uniqueProducts,r},i.prototype.setDefaultSliderModelValues=function(t){n.productListScope.defaultSliderModel[t].maximum=n.productListScope[t].maximum;n.productListScope.defaultSliderModel[t].minimum=n.productListScope[t].minimum},i.prototype.updateFacets=function(t,i){var r,u,f;if(n.productListScope[i]=t,_.each(n.productListScope[i].facets,function(n){n.value>=t.minimum&&n.value<=t.maximum&&(n.isChecked=!0)}),r=_.any(n.productListScope[i].facets,function(n){return n.isChecked}),!r&&(u=Math.floor(_.min(n.productListScope[i].facets,this.getMinimumMaximumPriceIterator).value),f=Math.ceil(_.max(n.productListScope[i].facets,this.getMinimumMaximumPriceIterator).value),r=parseInt(n.productListScope[i].minimum)!==f||parseInt(n.productListScope[i].maximum)!==u,!r)){_.isEmpty(n.productListScope.temporaryProductCategoryStructure)||this.swapProductsWithUniqueProducts(!0);return}this.swapProductsWithUniqueProducts();n.productListScope.updatedRefinedProductsCount();n.productListScope.visibleProductsCountUpdated=!1},i.prototype.swapProductsWithUniqueProducts=function(t){if(t===void 0&&(t=!1),t||n.productListScope.SortByUpdated||!(this.isCurrentMenuLevelDept()||this.productCategoryStructureHasZeroChildren())){if(t&&!_.isEmpty(n.productListScope.temporaryProductCategoryStructure)){n.productListScope.productCategoryStructure=n.productListScope.temporaryProductCategoryStructure;n.productListScope.temporaryProductCategoryStructure={};return}this.productCategoryStructureHasZeroChildren()||_.isEmpty(n.productListScope.temporaryProductCategoryStructure)&&(angular.copy(n.productListScope.productCategoryStructure,n.productListScope.temporaryProductCategoryStructure),n.productListScope.productCategoryStructure.Children=[],n.productListScope.productCategoryStructure.Products=n.productListScope.uniqueProducts)}},i.prototype.isSortOptionNoneOrDefault=function(){return n.productListScope.selectedSortingValue===SortOption.None||n.productListScope.selectedSortingValue===SortOption.Default},i.prototype.isCurrentMenuLevelDept=function(){return n.productListScope.productCategoryStructure.MenuLevel===Level.Dept},i.prototype.productCategoryStructureHasZeroChildren=function(){return n.productListScope.productCategoryStructure.Children&&n.productListScope.productCategoryStructure.Children.length===0},i.prototype.facetsLogicUseAnd=function(){return!0},i.prototype.productHasSelectedRating=function(t){if(this.facetsLogicUseAnd()){for(var i in n.productListScope.ratings)return n.productListScope.ratings[i]!==Math.floor(t.Rating+n.productListScope.RatingFudge)?!1:n.productListScope.ShowProductRating(t);return!0}return n.productListScope.ratings.length===0||n.productListScope.ShowProductRating(t)&&_.contains(n.productListScope.ratings,Math.floor(t.Rating+n.productListScope.RatingFudge))},i.prototype.productInBetweenSelectedDiscounts=function(t){return _.isUndefined(n.productListScope.discountLevelModel)||!n.productListScope.DiscountRangeFacetSelected?!0:t.DiscountPercent>=n.productListScope.discountLevelModel.minimum&&t.DiscountPercent<=n.productListScope.discountLevelModel.maximum?!0:!1},i.prototype.productIsVisible=function(n){var t,i;if(this.facetsLogicUseAnd()){for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0)for(i in AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets)if(!_.contains(n.Facets,AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets[i].Id))return!1}else for(t in AvonModule.AvonScope.LeftNavigationSelectedFacets)if(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets.length>0&&_(AvonModule.AvonScope.LeftNavigationSelectedFacets[t].Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length===0)return!1;return!0},i.prototype.productIsVisibleByDepartment=function(n){if(this.facetsLogicUseAnd()){for(var t in AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)if(!_.contains(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets[t]))return!1;return!0}return AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0},i.prototype.getFacetsFromAvailableProducts=function(n,t,i,r,u){var f=this,e=_.filter(u,function(n){var i=!0,u;return t&&(i=_(r.Facets).chain().pluck("Id").flatten().uniq().intersection(n.Facets).value().length>0),u=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length===0||_.intersection(n.CategoryIds,AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).length>0,f.productHasSelectedRating(n)&&i&&u}),o=_(e).chain().pluck("Facets").flatten().uniq().value();return _.each(n,function(n){var t=_.any(o,function(t){return t===n.Id}),r=_.any(i,function(t){return t.Id===n.Id});t||r||(n.IsEnabled=!1)}),n},i.prototype.isPromoStackEmpty=function(n){return!_.isNull(n)&&!_.isUndefined(n)&&!_.isUndefined(n.Stack)&&(n.Stack.ImageItems.length>0||n.Stack.RichTextItems.length>0||n.Stack.VideoItems.length>0)?n:null},i.prototype.getCurrentPromo=function(t,i){var r=i.formatUrlNugget(),u=$(".GroupProductListContainer").find("h3").length>0?$(".GroupProductListContainer").find("h3").first().text().formatUrlNugget():"";if(t.DisplayOnSegmentPage&&(AVON.IsShopAllPage||n.productListScope.level3CategoryName.length>0)&&n.productListScope.level4CategoryName.length===0){if((t.CategoryLeafName.length===0||t.CategoryLeafName==r||t.CategoryLeafName==n.productListScope.level3CategoryName.formatUrlNugget())&&(r.length===0||r.length>0&&(r==t.CategoryLeafName||r==u)))return t}else if(t.DisplayOnSubSegmentPage&&(AVON.IsShopAllPage||n.productListScope.level3CategoryName.length>0)&&n.productListScope.level4CategoryName.length>0&&(t.CategoryLeafName.length===0||t.CategoryLeafName==r||t.CategoryLeafName==n.productListScope.level3CategoryName.formatUrlNugget()||t.CategoryLeafName==n.productListScope.level4CategoryName.formatUrlNugget()))return t},i.prototype.buildProductCategoryStructureTree=function(n,t){var i=this;n.Children.length>0?_.each(n.Children,function(n){i.buildProductCategoryStructureTree(n,t)}):_.contains(t.CategoryIds,n.Id)&&n.Products.push(t)},i.prototype.populateProductCategoryStructureWithProducts=function(n,t){var i=this;_.each(t,function(t){i.buildProductCategoryStructureTree(n,t)});_.each(n.Children,function(n){if(n.MenuLevel===Level.PDept&&n.Section===ProductCategorySection.Category){var r=[],t=[],u;i.populateTopLevelCategoryWithProducts(n,r);t=t.concat.apply(t,r);u=i.getUniqueProducts(t);n.Products=u}})},i.prototype.populateTopLevelCategoryWithProducts=function(n,t){var i=this;n.Children.length>0?_.each(n.Children,function(n){i.populateTopLevelCategoryWithProducts(n,t)}):t.push(n.Products)},i.prototype.populatePromotionsToLoad=function(t){var i=[];_.each(t,function(t){n.productListScope.primeFacets=_.union(n.productListScope.primeFacets,t.CategoryIds);t.HasPromotion&&_.each(t.Promotions,function(n){i.indexOf(n.PromotionId)<0&&i.push(n.PromotionId)})});i.length>0&&this.$rootScope.$broadcast("GlobalProductController.LoadPromotions",i);this.$rootScope.$broadcast("layoutLeftNavigationScope.UpdatePrimeFacets",n.productListScope.primeFacets)},i.prototype.processRatingsFacetDeepLinks=function(t){var i=[];_.each(t,function(t){if(n.productListScope.AvailableProductRatings&&n.productListScope.AvailableProductRatings.indexOf(t)>-1){var r=$(".LeftNavGroupItem #rating-"+t);r.length>0&&(i.push(t),r.prop("checked",!0))}});i.length>0&&(this.$rootScope.$broadcast("productListScope.UpdateRatings",i),this.$rootScope.$broadcast("layoutLeftNavigationScope.PopulateSelectedRatings",i))},i.prototype.processCategoryFacetDeepLinks=function(n){var t=this;_.each(n,function(n){t.$rootScope.$broadcast("productListScope.CategoryFacetDeepLink",n)})},i.prototype.centsToDollars=function(n){return(parseInt(n,10)/100).toFixed(2)},i.prototype.processFacetModelDeepLinks=function(t,i){var c=_.any(i,function(n){return n===null}),h;if(!c){var s=!1,r=n.productListScope[t],u=i[0],f=i[1],e,o;t===SliderFacetModelNames.priceRangeModel&&(e=this.centsToDollars(u),o=this.centsToDollars(f),u=parseFloat(e),f=parseFloat(o));u>=r.floor&&u<=r.maximum&&(s=!0,r.minimum=u,e&&(r.minimumDisplayValue=Math.floor(e)));f<=r.maximum&&f>=r.minimum&&(s=!0,r.maximum=f,o&&(r.maximumDisplayValue=Math.ceil(o)));s&&(_.each(r.facets,function(n){n.value>=r.minimum&&n.value<=r.maximum&&(n.isChecked=!0)}),h=t==="discountLevelModel"?"productListScope.discountLevelModelPopulated":"productListScope.priceRangeModelPopulated",this.$rootScope.$broadcast(h,t==="discountLevelModel"?n.productListScope.discountLevelModel:n.productListScope.priceRangeModel),t==="discountLevelModel"&&(n.productListScope.DiscountRangeFacetSelected=!0),t==="priceRangeModel"&&(n.productListScope.PriceRangeFacetSelected=!0),this.updateFacets(r,t),this.$rootScope.$broadcast(h,r),this.$rootScope.$broadcast("productListScope.FacetModelDeepLink",t,r))}},i.prototype.updateDiscountAndPriceModel=function(){var t=this.getDiscountAndPriceModel();t&&(n.productListScope.DiscountRangeFacetSelected||(n.productListScope.discountLevelModel=t.discountLevelModel,this.setDefaultSliderModelValues(SliderFacetModelNames.discountLevelModel),this.$rootScope.$broadcast("productListScope.discountLevelModelPopulated",n.productListScope.discountLevelModel)),n.productListScope.PriceRangeFacetSelected||(n.productListScope.priceRangeModel=t.priceRangeModel,this.setDefaultSliderModelValues(SliderFacetModelNames.priceRangeModel),this.$rootScope.$broadcast("productListScope.priceRangeModelPopulated",n.productListScope.priceRangeModel)))},i.prototype.processSortByDeepLinks=function(){var t=_.find(n.productListScope.CategoryDeepLinkModel.Filters,function(n){return n.Name.toLowerCase()==="sortby"});if(t){var i=$(".SortByContainer select option"),r=$.map(i,function(n){return parseInt(n.value)}),u=_.indexOf(r,t.Value[0])!==-1;u&&(n.productListScope.selectedSortingValue=t.Value[0])}},i.prototype.showSliderFacet=function(t,i){return _.isUndefined(n.productListScope[t]&&this.getVisibleUniqueProducts().length>0)?!1:n.productListScope[t].minimum!==n.productListScope.defaultSliderModel[t].minimum||n.productListScope[t].maximum!==n.productListScope.defaultSliderModel[t].maximum||i},i.$inject=["$scope","$rootScope","productListService","$sce","$timeout","trackingService","celebrosService","$window","historyService"],i.CategoryUrlRegex=/\/category\/([0-9a-zA-Z_-]*)\/([0-9a-zA-Z_-]*)(\/([0-9a-zA-Z_-]*))?/i,i}(n.CommonProductListController);n.ProductListCtrl=t}(ProductListModule||(ProductListModule={}));app.controller("ProductListController",ProductListModule.ProductListCtrl),function(n){var t=function(t){function i(i,r,u,f,e,o){var s=this;t.call(this,r,f);this.trackingService=o;n.shopByLineNumberScope=r;n.shopByLineNumberScope.buttonDisabled=!1;n.shopByLineNumberScope.itemsAddedCount=0;n.shopByLineNumberScope.itemAdded=!1;n.shopByLineNumberScope.invalidLineNumbers=AVON.InvalidLineNumbers;n.shopByLineNumberScope.addProductsToBag=function(){for(var i,r,t,o,u=[],s=[],f=0;f<n.shopByLineNumberScope.productRows.length;f++)if(i=n.shopByLineNumberScope.productRows[f],r={Campaign:0,LineNumber:"",Quantity:0,Sku:"",Fsc:""},i.hasBeenFilled&&(i.isAttachedOnlyProduct===!1||i.isAttachedOnlyProduct&&n.shopByLineNumberScope.isCustomerAttachedOrCookiedToRep())){if(t={Quantity:0,Sku:"",Fsc:"",LineNumber:"",CampaignNumber:0,OrderType:"LI",Id:0},o=parseInt(i.quantity,10),t.Quantity=isNaN(o)?1:o,r.Quantity=t.Quantity,t.Quantity===0)return;t.Id=i.id;t.LineNumber=i.lineNumber;t.CampaignNumber=i.selectedCampaign;t.Sku=i.sku;t.Fsc=i.fsc;r.LineNumber=t.LineNumber;r.Campaign=t.CampaignNumber;r.Sku=t.Sku;r.Fsc=t.Fsc;t.Quantity>0&&(u.push(t),s.push(r))}u.length>0&&(n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_adding),e.lineEntryAddProductsToBag(u));setTimeout(function(){var n=$(".product-row-error-message:Visible").first();n.length&&n.scrollintoview({duration:400,direction:"both",complete:null,offsetY:-150})},500)};n.shopByLineNumberScope.searchAndAddProductsToBag=function(t){n.shopByLineNumberScope.searchProductNameByLineNumber(t,!0)};n.shopByLineNumberScope.setFilled=function(t){var i=n.shopByLineNumberScope.productRows[t],r;if(i.quantity.length>0&&(r=parseInt(i.quantity,10),r===0)){i.isInvalidLineNumber=!0;return}i.quantity.length>0||i.name.length>0?i.lineNumber.length===0&&(i.hasBeenFilled=!0):i.lineNumber.length===0&&(i.hasBeenFilled=!1)};n.shopByLineNumberScope.isRepDeliveryAvailable=function(){return n.shopByLineNumberScope.Session.Customer.DeliveryType==DeliveryType.RepOnly||n.shopByLineNumberScope.Session.Customer.DeliveryType==DeliveryType.RepOrDirect};n.shopByLineNumberScope.isRepDeliveryOnly=function(n){return n===DeliveryType.RepOnly};n.shopByLineNumberScope.isAvailableForPurchase=function(t){var r=n.shopByLineNumberScope.isRepDeliveryOnly(t.deliveryType),i=n.shopByLineNumberScope.isCustomerAttachedOrCookiedToRep();return t.isAvailable?r&&!i?!1:r&&i&&!n.shopByLineNumberScope.isRepDeliveryAvailable()?!1:t.isAttachedOnlyProduct&&!i?!1:!0:!1};n.shopByLineNumberScope.findARepresentative=function(t){t.hasAddToBagFailed=!1;n.shopByLineNumberScope.FindRepresentativeClicked(!1)};n.shopByLineNumberScope.addProductSearchResultToList=function(t){for(var u,r=n.shopByLineNumberScope.currentPageLines[t],f=!1,i=0;i<n.shopByLineNumberScope.productRows.length;i++)if(n.shopByLineNumberScope.productRows[i].lineNumber===""){n.shopByLineNumberScope.productRows[i].selectedCampaign=n.shopByLineNumberScope.searchSelectedCampaign;n.shopByLineNumberScope.productRows[i].name=r.fullName;n.shopByLineNumberScope.productRows[i].quantity="1";n.shopByLineNumberScope.productRows[i].lineNumber=r.lineNumber.toString();n.shopByLineNumberScope.productRows[i].sku=r.sku;n.shopByLineNumberScope.productRows[i].hasBeenFilled=!0;n.shopByLineNumberScope.productRows[i].isAttachedOnlyProduct=r.attachedOnlyProduct;f=!0;break}f||(u=n.shopByLineNumberScope.productRows.length,s.addRows(1,u),n.shopByLineNumberScope.productRows[u].selectedCampaign=n.shopByLineNumberScope.searchSelectedCampaign,n.shopByLineNumberScope.productRows[u].name=r.fullName,n.shopByLineNumberScope.productRows[u].quantity="1",n.shopByLineNumberScope.productRows[u].lineNumber=r.lineNumber.toString(),n.shopByLineNumberScope.productRows[i].sku=r.sku,n.shopByLineNumberScope.productRows[u].hasBeenFilled=!0,n.shopByLineNumberScope.productRows[i].isAttachedOnlyProduct=r.attachedOnlyProduct);r.hasBeenAdded=!0;n.shopByLineNumberScope.itemAdded=!0};$("#search-results-dialog").on("close",function(){if(n.shopByLineNumberScope.itemAdded){var t=$("#product-list").first();t.scrollintoview({duration:400,direction:"both",complete:null,offsetY:-150})}n.shopByLineNumberScope.searchTerm="";n.shopByLineNumberScope.itemAdded=!1});n.shopByLineNumberScope.addRepProductToBag=function(t){var r=n.shopByLineNumberScope.productRows[t],f=[],i,u,o;r.hasBeenFilled&&(i={Quantity:1,Sku:"",LineNumber:"",CampaignNumber:0,OrderType:"LI",Id:0},u=parseInt(r.quantity,10),i.Quantity=isNaN(u)?1:u,i.Quantity===0&&(i.Quantity=1),i.Id=r.id,i.LineNumber=r.lineNumber,i.CampaignNumber=r.selectedCampaign,i.Sku=r.sku,i.Quantity>0&&(o={ForceAddWhenAvailableSoon:!0},$.extend(i,o),f.push(i)),n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_adding),e.lineEntryAddProductsToBag(f))};n.shopByLineNumberScope.addProductToNotify=function(t){n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_loading);var i=n.shopByLineNumberScope.productRows[t],r={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:"/product/notifymemodalbylinenumber?lineNumber="+i.lineNumber+"&campaignNumber="+i.selectedCampaign+""};$("#NotifyMeModal").trigger("modal",r);_.defer(function(){n.shopByLineNumberScope.resetProductRow(t)})};n.shopByLineNumberScope.$on("BagService.LineEntryAddSingleProductToBag",function(t,i){var r=i.Data;i.ErrorCode===AjaxError.ValidationErrors&&n.shopByLineNumberScope.ProcessAjaxValidationErrors(i)});n.shopByLineNumberScope.$on("BagService.LineEntryAddProductsToBag",function(t,r){var h,s,f,e,c,v;if(n.shopByLineNumberScope.HideLoading(),h=r.Data,r.ValidationErrors!=null&&r.ValidationErrors.length>0)n.shopByLineNumberScope.ProcessAjaxValidationErrors(r);else{for(n.shopByLineNumberScope.itemsAdded=[],n.shopByLineNumberScope.itemsAddedCount=0,s=0;s<h.ItemsAdded.length;s++){var f=h.ItemsAdded[s],y=n.shopByLineNumberScope.productRows[f.Id].name,p={Id:f.Id,Name:y,Quantity:f.Quantity,Sku:f.Sku};n.shopByLineNumberScope.itemsAdded.push(p);n.shopByLineNumberScope.itemsAddedCount+=f.Quantity;n.shopByLineNumberScope.resetProductRow(f.Id)}for(s=0;s<h.ItemsFailed.length;s++)f=h.ItemsFailed[s],e=n.shopByLineNumberScope.productRows[f.Id],f.AvailableSoon?(e.isAvailable=!1,e.isAvailableSoon=!0,c=$(".warning-message").first(),c.length&&n.shopByLineNumberScope.ScrollToTop()):f.ErrorMessages!=null&&f.ErrorMessages.length>0&&(e.isInvalidProduct=!1,e.hasAddToBagFailed=!0,e.isCurrentlyAvailable=!0,e.addToBagErrorMessage=f.ErrorMessages[0]),(f.DeliveryType==1||f.DeliveryType==2)&&(e.canBeRepDelivered=!0),e.deliveryType=f.DeliveryType;if(n.shopByLineNumberScope.itemsAddedCount>0){var l=$(".AddToBagSuccessMsg"),o=$(".button-bag"),a=$("#ClearFormLink");l.show();o.removeClass("Loading").addClass("Button2");o.prop("disabled",!0);n.shopByLineNumberScope.buttonDisabled=!0;a.hide();v=n.shopByLineNumberScope.itemsAddedCount===1?o.data("single-add-to-bag"):o.data("multiple-add-to-bag");o.text(v.replace("{0}",n.shopByLineNumberScope.itemsAddedCount));u(function(){l.hide();o.text(o.data("add-msg"));o.removeClass("Button2").addClass("Button");o.prop("disabled",!1);n.shopByLineNumberScope.buttonDisabled=!1;a.show();var t=$("#product-list").first();t.scrollintoview({duration:400,direction:"both",complete:null,offsetY:-150})},3e3)}i.$broadcast("BagService.AddToBagSuccess",null)}});n.shopByLineNumberScope.initializeRenderView=function(){s.addRows(n.shopByLineNumberScope.defaultRowSize,0)};n.shopByLineNumberScope.instantiateEmptyRow=function(){return{id:0,selectedCampaign:null,availableCampaignOptions:[],hasBeenFilled:!1,name:"",quantity:"",abbreviatedCampaignNumber:"",campaignNumber:0,lineNumber:"",isInvalidLineNumber:!1,isInvalidProduct:!1,isAvailable:!0,isNoLongerAvailable:!1,isAvailableSoon:!1,isPromotionNotMet:!1,isCurrentlyAvailable:!0,canBeRepDelivered:!1,hasAddToBagFailed:!1,addToBagErrorMessage:"",sku:"",fsc:"",isAttachedOnlyProduct:!1,deliveryType:DeliveryType.None}};n.shopByLineNumberScope.searchProductNameByLineNumber=function(t,i){var r,u;t<0||t>=n.shopByLineNumberScope.productRows.length||(r=n.shopByLineNumberScope.productRows[t].lineNumber,r.length>0?(u=n.shopByLineNumberScope.productRows[t].selectedCampaign,s.getProductNameByLineNumber(t,r,u,i).success(function(n){return s.onGetProductNameByLineNumberSuccess(n,i)})):n.shopByLineNumberScope.resetProductRow(t))};n.shopByLineNumberScope.resetProductRow=function(t){var i=n.shopByLineNumberScope.productRows[t];i.quantity="";i.hasBeenFilled=!1;i.isInvalidLineNumber=!1;i.isInvalidProduct=!1;i.lineNumber="";i.name="";i.isAvailable=!0;i.isNoLongerAvailable=!1;i.isAvailableSoon=!1;i.canBeRepDelivered=!1;i.addToBagErrorMessage="";i.hasAddToBagFailed=!1;i.isCurrentlyAvailable=!0;i.isAttachedOnlyProduct=!1;i.deliveryType=DeliveryType.None;i.selectedCampaign=n.shopByLineNumberScope.productRows[t].availableCampaignOptions[0].value};n.shopByLineNumberScope.resetForm=function(){for(var t,r=n.shopByLineNumberScope.productRows.slice(0,n.shopByLineNumberScope.defaultRowSize),i=0;i<r.length;i++)t=r[i],t.quantity="",t.hasBeenFilled=!1,t.isInvalidLineNumber=!1,t.isInvalidProduct=!1,t.lineNumber="",t.name="",t.quantity="",t.isAvailable=!0,t.isNoLongerAvailable=!1,t.isAvailableSoon=!1,t.canBeRepDelivered=!1,t.selectedCampaign=n.shopByLineNumberScope.productRows[i].availableCampaignOptions[0].value,t.addToBagErrorMessage="",t.hasAddToBagFailed=!1,t.isCurrentlyAvailable=!0,t.isAttachedOnlyProduct=!1,t.deliveryType=DeliveryType.None;n.shopByLineNumberScope.productRows=r};n.shopByLineNumberScope.addAdditionalRows=function(){s.addRows(5,n.shopByLineNumberScope.productRows.length)};n.shopByLineNumberScope.clearAdditionalInformation=function(t){if(!(t<0)&&!(t>=n.shopByLineNumberScope.productRows.length)){var i=n.shopByLineNumberScope.productRows[t];i.isInvalidLineNumber=!1;i.isInvalidProduct=!1;i.hasAddToBagFailed=!1;i.isCurrentlyAvailable=!0}};n.shopByLineNumberScope.checkForInvalidLineNumbers=function(){var t=n.shopByLineNumberScope.searchTerm.replace("-","");return $.inArray(t,n.shopByLineNumberScope.invalidLineNumbers)>-1?!0:!1};n.shopByLineNumberScope.searchProductsByTerm=function(){if(n.shopByLineNumberScope.checkForInvalidLineNumbers()){n.shopByLineNumberScope.invalidSearchTerm=!0;n.shopByLineNumberScope.searchTerm="";return}if(n.shopByLineNumberScope.invalidSearchTerm=!1,/\S/.test(n.shopByLineNumberScope.searchTerm)){n.shopByLineNumberScope.ShowLoading(AVON.messages.spinner_loading);var t={searchTerm:n.shopByLineNumberScope.searchTerm,campaignNumber:n.shopByLineNumberScope.searchSelectedCampaign};f.searchProductsByName(t).then(function(n){s.onSearchProductsByNameResponse(n)})}};n.shopByLineNumberScope.moveToPreviousPage=function(){n.shopByLineNumberScope.currentPageNumber>1&&n.shopByLineNumberScope.currentPageNumber--;n.shopByLineNumberScope.currentPage=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1];n.shopByLineNumberScope.currentPageLines=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1].lines;n.shopByLineNumberScope.updatePagerButtons()};n.shopByLineNumberScope.moveToNextPage=function(){n.shopByLineNumberScope.currentPageNumber<n.shopByLineNumberScope.searchResultsPages.length&&n.shopByLineNumberScope.currentPageNumber++;n.shopByLineNumberScope.currentPage=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1];n.shopByLineNumberScope.currentPageLines=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1].lines;n.shopByLineNumberScope.updatePagerButtons()};n.shopByLineNumberScope.moveToPage=function(t){n.shopByLineNumberScope.currentPageNumber=t<1?1:t>n.shopByLineNumberScope.searchResultsPages.length?n.shopByLineNumberScope.searchResultsPages.length:t;n.shopByLineNumberScope.currentPage=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1];n.shopByLineNumberScope.currentPageLines=n.shopByLineNumberScope.searchResultsPages[n.shopByLineNumberScope.currentPageNumber-1].lines;n.shopByLineNumberScope.updatePagerButtons()};n.shopByLineNumberScope.updatePagerButtons=function(){n.shopByLineNumberScope.movePreviousPageActive=n.shopByLineNumberScope.currentPageNumber>1;n.shopByLineNumberScope.moveNextPageActive=n.shopByLineNumberScope.currentPageNumber<n.shopByLineNumberScope.searchResultsPages.length};n.shopByLineNumberScope.displaySearchResultsDialog=function(t){n.shopByLineNumberScope.HideLoading();$("#search-results-dialog").trigger("modal",t)};n.shopByLineNumberScope.defaultRowSize=10;n.shopByLineNumberScope.productRows=[];n.shopByLineNumberScope.searchTerm="";n.shopByLineNumberScope.searchAvailableCampaignOptions=this.getFormattedCampaignNumbers();n.shopByLineNumberScope.searchSelectedCampaign=n.shopByLineNumberScope.searchAvailableCampaignOptions[0].value;n.shopByLineNumberScope.defaultSearchRowCount=8;n.shopByLineNumberScope.initializeRenderView()}return __extends(i,t),i.prototype.onGetProductNameByLineNumberSuccess=function(t,i){if(!t.ErrorCode||t.ErrorCode!=AjaxError.ValidationErrors){var u={rowId:t.Data.RowId,productName:t.Data.ProductName,invalidLineNumber:t.Data.InvalidLineNumber,sku:t.Data.Sku,fsc:t.Data.Fsc,deliveryType:t.Data.DeliveryType},r=n.shopByLineNumberScope.productRows[u.rowId];if(r.lineNumber.length===0)return;r.isInvalidProduct=u.invalidLineNumber;r.sku=t.Data.Sku;r.fsc=t.Data.Fsc;r.isCurrentlyAvailable=t.Data.IsCurrentlyAvailable;r.isAttachedOnlyProduct=t.Data.AttachedOnlyProduct;r.deliveryType=t.Data.DeliveryType;r.name="";r.hasBeenFilled=!1;r.isAvailable=!0;!r.isInvalidProduct&&r.isCurrentlyAvailable?(r.name=u.productName,r.hasBeenFilled=!0,i&&n.shopByLineNumberScope.addProductsToBag()):r.hasAddToBagFailed=!1}},i.prototype.addRows=function(t,i){var f=this.getFormattedCampaignNumbers(),u,r;if(t>0)for(u=0;u<t;u++)r=n.shopByLineNumberScope.instantiateEmptyRow(),r.id=i+u,r.availableCampaignOptions=f,r.selectedCampaign=r.availableCampaignOptions[0].value,n.shopByLineNumberScope.productRows.push(r)},i.prototype.onSearchProductsByNameResponse=function(t){var e,o,l,f,v,y;if(!t.ErrorCode||t.ErrorCode!=AjaxError.ValidationErrors){var p=0,s=0,u=[],a=0,h=Math.floor(t.Data.Items.length/n.shopByLineNumberScope.defaultSearchRowCount),c=t.Data.Items.length%n.shopByLineNumberScope.defaultSearchRowCount;for(c>0&&h++,e=0;e<h;e++){for(o={pageNumber:++p,lines:[],startNonVersionLinePageIndex:s,endNonVersionLinePageIndex:s},l=!1,f=0;f<n.shopByLineNumberScope.defaultSearchRowCount;f++){if(e+1==h&&c>0&&f>=c)break;var r=n.shopByLineNumberScope.defaultSearchRowCount*e+f,w=t.Data.Items[r].ListPrice,b=t.Data.Items[r].SalePrice,i={listPrice:w.toFixed(2),lineNumber:t.Data.Items[r].LineNumber.replace("-",""),name:t.Data.Items[r].Name,fullName:t.Data.Items[r].FullName,salePrice:b.toFixed(2),isVersion:t.Data.Items[r].IsVersion,hasVersions:t.Data.Items[r].HasVersions,hasBeenAdded:!1,id:f,fullDisplayName:t.Data.Items[r].FullName,sku:t.Data.Items[r].Sku,attachedOnlyProduct:t.Data.Items[r].AttachedOnlyProduct};i.isVersion?i.fullDisplayName=i.fullDisplayName+" - "+i.lineNumber:(s++,o.endNonVersionLinePageIndex++,a++,i.hasVersions||(i.fullDisplayName=i.fullDisplayName+" - "+i.lineNumber));i.isVersion||l||(o.startNonVersionLinePageIndex=s,l=!0);i.isVersion||!i.isVersion&&!i.hasVersions;o.lines.push(i)}u.push(o);v={Type:TrackingEventType.ShopbyProductNumberSearchResults,Data:{searchTerm:n.shopByLineNumberScope.searchTerm,campaignNumber:n.shopByLineNumberScope.searchSelectedCampaign,resultsNo:t.Data.HasExactMatchBeenFound?t.Data.Items.length:"zero"}};this.trackingService.TrackEventItem(v)}n.shopByLineNumberScope.searchActualProductCount=a;n.shopByLineNumberScope.areResultsSuggestions=u[0]?!t.Data.HasExactMatchBeenFound:!0;n.shopByLineNumberScope.searchResultsPages=u;n.shopByLineNumberScope.currentPage=u[0];n.shopByLineNumberScope.currentPageLines=u[0]?u[0].lines:[];n.shopByLineNumberScope.currentPageNumber=1;n.shopByLineNumberScope.movePreviousPageActive=!1;n.shopByLineNumberScope.moveNextPageActive=u.length>1;n.shopByLineNumberScope.HideLoading();$("#search-results-dialog").hasClass("Shown")||(y={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:null},n.shopByLineNumberScope.displaySearchResultsDialog(y))}},i.$inject=["$rootScope","$scope","$timeout","shopByLineNumberService","bagService","trackingService"],i}(n.BaseShopByLineNumberController);n.ShopByLineNumberController=t}(ShopByLineNumberModule||(ShopByLineNumberModule={}));app.controller("ShopByLineNumberController",ShopByLineNumberModule.ShopByLineNumberController)