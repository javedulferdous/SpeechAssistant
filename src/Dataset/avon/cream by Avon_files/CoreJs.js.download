var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},AddressModule,BannerModule,BreadcrumbsModule,ChangePasswordModule,ContentModule,CouponsModule,FindARepModule,FooterModule,ForgotPasswordModule,GenericTabModule,GlossaryModule,OnlineStoreModule,ProfileInfoModel,HeaderRepPanelModule,LayoutLeftNavigationModule,LayoutTopNavigationModule,LayoutTopUtilityModule,LoginModule,LooksWeLoveModule,LpmContextMenuModule,PageNavigatorModule,PayPalModule,ProductCarouselModule,ProductDetailModule,RegistrationModule,SearchModule,TipsModule;(function(n){"use strict";var t=function(t){function i(i,r,u,f,e,o,s,h,c,l){function y(){var t=[];return $.each(n.addressesScope.Session.Cart.Campaigns,function(i){$.each(n.addressesScope.Session.Cart.Campaigns[i].Items,function(r){n.addressesScope.Session.Cart.Campaigns[i].Items[r].AutoReplenishmentFrequency>0&&t.push(n.addressesScope.Session.Cart.Campaigns[i].Items[r])})}),t}function a(){return n.addressesScope.AutoReplenishmentExistsInCart=!1,$.each(n.addressesScope.Session.Cart.Campaigns,function(t){$.each(n.addressesScope.Session.Cart.Campaigns[t].Items,function(i){n.addressesScope.Session.Cart.Campaigns[t].Items[i].AutoReplenishmentFrequency>0&&(n.addressesScope.AutoReplenishmentExistsInCart=!0)})}),n.addressesScope.AutoReplenishmentExistsInCart}function v(t,i){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.CustomerService.SaveMyAddresses([t],i,!1,!1)}function p(){var t=[n.addressesScope.billingAddress];(n.addressesScope.SaveBillingAndShipping||n.addressesScope.shippingAddress.Address1)&&t.push(n.addressesScope.shippingAddress);n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.CustomerService.SaveMyAddresses(t,n.addressesScope.UpdateAvonAccountBilling,!1,!1)}function w(t){if(t.SuggestedAddresses.length==0){n.addressesScope.billingAddress.Address1?new p:new v(n.addressesScope.shippingAddress,n.addressesScope.UpdateAvonAccountShipping);return}n.addressesScope.ShowLoading(AVON.messages.spinner_processing);l.DisplayModal(t)}function b(n){return n?n.match(/^(?=.*[0-9])([a-zA-Z0-9]{7,16})$/)!=null:!1}function k(t,i,r){n.addressesScope.ShowLoadingModal=t?!1:!0;n.addressesScope.IsNotCheckout=i?!1:!0;n.addressesScope.IsFirstTime=r?!0:!1;g();n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid;n.addressesScope.ShippingSameAsBilling||(n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid&&n.addressesScope.billingAddressForm.$valid);it();n.addressesScope.ShippingSameAsBilling||tt();n.addressesScope.SaveBillingAndShipping=!0;(c.HasActiveSubscriptions()||a())&&$.each(AVON.RestrictedDevlieryStates,function(t,i){if(n.addressesScope.shippingAddress.State===i){n.addressesScope.ShowRestrictedStateModal=!0;n.addressesScope.SaveBillingAndShipping=!1;n.addressesScope.ModalOpened="IneligibleAutoReplenishment";$(".IneligibleAutoReplenishment.billingAddress").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null});n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0}})}function d(){n.addressesScope.ShowValidation=!0;n.addressesScope.RequiredInvalid=!0;n.addressesScope.SafeApply();r.$broadcast("AddressesScope.AddressValidation")}function g(){for(var i=!1,r=!1,t=0;t<n.addressesScope.ShippingStates.length;t++)if(n.addressesScope.ShippingStates[t].Code==n.addressesScope.shippingAddress.State){r=!0;break}for(r||(n.addressesScope.shippingAddress.State="",n.addressesScope.ValidForm=!1),t=0;t<n.addressesScope.BillingStates.length;t++)if(n.addressesScope.BillingStates[t].Code==n.addressesScope.billingAddress.State){i=!0;break}i||(n.addressesScope.billingAddress.State="",n.addressesScope.ValidForm=!1)}function nt(t){t===void 0&&(t=!1);h(function(){n.addressesScope.ShowLoading(n.addressesScope.ShowLoadingModal?AVON.messages.spinner_registering:AVON.messages.spinner_saving)},250).then(function(){n.addressesScope.CustomerService.SaveMyAddresses([n.addressesScope.billingAddress,n.addressesScope.shippingAddress],t||!n.addressesScope.ShowLoadingModal,n.addressesScope.IsNotCheckout,n.addressesScope.IsFirstTime)})}function tt(){n.addressesScope.IsBillingInternationalAddress()||(n.addressesScope.billingAddress.Zip.Code&&(n.addressesScope.billingAddress.Zip.Code.length<5||n.addressesScope.billingAddress.Zip.Code.length>5&&n.addressesScope.billingAddress.Zip.Code.length<9)||n.addressesScope.billingAddressForm.Zip.$error.pattern&&n.addressesScope.billingAddressForm.Zip.$invalid)&&(n.addressesScope.billingAddressForm.Zip.$invalid=!0,n.addressesScope.billingAddressForm.Zip.$error.pattern=!0,n.addressesScope.ValidForm=!1)}function it(){(n.addressesScope.shippingAddress.Zip.Code&&(n.addressesScope.shippingAddress.Zip.Code.length<5||n.addressesScope.shippingAddress.Zip.Code.length>5&&n.addressesScope.shippingAddress.Zip.Code.length<9)||n.addressesScope.shippingAddressForm.Zip.$error.pattern&&n.addressesScope.shippingAddressForm.Zip.$invalid)&&(n.addressesScope.shippingAddressForm.Zip.$invalid=!0,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!0,n.addressesScope.ValidForm=!1)}function rt(){var t=n.addressesScope.billingAddress.PhoneNumber;t.Area&&t.Area.length===3?(n.addressesScope.billingAddressForm.Area.$invalid=!1,n.addressesScope.billingAddressForm.Area.$error.format=!1):(n.addressesScope.billingAddressForm.Area.$invalid=!0,n.addressesScope.billingAddressForm.Area.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1);t.Prefix&&t.Prefix.length===3?(n.addressesScope.billingAddressForm.Prefix.$invalid=!1,n.addressesScope.billingAddressForm.Prefix.$error.format=!1):(n.addressesScope.billingAddressForm.Prefix.$invalid=!0,n.addressesScope.billingAddressForm.Prefix.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1);t.Number&&t.Number.length===4?(n.addressesScope.billingAddressForm.Number.$invalid=!1,n.addressesScope.billingAddressForm.Number.$error.format=!1):(n.addressesScope.billingAddressForm.Number.$invalid=!0,n.addressesScope.billingAddressForm.Number.$error.format=!0,n.addressesScope.ValidForm=!1,n.addressesScope.billingAddressForm.$valid=!1)}t.call(this,i);this.$scope=i;this.autoReplenishService=c;this.isInternationalAddressEnabled=!1;n.addressesScope=i;n.addressesScope.CustomerService=u;n.addressesScope.RegistrationService=o;n.addressesScope.billingAddress=AVON.billingAddress;n.addressesScope.shippingAddress=AVON.shippingAddress;n.addressesScope.BillingStates=AVON.BillingStates;n.addressesScope.ShippingStates=AVON.ShippingStates;n.addressesScope.Countries=AVON.Countries;n.addressesScope.ShippingSameAsBilling=!0;n.addressesScope.ShowZipErrorMessage=!1;n.addressesScope.UpdateAvonAccountBilling=!1;n.addressesScope.UpdateAvonAccountShipping=!1;n.addressesScope.ShippingSameAsBillingPaymentForm=!1;n.addressesScope.ShowRestrictedStateModal=!1;n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.ActiveAutoReplenishment=!1;n.addressesScope.SaveBillingAndShipping=!1;n.addressesScope.ReloadPageAfterAction=!1;n.addressesScope.ModalOpened="";n.addressesScope.RegistrationFullPageForm=angular.element("#checkoutStep1").val()=="true";n.addressesScope.PaymentPage=angular.element("#paymentPage").val()=="true";n.addressesScope.OrderingInfoPage=angular.element("#orderingInfoPage").val()=="true";n.addressesScope.RestrictedAutoRepType=RestrictedAutoRepType.None;n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!1;n.addressesScope.ShowBillingCityState=AVON.isOdsDown;n.addressesScope.ShowShippingCityState=AVON.isOdsDown;n.addressesScope.ShowBillingPhoneNumber=!1;n.addressesScope.ShowShippingPhoneNumber=!1;n.addressesScope.DisplayBillingAddressEmailError=!1;n.addressesScope.EmailError=!1;n.addressesScope.HideEmailInput=!1;n.addressesScope.RequireFullAccount=AVON.RequireFullAccount;n.addressesScope.NotifySpecialOffers=!0;n.addressesScope.ShowZipValidation=!1;n.addressesScope.AccountAlreadyExists=!1;n.addressesScope.ContinueAsGuest=!1;n.addressesScope.GuestShopperWithRepId=!1;n.addressesScope.DisplayPrivacyPolicy=!0;n.addressesScope.DisplayPasswordInstructions=!0;n.addressesScope.SessionService.WhenReady().then(function(){n.addressesScope.RegisteredCustomerAsGuest={CustomerId:0,Rep:n.addressesScope.Session.Rep?n.addressesScope.Session.Rep:{Hash:0,Id:0,Address:"",CityStateZip:"",CityState:"",HomepageUrl:"",Name:"",FirstName:"",LastName:"",Phone:"",AlternativePhone:"",WebUrl:"",Status:"",IsInPilot:!1,IsGemini:!1},CustomerType:undefined,CustomerTypeOnRecord:undefined,RepIdOnRecord:undefined,SaveInSession:undefined};n.addressesScope.Session.Rep.Id>0&&n.addressesScope.billingAddress.IsGuestShopper&&(AvonModule.AvonScope.Session.Customer.IsEligibleForGuestCheckout=!1,n.addressesScope.RequireFullAccount=!0,n.addressesScope.RepAttachedFullRegistrationRequired=!0,n.addressesScope.billingAddress.IsGuestShopper=!1,n.addressesScope.shippingAddress.IsGuestShopper=!1)});n.addressesScope.IsBillingUsaAddress=function(){return n.addressesScope.billingAddress.Country==="US"};n.addressesScope.IsBillingInternationalAddress=function(){return n.addressesScope.IsBillingUsaAddress()===!1};n.addressesScope.UseInternationalAddress=function(){n.addressesScope.billingAddress.Country=""};n.addressesScope.ShowCity=function(t){return t===!1?n.addressesScope.ShowShippingCityState:n.addressesScope.IsBillingInternationalAddress()?!0:n.addressesScope.ShowBillingCityState};n.addressesScope.DetermineIfInputShouldBeShownForUsaAddress=function(t){return t?!0:n.addressesScope.IsBillingUsaAddress()};n.addressesScope.DetermineIfInputShouldBeShownForInternationalAddress=function(t){return t?!1:n.addressesScope.IsBillingInternationalAddress()};n.addressesScope.privacyUrl=$("#privacyPolicyUrl").val();n.addressesScope.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();n.addressesScope.OrderInfoSaveBilling&&(n.addressesScope.UpdateAvonAccountBilling=n.addressesScope.OrderInfoSaveBilling);n.addressesScope.OrderInfoSaveShipping&&(n.addressesScope.UpdateAvonAccountShipping=n.addressesScope.OrderInfoSaveShipping);_.defer(function(){n.addressesScope.billingAddressForm.billingAddress_FirstName.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_FirstName.$viewValue);n.addressesScope.billingAddressForm.billingAddress_LastName.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_LastName.$viewValue);n.addressesScope.billingAddressForm.billingAddress_Address1.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_Address1.$viewValue);n.addressesScope.billingAddressForm.billingAddress_Address2.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_Address2.$viewValue);n.addressesScope.billingAddressForm.billingAddress_City.$setViewValue(n.addressesScope.billingAddressForm.billingAddress_City.$viewValue);n.addressesScope.IsBillingUsaAddress()&&n.addressesScope.billingAddressForm.Zip.$setViewValue(n.addressesScope.billingAddressForm.Zip.$viewValue);n.addressesScope.billingAddressForm.Area.$setViewValue(n.addressesScope.billingAddressForm.Area.$viewValue);n.addressesScope.billingAddressForm.Prefix.$setViewValue(n.addressesScope.billingAddressForm.Prefix.$viewValue);n.addressesScope.billingAddressForm.Number.$setViewValue(n.addressesScope.billingAddressForm.Number.$viewValue);n.addressesScope.billingAddress.City&&n.addressesScope.billingAddress.State&&(n.addressesScope.ShowBillingCityState=!0);n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_LastName.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_LastName.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_Address1.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_Address1.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_Address2.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_Address2.$viewValue);n.addressesScope.shippingAddressForm.shippingAddress_City.$setViewValue(n.addressesScope.shippingAddressForm.shippingAddress_City.$viewValue);n.addressesScope.shippingAddressForm.Zip.$setViewValue(n.addressesScope.shippingAddressForm.Zip.$viewValue);n.addressesScope.shippingAddress.City&&n.addressesScope.shippingAddress.State&&(n.addressesScope.ShowShippingCityState=!0);var t=n.addressesScope.billingAddress.PhoneNumber.Area||"",i=n.addressesScope.billingAddress.PhoneNumber.Prefix||"",r=n.addressesScope.billingAddress.PhoneNumber.Number||"";n.addressesScope.billingAddress.PhoneNumber.FullNumber=t+i+r},200);AvonModule.AvonScope.QueryString().invalidDetails==="1"&&(n.addressesScope.HideEmailInput=!0,(n.addressesScope.billingAddress.Address1||n.addressesScope.shippingAddress.Address1)&&_.defer(function(){n.addressesScope.ShippingSameAsBilling=!1;g();n.addressesScope.billingAddress.State==""||n.addressesScope.shippingAddress.State==""?(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalid=!0,n.addressesScope.SafeApply()):n.addressesScope.SaveBillingAndShippingAddresses(!0)},500));n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress);n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress);n.addressesScope.updatePhoneNumber=function(){var t=n.addressesScope.billingAddress.PhoneNumber.FullNumber;t&&t.length>0?(n.addressesScope.billingAddress.PhoneNumber.Area=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(0,3),n.addressesScope.billingAddress.PhoneNumber.Prefix=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(3,6),n.addressesScope.billingAddress.PhoneNumber.Number=n.addressesScope.billingAddress.PhoneNumber.FullNumber.substring(6,10)):(n.addressesScope.billingAddress.PhoneNumber.Area="",n.addressesScope.billingAddress.PhoneNumber.Prefix="",n.addressesScope.billingAddress.PhoneNumber.Number="")};n.addressesScope.HasPhoneNumber=function(){var t=n.addressesScope.billingAddress.PhoneNumber;return t?!t.Area||t.Area.length!==3?!1:!t.Prefix||t.Prefix.length!==3?!1:!t.Number||t.Number.length!==4?!1:!0:!1};n.addressesScope.AllAutoRepSubscriptionsAreHazardous=function(){var t=c.AreAllSubscriptionsHazardous(),n=y(),i;return!t&&n.length===0?!1:(i=_.filter(n,function(n){return n.IsHazardous}),t&&n.length===i.length)};n.addressesScope.SomeAutoRepSubscriptionsAreHazardous=function(){var n=c.HasActiveHazardousSubscriptions(),t=y(),i=_.filter(t,function(n){return n.IsHazardous});return n||i.length>0};n.addressesScope.ZipIsValid=function(n){return n!==null&&n.length===5};n.addressesScope.ValidateRestrictedDeliveryState=function(t,i,r){if(n.addressesScope.ShowRestrictedStateModal=!1,n.addressesScope.ShowRestrictedStateInline=!1,n.addressesScope.ActiveAutoReplenishment=!1,n.addressesScope.ModalOpened="",n.addressesScope.SessionService.WhenReady().then(function(){if((i||n.addressesScope.UpdateAvonAccountShipping)&&(n.addressesScope.ActiveAutoReplenishment=c.HasActiveSubscriptions()),n.addressesScope.ActiveAutoReplenishment||(n.addressesScope.ActiveAutoReplenishment=a()||c.HasActiveSubscriptions()),n.addressesScope.ActiveAutoReplenishment&&(i||n.addressesScope.UpdateAvonAccountShipping)){var u=_.uniq(_.union(AVON.RestrictedDevlieryStates,AVON.SemiRestrictedDevlieryStates));$.each(u,function(i,u){if(n.addressesScope.shippingAddress.State===u)if(n.addressesScope.ShowRestrictedStateModal=!0,n.addressesScope.ModalOpened="IneligibleAutoReplenishment",n.addressesScope.RestrictedAutoRepType=_.contains(AVON.SemiRestrictedDevlieryStates,u)?n.addressesScope.SomeAutoRepSubscriptionsAreHazardous()?n.addressesScope.AllAutoRepSubscriptionsAreHazardous()?RestrictedAutoRepType.AlaskaHawaiiAllHazmat:RestrictedAutoRepType.AlaskaHawaiiSomeHazmat:RestrictedAutoRepType.AlaskaHawaiiNoHazmat:RestrictedAutoRepType.IslandState,t){var f={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null};r?$(".IneligibleAutoReplenishment.billingAddress").trigger("modal",f):$(".IneligibleAutoReplenishment.shippingAddress").trigger("modal",f);n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0}else n.addressesScope.ShowRestrictedStateInline=!0,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)})}}),!n.addressesScope.ShowRestrictedStateModal){if(r){var u=AddressHelper.MapMyAddressIntoAddress(n.addressesScope.billingAddress);n.addressesScope.ShowLoading(AVON.messages.spinner_processing);l.UpsVerification(u).then(function(n){n.data&&new w(n.data.Data)})}else n.addressesScope.SaveShippingAddress();n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)}};n.addressesScope.InAlaskaHawaiiWithAutoRepInCart=function(){return a()&&_.contains(AVON.SemiRestrictedDevlieryStates,n.addressesScope.shippingAddress.State)};n.addressesScope.ShowIneligibleAutoRepModal=function(){n.addressesScope.DisplayShippingAddress=!0;n.addressesScope.RestrictedAutoRepType=_.contains(AVON.SemiRestrictedDevlieryStates,n.addressesScope.shippingAddress.State)?n.addressesScope.SomeAutoRepSubscriptionsAreHazardous()?n.addressesScope.AllAutoRepSubscriptionsAreHazardous()?RestrictedAutoRepType.AlaskaHawaiiAllHazmat:RestrictedAutoRepType.AlaskaHawaiiSomeHazmat:RestrictedAutoRepType.AlaskaHawaiiNoHazmat:RestrictedAutoRepType.IslandState;n.addressesScope.ModalOpened="InAlaskaHawaiiWithAutoRepInCartModal";$(".InAlaskaHawaiiWithAutoRepInCartModal").trigger("modal",{UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:null});n.addressesScope.AlaskaHawaiiAutoRepWarningShown=!0};n.addressesScope.$on("ModalClosed",function(){n.addressesScope.ModalOpened==="IneligibleAutoReplenishment"&&(n.addressesScope.ShowRestrictedStateInline=!1,n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline),n.addressesScope.shippingAddress.State=n.addressesScope.originalShippingAddress.State)});n.addressesScope.UpdateAutoReplenishmentSubscriptions=function(t){n.addressesScope.ModalOpened="";var i=[];$.each(n.addressesScope.Session.Cart.Campaigns,function(r){$.each(n.addressesScope.Session.Cart.Campaigns[r].Items,function(u){if(n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentFrequency>0&&(!t||n.addressesScope.Session.Cart.Campaigns[r].Items[u].IsHazardous)){var f={CampaignNumber:n.addressesScope.Session.Cart.Campaigns[r].Number,Sku:n.addressesScope.Session.Cart.Campaigns[r].Items[u].Sku,Quantity:0,AutoReplenishmentFrequency:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentFrequency,AutoReplenishmentMultibuy:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentMultibuy,AutoReplenishmentOverrideToBeOneTimeOnly:n.addressesScope.Session.Cart.Campaigns[r].Items[u].AutoReplenishmentOverrideToBeOneTimeOnly};i.push(f)}})});n.addressesScope.DeactivateAutoReplenishmentSubscriptions(t);n.addressesScope.ShowLoading(AVON.messages.spinner_loading);i.length>0&&e.update(i)};n.addressesScope.DeactivateAutoReplenishmentSubscriptions=function(t){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);t?n.addressesScope.CustomerService.DiscontinueHazmatAutoReplenishmentProducts():n.addressesScope.CustomerService.DiscontinueAllAutoReplenishmentProducts();n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline)};n.addressesScope.$on("MyAccountService.DiscontinueAllAutoReplenishmentProducts",function(){n.addressesScope.SaveDetails()});n.addressesScope.$on("MyAccountService.DiscontinueHazmatAutoReplenishmentProducts",function(){n.addressesScope.SaveDetails()});n.addressesScope.SaveDetails=function(){n.addressesScope.ShowLoading(AVON.messages.spinner_saving);n.addressesScope.SaveBillingAndShipping?(n.addressesScope.ShowLoadingModal=!0,n.addressesScope.IsNotCheckout=!1,n.addressesScope.IsFirstTime=!1,nt(n.addressesScope.Session.Customer.IsLoggedIn)):n.addressesScope.SaveShippingAddress()};n.addressesScope.CloseIneligibleForm=function(){n.addressesScope.ShowRestrictedStateInline=!1;n.addressesScope.CustomerService.ShowRestrictedStateInline(n.addressesScope.ShowRestrictedStateInline);n.addressesScope.shippingAddress.State=n.addressesScope.originalShippingAddress.State;n.addressesScope.billingAddress.State=n.addressesScope.originalBillingAddress.State;n.addressesScope.ShippingSameAsBillingPaymentForm=!1};n.addressesScope.ToggleShowRestrictedStateInline=function(){if(n.addressesScope.ShippingSameAsBillingPaymentForm&&n.addressesScope.ShowRestrictedStateInline){var t=n.addressesScope.billingAddress.State;n.addressesScope.CloseIneligibleForm();n.addressesScope.billingAddress.State=t}};n.addressesScope.SaveBillingAddress=function(){rt();n.addressesScope.ValidForm=n.addressesScope.billingAddressForm.$valid;tt();n.addressesScope.ValidForm?n.addressesScope.ShippingSameAsBillingPaymentForm?(n.addressesScope.SaveBillingAndShipping=n.addressesScope.ShippingSameAsBillingPaymentForm,n.addressesScope.shippingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.shippingAddress.Type=1,n.addressesScope.ValidateRestrictedDeliveryState(n.addressesScope.IsMyAccountPage(),!0,!0)):new v(n.addressesScope.billingAddress,n.addressesScope.UpdateAvonAccountBilling):(n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalidBilling=!0)};n.addressesScope.SaveShippingAddress=function(){if(n.addressesScope.ValidForm=n.addressesScope.shippingAddressForm.$valid,it(),n.addressesScope.ValidForm){var t=AddressHelper.MapMyAddressIntoAddress(n.addressesScope.shippingAddress);n.addressesScope.ShowLoading(AVON.messages.spinner_registering);l.UpsVerification(t).then(function(n){n.data&&new w(n.data.Data)})}else n.addressesScope.ShowValidation=!0,n.addressesScope.RequiredInvalidShipping=!0};n.addressesScope.$on("AddressVerification.UpdateAccountWithSelectedUpsAddress",function(t,i){if(n.addressesScope.shippingAddress.Address1=i.Address1,n.addressesScope.shippingAddress.Address2=i.Address2,n.addressesScope.shippingAddress.City=i.City,n.addressesScope.shippingAddress.State=i.State,n.addressesScope.shippingAddress.Zip=AddressHelper.MapZipStringToZipObject(i.Zip),n.addressesScope.shippingAddress.Country=i.Country,n.addressesScope.ShippingSameAsBillingPaymentForm){n.addressesScope.billingAddress.Address1=i.Address1;n.addressesScope.billingAddress.Address2=i.Address2;n.addressesScope.billingAddress.City=i.City;n.addressesScope.billingAddress.State=i.State;n.addressesScope.billingAddress.Zip=AddressHelper.MapZipStringToZipObject(i.Zip);n.addressesScope.billingAddress.Country=i.Country;new p;return}new v(n.addressesScope.shippingAddress,n.addressesScope.UpdateAvonAccountShipping)});n.addressesScope.SaveBillingAndShippingAddresses=function(t,i,r){if(k(t,i,r),n.addressesScope.ValidForm){if(n.addressesScope.ShippingSameAsBilling){var u=n.addressesScope.billingAddress.PhoneNumber;n.addressesScope.billingAddress=angular.copy(n.addressesScope.shippingAddress);n.addressesScope.billingAddress.Type=0;n.addressesScope.billingAddress.PhoneNumber=u}n.addressesScope.SaveBillingAndShipping&&nt(n.addressesScope.Session.Customer.IsLoggedIn)}else d()};n.addressesScope.CheckIfEmailExists=function(){n.addressesScope.AccountAlreadyExists=!1;var t=$("#shippingAddress_Email");return n.addressesScope.IsEmailValid(t.val())?(t.addClass("LoadingImage"),n.addressesScope.RegistrationService.getCustomerByEmail(t.val(),!1)):null};n.addressesScope.LoadSignInModal=function(){_.defer(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_loading)},250);var t=n.addressesScope.HomePageUrl+"signin?returnurl=/checkout&email="+n.addressesScope.shippingAddress.Email;n.addressesScope.RedirectToUrl(t)};n.addressesScope.RegisteredUserContinueAsGuest=function(t){n.addressesScope.IsRegisteredGuestShopper=!0;var i=n.addressesScope.shippingAddress.Email;$("#WelcomeBack").trigger("close");n.addressesScope.ContinueAsGuest=!0;n.addressesScope.DisplayPrivacyPolicy=!1;n.addressesScope.GuestShopperWithRepId=!0;n.addressesScope.RequireFullAccount=!1;n.addressesScope.UpdateCustomerType(CustomerType.RegisteredCustomerAsGuest);t&&n.addressesScope.RegistrationService.getCustomerByEmail(i,t)};n.addressesScope.ResetContinueAsGuest=function(){n.addressesScope.ContinueAsGuest=!1};n.addressesScope.Session.Customer.CustomerType===CustomerType.RegisteredCustomerAsGuest&&n.addressesScope.QueryString().guestShopper&&n.addressesScope.RegisteredUserContinueAsGuest(!1);n.addressesScope.ValidateCustomerForm=function(){var t,i;return n.addressesScope.EmailError=!1,n.addressesScope.ShowPasswordValidation=!1,n.addressesScope.PasswordsDontMatch=!1,n.addressesScope.DisplayPasswordInstructions=!1,n.addressesScope.ValidationErrorStyle=!1,t=!1,n.addressesScope.ValidForm=!0,i=n.addressesScope.IsEmailValid(n.addressesScope.shippingAddress.Email),i||(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid=!0,n.addressesScope.EmailError=!0),n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_LastName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid===!1&&(n.addressesScope.ValidForm=!0),n.addressesScope.shippingAddressForm.Number.$invalid=!1,n.addressesScope.shippingAddressForm.Number.$error.format=!1,n.addressesScope.CreateAccount()&&(b(n.addressesScope.shippingAddress.Password)||(n.addressesScope.ValidForm=!1,t=!0,n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid=!0,n.addressesScope.ValidationErrorStyle=!0),b(n.addressesScope.shippingAddress.PasswordConfirm)||(n.addressesScope.ValidForm=!1,t=!0,n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid=!0,n.addressesScope.DisplayPasswordInstructions=!0,n.addressesScope.ValidationErrorStyle=!0),t===!1&&n.addressesScope.shippingAddress.Password!==n.addressesScope.shippingAddress.PasswordConfirm&&(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid=!0,n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid=!0,n.addressesScope.PasswordsDontMatch=!0,n.addressesScope.ValidationErrorStyle=!0,n.addressesScope.ValidationErrorStyle=!0),n.addressesScope.shippingAddress.PasswordHint||(n.addressesScope.ValidForm=!1,n.addressesScope.shippingAddressForm.shippingAddress_PasswordHint.$invalid=!0),n.addressesScope.shippingAddressForm.shippingAddress_FirstName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_LastName.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Email.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_Password.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_PasswordConfirm.$invalid===!1&&n.addressesScope.shippingAddressForm.shippingAddress_PasswordHint.$invalid===!1&&n.addressesScope.HasPhoneNumber()&&(n.addressesScope.ValidForm=!0)),n.addressesScope.PrivacyPolicyInput===!1&&(n.addressesScope.ShowAcceptedPrivacyPolicyError=!0,n.addressesScope.ValidForm=!1),n.addressesScope.ValidForm};n.addressesScope.CreateAccount=function(){return(n.addressesScope.CheckElementValue("#shippingAddress_PasswordInput")||n.addressesScope.CheckElementValue("#shippingAddress_PasswordConfirmInput")||n.addressesScope.CheckElementValue("#shippingAddress_PasswordHintInput")||n.addressesScope.RequireFullAccount)&&!n.addressesScope.GuestShopperWithRepId?!0:!1};n.addressesScope.InputFocus=function(){n.addressesScope.DisplayBillingAddressEmailError=!1;n.addressesScope.ValidationErrorStyle=!1;n.addressesScope.DisplayPasswordInstructions=!0;n.addressesScope.ShowValidation=!1;n.addressesScope.ShowAcceptedPrivacyPolicyError=!1;n.addressesScope.EmailAlreadyExists=!1};n.addressesScope.ViewPrivacyPolicy=function(){window.open(n.addressesScope.privacyUrl,"_blank")};n.addressesScope.ViewConditionsOfUse=function(){window.open(n.addressesScope.conditionsOfUseUrl,"_blank")};n.addressesScope.SubmitAddressDetails=function(t){n.addressesScope.RegistrationFullPageForm?r.$broadcast("AddressesScope.SubmitFullRegistrationDetails"):n.addressesScope.PaymentPage?(n.addressesScope.DisplayBillingAddress&&n.addressesScope.SaveBillingAddress(!0),n.addressesScope.DisplayShippingAddress&&n.addressesScope.ValidateRestrictedDeliveryState(!1)):n.addressesScope.OrderingInfoPage&&(t==="Billing"&&n.addressesScope.SaveBillingAddress(!0),t==="Shipping"&&n.addressesScope.ValidateRestrictedDeliveryState(!0,!0))};n.addressesScope.$on("AddressesScope.ValidateAddresses",function(t,i,u){n.addressesScope.ShowLoadingModal=u?!1:!0;k(n.addressesScope.ShowLoadingModal);n.addressesScope.ValidForm||d();i&&n.addressesScope.ValidForm&&r.$broadcast("RegistrationScope.SaveDetails")});n.addressesScope.$on("AddressesScope.SaveAddresses",function(){n.addressesScope.ShowLoadingModal=!0;n.addressesScope.SaveBillingAndShippingAddresses(!1)});n.addressesScope.$on("FormDirective.HidValidation",function(){n.addressesScope.billingAddressForm!=null&&(n.addressesScope.billingAddressForm.ServerErrors=[]);n.addressesScope.shippingAddressForm!=null&&(n.addressesScope.shippingAddressForm.ServerErrors=[]);n.addressesScope.ShowValidation&&(n.addressesScope.ShowValidation=!1)});n.addressesScope.$on("AddressesScope.ZipCodeDetails",function(t,i,u){i.IsValidZip?(n.addressesScope.ShowZipValidation=!1,u?(n.addressesScope.billingAddress.City=i.City,n.addressesScope.billingAddress.State=i.State,n.addressesScope.ShowBillingCityState=!0,n.addressesScope.billingAddressForm.Zip.$invalid=!1,n.addressesScope.billingAddressForm.Zip.$error.pattern=!1,$("input[name=Area]").focus()):(n.addressesScope.shippingAddress.City=i.City,n.addressesScope.shippingAddress.State=i.State,n.addressesScope.ShowShippingCityState=!0,n.addressesScope.shippingAddressForm.Zip.$invalid=!1,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!1),_.defer(function(){n.addressesScope.UpdateInlineWaterMark();n.addressesScope.SafeApply();r.$broadcast("AddressController.UpdateInlineWaterMark")},250)):(n.addressesScope.ShowZipValidation=!0,u?(n.addressesScope.billingAddressForm.Zip.$invalid=!0,n.addressesScope.billingAddressForm.Zip.$error.pattern=!0):(n.addressesScope.shippingAddressForm.Zip.$invalid=!0,n.addressesScope.shippingAddressForm.Zip.$error.pattern=!0),n.addressesScope.SafeApply())});n.addressesScope.HideShippingAddress=function(){$("#EditAddressModal").trigger("close");n.addressesScope.shippingAddress=angular.copy(n.addressesScope.originalShippingAddress);n.addressesScope.ShowValidation=!1;n.addressesScope.RequiredInvalidBilling=!1;n.addressesScope.RequiredInvalidShipping=!1;n.addressesScope.shippingAddressForm.Zip.$invalid=!1;n.addressesScope.shippingAddressForm.Zip.$error.pattern=!1;n.addressesScope.IsBillingUsaAddress()&&(n.addressesScope.billingAddressForm.Zip.$invalid=!1,n.addressesScope.billingAddressForm.Zip.$error.pattern=!1);n.addressesScope.ShowZipValidation=!1;n.addressesScope.SafeApply()};n.addressesScope.GoToMyAccountHome=function(){location.href=n.addressesScope.Url.Action("Index","MyAccount")};n.addressesScope.requiredField=AVON.messages.validate_field_required;n.addressesScope.invalidEmailFormat=AVON.messages.validate_email_invalid;n.addressesScope.emailNotMatch=AVON.messages.validate_email_match;n.addressesScope.passwordInvalidFormat=AVON.messages.validate_password_invalid_format;n.addressesScope.passwordNotMatch=AVON.messages.validate_password_match;n.addressesScope.invalidNumber=AVON.messages.validate_invalid_number;n.addressesScope.invalidPhonenumber=AVON.messages.validate_invalid_phonenumber;n.addressesScope.$on("CustomerService.UpdateAddress",function(t,i){var u,r;i.ErrorCode===AjaxError.ValidationErrors?(n.addressesScope.RegistrationFullPageForm&&h(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_registering)},250).then(function(){n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("BillingandShipping","Checkout"))}),n.addressesScope.ProcessAjaxValidationErrors(i),n.addressesScope.ShowValidation=!0,u=[],$.each(i.ValidationErrors,function(t,i){i.FieldName.indexOf("billingAddress")>-1&&(n.addressesScope.RequiredInvalidBilling=!0);i.FieldName.indexOf("shippingAddress")>-1&&(n.addressesScope.RequiredInvalidShipping=!0);i.FieldName.indexOf("PostalCode")>-1&&(n.addressesScope.billingAddressForm.billingAddress_PostalCode.$error.server=!1,n.addressesScope.billingAddressForm.billingAddress_PostalCode.$error.validatePostalCode=!0)}),n.addressesScope.IsBillingUsaAddress()&&n.addressesScope.billingAddressForm.Zip.$invalid==!1&&(n.addressesScope.ShowZipErrorMessage=!0)):n.addressesScope.RegistrationFullPageForm||window.location.href.indexOf("billingandshipping")>0?(n.addressesScope.QueryString().guest||n.addressesScope.IsRegisteredGuestShopper||(r={Type:TrackingEventType.CartNewCustAcct,Data:{customerId:AvonModule.AvonScope.Session.Customer.CustomerId}},f.TrackEventItem(r)),h(function(){n.addressesScope.ShowLoading(AVON.messages.spinner_registering)},250).then(function(){n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("Index","Checkout"))})):($(".IneligibleAutoReplenishment").trigger("close"),$("#EditAddressModal").trigger("close"),a()||(n.addressesScope.UpdateAvonAccountShipping=!1),n.addressesScope.UpdateAvonAccountBilling=!1,n.addressesScope.OrderInfoSaveBilling&&(n.addressesScope.UpdateAvonAccountBilling=n.addressesScope.OrderInfoSaveBilling),n.addressesScope.OrderInfoSaveShipping&&(n.addressesScope.UpdateAvonAccountShipping=n.addressesScope.OrderInfoSaveShipping),n.addressesScope.ShippingSameAsBillingPaymentForm=!1,n.addressesScope.ShowValidation=!1,n.addressesScope.RequiredInvalidBilling=!1,n.addressesScope.RequiredInvalidShipping=!1,n.addressesScope.originalBillingAddress=angular.copy(n.addressesScope.billingAddress),n.addressesScope.originalShippingAddress=angular.copy(n.addressesScope.shippingAddress),n.addressesScope.SafeApply())});$(document).ready(function(){$(".ErrorSummaryContainer").off("click","#DisplayLoginModal");$(".ErrorSummaryContainer").on("click","#DisplayLoginModal",function(t){t.preventDefault();n.addressesScope.ShowLoading(AVON.messages.spinner_loading);var i=n.addressesScope.HomePageUrl+"signin?email="+n.addressesScope.shippingAddress.Email;n.addressesScope.RedirectToUrl(i)});$(".ErrorSummaryContainer").off("click","#DisplayForgotPassword");$(".ErrorSummaryContainer").on("click","#DisplayForgotPassword",function(t){t.preventDefault();n.addressesScope.ShowLoading(AVON.messages.spinner_loading);n.addressesScope.RedirectToUrl(n.addressesScope.Url.Action("forgotpassword","login")+"?email="+n.addressesScope.shippingAddress.Email)});document.addEventListener("visibilitychange",function(){$(".InputContainer.inlineWaterMark.applyInlineWaterMark")&&$(window).scrollTop($(window).scrollTop()+1)})})}return __extends(i,t),i.$inject=["$scope","$rootScope","customerService","trackingService","bagService","registrationService","$compile","$timeout","autoReplenishService","addressVerificationService"],i}(BaseAngularController);n.AddressesCtrl=t})(AddressModule||(AddressModule={}));app.controller("AddressesController",AddressModule.AddressesCtrl),function(n){"use strict";var t=function(t){function i(i,r,u,f){t.call(this,i,u);n.bannerScope=i;n.bannerScope.ScrollDown=!1;n.bannerScope.ScrollPageTop=!0;n.bannerScope.BannerCollapsed=!1;n.bannerScope.IsTabletDevice=function(){return n.bannerScope.IsTouchDevice()&&!n.bannerScope.IsAndroid};var e=$(".search-location-header"),o=$(".search-location-banner");n.bannerScope.ShoppingCartClick=function(){n.bannerScope.SessionReady&&(n.bannerScope.ShowLoading(AVON.messages.spinner_loading),n.bannerScope.RedirectToUrl(n.bannerScope.Url.Action("Index","Bag")))};n.bannerScope.GoToPage=function(n,t){t===void 0&&(t="_self");n!==undefined&&u.open(n,t)};n.bannerScope.GoToWishListPage=function(n){if(n.preventDefault(),i.Session.Customer&&i.Session.Customer.IsLoggedIn)u.location.href=i.Url.Action("index","wishlist");else{var t=i.Url.Action("index","wishlist");f.ShowLoginModal("wishlist",t)}};n.bannerScope.IsMobileOrTablet||angular.element(u).bind("scroll",function(){var t=30;n.bannerScope.BannerCollapsed&&this.pageYOffset<t?(n.bannerScope.BannerCollapsed=!1,r.$broadcast("BannerController.BannerExpand"),n.bannerScope.SafeApply()):!n.bannerScope.BannerCollapsed&&this.pageYOffset>=t&&(n.bannerScope.BannerCollapsed=!0,r.$broadcast("BannerController.BannerCollapse"),n.bannerScope.SafeApply())})}return __extends(i,t),i.$inject=["$scope","$rootScope","$window","loginModalService"],i}(BaseAngularController);n.BannerController=t}(BannerModule||(BannerModule={}));app.controller("BannerController",BannerModule.BannerController),function(n){"use strict";var t=function(t){function i(i){var u,r;if(t.call(this,i),n.breadcrumbsScope=i,n.breadcrumbsScope.Breadcrumbs=[{Url:" / ",Text:"Home",CrumbType:1,HasUrl:!0}],n.breadcrumbsScope.HideCategoryBreadcrumbsBeforeBrands=function(){n.breadcrumbsScope.HiddenBreadcrumbs=0;for(var t=0;t<n.breadcrumbsScope.Breadcrumbs.length-1;t++)n.breadcrumbsScope.Breadcrumbs[t].CrumbType==2&&n.breadcrumbsScope.Breadcrumbs[t+1].CrumbType==6&&(n.breadcrumbsScope.HiddenBreadcrumbs+=1)},n.breadcrumbsScope.VerifyProductAlternatives=function(){var t,i;if(AVON.AltBreadcrumbs){if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text=="Search"&&AVON.LanguageCode=="es"){n.breadcrumbsScope.Breadcrumbs[0].Text="Inicio";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Búsqueda";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text=="Búsqueda"&&AVON.LanguageCode=="en"){n.breadcrumbsScope.Breadcrumbs[0].Text="Home";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Search";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].CrumbType==5)return;if(n.breadcrumbsScope.Breadcrumbs.length>4&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="order details"&&AVON.LanguageCode=="es"){n.breadcrumbsScope.Breadcrumbs[0].Text="Inicio";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-4].Text="Mi Cuenta";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-3].Text="Historial De Pedidos";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Detalles Del Pedido";return}if(n.breadcrumbsScope.Breadcrumbs.length>4&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="detalles del pedido"&&AVON.LanguageCode=="en"){n.breadcrumbsScope.Breadcrumbs[0].Text="Home";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-4].Text="My Account";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-3].Text="Order History";n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text="Order Details";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="order details"||n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Text.toLowerCase()=="detalles del pedido")return;if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[1].Text=="Sale"&&AVON.LanguageCode=="es"){n.breadcrumbsScope.Breadcrumbs[0].Text="Inicio";n.breadcrumbsScope.Breadcrumbs[1].Text="Promociones";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&n.breadcrumbsScope.Breadcrumbs[1].Text=="Promociones"&&AVON.LanguageCode=="en"){n.breadcrumbsScope.Breadcrumbs[0].Text="Home";n.breadcrumbsScope.Breadcrumbs[1].Text="Sale";return}if(n.breadcrumbsScope.Breadcrumbs.length>2&&(n.breadcrumbsScope.Breadcrumbs[1].Text=="Sale"||n.breadcrumbsScope.Breadcrumbs[1].Text=="Promociones"))return;if(t=-1,n.breadcrumbsScope.Breadcrumbs.length>1)for(i=0;i<AVON.AltBreadcrumbs.length&&t<0;i++)n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-2].Url.replace(/^\/es\//,"/")==AVON.AltBreadcrumbs[i][AVON.AltBreadcrumbs[i].length-2].Url.replace(/^\/es\//,"/")&&(t=i);t<0&&(t=0);n.breadcrumbsScope.Breadcrumbs=AVON.AltBreadcrumbs[t]}},u=n.breadcrumbsScope.GetValueFromSessionStorage("AvonBreadcrumbs"),u)for(n.breadcrumbsScope.Breadcrumbs=u,n.breadcrumbsScope.ArrivedFromProduct=n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-1].CrumbType==7;!n.breadcrumbsScope.Breadcrumbs[n.breadcrumbsScope.Breadcrumbs.length-1].HasUrl;)n.breadcrumbsScope.Breadcrumbs.pop();if(AVON.setBreadcrumbs&&AVON.breadcrumbs&&AVON.breadcrumbs.length>0)n.breadcrumbsScope.Breadcrumbs=AVON.breadcrumbs;else for(r=1;r<AVON.breadcrumbs.length;r++)n.breadcrumbsScope.Breadcrumbs.push(AVON.breadcrumbs[r]);n.breadcrumbsScope.HideCategoryBreadcrumbsBeforeBrands();n.breadcrumbsScope.VerifyProductAlternatives();n.breadcrumbsScope.Breadcrumbs&&n.breadcrumbsScope.SetValueIntoSessionStorage("AvonBreadcrumbs",n.breadcrumbsScope.Breadcrumbs);n.breadcrumbsScope.Breadcrumbs&&n.breadcrumbsScope.Breadcrumbs.length-n.breadcrumbsScope.HiddenBreadcrumbs>2&&$("#MainContainer").addClass("ShowBreadcrumb");n.breadcrumbsScope.UpdateBreadcrumbs=function(t,i,r){for(var f,u=n.breadcrumbsScope.Breadcrumbs.length;u>t;u--)n.breadcrumbsScope.Breadcrumbs.pop();if(f=3,n.breadcrumbsScope.HiddenBreadcrumbs>0&&t==3&&(f=6),n.breadcrumbsScope.Breadcrumbs&&n.breadcrumbsScope.Breadcrumbs.length>0)while(t>n.breadcrumbsScope.Breadcrumbs.length+1)--t;n.breadcrumbsScope.Breadcrumbs[t-1]={Text:i,Url:r,CrumbType:f,HasUrl:r!==""&&r!==undefined};n.breadcrumbsScope.HideCategoryBreadcrumbsBeforeBrands();n.breadcrumbsScope.SetValueIntoSessionStorage("AvonBreadcrumbs",n.breadcrumbsScope.Breadcrumbs);n.breadcrumbsScope.SafeApply()};n.breadcrumbsScope.$on("breadcrumbsScope.UpdateBreadcrumbs",function(t,i,r,u){n.breadcrumbsScope.UpdateBreadcrumbs(i,r,u)})}return __extends(i,t),i.$inject=["$scope"],i}(BaseAngularController);n.BreadcrumbsController=t}(BreadcrumbsModule||(BreadcrumbsModule={}));app.controller("BreadcrumbsController",BreadcrumbsModule.BreadcrumbsController),function(n){"use strict";var t=function(t){function i(i,r){t.call(this,i);n.changePasswordScope=i;n.changePasswordScope.DisplayPasswordInstructions=!0;n.changePasswordScope.changePasswordModel=AVON.ChangePasswordModel;n.changePasswordScope.ChangePassword=function(){n.changePasswordScope.ChangePasswordForm.$valid?(n.changePasswordScope.ShowValidation=!1,n.changePasswordScope.ShowLoading(AVON.messages.spinner_processing),r.changePassword(n.changePasswordScope.changePasswordModel,$("form[name=ChangePasswordForm]"))):(n.changePasswordScope.ChangePasswordForm.changePasswordModel_Password.$invalid&&(n.changePasswordScope.DisplayPasswordInstructions=!1),n.changePasswordScope.ShowValidation=!0)};n.changePasswordScope.InputFocus=function(){n.changePasswordScope.DisplayPasswordInstructions=!0};n.changePasswordScope.$on("LoginService.ChangePasswordResponse",function(t,i){i.ErrorCode===AjaxError.ValidationErrors&&n.changePasswordScope.ProcessAjaxValidationErrors(i);i.ErrorCode===0&&i.Data.Email!==null&&$("#ChangePasswordModal").trigger("close")})}return __extends(i,t),i.$inject=["$scope","loginService","trackingService"],i}(BaseAngularController);n.ChangePasswordCtrl=t}(ChangePasswordModule||(ChangePasswordModule={}));app.controller("ChangePasswordController",ChangePasswordModule.ChangePasswordCtrl),function(n){var t=function(t){function i(i,r,u){function e(n){$(n.currentTarget).hasClass("BannerCarousel")&&(n.preventDefault(),n.stopPropagation())}var f=this;t.call(this,i,u);n.contentScope=i;n.contentScope.ShowContent=AVON.ShowContent;n.contentScope.CategoryPageMainContentLeftMargin=59;n.contentScope.CarouselButtonWidth=27;n.contentScope.ContentWidth=1200;n.contentScope.LeftNavWidth=202;n.contentScope.carouselWidth=100+(n.contentScope.CategoryPageMainContentLeftMargin+n.contentScope.CarouselButtonWidth)/(n.contentScope.ContentWidth-n.contentScope.LeftNavWidth)*100;n.contentScope.$on("productListScope.UpdateMultipleSelectedFacets",function(n,t,i,r,u){AVON.ShowContent=(u.indexOf("All ")!=-1||u.indexOf("Todo ")!=-1)&&AVON.IsDescendantMegaBrand?!1:!0});n.contentScope.ContentWithOverlayDisplay=function(t,i){var u,s,c,l,o;$(".active").removeClass("active");e(t);var r=$(t.currentTarget),f=$(t.target),y=f.is("a"),h=f.prop("href");if((t.type=="click"||t.type=="tap")&&y&&t.preventDefault(),h&&n.contentScope.GoToPage(h),r.children("div.Overlay.active").length>0&&f.parents(".Overlay").length==0){n.contentScope.ContentWithOverlayHide(t);return}if(r.find(".OverlayButton").length>0){if(f.parents(".OverlayButton").length===0&&!f.hasClass("OverlayButton"))return;r.children("div.RotatedCaret45").addClass("active");r.children("div.Overlay").addClass("active");u=r.find(".OverlayButton").last();$(".Overlay.active").attr("style").indexOf("width")<0&&$(".Overlay.active").css({width:u.outerWidth(!0)});s=$("html").hasClass("ie")?u.position().left:u[0].offsetLeft;r.parents(".header-sections-footer-container").length&&(c=u.offset(),l=u.parents(".header-sections-footer-container").offset(),s=c.left-l.left);$(".Overlay.active").css({left:s});$(".RotatedCaret45.active").css({left:s});$(".RotatedCaret45.active").css({"margin-left":u.outerWidth(!0)/2})}else r.children("div.RotatedCaret45").addClass("active"),r.children("div.Overlay").addClass("active"),$(".RotatedCaret45.active").css({"margin-left":$(".Overlay.active").outerWidth(!0)/2-$(".RotatedCaret45.active").width()/2});var a=$("#TopUtilityBarContainer").length?$("#TopUtilityBarContainer").offset().left+$("#TopUtilityBarContainer").innerWidth():0,p=$(".Overlay.active").offset().left+$(".Overlay.active").innerWidth(),v=p-a,w=$("#BannerPageWidth").length?$("#BannerPageWidth").offset().left:0;if(v>0&&!$(".Overlay.active").attr("style")&&$(".Overlay.active").css({"margin-left":-v}),i){switch(i){case"Right":o=a-$(".Overlay.active").innerWidth();break;case"Left":o=$(".Overlay.active").offset().left-w;break;case"Center":o=$(".Overlay.active").offset().left+$("#TaglinesContainer").innerWidth()/2-$(".Overlay.active").innerWidth()/2}$(".Overlay.active").css({left:o});$(".RotatedCaret45.active").css({left:o})}};n.contentScope.ContentWithOverlayHide=function(n){$(".active").removeClass("active");n.stopPropagation()};n.contentScope.ContentWithModalDisplay=function(n){var t=angular.element(n.currentTarget),i=$(t[0]);i.find("div.ContentModal").trigger("modal")};n.contentScope.ContentWithAreaPopupDisplay=function(n,t){$("div.PopupModal."+t).trigger("modal",{AllowExit:!0,Model:null,KeepLoaded:!0,IgnoreBackground:!1})};n.contentScope.ContentWithPopupDisplay=function(t,i,r,u,f){var c=$(t.currentTarget),e=$(t.target),s=e.is("a"),h=e.prop("href"),o;if((t.type=="click"||t.type=="tap")&&s&&t.preventDefault(),h&&s&&n.contentScope.GoToPage(h),!(c.find(".PopupButton").length>0)||e.parents(".PopupButton").length!==0||e.hasClass("PopupButton")){if(r){o={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:r,UseIFrame:!0,IFrameWidth:u+"px",IFrameHeight:f+"px"};$("div.PopupModal."+i).trigger("modal",o);return}o={AllowExit:!0,Model:null,KeepLoaded:!0,IgnoreBackground:!1};$("div.PopupModal."+i).trigger("modal",o)}};n.contentScope.HeroModuleAsideClick=function(n,t){t.length&&i.RedirectToUrl(t,!0)};angular.element(document).ready(function(){var n=$("#MainContainer div.ContentModule");n.length==1&&n.css("margin-bottom","0");$(".ModalContainer .PopupModal").each(function(){var n=$(this).parent();n.appendTo("#Modals")})});n.contentScope.GoToPage=function(n,t){t===void 0&&(t="_self");n!==undefined&&r.open(n,t)};_.defer(function(){f.lazyLoadCuralate()})}return __extends(i,t),i.$inject=["$scope","$window","intersectionObserverService"],i}(n.CommonContentController);n.ContentCtrl=t}(ContentModule||(ContentModule={}));app.controller("ContentController",ContentModule.ContentCtrl),function(n){var t=function(n){function t(t){n.call(this,t);var i=t;i.LoadMore=function(){i.ShowCoupons=!0}}return __extends(t,n),t.$inject=["$scope"],t}(BaseAngularController);n.CouponsController=t}(CouponsModule||(CouponsModule={}));app.controller("CouponsController",CouponsModule.CouponsController),function(n){var t=function(t){function i(i,r,u,f,e,o){var s=this;t.call(this,i,r,u,o,e,f);this.bagService=o;n.findARepScope=i;i.filteredLanguage=-1;i.filteredDistance="";i.productUrl=AVON.TempModalModel!=null?AVON.TempModalModel.productUrl:"";i.distanceFilterOpen=!1;i.languageFilterOpen=!1;i.SessionService.WhenReady().then(function(){s.findARepService.getRepStates()});i.CheckToShowLoadMoreButton=function(n){return i.visibleCount<i.findARepResults.Reps.length&&n&&n.length===i.visibleCount};i.SetFilterByLanguageValue=function(n,t){i.filteredLanguage=n;i.ToggleLanguageFilter(t)};i.SetFilterByDistanceValue=function(n,t){i.filteredDistance=n;i.ToggleDistanceFilter(t)};i.FilterBy=function(n){var t=!0,r;return i.filteredLanguage>=0&&(r=_.find(n.SpokenLanguages,function(n){return n.Language==i.filteredLanguage}),r||(t=!1)),i.filteredDistance.length>0&&n.DistanceLabel!==i.filteredDistance&&(t=!1),t};i.ToggleDistanceFilter=function(n){i.CloseLanguageFilter();$("#ulDistanceFilter").slideToggle("slow");i.distanceFilterOpen=!i.distanceFilterOpen;i.SafeApply();n.stopPropagation()};i.CloseDistanceFilter=function(){i.distanceFilterOpen&&($("#ulDistanceFilter").slideUp("fast"),i.distanceFilterOpen=!1,i.SafeApply())};i.ToggleLanguageFilter=function(n){i.CloseDistanceFilter();$("#ulLanguageFilter").slideToggle("slow");i.languageFilterOpen=!i.languageFilterOpen;i.SafeApply();n.stopPropagation()};i.CloseLanguageFilter=function(){i.languageFilterOpen&&($("#ulLanguageFilter").slideUp("fast"),i.languageFilterOpen=!1,i.SafeApply())};i.ShowDistanceFilter=function(){return i.findARepResults.DistanceLabels&&i.findARepResults.DistanceLabels.length>1};i.CloseFilters=function(){i.CloseDistanceFilter();i.CloseLanguageFilter()};$("body").on({click:function(){i.CloseFilters()}});i.$on("FallbackSrc.ImageFound",function(n,t){var u;if(t.element.hasClass("imgRepPhoto")){var r=t.element.height(),f=t.element.width(),i=t.element.parent();(f!==r||i.width()!==f||i.height()!==r)&&(u=i.parents("li").height(),r+1===u||u===i.height()+1?i.addClass("SideBorderForRepPhoto"):i.addClass("BorderForRepPhoto"))}});i.$on("FindARepService.FindARepResponse",function(n,t){var r,u,e,o;t.ErrorCode===AjaxError.None&&(i.findARepResults=t.Data||{},i.filteredDistance="",i.filteredLanguage=-1,i.findARepResults.Reps||(i.findARepResults.Reps=[]),r=i.findARepResults.Reps.length,i.visibleCount=s.resultPageSize,i.visibleCountModal=i.findARepResults.Reps.length,i.visibleCount>i.findARepResults.Reps.length&&(i.visibleCount=i.findARepResults.Reps.length),i.showResults=!0,i.SafeApply(),i.DisplayResultsInModal&&i.findARepResults.SearchType==="AddressSearch"&&(i.FindARepByAddressModel.State=i.findARepResults.State),i.findARepResults.SearchType==="AddressSearch"&&r>0&&s.InitMap(),u="",u=i.IsFindARepPage()?i.findARepSearchType===FindARepSearchType.ByName?"locate my rep":"recommend my rep":i.findARepSearchType===FindARepSearchType.ByName?"modal name":"modal zip code",e={model:i.findARepSearchType===FindARepSearchType.ByName?i.FindARepByNameModel:i.FindARepByAddressModel,totalReps:r,status:r>0?"success":"fail",searchType:u},o={Type:i.findARepSearchType===FindARepSearchType.ByName?TrackingEventType.FarLocateMyRep:TrackingEventType.FarRecommendaRep,Data:e},f.TrackEventItem(o))});i.InitModal=function(n,t,r,u,f,e){AVON.returnUrl=i.productUrl.length>1?i.productUrl:n;i.DeliveryTypes=["",u,t,r];i.LanguageNames=[f,e];i.findARepSearchType=s.defaultModalDisplay;s.setZipCode()}}return __extends(i,t),i.$inject=["$scope","$rootScope","findARepService","trackingService","cdnService","bagService"],i}(n.BaseFindARepController);n.FindARepController=t}(FindARepModule||(FindARepModule={}));app.controller("FindARepController",FindARepModule.FindARepController),function(n){var t=function(n){function t(t){n.call(this,t);var i=t;i.SwitchView=function(n){n.preventDefault();i.SessionService.SwitchView(!0)};i.IsEarmarkVisible=function(){return angular.element("#earmark-container").length>0}}return __extends(t,n),t.$inject=["$scope"],t}(BaseAngularController);n.FooterController=t}(FooterModule||(FooterModule={}));app.controller("FooterController",FooterModule.FooterController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e){var o,s;t.call(this,i);n.forgotPasswordscope=i;n.forgotPasswordscope.ForgotPasswordModel=AVON.ForgotPasswordModel;o=$("[id=LoginModel_EmailInput]");o.keyup(function(){$("[id=forgotPasswordModel_EmailInput]").val(o.val()).change()});n.forgotPasswordscope.ForgotPasswordSubmit=function(t){t||(t=$("[id=forgotPasswordModel_EmailInput]").val());n.forgotPasswordscope.ShowLoading(AVON.messages.spinner_processing);n.forgotPasswordscope.SubmitButtonClicked=="SendNewPasswordButton"?r.sendNewPassword(t,$("form[name=ForgotPasswordForm]")):(r.sendPasswordHint(t,$("form[name=ForgotPasswordForm]")),n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary!==undefined&&(n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary.$invalid=!1))};s=function(t){n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary!==undefined&&(n.forgotPasswordscope.ForgotPasswordForm.ServerErrors.Summary.$invalid=!1);t.ErrorCode===AjaxError.ValidationErrors?(n.forgotPasswordscope.ProcessAjaxValidationErrors(t),_.defer(function(){var t=$("[id=forgotPasswordModel_EmailInput]").val();AVON.TempModalModel!==undefined?AVON.TempModalModel.Email=t:AVON.TempModalModel={Email:t};f(e.find(".ErrorSummaryContainer .ValidationSummaryServer span a"))(n.forgotPasswordscope)})):_.defer(function(){var i=t.Data.Email;AVON.TempModalModel!==undefined?AVON.TempModalModel.Email=i:AVON.TempModalModel={Email:i};f(e.find("#ForgotPasswordForm #ForgotPasswordMessage a"))(n.forgotPasswordscope)})};n.forgotPasswordscope.SubmitForm=function(t){n.forgotPasswordscope.SubmitButtonClicked=t;n.forgotPasswordscope.ForgotPasswordSubmit($("[id=forgotPasswordModel_EmailInput]").val())};n.forgotPasswordscope.$on("LoginService.SendNewPasswordResponse",function(n,t){s(t);u.TrackEventItem({Type:TrackingEventType.ForgotPassword})});n.forgotPasswordscope.$on("LoginService.SendPasswordHintResponse",function(n,t){s(t);u.TrackEventItem({Type:TrackingEventType.ForgotPassword})})}return __extends(i,t),i.$inject=["$scope","loginService","trackingService","$compile","$element"],i}(BaseAngularController);n.ForgotPasswordCtrl=t}(ForgotPasswordModule||(ForgotPasswordModule={}));app.controller("ForgotPasswordController",ForgotPasswordModule.ForgotPasswordCtrl),function(n){var t=function(n){function t(i,r){n.call(this,i);var u;u=i;$(r).find("ul li").length>0&&(u.activeTabId=$(r).find("ul li")[0].id);u.OnTabClick=function(n,i,r,f,e){u.IsTouchDevice()||t.prototype.ToggleTabActive(u,n,i,r,f,e)};u.OnTabTap=function(n,i,r,f,e){u.IsTouchDevice()&&t.prototype.ToggleTabActive(u,n,i,r,f,e)};u.OnTabMouseEnter=function(n,i,r){u.IsTouchDevice()||t.prototype.ToggleTabState(u,n,i,r,TabToggleMode.OnTabMouseEnter)};u.OnTabMouseLeave=function(n,i,r){u.IsTouchDevice()||t.prototype.ToggleTabState(u,n,i,r,TabToggleMode.OnTabMouseLeave)};u.$on("ProductService.ProductsLoaded",function(){r.find(window.location.hash).length>0&&(u.LoadOperationsCount+=1,u.LoadOperationsCount>=2&&_.delay(function(){u.ScrollToTop(r,!1)},1e3))});u.$on("ProductService.PromotionsLoaded",function(){r.find(window.location.hash).length>0&&(u.LoadOperationsCount+=1,u.LoadOperationsCount>=2&&_.delay(function(){u.ScrollToTop(r,!1)},1e3))});_.defer(function(){r.find(window.location.hash.substring(1)).length>0&&r.find(window.location.hash.substring(1))[0].click()})}return __extends(t,n),t.prototype.ToggleTabActive=function(n,t,i,r,u,f){var s=n.activeTabId,e,o;n.activeTabId="";this.ToggleTabStateById(n,t,s,u,f,TabToggleMode.OnTabClick);this.ToggleTabState(n,t,i,r,TabToggleMode.OnTabClick);e=angular.element(this.getEventTarget(t));$(t.target).closest("#GenericTabs").find("ul li").removeClass("Selected");e.addClass("Selected");o=e.attr("id");n.activeTabId=o},t.prototype.getEventTarget=function(n){return n.currentTarget||n.target},t.prototype.ToggleTabState=function(n,t,i,r,u){var f=angular.element(this.getEventTarget(t));this.ToggleTabStateById(n,t,f.attr("id"),i,r,u)},t.prototype.ToggleTabStateById=function(n,t,i,r,u,f){var e=$("#"+i),o=e.attr("id");n.activeTabId!=o&&($(t.target).closest("#GenericTabs").find("ul li").removeClass("Hover"),f==TabToggleMode.OnTabMouseEnter&&e.addClass("Hover"),e.css("background-color",r),e.css("color",u))},t.$inject=["$scope","$element"],t}(BaseAngularController);n.GenericTabModuleController=t}(GenericTabModule||(GenericTabModule={}));app.controller("GenericTabModuleController",GenericTabModule.GenericTabModuleController),function(n){var t=function(n){function t(t){var i=this,r;n.call(this,t);r=t;angular.element(document).ready(function(){var n=$(".main-letter"),t=$(".glossary-letter");n.on("click",function(){var r=$(i),u=$("#"+r.attr("id")+"-content");n.removeClass("pink");r.addClass("pink");t.addClass("hide");u.removeClass("hide");u.addClass("show")})})}return __extends(t,n),t.$inject=["$scope"],t}(BaseAngularController);n.GlossaryModuleController=t}(GlossaryModule||(GlossaryModule={}));app.controller("GlossaryModuleController",GlossaryModule.GlossaryModuleController),function(n){(function(n){n[n.AboutText=1]="AboutText";n[n.WelcomeSlide=2]="WelcomeSlide";n[n.WelcomeText=3]="WelcomeText";n[n.LeftMarketingModule=4]="LeftMarketingModule";n[n.RightMarketingModule=5]="RightMarketingModule"})(n.OnlineStoreContentName||(n.OnlineStoreContentName={}));var t=n.OnlineStoreContentName}(OnlineStoreModule||(OnlineStoreModule={}));ProfileInfoModel=function(){function n(){}return n}(),function(n){var t=function(n){function t(t,i,r){n.call(this,t);var u=t;u.ProfileInfoModel=new ProfileInfoModel;u.SessionService.WhenReady().then(function(){u.Session.Rep.Id>0&&r.getRepresentativeDetails().then(function(n){return u.ProfileInfoModel=n.Data,u.ProfileInfoModel&&(u.FacebookUrl="https://www.facebook.com/"+u.ProfileInfoModel.FacebookHandle,u.TwitterUrl="https://www.twitter.com/"+u.ProfileInfoModel.TwitterHandle,u.InstagramUrl="https://www.instagram.com/"+u.ProfileInfoModel.InstagramHandle,u.PinterestUrl="https://www.pinterest.com/"+u.ProfileInfoModel.PinterestHandle),null})});u.DisplayContactModal=function(){u.ShowContactRepModal(null,"become_a_rep")};u.CanDisplayRepPhoneNumber=function(){return u.Session.Rep.IsGemini?u.Session.Rep.Phone!==""&&!u.isCustomerAttachedToRemovedRep()&&u.ProfileInfoModel.DisplayFirstPhoneNumber:u.Session.Rep.Phone!==""&&!u.isCustomerAttachedToRemovedRep()};u.CanDisplayRepAlternativePhoneNumber=function(){return u.Session.Rep.IsGemini?u.Session.Rep.AlternativePhone!==""&&!u.isCustomerAttachedToRemovedRep()&&u.ProfileInfoModel.DisplaySecondPhoneNumber:u.Session.Rep.AlternativePhone!==""&&!u.isCustomerAttachedToRemovedRep()};u.CanDisplayConnectWithMe=function(){return u.Session.Rep.HomepageUrl&&u.Session.Rep.HomepageUrl!==""};u.CanDisplayRepCityState=function(){return u.Session.Rep.IsGemini?u.Session.Rep.CityState!==""&&u.ProfileInfoModel.DisplayCityState:u.Session.Rep.CityState!==""};u.$on("FallbackSrc.FallbackImageLoaded",function(n,t){var r=t.parent(".leftRepPanel"),i;r&&(r.hide(),i=$(".middleRepPanel"),i&&!i.hasClass("NoRepImage")&&i.addClass("NoRepImage"))});u.ShowIcon=function(n){return n?!0:!1}}return __extends(t,n),t.$inject=["$scope","$rootScope","geminiRepDetailsService"],t}(BaseAngularController);n.HeaderRepPanelController=t}(HeaderRepPanelModule||(HeaderRepPanelModule={}));app.controller("HeaderRepPanelController",HeaderRepPanelModule.HeaderRepPanelController),function(n){var t=function(){function n(){}return n.Brand="B",n.Category="C",n.Search="S",n}();n.DeptType=t}(LayoutLeftNavigationModule||(LayoutLeftNavigationModule={})),function(n){var t=function(){function n(){}return n.Brands="Brands",n.BrandsES="Marcas",n.Category="Category",n.CategoryES="Categoría",n.Categories="Categories",n.CategoriesES="Categorías",n.GoodBuys="Good Buys",n}();n.GroupName=t}(LayoutLeftNavigationModule||(LayoutLeftNavigationModule={})),function(n){"use strict";var t=function(t){function i(r,u,f,e,o,s){function p(n){return n.IncludeInAllBrandsPage&&n.IncludeInTopBrandsNavigation}function a(t,i,r){switch(t){case n.DeptType.Brand:return r?n.layoutLeftNavigationScope.DeptType===t&&i!==n.GroupName.Brands&&i!==n.GroupName.BrandsES:n.layoutLeftNavigationScope.DeptType===t&&i===n.GroupName.Brands||i===n.GroupName.BrandsES;case n.DeptType.Category:return r?n.layoutLeftNavigationScope.DeptType===t&&i!==n.GroupName.Categories&&i!==n.GroupName.CategoriesES&&i!==n.GroupName.GoodBuys&&i!==n.GroupName.Category&&i!==n.GroupName.CategoryES:n.layoutLeftNavigationScope.DeptType===t&&i===n.GroupName.Categories||i===n.GroupName.CategoriesES||i===n.GroupName.GoodBuys||i===n.GroupName.Category||i===n.GroupName.CategoryES;case n.DeptType.Search:return n.layoutLeftNavigationScope.DeptType===t}return!1}function w(t){return n.layoutLeftNavigationScope.SelectedCategoryId===t.Id}function b(t,i){i===void 0&&(i=!1);var r=i?n.GroupName.BrandsES:n.GroupName.Brands,u=t[0].GroupNames.indexOf(r),f=u>-1;return f&&(t[0].GroupNames.splice(u),t[0].GroupNames.unshift(r)),f}function nt(t,i){return _.any(t.GroupedChildren[i],function(t){return n.layoutLeftNavigationScope.ShowFacet(t)})}function d(t){var i=t===SliderFacetModelNames.priceRangeModel?n.layoutLeftNavigationScope.PageLoadPriceRange:n.layoutLeftNavigationScope.PageLoadDiscountRange;return _.isUndefined(n.layoutLeftNavigationScope[t])?!1:n.layoutLeftNavigationScope[t].minimum!==i.minimum||n.layoutLeftNavigationScope[t].maximum!==i.maximum}function g(n){return(n*100).toFixed(2)}function tt(){return!0}function l(){var t=window.ProductListModule,i,u,f,e,r;t!=null&&t.productListScope!=null&&(i=t.productListScope.productCategoryStructure&&t.productListScope.productCategoryStructure.Products&&t.productListScope.productCategoryStructure.Products.length>0&&t.productListScope.productCategoryStructure.Children.length===0?t.productListScope.productCategoryStructure.Products:t.productListScope.uniqueProducts,t.productListScope.IsSearchPage()||(i=i.filter(function(n){return n.CanBuy!=CanBuy.NoLongerAvailable})),tt()?(r=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0?t.productListScope.filterLeftNavByProducts(i):i,n.layoutLeftNavigationScope.facetsToShow=_(r).chain().pluck("Facets").flatten().value(),n.layoutLeftNavigationScope.deptFacetsToShow=_(r).chain().pluck("CategoryIds").flatten().uniq().value(),n.layoutLeftNavigationScope.validRatings=_(r).chain().filter(function(t){return n.layoutLeftNavigationScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+t.productListScope.RatingFudge)}).uniq().sortBy(function(n){return n}).value()):(u=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0?t.productListScope.filterLeftNavRatingsByProducts(i):i,f=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0?t.productListScope.filterLeftNavDeptByProducts(i):i,n.layoutLeftNavigationScope.facetsToShow=[],AVON.Navigation&&AVON.Navigation.ShopBys&&(e=n.layoutLeftNavigationScope.ProductSearchLoaded||AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0?t.productListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!0,i):t.productListScope.filterLeftNavByFacets(AVON.Navigation.ShopBys,!1,i),n.layoutLeftNavigationScope.facetsToShow=_(e).chain().pluck("Id").flatten().uniq().value()),n.layoutLeftNavigationScope.deptFacetsToShow=_(f).chain().pluck("CategoryIds").flatten().uniq().value(),n.layoutLeftNavigationScope.validRatings=_(u).chain().filter(function(t){return n.layoutLeftNavigationScope.ShowProductRating(t)}).map(function(n){return Math.floor(n.Rating+t.productListScope.RatingFudge)}).uniq().sortBy(function(n){return n}).value()));n.layoutLeftNavigationScope.setClearAll()}function y(){var n=".SelectedFacetContainer",i=$(n).is(":animated"),t="html, body",r=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match("CriOS")!=null,u=$(n).offset().top,f=$(window).scrollTop();i===!1&&f>u&&(r?_.delay(function(){return $(t).animate({scrollTop:$(n).offset().top-160},1e3)},10):$(t).animate({scrollTop:$(n).offset().top-160},1e3))}var h=this,k,c,v;t.call(this,r);this.$scope=r;this.$rootScope=u;this.historyService=s;n.layoutLeftNavigationScope=r;n.layoutLeftNavigationScope.SelectedFacetIds=[];n.layoutLeftNavigationScope.SelectedRatings=[];n.layoutLeftNavigationScope.StateIndex=0;n.layoutLeftNavigationScope.SelectedSortByValue=SortOption.None;AVON.LeftNavigation&&(n.layoutLeftNavigationScope.MenuItems=AVON.LeftNavigation.MenuItems,n.layoutLeftNavigationScope.SubCategoryId=AVON.LeftNavigation.SubCategoryId,n.layoutLeftNavigationScope.TopLevelCategoryName=AVON.LeftNavigation.TopLevelCategoryName,n.layoutLeftNavigationScope.DeptType=AVON.LeftNavigation.DeptType,n.layoutLeftNavigationScope.ShowFacets=AVON.LeftNavigation.ShowFacets,n.layoutLeftNavigationScope.CategoryDeepLinkModel=AVON.CategoryDeepLinksModel);AVON.Navigation&&(n.layoutLeftNavigationScope.Navigation=AVON.Navigation);n.layoutLeftNavigationScope.isNewAndNowPage=function(n){return n.toString()==="9300"};n.layoutLeftNavigationScope.deptFacetsToShow=[];n.layoutLeftNavigationScope.facetsToShow=[];n.layoutLeftNavigationScope.facetClicked=!1;n.layoutLeftNavigationScope.validRatings=[];n.layoutLeftNavigationScope.PriceSliderChangeIndex=0;n.layoutLeftNavigationScope.DiscountSliderChangeIndex=0;n.layoutLeftNavigationScope.menuItemHasPromotionThumbnails=function(n,t){return n==undefined||_.isNull(n[t])?!1:n[t].ImageItems.length>0?!0:n[t].RichTextItems.length>0?!0:!1};n.layoutLeftNavigationScope.groupNameIsNotBrand=function(t){return t!==n.GroupName.Brands&&t!==n.GroupName.BrandsES};n.layoutLeftNavigationScope.isFacetToggle=function(t){return n.layoutLeftNavigationScope.isDepartmentTypeSearch()||!n.layoutLeftNavigationScope.isSubCategoryIdZero()||t===n.GroupName.GoodBuys};n.layoutLeftNavigationScope.isDepartmentTypeBrand=function(t,i){return i===void 0&&(i=!1),a(n.DeptType.Brand,t,i)};n.layoutLeftNavigationScope.isDepartmentTypeCategory=function(t,i){return i===void 0&&(i=!1),a(n.DeptType.Category,t,i)};n.layoutLeftNavigationScope.isDepartmentTypeSearch=function(){return a(n.DeptType.Search)};n.layoutLeftNavigationScope.isBrandDeptType=function(){return n.layoutLeftNavigationScope.DeptType===n.DeptType.Brand};n.layoutLeftNavigationScope.isMenuItemBrand=function(t,i){return a(n.DeptType.Brand,i)&&t.GroupedChildren[i].length>0};n.layoutLeftNavigationScope.isMenuItemShownInLeftNav=function(t,i){i===void 0&&(i=!1);var r=t.IncludeInLeftNavigation===!0&&t.Id===n.layoutLeftNavigationScope.SubCategoryId;return i?r&&t.Children.length>0:r};n.layoutLeftNavigationScope.applySelectedCategoryClass=function(n){if(p(n)){var t=window.location.pathname,i=t.split("/").slice(-1)[0];return i==="all"&&w(n)?"SelectedCategory":""}return w(n)?"SelectedCategory":""};n.layoutLeftNavigationScope.applySearchClass=function(){return n.layoutLeftNavigationScope.DeptType===n.DeptType.Search?"SearchLeftNavGroupItem":""};n.layoutLeftNavigationScope.applyNewAndNowPageClass=function(t){return n.layoutLeftNavigationScope.isNewAndNowPage(t)?"NewAndNowPage":""};n.layoutLeftNavigationScope.isSubCategoryIdZero=function(){return n.layoutLeftNavigationScope.SubCategoryId===0};n.layoutLeftNavigationScope.renderCategoryUrl=function(n,t){return(t===void 0&&(t=!1),p(n))?n.Url+"/all":n.IncludeInAllBrandsPage&&n.Children.length===0?n.Url+"/all":_.isEmpty(n)?"":n.Url};n.layoutLeftNavigationScope.trustHtmlModel=function(n){return f.trustAsHtml(n)};n.layoutLeftNavigationScope.PrimeFacets=[];n.layoutLeftNavigationScope.Ratings=[];_.delay(function(){var n=$("a:contains('Good Buys')");n.hasClass("active")&&n.addClass("SelectedCategory");n.find("i").remove()});n.layoutLeftNavigationScope.SelectedCategoryId=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLink=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationPinkLink=AVON.SelectedCategoryId;AvonModule.AvonScope.LeftNavigationSelectedLinkParent=AVON.SelectedCategoryId;_.delay(function(){var n=$("ul.Categories");$("li",n).length==1&&n.parent().hide()},1e3);n.layoutLeftNavigationScope.DeptType===n.DeptType.Brand&&n.layoutLeftNavigationScope.MenuItems[0]&&(k=b(n.layoutLeftNavigationScope.MenuItems,!1),k||b(n.layoutLeftNavigationScope.MenuItems,!0));n.layoutLeftNavigationScope.IsRatingChecked=function(t){return n.layoutLeftNavigationScope.Ratings.indexOf(t)>-1};n.layoutLeftNavigationScope.$on("layoutLeftNavigationScope.PopulateSelectedRatings",function(t,i){_.each(i,function(t){n.layoutLeftNavigationScope.Ratings.push(t)});n.layoutLeftNavigationScope.setClearAll()});n.layoutLeftNavigationScope.UpdateRatings=function(t,r){var e,f;y();t.target.checked?n.layoutLeftNavigationScope.Ratings.indexOf(r)===-1&&n.layoutLeftNavigationScope.Ratings.push(r):n.layoutLeftNavigationScope.Ratings=_.filter(n.layoutLeftNavigationScope.Ratings,function(n){return n!==r});n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(e=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.RatingsQueryStringParamName,n.layoutLeftNavigationScope.Ratings),c()||s.PushStateUrl(window.location.href),f=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,f,e),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f));n.layoutLeftNavigationScope.SkipPushState||(n.layoutLeftNavigationScope.RatingSelected=n.layoutLeftNavigationScope.Ratings&&n.layoutLeftNavigationScope.Ratings.length>0);u.$broadcast("productListScope.UpdateRatings",n.layoutLeftNavigationScope.Ratings);n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel();n.layoutLeftNavigationScope.setClearAll()};n.layoutLeftNavigationScope.$on("productListScope.RatingRemoved",function(t,i){var r=n.layoutLeftNavigationScope.Ratings.indexOf(i);r>-1&&n.layoutLeftNavigationScope.Ratings.splice(r,1)});n.layoutLeftNavigationScope.ClearRatings=function(t,r){var e,f;r===void 0&&(r=!0);n.layoutLeftNavigationScope.RatingSelected=!1;t=t||!1;t===!1&&y();$(".LeftNavGroupItem .ratingCheckbox").prop("checked",!1);n.layoutLeftNavigationScope.Ratings=[];u.$broadcast("productListScope.UpdateRatings",n.layoutLeftNavigationScope.Ratings);r&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(e=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.RatingsQueryStringParamName,n.layoutLeftNavigationScope.Ratings),c()||s.PushStateUrl(window.location.href),f=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,f,e),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f));n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel()};n.layoutLeftNavigationScope.ShowSubBrands=function(){return $(".subNav").length>0};n.layoutLeftNavigationScope.showProductList=function(){return AVON.ShowProductList};n.layoutLeftNavigationScope.$on("productListScope.UpdateMultipleSelectedFacets",function(){AVON.ShowProductList=!0});n.layoutLeftNavigationScope.$on("ProductListController.ProductsLoaded",function(t,i){n.layoutLeftNavigationScope.PageLoadUrl=document.location.href;n.layoutLeftNavigationScope.ProductsLoaded=!0;l();n.layoutLeftNavigationScope.ShowRatings=i});n.layoutLeftNavigationScope.$on("ProductListController.UpdateSelectedCategory",function(n,t){r.LinkClick(null,t,null)});n.layoutLeftNavigationScope.ToggleGroupSection=function(n){var r=angular.element(n.currentTarget),i=r.parent(),u=i.next("ul").length>0?i.next("ul"):i.next(".facet-slider-container"),t=r.find("i");t.hasClass("fa-chevron-circle-down")?(u.addClass("Hidden"),t.removeClass("fa-chevron-circle-down"),t.addClass("fa-chevron-circle-right")):(u.removeClass("Hidden"),t.removeClass("fa-chevron-circle-right"),t.addClass("fa-chevron-circle-down"))};n.layoutLeftNavigationScope.ClearGroupSection=function(n,t,i){for(var e,f=[],r=0;r<i.length;r++)f.push(i[r].Id),$("#LeftNavCheckbox-"+i[r].Id).prop("checked",!1);e=angular.element(n.currentTarget);e.removeClass("Active");u.$broadcast("productListScope.UpdateMultipleSelectedFacets",t,f,!1)};c=function(){return n.layoutLeftNavigationScope.PageLoadUrl!==document.location.href};n.layoutLeftNavigationScope.UpdateSelectedFacets=function(t,r,f,e,o,a,v){var d,w,p,g,nt,b,k;v===void 0&&(v=!1);d=$("#TaglinesContainer");n.layoutLeftNavigationScope.SkipPushState||(n.layoutLeftNavigationScope.SelectedFacetIds=[]);d.length>0&&y();w=t&&t.target.checked||a;o?w&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(f)<0?(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.push(f),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetAdded",f,e,v)):!w&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(f)>=0&&(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=_(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets).without(f),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetRemoved")):(p=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:r}),p==null&&(p={Title:r,Facets:[],ValidDeptIds:[],IsDepartmentShopBy:o},AvonModule.AvonScope.LeftNavigationSelectedFacets.push(p)),w&&_(p.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(f)<0?(g={Id:f,Text:e},p.Facets.push(g),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetAdded",f,e,v)):!w&&_(p.Facets).chain().pluck("Id").flatten().uniq().value().indexOf(f)>=0&&(p.Facets=_(p.Facets).filter(function(n){return n.Id!=f}),AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0}),AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetRemoved")));n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(c()||s.PushStateUrl(window.location.href),h.getSelectedFacetIds(),nt=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.FacetQueryStringParamName,n.layoutLeftNavigationScope.SelectedFacetIds),b=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,b,nt),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=b));l();n.layoutLeftNavigationScope.facetClicked=!0;u.$broadcast("productListScope.EnableFacetClear",f);n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel();n.layoutLeftNavigationScope.ProductSearchLoaded&&AVON.NavigationOriginalSearchFacets&&(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch||(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=_.filter(AVON.NavigationOriginalSearchFacets,function(n){return n.Text.toLowerCase()===e.toLowerCase()&&n.Id!==f})),n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch&&(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch.length>0?(k=n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch.pop(),n.layoutLeftNavigationScope.UpdateSelectedFacets(null,r,k.Id,k.Text,o,w,!0)):n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=null))};s.OnPopState(i.HistoryStateKey,function(t){var p,e,w,k,b,d;if(t.state){n.layoutLeftNavigationScope.SkipPushState=!0;var i=t.state,f="",a="",o="",c="",l="",y=void 0;if(i&&i.Index!==undefined&&(y=r.PopStateIndex!==undefined?i.Index>0&&i.Index<r.PopStateIndex?"back":"forward":i.Index>0&&i.Index<r.StateIndex?"back":"forward",r.PopStateIndex=i.Index),i&&i.category)i.Data!==undefined?(i.Data.ParentLinkId!==i.category.Id&&(p=$("#link-"+i.Data.ParentLinkId+" > a:first-of-type"),p&&p.trigger("click")),e=$("#link-"+i.category.Id+" > a:first-of-type"),e&&e.trigger("click")):(e=$("#link-"+i.category.Id+" > a:first-of-type"),e&&(e.trigger("click"),w=!0,n.layoutLeftNavigationScope.$on("ProductListController.ProductsLoaded",function(){w&&_.delay(function(){f=app.GetQuerystringParameterByName(r.FacetQueryStringParamName);v(r.SelectedFacetIds,f);w=!1},2e3)})));else{if(k=window.location.pathname.split("/").pop(),_.each(AVON.Navigation.LinkGroups,function(n){b=_.find(n.Links,function(n){return n.Text.formatUrlNugget()===k.formatUrlNugget()})}),b&&(d=$("#link-"+b.Id+" > a:first-of-type"),!d.hasClass("SelectedCategory"))){window.location.reload();return}if((!y||y==="back")&&h.pageStateIsUnchanged(i)){r.ShowLoading("");s.Go(-1);return}f=app.GetQuerystringParameterByName(r.FacetQueryStringParamName);a=app.GetQuerystringParameterByName(r.RatingsQueryStringParamName);o=app.GetQuerystringParameterByName(r.PriceQueryStringParamName);c=app.GetQuerystringParameterByName(r.DiscountQueryStringParamName);l=app.GetQuerystringParameterByName(r.SortByQueryStringParamName);i&&i.SelectedFacetIds?(r.SelectedFacetIds.length>0&&v(r.SelectedFacetIds,f),r.Ratings.length>0&&h.updateRatings(r.Ratings,f),r.SelectedFacetIds=i.SelectedFacetIds,r.SelectedRatings=i.SelectedRatings,r.PriceRangeFacetSelected=i.SelectedPriceRange.PriceRangeFacetSelected,r.DiscountRangeFacetSelected=i.SelectedDiscountRange.DiscountRangeFacetSelected,u.$broadcast("productListScope.SetDiscountRangeSelected",r.PriceRangeFacetSelected),u.$broadcast("productListScope.SetPriceRangeSelected",r.DiscountRangeFacetSelected)):(r.SelectedFacetIds.length===0&&(_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(n){n.Facets.map(function(n){r.SelectedFacetIds.push(n.Id)})}),r.SelectedFacetIds=r.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)),_.each(r.Ratings,function(n){r.SelectedRatings.push(n)}));(r.PriceRangeFacetSelected||r.PriceRangeDeepLink)&&i&&i.SelectedDiscountRange&&o.length>0?(r.priceRangeModel.minimumDisplayValue=i.SelectedPriceRange.Minimum,r.priceRangeModel.maximumDisplayValue=i.SelectedPriceRange.Maximum,r.priceRangeModel.floor=0,r.priceRangeModel.ceil=i.SelectedPriceRange.Ceil,r.onPriceRangeSliderChange()):(u.$broadcast("productListScope.SetPriceRangeSelected",!1),o.length===0?r.UpdateDiscountAndPriceModel():(r.priceRangeModel.minimumDisplayValue=r.PageLoadPriceRange.minimumDisplayValue,r.priceRangeModel.maximumDisplayValue=r.PageLoadPriceRange.maximumDisplayValue,r.priceRangeModel.floor=0,r.priceRangeModel.ceil=r.PageLoadPriceRange.ceil,r.onPriceRangeSliderChange()));r.SafeApply();(r.DiscountRangeFacetSelected||r.DiscountRangeDeepLink)&&i&&i.SelectedDiscountRange&&c.length>0?(r.discountLevelModel.minimum=i.SelectedDiscountRange.Minimum,r.discountLevelModel.maximum=i.SelectedDiscountRange.Maximum,r.discountLevelModel.floor=0,r.discountLevelModel.ceil=i.SelectedDiscountRange.Ceil,r.onDiscountLevelSliderChange()):(u.$broadcast("productListScope.SetDiscountRangeSelected",!1),c.length===0?r.UpdateDiscountAndPriceModel():(r.discountLevelModel.minimum=r.PageLoadDiscountRange.minimum,r.discountLevelModel.maximum=r.PageLoadDiscountRange.maximum,r.discountLevelModel.floor=0,r.discountLevelModel.ceil=r.PageLoadDiscountRange.ceil,r.onDiscountLevelSliderChange()));r.SafeApply();h.updateRatings(r.SelectedRatings,a);v(r.SelectedFacetIds,f);r.SelectedSortByValue=l.length===0?SortOption.None:parseInt(l);u.$broadcast("productListScope.SortByUpdated",r.SelectedSortByValue)}_.defer(function(){r.SkipPushState=!1;r.facetClicked=!r.facetClicked&&f.length>0;r.RatingSelected=!r.RatingSelected&&a.length>0;r.PriceRangeFacetSelected=!r.PriceRangeFacetSelected&&o.length>0||i&&i.SelectedPriceRange&&i.SelectedPriceRange.PriceRangeFacetSelected;r.DiscountRangeFacetSelected=!r.DiscountRangeFacetSelected&&c.length>0||i&&i.SelectedDiscountRange&&i.SelectedDiscountRange.DiscountRangeFacetSelected;r.SortingSelected=!r.SortingSelected&&l.length>0;r.setClearAll()})}});v=function(n,t){_.each(n,function(n){var i=$("#LeftNavCheckbox-"+n);i&&i.is(":checked")&&t.indexOf(n.toString())===-1&&i.trigger("click");i&&!i.is(":checked")&&t.indexOf(n.toString())>=0&&i.trigger("click")})};n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel=function(){n.layoutLeftNavigationScope.ProductSearchLoaded||u.$broadcast("productListScope.UpdateDiscountAndPriceModel")};n.layoutLeftNavigationScope.ClearShopByFacets=function(t,r,u,f){var o,e,a,p,v;f===void 0&&(f=!0);u=u||!1;u===!1&&y();o="#shopByFacetList-"+n.layoutLeftNavigationScope.cleanText(t);$(o).find("input[type=checkbox]").prop("checked",!1);$(o).parent(".LeftNavGroupItem").find(".Active").removeClass("Active");e=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).findWhere({Title:t});e!=null?(_.each(e.Facets,function(t){var i=n.layoutLeftNavigationScope.SelectedFacetIds.indexOf(t.Id);i>-1&&n.layoutLeftNavigationScope.SelectedFacetIds.splice(i,1)}),e.Facets=[],AvonModule.AvonScope.LeftNavigationSelectedFacets=_(AvonModule.AvonScope.LeftNavigationSelectedFacets).filter(function(n){return n.Facets.length>0})):r&&(_.each(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets,function(t){var i=n.layoutLeftNavigationScope.SelectedFacetIds.indexOf(t);i>-1&&n.layoutLeftNavigationScope.SelectedFacetIds.splice(i,1)}),AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>1?(a=_(n.layoutLeftNavigationScope.Navigation.ShopBys).findWhere({Title:t}),a&&_.each(a.Facets,function(t){n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch||(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=_.filter(AVON.NavigationOriginalSearchFacets,function(n){return n.Text.toLowerCase()===t.Text.toLowerCase()&&n.Id!==t.Id}));_.each(n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch,function(n){var t=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(n.Id);t>-1&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.splice(t,1)});n.layoutLeftNavigationScope.MatchedHiddenFacetsForSearch=null;var i=AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.indexOf(t.Id);i>-1&&AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.splice(i,1)})):AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=[]);f&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(p=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.FacetQueryStringParamName,n.layoutLeftNavigationScope.SelectedFacetIds),c()||s.PushStateUrl(window.location.href),v=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,v,p),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=v));l();n.layoutLeftNavigationScope.UpdateDiscountAndPriceModel();AvonModule.AvonScope.$broadcast("layoutLeftNavigationScope.FacetRemoved")};n.layoutLeftNavigationScope.ClearShopAll=function(){for(var t in n.layoutLeftNavigationScope.Navigation.ShopBys)n.layoutLeftNavigationScope.ClearShopByFacets(n.layoutLeftNavigationScope.Navigation.ShopBys[t].Title,n.layoutLeftNavigationScope.Navigation.ShopBys[t].IsDepartmentShopBy,!0,!0);n.layoutLeftNavigationScope.ClearRatings(!0,!0);u.$broadcast("layoutLeftNavigationScope.ClearPriceAndDiscount")};n.layoutLeftNavigationScope.cleanText=function(n){return n.toLocaleLowerCase().replace(/[^0-9a-z]/gi,"")};n.layoutLeftNavigationScope.FacetsToShow=function(){var t=window.ProductListModule,r,i,u;return t!=null&&t.productListScope!=null?(r=t.productListScope.productCategoryStructure!=null&&t.productListScope.productCategoryStructure.Products!=null&&t.productListScope.productCategoryStructure.Products.length>0,i=r?t.productListScope.productCategoryStructure.Products:t.productListScope.products,n.layoutLeftNavigationScope.IsSearchPage()||(i=i.filter(function(n){return n.CanBuy!=CanBuy.NoLongerAvailable})),u=_(i).pluck("Id"),_(i).chain().select(function(n){return u.indexOf(n.Id)>=0}).pluck("Facets").flatten().uniq().value()):[]};n.layoutLeftNavigationScope.DepartmentFacetsToShow=function(){var t=window.ProductListModule,r,i,u;return t!=null&&t.productListScope!=null?(r=t.productListScope.productCategoryStructure!=null&&t.productListScope.productCategoryStructure.Products!=null&&t.productListScope.productCategoryStructure.Products.length>0,i=r?t.productListScope.productCategoryStructure.Products:t.productListScope.products,n.layoutLeftNavigationScope.IsSearchPage()||(i=i.filter(function(n){return n.CanBuy!=CanBuy.NoLongerAvailable})),u=_(i).pluck("Id"),_(i).chain().select(function(n){return u.indexOf(n.Id)>=0}).pluck("CategoryIds").flatten().uniq().value()):[]};n.layoutLeftNavigationScope.isValidRating=function(t){return $("#rating-"+t).prop("checked")===!0?!0:n.layoutLeftNavigationScope.validRatings.indexOf(t)>=0};n.layoutLeftNavigationScope.filterFacets=function(t){return n.layoutLeftNavigationScope.FacetsToShow().indexOf(t.Id)>=0};n.layoutLeftNavigationScope.filterDepartmentFacets=function(t){return n.layoutLeftNavigationScope.DepartmentFacets=n.layoutLeftNavigationScope.DepartmentFacetsToShow(),n.layoutLeftNavigationScope.DepartmentFacets.indexOf(t.Id)>=0};n.layoutLeftNavigationScope.SetExclusiveFacet=function(t,i,r){n.layoutLeftNavigationScope.SelectedCategoryId=r;u.$broadcast("productListScope.SetExclusiveFacet",i,r)};n.layoutLeftNavigationScope.isEnabledFacet=function(t,i,r){if(r===void 0&&(r=!1),!n.layoutLeftNavigationScope.facetClicked&&!n.layoutLeftNavigationScope.RatingSelected||$("#LeftNavCheckbox-"+i.Id).prop("checked")===!0)return!0;var u;return u=r?n.layoutLeftNavigationScope.deptFacetsToShow.indexOf(i.Id)>-1:n.layoutLeftNavigationScope.facetsToShow.indexOf(i.Id)>-1,i.IsEnabled=u,u};n.layoutLeftNavigationScope.ShowFacet=function(t){return!_.isNull(t)&&t.IncludeInLeftNavigation&&_.contains(n.layoutLeftNavigationScope.PrimeFacets,t.Id)?!0:!1};n.layoutLeftNavigationScope.isGroupNameGoodBuys=function(t){return t===n.GroupName.GoodBuys};n.layoutLeftNavigationScope.isProductLinePage=function(t){return t.Url===""?!0:_.contains(t.GroupNames,n.GroupName.GoodBuys)?!0:!1};n.layoutLeftNavigationScope.ShowFacetGroup=function(t,i){if(n.layoutLeftNavigationScope.isDepartmentTypeSearch()||n.layoutLeftNavigationScope.isDepartmentTypeBrand(i,!0)||n.layoutLeftNavigationScope.isDepartmentTypeCategory(i,!0)){var r=nt(t,i);if(r===!1)return r}return!0};n.layoutLeftNavigationScope.LinkClick=function(t,i,r){i.IsFalseCategory||(AvonModule.AvonScope.LeftNavigationSelectedLink=i.Id,AvonModule.AvonScope.LeftNavigationSelectedLinkParent=r?r.Id:i.Id,u.$broadcast("Navigation.SelectedLinkUpdated"));AvonModule.AvonScope.LeftNavigationPinkLink=i.Id;AvonModule.AvonScope.LeftNavigationSelectedFacets=[];for(var f in n.layoutLeftNavigationScope.Navigation.ShopBys)n.layoutLeftNavigationScope.ClearShopByFacets(n.layoutLeftNavigationScope.Navigation.ShopBys[f].Title,!1,!0,!1);AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets=[];n.layoutLeftNavigationScope.facetClicked=!1;n.layoutLeftNavigationScope.ShowLoading("");h.updateSelectedCategory(t,r,i)};n.layoutLeftNavigationScope.$on("productListScope.CategoryFacetDeepLink",function(t,i){n.layoutLeftNavigationScope.SkipPushState=!0;var r=$("#LeftNavCheckbox-"+i);r.length>0&&r.trigger("click");_.defer(function(){n.layoutLeftNavigationScope.SkipPushState=!1;n.layoutLeftNavigationScope.setClearAll()})});n.layoutLeftNavigationScope.filterShopBysByDepartment=function(t){var i=window.ProductListModule,r,u;return i!=null&&i.productListScope!=null&&!i.productListScope.ShowProductList?!1:(r=t.IsDepartmentShopBy||t.ValidDeptIds.indexOf(AvonModule.AvonScope.LeftNavigationSelectedLink)>=0,u=t.IsDepartmentShopBy?e("filter")(t.Facets,n.layoutLeftNavigationScope.filterDepartmentFacets).length>0:e("filter")(t.Facets,n.layoutLeftNavigationScope.filterFacets).length>0,r&&u)};n.layoutLeftNavigationScope.$on("layoutLeftNavigationScope.UpdatePrimeFacets",function(t,i){(n.layoutLeftNavigationScope.PrimeFacets.length==0||n.layoutLeftNavigationScope.DeptType!==n.DeptType.Brand||n.layoutLeftNavigationScope.SelectedCategoryId==n.layoutLeftNavigationScope.SubCategoryId)&&(n.layoutLeftNavigationScope.PrimeFacets=i)});n.layoutLeftNavigationScope.$on("ProductListService.ProductSearchLoaded",function(t,i){if(AVON.NavigationOriginalSearchFacets=[],AVON.Navigation=i.Data.Navigation,n.layoutLeftNavigationScope.Navigation=i.Data.Navigation,AVON.Navigation&&AVON.Navigation.ShopBys){var r=_.find(AVON.Navigation.ShopBys,function(t){return t.Title.trim().toLowerCase()===n.GroupName.Categories.toLowerCase()||t.Title.trim().toLowerCase()===n.GroupName.CategoriesES.toLowerCase()});AVON.Navigation.ShopBys.forEach(function(t){t.Facets&&(t.Facets=_.uniq(t.Facets,function(n){return n.Text.trim().toLowerCase()}),_.each(t.Facets,function(i,u){if(i&&n.layoutLeftNavigationScope.filterDepartmentFacets(i)&&AVON.NavigationOriginalSearchFacets.push(i),i&&t.Title.trim().toLowerCase()!==n.GroupName.Categories.toLowerCase()&&t.Title.trim().toLowerCase()!==n.GroupName.CategoriesES.toLowerCase()&&r){var f=_.find(r.Facets,function(n){return i.Text.toLowerCase()===n.Text.toLowerCase()});f&&t.Facets.splice(u,1)}}))})}n.layoutLeftNavigationScope.ProductSearchLoaded=!0;AVON.ShowProductList=!0;n.layoutLeftNavigationScope.showProductList();l();n.layoutLeftNavigationScope.SafeApply()});n.layoutLeftNavigationScope.$on("ProductListService.ProductSpotsLoaded",function(t,i){n.layoutLeftNavigationScope.Navigation.Content.LeftBottomPromotionThumbnails=i.LeftBottomPromotionThumbnails;n.layoutLeftNavigationScope.Navigation.Content.LeftTopPromotionThumbnails=i.LeftTopPromotionThumbnails;n.layoutLeftNavigationScope.SafeApply();$(".LeftNavPromotionSpot.BottomSpot").removeClass("Hidden")});n.layoutLeftNavigationScope.$on("productListScope.discountLevelModelPopulated",function(t,i){n.layoutLeftNavigationScope.PageLoadDiscountRange=$.extend({},i);n.layoutLeftNavigationScope.discountLevelModel=i});n.layoutLeftNavigationScope.$on("productListScope.setSortUrl",function(t,r,u){c()||s.PushStateUrl(window.location.href);var f=h.getCurrentPageState();s.ReplaceState(i.HistoryStateKey,f,r);n.layoutLeftNavigationScope.SelectedSortByValue=u;n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f);n.layoutLeftNavigationScope.SkipPushState||(n.layoutLeftNavigationScope.SortingSelected=!0)});n.layoutLeftNavigationScope.$on("productListScope.priceRangeModelPopulated",function(t,i){n.layoutLeftNavigationScope.PageLoadPriceRange=$.extend({},i);n.layoutLeftNavigationScope.priceRangeModel=i});n.layoutLeftNavigationScope.$on("productListScope.facetRemoved",function(){l();n.layoutLeftNavigationScope.SafeApply()});n.layoutLeftNavigationScope.$on("productListScope.UpdateFacetState",function(){var r,t;!n.layoutLeftNavigationScope.ProductSearchLoaded&&h.historyService.IsPushStateSupported&&(h.getSelectedFacetIds(),r=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.FacetQueryStringParamName,n.layoutLeftNavigationScope.SelectedFacetIds),c()||s.PushStateUrl(window.location.href),t=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,t,r),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=t))});n.layoutLeftNavigationScope.setClearAll=function(){var t=AvonModule.AvonScope.LeftNavigationSelectedFacets.length>0||AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets.length>0||n.layoutLeftNavigationScope.Ratings.length>0,r,i;n.layoutLeftNavigationScope.PriceRangeFacetSelected&&(t=!0);n.layoutLeftNavigationScope.DiscountRangeFacetSelected&&(t=!0);r=$("#LeftNavRefineBy");i=r.find(".LeftNavClearItem");t?i.addClass("Active"):i.removeClass("Active");n.layoutLeftNavigationScope.SafeApply()};n.layoutLeftNavigationScope.$on("productListScope.FacetModelDeepLink",function(t,i,r){i===SliderFacetModelNames.discountLevelModel?(n.layoutLeftNavigationScope.DiscountRangeDeepLink=!0,n.layoutLeftNavigationScope.PageLoadDiscountRange=$.extend({},r),n.layoutLeftNavigationScope.DiscountRangeFacetSelected=!0):(n.layoutLeftNavigationScope.PriceRangeDeepLink=!0,n.layoutLeftNavigationScope.PageLoadPriceRange=$.extend({},r),n.layoutLeftNavigationScope.PriceRangeFacetSelected=!0);n.layoutLeftNavigationScope.setClearAll()});n.layoutLeftNavigationScope.onDiscountLevelSliderTranslate=function(n){return n+"%"};n.layoutLeftNavigationScope.onPriceRangeSliderTranslate=function(n){return"$"+n};n.layoutLeftNavigationScope.$on("productListScope.PriceRangeCleared",function(t,r){var f,u;n.layoutLeftNavigationScope.PriceRangeFacetSelected=!1;l();r&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(f=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.PriceQueryStringParamName,null),c()||s.PushStateUrl(window.location.href),u=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,u,f),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=u))});n.layoutLeftNavigationScope.$on("productListScope.DiscountRangeCleared",function(t,r){var f,u;n.layoutLeftNavigationScope.DiscountRangeFacetSelected=!1;l();r&&!n.layoutLeftNavigationScope.ProductSearchLoaded&&!n.layoutLeftNavigationScope.SkipPushState&&h.historyService.IsPushStateSupported&&(f=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.DiscountQueryStringParamName,null),c()||s.PushStateUrl(window.location.href),u=h.getCurrentPageState(),s.ReplaceState(i.HistoryStateKey,u,f),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=u))});n.layoutLeftNavigationScope.$on("ProductListController.DeepLinkProcessed",function(){n.layoutLeftNavigationScope.DeepLinkPageState=h.getCurrentPageState();s.ReplaceState(i.HistoryStateKey,n.layoutLeftNavigationScope.DeepLinkPageState,window.location.href)});n.layoutLeftNavigationScope.shouldSubLinksRender=function(t){if(t.SubLinks.length>0){if(t.Id==n.layoutLeftNavigationScope.LeftNavigationSelectedLinkParent)return!0;var i=_.any(t.SubLinks,function(t){return t.Id==n.layoutLeftNavigationScope.LeftNavigationSelectedLink});if(i)return!0}return!1};n.layoutLeftNavigationScope.onDiscountLevelSliderChange=function(){var f=d(SliderFacetModelNames.discountLevelModel),t,e,r;n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(t=[],f&&(t.push(n.layoutLeftNavigationScope.discountLevelModel.minimum),t.push(n.layoutLeftNavigationScope.discountLevelModel.maximum)),e=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.DiscountQueryStringParamName,t),c()||s.PushStateUrl(window.location.href),r=h.getCurrentPageState(n.layoutLeftNavigationScope.PriceRangeFacetSelected,!0),s.ReplaceState(i.HistoryStateKey,r,e),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=r));n.layoutLeftNavigationScope.DiscountRangeFacetSelected=f;n.layoutLeftNavigationScope.setClearAll();u.$broadcast("productListScope.updateFacets",n.layoutLeftNavigationScope.discountLevelModel,SliderFacetModelNames.discountLevelModel);u.$broadcast("productListScope.SetDiscountRangeSelected",n.layoutLeftNavigationScope.DiscountRangeFacetSelected)};n.layoutLeftNavigationScope.onPriceRangeSliderChange=function(){var e=n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue,o=n.layoutLeftNavigationScope.priceRangeModel.maximumDisplayValue,r,t,l,f;n.layoutLeftNavigationScope.priceRangeModel.minimum=e;n.layoutLeftNavigationScope.priceRangeModel.maximum=o;r=d(SliderFacetModelNames.priceRangeModel);n.layoutLeftNavigationScope.ProductSearchLoaded||n.layoutLeftNavigationScope.SkipPushState||!h.historyService.IsPushStateSupported||(t=[],r&&(t.push(Math.floor(g(e))),t.push(Math.ceil(g(o)))),l=n.layoutLeftNavigationScope.GetUpdatedUrl(n.layoutLeftNavigationScope.PriceQueryStringParamName,t),c()||s.PushStateUrl(window.location.href),f=h.getCurrentPageState(!0,n.layoutLeftNavigationScope.DiscountRangeFacetSelected),s.ReplaceState(i.HistoryStateKey,f,l),n.layoutLeftNavigationScope.DeepLinkPageState&&(n.layoutLeftNavigationScope.DeepLinkPageState=f));n.layoutLeftNavigationScope.PriceRangeFacetSelected=r;n.layoutLeftNavigationScope.setClearAll();u.$broadcast("productListScope.updateFacets",n.layoutLeftNavigationScope.priceRangeModel,SliderFacetModelNames.priceRangeModel);u.$broadcast("productListScope.SetPriceRangeSelected",n.layoutLeftNavigationScope.PriceRangeFacetSelected)};n.layoutLeftNavigationScope.isFacetModelReady=function(n){return!_.isEmpty(n)&&n.facets.length>0};n.layoutLeftNavigationScope.GetAnalyticsAttributeValue=function(){for(var n=[],t=0;t<arguments.length;t++)n[+t]=arguments[t];return AVON.TopCategoryName?n.unshift(AVON.TopCategoryName):AVON.breadcrumbs.length>1&&n.unshift(AVON.breadcrumbs[0].Text),o.GetAnalyticsAttributeValue("navleft",n)};this.updateBrowserHistoryState()}return __extends(i,t),i.prototype.getSelectedMenuItem=function(n){var i,e,t,c,l,r,o,u,f,s,h;if(this.$scope.MenuItems)for(i=0,e=this.$scope.MenuItems;i<e.length;i++){if(t=e[i],t.Id==n)return t;for(c in t.GroupedChildren)for(l=t.GroupedChildren[c],r=0,o=l;r<o.length;r++){if(u=o[r],u.Id==n)return u;for(f=0,s=u.Children;f<s.length;f++)if(h=s[f],h.Id==n)return h}}return null},i.prototype.updateBrowserHistoryState=function(){var n=this.getSelectedMenuItem(AVON.SelectedCategoryId),t,r;n&&(t={Id:n.Id,Caption:n.Caption,Url:n.Url},r={Index:undefined,SelectedDiscountRange:undefined,SelectedFacetIds:undefined,SelectedPriceRange:undefined,SelectedRatings:undefined,Data:{ParentLinkId:n.Id},category:t,setSubCategory:null},this.historyService.ReplaceState(i.HistoryStateKey,r))},i.prototype.updateSelectedCategory=function(t,i,r){var v=i?!0:!1,h=r.IsFalseCategory?!1:!v,f={Id:r.Id,Caption:r.Text,Url:r.Url},p=t?$(t.currentTarget).text():r.Text,s,y,c,e,l,o,u,a;n.layoutLeftNavigationScope.SelectedCategoryId=f.Id;for(s in n.layoutLeftNavigationScope.MenuItems)for(y in n.layoutLeftNavigationScope.MenuItems[s].GroupNames)if(c=n.layoutLeftNavigationScope.MenuItems[s].GroupNames[y],e=n.layoutLeftNavigationScope.MenuItems[s].GroupedChildren[c],e){for(l=[],o=0;o<e.length;o++)l.push(e[o].Id),$("#LeftNavCheckbox-"+e[o].Id).prop("checked",!1);this.$rootScope.$broadcast("productListScope.UpdateMultipleSelectedFacets",c,l,!1,p)}_.defer(function(){n.layoutLeftNavigationScope.ClearRatings(!0,!1)});u=window.location.search.toLowerCase();u.indexOf(n.layoutLeftNavigationScope.FacetQueryStringParamName)>-1&&(u=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.FacetQueryStringParamName,u));u.indexOf(n.layoutLeftNavigationScope.DiscountQueryStringParamName)>-1&&(u=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.DiscountQueryStringParamName,u));u.indexOf(n.layoutLeftNavigationScope.PriceQueryStringParamName)>-1&&(u=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.PriceQueryStringParamName,u));u.indexOf(n.layoutLeftNavigationScope.RatingsQueryStringParamName)>-1&&(u=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.RatingsQueryStringParamName,u));u.indexOf(n.layoutLeftNavigationScope.SortByQueryStringParamName)>-1&&(u=n.layoutLeftNavigationScope.RemoveQueryStringParameterByName(n.layoutLeftNavigationScope.SortByQueryStringParamName,u));a=r.IsFalseCategory||v?4:3;this.updateUrl(a,f,i,r,h,u);h&&(n.layoutLeftNavigationScope.SubCategoryId=f.Id);this.$scope.SafeApply();this.$rootScope.$broadcast("breadcrumbsScope.UpdateBreadcrumbs",a,f.Caption,f.Url);this.$rootScope.$broadcast("productListScope.UpdateSelectedCategory",n.layoutLeftNavigationScope.TopLevelCategoryName,f,i,r,h)},i.prototype.updateUrl=function(t,r,u,f,e,o){var w=u?u.Id:f.Id,y={Index:undefined,SelectedDiscountRange:undefined,SelectedFacetIds:undefined,SelectedPriceRange:undefined,SelectedRatings:undefined,Data:{ParentLinkId:w},category:r,setSubCategory:e},c,p,h,a;if(this.historyService.IsPushStateSupported&&!this.$scope.SkipPushState)if(t<4||this.$scope.DeptType!==n.DeptType.Brand)c=r.Url+o,p=this.$scope.LanguageCode=="es"&&c.indexOf("/es")===-1?"/es"+c:c,this.historyService.PushState(i.HistoryStateKey,y,"",p);else{var v=r.Url.replace(/^\//i,"").replace(/\/$/,"").split("/"),l=v[v.length-1],s=document.location.pathname.replace(/^\//i,"").replace(/\/$/,"").split("/");for(this.$scope.LanguageCode=="en"?s.length==4?s[3]=l:s.push(l):s.length==5?s[4]=l:s.push(l),h="/",a=0;a<s.length;a++)h+=s[a]+"/";h+=o;this.historyService.PushState(i.HistoryStateKey,y,h);v[0]!="es"?($("#TopUtilityBarSection li a[hreflang=en]").attr("href",h),$("#TopUtilityBarSection li a[hreflang=es]").attr("href","/es"+h)):($("#TopUtilityBarSection li a[hreflang=en]").attr("href",h.replace("/es/","/")),$("#TopUtilityBarSection li a[hreflang=es]").attr("href",h))}},i.prototype.getCurrentPageState=function(t,i){var u,r;return t===undefined&&(t=n.layoutLeftNavigationScope.PriceRangeDeepLink?n.layoutLeftNavigationScope.PriceRangeDeepLink:n.layoutLeftNavigationScope.PriceRangeFacetSelected),i===undefined&&(i=n.layoutLeftNavigationScope.DiscountRangeDeepLink?n.layoutLeftNavigationScope.DiscountRangeDeepLink:n.layoutLeftNavigationScope.DiscountRangeFacetSelected),n.layoutLeftNavigationScope.PageState||(n.layoutLeftNavigationScope.PageState=[]),this.getSelectedFacetIds(),r=this.getSelectedMenuItem(AVON.SelectedCategoryId),r&&(u={Id:r.Id,Caption:r.Caption,Url:r.Url}),{category:u,Data:undefined,setSubCategory:undefined,Index:n.layoutLeftNavigationScope.StateIndex++,SelectedFacetIds:n.layoutLeftNavigationScope.SelectedFacetIds,SelectedRatings:n.layoutLeftNavigationScope.Ratings,SelectedPriceRange:{PriceRangeFacetSelected:t,Minimum:n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue,Maximum:n.layoutLeftNavigationScope.priceRangeModel.maximumDisplayValue,Floor:n.layoutLeftNavigationScope.priceRangeModel.floor,Ceil:n.layoutLeftNavigationScope.priceRangeModel.ceil},SelectedDiscountRange:{DiscountRangeFacetSelected:i,Minimum:n.layoutLeftNavigationScope.discountLevelModel.minimum,Maximum:n.layoutLeftNavigationScope.discountLevelModel.maximum,Floor:n.layoutLeftNavigationScope.discountLevelModel.floor,Ceil:n.layoutLeftNavigationScope.discountLevelModel.ceil}}},i.prototype.getSelectedFacetIds=function(){n.layoutLeftNavigationScope.SelectedFacetIds=[];_.each(AvonModule.AvonScope.LeftNavigationSelectedFacets,function(t){t.Facets.map(function(t){n.layoutLeftNavigationScope.SelectedFacetIds.push(t.Id)})});n.layoutLeftNavigationScope.SelectedFacetIds=n.layoutLeftNavigationScope.SelectedFacetIds.concat(AvonModule.AvonScope.LeftNavigationSelectedDepartmentFacets)},i.prototype.compareWithDeepLinkPageState=function(t){var i=!1;return n.layoutLeftNavigationScope.DeepLinkPageState&&(t?(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===t.SelectedFacetIds.sort().join(","),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedRatings.sort().join(",")===t.SelectedRatings.sort().join(",")),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedSortByValue===t.SelectedSortByValue),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Minimum===t.SelectedPriceRange.Minimum&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Maximum===t.SelectedPriceRange.Maximum),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Minimum===t.SelectedDiscountRange.Minimum&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Maximum===t.SelectedDiscountRange.Maximum)):(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedFacetIds.sort().join(",")===n.layoutLeftNavigationScope.SelectedFacetIds.sort().join(","),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedRatings.sort().join(",")===n.layoutLeftNavigationScope.Ratings.sort().join(",")),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedSortByValue===n.layoutLeftNavigationScope.SelectedSortByValue),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Minimum===n.layoutLeftNavigationScope.priceRangeModel.minimumDisplayValue&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedPriceRange.Maximum===n.layoutLeftNavigationScope.priceRangeModel.maximum),i&&(i=n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Minimum===n.layoutLeftNavigationScope.discountLevelModel.minimum&&n.layoutLeftNavigationScope.DeepLinkPageState.SelectedDiscountRange.Maximum===n.layoutLeftNavigationScope.discountLevelModel.maximum))),i},i.prototype.pageStateIsUnchanged=function(t){return t?this.compareWithDeepLinkPageState(t):n.layoutLeftNavigationScope.DeepLinkPageState?this.compareWithDeepLinkPageState(t):n.layoutLeftNavigationScope.SelectedFacetIds.length===0&&n.layoutLeftNavigationScope.Ratings.length===0&&n.layoutLeftNavigationScope.SelectedSortByValue===SortOption.None&&!n.layoutLeftNavigationScope.PriceRangeFacetSelected&&!n.layoutLeftNavigationScope.DiscountRangeFacetSelected},i.$inject=["$scope","$rootScope","$sce","$filter","analyticsService","historyService"],i.HistoryStateKey="LayoutLeftNavigationFacets",i}(NavigationModule.BaseNavigationController);n.LayoutLeftNavigationController=t}(LayoutLeftNavigationModule||(LayoutLeftNavigationModule={}));app.controller("LayoutLeftNavigationController",LayoutLeftNavigationModule.LayoutLeftNavigationController),function(n){var t=function(n){function t(i,r){var u=this;n.call(this,i);this.$scope=i;i.TopMenuHoverIndex=null;i.TopMenuLoaded={};i.CategoryMenuLoaded={};i.OnMenuFocusOut=function(n){n&&n.target&&n.target.nodeName=="AREA"||_.defer(function(){var n=document.activeElement;n&&!angular.element(".navTable")[0].contains(n)&&u.$scope.SafeApply(function(){i.TopMenuHoverIndex=null})})};i.TopMenuFocus=function(n){u.setTopMenuLoaded(n)};i.TopMenuMouseEnter=function(n){u.hoverTimer=setTimeout(function(){i.SafeApply(function(){u.setTopMenuLoaded(n)})},t.hoverDelay)};i.TopMenuMouseLeave=function(){clearTimeout(u.hoverTimer);u.hoverTimer=setTimeout(function(){i.SafeApply(function(){i.TopMenuHoverIndex=null})},t.hoverDelay)};i.CategoryMenuItemOnFocus=function(n){var t=angular.element(n.currentTarget).parent("li")[0];u.activateLevel3Menu(t)};i.SessionService.WhenReady().then(function(){i.IsIPad&&$(".topMenu > a").css("font-size","1.6rem")});i.Level2ContainerMouseLeave=function(n){$(n.currentTarget).hasClass("miniMenu")&&(i.MiniMenuActiveItemIndex=null)};i.GoToPage=function(n,t){t===void 0&&(t="_self");n&&r.open(n,t)};i.NavigationRowTapped=function(n,t){var r=$(n.target),f,e;navigator.userAgent.match(/iPad/i)!=null&&$(".miniMenuList").css("min-height","450px");switch(n.pointerType){case"touch":r.hasClass("miniMenuLink")&&(i.MiniMenuActiveItemIndex==t?(f=$(n.target),u.processLink(f),n.preventDefault(),n.srcEvent.stopImmediatePropagation()):u.activateLevel3Menu(r.parent()[0]));break;case"mouse":e=r.prop("tagName");u.processMenuLinks(n.srcEvent,r,e,i.isTouchCapableDevice);break;default:n.preventDefault();n.srcEvent.stopImmediatePropagation()}};i.NavigationRowDoubleTapped=function(n){var t=$(n.target);i.IsLeavingFundraiserPageWithoutShopping()&&t.is("a.topMenuLink")||t.is("a.miniMenuLink")||u.processLink(t);n.preventDefault();n.srcEvent.stopImmediatePropagation()};i.NavigationRowClicked=function(n){var t=$(n.target),r,f;if(i.isTouchCapableDevice){if(t.hasClass("miniMenuLink")||t.hasClass("topMenuLink")){n.preventDefault();n.stopImmediatePropagation();return}}else{if(r=t.prop("tagName"),f=t.prop("href"),f==="#"||t.hasClass("isEmptyLink")){n.preventDefault();n.stopImmediatePropagation();return}if(r==="SPAN"&&t.parents(".header-sections-footer-container"))return;n.type==="click"&&u.processMenuLinks(n,t,r,i.isTouchCapableDevice)}};this.setUpMenuAimPlugin();this.displayBackToTopOnScroll()}return __extends(t,n),t.prototype.setTopMenuLoaded=function(n){this.$scope.TopMenuLoaded[n]=!0;this.$scope.TopMenuHoverIndex=n},t.prototype.displayBackToTopOnScroll=function(){var n="#BackToTopContainer";$(window).scroll(function(){$(window).scrollTop()>=1200?$(n).addClass("Active"):$(n).removeClass("Active")})},t.prototype.setUpMenuAimPlugin=function(){var n=this;$(".level2Container").menuAim({rowSelector:"> .level2Menu > .miniMenuList > li",rowsContainerSelector:"> .level2Menu > .miniMenuList",activate:function(t){n.activateLevel3Menu(t)},deactivate:function(t){n.deactivateLevel3Menu(t)},exitMenu:this.exitLevel3Menu})},t.prototype.activateLevel3Menu=function(n){var i=this,t;_.delay(function(){var t=$(n).find(".level3Menu"),i=t.height();$(".level2Menu").css("height",i+"px")},250);t=$(".miniMenuList > li").index(n);this.$scope.SafeApply(function(){i.$scope.CategoryMenuLoaded[t]=!0;i.$scope.MiniMenuActiveItemIndex=t})},t.prototype.deactivateLevel3Menu=function(){var n=this;this.$scope.SafeApply(function(){n.$scope.MiniMenuActiveItemIndex=null})},t.prototype.exitLevel3Menu=function(){return!0},t.prototype.processLink=function(n){var t=n.prop("href"),i=n.prop("target");_.isUndefined(t)||_.isUndefined(i)||(i=="_self"?window.location=t:window.open(t,i))},t.prototype.processMenuLinks=function(n,t,i,r){var u;if(n.preventDefault(),i==="A"){this.processLink(t);return}if(i==="I"){u=t.parent("a");u&&(r&&!u.hasClass("lastNavItem")&&this.processLink(u),r||this.processLink(u));return}if(i==="IMG"){u=t.parentsUntil(".ContentStack").closest("a");u&&this.processLink(u);return}if(t.hasClass("PinkLink")){u=t.closest("a");u&&this.processLink(u);return}if(!r){(t.hasClass("miniMenuLink")||t.hasClass("topMenuLink"))&&this.processLink(t);return}},t.$inject=["$scope","$window"],t.hoverDelay=100,t}(BaseAngularController);n.LayoutTopNavigationController=t}(LayoutTopNavigationModule||(LayoutTopNavigationModule={}));app.controller("LayoutTopNavigationController",LayoutTopNavigationModule.LayoutTopNavigationController),function(n){"use strict";var t=function(t){function i(i,r,u,f,e){t.call(this,i,u);n.layoutTopUtilityScope=i;var o=$("#TopUtilityBarContainer"),s=$("#HeadLogoSection");$("#BannerSection").length===0&&(o.css("top",0),s.css("top",0));n.layoutTopUtilityScope.SessionService.WhenReady().then(function(){n.layoutTopUtilityScope.ShowRepCouponIndicator=function(){return n.layoutTopUtilityScope.Session.RepCoupons.length>0}});n.layoutTopUtilityScope.OnCustomerMenuEnter=function(n){var i=angular.element(n.currentTarget);i.parent().children("div").addClass("active");$(".RotatedCaret45.active").css({"margin-left":$(".TopAccountBarUserOverlay").parent().outerWidth(!1)/2-$(".RotatedCaret45.active").width()/2});$(".TopAccountBarUserOverlay").innerWidth($(".TopAccountBarUserOverlay").parent().width());var r=$("#TopUtilityBarContainer").offset().left+$("#TopUtilityBarContainer").innerWidth(),u=$(".Overlay.active").offset().left+$(".Overlay.active").innerWidth(),t=u-r;t>0&&!$(".Overlay.active").attr("style")&&$(".Overlay.active").css({"margin-left":-t})};n.layoutTopUtilityScope.OnCustomerMenuLeave=function(){$("#TopUtilityBarSection .active").removeClass("active")};n.layoutTopUtilityScope.OnRepMenuLeave=function(){$("#TopUtilityBarSection .active").removeClass("active")};n.layoutTopUtilityScope.PrepareAndShowLoginModal=function(){angular.element("#ViewBagPage").length&&(AVON.TempModalModel={Mode:"FullRegistration"});angular.element("#FullRegistrationForm").length&&(AVON.TempModalModel={Mode:"HideCreateAccount"});AVON.RedirectToPowerReviews=!1;f.ShowLoginModal()};n.layoutTopUtilityScope.LoginModal=function(){if(typeof FB=="undefined"){n.layoutTopUtilityScope.PrepareAndShowLoginModal();return}FB.getLoginStatus(function(){n.layoutTopUtilityScope.PrepareAndShowLoginModal()},!0)};n.layoutTopUtilityScope.ShoppingCartClick=function(){n.layoutTopUtilityScope.SessionReady&&(n.layoutTopUtilityScope.ShowLoading(AVON.messages.spinner_loading),n.layoutTopUtilityScope.RedirectToUrl(n.layoutTopUtilityScope.Url.Action("Index","Bag")))};n.layoutTopUtilityScope.LogOut=function(){r.logOut("/",n.layoutTopUtilityScope.HomePageUrl)};n.layoutTopUtilityScope.GoToWishListPage=function(t){t.preventDefault();n.layoutTopUtilityScope.Session.Customer&&n.layoutTopUtilityScope.Session.Customer.IsLoggedIn?u.location.href=i.Url.Action("index","wishlist"):f.ShowLoginModal("wishlist",n.layoutTopUtilityScope.Url.Action("index","wishlist"))};n.layoutTopUtilityScope.OpenRepCouponModal=function(){e.DisplayRepCouponModel()}}return __extends(i,t),i.$inject=["$scope","loginService","$window","loginModalService","bagService"],i}(BaseAngularController);n.LayoutTopUtilityController=t}(LayoutTopUtilityModule||(LayoutTopUtilityModule={}));app.controller("LayoutTopUtilityController",LayoutTopUtilityModule.LayoutTopUtilityController),function(n){var t=function(n){function t(t,i,r,u,f,e){function c(){var n=AvonModule.AvonScope.QueryString().email;n&&(t.LoginModel.Email=n)}function h(){t.LoginModel=AVON.LoginModel;t.LoginModel={Email:"",Password:"",Mode:"",ReturnUrl:""};t.displayProperties=t.displayProperties||{showForgotPasswordForm:!1};_.defer(function(){t.UpdateInlineWaterMark()},200);t.ShowValidation=!1;t.RequiredInvalid=!1;t.hasItemsInCart=t.Session.Cart?t.Session.Cart.QtyItemsInCart>0:!1;c()}var o=this,s;n.call(this,t);new h;this.LoginModalMode=$("input#Mode").val();angular.element("#FullRegistrationForm").length&&(t.HideCreateAccountOption=!0);r.displayForgotPassword&&(s=r.forgotEmail,t.displayProperties.showForgotPasswordForm=!0,_.defer(function(){angular.element("[id=forgotPasswordModel_EmailInput]").val(s)},200),r.displayForgotPassword=!1,r.forgotEmail="");t.privacyUrl=$("#privacyPolicyUrl").val();t.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();t.privacyPolicyModalModel=AVON.privacyPolicyModalModel||{NotifySpecialOffers:!0};t.firstTimeFacebookUser=AVON.firstTimeFacebookUser||{AccessToken:"",FacebookId:"0",CustomerEmail:"",Password:""};AVON.TempModalModel&&AVON.TempModalModel.Mode==="HideCreateAccount"&&(t.HideCreateAccountOption=!0);$(document).on("click","#DisplayRegistrationModal",function(n){var i,r;n.preventDefault();i="";AVON.TempModalModel!==undefined&&(i=AVON.TempModalModel.Email);$("#LoginModal").trigger("close");t.ShowLoading(AVON.messages.spinner_loading);t.IsShoppingBagPage()?t.RedirectToUrl(t.Url.Action("RegistrationFullPage","Checkout")):(r={UrlToLoad:"/login/registrationoverlay",AllowExit:!0,KeepLoaded:!1,Model:{Email:i}},$("#RegistrationModal").trigger("modal",r))});t.Login=function(){if(t.$broadcast("autofill:update"),t.LoginForm.$valid){AVON.TempModalModel?AVON.TempModalModel.Email=t.LoginModel.Email:AVON.TempModalModel={Email:t.LoginModel.Email};t.ShowValidation=!1;t.ShowLoading(AVON.messages.spinner_login);var n=$("#LoginModal").find("input#ReturnUrl").val();t.LoginModel.ReturnUrl=n;r.login(t.LoginModel,$("form[name=LoginForm]"),t)}else t.LoginForm.ServerErrors.Summary===undefined||t.ShowValidation||(t.LoginForm.ServerErrors.Summary.$invalid=!1),t.ShowValidation=!0,ForgotPasswordModule.forgotPasswordscope&&(ForgotPasswordModule.forgotPasswordscope.ShowValidation=!1)};t.CreateNewAccountModal=function(n){n.preventDefault();t.ShowLoading(AVON.messages.spinner_loading);$("#LoginModal").trigger("close");t.UpdateCustomerType(CustomerType.Unknown);$("#RegistrationModal").trigger("modal");i.$broadcast("RegistrationScope.UpdateCustomerSettings")};t.UpdatePrivacyPolicy=function(){var i=AVON.TempModalModel.FacebookAccessToken,u=t.UpdatePrivacyPolicyForm.privacyPolicyModalModel_NotifySpecialOffers.$viewValue,n;t.UpdatePrivacyPolicyForm.$valid?(t.ShowValidation=!1,$("#AjaxModal").trigger("close"),n=$("#ReturnUrl").val(),t.ShowLoading(AVON.messages.spinner_login),r.registerWithFacebook(i,u,n)):t.ShowValidation=!0};t.FacebookLogin=function(){t.ShowLoading(AVON.messages.spinner_facebook);$("html.ff").length===0?FB.login(t.FacebookLoginCallback,{scope:"email"}):_.delay(function(){typeof FB=="undefined"?(alert("Woops! To login with facebook in incognito mode please disable Tracking Protection and refresh the page."),t.HideLoading()):FB.login(t.FacebookLoginCallback,{scope:"email"})},100)};t.FacebookLoginCallback=function(n){if(n.authResponse){var i=$("#ReturnUrl").val();t.HideLoading();t.ShowLoading(AVON.messages.spinner_login);r.loginWIthFacebook(n.authResponse.accessToken,"",i)}else t.HideLoading()};t.FirstTimeFacebookUserLogin=function(){if(t.FirstTimeFacebookUserPasswordForm.$valid){var n=t.FirstTimeFacebookUserPasswordForm.firstTimeFacebookUser_Password.$modelValue,i=$("[name=firstTimeFacebookUser_Password]").attr("accesstoken"),u=$("#ReturnUrl").val();t.ShowLoading(AVON.messages.spinner_login);r.loginWIthFacebook(i,n,u)}else t.ShowValidation=!0,t.FirstTimeFacebookUserPasswordForm.firstTimeFacebookUser_Password.$error.regex=!1,$("#PasswordError").show()};t.ViewPrivacyPolicy=function(){window.open(t.privacyUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};t.ViewConditionsOfUse=function(){window.open(t.conditionsOfUseUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};t.GetSignInAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-signin-btn";break;default:n="login-signin-btn"}return n};t.GetForgotPasswordAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-frgtpw-lnk";break;default:n="login-frgtpw-lnk"}return n};t.GetCheckoutAsGuestAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-gst-btn";break;default:n=""}return n};t.GetSignInWithFacebookAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-fb-btn";break;default:n="login-fb-btn"}return n};t.GetSendPasswordHintAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-sndhntpw-btn";break;default:n="login-sndhntpw-btn"}return n};t.GetSendNewPasswordAnalyticsAttribute=function(){var n;switch(o.LoginModalMode){case"Checkout":n="chckt-rstpw-btn";break;default:n="login-rstpw-btn"}return n};t.$on("ModalClosed",function(){new h;i.$broadcast("RegistrationScope.RegistrationValidation")});t.$on("LoginService.LoginResponse",function(n,i,r){ForgotPasswordModule.forgotPasswordscope&&(ForgotPasswordModule.forgotPasswordscope.ShowValidation=!1);i.ErrorCode===AjaxError.ValidationErrors?r==t&&(t.HideLoading(),t.ShowValidation=!0,t.ProcessAjaxValidationErrors(i),_.defer(function(){$.each(i.ValidationErrors,function(n,i){t.LoginForm[i.FieldName]!==undefined&&(t.LoginForm[i.FieldName].$invalid=!0);var u=$(".ErrorSummaryContainer .ValidationSummaryServer span a");e(u)(r)})})):(f.TrackEventItem({Type:TrackingEventType.LoginSuccessful}),i.OpenModalId||i.IdToReplace?$("#LoginModal").trigger("close"):AVON.RedirectToPowerReviews&&AVON.PowerReviewLink?(i.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AVON.common.redirectTo(AVON.PowerReviewLink)},250)):setInterval(function(){AvonModule.AvonScope.isLoading=!0;AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_login)},500))});t.$on("LoginService.AutoLoginResponse",function(n,t){t.ErrorCode===AjaxError.None&&(f.TrackEventItem({Type:TrackingEventType.LoginSuccessful}),AVON.RedirectToPowerReviews&&(t.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading)},250)))});t.$on("LoginService.FacebookLoginResponse",function(n,i){t.HideLoading();$("#LoginModal").trigger("close");i.status===200&&i.data.Data===""?($("#FirstTimeFacebookUserModal").trigger("close"),f.TrackEventItem({Type:TrackingEventType.LoginSuccessful}),AVON.RedirectToPowerReviews&&AVON.PowerReviewLink?(i.data.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AVON.common.redirectTo(AVON.PowerReviewLink)},250)):i.data.RedirectUrl&&top.location.replace(i.data.RedirectUrl)):i.data.Data===2&&$("#PasswordError").show()});t.$on("LoginService.FacebookRegisterResponse",function(n,t){if(t.status===200){if(t.data.Data.ErrorMessage==="emailrequired"){$("#FacebookRegisterModalError").trigger("modal");return}f.TrackEventItem({Type:TrackingEventType.LoginSuccessful});AVON.RedirectToPowerReviews&&AVON.PowerReviewLink&&(t.data.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading);AVON.common.redirectTo(AVON.PowerReviewLink)},250))}});t.onKeyPress=function(n){n.which===KeyCode.Enter&&(n.preventDefault(),t.Login())}}return __extends(t,n),t.$inject=["$scope","$rootScope","loginService","$http","trackingService","$compile"],t}(BaseAngularController);n.LoginCtrl=t}(LoginModule||(LoginModule={}));app.controller("LoginController",LoginModule.LoginCtrl),function(n){var t=function(t){function i(i,r){var u=this;t.call(this,i);n.looksWeLoveScope=i;n.looksWeLoveScope.ShowLooksWeLoveOverlay=function(t){if(!n.looksWeLoveScope.IsTouchDevice()){var i=angular.element(t.currentTarget),r=i.attr("id");n.looksWeLoveScope.ShowLooksWeLoveImageId=r}};n.looksWeLoveScope.HideLooksWeLoveOverlay=function(){n.looksWeLoveScope.IsTouchDevice()||(n.looksWeLoveScope.ShowLooksWeLoveImageId=n.looksWeLoveScope.CurrentShowLooksWeLoveImageId)};n.looksWeLoveScope.ShowLooksWeLoveImageContentClick=function(n){u.ShowLooksWeLoveImageContent(n)};n.looksWeLoveScope.$on("ProductService.ProductsLoaded",function(){if(r.find(window.location.hash).length>0&&(n.looksWeLoveScope.LoadOperationsCount+=1,n.looksWeLoveScope.LoadOperationsCount>=2)){var t=$(window.location.hash)[0].id;n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+t;n.looksWeLoveScope.ShowLooksWeLoveImageId=t;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId;_.delay(function(){n.looksWeLoveScope.ScrollToTop(r,!1)},1e3)}});n.looksWeLoveScope.$on("ProductService.PromotionsLoaded",function(){if(r.find(window.location.hash).length>0&&(n.looksWeLoveScope.LoadOperationsCount+=1,n.looksWeLoveScope.LoadOperationsCount>=2)){var t=$(window.location.hash)[0].id;n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+t;n.looksWeLoveScope.ShowLooksWeLoveImageId=t;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId;_.delay(function(){n.looksWeLoveScope.ScrollToTop(r,!1)},1e3)}});_.defer(function(){n.looksWeLoveScope.ShowLooksWeLoveImageId=r.find(".ImageRowWrapper > div")[0].id;n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+n.looksWeLoveScope.ShowLooksWeLoveImageId;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId})}return __extends(i,t),i.prototype.ShowLooksWeLoveImageContent=function(t){var r=angular.element(t.currentTarget),i=r.attr("id");n.looksWeLoveScope.ShowLooksWeLoveImageContentId="Content-"+i;n.looksWeLoveScope.ShowLooksWeLoveImageId=i;n.looksWeLoveScope.CurrentShowLooksWeLoveImageId=n.looksWeLoveScope.ShowLooksWeLoveImageId},i.$inject=["$scope","$element"],i}(BaseAngularController);n.LooksWeLoveController=t}(LooksWeLoveModule||(LooksWeLoveModule={}));app.controller("LooksWeLoveController",LooksWeLoveModule.LooksWeLoveController),function(n){"use strict";var t=function(n){function t(t,i){n.call(this,t);t.LpmMenuOpen=!1;t.Options=[];t.SessionService.WhenReady().then(function(n){t.CampaignNumber=n.Customer.Campaign;t.PreviewAtDate=n.LpmPreview.PreviewAtDate;t.SafeApply(function(){t.ShowLpmEditModuleButtons.Show=n.ShowEditLpmModuleButtons})});t.GetActiveCampaigns=function(){i.GetActiveCampaigns()};t.GetActiveLookup=function(){i.GetActiveLookup()};t.GetEnvironmentInfo=function(){i.GetEnvironmentInfo()};t.ShowLpmEditModuleButtonCheckboxClick=function(){t.ShowLpmEditModuleButtons.Show=!t.ShowLpmEditModuleButtons.Show;i.SetShowEditLpmModuleButtons(t.ShowLpmEditModuleButtons.Show)};t.GetActiveCampaigns();t.GetActiveLookup();t.GetEnvironmentInfo();t.UpdateCampaign=function(){t.ShowLoading(AVON.messages.spinner_processing);var n=document.location.pathname+document.location.search;i.SetCampaign(t.CampaignNumber,n)};t.GetPreviewByDate=function(){var n=t.PreviewAtDate,i="/content/togglepreview/true/previewatdate/"+n;t.RedirectToUrl(i)};t.UpdateCampaignAndPreviewDate=function(){t.ShowLoading(AVON.messages.spinner_processing);i.SetCampaign(t.CampaignNumber,null);_.delay(function(){if(t.ShowLoading(AVON.messages.spinner_processing),t.PreviewAtDate!=""){var n=t.PreviewAtDate,i="/content/togglepreview/true/previewatdate/"+n;t.RedirectToUrl(i)}else window.location.reload(!0)},500)};t.$on("LpmContextMenuService.ActiveCampaignsReceived",function(n,i){var r=i.Data;_.each(r,function(n){t.Options.push({text:n.CampaignNumber,value:n.CampaignNumber})})});t.$on("LpmContextMenuService.ActiveLookupReceived",function(n,i){var r=i.Data;t.Lookup=r});t.$on("LpmContextMenuService.EnvironmentInfoReceived",function(n,i){var r=i.Data;t.Environment=r.Environment.toTitleCase();t.BuildVersion=r.BuildVersion});t.LpmMenuSlide=function(){return(t.LpmMenuOpen=!t.LpmMenuOpen)?t.OpenLpmMenu():t.CloseLpmMenu()};t.OpenLpmMenu=function(){t.LpmMenuOpen=!0;angular.element("#LpmMenuContainer").animate({top:0},"slow");angular.element("#LpmContextMenu").css("visibility","visible")};t.CloseLpmMenu=function(){t.LpmMenuOpen=!1;angular.element("#LpmMenuContainer").animate({top:-$("#LpmContextMenu").outerHeight()},"slow",function(){angular.element("#LpmContextMenu").css("visibility","hidden")});angular.element("#LpmContextMenu").css("visibility","visible")};$(document).ready(function(){$("#LpmMenuContainer").css({top:-$("#LpmContextMenu").outerHeight()})});t.ShowContextMenu=!0;t.$on("BannerController.BannerExpand",function(){t.ShowContextMenu=!0});t.$on("BannerController.BannerCollapse",function(){$("#LpmMenuContainer").css({top:-$("#LpmContextMenu").outerHeight()});t.ShowContextMenu=!1;t.LpmMenuOpen=!1})}return __extends(t,n),t.$inject=["$scope","LpmContextMenuService"],t}(BaseAngularController);n.LpmContextMenuController=t}(LpmContextMenuModule||(LpmContextMenuModule={}));app.controller("LpmContextMenuController",LpmContextMenuModule.LpmContextMenuController),function(n){"use strict";var t=function(t){function i(i){t.call(this,i);n.pageNavigatorScope=i;n.pageNavigatorScope.isActiveLink=!1;n.pageNavigatorScope.SetLinkActiveState=function(){n.pageNavigatorScope.isActiveLink=!0}}return __extends(i,t),i.$inject=["$scope"],i}(BaseAngularController);n.PageNavigatorModuleController=t}(PageNavigatorModule||(PageNavigatorModule={}));app.controller("PageNavigatorModuleController",PageNavigatorModule.PageNavigatorModuleController);$(document).ready(function(){location.hash?$("a[href$='"+location.hash+"']").addClass("active"):$("a[href='"+location.pathname+"']").addClass("active");$(".PageNavigatorModule #PageNavigator a").click(function(){$("#PageNavigator a").removeClass("active");$(this).addClass("active")})}),function(n){var t=function(n){function t(t,i,r,u){n.call(this,t);t.ContinueToPayPal=function(){u.TrackEventItem({Type:TrackingEventType.CartViewBagPayPalContinue})};t.CancelPayPal=function(){u.TrackEventItem({Type:TrackingEventType.CartViewBagPayPalCancel});$("#PayPalExpressModal").trigger("close")}}return __extends(t,n),t.$inject=["$scope","$rootScope","$http","trackingService"],t}(BaseAngularController);n.PayPalCtrl=t}(PayPalModule||(PayPalModule={}));app.controller("PayPalController",PayPalModule.PayPalCtrl),function(n){var t=function(t){function i(i){t.call(this,i);n.productCarouselScope=i;n.productCarouselScope.starRange=_.range(5);n.productCarouselScope.products=AVON.productCarouselProducts;n.productCarouselScope.MaxProductNameAllowed=55;n.productCarouselScope.GetFilledStars=function(n){return{width:n*20-3+"%"}};n.productCarouselScope.GetProductName=function(t){return t.length>n.productCarouselScope.MaxProductNameAllowed?t.substring(0,n.productCarouselScope.MaxProductNameAllowed)+"<span>...<\/span>":t}}return __extends(i,t),i.$inject=["$scope"],i}(BaseAngularController);n.ProductCarouselController=t}(ProductCarouselModule||(ProductCarouselModule={}));app.controller("ProductCarouselController",ProductCarouselModule.ProductCarouselController),function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a){var y=this,v,g,w,b,nt,tt,k,d,p;n.call(this,t,e);this.$scope=t;this.bagService=i;this.trackingService=f;this.wishListService=o;this.facebookService=s;this.urlService=l;this.historyService=a;this.IsBagPage=!1;this.tempHackSelectVariantInDropDown=function(n){var t="$('#dd"+n+"').val('"+n+"')";setTimeout(t,0)};v=t;v.starRange=_.range(5);v.product=AVON.product;v.IngredientsContentsOriginal=v.SecureHtml(this.formatIngredients(AVON.product.Ingredients));v.productIngredientsFormatted=v.IngredientsContentsOriginal;v.product.Description=v.SecureHtml(v.product.Description);v.DescriptionContentsOriginal=v.product.Description;v.TempShoppingBag=[];v.NotifyMeShadeItem=null;v.products=AVON.productList;v.DisplayProductReviews=!1;v.IsVariantAvailbleSoonMessage=!1;v.AddToBagClientSideValidationError=!1;v.ZeroQuantityClientSideValidationError=!1;v.ImagesIndexLoaded=[];g=v.product.Availability!==CanBuy.NotForIndividualSale&&v.product.Availability!==CanBuy.AvailableSoon&&v.product.Availability!==CanBuy.NotAvailableOnTheOnlineStore&&v.product.PriceModel.AutoReplenishmentPrice>0;v.AutoReplenishmentOptionModel=window.location.search.toLowerCase().indexOf("arsub=1")>0&&g||v.product.Availability==CanBuy.AutoReplenishmentOnly?"AutoReplenishment":"OneTime";t.ViewModel={AutoReplenishmentFrequency:0};v.HasProductSubscriptionForAutoReplenishment=!1;v.AutoReplenishmentButton=0;v.ProductHasAutoReplenishmentPurchaseOption=!1;v.AutoReplenishmentVariantSubscriptions=[];v.AutoReplenishmentFrequencyList=[];v.FrequencySelectError=!1;v.IsAutoReplenishmentProductJustAdded=!1;this.IsBagPage=AVON.IsBagPage;this.selectedVariantWithImage=null;t.HoveredVariantWithImage=null;v.DigitalCatalogReferrer=AVON.TempModalModel!=null?AVON.TempModalModel.DigitalCatalogReferrer:v.SelectedDigitalCatalogFromQuerystring;this.trackingService.UTagData.digital_catalog=v.DigitalCatalogReferrer;v.DigitalCatalogUrl=AVON.TempModalModel!=null?AVON.TempModalModel.DigitalCatalogUrl:v.DigitalCatalogUrlFromQuerystring;v.GetProductUrl=function(n){return v.DigitalCatalogUrl&&v.DigitalCatalogUrl!=="undefined"&&(n+=(n.indexOf("?")<0?"?":"&")+v.DigitalCatalogUrl),v.DigitalCatalogReferrer&&v.DigitalCatalogReferrer!=="undefined"&&(n+=(n.indexOf("?")<0?"?":"&")+("dc_ref="+v.DigitalCatalogReferrer)),n};v.EnsureTempBagHasEmptyItem=function(){if(v.TempShoppingBag.length>0){var n=v.TempShoppingBag[v.TempShoppingBag.length-1];(n.selectedValue!==""||n.variant!=null)&&v.TempShoppingBag.push(y.getNewBagItem(v.DigitalCatalogReferrer))}else v.TempShoppingBag.push(y.getNewBagItem(v.DigitalCatalogReferrer))};v.$on(ModalDirectiveModule.ModalDirective.ModalClosedBroadcastName,function(n,t){t==="QuickView"&&v.IsQuickShopModalOpen&&(v.$$listeners=[])});this.facebookService.reDrawAllIcons();v.AddingVariant=!0;this.lastShadeQtyUpdatedViaSwatchClick=null;v.TrackProductViewEvent=function(){$("#QuickView").children().length>0?y.trackingService.TrackEventItem({Type:TrackingEventType.QuickShopProductView}):y.trackingService.TrackProductViewEvent()};v.SessionService.WhenReady().then(function(){if(v.TrackProductViewEvent(),v.ProductHasAutoReplenishmentPurchaseOption=v.product.PriceModel.AutoReplenishmentPrice>0,v.AutoReplenishmentFrequencyList=v.product.AutoReplenishmentFrequencyList,v.AutoReplenishmentFrequencyList&&v.AutoReplenishmentFrequencyList.length>0&&(v.ViewModel.AutoReplenishmentFrequency=v.AutoReplenishmentFrequencyList[0]),$.each(v.product.VariantGroups,function(n,t){$.each(t.Variants,function(n,t){h.IsSubscribedToProductWithSku(t.Sku)&&v.AutoReplenishmentVariantSubscriptions.push(t.Sku)})}),v.AutoReplenishmentVariantSubscriptions.length>=1&&(v.HasProductSubscriptionForAutoReplenishment=!0,v.product.IsMultiVariantProduct||(v.AutoReplenishmentButton=1)),v.EnsureTempBagHasEmptyItem(),y.preSelectVariantBasedOnUrlParam(),app.GetQuerystringParameterByName("addToWishList")){t.Session.Customer.IsLoggedIn&&v.AddSelectedProductsToWishList(null,!1);var n=window.location.href;n=y.urlService.RemoveQueryStringParameterFromUrl(n,"addToWishList");n=y.urlService.RemoveQueryStringParameterFromUrl(n,"sku");a.ReplaceStateUrl(n)}});v.ScrollTo=function(n,t){t===void 0&&(t=!0);var i=0,r=$("#TopNavigationContainer");r&&!r.hasClass("FixedMenu")&&t&&(i=72);window.scrollTo(0,$("#"+n).offset().top-i)};v.HasAutoReplenishmentSubscription=function(n){var t=!1;return v.AutoReplenishmentOptionModel==="AutoReplenishment"&&n!==null&&n.hasOwnProperty("Sku")&&(t=h.IsSubscribedToProductWithSku(n.Sku)),v.CheckForAutoReplenishmentAlreadySubscribed(),t};v.HasAutoReplenishmentSingleVariantItemInBag=function(){var n=!1;return v.product.IsMultiVariantProduct&&(v.product.Availability!==CanBuy.AutoReplenishmentOnly||v.product.IsMultiVariantProduct)||$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(t,i){$.each(i.Items,function(t,i){i.Sku===v.product.VariantGroups[0].Variants[0].Sku&&i.AutoReplenishmentFrequency>0&&(n=!0)})}),n};v.HasAutoReplenishmentVariantItemInBag=function(n){var t=!1;return v.AutoReplenishmentOptionModel==="AutoReplenishment"&&n.hasOwnProperty("variant")&&n.variant!==null&&n.variant.hasOwnProperty("Sku")&&$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(i,r){$.each(r.Items,function(i,r){r.Sku===n.variant.Sku&&r.AutoReplenishmentFrequency>0&&(t=!0)})}),t};v.CheckForAutoReplenishmentAlreadySubscribed=function(){var n=[];n.length=0;$.each(v.TempShoppingBag,function(t,i){$.each(v.AutoReplenishmentVariantSubscriptions,function(t,r){i.hasOwnProperty("variant")&&i.variant!==null&&i.variant.hasOwnProperty("Sku")&&r===i.variant.Sku&&n.push(r)})});v.HasProductSubscriptionForAutoReplenishment=n.length!==0&&n.length===v.TempShoppingBag.length-1?!0:!1};w=$("#ContentModal");$("#ProductQuickShopContainer").addClass("Ready");$(".ClickToEnlarge").hide();b=$(".NotifyMeQuickShopForm").length?$("#QuickView").find(".Columns_2"):$(document).find(".Columns_2");v.IsQuickShopModalOpen&&(nt={Type:TrackingEventType.ProductImageView,Data:{imageIndexes:[0],profileNumber:v.product.ProfileNumber}},f.TrackEventItem(nt));v.ResetValidation=function(){v.AddToBagClientSideValidationError=!1;v.ZeroQuantityClientSideValidationError=!1;v.FrequencySelectError=!1;v.SafeApply();angular.element(".FormError").removeClass("FormError");angular.element(".QtyError").removeClass("QtyError")};_.defer(function(){b.find(".VariantSelect").off("select2-opening");b.find(".VariantSelect").on("select2-opening",function(){v.ResetValidation()})},200);_.defer(function(){t.$watch("products",function(){_.defer(function(){app.safeLoadImages($(".ProductSmallImageCarousel"))})},!0)});v.IsShadeSelected=function(n){return v.GetVariantFromTempShoppingBag(n.Sku)!=null};v.DisplayBothAutoReplenishmentAndNormalPurchaseOptions=function(n){return n!==CanBuy.AutoReplenishmentOnly&&n!==CanBuy.NotForIndividualSale&&n!==CanBuy.NoLongerAvailable&&n!==CanBuy.AvailableSoon&&n!==CanBuy.NotAvailableOnTheOnlineStore&&v.ProductHasAutoReplenishmentPurchaseOption};v.RemoveItemFromTempShoppingBag=function(n){var t=v.TempShoppingBag.indexOf(n);v.TempShoppingBag.splice(t,1);v.EnsureTempBagHasEmptyItem();v.CheckForAutoReplenishmentAlreadyAddedOrSubscribed();y.selectedVariantWithImage===n.variant&&y.revertAllToOriginalProductImage()};v.ShowAddToBag=function(){if(v.ConditionalProductCheck()&&(v.product.Availability=v.ConditionProductRemainingQuantityAllowedToBuy>0?1:5),v.product.Availability!==CanBuy.Available&&v.product.Availability!==CanBuy.AutoReplenishmentOnly)return!1;if(!v.product.IsMultiVariantProduct)return!0;var n=!1;return $.each(v.TempShoppingBag,function(t,i){if(i.variant==null||i.variant.Availability===CanBuy.Available)return n=!0,!1}),n};v.ShowNotifyMeButton=function(){return v.product.Availability===CanBuy.AvailableSoon?!0:!v.product.IsShadeVariant&&v.TempShoppingBag.length===1&&v.TempShoppingBag[0].variant!=null&&v.TempShoppingBag[0].variant.Availability===CanBuy.AvailableSoon?!0:!1};v.IsOptionDisabled=function(n){return n==null||n.Availability===CanBuy.Available||n.Availability===CanBuy.AvailableSoon||n.Availability===CanBuy.AutoReplenishmentOnly?!1:!0};v.GetVariantFromTempShoppingBag=function(n){var t=null;return $.each(v.TempShoppingBag,function(i,r){if(r.variant!=null&&r.variant.Sku===n)return t=r,!1}),t};tt=function(){var n,t;v.TempShoppingBag.length>0&&(n=v.TempShoppingBag[v.TempShoppingBag.length-1],n.selectedValue===""&&n.variant==null&&(t=v.TempShoppingBag.indexOf(n),v.TempShoppingBag.splice(t,1)))};v.ShadeChanged=function(n){var r,i;if(v.AddingVariant=!1,v.ResetValidation(),n.selectedValue.length===0){_.defer(function(){t.SafeApply(function(){return v.RemoveItemFromTempShoppingBag(n)})});return}for(r=v.TempShoppingBag.indexOf(n),n.variant=v.GetVariantFromProduct(n.selectedValue),i=0;i<v.TempShoppingBag.length-1;i++)if(v.TempShoppingBag[i].variant===n.variant&&i!==r){n.variant.Availability===CanBuy.Available&&(n.qty==null&&(n.qty=1),v.TempShoppingBag[i].qty=n.qty+Number(v.TempShoppingBag[i].qty));_.defer(function(){v.RemoveItemFromTempShoppingBag(n);t.SafeApply()});break}n.qty===1&&n.variant.Availability===CanBuy.Available&&(n.qty=1);v.AutoReplenishmentOptionModel==="AutoReplenishment"&&v.HasAutoReplenishmentSubscription(n.variant)&&(v.AddingVariant=!0);v.EnsureTempBagHasEmptyItem();v.CheckForAutoReplenishmentAlreadyAddedOrSubscribed();y.lastShadeQtyUpdatedViaSwatchClick=null;y.showSelectedVariantImage(n.variant);n.variant.HasProductImage&&t.BroadcastToElement(v,".ProductImageCarousel","Carousel_ShowSlide",0,!1)};v.NonShadeVariantChanged=function(){v.ResetValidation();var n=v.TempShoppingBag[0];if(n.selectedValue.length===0){n.qty=1;n.variant=null;return}n.variant=v.GetVariantFromProduct(n.selectedValue)};v.ShadeSwatchClicked=function(n){var i,u,r,f;v.ResetValidation();tt();i=v.GetVariantFromTempShoppingBag(n.Sku);u=!1;i==null?(n.Availability===CanBuy.Available||n.Availability===CanBuy.AvailableSoon||n.Availability===CanBuy.AutoReplenishmentOnly)&&(v.AddingVariant===!1&&v.TempShoppingBag.length>0?(r=v.TempShoppingBag.length-1,v.TempShoppingBag[r].selectedValue=n.Sku,v.TempShoppingBag[r].variant=n,v.TempShoppingBag[r].AutoReplenishmentFrequency=0,(n.Availability===CanBuy.Available||n.Availability===CanBuy.AutoReplenishmentOnly)&&(v.TempShoppingBag[r].qty=1)):(f={qty:1,selectedValue:n.Sku,variant:n,AutoReplenishmentFrequency:0,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1,AutoReplenishmentAutomaticallyAddedToBag:!1,DigitalCatalogReferrer:v.DigitalCatalogReferrer},v.TempShoppingBag.push(f)),u=!0,y.lastShadeQtyUpdatedViaSwatchClick=null):(i.variant.Availability===CanBuy.Available||i.variant.Availability===CanBuy.AutoReplenishmentOnly)&&(i.qty+=1,u=!0,y.lastShadeQtyUpdatedViaSwatchClick=i.variant);y.tempHackSelectVariantInDropDown(n.Sku);v.EnsureTempBagHasEmptyItem();v.CheckForAutoReplenishmentAlreadyAddedOrSubscribed();u&&(v.AddingVariant=v.AutoReplenishmentOptionModel==="AutoReplenishment"&&v.HasAutoReplenishmentSubscription(n)?!0:!1);y.showSelectedVariantImage(n);n.HasProductImage&&t.BroadcastToElement(v,".ProductImageCarousel","Carousel_ShowSlide",0,!1)};v.CheckForAutoReplenishmentAlreadyAddedOrSubscribed=function(){var t=[],n=[];return t.length=0,n.length=0,$.each(v.TempShoppingBag,function(n,i){$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(n,r){$.each(r.Items,function(n,r){i.variant!==null&&r.Sku===i.variant.Sku&&i.AutoReplenishmentFrequency>0&&t.push(r.Sku)})})}),$.each(v.TempShoppingBag,function(t,i){$.each(v.AutoReplenishmentVariantSubscriptions,function(t,r){i.hasOwnProperty("variant")&&i.variant!==null&&i.variant.hasOwnProperty("Sku")&&r===i.variant.Sku&&n.push(r)})}),t.length+n.length!==0&&t.length+n.length===v.TempShoppingBag.length-1?n.length!==0&&n.length===v.TempShoppingBag.length-1?(v.AutoReplenishmentButton=1,1):(v.AutoReplenishmentButton=2,2):(v.AutoReplenishmentButton=0,0)};v.ShowAlreadyAdded=function(){return v.AutoReplenishmentOptionModel==="AutoReplenishment"&&v.AutoReplenishmentButton==1&&v.product.IsMultiVariantProduct===!1?!1:v.product.AutoReplenishmentMultibuy===!1&&(v.HasAutoReplenishmentSingleVariantItemInBag()||v.AutoReplenishmentButton===2&&v.product.IsMultiVariantProduct===!1)};v.GetVariantFromProduct=function(n){var t=null;return $.each(v.product.VariantGroups,function(i,r){if(t!=null)return!1;$.each(r.Variants,function(i,r){if(r.Sku==n)return t=r,!1})}),t};k=function(n){var i="/product/notifymemodal?pfid="+v.product.Id.toString()+"&fsc="+n,t;v.ShowLoading(AVON.messages.spinner_loading);t={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:i};w.trigger("modal",t)};v.OpenNotifyMeForShade=function(n,i,r){v.NotifyMeShadeItem=n;i?($(".NotifyMeQuickShopForm"+r).show(),$(".NotifyFormContainer"+r).load("/product/notifymemodal?pfid="+v.product.Id.toString()+"&fsc="+n.variant.Fsc+"&quickshop=true",null,function(){u($(".NotifyFormContainer"+r).contents())(t);$(".NotifyMeSuccessQuickShopViewContainer").hide()})):k(n.variant.Fsc)};v.OpenNotifyMe=function(n){var i="";v.product.IsMultiVariantProduct&&!v.product.IsShadeVariant&&(i=v.TempShoppingBag[0].variant!==null?v.TempShoppingBag[0].variant.Fsc:v.product.VariantGroups[0].Variants[0].Fsc);n?($(".NotifyMeQuickShopForm").show(),$(".NotifyFormContainer").load("/product/notifymemodal?pfid="+v.product.Id.toString()+"&fsc="+i+"&quickshop=true",null,function(){u($(".NotifyFormContainer").contents())(t);$(".NotifyMeSuccessQuickShopViewContainer").hide();$(".NotifyMeButton").hide()})):k(i)};v.OnShadeEnter=function(n,t){var r=$(angular.element(n.currentTarget).find(".VariantImage")[0]),i,u;r.siblings("div").addClass("active");i=r.siblings(".Overlay.active");i.width(i.parent().width()-(i.outerWidth(!0)-i.width()));u=r.siblings(".RotatedCaret45.active");i.css("margin-top",function(){return"-"+(i.height()+18)+"px"});y.showHoveredVariantImage(t)};v.OnShadeLeave=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};t.OnShadeGroupLeave=function(){t.HoveredVariantWithImage=null};v.ShowShadeRemoveButton=function(n){var t=v.TempShoppingBag.length;return t==1?!1:n+1==t?!1:!0};v.GetBagItems=function(){v.ShoppingBag=[];var t=v.product,i=v.TempShoppingBag,n=v.getValidBagItems(i);return n.length===0?n:(t.IsMultiVariantProduct||t.Availability!=CanBuy.Available&&t.Availability!=CanBuy.AutoReplenishmentOnly||(n[0].variant=t.VariantGroups[0].Variants[0]),$.each(n,function(n,t){var r,i,u;t.variant!=null&&(t.variant.Availability==CanBuy.Available||t.variant.Availability==CanBuy.AutoReplenishmentOnly)&&(r=v.FindVariantInBag(t.variant.Sku),r===null?(i=new AddBagItem,i.Quantity=y.getValidQuantity(t.qty),i.Sku=t.variant.Sku,i.OrderType="Customer",i.AutoReplenishmentFrequency=t.AutoReplenishmentFrequency,i.AutoReplenishmentMultiBuy=t.AutoReplenishmentMultibuy,i.AutoReplenishmentOverrideToBeOneTimeOnly=t.AutoReplenishmentOverrideToBeOneTimeOnly,i.DigitalCatalogReferrer=t.DigitalCatalogReferrer,v.ShoppingBag.push(i)):n>0&&t.qty>0&&t.qty<99&&(u=parseInt(v.ShoppingBag[r].Quantity+"")+y.getValidQuantity(t.qty),v.ShoppingBag[r].Quantity=u))}),n)};v.QuickshopFindingMethod=function(){return window.location.href.indexOf("/search")!==-1?TrackingAddToCartType.SearchResultsQuickshop:window.location.href.indexOf("/brochure")!==-1?TrackingAddToCartType.BrochureQuickshop:window.location.href.indexOf("/crusade")!==-1?TrackingAddToCartType.Causes:window.location.href.indexOf("/bag")!==-1?TrackingAddToCartType.Bag:window.location.href.indexOf("/products/productline")!==-1&&v.IsQuickShopModalOpen?TrackingAddToCartType.ProductLinePage:window.location.href.indexOf("/category")!==-1||window.location.href.indexOf("/promotions")!==-1?TrackingAddToCartType.ProductCategoryQuickshop:window.location.href.indexOf("/blog")!==-1?TrackingAddToCartType.BlogQuickShop:window.location.href.indexOf("/myaccount")!==-1?TrackingAddToCartType.OrderHistoryQuickShop:$("#QuickView").children().length>0?TrackingAddToCartType.ProductDetailPageQuickShopModal:window.location.href.indexOf("/product")!==-1?TrackingAddToCartType.ProductDetailPage:TrackingAddToCartType.ProductDetailQuickshop};v.addToBag=function(n,t){var f,i,r,e,u,o;if(v.IsAutoReplenishmentProductJustAdded=!1,!($(".AddToBagQuickshop.Button2").length>0)){for(v.ResetValidation(),v.GetBagItems(),f=$("input.QuantityInput:visible"),i=[],r=0;r<f.length;r++)e=$(f[r]),parseInt(e.val(),10)===0&&i.push(e);if(i.length>0){for(v.ZeroQuantityClientSideValidationError=!0,u=0;u<i.length;u++)i[u].addClass("QtyError");return}if(v.ShoppingBag.length===0){v.AddToBagClientSideValidationError=!0;return}v.LoaderModal(AVON.messages.spinner_addingTextOnly);AVON.product=v.product;o=v.QuickshopFindingMethod();y.bagService.addMultipleItemsToBag(v.ShoppingBag,t,o)}};v.addAutoReplenishmentToBag=function(n,i){if(v.AutoReplenishmentOptionModel==="AutoReplenishment"&&v.AddingVariant&&y.areAllArSelectedItemsAlreadySubscribed()){v.AddToBagClientSideValidationError=!0;return}if(v.AutoReplenishmentOptionModel!=="AutoReplenishment"||v.AutoReplenishmentFrequencyList.length!==1||t.ViewModel.AutoReplenishmentFrequency||(t.ViewModel.AutoReplenishmentFrequency=v.AutoReplenishmentFrequencyList[0]),t.ViewModel.AutoReplenishmentFrequency){v.FrequencySelectError=!1;var r=v.TempShoppingBag,u=[];$.each(r,function(n,i){$.each(v.AutoReplenishmentVariantSubscriptions,function(n,t){i.hasOwnProperty("variant")&&i.variant!==null&&i.variant.hasOwnProperty("Sku")&&t===i.variant.Sku&&u.push(i)});i.AutoReplenishmentFrequency=t.ViewModel.AutoReplenishmentFrequency;i.AutoReplenishmentMultibuy=v.product.AutoReplenishmentMultibuy});u.length>0&&$.each(u,function(n,t){var i=r.indexOf(t);r.splice(i,1)});v.addToBag(n,i)}else v.FrequencySelectError=!0,$(".FrequencySelect").addClass("FormError"),v.GetBagItems(),v.ShoppingBag.length===0&&(v.AddToBagClientSideValidationError=!0)};v.AutoReplenishmentFrequencyChanged=function(){v.ResetValidation()};v.AutoReplenishmentOptionChange=function(){var n;if(v.AddToBagClientSideValidationError=!1,v.ZeroQuantityClientSideValidationError=!1,v.FrequencySelectError=!1,v.AutoReplenishmentOptionModel==="AutoReplenishment"){for($.each(v.product.VariantGroups,function(n,t){$.each(t.Variants,function(n,t){$.each(v.AutoReplenishmentVariantSubscriptions,function(n,i){t.Sku===i&&v.TempShoppingBag.push({qty:1,selectedValue:t.Sku,variant:t,AutoReplenishmentFrequency:0,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1,AutoReplenishmentAutomaticallyAddedToBag:!0,DigitalCatalogReferrer:v.DigitalCatalogReferrer})})})}),n=v.TempShoppingBag.length-1;n>=0;n--)v.TempShoppingBag[n].qty>1&&(v.TempShoppingBag[n].qty=1),v.TempShoppingBag.length>0&&v.TempShoppingBag[n].selectedValue===""&&v.TempShoppingBag.splice(n,1);v.TempShoppingBag=_.map(_.groupBy(v.TempShoppingBag,function(n){return n.selectedValue}),function(n){return n[0]})}if(v.AutoReplenishmentOptionModel==="OneTime")for(v.AddingVariant=!1,n=v.TempShoppingBag.length-1;n>=0;n--)v.TempShoppingBag[n].AutoReplenishmentAutomaticallyAddedToBag&&v.TempShoppingBag.splice(n,1);v.EnsureTempBagHasEmptyItem()};v.$on("BagService.AddToBagSuccess",function(n,t){var i=t,r;for(v.IsAutoReplenishmentProductJustAdded=i.ItemsAdded&&i.ItemsAdded.length>0?i.ItemsAdded[0].AutoReplenishmentFrequency>0:!1,v.ProductsAddedCount=0,r=0;r<i.ItemsAdded.length;r++)v.ProductsAddedCount+=i.ItemsAdded[r].Quantity;v.TempShoppingBag=[];v.TempShoppingBag.push(y.getNewBagItem(v.DigitalCatalogReferrer));v.ShowAddToBag();$("#QuickView").children().length>0&&$("#QuickView").addClass("AddedToBag")});v.CloseModal=function(){$("#QuickView").trigger("close")};v.$on("ProductAddedToBagModalClosed",function(){v.ShowAddToBag();_.defer(function(){v.ShowAlreadyAdded()&&(v.SafeApply(),$("select.FrequencySelect").prop("disabled",!0))})});v.ConditionalProductCheck=function(){var t=!1,n;if(v.Session.Cart.ConditionalProducts)for(n=0;n<v.Session.Cart.ConditionalProducts.length;n++)v.Session.Cart.ConditionalProducts[n].PfId===v.product.Id&&v.Session.Cart.ConditionalProducts[n].Campaign===v.Session.Customer.Campaign&&(v.ConditionProductRemainingQuantityAllowedToBuy=v.Session.Cart.ConditionalProducts[n].QuantityAllowedToBuy,t=!0,$(".QuantityAllowedToBuy").text(v.ConditionProductRemainingQuantityAllowedToBuy));return t};v.$on("NotifyMeService.NotifyMeQuickShopResponse",function(n,t){setTimeout(function(){d(t)},4e3)});v.$on("NotifyMeService.NotifyMeResponse",function(n,t){d(t)});d=function(n){n.ErrorCode===AjaxError.None&&(v.product.IsShadeVariant&&v.NotifyMeShadeItem!=null&&v.RemoveItemFromTempShoppingBag(v.NotifyMeShadeItem),v.product.IsMultiVariantProduct&&!v.product.IsShadeVariant&&v.RemoveItemFromTempShoppingBag(v.NotifyMeShadeItem),v.TempShoppingBag.length<=1&&(v.AddingVariant=!0))};v.RedirectAndPlayVideo=function(n,t){v.ShowLoading(AVON.messages.spinner_loading);var r=v.product.Sku.substring(0,v.product.Sku.lastIndexOf("-")),i="/product/"+v.product.SeoName+"-"+r+"?videoId="+n+"&videoType="+t;v.DigitalCatalogUrl&&v.DigitalCatalogUrl!=="undefined"&&(i+="&"+v.DigitalCatalogUrl);v.DigitalCatalogReferrer&&v.DigitalCatalogReferrer!=="undefined"&&(i+="&dc_ref="+v.DigitalCatalogReferrer);v.RedirectToUrl(i)};v.VideoImageUrl=function(n){var t=n.indexOf("?")>0?n.indexOf("?"):n.length;return n=n.substring(0,t),"https://i1.ytimg.com/vi/"+n+"/sddefault.jpg"};v.BrightcoveThumbnailUrl=function(n){var t=$(".SmallImages .SmallImage .brightcove-image-thumbnail");t.length>0&&$.each(t,function(t,i){$(i).css("background-image","url("+n+")")})};v.FindVariantInBag=function(n){for(var t=0,i=v.ShoppingBag.length;t<i;t++)if(v.ShoppingBag[t].Sku===n)return t;return null};v.IsVariantAvailable=function(n){return n.Availability==CanBuy.Available||n.Availability==CanBuy.AutoReplenishmentOnly};v.IsVariantAvailableSoon=function(n){return n.Availability==CanBuy.AvailableSoon};v.DisplayVariantLineNumber=function(n,t){return ProductHelper.DisplayVariantLineNumber(n.LineNumber,t)};v.IsVariantShade=function(n){return n===1};v.ActiveTabIndex=0;v.ShowDetailTab=function(n){v.ActiveTabIndex=n};r.$on("EllipsisComplete",function(){});v.DisplayChartSize=function(n){if(AVON.IsTabletDevice||$(".android").length>0){e.open(n,"_blank");return}_.defer(function(){var t={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:""+n+"",UseIFrame:!0,IFrameWidth:"750px",IFrameHeight:"750px"};w.trigger("modal",t)})};v.ShowPromotionOverlay=function(n){var i=$(angular.element(n.currentTarget)[0]),t,r,u;if(i.siblings("div").addClass("active"),t=i.siblings(".Overlay.active"),t.width(i.width()-(t.outerWidth(!0)-t.width())),r=$(".NavBar"),r.length>0){var e=r.offset().left+r.innerWidth(),o=t.offset().left+t.innerWidth(),f=o-e;f>0&&t.css({"margin-left":-f})}u=i.siblings(".RotatedCaret45.active");u.css({"margin-left":i.width()/2-u.width()/2})};v.HidePromotionOverlay=function(n){var t=$(angular.element(n.currentTarget)[0]);t.children(".active").removeClass("active")};p=[];v.$on("FallbackSrc.ImageFound",function(n,t){var i=t.element;i.parent(".SmallImage")&&i.attr("data-zoom-image")!==undefined&&$.inArray(i.attr("data-zoom-image"),p)===-1&&p.push(i.attr("data-zoom-image"))});v.$on("SecondaryImage.ImageFound",function(n,t,i){var r=t.element,e,u,o,s;r.parent(".SmallImage")&&r.attr("data-zoom-image")!==undefined&&$.inArray(r.attr("data-zoom-image"),p)===-1&&(v.ImagesIndexLoaded.indexOf(i)<0&&(e=r.attr("data-zoom-image"),u=r.attr("src"),u=u.substring(0,u.lastIndexOf("?"))+e.substring(e.lastIndexOf("?")),r.attr("data-zoom-image",u),v.ImagesIndexLoaded.push(i),o=r.parent(".SmallImage").index(),p[o]=r.attr("data-zoom-image"),r.parent(".SmallImage").data("index",i)),s={Type:TrackingEventType.ProductImageView,Data:{imageIndexes:v.ImagesIndexLoaded,profileNumber:v.product.ProfileNumber}},f.TrackEventItem(s))});v.$on("SecondaryImage.NoImageFound",function(n,t){t.parent(".SmallImage")&&t.attr("data-zoom-image")!==undefined&&$.inArray(t.attr("data-zoom-image"),p)===-1||t.hasClass("ProductImage")&&(t.attr("src","/images/Responsive/Product/PhotoNotAvailable.png"),r.$broadcast("FallbackSrc.NoImageFound",t))});v.ShowProductImage=function(n){t.BroadcastToElement(v,".ProductImageCarousel","Carousel_ShowSlide",n,!0)};v.starWidthStyle=function(){return{width:v.product.Rating*20+"%"}};t.$on("Carousel_SlideShown",function(n,t){var i,r;t.container.attr("id")==="ProductImageCarousel"&&(i=t.container.find(".Slide").children(),i.removeClass("ProductImageActive"),r=t.container.find(".Slide:nth-child("+(t.currentIndex+1)+")").children(),r.addClass("ProductImageActive"))});v.DisplayImageModal=function(n){var u=n?$(n.currentTarget):$("img.ProductImage.ProductImageActive"),t=u.clone(),f=t.attr("data-original-src"),i,r;i=f?t.attr("src"):t.attr("data-zoom-image");r={AllowExit:!0,Model:{ImageSrc:i},KeepLoaded:!1,IgnoreBackground:!1};v.OpenDynamicModal("ProductImageModal",r);$('<img src="'+i+'" alt="'+t.attr("alt")+'" />').appendTo("#ProductImageModal")};v.AddSelectedProductsToWishList=function(n,i){var e,h,u,r,o,s;i===void 0&&(i=!0);t.Session.Customer.IsLoggedIn?(i&&(e=angular.element(n.currentTarget).find("i"),e.addClass("loading-spinner"),e.attr("disabled","true")),r=y.getItemsForWishList(),h=y.wishListService.AddToWishList(r),h.finally(function(){var t,n,u;for(i&&(e.removeClass("loading-spinner"),e.removeAttr("disabled")),t=[],n=0;n<r.length;n++)t.push(r[n].Sku);u={Type:TrackingEventType.WishListItemsAdded,Data:{trackingItems:t,wishListState:v.Session.Customer.WishList.Products.length>0?"exist":"new",findingMethod:v.IsQuickShopModalOpen?"Product list":"Product detail"}};f.TrackEventItem(u)})):(u=window.location.href,v.IsQuickShopModalOpen||(u=y.urlService.SetQueryStringParameterToUrl(u,"addToWishList","true"),t.product.IsMultiVariantProduct&&(r=y.getItemsForWishList(),o=r.length>0&&r[0].Sku!=null?r[0].Sku:null,o!=null&&(u=y.urlService.SetQueryStringParameterToUrl(u,"sku",o)))),s=angular.element($("#Modals>.ModalContainer.Shown>*[modal]")),s.length&&s.trigger("close"),c.ShowLoginModal("wishlist",u))};v.RemoveSelectedProductsFromWishList=function(n){var i,u,r;t.Session.Customer.IsLoggedIn?(i=angular.element(n.currentTarget).find("i"),i.addClass("loading-spinner"),i.attr("disabled","true"),r=y.getItemsForWishList(),u=(r.length!==1||r[0].Sku)&&y.$scope.product.IsMultiVariantProduct?y.wishListService.RemoveSelectedProductsFromWishList(r):y.wishListService.RemoveAllVariantsFromWishList(y.$scope.product.Id),u.finally(function(){i.removeClass("loading-spinner");i.removeAttr("disabled")})):c.ShowLoginModal("wishlist")};v.HideWishList=function(){return!0};v.IsProductOrAnyVariantsInWishList=function(){var n,r=y.$scope.product.Id,i;return t.Session.Customer&&t.Session.Customer.IsLoggedIn?(i=y.getSelectedVariants(r),n=i.length>0?y.wishListService.CheckIfAllVariantsExistInWishList(i):y.wishListService.CheckIfAnyVariantExistsInWishList(r)):n=!1,n};v.ShowWishListIcon=function(){return v.Session.Customer.IsLoggedIn};v.SetAutoReplenishmentOptionModel=function(n){v.AutoReplenishmentOptionModel=n};v.ShowAddVariant=function(){v.AddingVariant=!0;v.AddToBagClientSideValidationError=!1;v.ZeroQuantityClientSideValidationError=!1};v.LimitProductImageThumbnails=function(n,i){var r=5;return i<(t.product.MediaAssociation?r-Math.min(t.product.MediaAssociation.length,4):r)};v.IncrementQuantityField=function(n,t){v.ResetValidation();t.qty=v.UpdateQuantityField(n,QuantityFieldAction.Increment,t.qty)};v.DecrementQuantityField=function(n,t){v.ResetValidation();t.qty=v.UpdateQuantityField(n,QuantityFieldAction.Decrement,t.qty,!0);t.qty===0&&v.RemoveItemFromTempShoppingBag(t)};t.GetProductImage=function(n,i){return y.selectedVariantWithImage&&i==0?t.cdn.variantProductImage(y.selectedVariantWithImage.Fsc,700):t.cdn.productImageXtraLarge(n)};t.FilterPromotionByAttachmentStatus=function(n){return!(t.isCustomerAttachedOrCookiedToRep()&&n.CustomerType=="U")};v.ShowAugmentedRealityModal=function(){if(v.CloseModal(),v.product.AugmentedReality){var n={CssClass:"AugmentedRealityModal",AllowExit:!0,KeepLoaded:!1,UrlToLoad:v.product.AugmentedRealityUrl,UseIFrame:!0,IFrameWidth:"900px",IFrameHeight:"590px",IFrameAttributes:'allow="camera"'};v.OpenDynamicModal("AugmentedRealityModal_"+v.product.Id,n)}};v.SalePriceLinkClick=function(n,t){var i=v.GetProductUrl(t);v.SalePriceClicked(n,i)}}return __extends(t,n),t.prototype.getNewBagItem=function(n){return{qty:1,selectedValue:"",variant:null,AutoReplenishmentFrequency:0,AutoReplenishmentMultibuy:!1,AutoReplenishmentOverrideToBeOneTimeOnly:!1,AutoReplenishmentAutomaticallyAddedToBag:!1,DigitalCatalogReferrer:n}},t.prototype.getValidQuantity=function(n){return n>0&&n<100?n:1},t.prototype.formatIngredients=function(n){return n?n.replaceAll(",","<br />"):""},t.prototype.getSelectedVariants=function(n){var t=[],i=CanBuy.Available,s,r,f,e,o,u;if(this.$scope.product.HasVariants)if(this.$scope.product.IsMultiVariantProduct)for(s=this.$scope.ViewModel.AutoReplenishmentFrequency>0?this.$scope.ViewModel.AutoReplenishmentFrequency:null,r=0,f=this.$scope.TempShoppingBag;r<f.length;r++)e=f[r],e.variant&&t.push(new WishListItem(n,e.variant.Sku,s,i));else this.$scope.product.VariantGroups.length===1&&this.$scope.product.VariantGroups[0].Variants.length===1&&t.push(new WishListItem(n,this.$scope.product.VariantGroups[0].Variants[0].Sku,null,i));else this.$scope.product.PriceModel.AutoReplenishmentPrice>0&&this.$scope.product.Availability===CanBuy.AutoReplenishmentOnly&&this.$scope.ViewModel.AutoReplenishmentFrequency>0&&(o=null,this.$scope.product.Availability===CanBuy.NoLongerAvailable||this.$scope.product.IsMultiVariantProduct||(u=this.$scope.product.VariantGroups[0].Variants[0],u&&(o=u.Sku,i=u.Availability)),t.push(new WishListItem(n,o,this.$scope.ViewModel.AutoReplenishmentFrequency,i)));return t},t.prototype.getGenericProduct=function(n){var i=null,r=CanBuy.Available,t;return this.$scope.product.IsMultiVariantProduct||this.$scope.product.Availability===CanBuy.NoLongerAvailable||(t=this.$scope.product.VariantGroups[0].Variants[0],t&&(i=t.Sku,r=t.Availability)),new WishListItem(n,i,null,r)},t.prototype.getItemsForWishList=function(){var t=this.$scope.product.Id,n=this.getSelectedVariants(t);return n.length===0&&n.push(this.getGenericProduct(t)),n},t.prototype.revertAllToOriginalProductImage=function(){this.$scope.HoveredVariantWithImage=null;this.selectedVariantWithImage=null},t.prototype.areAllArSelectedItemsAlreadySubscribed=function(){var t=this,n;return this.$scope.AutoReplenishmentOptionModel!=="AutoReplenishment"?!1:(n=[],n.length=0,$.each(this.$scope.TempShoppingBag,function(i,r){$.each(t.$scope.AutoReplenishmentVariantSubscriptions,function(t,i){r.hasOwnProperty("variant")&&r.variant!==null&&r.variant.hasOwnProperty("Sku")&&i===r.variant.Sku&&n.push(i)})}),n.length===this.$scope.TempShoppingBag.length-1&&n.length>0?!0:!1)},t.prototype.showSelectedVariantImage=function(n){n.HasProductImage&&(this.selectedVariantWithImage=n)},t.prototype.showHoveredVariantImage=function(n){n&&n.HasProductImage&&(this.$scope.HoveredVariantWithImage=n)},t.prototype.preSelectVariantBasedOnUrlParam=function(){if(AVON.PreSelectedVariantSku&&this.$scope.product){var n=this.$scope.GetVariantFromProduct(AVON.PreSelectedVariantSku);n&&this.$scope.ShadeSwatchClicked(n)}},t.$inject=["$scope","bagService","$rootScope","$compile","trackingService","$window","wishListService","facebookService","autoReplenishService","loginModalService","urlService","historyService"],t}(BaseAngularController);n.ProductQuickShopController=t}(ProductDetailModule||(ProductDetailModule={}));app.controller("ProductQuickShopController",ProductDetailModule.ProductQuickShopController),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h){function c(n,t){var i=angular.element("[id="+n+"]");i.attr("placeholder",t)}function v(t){if($("[id=registrationModel_LoginInfo_PasswordInput]").length>0){var i=$("[id=registrationModel_LoginInfo_PasswordInput]").attr("placeholder").replace("*",""),r=$("[id=registrationModel_LoginInfo_PasswordConfirmInput]").attr("placeholder").replace("*",""),u=$("[id=registrationModel_LoginInfo_PasswordHintInput]").attr("placeholder").replace("*","");t||n.registrationScope.RequireFullAccount?(c("registrationModel_LoginInfo_PasswordInput",i+"*"),c("registrationModel_LoginInfo_PasswordConfirmInput",r+"*"),c("registrationModel_LoginInfo_PasswordHintInput",u+"*"),n.registrationScope.HideGuestCheckoutMessage=!0):(c("registrationModel_LoginInfo_PasswordInput",i),c("registrationModel_LoginInfo_PasswordConfirmInput",r),c("registrationModel_LoginInfo_PasswordHintInput",u),n.registrationScope.HideGuestCheckoutMessage=!1);n.registrationScope.SafeApply()}}function d(t){angular.element("#registrationModel_LoginInfo_PasswordInput").val()!=""||angular.element("#registrationModel_LoginInfo_PasswordConfirmInput").val()!=""||angular.element("#registrationModel_LoginInfo_PasswordHintInput").val()!=""||n.registrationScope.RequireFullAccount?v(!0,t):v(!1,t)}function g(n){n.attr("id")==="registrationModel_LoginInfo_FirstNameInput"&&$("#shippingAddress_FirstNameInput").val(n.val()).removeClass("placeholder").change();n.attr("id")==="registrationModel_LoginInfo_LastNameInput"&&$("#shippingAddress_LastNameInput").val(n.val()).removeClass("placeholder").change();_.defer(function(){AddressModule.addressesScope.UpdateInlineWaterMark();AddressModule.addressesScope.SafeApply()},250)}function w(){n.registrationScope.registrationModel=s.OdsIsDown===!1&&(AVON.registrationModel||{NotifySpecialOffers:!0});n.registrationScope.registrationModel.LoginInfo&&n.registrationScope.registrationModel.LoginInfo.FirstName&&n.registrationScope.registrationModel.LoginInfo.FirstName.length==0&&(n.registrationScope.registrationModel.LoginInfo={FirstName:"",LastName:"",Email:"",EmailConfirm:"",Password:"",PasswordConfirm:"",PasswordHint:"",PhoneNumber:null});n.registrationScope.showAcceptedPrivacyPolicyError=!1;n.registrationScope.DisplayPasswordInstructions=!0;this.isModalDisplay=!1;n.registrationScope.ShowValidation=!1;n.registrationScope.RegistrationFullPageForm=angular.element("#registrationFullPage").val()=="true";n.registrationScope.CreateAnAccount=n.registrationScope.RegistrationModal;n.registrationScope.RequireFullAccount=AVON.RequireFullAccount;n.registrationScope.RegistrationFullPageForm&&(v(!0),_.defer(function(){n.registrationScope.UpdateInlineWaterMark();n.registrationScope.SafeApply();angular.element("#registrationModel_LoginInfo_FirstNameInput").focus()},250))}function nt(){n.registrationScope.registrationModel.IsGuestShopper=!1}function tt(){var t=Math.floor(Math.random()*10),i;n.registrationScope.registrationModel.ReturnUrl=$("#registrationModel_ReturnUrl").val();n.registrationScope.registrationModel.PrivacyPolicy=!0;n.registrationScope.registrationModel.LoginInfo.Password="password"+t;n.registrationScope.registrationModel.LoginInfo.PasswordConfirm="password"+t;n.registrationScope.registrationModel.LoginInfo.PasswordHint="GuestShopper";n.registrationScope.registrationModel.IsGuestShopper=!0;i=n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email);i||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid=!0);n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&n.registrationScope.RegistrationForm.Number&&(n.registrationScope.RegistrationForm.Number.$invalid=!0,n.registrationScope.RegistrationForm.Number.$error.format=!0,n.registrationScope.ShowValidation=!0,n.registrationScope.SafeApply(),n.registrationScope.RegistrationForm.$valid=!1);n.registrationScope.RegistrationForm.registrationModel_LoginInfo_FirstName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_LastName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid===!1&&(n.registrationScope.RegistrationForm.$valid=!0,n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&(n.registrationScope.RegistrationForm.$valid=!1))}function b(){var t,u,i,r;n.registrationScope.HideLoading();n.registrationScope.DisplayEmailError=!1;n.registrationScope.PasswordsEmpty=!1;n.registrationScope.PasswordsDontMatch=!1;t=!1;n.registrationScope.registrationModel.PrivacyPolicy===!1&&(n.registrationScope.showAcceptedPrivacyPolicyError=!0);n.registrationScope.RegistrationForm.ServerErrors.Summary===undefined||n.registrationScope.ShowValidation||(n.registrationScope.RegistrationForm.ServerErrors.Summary.$invalid=!1);l(n.registrationScope.registrationModel.LoginInfo.Password)||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,t=!0);l(n.registrationScope.registrationModel.LoginInfo.PasswordConfirm)||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,t=!0);u=n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email);u||(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid=!0,n.registrationScope.DisplayEmailError=!0);i=n.registrationScope.registrationModel.LoginInfo.Password;r=n.registrationScope.registrationModel.LoginInfo.PasswordConfirm;n.registrationScope.DisplayPasswordInstructions=!1;n.registrationScope.ValidationErrorStyle=!1;i===""&&r===""&&(n.registrationScope.PasswordsEmpty=!0);t===!1&&i!==r&&(n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,n.registrationScope.PasswordsDontMatch=!0);!a||l(n.registrationScope.registrationModel.LoginInfo.Password)&&l(n.registrationScope.registrationModel.LoginInfo.PasswordConfirm)||(n.registrationScope.PasswordsEmpty=!0);n.registrationScope.ShowValidation=!0;n.registrationScope.RequiredInvalid=!0;n.registrationScope.TrackUserValidationErrors(n.registrationScope.RegistrationForm.$error)}function l(n){return n?n.match(/^(?=.*[0-9])([a-zA-Z0-9]{7,18})$/)!=null:!1}function k(){n.registrationScope.registrationModel.LoginInfo.Password=$("#registrationModel_LoginInfo_PasswordInput").val();n.registrationScope.registrationModel.LoginInfo.PasswordConfirm=$("#registrationModel_LoginInfo_PasswordConfirmInput").val();n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!1;n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!1}var a,y,p;t.call(this,i,s);n.registrationScope=i;a=!1;n.registrationScope.RegistrationModal=angular.element("#RegistrationModal").html().length>0;n.registrationScope.SessionService.WhenReady().then(function(){$.each(AvonModule.AvonScope.Session.Cart.Campaigns,function(n,t){$.each(t.Items,function(n,t){var i=t.AutoReplenishmentFrequency>0;i&&(AvonModule.AvonScope.Session.Customer.IsEligibleForGuestCheckout=!1)})});n.registrationScope.SetupFullRegistrationForm=function(){s.OdsIsDown||(n.registrationScope.CreateAnAccount=!0,n.registrationScope.HideCreateAnAccount=!0,n.registrationScope.RepAttachedFullRegistrationRequired=!0,n.registrationScope.RegistrationFullPageForm=!0,n.registrationScope.showAcceptedPrivacyPolicyError=!1,n.registrationScope.DisplayPasswordInstructions=!0,n.registrationScope.RequireFullAccount=!0,AVON.RequireFullAccount=!0,AVON.IsGuestCheckout=!1,n.registrationScope.ContinueAsGuest=!1,r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!0),n.registrationScope.SafeApply())};n.registrationScope.RegisteredCustomerAsGuest={CustomerId:n.registrationScope.Session.Customer.CustomerId>0?n.registrationScope.Session.Customer.CustomerId:0,Rep:n.registrationScope.Session.Rep?n.registrationScope.Session.Rep:{Hash:0,Id:0,Address:"",CityStateZip:"",CityState:"",HomepageUrl:"",Name:"",FirstName:"",LastName:"",Phone:"",AlternativePhone:"",WebUrl:"",Status:"",IsInPilot:!1,IsGemini:!1},CustomerType:undefined,CustomerTypeOnRecord:undefined,RepIdOnRecord:undefined,SaveInSession:undefined};n.registrationScope.AccountAlreadyExists=!1;n.registrationScope.ContinueAsGuest=AVON.IsGuestCheckout});y=$("#mode");y.length>0&&y.val()==="Standard"&&(n.registrationScope.IsModal=!0,this.isModalDisplay=!0);n.registrationScope.PrivacyPolicyOnKeyCheck=function(t){var i=t.currentTarget.id;n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&(d("#"+i),v(!0))};n.registrationScope.InputFocus=function(){n.registrationScope.DisplayPasswordInstructions=!0;n.registrationScope.DisplayEmailError=!1;n.registrationScope.ValidationErrorStyle=!1;n.registrationScope.ShowValidation=!1;n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&(AddressModule.addressesScope.ShowValidation=!1)};n.registrationScope.CheckIfEmailExists=function(){return(n.registrationScope.AccountAlreadyExists=!1,n.registrationScope.CheckForExistingEmail=!0,n.registrationScope.RegistrationFullPageForm&&n.registrationScope.registrationModel.LoginInfo&&n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email))?($("#registrationModel_LoginInfo_EmailInput").addClass("LoadingImage"),u.getCustomerByEmail(n.registrationScope.registrationModel.LoginInfo.Email,!1)):null};n.registrationScope.$on("RegistrationService.RegisteredCustomerAsGuestResponse",function(t,i){if($("#registrationModel_LoginInfo_EmailInput").removeClass("LoadingImage"),i.ErrorCode!=AjaxError.ValidationErrors)if(i.SaveInSession)i.Rep&&(n.registrationScope.RegisteredCustomerAsGuest.Rep=i.Rep,n.registrationScope.RegisteredCustomerAsGuest.Rep.Id>0&&(n.registrationScope.Session.Rep=n.registrationScope.RegisteredCustomerAsGuest.Rep)),i.CustomerId&&i.CustomerType==6&&(n.registrationScope.RegisteredCustomerAsGuest.CustomerId=i.CustomerId,n.registrationScope.AccountAlreadyExists=!0);else if(i.CustomerId&&i.CustomerType==6){var r={UrlToLoad:"",AllowExit:!0,KeepLoaded:!0,Model:{Email:n.registrationScope.registrationModel.LoginInfo.Email,CustomerType:i.CustomerTypeOnRecord,RepIdOnRecord:i.RepIdOnRecord}};$("#WelcomeBack").trigger("modal",r)}});n.registrationScope.LoadSignInModal=function(){n.registrationScope.ShowLoading(AVON.messages.spinner_loading);_.defer(function(){window.location.href=n.registrationScope.Url.Action("Index","Bag")+"?overlay=LoginModal&returnurl=/checkout&email="+n.registrationScope.registrationModel.LoginInfo.Email},250)};n.registrationScope.$on("WelcomeBackScope.ContinueAsGuest",function(){$("#WelcomeBack").trigger("close")});n.registrationScope.$on("RegistrationScope.UpdateCustomerSettings",function(){n.registrationScope.ContinueAsGuest=!1});n.registrationScope.RegisteredUserContinueAsGuest=function(t){s.OdsIsDown||(n.registrationScope.registrationModel.IsRegisteredGuestShopper=!0,n.registrationScope.RequireFullAccount=!1,AVON.RequireFullAccount=!1,n.registrationScope.ContinueAsGuest=!0,n.registrationScope.CreateAnAccount=!1,n.registrationScope.UpdateCustomerType(CustomerType.RegisteredCustomerAsGuest),t&&u.getCustomerByEmail(n.registrationScope.registrationModel.LoginInfo.Email,t),r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!1))};n.registrationScope.$on("ModalClosed",function(t,i){i==="WelcomeBack"&&(n.registrationScope.IsAutoReplenishmentInCart()||n.registrationScope.RegisteredUserContinueAsGuest(!0));n.registrationScope.AccountAlreadyExists||n.registrationScope.CheckForExistingEmail||w()});$("#registrationModel_LoginInfo_FirstNameInput, #registrationModel_LoginInfo_LastNameInput").keyup(function(){n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&g($(this))});n.registrationScope.privacyUrl=$("#privacyPolicyUrl").val();n.registrationScope.conditionsOfUseUrl=$("#conditionsOfUseUrl").val();$("#LoginModel_EmailInput, #LoginModel_PasswordInput").on("click",function(){n.registrationScope.ShowValidation=!1});n.registrationScope.Register=function(){a&&k();n.registrationScope.RegistrationForm.$valid&&n.registrationScope.PreValidationRules()?(n.registrationScope.CreateAnAccount&&(nt(),n.registrationScope.ShowLoading(AVON.messages.spinner_registering),n.registrationScope.registrationModel.ReturnUrl=$("#registrationModel_ReturnUrl").val(),n.registrationScope.RegistrationModal&&(n.registrationScope.registrationModel.PrivacyPolicy=n.registrationScope.RegistrationForm.registrationModel_PrivacyPolicy.$modelValue)),u.register(n.registrationScope.registrationModel,$("form[name=RegistrationForm]"))):b()};n.registrationScope.invalidPhonenumber=AVON.messages.validate_invalid_phonenumber;n.registrationScope.HasPhoneNumber=function(){var t=n.registrationScope.registrationModel.LoginInfo.PhoneNumber;return t?!t.Area||t.Area.length!==3?!1:!t.Prefix||t.Prefix.length!==3?!1:!t.Number||t.Number.length!==4?!1:!0:!1};n.registrationScope.PreValidationRules=function(){n.registrationScope.showAcceptedPrivacyPolicyError=!1;n.registrationScope.PasswordsEmpty=!1;n.registrationScope.PasswordsDontMatch=!1;n.registrationScope.DisplayEmailError=!1;n.registrationScope.DisplayPasswordInstructions=!0;n.registrationScope.RegistrationForm.Number&&(n.registrationScope.RegistrationForm.Number.$invalid=!1,n.registrationScope.RegistrationForm.Number.$error.format=!1,n.registrationScope.RegistrationForm.$valid=!1);n.registrationScope.registrationModel.LoginInfo||(n.registrationScope.registrationModel.LoginInfo={});n.registrationScope.registrationModel.LoginInfo.EmailConfirm=n.registrationScope.registrationModel.LoginInfo.Email;var t=n.registrationScope.IsEmailValid(n.registrationScope.registrationModel.LoginInfo.Email);if(t||(n.registrationScope.RegistrationForm.$valid=!1),n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&n.registrationScope.RegistrationForm.Number&&(n.registrationScope.RegistrationForm.Number.$invalid=!0,n.registrationScope.RegistrationForm.Number.$error.format=!0,n.registrationScope.ShowValidation=!0,n.registrationScope.SafeApply(),n.registrationScope.RegistrationForm.$valid=!1),n.registrationScope.CreateAnAccount){if(n.registrationScope.RegistrationFullPageForm&&!n.registrationScope.RegistrationModal&&(n.registrationScope.registrationModel.PrivacyPolicy=n.registrationScope.PrivacyPolicyFromFullPage),a&&k(),!l(n.registrationScope.registrationModel.LoginInfo.Password))return n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,!1;if(!l(n.registrationScope.registrationModel.LoginInfo.PasswordConfirm))return n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,!1;if(n.registrationScope.registrationModel.LoginInfo.Password!==n.registrationScope.registrationModel.LoginInfo.PasswordConfirm)return n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid=!0,n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid=!0,n.registrationScope.RegistrationForm.$valid=!1,n.registrationScope.ShowPasswordValidation=!0,n.registrationScope.DisplayPasswordInstructions=!1,!1;if(n.registrationScope.registrationModel.PrivacyPolicy===!1)return n.registrationScope.showAcceptedPrivacyPolicyError=!0,n.registrationScope.RegistrationForm.$valid=!1,!1;n.registrationScope.RegistrationForm.registrationModel_LoginInfo_FirstName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_LastName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Password.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordConfirm.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_PasswordHint.$invalid===!1&&(n.registrationScope.RegistrationForm.$valid=!0,n.registrationScope.RegistrationFullPageForm&&AddressModule.addressesScope&&!n.registrationScope.HasPhoneNumber()&&(n.registrationScope.RegistrationForm.$valid=!1))}else tt();return!0};n.registrationScope.$on("AddressesScope.AddressValidation",function(){n.registrationScope.ShowValidation=!0;n.registrationScope.registrationModel.PrivacyPolicy=!1;n.registrationScope.RegistrationForm.ServerErrors.Summary||(n.registrationScope.RegistrationForm.ServerErrors.Summary=[]);n.registrationScope.RegistrationForm.ServerErrors.Summary.length&&(n.registrationScope.RegistrationForm.ServerErrors.Summary.$invalid=!0);n.registrationScope.RegistrationForm.registrationModel_LoginInfo_FirstName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_LastName.$invalid===!1&&n.registrationScope.RegistrationForm.registrationModel_LoginInfo_Email.$invalid===!1&&(n.registrationScope.RegistrationForm.$valid=!0);n.registrationScope.HideLoading()});n.registrationScope.SubmitFullForm=function(){n.registrationScope.registrationModel.PrivacyPolicy=!1;n.registrationScope.registrationModel.LoginInfo.Password="";n.registrationScope.registrationModel.LoginInfo.PasswordConfirm="";n.registrationScope.registrationModel.LoginInfo.PasswordHint="";n.registrationScope.registrationModel.IsGuestShopper=!1};n.registrationScope.NewCustomerRegister=function(){n.registrationScope.showAcceptedPrivacyPolicyError=!1;n.registrationScope.CreateAnAccount?n.registrationScope.Register():(n.registrationScope.PreValidationRules(),n.registrationScope.RegistrationForm.$valid?(n.registrationScope.ShowLoading(AVON.messages.spinner_loading),u.register(n.registrationScope.registrationModel,$("form[name=RegistrationForm]"))):(n.registrationScope.ShowValidation=!0,n.registrationScope.TrackUserValidationErrors(n.registrationScope.RegistrationForm.$error),n.registrationScope.SafeApply()))};n.registrationScope.PrivacyCheckBoxClick=function(){n.registrationScope.showAcceptedPrivacyPolicyError=!1};n.registrationScope.TrackUserValidationErrors=function(t){if(n.registrationScope.IsMobile!==!1){var i=[];t&&$.each(t,function(n,t){t&&(i.push("err-"+n),$.each(t,function(n,t){i.push(t.$name)}))});i=null}};n.registrationScope.ViewPrivacyPolicy=function(){window.open(n.registrationScope.privacyUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};n.registrationScope.ViewConditionsOfUse=function(){window.open(n.registrationScope.conditionsOfUseUrl,"AVONPop","toolbar=no,width=640,height=550,status=no,scrollbars=yes,resize=yes,menubar=no").focus()};p=this;n.registrationScope.$on("RegistrationService.RegisterResponse",function(t,i){var u,e,s;if(i.ErrorCode===AjaxError.None&&i.Data==="RegisterDuplicateFacebookUser"&&($("#RegistrationModal").trigger("close"),u={AllowExit:!0,Model:null,KeepLoaded:!1,UrlToLoad:"/login/facebookuserresetpassword"},n.registrationScope.OpenDynamicModal("FacebookUserPasswordResetModal",u)),i.ErrorCode===AjaxError.None&&i.Data==="RegisterGuestShopperWithRepId"&&(r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!0),n.registrationScope.registrationModel.LoginInfo.Password="",n.registrationScope.registrationModel.LoginInfo.PasswordConfirm="",n.registrationScope.registrationModel.LoginInfo.PasswordHint="",n.registrationScope.registrationModel.IsGuestShopper=!1,n.registrationScope.registrationModel.PrivacyPolicy=!1,n.registrationScope.CreateAnAccount=!0,n.registrationScope.RegistrationFullPageForm=!0,n.registrationScope.showAcceptedPrivacyPolicyError=!1,n.registrationScope.DisplayPasswordInstructions=!0,n.registrationScope.RequireFullAccount=!0,n.registrationScope.SafeApply(),n.registrationScope.PreValidationRules(),r.$broadcast("RegistrationScope.GuestShopperWithRepId",!0)),i.ErrorCode===AjaxError.ValidationErrors&&(n.registrationScope.ProcessAjaxValidationErrors(i),$.each(i.ValidationErrors,function(t,i){var r="registrationModel_"+i.FieldName.replace(".","_"),u;n.registrationScope.RegistrationForm!=undefined&&n.registrationScope.RegistrationForm[r]!=undefined&&(n.registrationScope.RegistrationForm[r].$invalid=!0,r=="registrationModel_LoginInfo_Email"&&(n.registrationScope.DisplayEmailError=!0,n.registrationScope.ValidationErrorStyle=!0));u=$(".ErrorSummaryContainer .ValidationSummaryServer span a");o(u)(n.registrationScope)}),n.registrationScope.CreateAnAccount||n.registrationScope.CleanPrivacyPolicy(n.registrationScope.RegistrationForm)),i.Data!=="RegisterGuestShopperWithRepId"&&(i.ErrorCode!==AjaxError.None&&(n.registrationScope.registrationModel.PrivacyPolicy=!1),i.ErrorCode===AjaxError.None&&(p.isModalDisplay===!1||n.registrationScope.RegistrationFullPageForm))){if(n.registrationScope.RegistrationFullPageForm){n.registrationScope.registrationModel.IsGuestShopper||(e={Type:TrackingEventType.CartNewCustAcct,Data:{customerId:AvonModule.AvonScope.Session.Customer.CustomerId}},f.TrackEventItem(e));AddressModule.addressesScope.billingAddress=null;AddressModule.addressesScope.shippingAddress=null;n.registrationScope.ShowLoading(AVON.messages.spinner_loading);r.$broadcast("AddressesScope.SaveAddresses");return}AVON.RedirectToPowerReviews&&(i.Processed=!0,setTimeout(function(){AvonModule.AvonScope.ShowLoading(AVON.messages.spinner_loading)},750))}n.registrationScope.IsMobile&&i.ErrorCode==AjaxError.ValidationErrors&&(s=[],$.each(i.ValidationErrors,function(n,t){s.push(t.FieldName+"-"+t.Problem)}))});n.registrationScope.$on("RegistrationScope.ValidatePersonalInfo",function(t,i,u){n.registrationScope.CreateAnAccount=i;n.registrationScope.RequireFullAccount=i;n.registrationScope.PrivacyPolicyFromFullPage=u;n.registrationScope.PreValidationRules()!=!1&&n.registrationScope.RegistrationForm.$valid||(b(),n.registrationScope.registrationModel.PrivacyPolicy=!1,n.registrationScope.SafeApply(),r.$broadcast("RegistrationScope.RegistrationValidation"));r.$broadcast("AddressesScope.ValidateAddresses",n.registrationScope.RegistrationForm.$valid)});n.registrationScope.$on("RegistrationScope.SaveDetails",function(){n.registrationScope.PreValidationRules();n.registrationScope.NewCustomerRegister()});n.registrationScope.$on("RegistrationScopeFullPage.UpdateNotifySpecialOffers",function(t,i){n.registrationScope.registrationModel.NotifySpecialOffers=i});n.registrationScope.updatePhoneNumber=function(){var t=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber;t&&t.length>0?(n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Area=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber.substring(0,3),n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Prefix=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber.substring(3,6),n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Number=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber.substring(6,10)):(n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Area="",n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Prefix="",n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Number="");AddressModule.addressesScope.billingAddress.PhoneNumber.Area=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Area;AddressModule.addressesScope.billingAddress.PhoneNumber.Prefix=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Prefix;AddressModule.addressesScope.billingAddress.PhoneNumber.Number=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.Number;AddressModule.addressesScope.billingAddress.PhoneNumber.FullNumber=n.registrationScope.registrationModel.LoginInfo.PhoneNumber.FullNumber};n.registrationScope.$on("FormDirective.HidValidation",function(){n.registrationScope.RegistrationForm!=null&&(n.registrationScope.RegistrationForm.ServerErrors=[]);n.registrationScope.ShowValidation&&(n.registrationScope.ShowValidation=!1)});$(function(){var i;a=$("html").hasClass("ie9");w();var t=$(document),u="#DisplayLoginModal",f="#DisplayForgotPassword",o="#Registration",c=function(){$("#RegistrationModal").trigger("close");h.ShowLoginModal()};n.registrationScope.registrationModel||(n.registrationScope.registrationModel={});n.registrationScope.registrationModel.LoginInfo||(n.registrationScope.registrationModel.LoginInfo={});n.registrationScope.registrationModel||(n.registrationScope.registrationModel={});n.registrationScope.registrationModel.LoginInfo||(n.registrationScope.registrationModel.LoginInfo={});AVON.TempModalModel&&AVON.TempModalModel.Email&&(n.registrationScope.registrationModel.LoginInfo.Email=AVON.TempModalModel.Email);t.off("click",u);t.on("click",u,function(){return c(),!1});t.off("click",f);t.on("click",f,function(){return e.displayForgotPassword=!0,e.forgotEmail=n.registrationScope.registrationModel.LoginInfo.Email,c(),!1});i=!1;t.off("keydown",o);t.on("keydown",o,function(t){var r=t.keyCode||t.which;r!==9||n.registrationScope.registrationModel.LoginInfo.FirstName!==""||i||($("[id=registrationModel_LoginInfo_FirstNameInput]").focus(),i=!0)});n.registrationScope.Session.Customer.CustomerType!==CustomerType.RegisteredCustomerAsGuest&&(AVON.IsGuestCheckout||r.$broadcast("RegistrationScope.DisplayPrivacyPolicy",!0),n.registrationScope.Session.Rep.Id>0&&n.registrationScope.SetupFullRegistrationForm());n.registrationScope.Session.Customer.CustomerType===CustomerType.RegisteredCustomerAsGuest&&(n.registrationScope.IsAutoReplenishmentInCart()||AVON.IsGuestCheckout==!1?n.registrationScope.SetupFullRegistrationForm():n.registrationScope.RegisteredUserContinueAsGuest(!1),s.OdsIsDown==!1&&n.registrationScope.Session.Customer.IsEligibleForGuestCheckout===!1&&_.defer(function(){n.registrationScope.QueryString().redirectFromCheckout&&r.$broadcast("RegistrationScope.GuestShopperWithRepId",!0)},250))})}return __extends(i,t),i.$inject=["$scope","$rootScope","registrationService","trackingService","loginService","$compile","$window","loginModalService"],i}(BaseAngularController);n.RegistrationController=t}(RegistrationModule||(RegistrationModule={}));app.controller("RegistrationController",RegistrationModule.RegistrationController),function(n){var t=function(n){function t(t,i,r){n.call(this,t);this.searchService=i;this.$window=r;var u=t;u.searchTerm=i.searchTerm;u.getSearchResultsForTypeahead=function(n){var t;if(angular.element(".custom-popup-wrapper").scrollTop(0),t=i.sanitizeSearchTerm(n,i.suppliedSearchRegex),!t)return[];var r=i.getCelebrosResults(t),u=i.getArticleResults(t);return r.then(function(n){return u.then(function(t){return n.slice(0,i.maxNumberOfSuggestionsPerType).concat(t.slice(0,i.maxNumberOfSuggestionsPerType))})})};u.onSearchResultSelected=function(n){var t;t=n.type==SearchTermType.Content?n.resultObject.RelativeUrl:i.processSelectedSearchTermByType(u.searchTerm,n);u.IsLeavingFundraiserPageWithoutShopping()||u.RedirectToUrl(t)};u.onSearchResultManual=function(){var n=i.processSelectedSearchTermByType(u.searchTerm);u.RedirectToUrl(n)};u.hasSearchInputValue=function(){return!u.isNullOrWhiteSpace(u.searchTerm.value)};u.clearSearchInputValue=function(){i.searchTerm.value=""};u.onKeyPress=function(n){if(n.which===13){n.preventDefault();u.onSearchResultSelected(n.target.value,null,null,n)}else u.searchTerm.value.length==0&&(i.searchContainsResults=!1)}}return __extends(t,n),t.$inject=["$scope","searchService","$window"],t}(BaseAngularController);n.SearchController=t}(SearchModule||(SearchModule={}));app.controller("SearchController",SearchModule.SearchController),function(n){var t=function(n){function t(t,i){function r(n,t){n.setAttribute("style","height: "+t+"px")}function u(){var n=$("#TabsContainer li .tip-tab.selected"),i;n&&(i=n[0],t.calculateElementHeightForArrow(null,i))}function f(){var t=$(".TipsModule section .ImageContainer .LPMImageContainer img"),n;if(t)for(n=0;n<t.length;n++)t[n].setAttribute("style","max-height: none")}n.call(this,t);t.activeTabNumber=0;t.TabClick=function(n){t.activeTabNumber=n};t.$on("ProductService.ProductsLoaded",function(){i.find(window.location.hash).length>0&&(t.LoadOperationsCount+=1,t.LoadOperationsCount>=2&&_.delay(function(){t.ScrollToTop(i,!1)},1e3))});t.$on("ProductService.PromotionsLoaded",function(){i.find(window.location.hash).length>0&&(t.LoadOperationsCount+=1,t.LoadOperationsCount>=2&&_.delay(function(){t.ScrollToTop(i,!1)},1e3))});t.applySelectedClass=function(n){return t.activeTabNumber===n?"selected":""};t.calculateElementHeightForArrow=function(n,t){var i=n!==null?n.currentTarget:t,f=i.clientHeight,e=i.querySelector(".Arrow"),o=i.querySelector(".Arrow img"),u=f-1;r(e,u);r(o,u)};angular.element(document).ready(function(){u();f()});_.defer(function(){i.find(window.location.hash.substring(1)).length>0&&i.find(window.location.hash.substring(1))[0].click()})}return __extends(t,n),t.$inject=["$scope","$element"],t}(BaseAngularController);n.TipsModuleController=t}(TipsModule||(TipsModule={}));app.controller("TipsModuleController",TipsModule.TipsModuleController);angular.module("ui.select2",[]).value("uiSelect2Config",{}).directive("uiSelect2",["uiSelect2Config","$timeout",function(n,t){$(".touch").length>0&&(n.minimumResultsForSearch=-1);n.width="resolve";n.formatResult=dropdownFormatting;n.formatSelection=dropdownFormatting;n.selectOnBlur=!0;n.openOnEnter=!1;n.escapeMarkup=function(n){return n};n.matcher=function(n,t){return t.toUpperCase().indexOf(n.toUpperCase())>=0};n.sortResults=function(n,t,i){return i.term?(i.term=i.term.toUpperCase(),n.sort(function(n,t){var r=n&&n.text&&n.text.toUpperCase().indexOf(i.term)===0,u=t&&t.text&&t.text.toUpperCase().indexOf(i.term)===0;return r&&!u?-1:!r&&u?1:0})):n};var i={};return n&&angular.extend(i,n),{require:"ngModel",priority:1,compile:function(n,r){var e,u,o,f=n.is("select"),s=angular.isDefined(r.multiple);return n.is("select")&&(u=n.find("optgroup[ng-repeat], optgroup[data-ng-repeat], option[ng-repeat], option[data-ng-repeat]"),u.length&&(o=u.attr("ng-repeat")||u.attr("data-ng-repeat"),e=jQuery.trim(o.split("|")[0]).split(" ").pop())),function(n,u,o,h){var c=angular.extend({},i,n.$eval(o.uiSelect2)),l=function(n){var t;return c.simple_tags?(t=[],angular.forEach(n,function(n){t.push(n.id)})):t=n,t},v=function(n){var t=[];return n?(c.simple_tags?(t=[],angular.forEach(n,function(n){t.push({id:n,text:n})})):t=n,t):t},a;f?(delete c.multiple,delete c.initSelection):s&&(c.multiple=!0);h&&(n.$watch(r.ngModel,function(n,t){n&&n!==t&&h.$render()},!0),h.$render=function(){if(f)u.select2("val",h.$viewValue);else if(c.multiple){var n=h.$viewValue;angular.isString(n)&&(n=n.split(","));u.select2("data",v(n))}else angular.isObject(h.$viewValue)?u.select2("data",h.$viewValue):h.$viewValue?u.select2("val",h.$viewValue):u.select2("data",null)},e&&n.$watch(e,function(n,i){angular.equals(n,i)||t(function(){u.select2("val",h.$viewValue);u.trigger("change");n&&!i&&h.$setPristine&&h.$setPristine(!0)})}),h.$parsers.push(function(n){var t=u.prev();return t.toggleClass("ng-invalid",!h.$valid).toggleClass("ng-valid",h.$valid).toggleClass("ng-invalid-required",!h.$valid).toggleClass("ng-valid-required",h.$valid).toggleClass("ng-dirty",h.$dirty).toggleClass("ng-pristine",h.$pristine),n}),f||(u.bind("change",function(t){(t.stopImmediatePropagation(),n.$$phase||n.$root.$$phase)||n.SafeApply(function(){h.$setViewValue(l(u.select2("data")))})}),c.initSelection&&(a=c.initSelection,c.initSelection=function(n,t){a(n,function(n){var i=h.$pristine;h.$setViewValue(l(n));t(n);i&&h.$setPristine();u.prev().toggleClass("ng-pristine",h.$pristine)})})));u.bind("$destroy",function(){u.select2("destroy")});o.$observe("disabled",function(n){u.select2("enable",!n)});o.$observe("readonly",function(n){u.select2("readonly",!!n)});o.ngMultiple&&n.$watch(o.ngMultiple,function(n){o.$set("multiple",!!n);u.select2(c)});t(function(){if(u.select2(c),u.select2("data",h.$modelValue),h.$render(),!c.initSelection&&!f){var n=h.$pristine;h.$setViewValue(l(u.select2("data")));n&&h.$setPristine();u.prev().toggleClass("ng-pristine",h.$pristine)}})}}}}]);$(document).off("select2-loaded");$(document).on("select2-loaded","select",function(){$(".select2-results").mCustomScrollbar({scrollInertia:0,mouseWheel:!0,keyboard:!0,advanced:{updateOnContentResize:!0,updateOnBrowserResize:!0}})});$(document).off("select2-close");$(document).on("select2-close","select",function(){_.defer(function(){$(".select2-results").mCustomScrollbar("destroy")},200)});$(document).off("select2-open");$(document).on("select2-open","select",function(n){var t=$(n.target),i=t.parents("#QuickView").length>0;i&&$("#select2-drop").css({zIndex:3e4})});!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var r=n(t),i=r["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)||parseInt(r.css("fontSize"),10)||16},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})});!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var r=n(t),i=r["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)||parseInt(r.css("fontSize"),10)||16},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})});!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"undefined"!=typeof module&&module.exports?module.exports=n:n(jQuery,window,document)}(function(n){!function(t){var i="function"==typeof define&&define.amd,r="undefined"!=typeof module&&module.exports,u="https:"==document.location.protocol?"https:":"http:";i||(r?require("jquery-mousewheel")(n):n.event.special.mousewheel||n("head").append(decodeURI("%3Cscript src="+u+"//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js%3E%3C/script%3E")));t()}(function(){var h,c="mCustomScrollbar",t="mCS",it=".mCustomScrollbar",ot={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},pt=0,b={},p=window.attachEvent&&!window.addEventListener?1:0,e=!1,i=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],s={init:function(r){var r=n.extend(!0,{},ot,r),e=v.call(this),u,f;if(r.live){if(u=r.liveSelector||this.selector||it,f=n(u),"off"===r.live)return void k(u);b[u]=setTimeout(function(){f.mCustomScrollbar(r);"once"===r.live&&f.length&&k(u)},500)}else k(u);return r.setWidth=r.set_width?r.set_width:r.setWidth,r.setHeight=r.set_height?r.set_height:r.setHeight,r.axis=r.horizontalScroll?"x":wt(r.axis),r.scrollInertia=r.scrollInertia>0&&r.scrollInertia<17?17:r.scrollInertia,"object"!=typeof r.mouseWheel&&1==r.mouseWheel&&(r.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),r.mouseWheel.scrollAmount=r.mouseWheelPixels?r.mouseWheelPixels:r.mouseWheel.scrollAmount,r.mouseWheel.normalizeDelta=r.advanced.normalizeMouseWheelDelta?r.advanced.normalizeMouseWheelDelta:r.mouseWheel.normalizeDelta,r.scrollButtons.scrollType=bt(r.scrollButtons.scrollType),st(r),n(e).each(function(){var u=n(this);if(!u.data(t)){u.data(t,{idx:++pt,opt:r,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:u.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var e=u.data(t),f=e.opt,o=u.data("mcs-axis"),h=u.data("mcs-scrollbar-position"),c=u.data("mcs-theme");o&&(f.axis=o);h&&(f.scrollbarPosition=h);c&&(f.theme=c,st(f));kt.call(this);e&&f.callbacks.onCreate&&"function"==typeof f.callbacks.onCreate&&f.callbacks.onCreate.call(this);n("#mCSB_"+e.idx+"_container img:not(."+i[2]+")").addClass(i[2]);s.update.call(null,u)}})},update:function(r,f){var e=r||v.call(this);return n(e).each(function(){var s=n(this),c;if(s.data(t)){var e=s.data(t),r=e.opt,h=n("#mCSB_"+e.idx+"_container"),a=n("#mCSB_"+e.idx),l=[n("#mCSB_"+e.idx+"_dragger_vertical"),n("#mCSB_"+e.idx+"_dragger_horizontal")];if(!h.length)return;e.tweenRunning&&o(s);f&&e&&r.callbacks.onBeforeUpdate&&"function"==typeof r.callbacks.onBeforeUpdate&&r.callbacks.onBeforeUpdate.call(this);s.hasClass(i[3])&&s.removeClass(i[3]);s.hasClass(i[4])&&s.removeClass(i[4]);a.css("max-height","none");a.height()!==s.height()&&a.css("max-height",s.height());dt.call(this);"y"===r.axis||r.advanced.autoExpandHorizontalScroll||h.css("width",ht(h));e.overflowed=ii.call(this);ct.call(this);r.autoDraggerLength&&ni.call(this);ti.call(this);ri.call(this);c=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)];"x"!==r.axis&&(e.overflowed[0]?l[0].height()>l[0].parent().height()?y.call(this):(u(s,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}),e.contentReset.y=null):(y.call(this),"y"===r.axis?g.call(this):"yx"===r.axis&&e.overflowed[1]&&u(s,c[1].toString(),{dir:"x",dur:0,overwrite:"none"})));"y"!==r.axis&&(e.overflowed[1]?l[1].width()>l[1].parent().width()?y.call(this):(u(s,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}),e.contentReset.x=null):(y.call(this),"x"===r.axis?g.call(this):"yx"===r.axis&&e.overflowed[0]&&u(s,c[0].toString(),{dir:"y",dur:0,overwrite:"none"})));f&&e&&(2===f&&r.callbacks.onImageLoad&&"function"==typeof r.callbacks.onImageLoad?r.callbacks.onImageLoad.call(this):3===f&&r.callbacks.onSelectorChange&&"function"==typeof r.callbacks.onSelectorChange?r.callbacks.onSelectorChange.call(this):r.callbacks.onUpdate&&"function"==typeof r.callbacks.onUpdate&&r.callbacks.onUpdate.call(this));et.call(this)}})},scrollTo:function(i,r){if("undefined"!=typeof i&&null!=i){var f=v.call(this);return n(f).each(function(){var s=n(this);if(s.data(t)){var o=s.data(t),h=o.opt,c={trigger:"external",scrollInertia:h.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},f=n.extend(!0,{},c,r),e=ft.call(this,i),l=f.scrollInertia>0&&f.scrollInertia<17?17:f.scrollInertia;e[0]=at.call(this,e[0],"y");e[1]=at.call(this,e[1],"x");f.moveDragger&&(e[0]*=o.scrollRatio.y,e[1]*=o.scrollRatio.x);f.dur=wi()?0:l;setTimeout(function(){null!==e[0]&&"undefined"!=typeof e[0]&&"x"!==h.axis&&o.overflowed[0]&&(f.dir="y",f.overwrite="all",u(s,e[0].toString(),f));null!==e[1]&&"undefined"!=typeof e[1]&&"y"!==h.axis&&o.overflowed[1]&&(f.dir="x",f.overwrite="none",u(s,e[1].toString(),f))},f.timeout)}})}},stop:function(){var i=v.call(this);return n(i).each(function(){var i=n(this);i.data(t)&&o(i)})},disable:function(r){var u=v.call(this);return n(u).each(function(){var u=n(this);u.data(t)&&(u.data(t),et.call(this,"remove"),g.call(this),r&&y.call(this),ct.call(this,!0),u.addClass(i[3]))})},destroy:function(){var r=v.call(this);return n(r).each(function(){var f=n(this);if(f.data(t)){var u=f.data(t),e=u.opt,s=n("#mCSB_"+u.idx),o=n("#mCSB_"+u.idx+"_container"),h=n(".mCSB_"+u.idx+"_scrollbar");e.live&&k(e.liveSelector||n(r).selector);et.call(this,"remove");g.call(this);y.call(this);f.removeData(t);a(this,"mcs");h.remove();o.find("img."+i[2]).removeClass(i[2]);s.replaceWith(o.contents());f.removeClass(c+" _"+t+"_"+u.idx+" "+i[6]+" "+i[7]+" "+i[5]+" "+i[3]).addClass(i[4])}})}},v=function(){return"object"!=typeof n(this)||n(this).length<1?it:this},st=function(t){t.autoDraggerLength=n.inArray(t.theme,["rounded","rounded-dark","rounded-dots","rounded-dots-dark"])>-1?!1:t.autoDraggerLength;t.autoExpandScrollbar=n.inArray(t.theme,["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"])>-1?!1:t.autoExpandScrollbar;t.scrollButtons.enable=n.inArray(t.theme,["minimal","minimal-dark"])>-1?!1:t.scrollButtons.enable;t.autoHideScrollbar=n.inArray(t.theme,["minimal","minimal-dark"])>-1?!0:t.autoHideScrollbar;t.scrollbarPosition=n.inArray(t.theme,["minimal","minimal-dark"])>-1?"outside":t.scrollbarPosition},k=function(n){b[n]&&(clearTimeout(b[n]),a(b,n))},wt=function(n){return"yx"===n||"xy"===n||"auto"===n?"yx":"x"===n||"horizontal"===n?"x":"y"},bt=function(n){return"stepped"===n||"pixels"===n||"step"===n||"click"===n?"stepped":"stepless"},kt=function(){var f=n(this),u=f.data(t),r=u.opt,l=r.autoExpandScrollbar?" "+i[1]+"_expand":"",o=["<div id='mCSB_"+u.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+u.idx+"_scrollbar mCS-"+r.theme+" mCSB_scrollTools_vertical"+l+"'><div class='"+i[12]+"'><div id='mCSB_"+u.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /><\/div><div class='mCSB_draggerRail' /><\/div><\/div>","<div id='mCSB_"+u.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+u.idx+"_scrollbar mCS-"+r.theme+" mCSB_scrollTools_horizontal"+l+"'><div class='"+i[12]+"'><div id='mCSB_"+u.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /><\/div><div class='mCSB_draggerRail' /><\/div><\/div>"],v="yx"===r.axis?"mCSB_vertical_horizontal":"x"===r.axis?"mCSB_horizontal":"mCSB_vertical",a="yx"===r.axis?o[0]+o[1]:"x"===r.axis?o[1]:o[0],y="yx"===r.axis?"<div id='mCSB_"+u.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",p=r.autoHideScrollbar?" "+i[6]:"",w="x"!==r.axis&&"rtl"===u.langDir?" "+i[7]:"",h,s,e;r.setWidth&&f.css("width",r.setWidth);r.setHeight&&f.css("height",r.setHeight);r.setLeft="y"!==r.axis&&"rtl"===u.langDir?"989999px":r.setLeft;f.addClass(c+" _"+t+"_"+u.idx+p+w).wrapInner("<div id='mCSB_"+u.idx+"' class='mCustomScrollBox mCS-"+r.theme+" "+v+"'><div id='mCSB_"+u.idx+"_container' class='mCSB_container' style='position:relative; top:"+r.setTop+"; left:"+r.setLeft+";' dir='"+u.langDir+"' /><\/div>");h=n("#mCSB_"+u.idx);s=n("#mCSB_"+u.idx+"_container");"y"===r.axis||r.advanced.autoExpandHorizontalScroll||s.css("width",ht(s));"outside"===r.scrollbarPosition?("static"===f.css("position")&&f.css("position","relative"),f.css("overflow","visible"),h.addClass("mCSB_outside").after(a)):(h.addClass("mCSB_inside").append(a),s.wrap(y));gt.call(this);e=[n("#mCSB_"+u.idx+"_dragger_vertical"),n("#mCSB_"+u.idx+"_dragger_horizontal")];e[0].css("min-height",e[0].height());e[1].css("min-width",e[1].width())},ht=function(t){var i=[t[0].scrollWidth,Math.max.apply(Math,t.children().map(function(){return n(this).outerWidth(!0)}).get())],r=t.parent().width();return i[0]>r?i[0]:i[1]>r?i[1]:"100%"},dt=function(){var e=n(this),f=e.data(t),r=f.opt,i=n("#mCSB_"+f.idx+"_container"),u;r.advanced.autoExpandHorizontalScroll&&"y"!==r.axis&&(i.css({width:"auto","min-width":0,"overflow-x":"scroll"}),u=Math.ceil(i[0].scrollWidth),3===r.advanced.autoExpandHorizontalScroll||2!==r.advanced.autoExpandHorizontalScroll&&u>i.parent().width()?i.css({width:u,"min-width":"100%","overflow-x":"inherit"}):i.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap())},gt=function(){var s=n(this),o=s.data(t),u=o.opt,h=n(".mCSB_"+o.idx+"_scrollbar:first"),f=tt(u.scrollButtons.tabindex)?"tabindex='"+u.scrollButtons.tabindex+"'":"",r=["<a href='#' class='"+i[13]+"' "+f+" />","<a href='#' class='"+i[14]+"' "+f+" />","<a href='#' class='"+i[15]+"' "+f+" />","<a href='#' class='"+i[16]+"' "+f+" />"],e=["x"===u.axis?r[2]:r[0],"x"===u.axis?r[3]:r[1],r[2],r[3]];u.scrollButtons.enable&&h.prepend(e[0]).append(e[1]).next(".mCSB_scrollTools").prepend(e[2]).append(e[3])},ni=function(){var s=n(this),u=s.data(t),f=n("#mCSB_"+u.idx),e=n("#mCSB_"+u.idx+"_container"),r=[n("#mCSB_"+u.idx+"_dragger_vertical"),n("#mCSB_"+u.idx+"_dragger_horizontal")],o=[f.height()/e.outerHeight(!1),f.width()/e.outerWidth(!1)],i=[parseInt(r[0].css("min-height")),Math.round(o[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(o[1]*r[1].parent().width())],h=p&&i[1]<i[0]?i[0]:i[1],c=p&&i[3]<i[2]?i[2]:i[3];r[0].css({height:h,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":i[0]+"px"});r[1].css({width:c,"max-width":r[1].parent().width()-10})},ti=function(){var s=n(this),i=s.data(t),u=n("#mCSB_"+i.idx),f=n("#mCSB_"+i.idx+"_container"),r=[n("#mCSB_"+i.idx+"_dragger_vertical"),n("#mCSB_"+i.idx+"_dragger_horizontal")],e=[f.outerHeight(!1)-u.height(),f.outerWidth(!1)-u.width()],o=[e[0]/(r[0].parent().height()-r[0].height()),e[1]/(r[1].parent().width()-r[1].width())];i.scrollRatio={y:o[0],x:o[1]}},d=function(n,t,r){var f=r?i[0]+"_expanded":"",u=n.closest(".mCSB_scrollTools");"active"===t?(n.toggleClass(i[0]+" "+f),u.toggleClass(i[1]),n[0]._draggable=n[0]._draggable?0:1):n[0]._draggable||("hide"===t?(n.removeClass(i[0]),u.removeClass(i[1])):(n.addClass(i[0]),u.addClass(i[1])))},ii=function(){var h=n(this),r=h.data(t),e=n("#mCSB_"+r.idx),i=n("#mCSB_"+r.idx+"_container"),u=null==r.overflowed?i.height():i.outerHeight(!1),f=null==r.overflowed?i.width():i.outerWidth(!1),o=i[0].scrollHeight,s=i[0].scrollWidth;return o>u&&(u=o),s>f&&(f=s),[u>e.height(),f>e.width()]},y=function(){var r=n(this),i=r.data(t),f=i.opt,c=n("#mCSB_"+i.idx),s=n("#mCSB_"+i.idx+"_container"),h=[n("#mCSB_"+i.idx+"_dragger_vertical"),n("#mCSB_"+i.idx+"_dragger_horizontal")],e;(o(r),("x"!==f.axis&&!i.overflowed[0]||"y"===f.axis&&i.overflowed[0])&&(h[0].add(s).css("top",0),u(r,"_resetY")),"y"!==f.axis&&!i.overflowed[1]||"x"===f.axis&&i.overflowed[1])&&(e=dx=0,"rtl"===i.langDir&&(e=c.width()-s.outerWidth(!1),dx=Math.abs(e/i.scrollRatio.x)),s.css("left",e),h[1].css("left",dx),u(r,"_resetX"))},ri=function(){function u(){e=setTimeout(function(){n.event.special.mousewheel?(clearTimeout(e),oi.call(f[0])):u()},100)}var f=n(this),r=f.data(t),i=r.opt,e;r.bindEvents||((ui.call(this),i.contentTouchScroll&&fi.call(this),ei.call(this),i.mouseWheel.enable)&&u(),hi.call(this),li.call(this),i.advanced.autoScrollOnFocus&&ci.call(this),i.scrollButtons.enable&&ai.call(this),i.keyboard.enable&&vi.call(this),r.bindEvents=!0)},g=function(){var f=n(this),r=f.data(t),u=r.opt,o=t+"_"+r.idx,s=".mCSB_"+r.idx+"_scrollbar",e=n("#mCSB_"+r.idx+",#mCSB_"+r.idx+"_container,#mCSB_"+r.idx+"_container_wrapper,"+s+" ."+i[12]+",#mCSB_"+r.idx+"_dragger_vertical,#mCSB_"+r.idx+"_dragger_horizontal,"+s+">a"),h=n("#mCSB_"+r.idx+"_container");u.advanced.releaseDraggableSelectors&&e.add(n(u.advanced.releaseDraggableSelectors));u.advanced.extraDraggableSelectors&&e.add(n(u.advanced.extraDraggableSelectors));r.bindEvents&&(n(document).add(n(!l()||top.document)).unbind("."+o),e.each(function(){n(this).unbind("."+o)}),clearTimeout(f[0]._focusTimeout),a(f[0],"_focusTimeout"),clearTimeout(r.sequential.step),a(r.sequential,"step"),clearTimeout(h[0].onCompleteTimeout),a(h[0],"onCompleteTimeout"),r.bindEvents=!1)},ct=function(r){var h=n(this),u=h.data(t),o=u.opt,c=n("#mCSB_"+u.idx+"_container_wrapper"),f=c.length?c:n("#mCSB_"+u.idx+"_container"),e=[n("#mCSB_"+u.idx+"_scrollbar_vertical"),n("#mCSB_"+u.idx+"_scrollbar_horizontal")],s=[e[0].find(".mCSB_dragger"),e[1].find(".mCSB_dragger")];"x"!==o.axis&&(u.overflowed[0]&&!r?(e[0].add(s[0]).add(e[0].children("a")).css("display","block"),f.removeClass(i[8]+" "+i[10])):(o.alwaysShowScrollbar?(2!==o.alwaysShowScrollbar&&s[0].css("display","none"),f.removeClass(i[10])):(e[0].css("display","none"),f.addClass(i[10])),f.addClass(i[8])));"y"!==o.axis&&(u.overflowed[1]&&!r?(e[1].add(s[1]).add(e[1].children("a")).css("display","block"),f.removeClass(i[9]+" "+i[11])):(o.alwaysShowScrollbar?(2!==o.alwaysShowScrollbar&&s[1].css("display","none"),f.removeClass(i[11])):(e[1].css("display","none"),f.addClass(i[11])),f.addClass(i[9])));u.overflowed[0]||u.overflowed[1]?h.removeClass(i[5]):h.addClass(i[5])},r=function(t){var e=t.type,i=t.target.ownerDocument!==document&&null!==frameElement?[n(frameElement).offset().top,n(frameElement).offset().left]:null,u=l()&&t.target.ownerDocument!==top.document&&null!==frameElement?[n(t.view.frameElement).offset().top,n(t.view.frameElement).offset().left]:[0,0],r,f;switch(e){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return i?[t.originalEvent.pageY-i[0]+u[0],t.originalEvent.pageX-i[1]+u[1],!1]:[t.originalEvent.pageY,t.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":return r=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],f=t.originalEvent.touches.length||t.originalEvent.changedTouches.length,t.target.ownerDocument!==document?[r.screenY,r.screenX,f>1]:[r.pageY,r.pageX,f>1];default:return i?[t.pageY-i[0]+u[0],t.pageX-i[1]+u[1],!1]:[t.pageY,t.pageX,!1]}},ui=function(){function k(n,t,r,f){var e,o;(w[0].idleTimer=h.scrollInertia<233?250:0,i.attr("id")===y[1])?(e="x",o=(i[0].offsetLeft-t+f)*s.scrollRatio.x):(e="y",o=(i[0].offsetTop-n+r)*s.scrollRatio.y);u(v,o.toString(),{dir:e,drag:!0})}var i,c,a,v=n(this),s=v.data(t),h=s.opt,f=t+"_"+s.idx,y=["mCSB_"+s.idx+"_dragger_vertical","mCSB_"+s.idx+"_dragger_horizontal"],w=n("#mCSB_"+s.idx+"_container"),b=n("#"+y[0]+",#"+y[1]),g=h.advanced.releaseDraggableSelectors?b.add(n(h.advanced.releaseDraggableSelectors)):b,nt=h.advanced.extraDraggableSelectors?n(!l()||top.document).add(n(h.advanced.extraDraggableSelectors)):n(!l()||top.document);b.bind("contextmenu."+f,function(n){n.preventDefault()}).bind("mousedown."+f+" touchstart."+f+" pointerdown."+f+" MSPointerDown."+f,function(t){if(t.stopImmediatePropagation(),t.preventDefault(),yt(t)){e=!0;p&&(document.onselectstart=function(){return!1});lt.call(w,!1);o(v);i=n(this);var u=i.offset(),f=r(t)[0]-u.top,s=r(t)[1]-u.left,l=i.height()+u.top,y=i.width()+u.left;l>f&&f>0&&y>s&&s>0&&(c=f,a=s);d(i,"active",h.autoExpandScrollbar)}}).bind("touchmove."+f,function(n){n.stopImmediatePropagation();n.preventDefault();var t=i.offset(),u=r(n)[0]-t.top,f=r(n)[1]-t.left;k(c,a,u,f)});n(document).add(nt).bind("mousemove."+f+" pointermove."+f+" MSPointerMove."+f,function(n){if(i){var t=i.offset(),u=r(n)[0]-t.top,f=r(n)[1]-t.left;if(c===u&&a===f)return;k(c,a,u,f)}}).add(g).bind("mouseup."+f+" touchend."+f+" pointerup."+f+" MSPointerUp."+f,function(){i&&(d(i,"active",h.autoExpandScrollbar),i=null);e=!1;p&&(document.onselectstart=null);lt.call(w,!0)})},fi=function(){function at(n){if(!nt(n)||e||r(n)[2])return void(h=0);h=1;it=0;rt=0;st=1;g.removeClass("mCS_touch_action");var t=b.offset();k=r(n)[0]-t.top;d=r(n)[1]-t.left;v=[r(n)[0],r(n)[1]]}function vt(n){var c,l,a,y;if(nt(n)&&!e&&!r(n)[2]&&(f.documentTouchScroll||n.preventDefault(),n.stopImmediatePropagation(),(!rt||it)&&st)){gt=w();var o=ut.offset(),t=r(n)[0]-o.top,u=r(n)[1]-o.left,h="mcsLinearOut";(et.push(t),ot.push(u),v[2]=Math.abs(r(n)[0]-v[0]),v[3]=Math.abs(r(n)[1]-v[1]),i.overflowed[0])&&(c=ft[0].parent().height()-ft[0].height(),l=k-t>0&&t-k>-(c*i.scrollRatio.y)&&(2*v[3]<v[2]||"yx"===f.axis));i.overflowed[1]&&(a=ft[1].parent().width()-ft[1].width(),y=d-u>0&&u-d>-(a*i.scrollRatio.x)&&(2*v[2]<v[3]||"yx"===f.axis));l||y?(ii||n.preventDefault(),it=1):(rt=1,g.addClass("mCS_touch_action"));ii&&n.preventDefault();s="yx"===f.axis?[k-t,d-u]:"x"===f.axis?[null,d-u]:[k-t,null];b[0].idleTimer=250;i.overflowed[0]&&tt(s[0],ni,h,"y","all",!0);i.overflowed[1]&&tt(s[1],ni,h,"x",lt,!0)}}function yt(n){if(!nt(n)||e||r(n)[2])return void(h=0);h=1;n.stopImmediatePropagation();o(g);dt=w();var t=ut.offset();bt=r(n)[0]-t.top;kt=r(n)[1]-t.left;et=[];ot=[]}function pt(n){var t,u,h;if(nt(n)&&!e&&!r(n)[2]){st=0;n.stopImmediatePropagation();it=0;rt=0;ht=w();var l=ut.offset(),a=r(n)[0]-l.top,v=r(n)[1]-l.left;if(!(ht-gt>30)){c=1e3/(ht-dt);var p="mcsEaseOut",o=2.5>c,k=o?[et[et.length-2],ot[ot.length-2]]:[0,0];y=o?[a-k[0],v-k[1]]:[a-bt,v-kt];t=[Math.abs(y[0]),Math.abs(y[1])];c=o?[Math.abs(y[0]/4),Math.abs(y[1]/4)]:[c,c];u=[Math.abs(b[0].offsetTop)-y[0]*wt(t[0]/c[0],c[0]),Math.abs(b[0].offsetLeft)-y[1]*wt(t[1]/c[1],c[1])];s="yx"===f.axis?[u[0],u[1]]:"x"===f.axis?[null,u[1]]:[u[0],null];ct=[4*t[0]+f.scrollInertia,4*t[1]+f.scrollInertia];h=parseInt(f.contentTouchScroll)||0;s[0]=t[0]>h?s[0]:0;s[1]=t[1]>h?s[1]:0;i.overflowed[0]&&tt(s[0],ct[0],p,"y",lt,!1);i.overflowed[1]&&tt(s[1],ct[1],p,"x",lt,!1)}}}function wt(n,t){var i=[1.5*t,2*t,t/1.5,t/2];return n>90?t>4?i[0]:i[3]:n>60?t>3?i[3]:i[2]:n>30?t>8?i[1]:t>6?i[0]:t>4?t:i[2]:t>8?t:i[3]}function tt(n,t,i,r,f,e){n&&u(g,n.toString(),{dur:t,scrollEasing:i,dir:r,overwrite:f,drag:e})}var st,k,d,bt,kt,dt,gt,ht,y,c,s,ct,it,rt,g=n(this),i=g.data(t),f=i.opt,a=t+"_"+i.idx,ut=n("#mCSB_"+i.idx),b=n("#mCSB_"+i.idx+"_container"),ft=[n("#mCSB_"+i.idx+"_dragger_vertical"),n("#mCSB_"+i.idx+"_dragger_horizontal")],et=[],ot=[],ni=0,lt="yx"===f.axis?"none":"all",v=[],ti=b.find("iframe"),p=["touchstart."+a+" pointerdown."+a+" MSPointerDown."+a,"touchmove."+a+" pointermove."+a+" MSPointerMove."+a,"touchend."+a+" pointerup."+a+" MSPointerUp."+a],ii=void 0!==document.body.style.touchAction&&""!==document.body.style.touchAction;b.bind(p[0],function(n){at(n)}).bind(p[1],function(n){vt(n)});ut.bind(p[0],function(n){yt(n)}).bind(p[2],function(n){pt(n)});ti.length&&ti.each(function(){n(this).bind("load",function(){l(this)&&n(this.contentDocument||this.contentWindow.document).bind(p[0],function(n){at(n);yt(n)}).bind(p[1],function(n){vt(n)}).bind(p[2],function(n){pt(n)})})})},ei=function(){function y(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function i(n,t,i){l.type=i&&u?"stepped":"stepless";l.scrollAmount=10;ut(a,n,t,"mcsLinearOut",i?60:null)}var u,a=n(this),f=a.data(t),v=f.opt,l=f.sequential,s=t+"_"+f.idx,o=n("#mCSB_"+f.idx+"_container"),c=o.parent();o.bind("mousedown."+s,function(){h||u||(u=1,e=!0)}).add(document).bind("mousemove."+s,function(n){if(!h&&u&&y()){var s=o.offset(),t=r(n)[0]-s.top+o[0].offsetTop,e=r(n)[1]-s.left+o[0].offsetLeft;t>0&&t<c.height()&&e>0&&e<c.width()?l.step&&i("off",null,"stepped"):("x"!==v.axis&&f.overflowed[0]&&(0>t?i("on",38):t>c.height()&&i("on",40)),"y"!==v.axis&&f.overflowed[1]&&(0>e?i("on",37):e>c.width()&&i("on",39)))}}).bind("mouseup."+s+" dragend."+s,function(){h||(u&&(u=0,i("off",null)),e=!1)})},oi=function(){function h(t,h){var a,v;if(o(s),!si(s,t.target)){if(a="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):p&&t.deltaFactor<100?100:t.deltaFactor||100,v=i.scrollInertia,"x"===i.axis||"x"===i.mouseWheel.axis)var y="x",l=[Math.round(a*r.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],w="auto"!==i.mouseWheel.scrollAmount?l[1]:l[0]>=e.width()?.9*e.width():l[0],k=Math.abs(n("#mCSB_"+r.idx+"_container")[0].offsetLeft),b=f[1][0].offsetLeft,d=f[1].parent().width()-f[1].width(),c="y"===i.mouseWheel.axis?t.deltaY||h:t.deltaX;else var y="y",l=[Math.round(a*r.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],w="auto"!==i.mouseWheel.scrollAmount?l[1]:l[0]>=e.height()?.9*e.height():l[0],k=Math.abs(n("#mCSB_"+r.idx+"_container")[0].offsetTop),b=f[0][0].offsetTop,d=f[0].parent().height()-f[0].height(),c=t.deltaY||h;("y"!==y||r.overflowed[0])&&("x"!==y||r.overflowed[1])&&((i.mouseWheel.invert||t.webkitDirectionInvertedFromDevice)&&(c=-c),i.mouseWheel.normalizeDelta&&(c=0>c?-1:1),(c>0&&0!==b||0>c&&b!==d||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),t.deltaFactor<5&&!i.mouseWheel.normalizeDelta&&(w=t.deltaFactor,v=17),u(s,(k-c*w).toString(),{dir:y,dur:v}))}}if(n(this).data(t)){var s=n(this),r=s.data(t),i=r.opt,c=t+"_"+r.idx,e=n("#mCSB_"+r.idx),f=[n("#mCSB_"+r.idx+"_dragger_vertical"),n("#mCSB_"+r.idx+"_dragger_horizontal")],a=n("#mCSB_"+r.idx+"_container").find("iframe");a.length&&a.each(function(){n(this).bind("load",function(){l(this)&&n(this.contentDocument||this.contentWindow.document).bind("mousewheel."+c,function(n,t){h(n,t)})})});e.bind("mousewheel."+c,function(n,t){h(n,t)})}},rt={},l=function(t){var r=!1,i=!1,u=null,f;if(void 0===t?i="#empty":void 0!==n(t).attr("id")&&(i=n(t).attr("id")),i!==!1&&void 0!==rt[i])return rt[i];if(t){try{f=t.contentDocument||t.contentWindow.document;u=f.body.innerHTML}catch(e){}r=null!==u}else{try{f=top.document;u=f.body.innerHTML}catch(e){}r=null!==u}return i!==!1&&(rt[i]=r),r},lt=function(n){var t=this.find("iframe"),i;t.length&&(i=n?"auto":"none",t.css("pointer-events",i))},si=function(i,r){var u=r.nodeName.toLowerCase(),f=i.data(t).opt.mouseWheel.disableOver;return n.inArray(u,f)>-1&&!(n.inArray(u,["select","textarea"])>-1&&!n(r).is(":focus"))},hi=function(){var s,h=n(this),f=h.data(t),r=t+"_"+f.idx,c=n("#mCSB_"+f.idx+"_container"),l=c.parent(),a=n(".mCSB_"+f.idx+"_scrollbar ."+i[12]);a.bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r,function(t){e=!0;n(t.target).hasClass("mCSB_dragger")||(s=1)}).bind("touchend."+r+" pointerup."+r+" MSPointerUp."+r,function(){e=!1}).bind("click."+r,function(t){var r,e;if(s&&(s=0,n(t.target).hasClass(i[12])||n(t.target).hasClass("mCSB_draggerRail"))){if(o(h),r=n(this),e=r.find(".mCSB_dragger"),r.parent(".mCSB_scrollTools_horizontal").length>0){if(!f.overflowed[1])return;var v="x",a=t.pageX>e.offset().left?-1:1,y=Math.abs(c[0].offsetLeft)-a*.9*l.width()}else{if(!f.overflowed[0])return;var v="y",a=t.pageY>e.offset().top?-1:1,y=Math.abs(c[0].offsetTop)-a*.9*l.height()}u(h,y.toString(),{dir:v,scrollEasing:"mcsEaseInOut"})}})},ci=function(){var i=n(this),s=i.data(t),e=s.opt,c=t+"_"+s.idx,r=n("#mCSB_"+s.idx+"_container"),h=r.parent();r.bind("focusin."+c,function(){var t=n(document.activeElement),c=r.find(".mCustomScrollBox").length,s=0;t.is(e.advanced.autoScrollOnFocus)&&(o(i),clearTimeout(i[0]._focusTimeout),i[0]._focusTimer=c?(s+17)*c:0,i[0]._focusTimeout=setTimeout(function(){var n=[f(t)[0],f(t)[1]],o=[r[0].offsetTop,r[0].offsetLeft],c=[o[0]+n[0]>=0&&o[0]+n[0]<h.height()-t.outerHeight(!1),o[1]+n[1]>=0&&o[0]+n[1]<h.width()-t.outerWidth(!1)],l="yx"!==e.axis||c[0]||c[1]?"all":"none";"x"===e.axis||c[0]||u(i,n[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:l,dur:s});"y"===e.axis||c[1]||u(i,n[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:l,dur:s})},i[0]._focusTimer))})},li=function(){var u=n(this),i=u.data(t),f=t+"_"+i.idx,r=n("#mCSB_"+i.idx+"_container").parent();r.bind("scroll."+f,function(){0===r.scrollTop()&&0===r.scrollLeft()||n(".mCSB_"+i.idx+"_scrollbar").css("visibility","hidden")})},ai=function(){var f=n(this),r=f.data(t),o=r.opt,u=r.sequential,i=t+"_"+r.idx,s=".mCSB_"+r.idx+"_scrollbar",h=n(s+">a");h.bind("contextmenu."+i,function(n){n.preventDefault()}).bind("mousedown."+i+" touchstart."+i+" pointerdown."+i+" MSPointerDown."+i+" mouseup."+i+" touchend."+i+" pointerup."+i+" MSPointerUp."+i+" mouseout."+i+" pointerout."+i+" MSPointerOut."+i+" click."+i,function(t){function i(n,t){u.scrollAmount=o.scrollButtons.scrollAmount;ut(f,n,t)}if(t.preventDefault(),yt(t)){var s=n(this).attr("class");switch(u.type=o.scrollButtons.scrollType,t.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===u.type)return;e=!0;r.tweenRunning=!1;i("on",s);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===u.type)return;e=!1;u.dir&&i("off",s);break;case"click":if("stepped"!==u.type||r.tweenRunning)return;i("on",s)}}})},vi=function(){function a(t){function w(n,t){s.type=r.keyboard.scrollType;s.scrollAmount=r.keyboard.scrollAmount;"stepped"===s.type&&i.tweenRunning||ut(e,n,t)}var c,y,p,l,a;switch(t.type){case"blur":i.tweenRunning&&s.dir&&w("off",null);break;case"keydown":case"keyup":if(c=t.keyCode?t.keyCode:t.which,y="on","x"!==r.axis&&(38===c||40===c)||"y"!==r.axis&&(37===c||39===c)){if((38===c||40===c)&&!i.overflowed[0]||(37===c||39===c)&&!i.overflowed[1])return;"keyup"===t.type&&(y="off");n(document.activeElement).is(v)||(t.preventDefault(),t.stopImmediatePropagation(),w(y,c))}else 33===c||34===c?((i.overflowed[0]||i.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type)&&(o(e),p=34===c?-1:1,"x"===r.axis||"yx"===r.axis&&i.overflowed[1]&&!i.overflowed[0]?(l="x",a=Math.abs(f[0].offsetLeft)-p*.9*h.width()):(l="y",a=Math.abs(f[0].offsetTop)-p*.9*h.height()),u(e,a.toString(),{dir:l,scrollEasing:"mcsEaseInOut"})):35!==c&&36!==c||n(document.activeElement).is(v)||((i.overflowed[0]||i.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"!==t.type)||("x"===r.axis||"yx"===r.axis&&i.overflowed[1]&&!i.overflowed[0]?(l="x",a=35===c?Math.abs(h.width()-f.outerWidth(!1)):0):(l="y",a=35===c?Math.abs(h.height()-f.outerHeight(!1)):0),u(e,a.toString(),{dir:l,scrollEasing:"mcsEaseInOut"}))}}var e=n(this),i=e.data(t),r=i.opt,s=i.sequential,c=t+"_"+i.idx,w=n("#mCSB_"+i.idx),f=n("#mCSB_"+i.idx+"_container"),h=f.parent(),v="input,textarea,select,datalist,keygen,[contenteditable='true']",y=f.find("iframe"),p=["blur."+c+" keydown."+c+" keyup."+c];y.length&&y.each(function(){n(this).bind("load",function(){l(this)&&n(this.contentDocument||this.contentWindow.document).bind(p[0],function(n){a(n)})})});w.attr("tabindex","0").bind(p[0],function(n){a(n)})},ut=function(r,f,e,s,h){function y(n){l.snapAmount&&(c.scrollAmount=l.snapAmount instanceof Array?"x"===c.dir[0]?l.snapAmount[1]:l.snapAmount[0]:l.snapAmount);var i="stepped"!==c.type,f=h?h:n?i?k/1.5:d:1e3/60,e=n?i?7.5:40:2.5,t=[Math.abs(p[0].offsetTop),Math.abs(p[0].offsetLeft)],o=[v.scrollRatio.y>10?10:v.scrollRatio.y,v.scrollRatio.x>10?10:v.scrollRatio.x],w="x"===c.dir[0]?t[1]+c.dir[1]*o[1]*e:t[0]+c.dir[1]*o[0]*e,b="x"===c.dir[0]?t[1]+c.dir[1]*parseInt(c.scrollAmount):t[0]+c.dir[1]*parseInt(c.scrollAmount),a="auto"!==c.scrollAmount?b:w,g=s?s:n?i?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",nt=!!n;return n&&17>f&&(a="x"===c.dir[0]?t[1]:t[0]),u(r,a.toString(),{dir:c.dir[0],scrollEasing:g,dur:f,onComplete:nt}),n?void(c.dir=!1):(clearTimeout(c.step),void(c.step=setTimeout(function(){y()},f)))}function b(){clearTimeout(c.step);a(c,"step");o(r)}var v=r.data(t),l=v.opt,c=v.sequential,p=n("#mCSB_"+v.idx+"_container"),w="stepped"===c.type,k=l.scrollInertia<26?26:l.scrollInertia,d=l.scrollInertia<1?17:l.scrollInertia;switch(f){case"on":if(c.dir=[e===i[16]||e===i[15]||39===e||37===e?"x":"y",e===i[13]||e===i[15]||38===e||37===e?-1:1],o(r),tt(e)&&"stepped"===c.type)return;y(w);break;case"off":b();(w||v.tweenRunning&&c.dir)&&y(!0)}},ft=function(i){var u=n(this).data(t).opt,r=[];return"function"==typeof i&&(i=i()),i instanceof Array?r=i.length>1?[i[0],i[1]]:"x"===u.axis?[null,i[0]]:[i[0],null]:(r[0]=i.y?i.y:i.x||"x"===u.axis?null:i,r[1]=i.x?i.x:i.y||"y"===u.axis?null:i),"function"==typeof r[0]&&(r[0]=r[0]()),"function"==typeof r[1]&&(r[1]=r[1]()),r},at=function(i,r){var h,e;if(null!=i&&"undefined"!=typeof i){var c=n(this),l=c.data(t),v=l.opt,u=n("#mCSB_"+l.idx+"_container"),o=u.parent(),y=typeof i;r||(r="x"===v.axis?"x":"y");var p="x"===r?u.outerWidth(!1)-o.width():u.outerHeight(!1)-o.height(),a="x"===r?u[0].offsetLeft:u[0].offsetTop,w="x"===r?"left":"top";switch(y){case"function":return i();case"object":return(e=i.jquery?i:n(i),!e.length)?void 0:"x"===r?f(e)[1]:f(e)[0];case"string":case"number":return tt(i)?Math.abs(i):-1!==i.indexOf("%")?Math.abs(p*parseInt(i)/100):-1!==i.indexOf("-=")?Math.abs(a-parseInt(i.split("-=")[1])):-1!==i.indexOf("+=")?(h=a+parseInt(i.split("+=")[1]),h>=0?0:Math.abs(h)):-1!==i.indexOf("px")&&tt(i.split("px")[0])?Math.abs(i.split("px")[0]):"top"===i||"left"===i?0:"bottom"===i?Math.abs(o.height()-u.outerHeight(!1)):"right"===i?Math.abs(o.width()-u.outerWidth(!1)):"first"===i||"last"===i?(e=u.find(":"+i),"x"===r?f(e)[1]:f(e)[0]):n(i).length?"x"===r?f(n(i))[1]:f(n(i))[0]:(u.css(w,i),void s.update.call(null,c[0]))}}},et=function(r){function c(){return clearTimeout(e[0].autoUpdate),0===o.parents("html").length?void(o=null):void(e[0].autoUpdate=setTimeout(function(){return f.advanced.updateOnSelectorChange&&(u.poll.change.n=v(),u.poll.change.n!==u.poll.change.o)?(u.poll.change.o=u.poll.change.n,void h(3)):f.advanced.updateOnContentResize&&(u.poll.size.n=o[0].scrollHeight+o[0].scrollWidth+e[0].offsetHeight+o[0].offsetHeight+o[0].offsetWidth,u.poll.size.n!==u.poll.size.o)?(u.poll.size.o=u.poll.size.n,void h(1)):!f.advanced.updateOnImageLoad||"auto"===f.advanced.updateOnImageLoad&&"y"===f.axis||(u.poll.img.n=e.find("img").length,u.poll.img.n===u.poll.img.o)?void((f.advanced.updateOnSelectorChange||f.advanced.updateOnContentResize||f.advanced.updateOnImageLoad)&&c()):(u.poll.img.o=u.poll.img.n,void e.find("img").each(function(){l(this)}))},f.advanced.autoUpdateTimeout))}function l(t){function u(n,t){return function(){return t.apply(n,arguments)}}function f(){this.onload=null;n(t).addClass(i[2]);h(2)}if(n(t).hasClass(i[2]))return void h();var r=new Image;r.onload=u(r,f);r.src=t.src}function v(){f.advanced.updateOnSelectorChange===!0&&(f.advanced.updateOnSelectorChange="*");var n=0,t=e.find(f.advanced.updateOnSelectorChange);return f.advanced.updateOnSelectorChange&&t.length>0&&t.each(function(){n+=this.offsetHeight+this.offsetWidth}),n}function h(n){clearTimeout(e[0].autoUpdate);s.update.call(null,o[0],n)}var o=n(this),u=o.data(t),f=u.opt,e=n("#mCSB_"+u.idx+"_container");return r?(clearTimeout(e[0].autoUpdate),void a(e[0],"autoUpdate")):void c()},yi=function(n,t,i){return Math.round(n/t)*t-i},o=function(i){var r=i.data(t),u=n("#mCSB_"+r.idx+"_container,#mCSB_"+r.idx+"_container_wrapper,#mCSB_"+r.idx+"_dragger_vertical,#mCSB_"+r.idx+"_dragger_horizontal");u.each(function(){pi.call(this)})},u=function(i,r,u){function h(n){return f&&e.callbacks[n]&&"function"==typeof e.callbacks[n]}function rt(){return[e.callbacks.alwaysTriggerOffsets||w>=l[0]+v,e.callbacks.alwaysTriggerOffsets||-y>=w]}function a(){var n=[o[0].offsetTop,o[0].offsetLeft],t=[c[0].offsetTop,c[0].offsetLeft],r=[o.outerHeight(!1),o.outerWidth(!1)],f=[p.height(),p.width()];i[0].mcs={content:o,top:n[0],left:n[1],draggerTop:t[0],draggerLeft:t[1],topPct:Math.round(100*Math.abs(n[0])/(Math.abs(r[0])-f[0])),leftPct:Math.round(100*Math.abs(n[1])/(Math.abs(r[1])-f[1])),direction:u.dir}}var f=i.data(t),e=f.opt,ut={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:e.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},u=n.extend(ut,u),k=[u.dur,u.drag?0:u.dur],p=n("#mCSB_"+f.idx),o=n("#mCSB_"+f.idx+"_container"),b=o.parent(),g=e.callbacks.onTotalScrollOffset?ft.call(i,e.callbacks.onTotalScrollOffset):[0,0],nt=e.callbacks.onTotalScrollBackOffset?ft.call(i,e.callbacks.onTotalScrollBackOffset):[0,0],tt;if(f.trigger=u.trigger,0===b.scrollTop()&&0===b.scrollLeft()||(n(".mCSB_"+f.idx+"_scrollbar").css("visibility","visible"),b.scrollTop(0).scrollLeft(0)),"_resetY"!==r||f.contentReset.y||(h("onOverflowYNone")&&e.callbacks.onOverflowYNone.call(i[0]),f.contentReset.y=1),"_resetX"!==r||f.contentReset.x||(h("onOverflowXNone")&&e.callbacks.onOverflowXNone.call(i[0]),f.contentReset.x=1),"_resetY"!==r&&"_resetX"!==r){(!f.contentReset.y&&i[0].mcs||!f.overflowed[0]||(h("onOverflowY")&&e.callbacks.onOverflowY.call(i[0]),f.contentReset.x=null),!f.contentReset.x&&i[0].mcs||!f.overflowed[1]||(h("onOverflowX")&&e.callbacks.onOverflowX.call(i[0]),f.contentReset.x=null),e.snapAmount)&&(tt=e.snapAmount instanceof Array?"x"===u.dir?e.snapAmount[1]:e.snapAmount[0]:e.snapAmount,r=yi(r,tt,e.snapOffset));switch(u.dir){case"x":var c=n("#mCSB_"+f.idx+"_dragger_horizontal"),it="left",w=o[0].offsetLeft,l=[p.width()-o.outerWidth(!1),c.parent().width()-c.width()],s=[r,0===r?0:r/f.scrollRatio.x],v=g[1],y=nt[1],et=v>0?v/f.scrollRatio.x:0,ot=y>0?y/f.scrollRatio.x:0;break;case"y":var c=n("#mCSB_"+f.idx+"_dragger_vertical"),it="top",w=o[0].offsetTop,l=[p.height()-o.outerHeight(!1),c.parent().height()-c.height()],s=[r,0===r?0:r/f.scrollRatio.y],v=g[0],y=nt[0],et=v>0?v/f.scrollRatio.y:0,ot=y>0?y/f.scrollRatio.y:0}s[1]<0||0===s[0]&&0===s[1]?s=[0,0]:s[1]>=l[1]?s=[l[0],l[1]]:s[0]=-s[0];i[0].mcs||(a(),h("onInit")&&e.callbacks.onInit.call(i[0]));clearTimeout(o[0].onCompleteTimeout);vt(c[0],it,Math.round(s[1]),k[1],u.scrollEasing);!f.tweenRunning&&(0===w&&s[0]>=0||w===l[0]&&s[0]<=l[0])||vt(o[0],it,Math.round(s[0]),k[0],u.scrollEasing,u.overwrite,{onStart:function(){u.callbacks&&u.onStart&&!f.tweenRunning&&(h("onScrollStart")&&(a(),e.callbacks.onScrollStart.call(i[0])),f.tweenRunning=!0,d(c),f.cbOffsets=rt())},onUpdate:function(){u.callbacks&&u.onUpdate&&h("whileScrolling")&&(a(),e.callbacks.whileScrolling.call(i[0]))},onComplete:function(){if(u.callbacks&&u.onComplete){"yx"===e.axis&&clearTimeout(o[0].onCompleteTimeout);var n=o[0].idleTimer||0;o[0].onCompleteTimeout=setTimeout(function(){h("onScroll")&&(a(),e.callbacks.onScroll.call(i[0]));h("onTotalScroll")&&s[1]>=l[1]-et&&f.cbOffsets[0]&&(a(),e.callbacks.onTotalScroll.call(i[0]));h("onTotalScrollBack")&&s[1]<=ot&&f.cbOffsets[1]&&(a(),e.callbacks.onTotalScrollBack.call(i[0]));f.tweenRunning=!1;o[0].idleTimer=0;d(c,"hide")},n)}}})}},vt=function(n,t,i,r,u,f,e){function a(){o.stop||(s||g.call(),s=w()-it,v(),s>=o.time&&(o.time=s>o.time?s+h-(s-o.time):s+h-1,o.time<s+1&&(o.time=s+1)),o.time<r?o.id=c(a):tt.call())}function v(){r>0?(o.currVal=d(o.time,l,p,r,u),y[t]=Math.round(o.currVal)+"px"):y[t]=i+"px";nt.call()}function b(){h=1e3/60;o.time=s+h;c=window.requestAnimationFrame?window.requestAnimationFrame:function(n){return v(),setTimeout(n,.01)};o.id=c(a)}function k(){null!=o.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(o.id):clearTimeout(o.id),o.id=null)}function d(n,t,i,r,u){switch(u){case"linear":case"mcsLinear":return i*n/r+t;case"mcsLinearOut":return n/=r,n--,i*Math.sqrt(1-n*n)+t;case"easeInOutSmooth":return n/=r/2,1>n?i/2*n*n+t:(n--,-i/2*(n*(n-2)-1)+t);case"easeInOutStrong":return n/=r/2,1>n?i/2*Math.pow(2,10*(n-1))+t:(n--,i/2*(-Math.pow(2,-10*n)+2)+t);case"easeInOut":case"mcsEaseInOut":return n/=r/2,1>n?i/2*n*n*n+t:(n-=2,i/2*(n*n*n+2)+t);case"easeOutSmooth":return n/=r,n--,-i*(n*n*n*n-1)+t;case"easeOutStrong":return i*(-Math.pow(2,-10*n/r)+1)+t;case"easeOut":case"mcsEaseOut":default:var f=(n/=r)*n,e=f*n;return t+i*(.499999999999997*e*f+-2.5*f*f+5.5*e+-6.5*f+4*n)}}var p;n._mTween||(n._mTween={top:{},left:{}});var h,c,e=e||{},g=e.onStart||function(){},nt=e.onUpdate||function(){},tt=e.onComplete||function(){},it=w(),s=0,l=n.offsetTop,y=n.style,o=n._mTween[t];"left"===t&&(l=n.offsetLeft);p=i-l;o.stop=0;"none"!==f&&k();b()},w=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},pi=function(){var n=this,r,i,t;for(n._mTween||(n._mTween={top:{},left:{}}),r=["top","left"],i=0;i<r.length;i++)t=r[i],n._mTween[t].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(n._mTween[t].id):clearTimeout(n._mTween[t].id),n._mTween[t].id=null,n._mTween[t].stop=1)},a=function(n,t){try{delete n[t]}catch(i){n[t]=null}},yt=function(n){return!(n.which&&1!==n.which)},nt=function(n){var t=n.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},tt=function(n){return!isNaN(parseFloat(n))&&isFinite(n)},f=function(n){var t=n.parents(".mCSB_container");return[n.offset().top-t.offset().top,n.offset().left-t.offset().left]},wi=function(){function t(){var t=["webkit","moz","ms","o"],n;if("hidden"in document)return"hidden";for(n=0;n<t.length;n++)if(t[n]+"Hidden"in document)return t[n]+"Hidden";return null}var n=t();return n?document[n]:!1};n.fn[c]=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void n.error("Method "+t+" does not exist"):s.init.apply(this,arguments)};n[c]=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void n.error("Method "+t+" does not exist"):s.init.apply(this,arguments)};n[c].defaults=ot;window[c]=!0;n(window).bind("load",function(){n(it)[c]();n.extend(n.expr[":"],{mcsInView:n.expr[":"].mcsInView||function(t){var e,r,i=n(t),u=i.parents(".mCSB_container");if(u.length)return e=u.parent(),r=[u[0].offsetTop,u[0].offsetLeft],r[0]+f(i)[0]>=0&&r[0]+f(i)[0]<e.height()-i.outerHeight(!1)&&r[1]+f(i)[1]>=0&&r[1]+f(i)[1]<e.width()-i.outerWidth(!1)},mcsInSight:n.expr[":"].mcsInSight||function(t,i,r){var e,u,o,s,h=n(t),c=h.parents(".mCSB_container"),l="exact"===r[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(c.length)return e=[h.outerHeight(!1),h.outerWidth(!1)],o=[c[0].offsetTop+f(h)[0],c[0].offsetLeft+f(h)[1]],u=[c.parent()[0].offsetHeight,c.parent()[0].offsetWidth],s=[e[0]<u[0]?l[0]:l[1],e[1]<u[1]?l[0]:l[1]],o[0]-u[0]*s[0][0]<0&&o[0]+e[0]-u[0]*s[0][1]>=0&&o[1]-u[1]*s[1][0]<0&&o[1]+e[1]-u[1]*s[1][1]>=0},mcsOverflow:n.expr[":"].mcsOverflow||function(i){var r=n(i).data(t);if(r)return r.overflowed[0]||r.overflowed[1]}})})})})