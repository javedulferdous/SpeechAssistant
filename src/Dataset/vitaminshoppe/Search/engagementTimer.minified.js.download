!function(e,t){function n(e){console.log({event:"engagement-timer-error",error:e.message})}function i(t){try{var i=/tealium/i,a=/gtm|google tag manager/i,r=/ga|google analytics/i;return!t.platform||a.test(t.platform)?(t.platform="gtm",t.dataLayerName=t.dataLayerName||"dataLayer",t.sendEngagementEvent=function(n,i,a,r,s,o,g){e[t.dataLayerName]=e[t.dataLayerName]||[],e[t.dataLayerName].push({event:n,timeEngagedActionsTaken:i,millisecondsEngaged:a,secondsEngaged:r,totalMillisecondsEngaged:s,totalSecondsEngaged:o,etIntervalSeconds:g})}):i.test(t.platform)?(t.platform="tealium",t.sendEngagementEvent=function(t,i,a,r,s,o,g){var l={interaction:t,et_timeEngagedActionsTaken:i,et_millisecondsEngaged:a,et_secondsEngaged:r,et_totalMillisecondsEngaged:s,et_totalSecondsEngaged:o,et_intervalSeconds:g};e.utag&&e.utag.link?e.utag.link(l):n({message:"tealium - utag not found"})}):r.test(t.platform)&&(t.platform="ga",myTracker=t.trackerName?t.trackerName+".":"",t.sendEngagementEvent=function(e,n,i,a,r,s,o){var g={hitType:"event",eventCategory:e,eventAction:a,eventLabel:n};g["metric"+(t.engagedSecondsMetricIndex||999)]=a,g["metric"+(t.totalEngagedSecondsMetricIndex||999)]=s,g["dimension"+(t.engagedEventsDimensionIndex||999)]=n,ga(myTracker+"send",g)}),t}catch(e){n(e)}}function a(e){try{var t=e||{},a={firstRun:!0,interval:40,intervalType:"normal",intervalLowerThreshold:10,intervalUpperThreshold:120,growthRate:0,engagedEvents:["mouseover","touchstart","touchmove","keydown"]};return t&&"object"==typeof t?(t.interval||t.engagedEvents||t.platform)&&(t.interval&&!isNaN(t.interval)&&(a.interval=Number(t.interval)),t.intervalLowerThreshold&&!isNaN(t.intervalLowerThreshold)&&(a.intervalLowerThreshold=Number(t.intervalLowerThreshold)),t.intervalUpperThreshold&&!isNaN(t.intervalUpperThreshold)&&(a.intervalUpperThreshold=Number(t.intervalUpperThreshold)),t.interval&&!isNaN(t.interval)&&(a.interval=Number(t.interval)),t.intervalType&&"string"==typeof t.intervalType&&(a.intervalType=t.intervalType),t.engagedEvents&&t.engagedEvents.push&&(a.engagedEvents=t.engagedEvents),t.platform&&"string"==typeof t.platform&&(a.platform=t.platform),t.engagedSecondsMetricIndex&&!isNaN(t.engagedSecondsMetricIndex)&&(a.engagedSecondsMetricIndex=t.engagedSecondsMetricIndex),t.engagedEventsDimensionIndex&&!isNaN(t.engagedEventsDimensionIndex)&&(a.engagedEventsDimensionIndex=t.engagedEventsDimensionIndex),t.trackerName&&"string"==typeof t.trackerName&&(a.trackerName=t.trackerName),t.dataLayerName&&"string"==typeof t.dataLayerName&&(a.dataLayerName=t.dataLayerName)):n({message:"settings validation error"}),a=i(a)}catch(e){n(e)}}console.log("Engagement Timer Version Number:  3.0"),e._apEngage=function(i){function r(i,a){try{for(var r=!!t.addEventListener,s=!!t.attachEvent,o=0;o<i.length;o++)r?t.addEventListener(i[o],function(e){a.engagementDemonstrated(e)}):s&&t.attachEvent("on"+i[o],function(e){a.engagementDemonstrated(e)});e.onbeforeunload=function(){a.events.push("pageunload"),a.sendEngagementTime(a.previousBlock)}}catch(e){n(e)}}function s(){this.start=!0,this.firstTime=0,this.lastTime=0,this.events=[],this.interval=0,this.turn=1,this.timeout=0,this.init=function(e){this.previousBlock={timeout:e.timeout||0,lastTime:e.lastTime||0,turn:e.turn||1},this.start=!0,this.firstTime=0,this.lastTime=0,this.events=[],this.interval=0,this.turn=e.turn||1,this.timeout=0},this.resetTurn=function(e){this.turn=e||1},this.getTimeout=function(e){return"normal"===e.type?this.timeout=e.seconds:"backoff"===e.type&&(d.previousBlock.timeout<e.upperThreshold&&(this.timeout=g(this.turn)),this.timeout=this.timeout<e.upperThreshold?this.timeout:e.upperThreshold),this.timeout},this.sendEngagementTime=function(e,t,i,a,r){try{this.events.length>0&&(t=o(this.firstTime,this.previousBlock.lastTime)<h.milliseconds?o(this.lastTime,this.previousBlock.lastTime):o(this.lastTime,this.firstTime),e=this.events.join(", "),a=Math.round(t/1e3),v+=t,r=Math.round(v/1e3),a>0&&a<=2*this.timeout?(c("timeEngaged",e,t,a,v,r,this.timeout),this.turn++):0===a?this.resetTurn():c("timeEngagedError",e,t,a,v,r,this.timeout))}catch(e){n(e)}},this.engagementDemonstrated=function(e){try{var t=e.type,i=(new Date).getTime();this.start&&(this.firstTime=i,this.start=!1),this.events.indexOf(t)<0&&this.events.push(t),this.lastTime=i}catch(e){n(e)}},this.init({timeout:0,lastTime:0,turn:1})}function o(e,t){return e-t}function g(e){return e<2?h.lowerThreshold:Math.pow(2*(1+h.growthRate),e-1)*h.lowerThreshold}function l(){h.firstRun?(d.engagementDemonstrated({type:"pageload"}),h.firstRun=!1):(d.sendEngagementTime(d.previousBlock,d.events),d.init(d)),d.getTimeout(h),setTimeout(function(){l()},1e3*d.timeout)}try{var d,m=a(i),h={firstRun:!0,type:m.intervalType,seconds:m.interval,milliseconds:1e3*m.interval,lowerThreshold:m.intervalLowerThreshold,upperThreshold:m.intervalUpperThreshold,growthRate:m.growthRate},u=m.engagedEvents,c=(m.platform,m.sendEngagementEvent),v=0;Date.now(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,i=this.length;n<i;n++)if(this[n]===e)return n;return-1})}catch(e){n(e)}try{e._ET_initialized||(e._ET_initialized=function(){try{return d=new s,r(u,d),l(),!0}catch(e){n(e)}}())}catch(e){n(e)}}}(window,document);
